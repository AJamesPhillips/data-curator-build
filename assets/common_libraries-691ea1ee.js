var n$4,l$4,u$4,i$1,o$1,r$4,f$3,e$4,c$3={},s$1=[],a$1=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,h$5=Array.isArray;function v$4(te,ee){for(var re in ee)te[re]=ee[re];return te}function p$5(te){var ee=te.parentNode;ee&&ee.removeChild(te)}function y$2(te,ee,re){var ne,ie,se,le={};for(se in ee)se=="key"?ne=ee[se]:se=="ref"?ie=ee[se]:le[se]=ee[se];if(arguments.length>2&&(le.children=arguments.length>3?n$4.call(arguments,2):re),typeof te=="function"&&te.defaultProps!=null)for(se in te.defaultProps)le[se]===void 0&&(le[se]=te.defaultProps[se]);return d$3(te,le,ne,ie,null)}function d$3(te,ee,re,ne,ie){var se={type:te,props:ee,key:re,ref:ne,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:ie??++u$4};return ie==null&&l$4.vnode!=null&&l$4.vnode(se),se}function _$1(){return{current:null}}function k$5(te){return te.children}function b$3(te,ee){this.props=te,this.context=ee}function g$4(te,ee){if(ee==null)return te.__?g$4(te.__,te.__.__k.indexOf(te)+1):null;for(var re;ee<te.__k.length;ee++)if((re=te.__k[ee])!=null&&re.__e!=null)return re.__e;return typeof te.type=="function"?g$4(te):null}function m$4(te){var ee,re;if((te=te.__)!=null&&te.__c!=null){for(te.__e=te.__c.base=null,ee=0;ee<te.__k.length;ee++)if((re=te.__k[ee])!=null&&re.__e!=null){te.__e=te.__c.base=re.__e;break}return m$4(te)}}function w$4(te){(!te.__d&&(te.__d=!0)&&i$1.push(te)&&!x$3.__r++||o$1!==l$4.debounceRendering)&&((o$1=l$4.debounceRendering)||r$4)(x$3)}function x$3(){var te,ee,re,ne,ie,se,le,ue,ae;for(i$1.sort(f$3);te=i$1.shift();)te.__d&&(ee=i$1.length,ne=void 0,ie=void 0,se=void 0,ue=(le=(re=te).__v).__e,(ae=re.__P)&&(ne=[],ie=[],(se=v$4({},le)).__v=le.__v+1,L$1(ae,le,se,re.__n,ae.ownerSVGElement!==void 0,le.__h!=null?[ue]:null,ne,ue??g$4(le),le.__h,ie),M$1(ne,le,ie),le.__e!=ue&&m$4(le)),i$1.length>ee&&i$1.sort(f$3));x$3.__r=0}function P$3(te,ee,re,ne,ie,se,le,ue,ae,oe,he){var ce,pe,de,me,ve,we,ge,_e,Te,Ne,ye=0,Le=ne&&ne.__k||s$1,xe=Le.length,Oe=xe,Fe=ee.length;for(re.__k=[],ce=0;ce<Fe;ce++)(me=re.__k[ce]=(me=ee[ce])==null||typeof me=="boolean"||typeof me=="function"?null:typeof me=="string"||typeof me=="number"||typeof me=="bigint"?d$3(null,me,null,null,me):h$5(me)?d$3(k$5,{children:me},null,null,null):me.__b>0?d$3(me.type,me.props,me.key,me.ref?me.ref:null,me.__v):me)!=null&&(me.__=re,me.__b=re.__b+1,(_e=A$3(me,Le,ge=ce+ye,Oe))===-1?de=c$3:(de=Le[_e]||c$3,Le[_e]=void 0,Oe--),L$1(te,me,de,ie,se,le,ue,ae,oe,he),ve=me.__e,(pe=me.ref)&&de.ref!=pe&&(de.ref&&O$1(de.ref,null,me),he.push(pe,me.__c||ve,me)),ve!=null&&(we==null&&(we=ve),Ne=!(Te=de===c$3||de.__v===null)&&_e===ge,Te?_e==-1&&ye--:_e!==ge&&(_e===ge+1?(ye++,Ne=!0):_e>ge?Oe>Fe-ge?(ye+=_e-ge,Ne=!0):ye--:ye=_e<ge&&_e==ge-1?_e-ge:0),ge=ce+ye,Ne=Ne||_e==ce&&!Te,typeof me.type!="function"||_e===ge&&de.__k!==me.__k?typeof me.type=="function"||Ne?me.__d!==void 0?(ae=me.__d,me.__d=void 0):ae=ve.nextSibling:ae=$$1(te,ve,ae):ae=C$1(me,ae,te),typeof re.type=="function"&&(re.__d=ae)));for(re.__e=we,ce=xe;ce--;)Le[ce]!=null&&(typeof re.type=="function"&&Le[ce].__e!=null&&Le[ce].__e==re.__d&&(re.__d=Le[ce].__e.nextSibling),q$6(Le[ce],Le[ce]))}function C$1(te,ee,re){for(var ne,ie=te.__k,se=0;ie&&se<ie.length;se++)(ne=ie[se])&&(ne.__=te,ee=typeof ne.type=="function"?C$1(ne,ee,re):$$1(re,ne.__e,ee));return ee}function S(te,ee){return ee=ee||[],te==null||typeof te=="boolean"||(h$5(te)?te.some(function(re){S(re,ee)}):ee.push(te)),ee}function $$1(te,ee,re){return re==null||re.parentNode!==te?te.insertBefore(ee,null):ee==re&&ee.parentNode!=null||te.insertBefore(ee,re),ee.nextSibling}function A$3(te,ee,re,ne){var ie=te.key,se=te.type,le=re-1,ue=re+1,ae=ee[re];if(ae===null||ae&&ie==ae.key&&se===ae.type)return re;if(ne>(ae!=null?1:0))for(;le>=0||ue<ee.length;){if(le>=0){if((ae=ee[le])&&ie==ae.key&&se===ae.type)return le;le--}if(ue<ee.length){if((ae=ee[ue])&&ie==ae.key&&se===ae.type)return ue;ue++}}return-1}function H$1(te,ee,re,ne,ie){var se;for(se in re)se==="children"||se==="key"||se in ee||T$2(te,se,null,re[se],ne);for(se in ee)ie&&typeof ee[se]!="function"||se==="children"||se==="key"||se==="value"||se==="checked"||re[se]===ee[se]||T$2(te,se,ee[se],re[se],ne)}function I$1(te,ee,re){ee[0]==="-"?te.setProperty(ee,re??""):te[ee]=re==null?"":typeof re!="number"||a$1.test(ee)?re:re+"px"}function T$2(te,ee,re,ne,ie){var se;e:if(ee==="style")if(typeof re=="string")te.style.cssText=re;else{if(typeof ne=="string"&&(te.style.cssText=ne=""),ne)for(ee in ne)re&&ee in re||I$1(te.style,ee,"");if(re)for(ee in re)ne&&re[ee]===ne[ee]||I$1(te.style,ee,re[ee])}else if(ee[0]==="o"&&ee[1]==="n")se=ee!==(ee=ee.replace(/Capture$/,"")),ee=ee.toLowerCase()in te?ee.toLowerCase().slice(2):ee.slice(2),te.l||(te.l={}),te.l[ee+se]=re,re?ne||te.addEventListener(ee,se?z$3:j$2,se):te.removeEventListener(ee,se?z$3:j$2,se);else if(ee!=="dangerouslySetInnerHTML"){if(ie)ee=ee.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(ee!=="width"&&ee!=="height"&&ee!=="href"&&ee!=="list"&&ee!=="form"&&ee!=="tabIndex"&&ee!=="download"&&ee!=="rowSpan"&&ee!=="colSpan"&&ee in te)try{te[ee]=re??"";break e}catch{}typeof re=="function"||(re==null||re===!1&&ee[4]!=="-"?te.removeAttribute(ee):te.setAttribute(ee,re))}}function j$2(te){return this.l[te.type+!1](l$4.event?l$4.event(te):te)}function z$3(te){return this.l[te.type+!0](l$4.event?l$4.event(te):te)}function L$1(te,ee,re,ne,ie,se,le,ue,ae,oe){var he,ce,pe,de,me,ve,we,ge,_e,Te,Ne,ye,Le,xe,Oe,Fe=ee.type;if(ee.constructor!==void 0)return null;re.__h!=null&&(ae=re.__h,ue=ee.__e=re.__e,ee.__h=null,se=[ue]),(he=l$4.__b)&&he(ee);try{e:if(typeof Fe=="function"){if(ge=ee.props,_e=(he=Fe.contextType)&&ne[he.__c],Te=he?_e?_e.props.value:he.__:ne,re.__c?we=(ce=ee.__c=re.__c).__=ce.__E:("prototype"in Fe&&Fe.prototype.render?ee.__c=ce=new Fe(ge,Te):(ee.__c=ce=new b$3(ge,Te),ce.constructor=Fe,ce.render=B$2),_e&&_e.sub(ce),ce.props=ge,ce.state||(ce.state={}),ce.context=Te,ce.__n=ne,pe=ce.__d=!0,ce.__h=[],ce._sb=[]),ce.__s==null&&(ce.__s=ce.state),Fe.getDerivedStateFromProps!=null&&(ce.__s==ce.state&&(ce.__s=v$4({},ce.__s)),v$4(ce.__s,Fe.getDerivedStateFromProps(ge,ce.__s))),de=ce.props,me=ce.state,ce.__v=ee,pe)Fe.getDerivedStateFromProps==null&&ce.componentWillMount!=null&&ce.componentWillMount(),ce.componentDidMount!=null&&ce.__h.push(ce.componentDidMount);else{if(Fe.getDerivedStateFromProps==null&&ge!==de&&ce.componentWillReceiveProps!=null&&ce.componentWillReceiveProps(ge,Te),!ce.__e&&(ce.shouldComponentUpdate!=null&&ce.shouldComponentUpdate(ge,ce.__s,Te)===!1||ee.__v===re.__v)){for(ee.__v!==re.__v&&(ce.props=ge,ce.state=ce.__s,ce.__d=!1),ee.__e=re.__e,ee.__k=re.__k,ee.__k.forEach(function(De){De&&(De.__=ee)}),Ne=0;Ne<ce._sb.length;Ne++)ce.__h.push(ce._sb[Ne]);ce._sb=[],ce.__h.length&&le.push(ce);break e}ce.componentWillUpdate!=null&&ce.componentWillUpdate(ge,ce.__s,Te),ce.componentDidUpdate!=null&&ce.__h.push(function(){ce.componentDidUpdate(de,me,ve)})}if(ce.context=Te,ce.props=ge,ce.__P=te,ce.__e=!1,ye=l$4.__r,Le=0,"prototype"in Fe&&Fe.prototype.render){for(ce.state=ce.__s,ce.__d=!1,ye&&ye(ee),he=ce.render(ce.props,ce.state,ce.context),xe=0;xe<ce._sb.length;xe++)ce.__h.push(ce._sb[xe]);ce._sb=[]}else do ce.__d=!1,ye&&ye(ee),he=ce.render(ce.props,ce.state,ce.context),ce.state=ce.__s;while(ce.__d&&++Le<25);ce.state=ce.__s,ce.getChildContext!=null&&(ne=v$4(v$4({},ne),ce.getChildContext())),pe||ce.getSnapshotBeforeUpdate==null||(ve=ce.getSnapshotBeforeUpdate(de,me)),P$3(te,h$5(Oe=he!=null&&he.type===k$5&&he.key==null?he.props.children:he)?Oe:[Oe],ee,re,ne,ie,se,le,ue,ae,oe),ce.base=ee.__e,ee.__h=null,ce.__h.length&&le.push(ce),we&&(ce.__E=ce.__=null)}else se==null&&ee.__v===re.__v?(ee.__k=re.__k,ee.__e=re.__e):ee.__e=N$1(re.__e,ee,re,ne,ie,se,le,ae,oe);(he=l$4.diffed)&&he(ee)}catch(De){ee.__v=null,(ae||se!=null)&&(ee.__e=ue,ee.__h=!!ae,se[se.indexOf(ue)]=null),l$4.__e(De,ee,re)}}function M$1(te,ee,re){for(var ne=0;ne<re.length;ne++)O$1(re[ne],re[++ne],re[++ne]);l$4.__c&&l$4.__c(ee,te),te.some(function(ie){try{te=ie.__h,ie.__h=[],te.some(function(se){se.call(ie)})}catch(se){l$4.__e(se,ie.__v)}})}function N$1(te,ee,re,ne,ie,se,le,ue,ae){var oe,he,ce,pe=re.props,de=ee.props,me=ee.type,ve=0;if(me==="svg"&&(ie=!0),se!=null){for(;ve<se.length;ve++)if((oe=se[ve])&&"setAttribute"in oe==!!me&&(me?oe.localName===me:oe.nodeType===3)){te=oe,se[ve]=null;break}}if(te==null){if(me===null)return document.createTextNode(de);te=ie?document.createElementNS("http://www.w3.org/2000/svg",me):document.createElement(me,de.is&&de),se=null,ue=!1}if(me===null)pe===de||ue&&te.data===de||(te.data=de);else{if(se=se&&n$4.call(te.childNodes),he=(pe=re.props||c$3).dangerouslySetInnerHTML,ce=de.dangerouslySetInnerHTML,!ue){if(se!=null)for(pe={},ve=0;ve<te.attributes.length;ve++)pe[te.attributes[ve].name]=te.attributes[ve].value;(ce||he)&&(ce&&(he&&ce.__html==he.__html||ce.__html===te.innerHTML)||(te.innerHTML=ce&&ce.__html||""))}if(H$1(te,de,pe,ie,ue),ce)ee.__k=[];else if(P$3(te,h$5(ve=ee.props.children)?ve:[ve],ee,re,ne,ie&&me!=="foreignObject",se,le,se?se[0]:re.__k&&g$4(re,0),ue,ae),se!=null)for(ve=se.length;ve--;)se[ve]!=null&&p$5(se[ve]);ue||("value"in de&&(ve=de.value)!==void 0&&(ve!==te.value||me==="progress"&&!ve||me==="option"&&ve!==pe.value)&&T$2(te,"value",ve,pe.value,!1),"checked"in de&&(ve=de.checked)!==void 0&&ve!==te.checked&&T$2(te,"checked",ve,pe.checked,!1))}return te}function O$1(te,ee,re){try{typeof te=="function"?te(ee):te.current=ee}catch(ne){l$4.__e(ne,re)}}function q$6(te,ee,re){var ne,ie;if(l$4.unmount&&l$4.unmount(te),(ne=te.ref)&&(ne.current&&ne.current!==te.__e||O$1(ne,null,ee)),(ne=te.__c)!=null){if(ne.componentWillUnmount)try{ne.componentWillUnmount()}catch(se){l$4.__e(se,ee)}ne.base=ne.__P=null,te.__c=void 0}if(ne=te.__k)for(ie=0;ie<ne.length;ie++)ne[ie]&&q$6(ne[ie],ee,re||typeof te.type!="function");re||te.__e==null||p$5(te.__e),te.__=te.__e=te.__d=void 0}function B$2(te,ee,re){return this.constructor(te,re)}function D$1(te,ee,re){var ne,ie,se,le;l$4.__&&l$4.__(te,ee),ie=(ne=typeof re=="function")?null:re&&re.__k||ee.__k,se=[],le=[],L$1(ee,te=(!ne&&re||ee).__k=y$2(k$5,null,[te]),ie||c$3,c$3,ee.ownerSVGElement!==void 0,!ne&&re?[re]:ie?null:ee.firstChild?n$4.call(ee.childNodes):null,se,!ne&&re?re:ie?ie.__e:ee.firstChild,ne,le),M$1(se,te,le)}function E$1(te,ee){D$1(te,ee,E$1)}function F$2(te,ee,re){var ne,ie,se,le,ue=v$4({},te.props);for(se in te.type&&te.type.defaultProps&&(le=te.type.defaultProps),ee)se=="key"?ne=ee[se]:se=="ref"?ie=ee[se]:ue[se]=ee[se]===void 0&&le!==void 0?le[se]:ee[se];return arguments.length>2&&(ue.children=arguments.length>3?n$4.call(arguments,2):re),d$3(te.type,ue,ne||te.key,ie||te.ref,null)}function G$1(te,ee){var re={__c:ee="__cC"+e$4++,__:te,Consumer:function(ne,ie){return ne.children(ie)},Provider:function(ne){var ie,se;return this.getChildContext||(ie=[],(se={})[ee]=this,this.getChildContext=function(){return se},this.shouldComponentUpdate=function(le){this.props.value!==le.value&&ie.some(function(ue){ue.__e=!0,w$4(ue)})},this.sub=function(le){ie.push(le);var ue=le.componentWillUnmount;le.componentWillUnmount=function(){ie.splice(ie.indexOf(le),1),ue&&ue.call(le)}}),ne.children}};return re.Provider.__=re.Consumer.contextType=re}n$4=s$1.slice,l$4={__e:function(te,ee,re,ne){for(var ie,se,le;ee=ee.__;)if((ie=ee.__c)&&!ie.__)try{if((se=ie.constructor)&&se.getDerivedStateFromError!=null&&(ie.setState(se.getDerivedStateFromError(te)),le=ie.__d),ie.componentDidCatch!=null&&(ie.componentDidCatch(te,ne||{}),le=ie.__d),le)return ie.__E=ie}catch(ue){te=ue}throw te}},u$4=0,b$3.prototype.setState=function(te,ee){var re;re=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=v$4({},this.state),typeof te=="function"&&(te=te(v$4({},re),this.props)),te&&v$4(re,te),te!=null&&this.__v&&(ee&&this._sb.push(ee),w$4(this))},b$3.prototype.forceUpdate=function(te){this.__v&&(this.__e=!0,te&&this.__h.push(te),w$4(this))},b$3.prototype.render=k$5,i$1=[],r$4=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,f$3=function(te,ee){return te.__v.__b-ee.__v.__b},x$3.__r=0,e$4=0;var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(te){return te&&te.__esModule&&Object.prototype.hasOwnProperty.call(te,"default")?te.default:te}function getAugmentedNamespace(te){if(te.__esModule)return te;var ee=te.default;if(typeof ee=="function"){var re=function ne(){if(this instanceof ne){var ie=[null];ie.push.apply(ie,arguments);var se=Function.bind.apply(ee,ie);return new se}return ee.apply(this,arguments)};re.prototype=ee.prototype}else re={};return Object.defineProperty(re,"__esModule",{value:!0}),Object.keys(te).forEach(function(ne){var ie=Object.getOwnPropertyDescriptor(te,ne);Object.defineProperty(re,ne,ie.get?ie:{enumerable:!0,get:function(){return te[ne]}})}),re}function _extends$1(){return _extends$1=Object.assign?Object.assign.bind():function(te){for(var ee=1;ee<arguments.length;ee++){var re=arguments[ee];for(var ne in re)Object.prototype.hasOwnProperty.call(re,ne)&&(te[ne]=re[ne])}return te},_extends$1.apply(this,arguments)}var reactIs$2={exports:{}},reactIs_production_min$1={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var b$2=Symbol.for("react.element"),c$2=Symbol.for("react.portal"),d$2=Symbol.for("react.fragment"),e$3=Symbol.for("react.strict_mode"),f$2=Symbol.for("react.profiler"),g$3=Symbol.for("react.provider"),h$4=Symbol.for("react.context"),k$4=Symbol.for("react.server_context"),l$3=Symbol.for("react.forward_ref"),m$3=Symbol.for("react.suspense"),n$3=Symbol.for("react.suspense_list"),p$4=Symbol.for("react.memo"),q$5=Symbol.for("react.lazy"),t$5=Symbol.for("react.offscreen"),u$3;u$3=Symbol.for("react.module.reference");function v$3(te){if(typeof te=="object"&&te!==null){var ee=te.$$typeof;switch(ee){case b$2:switch(te=te.type,te){case d$2:case f$2:case e$3:case m$3:case n$3:return te;default:switch(te=te&&te.$$typeof,te){case k$4:case h$4:case l$3:case q$5:case p$4:case g$3:return te;default:return ee}}case c$2:return ee}}}reactIs_production_min$1.ContextConsumer=h$4;reactIs_production_min$1.ContextProvider=g$3;reactIs_production_min$1.Element=b$2;reactIs_production_min$1.ForwardRef=l$3;reactIs_production_min$1.Fragment=d$2;reactIs_production_min$1.Lazy=q$5;reactIs_production_min$1.Memo=p$4;reactIs_production_min$1.Portal=c$2;reactIs_production_min$1.Profiler=f$2;reactIs_production_min$1.StrictMode=e$3;reactIs_production_min$1.Suspense=m$3;reactIs_production_min$1.SuspenseList=n$3;reactIs_production_min$1.isAsyncMode=function(){return!1};reactIs_production_min$1.isConcurrentMode=function(){return!1};reactIs_production_min$1.isContextConsumer=function(te){return v$3(te)===h$4};reactIs_production_min$1.isContextProvider=function(te){return v$3(te)===g$3};reactIs_production_min$1.isElement=function(te){return typeof te=="object"&&te!==null&&te.$$typeof===b$2};reactIs_production_min$1.isForwardRef=function(te){return v$3(te)===l$3};reactIs_production_min$1.isFragment=function(te){return v$3(te)===d$2};reactIs_production_min$1.isLazy=function(te){return v$3(te)===q$5};reactIs_production_min$1.isMemo=function(te){return v$3(te)===p$4};reactIs_production_min$1.isPortal=function(te){return v$3(te)===c$2};reactIs_production_min$1.isProfiler=function(te){return v$3(te)===f$2};reactIs_production_min$1.isStrictMode=function(te){return v$3(te)===e$3};reactIs_production_min$1.isSuspense=function(te){return v$3(te)===m$3};reactIs_production_min$1.isSuspenseList=function(te){return v$3(te)===n$3};reactIs_production_min$1.isValidElementType=function(te){return typeof te=="string"||typeof te=="function"||te===d$2||te===f$2||te===e$3||te===m$3||te===n$3||te===t$5||typeof te=="object"&&te!==null&&(te.$$typeof===q$5||te.$$typeof===p$4||te.$$typeof===g$3||te.$$typeof===h$4||te.$$typeof===l$3||te.$$typeof===u$3||te.getModuleId!==void 0)};reactIs_production_min$1.typeOf=v$3;reactIs$2.exports=reactIs_production_min$1;var reactIsExports$1=reactIs$2.exports,t$4,r$3,u$2,i,o=0,f$1=[],c$1=[],e$2=l$4.__b,a=l$4.__r,v$2=l$4.diffed,l$2=l$4.__c,m$2=l$4.unmount;function d$1(te,ee){l$4.__h&&l$4.__h(r$3,te,o||ee),o=0;var re=r$3.__H||(r$3.__H={__:[],__h:[]});return te>=re.__.length&&re.__.push({__V:c$1}),re.__[te]}function h$3(te){return o=1,s(B$1,te)}function s(te,ee,re){var ne=d$1(t$4++,2);if(ne.t=te,!ne.__c&&(ne.__=[re?re(ee):B$1(void 0,ee),function(ue){var ae=ne.__N?ne.__N[0]:ne.__[0],oe=ne.t(ae,ue);ae!==oe&&(ne.__N=[oe,ne.__[1]],ne.__c.setState({}))}],ne.__c=r$3,!r$3.u)){var ie=function(ue,ae,oe){if(!ne.__c.__H)return!0;var he=ne.__c.__H.__.filter(function(pe){return pe.__c});if(he.every(function(pe){return!pe.__N}))return!se||se.call(this,ue,ae,oe);var ce=!1;return he.forEach(function(pe){if(pe.__N){var de=pe.__[0];pe.__=pe.__N,pe.__N=void 0,de!==pe.__[0]&&(ce=!0)}}),!(!ce&&ne.__c.props===ue)&&(!se||se.call(this,ue,ae,oe))};r$3.u=!0;var se=r$3.shouldComponentUpdate,le=r$3.componentWillUpdate;r$3.componentWillUpdate=function(ue,ae,oe){if(this.__e){var he=se;se=void 0,ie(ue,ae,oe),se=he}le&&le.call(this,ue,ae,oe)},r$3.shouldComponentUpdate=ie}return ne.__N||ne.__}function p$3(te,ee){var re=d$1(t$4++,3);!l$4.__s&&z$2(re.__H,ee)&&(re.__=te,re.i=ee,r$3.__H.__h.push(re))}function y$1(te,ee){var re=d$1(t$4++,4);!l$4.__s&&z$2(re.__H,ee)&&(re.__=te,re.i=ee,r$3.__h.push(re))}function _(te){return o=5,F$1(function(){return{current:te}},[])}function A$2(te,ee,re){o=6,y$1(function(){return typeof te=="function"?(te(ee()),function(){return te(null)}):te?(te.current=ee(),function(){return te.current=null}):void 0},re==null?re:re.concat(te))}function F$1(te,ee){var re=d$1(t$4++,7);return z$2(re.__H,ee)?(re.__V=te(),re.i=ee,re.__h=te,re.__V):re.__}function T$1(te,ee){return o=8,F$1(function(){return te},ee)}function q$4(te){var ee=r$3.context[te.__c],re=d$1(t$4++,9);return re.c=te,ee?(re.__==null&&(re.__=!0,ee.sub(r$3)),ee.props.value):te.__}function x$2(te,ee){l$4.useDebugValue&&l$4.useDebugValue(ee?ee(te):te)}function P$2(te){var ee=d$1(t$4++,10),re=h$3();return ee.__=te,r$3.componentDidCatch||(r$3.componentDidCatch=function(ne,ie){ee.__&&ee.__(ne,ie),re[1](ne)}),[re[0],function(){re[1](void 0)}]}function V$1(){var te=d$1(t$4++,11);if(!te.__){for(var ee=r$3.__v;ee!==null&&!ee.__m&&ee.__!==null;)ee=ee.__;var re=ee.__m||(ee.__m=[0,0]);te.__="P"+re[0]+"-"+re[1]++}return te.__}function b$1(){for(var te;te=f$1.shift();)if(te.__P&&te.__H)try{te.__H.__h.forEach(k$3),te.__H.__h.forEach(w$3),te.__H.__h=[]}catch(ee){te.__H.__h=[],l$4.__e(ee,te.__v)}}l$4.__b=function(te){r$3=null,e$2&&e$2(te)},l$4.__r=function(te){a&&a(te),t$4=0;var ee=(r$3=te.__c).__H;ee&&(u$2===r$3?(ee.__h=[],r$3.__h=[],ee.__.forEach(function(re){re.__N&&(re.__=re.__N),re.__V=c$1,re.__N=re.i=void 0})):(ee.__h.forEach(k$3),ee.__h.forEach(w$3),ee.__h=[],t$4=0)),u$2=r$3},l$4.diffed=function(te){v$2&&v$2(te);var ee=te.__c;ee&&ee.__H&&(ee.__H.__h.length&&(f$1.push(ee)!==1&&i===l$4.requestAnimationFrame||((i=l$4.requestAnimationFrame)||j$1)(b$1)),ee.__H.__.forEach(function(re){re.i&&(re.__H=re.i),re.__V!==c$1&&(re.__=re.__V),re.i=void 0,re.__V=c$1})),u$2=r$3=null},l$4.__c=function(te,ee){ee.some(function(re){try{re.__h.forEach(k$3),re.__h=re.__h.filter(function(ne){return!ne.__||w$3(ne)})}catch(ne){ee.some(function(ie){ie.__h&&(ie.__h=[])}),ee=[],l$4.__e(ne,re.__v)}}),l$2&&l$2(te,ee)},l$4.unmount=function(te){m$2&&m$2(te);var ee,re=te.__c;re&&re.__H&&(re.__H.__.forEach(function(ne){try{k$3(ne)}catch(ie){ee=ie}}),re.__H=void 0,ee&&l$4.__e(ee,re.__v))};var g$2=typeof requestAnimationFrame=="function";function j$1(te){var ee,re=function(){clearTimeout(ne),g$2&&cancelAnimationFrame(ee),setTimeout(te)},ne=setTimeout(re,100);g$2&&(ee=requestAnimationFrame(re))}function k$3(te){var ee=r$3,re=te.__c;typeof re=="function"&&(te.__c=void 0,re()),r$3=ee}function w$3(te){var ee=r$3;te.__c=te.__(),r$3=ee}function z$2(te,ee){return!te||te.length!==ee.length||ee.some(function(re,ne){return re!==te[ne]})}function B$1(te,ee){return typeof ee=="function"?ee(te):ee}function g$1(te,ee){for(var re in ee)te[re]=ee[re];return te}function C(te,ee){for(var re in te)if(re!=="__source"&&!(re in ee))return!0;for(var ne in ee)if(ne!=="__source"&&te[ne]!==ee[ne])return!0;return!1}function E(te,ee){return te===ee&&(te!==0||1/te==1/ee)||te!=te&&ee!=ee}function w$2(te){this.props=te}function x$1(te,ee){function re(ie){var se=this.props.ref,le=se==ie.ref;return!le&&se&&(se.call?se(null):se.current=null),ee?!ee(this.props,ie)||!le:C(this.props,ie)}function ne(ie){return this.shouldComponentUpdate=re,y$2(te,ie)}return ne.displayName="Memo("+(te.displayName||te.name)+")",ne.prototype.isReactComponent=!0,ne.__f=!0,ne}(w$2.prototype=new b$3).isPureReactComponent=!0,w$2.prototype.shouldComponentUpdate=function(te,ee){return C(this.props,te)||C(this.state,ee)};var R=l$4.__b;l$4.__b=function(te){te.type&&te.type.__f&&te.ref&&(te.props.ref=te.ref,te.ref=null),R&&R(te)};var N=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function k$2(te){function ee(re){var ne=g$1({},re);return delete ne.ref,te(ne,re.ref||null)}return ee.$$typeof=N,ee.render=ee,ee.prototype.isReactComponent=ee.__f=!0,ee.displayName="ForwardRef("+(te.displayName||te.name)+")",ee}var A$1=function(te,ee){return te==null?null:S(S(te).map(ee))},O={map:A$1,forEach:A$1,count:function(te){return te?S(te).length:0},only:function(te){var ee=S(te);if(ee.length!==1)throw"Children.only";return ee[0]},toArray:S},T=l$4.__e;l$4.__e=function(te,ee,re,ne){if(te.then){for(var ie,se=ee;se=se.__;)if((ie=se.__c)&&ie.__c)return ee.__e==null&&(ee.__e=re.__e,ee.__k=re.__k),ie.__c(te,ee)}T(te,ee,re,ne)};var I=l$4.unmount;function L(te,ee,re){return te&&(te.__c&&te.__c.__H&&(te.__c.__H.__.forEach(function(ne){typeof ne.__c=="function"&&ne.__c()}),te.__c.__H=null),(te=g$1({},te)).__c!=null&&(te.__c.__P===re&&(te.__c.__P=ee),te.__c=null),te.__k=te.__k&&te.__k.map(function(ne){return L(ne,ee,re)})),te}function U(te,ee,re){return te&&(te.__v=null,te.__k=te.__k&&te.__k.map(function(ne){return U(ne,ee,re)}),te.__c&&te.__c.__P===ee&&(te.__e&&re.insertBefore(te.__e,te.__d),te.__c.__e=!0,te.__c.__P=re)),te}function D(){this.__u=0,this.t=null,this.__b=null}function F(te){var ee=te.__.__c;return ee&&ee.__a&&ee.__a(te)}function M(te){var ee,re,ne;function ie(se){if(ee||(ee=te()).then(function(le){re=le.default||le},function(le){ne=le}),ne)throw ne;if(!re)throw ee;return y$2(re,se)}return ie.displayName="Lazy",ie.__f=!0,ie}function V(){this.u=null,this.o=null}l$4.unmount=function(te){var ee=te.__c;ee&&ee.__R&&ee.__R(),ee&&te.__h===!0&&(te.type=null),I&&I(te)},(D.prototype=new b$3).__c=function(te,ee){var re=ee.__c,ne=this;ne.t==null&&(ne.t=[]),ne.t.push(re);var ie=F(ne.__v),se=!1,le=function(){se||(se=!0,re.__R=null,ie?ie(ue):ue())};re.__R=le;var ue=function(){if(!--ne.__u){if(ne.state.__a){var oe=ne.state.__a;ne.__v.__k[0]=U(oe,oe.__c.__P,oe.__c.__O)}var he;for(ne.setState({__a:ne.__b=null});he=ne.t.pop();)he.forceUpdate()}},ae=ee.__h===!0;ne.__u++||ae||ne.setState({__a:ne.__b=ne.__v.__k[0]}),te.then(le,le)},D.prototype.componentWillUnmount=function(){this.t=[]},D.prototype.render=function(te,ee){if(this.__b){if(this.__v.__k){var re=document.createElement("div"),ne=this.__v.__k[0].__c;this.__v.__k[0]=L(this.__b,re,ne.__O=ne.__P)}this.__b=null}var ie=ee.__a&&y$2(k$5,null,te.fallback);return ie&&(ie.__h=null),[y$2(k$5,null,ee.__a?null:te.children),ie]};var W=function(te,ee,re){if(++re[1]===re[0]&&te.o.delete(ee),te.props.revealOrder&&(te.props.revealOrder[0]!=="t"||!te.o.size))for(re=te.u;re;){for(;re.length>3;)re.pop()();if(re[1]<re[0])break;te.u=re=re[2]}};function P$1(te){return this.getChildContext=function(){return te.context},te.children}function j(te){var ee=this,re=te.i;ee.componentWillUnmount=function(){D$1(null,ee.l),ee.l=null,ee.i=null},ee.i&&ee.i!==re&&ee.componentWillUnmount(),te.__v?(ee.l||(ee.i=re,ee.l={nodeType:1,parentNode:re,childNodes:[],appendChild:function(ne){this.childNodes.push(ne),ee.i.appendChild(ne)},insertBefore:function(ne,ie){this.childNodes.push(ne),ee.i.appendChild(ne)},removeChild:function(ne){this.childNodes.splice(this.childNodes.indexOf(ne)>>>1,1),ee.i.removeChild(ne)}}),D$1(y$2(P$1,{context:ee.context},te.__v),ee.l)):ee.l&&ee.componentWillUnmount()}function z$1(te,ee){var re=y$2(j,{__v:te,i:ee});return re.containerInfo=ee,re}(V.prototype=new b$3).__a=function(te){var ee=this,re=F(ee.__v),ne=ee.o.get(te);return ne[0]++,function(ie){var se=function(){ee.props.revealOrder?(ne.push(ie),W(ee,te,ne)):ie()};re?re(se):se()}},V.prototype.render=function(te){this.u=null,this.o=new Map;var ee=S(te.children);te.revealOrder&&te.revealOrder[0]==="b"&&ee.reverse();for(var re=ee.length;re--;)this.o.set(ee[re],this.u=[1,0,this.u]);return te.children},V.prototype.componentDidUpdate=V.prototype.componentDidMount=function(){var te=this;this.o.forEach(function(ee,re){W(te,re,ee)})};var B=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,H=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,Z=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,Y=/[A-Z0-9]/g,$=typeof document<"u",q$3=function(te){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(te)};function G(te,ee,re){return ee.__k==null&&(ee.textContent=""),D$1(te,ee),typeof re=="function"&&re(),te?te.__c:null}function J(te,ee,re){return E$1(te,ee),typeof re=="function"&&re(),te?te.__c:null}b$3.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(te){Object.defineProperty(b$3.prototype,te,{configurable:!0,get:function(){return this["UNSAFE_"+te]},set:function(ee){Object.defineProperty(this,te,{configurable:!0,writable:!0,value:ee})}})});var K=l$4.event;function Q(){}function X(){return this.cancelBubble}function nn(){return this.defaultPrevented}l$4.event=function(te){return K&&(te=K(te)),te.persist=Q,te.isPropagationStopped=X,te.isDefaultPrevented=nn,te.nativeEvent=te};var tn,en={enumerable:!1,configurable:!0,get:function(){return this.class}},rn=l$4.vnode;l$4.vnode=function(te){typeof te.type=="string"&&function(ee){var re=ee.props,ne=ee.type,ie={};for(var se in re){var le=re[se];if(!(se==="value"&&"defaultValue"in re&&le==null||$&&se==="children"&&ne==="noscript"||se==="class"||se==="className")){var ue=se.toLowerCase();se==="defaultValue"&&"value"in re&&re.value==null?se="value":se==="download"&&le===!0?le="":ue==="ondoubleclick"?se="ondblclick":ue!=="onchange"||ne!=="input"&&ne!=="textarea"||q$3(re.type)?ue==="onfocus"?se="onfocusin":ue==="onblur"?se="onfocusout":Z.test(se)?se=ue:ne.indexOf("-")===-1&&H.test(se)?se=se.replace(Y,"-$&").toLowerCase():le===null&&(le=void 0):ue=se="oninput",ue==="oninput"&&ie[se=ue]&&(se="oninputCapture"),ie[se]=le}}ne=="select"&&ie.multiple&&Array.isArray(ie.value)&&(ie.value=S(re.children).forEach(function(ae){ae.props.selected=ie.value.indexOf(ae.props.value)!=-1})),ne=="select"&&ie.defaultValue!=null&&(ie.value=S(re.children).forEach(function(ae){ae.props.selected=ie.multiple?ie.defaultValue.indexOf(ae.props.value)!=-1:ie.defaultValue==ae.props.value})),re.class&&!re.className?(ie.class=re.class,Object.defineProperty(ie,"className",en)):(re.className&&!re.class||re.class&&re.className)&&(ie.class=ie.className=re.className),ee.props=ie}(te),te.$$typeof=B,rn&&rn(te)};var un=l$4.__r;l$4.__r=function(te){un&&un(te),tn=te.__c};var on=l$4.diffed;l$4.diffed=function(te){on&&on(te);var ee=te.props,re=te.__e;re!=null&&te.type==="textarea"&&"value"in ee&&ee.value!==re.value&&(re.value=ee.value==null?"":ee.value),tn=null};var ln={ReactCurrentDispatcher:{current:{readContext:function(te){return tn.__n[te.__c].props.value}}}},cn="17.0.2";function fn$1(te){return y$2.bind(null,te)}function an(te){return!!te&&te.$$typeof===B}function sn(te){return an(te)?F$2.apply(null,arguments):te}function hn(te){return!!te.__k&&(D$1(null,te),!0)}function vn(te){return te&&(te.base||te.nodeType===1&&te)||null}var dn=function(te,ee){return te(ee)},pn=function(te,ee){return te(ee)},mn=k$5;function yn(te){te()}function _n(te){return te}function bn(){return[!1,yn]}var Sn=y$1;function gn(te,ee){var re=ee(),ne=h$3({h:{__:re,v:ee}}),ie=ne[0].h,se=ne[1];return y$1(function(){ie.__=re,ie.v=ee,E(ie.__,ee())||se({h:ie})},[te,re,ee]),p$3(function(){return E(ie.__,ie.v())||se({h:ie}),te(function(){E(ie.__,ie.v())||se({h:ie})})},[te]),re}var Cn={useState:h$3,useId:V$1,useReducer:s,useEffect:p$3,useLayoutEffect:y$1,useInsertionEffect:Sn,useTransition:bn,useDeferredValue:_n,useSyncExternalStore:gn,startTransition:yn,useRef:_,useImperativeHandle:A$2,useMemo:F$1,useCallback:T$1,useContext:q$4,useDebugValue:x$2,version:"17.0.2",Children:O,render:G,hydrate:J,unmountComponentAtNode:hn,createPortal:z$1,createElement:y$2,createContext:G$1,createFactory:fn$1,cloneElement:sn,createRef:_$1,Fragment:k$5,isValidElement:an,findDOMNode:vn,Component:b$3,PureComponent:w$2,memo:x$1,forwardRef:k$2,flushSync:pn,unstable_batchedUpdates:dn,StrictMode:mn,Suspense:D,SuspenseList:V,lazy:M,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:ln};const React=Object.freeze(Object.defineProperty({__proto__:null,Children:O,Component:b$3,Fragment:k$5,PureComponent:w$2,StrictMode:mn,Suspense:D,SuspenseList:V,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:ln,cloneElement:sn,createContext:G$1,createElement:y$2,createFactory:fn$1,createPortal:z$1,createRef:_$1,default:Cn,findDOMNode:vn,flushSync:pn,forwardRef:k$2,hydrate:J,isValidElement:an,lazy:M,memo:x$1,render:G,startTransition:yn,unmountComponentAtNode:hn,unstable_batchedUpdates:dn,useCallback:T$1,useContext:q$4,useDebugValue:x$2,useDeferredValue:_n,useEffect:p$3,useErrorBoundary:P$2,useId:V$1,useImperativeHandle:A$2,useInsertionEffect:Sn,useLayoutEffect:y$1,useMemo:F$1,useReducer:s,useRef:_,useState:h$3,useSyncExternalStore:gn,useTransition:bn,version:cn},Symbol.toStringTag,{value:"Module"}));function _objectWithoutPropertiesLoose(te,ee){if(te==null)return{};var re={},ne=Object.keys(te),ie,se;for(se=0;se<ne.length;se++)ie=ne[se],!(ee.indexOf(ie)>=0)&&(re[ie]=te[ie]);return re}var reactIs$1={exports:{}},reactIs_production_min={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var b=typeof Symbol=="function"&&Symbol.for,c=b?Symbol.for("react.element"):60103,d=b?Symbol.for("react.portal"):60106,e$1=b?Symbol.for("react.fragment"):60107,f=b?Symbol.for("react.strict_mode"):60108,g=b?Symbol.for("react.profiler"):60114,h$2=b?Symbol.for("react.provider"):60109,k$1=b?Symbol.for("react.context"):60110,l$1=b?Symbol.for("react.async_mode"):60111,m$1=b?Symbol.for("react.concurrent_mode"):60111,n$2=b?Symbol.for("react.forward_ref"):60112,p$2=b?Symbol.for("react.suspense"):60113,q$2=b?Symbol.for("react.suspense_list"):60120,r$2=b?Symbol.for("react.memo"):60115,t$3=b?Symbol.for("react.lazy"):60116,v$1=b?Symbol.for("react.block"):60121,w$1=b?Symbol.for("react.fundamental"):60117,x=b?Symbol.for("react.responder"):60118,y=b?Symbol.for("react.scope"):60119;function z(te){if(typeof te=="object"&&te!==null){var ee=te.$$typeof;switch(ee){case c:switch(te=te.type,te){case l$1:case m$1:case e$1:case g:case f:case p$2:return te;default:switch(te=te&&te.$$typeof,te){case k$1:case n$2:case t$3:case r$2:case h$2:return te;default:return ee}}case d:return ee}}}function A(te){return z(te)===m$1}reactIs_production_min.AsyncMode=l$1;reactIs_production_min.ConcurrentMode=m$1;reactIs_production_min.ContextConsumer=k$1;reactIs_production_min.ContextProvider=h$2;reactIs_production_min.Element=c;reactIs_production_min.ForwardRef=n$2;reactIs_production_min.Fragment=e$1;reactIs_production_min.Lazy=t$3;reactIs_production_min.Memo=r$2;reactIs_production_min.Portal=d;reactIs_production_min.Profiler=g;reactIs_production_min.StrictMode=f;reactIs_production_min.Suspense=p$2;reactIs_production_min.isAsyncMode=function(te){return A(te)||z(te)===l$1};reactIs_production_min.isConcurrentMode=A;reactIs_production_min.isContextConsumer=function(te){return z(te)===k$1};reactIs_production_min.isContextProvider=function(te){return z(te)===h$2};reactIs_production_min.isElement=function(te){return typeof te=="object"&&te!==null&&te.$$typeof===c};reactIs_production_min.isForwardRef=function(te){return z(te)===n$2};reactIs_production_min.isFragment=function(te){return z(te)===e$1};reactIs_production_min.isLazy=function(te){return z(te)===t$3};reactIs_production_min.isMemo=function(te){return z(te)===r$2};reactIs_production_min.isPortal=function(te){return z(te)===d};reactIs_production_min.isProfiler=function(te){return z(te)===g};reactIs_production_min.isStrictMode=function(te){return z(te)===f};reactIs_production_min.isSuspense=function(te){return z(te)===p$2};reactIs_production_min.isValidElementType=function(te){return typeof te=="string"||typeof te=="function"||te===e$1||te===m$1||te===g||te===f||te===p$2||te===q$2||typeof te=="object"&&te!==null&&(te.$$typeof===t$3||te.$$typeof===r$2||te.$$typeof===h$2||te.$$typeof===k$1||te.$$typeof===n$2||te.$$typeof===w$1||te.$$typeof===x||te.$$typeof===y||te.$$typeof===v$1)};reactIs_production_min.typeOf=z;reactIs$1.exports=reactIs_production_min;var reactIsExports=reactIs$1.exports,reactIs=reactIsExports,REACT_STATICS={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},KNOWN_STATICS={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},FORWARD_REF_STATICS={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},MEMO_STATICS={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},TYPE_STATICS={};TYPE_STATICS[reactIs.ForwardRef]=FORWARD_REF_STATICS;TYPE_STATICS[reactIs.Memo]=MEMO_STATICS;function getStatics(te){return reactIs.isMemo(te)?MEMO_STATICS:TYPE_STATICS[te.$$typeof]||REACT_STATICS}var defineProperty=Object.defineProperty,getOwnPropertyNames=Object.getOwnPropertyNames,getOwnPropertySymbols=Object.getOwnPropertySymbols,getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor,getPrototypeOf=Object.getPrototypeOf,objectPrototype=Object.prototype;function hoistNonReactStatics(te,ee,re){if(typeof ee!="string"){if(objectPrototype){var ne=getPrototypeOf(ee);ne&&ne!==objectPrototype&&hoistNonReactStatics(te,ne,re)}var ie=getOwnPropertyNames(ee);getOwnPropertySymbols&&(ie=ie.concat(getOwnPropertySymbols(ee)));for(var se=getStatics(te),le=getStatics(ee),ue=0;ue<ie.length;++ue){var ae=ie[ue];if(!KNOWN_STATICS[ae]&&!(re&&re[ae])&&!(le&&le[ae])&&!(se&&se[ae])){var oe=getOwnPropertyDescriptor(ee,ae);try{defineProperty(te,ae,oe)}catch{}}}}return te}var hoistNonReactStatics_cjs=hoistNonReactStatics;const hoistNonReactStatics$1=getDefaultExportFromCjs(hoistNonReactStatics_cjs),require$$0$1=getAugmentedNamespace(React);function _typeof(te){"@babel/helpers - typeof";return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(ee){return typeof ee}:function(ee){return ee&&typeof Symbol=="function"&&ee.constructor===Symbol&&ee!==Symbol.prototype?"symbol":typeof ee},_typeof(te)}function _toPrimitive(te,ee){if(_typeof(te)!=="object"||te===null)return te;var re=te[Symbol.toPrimitive];if(re!==void 0){var ne=re.call(te,ee||"default");if(_typeof(ne)!=="object")return ne;throw new TypeError("@@toPrimitive must return a primitive value.")}return(ee==="string"?String:Number)(te)}function _toPropertyKey(te){var ee=_toPrimitive(te,"string");return _typeof(ee)==="symbol"?ee:String(ee)}const version$6="1.35.7",DEFAULT_HEADERS$4={"X-Client-Info":`supabase-js/${version$6}`},STORAGE_KEY$1="supabase.auth.token";function stripTrailingSlash(te){return te.replace(/\/$/,"")}const isBrowser$1=()=>typeof window<"u",version$5="1.24.0",GOTRUE_URL="http://localhost:9999",DEFAULT_HEADERS$3={"X-Client-Info":`gotrue-js/${version$5}`},EXPIRY_MARGIN=10,NETWORK_FAILURE={ERROR_MESSAGE:"Request Failed",MAX_RETRIES:10,RETRY_INTERVAL:2},STORAGE_KEY="supabase.auth.token",COOKIE_OPTIONS={name:"sb",lifetime:60*60*8,domain:"",path:"/",sameSite:"lax"};var __awaiter$c=globalThis&&globalThis.__awaiter||function(te,ee,re,ne){function ie(se){return se instanceof re?se:new re(function(le){le(se)})}return new(re||(re=Promise))(function(se,le){function ue(he){try{oe(ne.next(he))}catch(ce){le(ce)}}function ae(he){try{oe(ne.throw(he))}catch(ce){le(ce)}}function oe(he){he.done?se(he.value):ie(he.value).then(ue,ae)}oe((ne=ne.apply(te,ee||[])).next())})};const _getErrorMessage$1=te=>te.msg||te.message||te.error_description||te.error||JSON.stringify(te),handleError$1=(te,ee)=>{if(!(te!=null&&te.status))return ee({message:NETWORK_FAILURE.ERROR_MESSAGE});if(typeof te.json!="function")return ee(te);te.json().then(re=>ee({message:_getErrorMessage$1(re),status:(te==null?void 0:te.status)||500}))},_getRequestParams$1=(te,ee,re)=>{const ne={method:te,headers:(ee==null?void 0:ee.headers)||{}};return te==="GET"||(ne.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},ee==null?void 0:ee.headers),ne.body=JSON.stringify(re)),ne};function _handleRequest$1(te,ee,re,ne,ie){return __awaiter$c(this,void 0,void 0,function*(){return new Promise((se,le)=>{te(re,_getRequestParams$1(ee,ne,ie)).then(ue=>{if(!ue.ok)throw ue;return ne!=null&&ne.noResolveJson?se:ue.json()}).then(ue=>se(ue)).catch(ue=>handleError$1(ue,le))})})}function get$1(te,ee,re){return __awaiter$c(this,void 0,void 0,function*(){return _handleRequest$1(te,"GET",ee,re)})}function post$1(te,ee,re,ne){return __awaiter$c(this,void 0,void 0,function*(){return _handleRequest$1(te,"POST",ee,ne,re)})}function put$1(te,ee,re,ne){return __awaiter$c(this,void 0,void 0,function*(){return _handleRequest$1(te,"PUT",ee,ne,re)})}function remove$1(te,ee,re,ne){return __awaiter$c(this,void 0,void 0,function*(){return _handleRequest$1(te,"DELETE",ee,ne,re)})}function serialize(te,ee,re){const ne=re||{},ie=encodeURIComponent,se=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;if(typeof ie!="function")throw new TypeError("option encode is invalid");if(!se.test(te))throw new TypeError("argument name is invalid");const le=ie(ee);if(le&&!se.test(le))throw new TypeError("argument val is invalid");let ue=te+"="+le;if(ne.maxAge!=null){const ae=ne.maxAge-0;if(isNaN(ae)||!isFinite(ae))throw new TypeError("option maxAge is invalid");ue+="; Max-Age="+Math.floor(ae)}if(ne.domain){if(!se.test(ne.domain))throw new TypeError("option domain is invalid");ue+="; Domain="+ne.domain}if(ne.path){if(!se.test(ne.path))throw new TypeError("option path is invalid");ue+="; Path="+ne.path}if(ne.expires){if(typeof ne.expires.toUTCString!="function")throw new TypeError("option expires is invalid");ue+="; Expires="+ne.expires.toUTCString()}if(ne.httpOnly&&(ue+="; HttpOnly"),ne.secure&&(ue+="; Secure"),ne.sameSite)switch(typeof ne.sameSite=="string"?ne.sameSite.toLowerCase():ne.sameSite){case"lax":ue+="; SameSite=Lax";break;case"strict":ue+="; SameSite=Strict";break;case"none":ue+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return ue}function isSecureEnvironment(te){if(!te||!te.headers||!te.headers.host)throw new Error('The "host" request header is not available');const ee=te.headers.host.indexOf(":")>-1&&te.headers.host.split(":")[0]||te.headers.host;return!(["localhost","127.0.0.1"].indexOf(ee)>-1||ee.endsWith(".local"))}function serializeCookie(te,ee){var re,ne,ie;return serialize(te.name,te.value,{maxAge:te.maxAge,expires:new Date(Date.now()+te.maxAge*1e3),httpOnly:!0,secure:ee,path:(re=te.path)!==null&&re!==void 0?re:"/",domain:(ne=te.domain)!==null&&ne!==void 0?ne:"",sameSite:(ie=te.sameSite)!==null&&ie!==void 0?ie:"lax"})}function getCookieString(te,ee,re){const ne=re.map(se=>serializeCookie(se,isSecureEnvironment(te))),ie=ee.getHeader("Set-Cookie");return ie&&(ie instanceof Array?Array.prototype.push.apply(ne,ie):typeof ie=="string"&&ne.push(ie)),ne}function setCookies(te,ee,re){ee.setHeader("Set-Cookie",getCookieString(te,ee,re))}const scriptRel="modulepreload",assetsURL=function(te,ee){return new URL(te,ee).href},seen={},__vitePreload=function(ee,re,ne){if(!re||re.length===0)return ee();const ie=document.getElementsByTagName("link");return Promise.all(re.map(se=>{if(se=assetsURL(se,ne),se in seen)return;seen[se]=!0;const le=se.endsWith(".css"),ue=le?'[rel="stylesheet"]':"";if(!!ne)for(let he=ie.length-1;he>=0;he--){const ce=ie[he];if(ce.href===se&&(!le||ce.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${se}"]${ue}`))return;const oe=document.createElement("link");if(oe.rel=le?"stylesheet":scriptRel,le||(oe.as="script",oe.crossOrigin=""),oe.href=se,document.head.appendChild(oe),le)return new Promise((he,ce)=>{oe.addEventListener("load",he),oe.addEventListener("error",()=>ce(new Error(`Unable to preload CSS for ${se}`)))})})).then(()=>ee())};var __awaiter$b=globalThis&&globalThis.__awaiter||function(te,ee,re,ne){function ie(se){return se instanceof re?se:new re(function(le){le(se)})}return new(re||(re=Promise))(function(se,le){function ue(he){try{oe(ne.next(he))}catch(ce){le(ce)}}function ae(he){try{oe(ne.throw(he))}catch(ce){le(ce)}}function oe(he){he.done?se(he.value):ie(he.value).then(ue,ae)}oe((ne=ne.apply(te,ee||[])).next())})};function expiresAt(te){return Math.round(Date.now()/1e3)+te}function uuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(te){const ee=Math.random()*16|0;return(te=="x"?ee:ee&3|8).toString(16)})}const isBrowser=()=>typeof window<"u";function getParameterByName(te,ee){var re;ee||(ee=((re=window==null?void 0:window.location)===null||re===void 0?void 0:re.href)||""),te=te.replace(/[\[\]]/g,"\\$&");const ne=new RegExp("[?&#]"+te+"(=([^&#]*)|&|#|$)"),ie=ne.exec(ee);return ie?ie[2]?decodeURIComponent(ie[2].replace(/\+/g," ")):"":null}const resolveFetch$2=te=>{let ee;return te?ee=te:typeof fetch>"u"?ee=(...re)=>__awaiter$b(void 0,void 0,void 0,function*(){return yield(yield __vitePreload(()=>import("./browser-ponyfill-5f021805.js").then(ne=>ne.b),[],import.meta.url)).fetch(...re)}):ee=fetch,(...re)=>ee(...re)},setItemAsync=(te,ee,re)=>__awaiter$b(void 0,void 0,void 0,function*(){isBrowser()&&(yield te==null?void 0:te.setItem(ee,JSON.stringify(re)))}),getItemAsync=(te,ee)=>__awaiter$b(void 0,void 0,void 0,function*(){const re=isBrowser()&&(yield te==null?void 0:te.getItem(ee));if(!re)return null;try{return JSON.parse(re)}catch{return re}}),getItemSynchronously=(te,ee)=>{const re=isBrowser()&&(te==null?void 0:te.getItem(ee));if(!re||typeof re!="string")return null;try{return JSON.parse(re)}catch{return re}},removeItemAsync=(te,ee)=>__awaiter$b(void 0,void 0,void 0,function*(){isBrowser()&&(yield te==null?void 0:te.removeItem(ee))});var __awaiter$a=globalThis&&globalThis.__awaiter||function(te,ee,re,ne){function ie(se){return se instanceof re?se:new re(function(le){le(se)})}return new(re||(re=Promise))(function(se,le){function ue(he){try{oe(ne.next(he))}catch(ce){le(ce)}}function ae(he){try{oe(ne.throw(he))}catch(ce){le(ce)}}function oe(he){he.done?se(he.value):ie(he.value).then(ue,ae)}oe((ne=ne.apply(te,ee||[])).next())})};class GoTrueApi{constructor({url:ee="",headers:re={},cookieOptions:ne,fetch:ie}){this.url=ee,this.headers=re,this.cookieOptions=Object.assign(Object.assign({},COOKIE_OPTIONS),ne),this.fetch=resolveFetch$2(ie)}_createRequestHeaders(ee){const re=Object.assign({},this.headers);return re.Authorization=`Bearer ${ee}`,re}cookieName(){var ee;return(ee=this.cookieOptions.name)!==null&&ee!==void 0?ee:""}getUrlForProvider(ee,re){const ne=[`provider=${encodeURIComponent(ee)}`];if(re!=null&&re.redirectTo&&ne.push(`redirect_to=${encodeURIComponent(re.redirectTo)}`),re!=null&&re.scopes&&ne.push(`scopes=${encodeURIComponent(re.scopes)}`),re!=null&&re.queryParams){const ie=new URLSearchParams(re.queryParams);ne.push(`${ie}`)}return`${this.url}/authorize?${ne.join("&")}`}signUpWithEmail(ee,re,ne={}){return __awaiter$a(this,void 0,void 0,function*(){try{const ie=Object.assign({},this.headers);let se="";ne.redirectTo&&(se="?redirect_to="+encodeURIComponent(ne.redirectTo));const le=yield post$1(this.fetch,`${this.url}/signup${se}`,{email:ee,password:re,data:ne.data,gotrue_meta_security:{captcha_token:ne.captchaToken}},{headers:ie}),ue=Object.assign({},le);return ue.expires_in&&(ue.expires_at=expiresAt(le.expires_in)),{data:ue,error:null}}catch(ie){return{data:null,error:ie}}})}signInWithEmail(ee,re,ne={}){return __awaiter$a(this,void 0,void 0,function*(){try{const ie=Object.assign({},this.headers);let se="?grant_type=password";ne.redirectTo&&(se+="&redirect_to="+encodeURIComponent(ne.redirectTo));const le=yield post$1(this.fetch,`${this.url}/token${se}`,{email:ee,password:re,gotrue_meta_security:{captcha_token:ne.captchaToken}},{headers:ie}),ue=Object.assign({},le);return ue.expires_in&&(ue.expires_at=expiresAt(le.expires_in)),{data:ue,error:null}}catch(ie){return{data:null,error:ie}}})}signUpWithPhone(ee,re,ne={}){return __awaiter$a(this,void 0,void 0,function*(){try{const ie=Object.assign({},this.headers),se=yield post$1(this.fetch,`${this.url}/signup`,{phone:ee,password:re,data:ne.data,gotrue_meta_security:{captcha_token:ne.captchaToken}},{headers:ie}),le=Object.assign({},se);return le.expires_in&&(le.expires_at=expiresAt(se.expires_in)),{data:le,error:null}}catch(ie){return{data:null,error:ie}}})}signInWithPhone(ee,re,ne={}){return __awaiter$a(this,void 0,void 0,function*(){try{const ie=Object.assign({},this.headers),se="?grant_type=password",le=yield post$1(this.fetch,`${this.url}/token${se}`,{phone:ee,password:re,gotrue_meta_security:{captcha_token:ne.captchaToken}},{headers:ie}),ue=Object.assign({},le);return ue.expires_in&&(ue.expires_at=expiresAt(le.expires_in)),{data:ue,error:null}}catch(ie){return{data:null,error:ie}}})}signInWithOpenIDConnect({id_token:ee,nonce:re,client_id:ne,issuer:ie,provider:se}){return __awaiter$a(this,void 0,void 0,function*(){try{const le=Object.assign({},this.headers),ue="?grant_type=id_token",ae=yield post$1(this.fetch,`${this.url}/token${ue}`,{id_token:ee,nonce:re,client_id:ne,issuer:ie,provider:se},{headers:le}),oe=Object.assign({},ae);return oe.expires_in&&(oe.expires_at=expiresAt(ae.expires_in)),{data:oe,error:null}}catch(le){return{data:null,error:le}}})}sendMagicLinkEmail(ee,re={}){var ne;return __awaiter$a(this,void 0,void 0,function*(){try{const ie=Object.assign({},this.headers);let se="";re.redirectTo&&(se+="?redirect_to="+encodeURIComponent(re.redirectTo));const le=(ne=re.shouldCreateUser)!==null&&ne!==void 0?ne:!0;return{data:yield post$1(this.fetch,`${this.url}/otp${se}`,{email:ee,create_user:le,gotrue_meta_security:{captcha_token:re.captchaToken}},{headers:ie}),error:null}}catch(ie){return{data:null,error:ie}}})}sendMobileOTP(ee,re={}){var ne;return __awaiter$a(this,void 0,void 0,function*(){try{const ie=(ne=re.shouldCreateUser)!==null&&ne!==void 0?ne:!0,se=Object.assign({},this.headers);return{data:yield post$1(this.fetch,`${this.url}/otp`,{phone:ee,create_user:ie,gotrue_meta_security:{captcha_token:re.captchaToken}},{headers:se}),error:null}}catch(ie){return{data:null,error:ie}}})}signOut(ee){return __awaiter$a(this,void 0,void 0,function*(){try{return yield post$1(this.fetch,`${this.url}/logout`,{},{headers:this._createRequestHeaders(ee),noResolveJson:!0}),{error:null}}catch(re){return{error:re}}})}verifyMobileOTP(ee,re,ne={}){return __awaiter$a(this,void 0,void 0,function*(){try{const ie=Object.assign({},this.headers),se=yield post$1(this.fetch,`${this.url}/verify`,{phone:ee,token:re,type:"sms",redirect_to:ne.redirectTo},{headers:ie}),le=Object.assign({},se);return le.expires_in&&(le.expires_at=expiresAt(se.expires_in)),{data:le,error:null}}catch(ie){return{data:null,error:ie}}})}verifyOTP({email:ee,phone:re,token:ne,type:ie="sms"},se={}){return __awaiter$a(this,void 0,void 0,function*(){try{const le=Object.assign({},this.headers),ue=yield post$1(this.fetch,`${this.url}/verify`,{email:ee,phone:re,token:ne,type:ie,redirect_to:se.redirectTo},{headers:le}),ae=Object.assign({},ue);return ae.expires_in&&(ae.expires_at=expiresAt(ue.expires_in)),{data:ae,error:null}}catch(le){return{data:null,error:le}}})}inviteUserByEmail(ee,re={}){return __awaiter$a(this,void 0,void 0,function*(){try{const ne=Object.assign({},this.headers);let ie="";return re.redirectTo&&(ie+="?redirect_to="+encodeURIComponent(re.redirectTo)),{data:yield post$1(this.fetch,`${this.url}/invite${ie}`,{email:ee,data:re.data},{headers:ne}),error:null}}catch(ne){return{data:null,error:ne}}})}resetPasswordForEmail(ee,re={}){return __awaiter$a(this,void 0,void 0,function*(){try{const ne=Object.assign({},this.headers);let ie="";return re.redirectTo&&(ie+="?redirect_to="+encodeURIComponent(re.redirectTo)),{data:yield post$1(this.fetch,`${this.url}/recover${ie}`,{email:ee,gotrue_meta_security:{captcha_token:re.captchaToken}},{headers:ne}),error:null}}catch(ne){return{data:null,error:ne}}})}refreshAccessToken(ee){return __awaiter$a(this,void 0,void 0,function*(){try{const re=yield post$1(this.fetch,`${this.url}/token?grant_type=refresh_token`,{refresh_token:ee},{headers:this.headers}),ne=Object.assign({},re);return ne.expires_in&&(ne.expires_at=expiresAt(re.expires_in)),{data:ne,error:null}}catch(re){return{data:null,error:re}}})}setAuthCookie(ee,re){ee.method!=="POST"&&(re.setHeader("Allow","POST"),re.status(405).end("Method Not Allowed"));const{event:ne,session:ie}=ee.body;if(!ne)throw new Error("Auth event missing!");if(ne==="SIGNED_IN"){if(!ie)throw new Error("Auth session missing!");setCookies(ee,re,[{key:"access-token",value:ie.access_token},{key:"refresh-token",value:ie.refresh_token}].map(se=>{var le;return{name:`${this.cookieName()}-${se.key}`,value:se.value,domain:this.cookieOptions.domain,maxAge:(le=this.cookieOptions.lifetime)!==null&&le!==void 0?le:0,path:this.cookieOptions.path,sameSite:this.cookieOptions.sameSite}}))}ne==="SIGNED_OUT"&&setCookies(ee,re,["access-token","refresh-token"].map(se=>({name:`${this.cookieName()}-${se}`,value:"",maxAge:-1}))),re.status(200).json({})}deleteAuthCookie(ee,re,{redirectTo:ne="/"}){return setCookies(ee,re,["access-token","refresh-token"].map(ie=>({name:`${this.cookieName()}-${ie}`,value:"",maxAge:-1}))),re.redirect(307,ne)}getAuthCookieString(ee,re){ee.method!=="POST"&&(re.setHeader("Allow","POST"),re.status(405).end("Method Not Allowed"));const{event:ne,session:ie}=ee.body;if(!ne)throw new Error("Auth event missing!");if(ne==="SIGNED_IN"){if(!ie)throw new Error("Auth session missing!");return getCookieString(ee,re,[{key:"access-token",value:ie.access_token},{key:"refresh-token",value:ie.refresh_token}].map(se=>{var le;return{name:`${this.cookieName()}-${se.key}`,value:se.value,domain:this.cookieOptions.domain,maxAge:(le=this.cookieOptions.lifetime)!==null&&le!==void 0?le:0,path:this.cookieOptions.path,sameSite:this.cookieOptions.sameSite}}))}return ne==="SIGNED_OUT"?getCookieString(ee,re,["access-token","refresh-token"].map(se=>({name:`${this.cookieName()}-${se}`,value:"",maxAge:-1}))):re.getHeader("Set-Cookie")}generateLink(ee,re,ne={}){return __awaiter$a(this,void 0,void 0,function*(){try{return{data:yield post$1(this.fetch,`${this.url}/admin/generate_link`,{type:ee,email:re,password:ne.password,data:ne.data,redirect_to:ne.redirectTo},{headers:this.headers}),error:null}}catch(ie){return{data:null,error:ie}}})}createUser(ee){return __awaiter$a(this,void 0,void 0,function*(){try{const re=yield post$1(this.fetch,`${this.url}/admin/users`,ee,{headers:this.headers});return{user:re,data:re,error:null}}catch(re){return{user:null,data:null,error:re}}})}listUsers(){return __awaiter$a(this,void 0,void 0,function*(){try{return{data:(yield get$1(this.fetch,`${this.url}/admin/users`,{headers:this.headers})).users,error:null}}catch(ee){return{data:null,error:ee}}})}getUserById(ee){return __awaiter$a(this,void 0,void 0,function*(){try{return{data:yield get$1(this.fetch,`${this.url}/admin/users/${ee}`,{headers:this.headers}),error:null}}catch(re){return{data:null,error:re}}})}getUserByCookie(ee,re){return __awaiter$a(this,void 0,void 0,function*(){try{if(!ee.cookies)throw new Error("Not able to parse cookies! When using Express make sure the cookie-parser middleware is in use!");const ne=ee.cookies[`${this.cookieName()}-access-token`],ie=ee.cookies[`${this.cookieName()}-refresh-token`];if(!ne)throw new Error("No cookie found!");const{user:se,error:le}=yield this.getUser(ne);if(le){if(!ie)throw new Error("No refresh_token cookie found!");if(!re)throw new Error("You need to pass the res object to automatically refresh the session!");const{data:ue,error:ae}=yield this.refreshAccessToken(ie);if(ae)throw ae;if(ue)return setCookies(ee,re,[{key:"access-token",value:ue.access_token},{key:"refresh-token",value:ue.refresh_token}].map(oe=>{var he;return{name:`${this.cookieName()}-${oe.key}`,value:oe.value,domain:this.cookieOptions.domain,maxAge:(he=this.cookieOptions.lifetime)!==null&&he!==void 0?he:0,path:this.cookieOptions.path,sameSite:this.cookieOptions.sameSite}})),{token:ue.access_token,user:ue.user,data:ue.user,error:null}}return{token:ne,user:se,data:se,error:null}}catch(ne){return{token:null,user:null,data:null,error:ne}}})}updateUserById(ee,re){return __awaiter$a(this,void 0,void 0,function*(){try{const ne=yield put$1(this.fetch,`${this.url}/admin/users/${ee}`,re,{headers:this.headers});return{user:ne,data:ne,error:null}}catch(ne){return{user:null,data:null,error:ne}}})}deleteUser(ee){return __awaiter$a(this,void 0,void 0,function*(){try{const re=yield remove$1(this.fetch,`${this.url}/admin/users/${ee}`,{},{headers:this.headers});return{user:re,data:re,error:null}}catch(re){return{user:null,data:null,error:re}}})}getUser(ee){return __awaiter$a(this,void 0,void 0,function*(){try{const re=yield get$1(this.fetch,`${this.url}/user`,{headers:this._createRequestHeaders(ee)});return{user:re,data:re,error:null}}catch(re){return{user:null,data:null,error:re}}})}updateUser(ee,re){return __awaiter$a(this,void 0,void 0,function*(){try{const ne=yield put$1(this.fetch,`${this.url}/user`,re,{headers:this._createRequestHeaders(ee)});return{user:ne,data:ne,error:null}}catch(ne){return{user:null,data:null,error:ne}}})}}function polyfillGlobalThis(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}var __awaiter$9=globalThis&&globalThis.__awaiter||function(te,ee,re,ne){function ie(se){return se instanceof re?se:new re(function(le){le(se)})}return new(re||(re=Promise))(function(se,le){function ue(he){try{oe(ne.next(he))}catch(ce){le(ce)}}function ae(he){try{oe(ne.throw(he))}catch(ce){le(ce)}}function oe(he){he.done?se(he.value):ie(he.value).then(ue,ae)}oe((ne=ne.apply(te,ee||[])).next())})};polyfillGlobalThis();const DEFAULT_OPTIONS$1={url:GOTRUE_URL,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,multiTab:!0,headers:DEFAULT_HEADERS$3},decodeBase64URL=te=>{try{return atob(te.replace(/[-]/g,"+").replace(/[_]/g,"/"))}catch(ee){if(ee instanceof ReferenceError)return Buffer.from(te,"base64").toString("utf-8");throw ee}};class GoTrueClient{constructor(ee){this.stateChangeEmitters=new Map,this.networkRetries=0;const re=Object.assign(Object.assign({},DEFAULT_OPTIONS$1),ee);this.currentUser=null,this.currentSession=null,this.autoRefreshToken=re.autoRefreshToken,this.persistSession=re.persistSession,this.multiTab=re.multiTab,this.localStorage=re.localStorage||globalThis.localStorage,this.api=new GoTrueApi({url:re.url,headers:re.headers,cookieOptions:re.cookieOptions,fetch:re.fetch}),this._recoverSession(),this._recoverAndRefresh(),this._listenForMultiTabEvents(),this._handleVisibilityChange(),re.detectSessionInUrl&&isBrowser()&&getParameterByName("access_token")&&this.getSessionFromUrl({storeSession:!0}).then(({error:ne})=>{if(ne)throw new Error("Error getting session from URL.")})}signUp({email:ee,password:re,phone:ne},ie={}){return __awaiter$9(this,void 0,void 0,function*(){try{this._removeSession();const{data:se,error:le}=ne&&re?yield this.api.signUpWithPhone(ne,re,{data:ie.data,captchaToken:ie.captchaToken}):yield this.api.signUpWithEmail(ee,re,{redirectTo:ie.redirectTo,data:ie.data,captchaToken:ie.captchaToken});if(le)throw le;if(!se)throw"An error occurred on sign up.";let ue=null,ae=null;return se.access_token&&(ue=se,ae=ue.user,this._saveSession(ue),this._notifyAllSubscribers("SIGNED_IN")),se.id&&(ae=se),{user:ae,session:ue,error:null}}catch(se){return{user:null,session:null,error:se}}})}signIn({email:ee,phone:re,password:ne,refreshToken:ie,provider:se,oidc:le},ue={}){return __awaiter$9(this,void 0,void 0,function*(){try{if(this._removeSession(),ee&&!ne){const{error:ae}=yield this.api.sendMagicLinkEmail(ee,{redirectTo:ue.redirectTo,shouldCreateUser:ue.shouldCreateUser,captchaToken:ue.captchaToken});return{user:null,session:null,error:ae}}if(ee&&ne)return this._handleEmailSignIn(ee,ne,{redirectTo:ue.redirectTo,captchaToken:ue.captchaToken});if(re&&!ne){const{error:ae}=yield this.api.sendMobileOTP(re,{shouldCreateUser:ue.shouldCreateUser,captchaToken:ue.captchaToken});return{user:null,session:null,error:ae}}if(re&&ne)return this._handlePhoneSignIn(re,ne);if(ie){const{error:ae}=yield this._callRefreshToken(ie);if(ae)throw ae;return{user:this.currentUser,session:this.currentSession,error:null}}if(se)return this._handleProviderSignIn(se,{redirectTo:ue.redirectTo,scopes:ue.scopes,queryParams:ue.queryParams});if(le)return this._handleOpenIDConnectSignIn(le);throw new Error("You must provide either an email, phone number, a third-party provider or OpenID Connect.")}catch(ae){return{user:null,session:null,error:ae}}})}verifyOTP(ee,re={}){return __awaiter$9(this,void 0,void 0,function*(){try{this._removeSession();const{data:ne,error:ie}=yield this.api.verifyOTP(ee,re);if(ie)throw ie;if(!ne)throw"An error occurred on token verification.";let se=null,le=null;return ne.access_token&&(se=ne,le=se.user,this._saveSession(se),this._notifyAllSubscribers("SIGNED_IN")),ne.id&&(le=ne),{user:le,session:se,error:null}}catch(ne){return{user:null,session:null,error:ne}}})}user(){return this.currentUser}session(){return this.currentSession}refreshSession(){var ee;return __awaiter$9(this,void 0,void 0,function*(){try{if(!(!((ee=this.currentSession)===null||ee===void 0)&&ee.access_token))throw new Error("Not logged in.");const{error:re}=yield this._callRefreshToken();if(re)throw re;return{data:this.currentSession,user:this.currentUser,error:null}}catch(re){return{data:null,user:null,error:re}}})}update(ee){var re;return __awaiter$9(this,void 0,void 0,function*(){try{if(!(!((re=this.currentSession)===null||re===void 0)&&re.access_token))throw new Error("Not logged in.");const{user:ne,error:ie}=yield this.api.updateUser(this.currentSession.access_token,ee);if(ie)throw ie;if(!ne)throw Error("Invalid user data.");const se=Object.assign(Object.assign({},this.currentSession),{user:ne});return this._saveSession(se),this._notifyAllSubscribers("USER_UPDATED"),{data:ne,user:ne,error:null}}catch(ne){return{data:null,user:null,error:ne}}})}setSession(ee){return __awaiter$9(this,void 0,void 0,function*(){let re;if(typeof ee=="string"){const ne=ee,{data:ie,error:se}=yield this.api.refreshAccessToken(ne);if(se)return{session:null,error:se};re=ie}else{const ne=Math.round(Date.now()/1e3);let{refresh_token:ie,access_token:se}=ee,le=0,ue=0;const ae=se.split(".");if(ae.length!==3)throw new Error("access_token is not a proper JWT");const oe=decodeBase64URL(ae[1]);let he;try{he=JSON.parse(oe)}catch{throw new Error("access_token is not a proper JWT, invalid JSON in body")}if(typeof he=="object"&&he&&typeof he.exp=="number")le=he.exp,ue=ne-he.exp;else throw new Error("access_token is not a proper JWT, missing exp claim");if(ne>le){const{data:ce,error:pe}=yield this.api.refreshAccessToken(ie);if(pe)return{session:null,error:pe};re=ce}else{const{user:ce,error:pe}=yield this.api.getUser(se);if(pe)throw pe;re={access_token:se,expires_in:ue,expires_at:le,refresh_token:ie,token_type:"bearer",user:ce}}}try{return this._saveSession(re),this._notifyAllSubscribers("SIGNED_IN"),{session:re,error:null}}catch(ne){return{error:ne,session:null}}})}setAuth(ee){return this.currentSession=Object.assign(Object.assign({},this.currentSession),{access_token:ee,token_type:"bearer",user:this.user()}),this._notifyAllSubscribers("TOKEN_REFRESHED"),this.currentSession}getSessionFromUrl(ee){return __awaiter$9(this,void 0,void 0,function*(){try{if(!isBrowser())throw new Error("No browser detected.");const re=getParameterByName("error_description");if(re)throw new Error(re);const ne=getParameterByName("provider_token"),ie=getParameterByName("provider_refresh_token"),se=getParameterByName("access_token");if(!se)throw new Error("No access_token detected.");const le=getParameterByName("expires_in");if(!le)throw new Error("No expires_in detected.");const ue=getParameterByName("refresh_token");if(!ue)throw new Error("No refresh_token detected.");const ae=getParameterByName("token_type");if(!ae)throw new Error("No token_type detected.");const he=Math.round(Date.now()/1e3)+parseInt(le),{user:ce,error:pe}=yield this.api.getUser(se);if(pe)throw pe;const de={provider_token:ne,provider_refresh_token:ie,access_token:se,expires_in:parseInt(le),expires_at:he,refresh_token:ue,token_type:ae,user:ce};if(ee!=null&&ee.storeSession){this._saveSession(de);const me=getParameterByName("type");this._notifyAllSubscribers("SIGNED_IN"),me==="recovery"&&this._notifyAllSubscribers("PASSWORD_RECOVERY")}return window.location.hash="",{data:de,error:null}}catch(re){return{data:null,error:re}}})}signOut(){var ee;return __awaiter$9(this,void 0,void 0,function*(){const re=(ee=this.currentSession)===null||ee===void 0?void 0:ee.access_token;if(this._removeSession(),this._notifyAllSubscribers("SIGNED_OUT"),re){const{error:ne}=yield this.api.signOut(re);if(ne)return{error:ne}}return{error:null}})}onAuthStateChange(ee){try{const re=uuid(),ne={id:re,callback:ee,unsubscribe:()=>{this.stateChangeEmitters.delete(re)}};return this.stateChangeEmitters.set(re,ne),{data:ne,error:null}}catch(re){return{data:null,error:re}}}_handleEmailSignIn(ee,re,ne={}){var ie,se;return __awaiter$9(this,void 0,void 0,function*(){try{const{data:le,error:ue}=yield this.api.signInWithEmail(ee,re,{redirectTo:ne.redirectTo,captchaToken:ne.captchaToken});return ue||!le?{data:null,user:null,session:null,error:ue}:((!((ie=le==null?void 0:le.user)===null||ie===void 0)&&ie.confirmed_at||!((se=le==null?void 0:le.user)===null||se===void 0)&&se.email_confirmed_at)&&(this._saveSession(le),this._notifyAllSubscribers("SIGNED_IN")),{data:le,user:le.user,session:le,error:null})}catch(le){return{data:null,user:null,session:null,error:le}}})}_handlePhoneSignIn(ee,re,ne={}){var ie;return __awaiter$9(this,void 0,void 0,function*(){try{const{data:se,error:le}=yield this.api.signInWithPhone(ee,re,ne);return le||!se?{data:null,user:null,session:null,error:le}:(!((ie=se==null?void 0:se.user)===null||ie===void 0)&&ie.phone_confirmed_at&&(this._saveSession(se),this._notifyAllSubscribers("SIGNED_IN")),{data:se,user:se.user,session:se,error:null})}catch(se){return{data:null,user:null,session:null,error:se}}})}_handleProviderSignIn(ee,re={}){const ne=this.api.getUrlForProvider(ee,{redirectTo:re.redirectTo,scopes:re.scopes,queryParams:re.queryParams});try{return isBrowser()&&(window.location.href=ne),{provider:ee,url:ne,data:null,session:null,user:null,error:null}}catch(ie){return ne?{provider:ee,url:ne,data:null,session:null,user:null,error:null}:{data:null,user:null,session:null,error:ie}}}_handleOpenIDConnectSignIn({id_token:ee,nonce:re,client_id:ne,issuer:ie,provider:se}){return __awaiter$9(this,void 0,void 0,function*(){if(ee&&re&&(ne&&ie||se))try{const{data:le,error:ue}=yield this.api.signInWithOpenIDConnect({id_token:ee,nonce:re,client_id:ne,issuer:ie,provider:se});return ue||!le?{user:null,session:null,error:ue}:(this._saveSession(le),this._notifyAllSubscribers("SIGNED_IN"),{user:le.user,session:le,error:null})}catch(le){return{user:null,session:null,error:le}}throw new Error("You must provide a OpenID Connect provider with your id token and nonce.")})}_recoverSession(){try{const ee=getItemSynchronously(this.localStorage,STORAGE_KEY);if(!ee)return null;const{currentSession:re,expiresAt:ne}=ee,ie=Math.round(Date.now()/1e3);ne>=ie+EXPIRY_MARGIN&&(re!=null&&re.user)&&(this._saveSession(re),this._notifyAllSubscribers("SIGNED_IN"))}catch(ee){console.log("error",ee)}}_recoverAndRefresh(){return __awaiter$9(this,void 0,void 0,function*(){try{const ee=yield getItemAsync(this.localStorage,STORAGE_KEY);if(!ee)return null;const{currentSession:re,expiresAt:ne}=ee,ie=Math.round(Date.now()/1e3);if(ne<ie+EXPIRY_MARGIN)if(this.autoRefreshToken&&re.refresh_token){this.networkRetries++;const{error:se}=yield this._callRefreshToken(re.refresh_token);if(se){if(console.log(se.message),se.message===NETWORK_FAILURE.ERROR_MESSAGE&&this.networkRetries<NETWORK_FAILURE.MAX_RETRIES){this.refreshTokenTimer&&clearTimeout(this.refreshTokenTimer),this.refreshTokenTimer=setTimeout(()=>this._recoverAndRefresh(),Math.pow(NETWORK_FAILURE.RETRY_INTERVAL,this.networkRetries)*100);return}yield this._removeSession()}this.networkRetries=0}else this._removeSession();else re?(this._saveSession(re),this._notifyAllSubscribers("SIGNED_IN")):(console.log("Current session is missing data."),this._removeSession())}catch(ee){return console.error(ee),null}})}_callRefreshToken(ee){var re;return ee===void 0&&(ee=(re=this.currentSession)===null||re===void 0?void 0:re.refresh_token),__awaiter$9(this,void 0,void 0,function*(){try{if(!ee)throw new Error("No current session.");const{data:ne,error:ie}=yield this.api.refreshAccessToken(ee);if(ie)throw ie;if(!ne)throw Error("Invalid session data.");return this._saveSession(ne),this._notifyAllSubscribers("TOKEN_REFRESHED"),this._notifyAllSubscribers("SIGNED_IN"),{data:ne,error:null}}catch(ne){return{data:null,error:ne}}})}_notifyAllSubscribers(ee){this.stateChangeEmitters.forEach(re=>re.callback(ee,this.currentSession))}_saveSession(ee){this.currentSession=ee,this.currentUser=ee.user;const re=ee.expires_at;if(re){const ne=Math.round(Date.now()/1e3),ie=re-ne,se=ie>EXPIRY_MARGIN?EXPIRY_MARGIN:.5;this._startAutoRefreshToken((ie-se)*1e3)}this.persistSession&&ee.expires_at&&this._persistSession(this.currentSession)}_persistSession(ee){const re={currentSession:ee,expiresAt:ee.expires_at};setItemAsync(this.localStorage,STORAGE_KEY,re)}_removeSession(){return __awaiter$9(this,void 0,void 0,function*(){this.currentSession=null,this.currentUser=null,this.refreshTokenTimer&&clearTimeout(this.refreshTokenTimer),removeItemAsync(this.localStorage,STORAGE_KEY)})}_startAutoRefreshToken(ee){this.refreshTokenTimer&&clearTimeout(this.refreshTokenTimer),!(ee<=0||!this.autoRefreshToken)&&(this.refreshTokenTimer=setTimeout(()=>__awaiter$9(this,void 0,void 0,function*(){this.networkRetries++;const{error:re}=yield this._callRefreshToken();re||(this.networkRetries=0),(re==null?void 0:re.message)===NETWORK_FAILURE.ERROR_MESSAGE&&this.networkRetries<NETWORK_FAILURE.MAX_RETRIES&&this._startAutoRefreshToken(Math.pow(NETWORK_FAILURE.RETRY_INTERVAL,this.networkRetries)*100)}),ee),typeof this.refreshTokenTimer.unref=="function"&&this.refreshTokenTimer.unref())}_listenForMultiTabEvents(){if(!this.multiTab||!isBrowser()||!(window!=null&&window.addEventListener))return!1;try{window==null||window.addEventListener("storage",ee=>{var re;if(ee.key===STORAGE_KEY){const ne=JSON.parse(String(ee.newValue));!((re=ne==null?void 0:ne.currentSession)===null||re===void 0)&&re.access_token?(this._saveSession(ne.currentSession),this._notifyAllSubscribers("SIGNED_IN")):(this._removeSession(),this._notifyAllSubscribers("SIGNED_OUT"))}})}catch(ee){console.error("_listenForMultiTabEvents",ee)}}_handleVisibilityChange(){if(!this.multiTab||!isBrowser()||!(window!=null&&window.addEventListener))return!1;try{window==null||window.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&this._recoverAndRefresh()})}catch(ee){console.error("_handleVisibilityChange",ee)}}}class SupabaseAuthClient extends GoTrueClient{constructor(ee){super(ee)}}var __awaiter$8=globalThis&&globalThis.__awaiter||function(te,ee,re,ne){function ie(se){return se instanceof re?se:new re(function(le){le(se)})}return new(re||(re=Promise))(function(se,le){function ue(he){try{oe(ne.next(he))}catch(ce){le(ce)}}function ae(he){try{oe(ne.throw(he))}catch(ce){le(ce)}}function oe(he){he.done?se(he.value):ie(he.value).then(ue,ae)}oe((ne=ne.apply(te,ee||[])).next())})};class PostgrestBuilder{constructor(ee){Object.assign(this,ee);let re;ee.fetch?re=ee.fetch:typeof fetch>"u"?re=(...ne)=>__awaiter$8(this,void 0,void 0,function*(){return yield(yield __vitePreload(()=>import("./browser-ponyfill-5f021805.js").then(ie=>ie.b),[],import.meta.url)).fetch(...ne)}):re=fetch,this.fetch=(...ne)=>re(...ne),this.shouldThrowOnError=ee.shouldThrowOnError||!1,this.allowEmpty=ee.allowEmpty||!1}throwOnError(ee){return ee==null&&(ee=!0),this.shouldThrowOnError=ee,this}then(ee,re){typeof this.schema>"u"||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");let ne=this.fetch(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(ie=>__awaiter$8(this,void 0,void 0,function*(){var se,le,ue,ae;let oe=null,he=null,ce=null,pe=ie.status,de=ie.statusText;if(ie.ok){const ve=(se=this.headers.Prefer)===null||se===void 0?void 0:se.split(",").includes("return=minimal");if(this.method!=="HEAD"&&!ve){const _e=yield ie.text();_e&&(this.headers.Accept==="text/csv"?he=_e:he=JSON.parse(_e))}const we=(le=this.headers.Prefer)===null||le===void 0?void 0:le.match(/count=(exact|planned|estimated)/),ge=(ue=ie.headers.get("content-range"))===null||ue===void 0?void 0:ue.split("/");we&&ge&&ge.length>1&&(ce=parseInt(ge[1]))}else{const ve=yield ie.text();try{oe=JSON.parse(ve)}catch{oe={message:ve}}if(oe&&this.allowEmpty&&(!((ae=oe==null?void 0:oe.details)===null||ae===void 0)&&ae.includes("Results contain 0 rows"))&&(oe=null,pe=200,de="OK"),oe&&this.shouldThrowOnError)throw oe}return{error:oe,data:he,count:ce,status:pe,statusText:de,body:he}}));return this.shouldThrowOnError||(ne=ne.catch(ie=>({error:{message:`FetchError: ${ie.message}`,details:"",hint:"",code:ie.code||""},data:null,body:null,count:null,status:400,statusText:"Bad Request"}))),ne.then(ee,re)}}class PostgrestTransformBuilder extends PostgrestBuilder{select(ee="*"){let re=!1;const ne=ee.split("").map(ie=>/\s/.test(ie)&&!re?"":(ie==='"'&&(re=!re),ie)).join("");return this.url.searchParams.set("select",ne),this}order(ee,{ascending:re=!0,nullsFirst:ne=!1,foreignTable:ie}={}){const se=typeof ie>"u"?"order":`${ie}.order`,le=this.url.searchParams.get(se);return this.url.searchParams.set(se,`${le?`${le},`:""}${ee}.${re?"asc":"desc"}.${ne?"nullsfirst":"nullslast"}`),this}limit(ee,{foreignTable:re}={}){const ne=typeof re>"u"?"limit":`${re}.limit`;return this.url.searchParams.set(ne,`${ee}`),this}range(ee,re,{foreignTable:ne}={}){const ie=typeof ne>"u"?"offset":`${ne}.offset`,se=typeof ne>"u"?"limit":`${ne}.limit`;return this.url.searchParams.set(ie,`${ee}`),this.url.searchParams.set(se,`${re-ee+1}`),this}abortSignal(ee){return this.signal=ee,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.headers.Accept="application/vnd.pgrst.object+json",this.allowEmpty=!0,this}csv(){return this.headers.Accept="text/csv",this}}class PostgrestFilterBuilder extends PostgrestTransformBuilder{constructor(){super(...arguments),this.cs=this.contains,this.cd=this.containedBy,this.sl=this.rangeLt,this.sr=this.rangeGt,this.nxl=this.rangeGte,this.nxr=this.rangeLte,this.adj=this.rangeAdjacent,this.ov=this.overlaps}not(ee,re,ne){return this.url.searchParams.append(`${ee}`,`not.${re}.${ne}`),this}or(ee,{foreignTable:re}={}){const ne=typeof re>"u"?"or":`${re}.or`;return this.url.searchParams.append(ne,`(${ee})`),this}eq(ee,re){return this.url.searchParams.append(`${ee}`,`eq.${re}`),this}neq(ee,re){return this.url.searchParams.append(`${ee}`,`neq.${re}`),this}gt(ee,re){return this.url.searchParams.append(`${ee}`,`gt.${re}`),this}gte(ee,re){return this.url.searchParams.append(`${ee}`,`gte.${re}`),this}lt(ee,re){return this.url.searchParams.append(`${ee}`,`lt.${re}`),this}lte(ee,re){return this.url.searchParams.append(`${ee}`,`lte.${re}`),this}like(ee,re){return this.url.searchParams.append(`${ee}`,`like.${re}`),this}ilike(ee,re){return this.url.searchParams.append(`${ee}`,`ilike.${re}`),this}is(ee,re){return this.url.searchParams.append(`${ee}`,`is.${re}`),this}in(ee,re){const ne=re.map(ie=>typeof ie=="string"&&new RegExp("[,()]").test(ie)?`"${ie}"`:`${ie}`).join(",");return this.url.searchParams.append(`${ee}`,`in.(${ne})`),this}contains(ee,re){return typeof re=="string"?this.url.searchParams.append(`${ee}`,`cs.${re}`):Array.isArray(re)?this.url.searchParams.append(`${ee}`,`cs.{${re.join(",")}}`):this.url.searchParams.append(`${ee}`,`cs.${JSON.stringify(re)}`),this}containedBy(ee,re){return typeof re=="string"?this.url.searchParams.append(`${ee}`,`cd.${re}`):Array.isArray(re)?this.url.searchParams.append(`${ee}`,`cd.{${re.join(",")}}`):this.url.searchParams.append(`${ee}`,`cd.${JSON.stringify(re)}`),this}rangeLt(ee,re){return this.url.searchParams.append(`${ee}`,`sl.${re}`),this}rangeGt(ee,re){return this.url.searchParams.append(`${ee}`,`sr.${re}`),this}rangeGte(ee,re){return this.url.searchParams.append(`${ee}`,`nxl.${re}`),this}rangeLte(ee,re){return this.url.searchParams.append(`${ee}`,`nxr.${re}`),this}rangeAdjacent(ee,re){return this.url.searchParams.append(`${ee}`,`adj.${re}`),this}overlaps(ee,re){return typeof re=="string"?this.url.searchParams.append(`${ee}`,`ov.${re}`):this.url.searchParams.append(`${ee}`,`ov.{${re.join(",")}}`),this}textSearch(ee,re,{config:ne,type:ie=null}={}){let se="";ie==="plain"?se="pl":ie==="phrase"?se="ph":ie==="websearch"&&(se="w");const le=ne===void 0?"":`(${ne})`;return this.url.searchParams.append(`${ee}`,`${se}fts${le}.${re}`),this}fts(ee,re,{config:ne}={}){const ie=typeof ne>"u"?"":`(${ne})`;return this.url.searchParams.append(`${ee}`,`fts${ie}.${re}`),this}plfts(ee,re,{config:ne}={}){const ie=typeof ne>"u"?"":`(${ne})`;return this.url.searchParams.append(`${ee}`,`plfts${ie}.${re}`),this}phfts(ee,re,{config:ne}={}){const ie=typeof ne>"u"?"":`(${ne})`;return this.url.searchParams.append(`${ee}`,`phfts${ie}.${re}`),this}wfts(ee,re,{config:ne}={}){const ie=typeof ne>"u"?"":`(${ne})`;return this.url.searchParams.append(`${ee}`,`wfts${ie}.${re}`),this}filter(ee,re,ne){return this.url.searchParams.append(`${ee}`,`${re}.${ne}`),this}match(ee){return Object.keys(ee).forEach(re=>{this.url.searchParams.append(`${re}`,`eq.${ee[re]}`)}),this}}class PostgrestQueryBuilder extends PostgrestBuilder{constructor(ee,{headers:re={},schema:ne,fetch:ie,shouldThrowOnError:se}={}){super({fetch:ie,shouldThrowOnError:se}),this.url=new URL(ee),this.headers=Object.assign({},re),this.schema=ne}select(ee="*",{head:re=!1,count:ne=null}={}){this.method="GET";let ie=!1;const se=ee.split("").map(le=>/\s/.test(le)&&!ie?"":(le==='"'&&(ie=!ie),le)).join("");return this.url.searchParams.set("select",se),ne&&(this.headers.Prefer=`count=${ne}`),re&&(this.method="HEAD"),new PostgrestFilterBuilder(this)}insert(ee,{upsert:re=!1,onConflict:ne,returning:ie="representation",count:se=null}={}){this.method="POST";const le=[`return=${ie}`];if(re&&le.push("resolution=merge-duplicates"),re&&ne!==void 0&&this.url.searchParams.set("on_conflict",ne),this.body=ee,se&&le.push(`count=${se}`),this.headers.Prefer&&le.unshift(this.headers.Prefer),this.headers.Prefer=le.join(","),Array.isArray(ee)){const ue=ee.reduce((ae,oe)=>ae.concat(Object.keys(oe)),[]);if(ue.length>0){const ae=[...new Set(ue)].map(oe=>`"${oe}"`);this.url.searchParams.set("columns",ae.join(","))}}return new PostgrestFilterBuilder(this)}upsert(ee,{onConflict:re,returning:ne="representation",count:ie=null,ignoreDuplicates:se=!1}={}){this.method="POST";const le=[`resolution=${se?"ignore":"merge"}-duplicates`,`return=${ne}`];return re!==void 0&&this.url.searchParams.set("on_conflict",re),this.body=ee,ie&&le.push(`count=${ie}`),this.headers.Prefer&&le.unshift(this.headers.Prefer),this.headers.Prefer=le.join(","),new PostgrestFilterBuilder(this)}update(ee,{returning:re="representation",count:ne=null}={}){this.method="PATCH";const ie=[`return=${re}`];return this.body=ee,ne&&ie.push(`count=${ne}`),this.headers.Prefer&&ie.unshift(this.headers.Prefer),this.headers.Prefer=ie.join(","),new PostgrestFilterBuilder(this)}delete({returning:ee="representation",count:re=null}={}){this.method="DELETE";const ne=[`return=${ee}`];return re&&ne.push(`count=${re}`),this.headers.Prefer&&ne.unshift(this.headers.Prefer),this.headers.Prefer=ne.join(","),new PostgrestFilterBuilder(this)}}class PostgrestRpcBuilder extends PostgrestBuilder{constructor(ee,{headers:re={},schema:ne,fetch:ie,shouldThrowOnError:se}={}){super({fetch:ie,shouldThrowOnError:se}),this.url=new URL(ee),this.headers=Object.assign({},re),this.schema=ne}rpc(ee,{head:re=!1,count:ne=null}={}){return re?(this.method="HEAD",ee&&Object.entries(ee).forEach(([ie,se])=>{this.url.searchParams.append(ie,se)})):(this.method="POST",this.body=ee),ne&&(this.headers.Prefer!==void 0?this.headers.Prefer+=`,count=${ne}`:this.headers.Prefer=`count=${ne}`),new PostgrestFilterBuilder(this)}}const version$4="0.37.4",DEFAULT_HEADERS$2={"X-Client-Info":`postgrest-js/${version$4}`};class PostgrestClient{constructor(ee,{headers:re={},schema:ne,fetch:ie,throwOnError:se}={}){this.url=ee,this.headers=Object.assign(Object.assign({},DEFAULT_HEADERS$2),re),this.schema=ne,this.fetch=ie,this.shouldThrowOnError=se}auth(ee){return this.headers.Authorization=`Bearer ${ee}`,this}from(ee){const re=`${this.url}/${ee}`;return new PostgrestQueryBuilder(re,{headers:this.headers,schema:this.schema,fetch:this.fetch,shouldThrowOnError:this.shouldThrowOnError})}rpc(ee,re,{head:ne=!1,count:ie=null}={}){const se=`${this.url}/rpc/${ee}`;return new PostgrestRpcBuilder(se,{headers:this.headers,schema:this.schema,fetch:this.fetch,shouldThrowOnError:this.shouldThrowOnError}).rpc(re,{head:ne,count:ie})}}var PostgresTypes;(function(te){te.abstime="abstime",te.bool="bool",te.date="date",te.daterange="daterange",te.float4="float4",te.float8="float8",te.int2="int2",te.int4="int4",te.int4range="int4range",te.int8="int8",te.int8range="int8range",te.json="json",te.jsonb="jsonb",te.money="money",te.numeric="numeric",te.oid="oid",te.reltime="reltime",te.text="text",te.time="time",te.timestamp="timestamp",te.timestamptz="timestamptz",te.timetz="timetz",te.tsrange="tsrange",te.tstzrange="tstzrange"})(PostgresTypes||(PostgresTypes={}));const convertChangeData=(te,ee,re={})=>{var ne;const ie=(ne=re.skipTypes)!==null&&ne!==void 0?ne:[];return Object.keys(ee).reduce((se,le)=>(se[le]=convertColumn(le,te,ee,ie),se),{})},convertColumn=(te,ee,re,ne)=>{const ie=ee.find(ue=>ue.name===te),se=ie==null?void 0:ie.type,le=re[te];return se&&!ne.includes(se)?convertCell(se,le):noop$1(le)},convertCell=(te,ee)=>{if(te.charAt(0)==="_"){const re=te.slice(1,te.length);return toArray(ee,re)}switch(te){case PostgresTypes.bool:return toBoolean(ee);case PostgresTypes.float4:case PostgresTypes.float8:case PostgresTypes.int2:case PostgresTypes.int4:case PostgresTypes.int8:case PostgresTypes.numeric:case PostgresTypes.oid:return toNumber(ee);case PostgresTypes.json:case PostgresTypes.jsonb:return toJson(ee);case PostgresTypes.timestamp:return toTimestampString(ee);case PostgresTypes.abstime:case PostgresTypes.date:case PostgresTypes.daterange:case PostgresTypes.int4range:case PostgresTypes.int8range:case PostgresTypes.money:case PostgresTypes.reltime:case PostgresTypes.text:case PostgresTypes.time:case PostgresTypes.timestamptz:case PostgresTypes.timetz:case PostgresTypes.tsrange:case PostgresTypes.tstzrange:return noop$1(ee);default:return noop$1(ee)}},noop$1=te=>te,toBoolean=te=>{switch(te){case"t":return!0;case"f":return!1;default:return te}},toNumber=te=>{if(typeof te=="string"){const ee=parseFloat(te);if(!Number.isNaN(ee))return ee}return te},toJson=te=>{if(typeof te=="string")try{return JSON.parse(te)}catch(ee){return console.log(`JSON parse error: ${ee}`),te}return te},toArray=(te,ee)=>{if(typeof te!="string")return te;const re=te.length-1,ne=te[re];if(te[0]==="{"&&ne==="}"){let se;const le=te.slice(1,re);try{se=JSON.parse("["+le+"]")}catch{se=le?le.split(","):[]}return se.map(ue=>convertCell(ee,ue))}return te},toTimestampString=te=>typeof te=="string"?te.replace(" ","T"):te;var global$1,hasRequiredGlobal;function requireGlobal(){if(hasRequiredGlobal)return global$1;hasRequiredGlobal=1;var te=function(){if(typeof self=="object"&&self)return self;if(typeof window=="object"&&window)return window;throw new Error("Unable to resolve global `this`")};return global$1=function(){if(this)return this;if(typeof globalThis=="object"&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch{return te()}try{return __global__||te()}finally{delete Object.prototype.__global__}}(),global$1}const name="websocket",description="Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",keywords=["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],author="Brian McKelvey <theturtle32@gmail.com> (https://github.com/theturtle32)",contributors=["Iaki Baz Castillo <ibc@aliax.net> (http://dev.sipdoc.net)"],version$3="1.0.34",repository={type:"git",url:"https://github.com/theturtle32/WebSocket-Node.git"},homepage="https://github.com/theturtle32/WebSocket-Node",engines={node:">=4.0.0"},dependencies={bufferutil:"^4.0.1",debug:"^2.2.0","es5-ext":"^0.10.50","typedarray-to-buffer":"^3.1.5","utf-8-validate":"^5.0.2",yaeti:"^0.0.6"},devDependencies={"buffer-equal":"^1.0.0",gulp:"^4.0.2","gulp-jshint":"^2.0.4","jshint-stylish":"^2.2.1",jshint:"^2.0.0",tape:"^4.9.1"},config={verbose:!1},scripts={test:"tape test/unit/*.js",gulp:"gulp"},main="index",directories={lib:"./lib"},browser$1="lib/browser.js",license="Apache-2.0",require$$0={name,description,keywords,author,contributors,version:version$3,repository,homepage,engines,dependencies,devDependencies,config,scripts,main,directories,browser:browser$1,license};var version$2=require$$0.version,_globalThis;if(typeof globalThis=="object")_globalThis=globalThis;else try{_globalThis=requireGlobal()}catch{}finally{if(!_globalThis&&typeof window<"u"&&(_globalThis=window),!_globalThis)throw new Error("Could not determine global this")}var NativeWebSocket=_globalThis.WebSocket||_globalThis.MozWebSocket,websocket_version=version$2;function W3CWebSocket(te,ee){var re;return ee?re=new NativeWebSocket(te,ee):re=new NativeWebSocket(te),re}NativeWebSocket&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(te){Object.defineProperty(W3CWebSocket,te,{get:function(){return NativeWebSocket[te]}})});var browser={w3cwebsocket:NativeWebSocket?W3CWebSocket:null,version:websocket_version};const version$1="1.7.5",DEFAULT_HEADERS$1={"X-Client-Info":`realtime-js/${version$1}`},VSN="1.0.0",DEFAULT_TIMEOUT=1e4,WS_CLOSE_NORMAL=1e3;var SOCKET_STATES;(function(te){te[te.connecting=0]="connecting",te[te.open=1]="open",te[te.closing=2]="closing",te[te.closed=3]="closed"})(SOCKET_STATES||(SOCKET_STATES={}));var CHANNEL_STATES;(function(te){te.closed="closed",te.errored="errored",te.joined="joined",te.joining="joining",te.leaving="leaving"})(CHANNEL_STATES||(CHANNEL_STATES={}));var CHANNEL_EVENTS;(function(te){te.close="phx_close",te.error="phx_error",te.join="phx_join",te.reply="phx_reply",te.leave="phx_leave",te.access_token="access_token"})(CHANNEL_EVENTS||(CHANNEL_EVENTS={}));var TRANSPORTS;(function(te){te.websocket="websocket"})(TRANSPORTS||(TRANSPORTS={}));var CONNECTION_STATE;(function(te){te.Connecting="connecting",te.Open="open",te.Closing="closing",te.Closed="closed"})(CONNECTION_STATE||(CONNECTION_STATE={}));class Timer{constructor(ee,re){this.callback=ee,this.timerCalc=re,this.timer=void 0,this.tries=0,this.callback=ee,this.timerCalc=re}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}class Serializer{constructor(){this.HEADER_LENGTH=1}decode(ee,re){return ee.constructor===ArrayBuffer?re(this._binaryDecode(ee)):re(typeof ee=="string"?JSON.parse(ee):{})}_binaryDecode(ee){const re=new DataView(ee),ne=new TextDecoder;return this._decodeBroadcast(ee,re,ne)}_decodeBroadcast(ee,re,ne){const ie=re.getUint8(1),se=re.getUint8(2);let le=this.HEADER_LENGTH+2;const ue=ne.decode(ee.slice(le,le+ie));le=le+ie;const ae=ne.decode(ee.slice(le,le+se));le=le+se;const oe=JSON.parse(ne.decode(ee.slice(le,ee.byteLength)));return{ref:null,topic:ue,event:ae,payload:oe}}}class Push{constructor(ee,re,ne={},ie=DEFAULT_TIMEOUT){this.channel=ee,this.event=re,this.payload=ne,this.timeout=ie,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(ee){this.timeout=ee,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel.joinRef()}))}updatePayload(ee){this.payload=Object.assign(Object.assign({},this.payload),ee)}receive(ee,re){var ne;return this._hasReceived(ee)&&re((ne=this.receivedResp)===null||ne===void 0?void 0:ne.response),this.recHooks.push({status:ee,callback:re}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket.makeRef(),this.refEvent=this.channel.replyEventName(this.ref);const ee=re=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=re,this._matchReceive(re)};this.channel.on(this.refEvent,ee),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(ee,re){this.refEvent&&this.channel.trigger(this.refEvent,{status:ee,response:re})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel.off(this.refEvent)}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:ee,response:re}){this.recHooks.filter(ne=>ne.status===ee).forEach(ne=>ne.callback(re))}_hasReceived(ee){return this.receivedResp&&this.receivedResp.status===ee}}class RealtimeSubscription{constructor(ee,re={},ne){this.topic=ee,this.params=re,this.socket=ne,this.bindings=[],this.state=CHANNEL_STATES.closed,this.joinedOnce=!1,this.pushBuffer=[],this.timeout=this.socket.timeout,this.joinPush=new Push(this,CHANNEL_EVENTS.join,this.params,this.timeout),this.rejoinTimer=new Timer(()=>this.rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=CHANNEL_STATES.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(ie=>ie.send()),this.pushBuffer=[]}),this.onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this.joinRef()}`),this.state=CHANNEL_STATES.closed,this.socket.remove(this)}),this.onError(ie=>{this.isLeaving()||this.isClosed()||(this.socket.log("channel",`error ${this.topic}`,ie),this.state=CHANNEL_STATES.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this.isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=CHANNEL_STATES.errored,this.rejoinTimer.scheduleTimeout())}),this.on(CHANNEL_EVENTS.reply,(ie,se)=>{this.trigger(this.replyEventName(se),ie)})}rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this.rejoin()}subscribe(ee=this.timeout){if(this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";return this.joinedOnce=!0,this.rejoin(ee),this.joinPush}onClose(ee){this.on(CHANNEL_EVENTS.close,ee)}onError(ee){this.on(CHANNEL_EVENTS.error,re=>ee(re))}on(ee,re){this.bindings.push({event:ee,callback:re})}off(ee){this.bindings=this.bindings.filter(re=>re.event!==ee)}canPush(){return this.socket.isConnected()&&this.isJoined()}push(ee,re,ne=this.timeout){if(!this.joinedOnce)throw`tried to push '${ee}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let ie=new Push(this,ee,re,ne);return this.canPush()?ie.send():(ie.startTimeout(),this.pushBuffer.push(ie)),ie}updateJoinPayload(ee){this.joinPush.updatePayload(ee)}unsubscribe(ee=this.timeout){this.state=CHANNEL_STATES.leaving;let re=()=>{this.socket.log("channel",`leave ${this.topic}`),this.trigger(CHANNEL_EVENTS.close,"leave",this.joinRef())};this.joinPush.destroy();let ne=new Push(this,CHANNEL_EVENTS.leave,{},ee);return ne.receive("ok",()=>re()).receive("timeout",()=>re()),ne.send(),this.canPush()||ne.trigger("ok",{}),ne}onMessage(ee,re,ne){return re}isMember(ee){return this.topic===ee}joinRef(){return this.joinPush.ref}rejoin(ee=this.timeout){this.isLeaving()||(this.socket.leaveOpenTopic(this.topic),this.state=CHANNEL_STATES.joining,this.joinPush.resend(ee))}trigger(ee,re,ne){let{close:ie,error:se,leave:le,join:ue}=CHANNEL_EVENTS;if(ne&&[ie,se,le,ue].indexOf(ee)>=0&&ne!==this.joinRef())return;let oe=this.onMessage(ee,re,ne);if(re&&!oe)throw"channel onMessage callbacks must return the payload, modified or unmodified";this.bindings.filter(he=>he.event==="*"?ee===(re==null?void 0:re.type):he.event===ee).map(he=>he.callback(oe,ne))}replyEventName(ee){return`chan_reply_${ee}`}isClosed(){return this.state===CHANNEL_STATES.closed}isErrored(){return this.state===CHANNEL_STATES.errored}isJoined(){return this.state===CHANNEL_STATES.joined}isJoining(){return this.state===CHANNEL_STATES.joining}isLeaving(){return this.state===CHANNEL_STATES.leaving}}var __awaiter$7=globalThis&&globalThis.__awaiter||function(te,ee,re,ne){function ie(se){return se instanceof re?se:new re(function(le){le(se)})}return new(re||(re=Promise))(function(se,le){function ue(he){try{oe(ne.next(he))}catch(ce){le(ce)}}function ae(he){try{oe(ne.throw(he))}catch(ce){le(ce)}}function oe(he){he.done?se(he.value):ie(he.value).then(ue,ae)}oe((ne=ne.apply(te,ee||[])).next())})};const noop=()=>{};class RealtimeClient{constructor(ee,re){this.accessToken=null,this.channels=[],this.endPoint="",this.headers=DEFAULT_HEADERS$1,this.params={},this.timeout=DEFAULT_TIMEOUT,this.transport=browser.w3cwebsocket,this.heartbeatIntervalMs=3e4,this.longpollerTimeout=2e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=noop,this.conn=null,this.sendBuffer=[],this.serializer=new Serializer,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.endPoint=`${ee}/${TRANSPORTS.websocket}`,re!=null&&re.params&&(this.params=re.params),re!=null&&re.headers&&(this.headers=Object.assign(Object.assign({},this.headers),re.headers)),re!=null&&re.timeout&&(this.timeout=re.timeout),re!=null&&re.logger&&(this.logger=re.logger),re!=null&&re.transport&&(this.transport=re.transport),re!=null&&re.heartbeatIntervalMs&&(this.heartbeatIntervalMs=re.heartbeatIntervalMs),re!=null&&re.longpollerTimeout&&(this.longpollerTimeout=re.longpollerTimeout),this.reconnectAfterMs=re!=null&&re.reconnectAfterMs?re.reconnectAfterMs:ne=>[1e3,2e3,5e3,1e4][ne-1]||1e4,this.encode=re!=null&&re.encode?re.encode:(ne,ie)=>ie(JSON.stringify(ne)),this.decode=re!=null&&re.decode?re.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Timer(()=>__awaiter$7(this,void 0,void 0,function*(){yield this.disconnect(),this.connect()}),this.reconnectAfterMs)}connect(){this.conn||(this.conn=new this.transport(this.endPointURL(),[],null,this.headers),this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=ee=>this._onConnError(ee),this.conn.onmessage=ee=>this.onConnMessage(ee),this.conn.onclose=ee=>this._onConnClose(ee)))}disconnect(ee,re){return new Promise((ne,ie)=>{try{this.conn&&(this.conn.onclose=function(){},ee?this.conn.close(ee,re||""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset()),ne({error:null,data:!0})}catch(se){ne({error:se,data:!1})}})}log(ee,re,ne){this.logger(ee,re,ne)}onOpen(ee){this.stateChangeCallbacks.open.push(ee)}onClose(ee){this.stateChangeCallbacks.close.push(ee)}onError(ee){this.stateChangeCallbacks.error.push(ee)}onMessage(ee){this.stateChangeCallbacks.message.push(ee)}connectionState(){switch(this.conn&&this.conn.readyState){case SOCKET_STATES.connecting:return CONNECTION_STATE.Connecting;case SOCKET_STATES.open:return CONNECTION_STATE.Open;case SOCKET_STATES.closing:return CONNECTION_STATE.Closing;default:return CONNECTION_STATE.Closed}}isConnected(){return this.connectionState()===CONNECTION_STATE.Open}remove(ee){this.channels=this.channels.filter(re=>re.joinRef()!==ee.joinRef())}channel(ee,re={}){const ne=new RealtimeSubscription(ee,re,this);return this.channels.push(ne),ne}push(ee){const{topic:re,event:ne,payload:ie,ref:se}=ee;let le=()=>{this.encode(ee,ue=>{var ae;(ae=this.conn)===null||ae===void 0||ae.send(ue)})};this.log("push",`${re} ${ne} (${se})`,ie),this.isConnected()?le():this.sendBuffer.push(le)}onConnMessage(ee){this.decode(ee.data,re=>{let{topic:ne,event:ie,payload:se,ref:le}=re;(le&&le===this.pendingHeartbeatRef||ie===(se==null?void 0:se.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${se.status||""} ${ne} ${ie} ${le&&"("+le+")"||""}`,se),this.channels.filter(ue=>ue.isMember(ne)).forEach(ue=>ue.trigger(ie,se,le)),this.stateChangeCallbacks.message.forEach(ue=>ue(re))})}endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:VSN}))}makeRef(){let ee=this.ref+1;return ee===this.ref?this.ref=0:this.ref=ee,this.ref.toString()}setAuth(ee){this.accessToken=ee,this.channels.forEach(re=>{ee&&re.updateJoinPayload({user_token:ee}),re.joinedOnce&&re.isJoined()&&re.push(CHANNEL_EVENTS.access_token,{access_token:ee})})}leaveOpenTopic(ee){let re=this.channels.find(ne=>ne.topic===ee&&(ne.isJoined()||ne.isJoining()));re&&(this.log("transport",`leaving duplicate topic "${ee}"`),re.unsubscribe())}_onConnOpen(){this.log("transport",`connected to ${this.endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(ee=>ee())}_onConnClose(ee){this.log("transport","close",ee),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(re=>re(ee))}_onConnError(ee){this.log("transport",ee.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(re=>re(ee))}_triggerChanError(){this.channels.forEach(ee=>ee.trigger(CHANNEL_EVENTS.error))}_appendParams(ee,re){if(Object.keys(re).length===0)return ee;const ne=ee.match(/\?/)?"&":"?",ie=new URLSearchParams(re);return`${ee}${ne}${ie}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(ee=>ee()),this.sendBuffer=[])}_sendHeartbeat(){var ee;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(ee=this.conn)===null||ee===void 0||ee.close(WS_CLOSE_NORMAL,"hearbeat timeout");return}this.pendingHeartbeatRef=this.makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}}class SupabaseRealtimeClient{constructor(ee,re,ne,ie){const se={},le=ie==="*"?`realtime:${ne}`:`realtime:${ne}:${ie}`,ue=re.Authorization.split(" ")[1];ue&&(se.user_token=ue),this.subscription=ee.channel(le,se)}getPayloadRecords(ee){const re={new:{},old:{}};return(ee.type==="INSERT"||ee.type==="UPDATE")&&(re.new=convertChangeData(ee.columns,ee.record)),(ee.type==="UPDATE"||ee.type==="DELETE")&&(re.old=convertChangeData(ee.columns,ee.old_record)),re}on(ee,re){return this.subscription.on(ee,ne=>{let ie={schema:ne.schema,table:ne.table,commit_timestamp:ne.commit_timestamp,eventType:ne.type,new:{},old:{},errors:ne.errors};ie=Object.assign(Object.assign({},ie),this.getPayloadRecords(ne)),re(ie)}),this}subscribe(ee=()=>{}){return this.subscription.onError(re=>ee("SUBSCRIPTION_ERROR",re)),this.subscription.onClose(()=>ee("CLOSED")),this.subscription.subscribe().receive("ok",()=>ee("SUBSCRIBED")).receive("error",re=>ee("SUBSCRIPTION_ERROR",re)).receive("timeout",()=>ee("RETRYING_AFTER_TIMEOUT")),this.subscription}}class SupabaseQueryBuilder extends PostgrestQueryBuilder{constructor(ee,{headers:re={},schema:ne,realtime:ie,table:se,fetch:le,shouldThrowOnError:ue}){super(ee,{headers:re,schema:ne,fetch:le,shouldThrowOnError:ue}),this._subscription=null,this._realtime=ie,this._headers=re,this._schema=ne,this._table=se}on(ee,re){return this._realtime.isConnected()||this._realtime.connect(),this._subscription||(this._subscription=new SupabaseRealtimeClient(this._realtime,this._headers,this._schema,this._table)),this._subscription.on(ee,re)}}const version="1.7.3",DEFAULT_HEADERS={"X-Client-Info":`storage-js/${version}`};var __awaiter$6=globalThis&&globalThis.__awaiter||function(te,ee,re,ne){function ie(se){return se instanceof re?se:new re(function(le){le(se)})}return new(re||(re=Promise))(function(se,le){function ue(he){try{oe(ne.next(he))}catch(ce){le(ce)}}function ae(he){try{oe(ne.throw(he))}catch(ce){le(ce)}}function oe(he){he.done?se(he.value):ie(he.value).then(ue,ae)}oe((ne=ne.apply(te,ee||[])).next())})};const _getErrorMessage=te=>te.msg||te.message||te.error_description||te.error||JSON.stringify(te),handleError=(te,ee)=>{if(typeof te.json!="function")return ee(te);te.json().then(re=>ee({message:_getErrorMessage(re),status:(te==null?void 0:te.status)||500}))},_getRequestParams=(te,ee,re,ne)=>{const ie={method:te,headers:(ee==null?void 0:ee.headers)||{}};return te==="GET"?ie:(ie.headers=Object.assign({"Content-Type":"application/json"},ee==null?void 0:ee.headers),ie.body=JSON.stringify(ne),Object.assign(Object.assign({},ie),re))};function _handleRequest(te,ee,re,ne,ie,se){return __awaiter$6(this,void 0,void 0,function*(){return new Promise((le,ue)=>{te(re,_getRequestParams(ee,ne,ie,se)).then(ae=>{if(!ae.ok)throw ae;return ne!=null&&ne.noResolveJson?le(ae):ae.json()}).then(ae=>le(ae)).catch(ae=>handleError(ae,ue))})})}function get(te,ee,re,ne){return __awaiter$6(this,void 0,void 0,function*(){return _handleRequest(te,"GET",ee,re,ne)})}function post(te,ee,re,ne,ie){return __awaiter$6(this,void 0,void 0,function*(){return _handleRequest(te,"POST",ee,ne,ie,re)})}function put(te,ee,re,ne,ie){return __awaiter$6(this,void 0,void 0,function*(){return _handleRequest(te,"PUT",ee,ne,ie,re)})}function remove(te,ee,re,ne,ie){return __awaiter$6(this,void 0,void 0,function*(){return _handleRequest(te,"DELETE",ee,ne,ie,re)})}var __awaiter$5=globalThis&&globalThis.__awaiter||function(te,ee,re,ne){function ie(se){return se instanceof re?se:new re(function(le){le(se)})}return new(re||(re=Promise))(function(se,le){function ue(he){try{oe(ne.next(he))}catch(ce){le(ce)}}function ae(he){try{oe(ne.throw(he))}catch(ce){le(ce)}}function oe(he){he.done?se(he.value):ie(he.value).then(ue,ae)}oe((ne=ne.apply(te,ee||[])).next())})};const resolveFetch$1=te=>{let ee;return te?ee=te:typeof fetch>"u"?ee=(...re)=>__awaiter$5(void 0,void 0,void 0,function*(){return yield(yield __vitePreload(()=>import("./browser-ponyfill-5f021805.js").then(ne=>ne.b),[],import.meta.url)).fetch(...re)}):ee=fetch,(...re)=>ee(...re)};var __awaiter$4=globalThis&&globalThis.__awaiter||function(te,ee,re,ne){function ie(se){return se instanceof re?se:new re(function(le){le(se)})}return new(re||(re=Promise))(function(se,le){function ue(he){try{oe(ne.next(he))}catch(ce){le(ce)}}function ae(he){try{oe(ne.throw(he))}catch(ce){le(ce)}}function oe(he){he.done?se(he.value):ie(he.value).then(ue,ae)}oe((ne=ne.apply(te,ee||[])).next())})};class StorageBucketApi{constructor(ee,re={},ne){this.url=ee,this.headers=Object.assign(Object.assign({},DEFAULT_HEADERS),re),this.fetch=resolveFetch$1(ne)}listBuckets(){return __awaiter$4(this,void 0,void 0,function*(){try{return{data:yield get(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(ee){return{data:null,error:ee}}})}getBucket(ee){return __awaiter$4(this,void 0,void 0,function*(){try{return{data:yield get(this.fetch,`${this.url}/bucket/${ee}`,{headers:this.headers}),error:null}}catch(re){return{data:null,error:re}}})}createBucket(ee,re={public:!1}){return __awaiter$4(this,void 0,void 0,function*(){try{return{data:(yield post(this.fetch,`${this.url}/bucket`,{id:ee,name:ee,public:re.public},{headers:this.headers})).name,error:null}}catch(ne){return{data:null,error:ne}}})}updateBucket(ee,re){return __awaiter$4(this,void 0,void 0,function*(){try{return{data:yield put(this.fetch,`${this.url}/bucket/${ee}`,{id:ee,name:ee,public:re.public},{headers:this.headers}),error:null}}catch(ne){return{data:null,error:ne}}})}emptyBucket(ee){return __awaiter$4(this,void 0,void 0,function*(){try{return{data:yield post(this.fetch,`${this.url}/bucket/${ee}/empty`,{},{headers:this.headers}),error:null}}catch(re){return{data:null,error:re}}})}deleteBucket(ee){return __awaiter$4(this,void 0,void 0,function*(){try{return{data:yield remove(this.fetch,`${this.url}/bucket/${ee}`,{},{headers:this.headers}),error:null}}catch(re){return{data:null,error:re}}})}}var __awaiter$3=globalThis&&globalThis.__awaiter||function(te,ee,re,ne){function ie(se){return se instanceof re?se:new re(function(le){le(se)})}return new(re||(re=Promise))(function(se,le){function ue(he){try{oe(ne.next(he))}catch(ce){le(ce)}}function ae(he){try{oe(ne.throw(he))}catch(ce){le(ce)}}function oe(he){he.done?se(he.value):ie(he.value).then(ue,ae)}oe((ne=ne.apply(te,ee||[])).next())})};const DEFAULT_SEARCH_OPTIONS={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},DEFAULT_FILE_OPTIONS={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class StorageFileApi{constructor(ee,re={},ne,ie){this.url=ee,this.headers=re,this.bucketId=ne,this.fetch=resolveFetch$1(ie)}uploadOrUpdate(ee,re,ne,ie){return __awaiter$3(this,void 0,void 0,function*(){try{let se;const le=Object.assign(Object.assign({},DEFAULT_FILE_OPTIONS),ie),ue=Object.assign(Object.assign({},this.headers),ee==="POST"&&{"x-upsert":String(le.upsert)});typeof Blob<"u"&&ne instanceof Blob?(se=new FormData,se.append("cacheControl",le.cacheControl),se.append("",ne)):typeof FormData<"u"&&ne instanceof FormData?(se=ne,se.append("cacheControl",le.cacheControl)):(se=ne,ue["cache-control"]=`max-age=${le.cacheControl}`,ue["content-type"]=le.contentType);const ae=this._removeEmptyFolders(re),oe=this._getFinalPath(ae),he=yield this.fetch(`${this.url}/object/${oe}`,{method:ee,body:se,headers:ue});return he.ok?{data:{Key:oe},error:null}:{data:null,error:yield he.json()}}catch(se){return{data:null,error:se}}})}upload(ee,re,ne){return __awaiter$3(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",ee,re,ne)})}update(ee,re,ne){return __awaiter$3(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",ee,re,ne)})}move(ee,re){return __awaiter$3(this,void 0,void 0,function*(){try{return{data:yield post(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:ee,destinationKey:re},{headers:this.headers}),error:null}}catch(ne){return{data:null,error:ne}}})}copy(ee,re){return __awaiter$3(this,void 0,void 0,function*(){try{return{data:yield post(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:ee,destinationKey:re},{headers:this.headers}),error:null}}catch(ne){return{data:null,error:ne}}})}createSignedUrl(ee,re){return __awaiter$3(this,void 0,void 0,function*(){try{const ne=this._getFinalPath(ee);let ie=yield post(this.fetch,`${this.url}/object/sign/${ne}`,{expiresIn:re},{headers:this.headers});const se=`${this.url}${ie.signedURL}`;return ie={signedURL:se},{data:ie,error:null,signedURL:se}}catch(ne){return{data:null,error:ne,signedURL:null}}})}createSignedUrls(ee,re){return __awaiter$3(this,void 0,void 0,function*(){try{return{data:(yield post(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:re,paths:ee},{headers:this.headers})).map(ie=>Object.assign(Object.assign({},ie),{signedURL:ie.signedURL?`${this.url}${ie.signedURL}`:null})),error:null}}catch(ne){return{data:null,error:ne}}})}download(ee){return __awaiter$3(this,void 0,void 0,function*(){try{const re=this._getFinalPath(ee);return{data:yield(yield get(this.fetch,`${this.url}/object/${re}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(re){return{data:null,error:re}}})}getPublicUrl(ee){try{const re=this._getFinalPath(ee),ne=`${this.url}/object/public/${re}`;return{data:{publicURL:ne},error:null,publicURL:ne}}catch(re){return{data:null,error:re,publicURL:null}}}remove(ee){return __awaiter$3(this,void 0,void 0,function*(){try{return{data:yield remove(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:ee},{headers:this.headers}),error:null}}catch(re){return{data:null,error:re}}})}list(ee,re,ne){return __awaiter$3(this,void 0,void 0,function*(){try{const ie=Object.assign(Object.assign(Object.assign({},DEFAULT_SEARCH_OPTIONS),re),{prefix:ee||""});return{data:yield post(this.fetch,`${this.url}/object/list/${this.bucketId}`,ie,{headers:this.headers},ne),error:null}}catch(ie){return{data:null,error:ie}}})}_getFinalPath(ee){return`${this.bucketId}/${ee}`}_removeEmptyFolders(ee){return ee.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}}class StorageClient extends StorageBucketApi{constructor(ee,re={},ne){super(ee,re,ne)}from(ee){return new StorageFileApi(this.url,this.headers,ee,this.fetch)}}var __awaiter$2=globalThis&&globalThis.__awaiter||function(te,ee,re,ne){function ie(se){return se instanceof re?se:new re(function(le){le(se)})}return new(re||(re=Promise))(function(se,le){function ue(he){try{oe(ne.next(he))}catch(ce){le(ce)}}function ae(he){try{oe(ne.throw(he))}catch(ce){le(ce)}}function oe(he){he.done?se(he.value):ie(he.value).then(ue,ae)}oe((ne=ne.apply(te,ee||[])).next())})};const resolveFetch=te=>{let ee;return te?ee=te:typeof fetch>"u"?ee=(...re)=>__awaiter$2(void 0,void 0,void 0,function*(){return yield(yield __vitePreload(()=>import("./browser-ponyfill-5f021805.js").then(ne=>ne.b),[],import.meta.url)).fetch(...re)}):ee=fetch,(...re)=>ee(...re)};var __awaiter$1=globalThis&&globalThis.__awaiter||function(te,ee,re,ne){function ie(se){return se instanceof re?se:new re(function(le){le(se)})}return new(re||(re=Promise))(function(se,le){function ue(he){try{oe(ne.next(he))}catch(ce){le(ce)}}function ae(he){try{oe(ne.throw(he))}catch(ce){le(ce)}}function oe(he){he.done?se(he.value):ie(he.value).then(ue,ae)}oe((ne=ne.apply(te,ee||[])).next())})};class FunctionsClient{constructor(ee,{headers:re={},customFetch:ne}={}){this.url=ee,this.headers=re,this.fetch=resolveFetch(ne)}setAuth(ee){this.headers.Authorization=`Bearer ${ee}`}invoke(ee,re){return __awaiter$1(this,void 0,void 0,function*(){try{const{headers:ne,body:ie}=re??{},se=yield this.fetch(`${this.url}/${ee}`,{method:"POST",headers:Object.assign({},this.headers,ne),body:ie}),le=se.headers.get("x-relay-error");if(le&&le==="true")return{data:null,error:new Error(yield se.text())};let ue;const{responseType:ae}=re??{};return!ae||ae==="json"?ue=yield se.json():ae==="arrayBuffer"?ue=yield se.arrayBuffer():ae==="blob"?ue=yield se.blob():ue=yield se.text(),{data:ue,error:null}}catch(ne){return{data:null,error:ne}}})}}var __awaiter=globalThis&&globalThis.__awaiter||function(te,ee,re,ne){function ie(se){return se instanceof re?se:new re(function(le){le(se)})}return new(re||(re=Promise))(function(se,le){function ue(he){try{oe(ne.next(he))}catch(ce){le(ce)}}function ae(he){try{oe(ne.throw(he))}catch(ce){le(ce)}}function oe(he){he.done?se(he.value):ie(he.value).then(ue,ae)}oe((ne=ne.apply(te,ee||[])).next())})};const DEFAULT_OPTIONS={schema:"public",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,multiTab:!0,headers:DEFAULT_HEADERS$4};class SupabaseClient{constructor(ee,re,ne){if(this.supabaseUrl=ee,this.supabaseKey=re,!ee)throw new Error("supabaseUrl is required.");if(!re)throw new Error("supabaseKey is required.");const ie=stripTrailingSlash(ee),se=Object.assign(Object.assign({},DEFAULT_OPTIONS),ne);if(this.restUrl=`${ie}/rest/v1`,this.realtimeUrl=`${ie}/realtime/v1`.replace("http","ws"),this.authUrl=`${ie}/auth/v1`,this.storageUrl=`${ie}/storage/v1`,ie.match(/(supabase\.co)|(supabase\.in)/)){const ue=ie.split(".");this.functionsUrl=`${ue[0]}.functions.${ue[1]}.${ue[2]}`}else this.functionsUrl=`${ie}/functions/v1`;this.schema=se.schema,this.multiTab=se.multiTab,this.fetch=se.fetch,this.headers=Object.assign(Object.assign({},DEFAULT_HEADERS$4),ne==null?void 0:ne.headers),this.shouldThrowOnError=se.shouldThrowOnError||!1,this.auth=this._initSupabaseAuthClient(se),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},se.realtime)),this._listenForAuthEvents(),this._listenForMultiTabEvents()}get functions(){return new FunctionsClient(this.functionsUrl,{headers:this._getAuthHeaders(),customFetch:this.fetch})}get storage(){return new StorageClient(this.storageUrl,this._getAuthHeaders(),this.fetch)}from(ee){const re=`${this.restUrl}/${ee}`;return new SupabaseQueryBuilder(re,{headers:this._getAuthHeaders(),schema:this.schema,realtime:this.realtime,table:ee,fetch:this.fetch,shouldThrowOnError:this.shouldThrowOnError})}rpc(ee,re,{head:ne=!1,count:ie=null}={}){return this._initPostgRESTClient().rpc(ee,re,{head:ne,count:ie})}removeAllSubscriptions(){return __awaiter(this,void 0,void 0,function*(){const ee=this.getSubscriptions().slice(),re=ee.map(ie=>this.removeSubscription(ie));return(yield Promise.all(re)).map(({error:ie},se)=>({data:{subscription:ee[se]},error:ie}))})}removeSubscription(ee){return __awaiter(this,void 0,void 0,function*(){const{error:re}=yield this._closeSubscription(ee),ne=this.getSubscriptions(),ie=ne.filter(se=>se.isJoined()).length;return ne.length===0&&(yield this.realtime.disconnect()),{data:{openSubscriptions:ie},error:re}})}_closeSubscription(ee){return __awaiter(this,void 0,void 0,function*(){let re=null;if(!ee.isClosed()){const{error:ne}=yield this._unsubscribeSubscription(ee);re=ne}return this.realtime.remove(ee),{error:re}})}_unsubscribeSubscription(ee){return new Promise(re=>{ee.unsubscribe().receive("ok",()=>re({error:null})).receive("error",ne=>re({error:ne})).receive("timeout",()=>re({error:new Error("timed out")}))})}getSubscriptions(){return this.realtime.channels}_initSupabaseAuthClient({autoRefreshToken:ee,persistSession:re,detectSessionInUrl:ne,localStorage:ie,headers:se,fetch:le,cookieOptions:ue,multiTab:ae}){const oe={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new SupabaseAuthClient({url:this.authUrl,headers:Object.assign(Object.assign({},se),oe),autoRefreshToken:ee,persistSession:re,detectSessionInUrl:ne,localStorage:ie,fetch:le,cookieOptions:ue,multiTab:ae})}_initRealtimeClient(ee){return new RealtimeClient(this.realtimeUrl,Object.assign(Object.assign({},ee),{params:Object.assign(Object.assign({},ee==null?void 0:ee.params),{apikey:this.supabaseKey})}))}_initPostgRESTClient(){return new PostgrestClient(this.restUrl,{headers:this._getAuthHeaders(),schema:this.schema,fetch:this.fetch,throwOnError:this.shouldThrowOnError})}_getAuthHeaders(){var ee,re;const ne=Object.assign({},this.headers),ie=(re=(ee=this.auth.session())===null||ee===void 0?void 0:ee.access_token)!==null&&re!==void 0?re:this.supabaseKey;return ne.apikey=this.supabaseKey,ne.Authorization=ne.Authorization||`Bearer ${ie}`,ne}_listenForMultiTabEvents(){if(!this.multiTab||!isBrowser$1()||!(window!=null&&window.addEventListener))return null;try{return window==null?void 0:window.addEventListener("storage",ee=>{var re,ne,ie;if(ee.key===STORAGE_KEY$1){const se=JSON.parse(String(ee.newValue)),le=(ne=(re=se==null?void 0:se.currentSession)===null||re===void 0?void 0:re.access_token)!==null&&ne!==void 0?ne:void 0,ue=(ie=this.auth.session())===null||ie===void 0?void 0:ie.access_token;le?!ue&&le?this._handleTokenChanged("SIGNED_IN",le,"STORAGE"):ue!==le&&this._handleTokenChanged("TOKEN_REFRESHED",le,"STORAGE"):this._handleTokenChanged("SIGNED_OUT",le,"STORAGE")}})}catch(ee){return console.error("_listenForMultiTabEvents",ee),null}}_listenForAuthEvents(){let{data:ee}=this.auth.onAuthStateChange((re,ne)=>{this._handleTokenChanged(re,ne==null?void 0:ne.access_token,"CLIENT")});return ee}_handleTokenChanged(ee,re,ne){(ee==="TOKEN_REFRESHED"||ee==="SIGNED_IN")&&this.changedAccessToken!==re?(this.realtime.setAuth(re),ne=="STORAGE"&&this.auth.setAuth(re),this.changedAccessToken=re):(ee==="SIGNED_OUT"||ee==="USER_DELETED")&&(this.realtime.setAuth(this.supabaseKey),ne=="STORAGE"&&this.auth.signOut())}}const createClient=(te,ee,re)=>new SupabaseClient(te,ee,re);var shim={exports:{}},useSyncExternalStoreShim_production_min={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var e=require$$0$1;function h$1(te,ee){return te===ee&&(te!==0||1/te===1/ee)||te!==te&&ee!==ee}var k=typeof Object.is=="function"?Object.is:h$1,l=e.useState,m=e.useEffect,n$1=e.useLayoutEffect,p$1=e.useDebugValue;function q$1(te,ee){var re=ee(),ne=l({inst:{value:re,getSnapshot:ee}}),ie=ne[0].inst,se=ne[1];return n$1(function(){ie.value=re,ie.getSnapshot=ee,r$1(ie)&&se({inst:ie})},[te,re,ee]),m(function(){return r$1(ie)&&se({inst:ie}),te(function(){r$1(ie)&&se({inst:ie})})},[te]),p$1(re),re}function r$1(te){var ee=te.getSnapshot;te=te.value;try{var re=ee();return!k(te,re)}catch{return!0}}function t$2(te,ee){return ee()}var u$1=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?t$2:q$1;useSyncExternalStoreShim_production_min.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:u$1;shim.exports=useSyncExternalStoreShim_production_min;var shimExports=shim.exports,withSelector_production_min={};/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var h=require$$0$1,n=shimExports;function p(te,ee){return te===ee&&(te!==0||1/te===1/ee)||te!==te&&ee!==ee}var q=typeof Object.is=="function"?Object.is:p,r=n.useSyncExternalStore,t$1=h.useRef,u=h.useEffect,v=h.useMemo,w=h.useDebugValue;withSelector_production_min.useSyncExternalStoreWithSelector=function(te,ee,re,ne,ie){var se=t$1(null);if(se.current===null){var le={hasValue:!1,value:null};se.current=le}else le=se.current;se=v(function(){function ae(de){if(!oe){if(oe=!0,he=de,de=ne(de),ie!==void 0&&le.hasValue){var me=le.value;if(ie(me,de))return ce=me}return ce=de}if(me=ce,q(he,de))return me;var ve=ne(de);return ie!==void 0&&ie(me,ve)?me:(he=de,ce=ve)}var oe=!1,he,ce,pe=re===void 0?null:re;return[function(){return ae(ee())},pe===null?void 0:function(){return ae(pe())}]},[ee,re,ne,ie]);var ue=r(te,se[0],se[1]);return u(function(){le.hasValue=!0,le.value=ue},[ue]),w(ue),ue};function defaultNoopBatch(te){te()}let batch=defaultNoopBatch;const setBatch=te=>batch=te,getBatch=()=>batch,ContextKey=Symbol.for("react-redux-context"),gT=typeof globalThis<"u"?globalThis:{};function getContext(){var te;if(!G$1)return{};const ee=(te=gT[ContextKey])!=null?te:gT[ContextKey]=new Map;let re=ee.get(G$1);return re||(re=G$1(null),ee.set(G$1,re)),re}const ReactReduxContext=getContext(),notInitialized=()=>{throw new Error("uSES not initialized!")},_excluded$1=["initMapStateToProps","initMapDispatchToProps","initMergeProps"];function pureFinalPropsSelectorFactory(te,ee,re,ne,{areStatesEqual:ie,areOwnPropsEqual:se,areStatePropsEqual:le}){let ue=!1,ae,oe,he,ce,pe;function de(_e,Te){return ae=_e,oe=Te,he=te(ae,oe),ce=ee(ne,oe),pe=re(he,ce,oe),ue=!0,pe}function me(){return he=te(ae,oe),ee.dependsOnOwnProps&&(ce=ee(ne,oe)),pe=re(he,ce,oe),pe}function ve(){return te.dependsOnOwnProps&&(he=te(ae,oe)),ee.dependsOnOwnProps&&(ce=ee(ne,oe)),pe=re(he,ce,oe),pe}function we(){const _e=te(ae,oe),Te=!le(_e,he);return he=_e,Te&&(pe=re(he,ce,oe)),pe}function ge(_e,Te){const Ne=!se(Te,oe),ye=!ie(_e,ae,Te,oe);return ae=_e,oe=Te,Ne&&ye?me():Ne?ve():ye?we():pe}return function(Te,Ne){return ue?ge(Te,Ne):de(Te,Ne)}}function finalPropsSelectorFactory(te,ee){let{initMapStateToProps:re,initMapDispatchToProps:ne,initMergeProps:ie}=ee,se=_objectWithoutPropertiesLoose(ee,_excluded$1);const le=re(te,se),ue=ne(te,se),ae=ie(te,se);return pureFinalPropsSelectorFactory(le,ue,ae,te,se)}function bindActionCreators(te,ee){const re={};for(const ne in te){const ie=te[ne];typeof ie=="function"&&(re[ne]=(...se)=>ee(ie(...se)))}return re}function wrapMapToPropsConstant(te){return function(re){const ne=te(re);function ie(){return ne}return ie.dependsOnOwnProps=!1,ie}}function getDependsOnOwnProps(te){return te.dependsOnOwnProps?!!te.dependsOnOwnProps:te.length!==1}function wrapMapToPropsFunc(te,ee){return function(ne,{displayName:ie}){const se=function(ue,ae){return se.dependsOnOwnProps?se.mapToProps(ue,ae):se.mapToProps(ue,void 0)};return se.dependsOnOwnProps=!0,se.mapToProps=function(ue,ae){se.mapToProps=te,se.dependsOnOwnProps=getDependsOnOwnProps(te);let oe=se(ue,ae);return typeof oe=="function"&&(se.mapToProps=oe,se.dependsOnOwnProps=getDependsOnOwnProps(oe),oe=se(ue,ae)),oe},se}}function createInvalidArgFactory(te,ee){return(re,ne)=>{throw new Error(`Invalid value of type ${typeof te} for ${ee} argument when connecting component ${ne.wrappedComponentName}.`)}}function mapDispatchToPropsFactory(te){return te&&typeof te=="object"?wrapMapToPropsConstant(ee=>bindActionCreators(te,ee)):te?typeof te=="function"?wrapMapToPropsFunc(te):createInvalidArgFactory(te,"mapDispatchToProps"):wrapMapToPropsConstant(ee=>({dispatch:ee}))}function mapStateToPropsFactory(te){return te?typeof te=="function"?wrapMapToPropsFunc(te):createInvalidArgFactory(te,"mapStateToProps"):wrapMapToPropsConstant(()=>({}))}function defaultMergeProps(te,ee,re){return _extends$1({},re,te,ee)}function wrapMergePropsFunc(te){return function(re,{displayName:ne,areMergedPropsEqual:ie}){let se=!1,le;return function(ae,oe,he){const ce=te(ae,oe,he);return se?ie(ce,le)||(le=ce):(se=!0,le=ce),le}}}function mergePropsFactory(te){return te?typeof te=="function"?wrapMergePropsFunc(te):createInvalidArgFactory(te,"mergeProps"):()=>defaultMergeProps}function createListenerCollection(){const te=getBatch();let ee=null,re=null;return{clear(){ee=null,re=null},notify(){te(()=>{let ne=ee;for(;ne;)ne.callback(),ne=ne.next})},get(){let ne=[],ie=ee;for(;ie;)ne.push(ie),ie=ie.next;return ne},subscribe(ne){let ie=!0,se=re={callback:ne,next:null,prev:re};return se.prev?se.prev.next=se:ee=se,function(){!ie||ee===null||(ie=!1,se.next?se.next.prev=se.prev:re=se.prev,se.prev?se.prev.next=se.next:ee=se.next)}}}}const nullListeners={notify(){},get:()=>[]};function createSubscription(te,ee){let re,ne=nullListeners,ie=0,se=!1;function le(ve){he();const we=ne.subscribe(ve);let ge=!1;return()=>{ge||(ge=!0,we(),ce())}}function ue(){ne.notify()}function ae(){me.onStateChange&&me.onStateChange()}function oe(){return se}function he(){ie++,re||(re=ee?ee.addNestedSub(ae):te.subscribe(ae),ne=createListenerCollection())}function ce(){ie--,re&&ie===0&&(re(),re=void 0,ne.clear(),ne=nullListeners)}function pe(){se||(se=!0,he())}function de(){se&&(se=!1,ce())}const me={addNestedSub:le,notifyNestedSubs:ue,handleChangeWrapper:ae,isSubscribed:oe,trySubscribe:pe,tryUnsubscribe:de,getListeners:()=>ne};return me}const canUseDOM=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",useIsomorphicLayoutEffect=canUseDOM?y$1:p$3;function is(te,ee){return te===ee?te!==0||ee!==0||1/te===1/ee:te!==te&&ee!==ee}function shallowEqual(te,ee){if(is(te,ee))return!0;if(typeof te!="object"||te===null||typeof ee!="object"||ee===null)return!1;const re=Object.keys(te),ne=Object.keys(ee);if(re.length!==ne.length)return!1;for(let ie=0;ie<re.length;ie++)if(!Object.prototype.hasOwnProperty.call(ee,re[ie])||!is(te[re[ie]],ee[re[ie]]))return!1;return!0}const _excluded=["reactReduxForwardedRef"];let useSyncExternalStore=notInitialized;const initializeConnect=te=>{useSyncExternalStore=te},NO_SUBSCRIPTION_ARRAY=[null,null];function useIsomorphicLayoutEffectWithArgs(te,ee,re){useIsomorphicLayoutEffect(()=>te(...ee),re)}function captureWrapperProps(te,ee,re,ne,ie,se){te.current=ne,re.current=!1,ie.current&&(ie.current=null,se())}function subscribeUpdates(te,ee,re,ne,ie,se,le,ue,ae,oe,he){if(!te)return()=>{};let ce=!1,pe=null;const de=()=>{if(ce||!ue.current)return;const ve=ee.getState();let we,ge;try{we=ne(ve,ie.current)}catch(_e){ge=_e,pe=_e}ge||(pe=null),we===se.current?le.current||oe():(se.current=we,ae.current=we,le.current=!0,he())};return re.onStateChange=de,re.trySubscribe(),de(),()=>{if(ce=!0,re.tryUnsubscribe(),re.onStateChange=null,pe)throw pe}}function strictEqual(te,ee){return te===ee}function connect(te,ee,re,{pure:ne,areStatesEqual:ie=strictEqual,areOwnPropsEqual:se=shallowEqual,areStatePropsEqual:le=shallowEqual,areMergedPropsEqual:ue=shallowEqual,forwardRef:ae=!1,context:oe=ReactReduxContext}={}){const he=oe,ce=mapStateToPropsFactory(te),pe=mapDispatchToPropsFactory(ee),de=mergePropsFactory(re),me=!!te;return we=>{const ge=we.displayName||we.name||"Component",_e=`Connect(${ge})`,Te={shouldHandleStateChanges:me,displayName:_e,wrappedComponentName:ge,WrappedComponent:we,initMapStateToProps:ce,initMapDispatchToProps:pe,initMergeProps:de,areStatesEqual:ie,areStatePropsEqual:le,areOwnPropsEqual:se,areMergedPropsEqual:ue};function Ne(xe){const[Oe,Fe,De]=F$1(()=>{const{reactReduxForwardedRef:Ut}=xe,Zt=_objectWithoutPropertiesLoose(xe,_excluded);return[xe.context,Ut,Zt]},[xe]),Me=F$1(()=>Oe&&Oe.Consumer&&reactIsExports$1.isContextConsumer(y$2(Oe.Consumer,null))?Oe:he,[Oe,he]),We=q$4(Me),Ge=!!xe.store&&!!xe.store.getState&&!!xe.store.dispatch,ht=!!We&&!!We.store,qe=Ge?xe.store:We.store,ot=ht?We.getServerState:qe.getState,nt=F$1(()=>finalPropsSelectorFactory(qe.dispatch,Te),[qe]),[je,Ke]=F$1(()=>{if(!me)return NO_SUBSCRIPTION_ARRAY;const Ut=createSubscription(qe,Ge?void 0:We.subscription),Zt=Ut.notifyNestedSubs.bind(Ut);return[Ut,Zt]},[qe,Ge,We]),et=F$1(()=>Ge?We:_extends$1({},We,{subscription:je}),[Ge,We,je]),tt=_(),Ye=_(De),at=_(),Bt=_(!1);_(!1);const Et=_(!1),gt=_();useIsomorphicLayoutEffect(()=>(Et.current=!0,()=>{Et.current=!1}),[]);const jt=F$1(()=>()=>at.current&&De===Ye.current?at.current:nt(qe.getState(),De),[qe,De]),St=F$1(()=>Zt=>je?subscribeUpdates(me,qe,je,nt,Ye,tt,Bt,Et,at,Ke,Zt):()=>{},[je]);useIsomorphicLayoutEffectWithArgs(captureWrapperProps,[Ye,tt,Bt,De,at,Ke]);let Qe;try{Qe=useSyncExternalStore(St,jt,ot?()=>nt(ot(),De):jt)}catch(Ut){throw gt.current&&(Ut.message+=`
The error may be correlated with this previous error:
${gt.current.stack}

`),Ut}useIsomorphicLayoutEffect(()=>{gt.current=void 0,at.current=void 0,tt.current=Qe});const Rt=F$1(()=>y$2(we,_extends$1({},Qe,{ref:Fe})),[Fe,we,Qe]);return F$1(()=>me?y$2(Me.Provider,{value:et},Rt):Rt,[Me,Rt,et])}const Le=x$1(Ne);if(Le.WrappedComponent=we,Le.displayName=Ne.displayName=_e,ae){const Oe=k$2(function(De,Me){return y$2(Le,_extends$1({},De,{reactReduxForwardedRef:Me}))});return Oe.displayName=_e,Oe.WrappedComponent=we,hoistNonReactStatics$1(Oe,we)}return hoistNonReactStatics$1(Le,we)}}function Provider({store:te,context:ee,children:re,serverState:ne,stabilityCheck:ie="once",noopCheck:se="once"}){const le=F$1(()=>{const oe=createSubscription(te);return{store:te,subscription:oe,getServerState:ne?()=>ne:void 0,stabilityCheck:ie,noopCheck:se}},[te,ne,ie,se]),ue=F$1(()=>te.getState(),[te]);return useIsomorphicLayoutEffect(()=>{const{subscription:oe}=le;return oe.onStateChange=oe.notifyNestedSubs,oe.trySubscribe(),ue!==te.getState()&&oe.notifyNestedSubs(),()=>{oe.tryUnsubscribe(),oe.onStateChange=void 0}},[le,ue]),y$2((ee||ReactReduxContext).Provider,{value:le},re)}initializeConnect(shimExports.useSyncExternalStore);setBatch(dn);function formatProdErrorMessage(te){return"Minified Redux error #"+te+"; visit https://redux.js.org/Errors?code="+te+" for the full message or use the non-minified dev environment for full errors. "}var $$observable=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}(),randomString=function(){return Math.random().toString(36).substring(7).split("").join(".")},ActionTypes={INIT:"@@redux/INIT"+randomString(),REPLACE:"@@redux/REPLACE"+randomString(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+randomString()}};function isPlainObject(te){if(typeof te!="object"||te===null)return!1;for(var ee=te;Object.getPrototypeOf(ee)!==null;)ee=Object.getPrototypeOf(ee);return Object.getPrototypeOf(te)===ee}function createStore(te,ee,re){var ne;if(typeof ee=="function"&&typeof re=="function"||typeof re=="function"&&typeof arguments[3]=="function")throw new Error(formatProdErrorMessage(0));if(typeof ee=="function"&&typeof re>"u"&&(re=ee,ee=void 0),typeof re<"u"){if(typeof re!="function")throw new Error(formatProdErrorMessage(1));return re(createStore)(te,ee)}if(typeof te!="function")throw new Error(formatProdErrorMessage(2));var ie=te,se=ee,le=[],ue=le,ae=!1;function oe(){ue===le&&(ue=le.slice())}function he(){if(ae)throw new Error(formatProdErrorMessage(3));return se}function ce(ve){if(typeof ve!="function")throw new Error(formatProdErrorMessage(4));if(ae)throw new Error(formatProdErrorMessage(5));var we=!0;return oe(),ue.push(ve),function(){if(we){if(ae)throw new Error(formatProdErrorMessage(6));we=!1,oe();var _e=ue.indexOf(ve);ue.splice(_e,1),le=null}}}function pe(ve){if(!isPlainObject(ve))throw new Error(formatProdErrorMessage(7));if(typeof ve.type>"u")throw new Error(formatProdErrorMessage(8));if(ae)throw new Error(formatProdErrorMessage(9));try{ae=!0,se=ie(se,ve)}finally{ae=!1}for(var we=le=ue,ge=0;ge<we.length;ge++){var _e=we[ge];_e()}return ve}function de(ve){if(typeof ve!="function")throw new Error(formatProdErrorMessage(10));ie=ve,pe({type:ActionTypes.REPLACE})}function me(){var ve,we=ce;return ve={subscribe:function(_e){if(typeof _e!="object"||_e===null)throw new Error(formatProdErrorMessage(11));function Te(){_e.next&&_e.next(he())}Te();var Ne=we(Te);return{unsubscribe:Ne}}},ve[$$observable]=function(){return this},ve}return pe({type:ActionTypes.INIT}),ne={dispatch:pe,subscribe:ce,getState:he,replaceReducer:de},ne[$$observable]=me,ne}var flexsearch_bundle={exports:{}};flexsearch_bundle.exports;(function(module){(function _f(self){try{module&&(self=module)}catch(te){}self._factory=_f;var t;function u(te){return typeof te<"u"?te:!0}function aa(te){const ee=Array(te);for(let re=0;re<te;re++)ee[re]=v();return ee}function v(){return Object.create(null)}function ba(te,ee){return ee.length-te.length}function x(te){return typeof te=="string"}function C(te){return typeof te=="object"}function D(te){return typeof te=="function"}function ca(te,ee){var re=da;if(te&&(ee&&(te=E(te,ee)),this.H&&(te=E(te,this.H)),this.J&&1<te.length&&(te=E(te,this.J)),re||re==="")){if(te=te.split(re),this.filter){ee=this.filter,re=te.length;const ne=[];for(let ie=0,se=0;ie<re;ie++){const le=te[ie];le&&!ee[le]&&(ne[se++]=le)}te=ne}return te}return te}const da=/[\p{Z}\p{S}\p{P}\p{C}]+/u,ea=/[\u0300-\u036f]/g;function fa(te,ee){const re=Object.keys(te),ne=re.length,ie=[];let se="",le=0;for(let ue=0,ae,oe;ue<ne;ue++)ae=re[ue],(oe=te[ae])?(ie[le++]=F(ee?"(?!\\b)"+ae+"(\\b|_)":ae),ie[le++]=oe):se+=(se?"|":"")+ae;return se&&(ie[le++]=F(ee?"(?!\\b)("+se+")(\\b|_)":"("+se+")"),ie[le]=""),ie}function E(te,ee){for(let re=0,ne=ee.length;re<ne&&(te=te.replace(ee[re],ee[re+1]),te);re+=2);return te}function F(te){return new RegExp(te,"g")}function ha(te){let ee="",re="";for(let ne=0,ie=te.length,se;ne<ie;ne++)(se=te[ne])!==re&&(ee+=re=se);return ee}var ja={encode:ia,F:!1,G:""};function ia(te){return ca.call(this,(""+te).toLowerCase(),!1)}const ka={},G={};function la(te){I(te,"add"),I(te,"append"),I(te,"search"),I(te,"update"),I(te,"remove")}function I(te,ee){te[ee+"Async"]=function(){const re=this,ne=arguments;var ie=ne[ne.length-1];let se;return D(ie)&&(se=ie,delete ne[ne.length-1]),ie=new Promise(function(le){setTimeout(function(){re.async=!0;const ue=re[ee].apply(re,ne);re.async=!1,le(ue)})}),se?(ie.then(se),this):ie}}function ma(te,ee,re,ne){const ie=te.length;let se=[],le,ue,ae=0;ne&&(ne=[]);for(let oe=ie-1;0<=oe;oe--){const he=te[oe],ce=he.length,pe=v();let de=!le;for(let me=0;me<ce;me++){const ve=he[me],we=ve.length;if(we)for(let ge=0,_e,Te;ge<we;ge++)if(Te=ve[ge],le){if(le[Te]){if(!oe){if(re)re--;else if(se[ae++]=Te,ae===ee)return se}(oe||ne)&&(pe[Te]=1),de=!0}if(ne&&(ue[Te]=(_e=ue[Te])?++_e:_e=1,_e<ie)){const Ne=ne[_e-2]||(ne[_e-2]=[]);Ne[Ne.length]=Te}}else pe[Te]=1}if(ne)le||(ue=pe);else if(!de)return[];le=pe}if(ne)for(let oe=ne.length-1,he,ce;0<=oe;oe--){he=ne[oe],ce=he.length;for(let pe=0,de;pe<ce;pe++)if(de=he[pe],!le[de]){if(re)re--;else if(se[ae++]=de,ae===ee)return se;le[de]=1}}return se}function na(te,ee){const re=v(),ne=v(),ie=[];for(let se=0;se<te.length;se++)re[te[se]]=1;for(let se=0,le;se<ee.length;se++){le=ee[se];for(let ue=0,ae;ue<le.length;ue++)ae=le[ue],re[ae]&&!ne[ae]&&(ne[ae]=1,ie[ie.length]=ae)}return ie}function J(te){this.l=te!==!0&&te,this.cache=v(),this.h=[]}function oa(te,ee,re){C(te)&&(te=te.query);let ne=this.cache.get(te);return ne||(ne=this.search(te,ee,re),this.cache.set(te,ne)),ne}J.prototype.set=function(te,ee){if(!this.cache[te]){var re=this.h.length;for(re===this.l?delete this.cache[this.h[re-1]]:re++,--re;0<re;re--)this.h[re]=this.h[re-1];this.h[0]=te}this.cache[te]=ee},J.prototype.get=function(te){const ee=this.cache[te];if(this.l&&ee&&(te=this.h.indexOf(te))){const re=this.h[te-1];this.h[te-1]=this.h[te],this.h[te]=re}return ee};const qa={memory:{charset:"latin:extra",D:3,B:4,m:!1},performance:{D:3,B:3,s:!1,context:{depth:2,D:1}},match:{charset:"latin:extra",G:"reverse"},score:{charset:"latin:advanced",D:20,B:3,context:{depth:3,D:9}},default:{}};function ra(te,ee,re,ne,ie,se){setTimeout(function(){const le=te(re,JSON.stringify(se));le&&le.then?le.then(function(){ee.export(te,ee,re,ne,ie+1)}):ee.export(te,ee,re,ne,ie+1)})}function K(te,ee){if(!(this instanceof K))return new K(te);var re;if(te){x(te)?te=qa[te]:(re=te.preset)&&(te=Object.assign({},re[re],te)),re=te.charset;var ne=te.lang;x(re)&&(re.indexOf(":")===-1&&(re+=":default"),re=G[re]),x(ne)&&(ne=ka[ne])}else te={};let ie,se,le=te.context||{};if(this.encode=te.encode||re&&re.encode||ia,this.register=ee||v(),this.D=ie=te.resolution||9,this.G=ee=re&&re.G||te.tokenize||"strict",this.depth=ee==="strict"&&le.depth,this.l=u(le.bidirectional),this.s=se=u(te.optimize),this.m=u(te.fastupdate),this.B=te.minlength||1,this.C=te.boost,this.map=se?aa(ie):v(),this.A=ie=le.resolution||1,this.h=se?aa(ie):v(),this.F=re&&re.F||te.rtl,this.H=(ee=te.matcher||ne&&ne.H)&&fa(ee,!1),this.J=(ee=te.stemmer||ne&&ne.J)&&fa(ee,!0),re=ee=te.filter||ne&&ne.filter){re=ee,ne=v();for(let ue=0,ae=re.length;ue<ae;ue++)ne[re[ue]]=1;re=ne}this.filter=re,this.cache=(ee=te.cache)&&new J(ee)}t=K.prototype,t.append=function(te,ee){return this.add(te,ee,!0)},t.add=function(te,ee,re,ne){if(ee&&(te||te===0)){if(!ne&&!re&&this.register[te])return this.update(te,ee);if(ee=this.encode(ee),ne=ee.length){const oe=v(),he=v(),ce=this.depth,pe=this.D;for(let de=0;de<ne;de++){let me=ee[this.F?ne-1-de:de];var ie=me.length;if(me&&ie>=this.B&&(ce||!he[me])){var se=L(pe,ne,de),le="";switch(this.G){case"full":if(3<ie){for(se=0;se<ie;se++)for(var ue=ie;ue>se;ue--)if(ue-se>=this.B){var ae=L(pe,ne,de,ie,se);le=me.substring(se,ue),M(this,he,le,ae,te,re)}break}case"reverse":if(2<ie){for(ue=ie-1;0<ue;ue--)le=me[ue]+le,le.length>=this.B&&M(this,he,le,L(pe,ne,de,ie,ue),te,re);le=""}case"forward":if(1<ie){for(ue=0;ue<ie;ue++)le+=me[ue],le.length>=this.B&&M(this,he,le,se,te,re);break}default:if(this.C&&(se=Math.min(se/this.C(ee,me,de)|0,pe-1)),M(this,he,me,se,te,re),ce&&1<ne&&de<ne-1){for(ie=v(),le=this.A,se=me,ue=Math.min(ce+1,ne-de),ie[se]=1,ae=1;ae<ue;ae++)if((me=ee[this.F?ne-1-de-ae:de+ae])&&me.length>=this.B&&!ie[me]){ie[me]=1;const ve=this.l&&me>se;M(this,oe,ve?se:me,L(le+(ne/2>le?0:1),ne,de,ue-1,ae-1),te,re,ve?me:se)}}}}}this.m||(this.register[te]=1)}}return this};function L(te,ee,re,ne,ie){return re&&1<te?ee+(ne||0)<=te?re+(ie||0):(te-1)/(ee+(ne||0))*(re+(ie||0))+1|0:0}function M(te,ee,re,ne,ie,se,le){let ue=le?te.h:te.map;(!ee[re]||le&&!ee[re][le])&&(te.s&&(ue=ue[ne]),le?(ee=ee[re]||(ee[re]=v()),ee[le]=1,ue=ue[le]||(ue[le]=v())):ee[re]=1,ue=ue[re]||(ue[re]=[]),te.s||(ue=ue[ne]||(ue[ne]=[])),se&&ue.indexOf(ie)!==-1||(ue[ue.length]=ie,te.m&&(te=te.register[ie]||(te.register[ie]=[]),te[te.length]=ue)))}t.search=function(te,ee,re){re||(!ee&&C(te)?(re=te,te=re.query):C(ee)&&(re=ee));let ne=[],ie,se,le=0;if(re){ee=re.limit,le=re.offset||0;var ue=re.context;se=re.suggest}if(te&&(te=this.encode(te),ie=te.length,1<ie)){re=v();var ae=[];for(let he=0,ce=0,pe;he<ie;he++)if((pe=te[he])&&pe.length>=this.B&&!re[pe])if(this.s||se||this.map[pe])ae[ce++]=pe,re[pe]=1;else return ne;te=ae,ie=te.length}if(!ie)return ne;ee||(ee=100),ue=this.depth&&1<ie&&ue!==!1,re=0;let oe;ue?(oe=te[0],re=1):1<ie&&te.sort(ba);for(let he,ce;re<ie;re++){if(ce=te[re],ue?(he=sa(this,ne,se,ee,le,ie===2,ce,oe),se&&he===!1&&ne.length||(oe=ce)):he=sa(this,ne,se,ee,le,ie===1,ce),he)return he;if(se&&re===ie-1){if(ae=ne.length,!ae){if(ue){ue=0,re=-1;continue}return ne}if(ae===1)return ta(ne[0],ee,le)}}return ma(ne,ee,le,se)};function sa(te,ee,re,ne,ie,se,le,ue){let ae=[],oe=ue?te.h:te.map;if(te.s||(oe=ua(oe,le,ue,te.l)),oe){let he=0;const ce=Math.min(oe.length,ue?te.A:te.D);for(let pe=0,de=0,me,ve;pe<ce&&!((me=oe[pe])&&(te.s&&(me=ua(me,le,ue,te.l)),ie&&me&&se&&(ve=me.length,ve<=ie?(ie-=ve,me=null):(me=me.slice(ie),ie=0)),me&&(ae[he++]=me,se&&(de+=me.length,de>=ne))));pe++);if(he){if(se)return ta(ae,ne,0);ee[ee.length]=ae;return}}return!re&&ae}function ta(te,ee,re){return te=te.length===1?te[0]:[].concat.apply([],te),re||te.length>ee?te.slice(re,re+ee):te}function ua(te,ee,re,ne){return re?(ne=ne&&ee>re,te=(te=te[ne?ee:re])&&te[ne?re:ee]):te=te[ee],te}t.contain=function(te){return!!this.register[te]},t.update=function(te,ee){return this.remove(te).add(te,ee)},t.remove=function(te,ee){const re=this.register[te];if(re){if(this.m)for(let ne=0,ie;ne<re.length;ne++)ie=re[ne],ie.splice(ie.indexOf(te),1);else N(this.map,te,this.D,this.s),this.depth&&N(this.h,te,this.A,this.s);if(ee||delete this.register[te],this.cache){ee=this.cache;for(let ne=0,ie,se;ne<ee.h.length;ne++)se=ee.h[ne],ie=ee.cache[se],ie.indexOf(te)!==-1&&(ee.h.splice(ne--,1),delete ee.cache[se])}}return this};function N(te,ee,re,ne,ie){let se=0;if(te.constructor===Array)if(ie)ee=te.indexOf(ee),ee!==-1?1<te.length&&(te.splice(ee,1),se++):se++;else{ie=Math.min(te.length,re);for(let le=0,ue;le<ie;le++)(ue=te[le])&&(se=N(ue,ee,re,ne,ie),ne||se||delete te[le])}else for(let le in te)(se=N(te[le],ee,re,ne,ie))||delete te[le];return se}t.searchCache=oa,t.export=function(te,ee,re,ne,ie){let se,le;switch(ie||(ie=0)){case 0:if(se="reg",this.m){le=v();for(let ue in this.register)le[ue]=1}else le=this.register;break;case 1:se="cfg",le={doc:0,opt:this.s?1:0};break;case 2:se="map",le=this.map;break;case 3:se="ctx",le=this.h;break;default:return}return ra(te,ee||this,re?re+"."+se:se,ne,ie,le),!0},t.import=function(te,ee){if(ee)switch(x(ee)&&(ee=JSON.parse(ee)),te){case"cfg":this.s=!!ee.opt;break;case"reg":this.m=!1,this.register=ee;break;case"map":this.map=ee;break;case"ctx":this.h=ee}},la(K.prototype);function va(te){te=te.data;var ee=self._index;const re=te.args;var ne=te.task;switch(ne){case"init":ne=te.options||{},te=te.factory,ee=ne.encode,ne.cache=!1,ee&&ee.indexOf("function")===0&&(ne.encode=Function("return "+ee)()),te?(Function("return "+te)()(self),self._index=new self.FlexSearch.Index(ne),delete self.FlexSearch):self._index=new K(ne);break;default:te=te.id,ee=ee[ne].apply(ee,re),postMessage(ne==="search"?{id:te,msg:ee}:{id:te})}}let wa=0;function O(te){if(!(this instanceof O))return new O(te);var ee;te?D(ee=te.encode)&&(te.encode=ee.toString()):te={},(ee=(self||window)._factory)&&(ee=ee.toString());const re=self.exports,ne=this;this.o=xa(ee,re,te.worker),this.h=v(),this.o&&(re?this.o.on("message",function(ie){ne.h[ie.id](ie.msg),delete ne.h[ie.id]}):this.o.onmessage=function(ie){ie=ie.data,ne.h[ie.id](ie.msg),delete ne.h[ie.id]},this.o.postMessage({task:"init",factory:ee,options:te}))}P("add"),P("append"),P("search"),P("update"),P("remove");function P(te){O.prototype[te]=O.prototype[te+"Async"]=function(){const ee=this,re=[].slice.call(arguments);var ne=re[re.length-1];let ie;return D(ne)&&(ie=ne,re.splice(re.length-1,1)),ne=new Promise(function(se){setTimeout(function(){ee.h[++wa]=se,ee.o.postMessage({task:te,id:wa,args:re})})}),ie?(ne.then(ie),this):ne}}function xa(a,b,c){let d;try{d=b?eval('new (require("worker_threads")["Worker"])("../dist/node/node.js")'):a?new Worker(URL.createObjectURL(new Blob(["onmessage="+va.toString()],{type:"text/javascript"}))):new Worker(x(c)?c:"worker/worker.js",{type:"module"})}catch(te){}return d}function Q(te){if(!(this instanceof Q))return new Q(te);var ee=te.document||te.doc||te,re;this.K=[],this.h=[],this.A=[],this.register=v(),this.key=(re=ee.key||ee.id)&&S(re,this.A)||"id",this.m=u(te.fastupdate),this.C=(re=ee.store)&&re!==!0&&[],this.store=re&&v(),this.I=(re=ee.tag)&&S(re,this.A),this.l=re&&v(),this.cache=(re=te.cache)&&new J(re),te.cache=!1,this.o=te.worker,this.async=!1,re=v();let ne=ee.index||ee.field||ee;x(ne)&&(ne=[ne]);for(let ie=0,se,le;ie<ne.length;ie++)se=ne[ie],x(se)||(le=se,se=se.field),le=C(le)?Object.assign({},te,le):te,this.o&&(re[se]=new O(le),re[se].o||(this.o=!1)),this.o||(re[se]=new K(le,this.register)),this.K[ie]=S(se,this.A),this.h[ie]=se;if(this.C)for(te=ee.store,x(te)&&(te=[te]),ee=0;ee<te.length;ee++)this.C[ee]=S(te[ee],this.A);this.index=re}function S(te,ee){const re=te.split(":");let ne=0;for(let ie=0;ie<re.length;ie++)te=re[ie],0<=te.indexOf("[]")&&(te=te.substring(0,te.length-2))&&(ee[ne]=!0),te&&(re[ne++]=te);return ne<re.length&&(re.length=ne),1<ne?re:re[0]}function T(te,ee){if(x(ee))te=te[ee];else for(let re=0;te&&re<ee.length;re++)te=te[ee[re]];return te}function U(te,ee,re,ne,ie){if(te=te[ie],ne===re.length-1)ee[ie]=te;else if(te)if(te.constructor===Array)for(ee=ee[ie]=Array(te.length),ie=0;ie<te.length;ie++)U(te,ee,re,ne,ie);else ee=ee[ie]||(ee[ie]=v()),ie=re[++ne],U(te,ee,re,ne,ie)}function V(te,ee,re,ne,ie,se,le,ue){if(te=te[le])if(ne===ee.length-1){if(te.constructor===Array){if(re[ne]){for(ee=0;ee<te.length;ee++)ie.add(se,te[ee],!0,!0);return}te=te.join(" ")}ie.add(se,te,ue,!0)}else if(te.constructor===Array)for(le=0;le<te.length;le++)V(te,ee,re,ne,ie,se,le,ue);else le=ee[++ne],V(te,ee,re,ne,ie,se,le,ue)}t=Q.prototype,t.add=function(te,ee,re){if(C(te)&&(ee=te,te=T(ee,this.key)),ee&&(te||te===0)){if(!re&&this.register[te])return this.update(te,ee);for(let ne=0,ie,se;ne<this.h.length;ne++)se=this.h[ne],ie=this.K[ne],x(ie)&&(ie=[ie]),V(ee,ie,this.A,0,this.index[se],te,ie[0],re);if(this.I){let ne=T(ee,this.I),ie=v();x(ne)&&(ne=[ne]);for(let se=0,le,ue;se<ne.length;se++)if(le=ne[se],!ie[le]&&(ie[le]=1,ue=this.l[le]||(this.l[le]=[]),!re||ue.indexOf(te)===-1)&&(ue[ue.length]=te,this.m)){const ae=this.register[te]||(this.register[te]=[]);ae[ae.length]=ue}}if(this.store&&(!re||!this.store[te])){let ne;if(this.C){ne=v();for(let ie=0,se;ie<this.C.length;ie++)se=this.C[ie],x(se)?ne[se]=ee[se]:U(ee,ne,se,0,se[0])}this.store[te]=ne||ee}}return this},t.append=function(te,ee){return this.add(te,ee,!0)},t.update=function(te,ee){return this.remove(te).add(te,ee)},t.remove=function(te){if(C(te)&&(te=T(te,this.key)),this.register[te]){for(var ee=0;ee<this.h.length&&(this.index[this.h[ee]].remove(te,!this.o),!this.m);ee++);if(this.I&&!this.m)for(let re in this.l){ee=this.l[re];const ne=ee.indexOf(te);ne!==-1&&(1<ee.length?ee.splice(ne,1):delete this.l[re])}this.store&&delete this.store[te],delete this.register[te]}return this},t.search=function(te,ee,re,ne){re||(!ee&&C(te)?(re=te,te=re.query):C(ee)&&(re=ee,ee=0));let ie=[],se=[],le,ue,ae,oe,he,ce,pe=0;if(re)if(re.constructor===Array)ae=re,re=null;else{if(ae=(le=re.pluck)||re.index||re.field,oe=re.tag,ue=this.store&&re.enrich,he=re.bool==="and",ee=re.limit||100,ce=re.offset||0,oe&&(x(oe)&&(oe=[oe]),!te)){for(let me=0,ve;me<oe.length;me++)(ve=ya.call(this,oe[me],ee,ce,ue))&&(ie[ie.length]=ve,pe++);return pe?ie:[]}x(ae)&&(ae=[ae])}ae||(ae=this.h),he=he&&(1<ae.length||oe&&1<oe.length);const de=!ne&&(this.o||this.async)&&[];for(let me=0,ve,we,ge;me<ae.length;me++){let _e;if(we=ae[me],x(we)||(_e=we,we=we.field),de)de[me]=this.index[we].searchAsync(te,ee,_e||re);else{if(ne?ve=ne[me]:ve=this.index[we].search(te,ee,_e||re),ge=ve&&ve.length,oe&&ge){const Te=[];let Ne=0;he&&(Te[0]=[ve]);for(let ye=0,Le,xe;ye<oe.length;ye++)Le=oe[ye],(ge=(xe=this.l[Le])&&xe.length)&&(Ne++,Te[Te.length]=he?[xe]:xe);Ne&&(ve=he?ma(Te,ee||100,ce||0):na(ve,Te),ge=ve.length)}if(ge)se[pe]=we,ie[pe++]=ve;else if(he)return[]}}if(de){const me=this;return new Promise(function(ve){Promise.all(de).then(function(we){ve(me.search(te,ee,re,we))})})}if(!pe)return[];if(le&&(!ue||!this.store))return ie[0];for(let me=0,ve;me<se.length;me++){if(ve=ie[me],ve.length&&ue&&(ve=za.call(this,ve)),le)return ve;ie[me]={field:se[me],result:ve}}return ie};function ya(te,ee,re,ne){let ie=this.l[te],se=ie&&ie.length-re;if(se&&0<se)return(se>ee||re)&&(ie=ie.slice(re,re+ee)),ne&&(ie=za.call(this,ie)),{tag:te,result:ie}}function za(te){const ee=Array(te.length);for(let re=0,ne;re<te.length;re++)ne=te[re],ee[re]={id:ne,doc:this.store[ne]};return ee}t.contain=function(te){return!!this.register[te]},t.get=function(te){return this.store[te]},t.set=function(te,ee){return this.store[te]=ee,this},t.searchCache=oa,t.export=function(te,ee,re,ne,ie){if(ie||(ie=0),ne||(ne=0),ne<this.h.length){const se=this.h[ne],le=this.index[se];ee=this,setTimeout(function(){le.export(te,ee,ie?se.replace(":","-"):"",ne,ie++)||(ne++,ie=1,ee.export(te,ee,se,ne,ie))})}else{let se;switch(ie){case 1:re="tag",se=this.l;break;case 2:re="store",se=this.store;break;default:return}ra(te,this,re,ne,ie,se)}},t.import=function(te,ee){if(ee)switch(x(ee)&&(ee=JSON.parse(ee)),te){case"tag":this.l=ee;break;case"reg":this.m=!1,this.register=ee;for(let ne=0,ie;ne<this.h.length;ne++)ie=this.index[this.h[ne]],ie.register=ee,ie.m=!1;break;case"store":this.store=ee;break;default:te=te.split(".");const re=te[0];te=te[1],re&&te&&this.index[re].import(te,ee)}},la(Q.prototype);var Ba={encode:Aa,F:!1,G:""};const Ca=[F("[]"),"a",F("[]"),"e",F("[]"),"i",F("[]"),"o",F("[]"),"u",F("[]"),"y",F(""),"n",F("[c]"),"k",F(""),"s",F(" & ")," and "];function Aa(te){var ee=te;return ee.normalize&&(ee=ee.normalize("NFD").replace(ea,"")),ca.call(this,ee.toLowerCase(),!te.normalize&&Ca)}var Ea={encode:Da,F:!1,G:"strict"};const Fa=/[^a-z0-9]+/,Ga={b:"p",v:"f",w:"f",z:"s",x:"s",:"s",d:"t",n:"m",c:"k",g:"k",j:"k",q:"k",i:"e",y:"e",u:"o"};function Da(te){te=Aa.call(this,te).join(" ");const ee=[];if(te){const re=te.split(Fa),ne=re.length;for(let ie=0,se,le=0;ie<ne;ie++)if((te=re[ie])&&(!this.filter||!this.filter[te])){se=te[0];let ue=Ga[se]||se,ae=ue;for(let oe=1;oe<te.length;oe++){se=te[oe];const he=Ga[se]||se;he&&he!==ae&&(ue+=he,ae=he)}ee[le++]=ue}}return ee}var Ia={encode:Ha,F:!1,G:""};const Ja=[F("ae"),"a",F("oe"),"o",F("sh"),"s",F("th"),"t",F("ph"),"f",F("pf"),"f",F("(?![aeo])h(?![aeo])"),"",F("(?!^[aeo])h(?!^[aeo])"),""];function Ha(te,ee){return te&&(te=Da.call(this,te).join(" "),2<te.length&&(te=E(te,Ja)),ee||(1<te.length&&(te=ha(te)),te&&(te=te.split(" ")))),te}var La={encode:Ka,F:!1,G:""};const Ma=F("(?!\\b)[aeo]");function Ka(te){return te&&(te=Ha.call(this,te,!0),1<te.length&&(te=te.replace(Ma,"")),1<te.length&&(te=ha(te)),te&&(te=te.split(" "))),te}G["latin:default"]=ja,G["latin:simple"]=Ba,G["latin:balance"]=Ea,G["latin:advanced"]=Ia,G["latin:extra"]=La;const W=self;let Y;const Z={Index:K,Document:Q,Worker:O,registerCharset:function(te,ee){G[te]=ee},registerLanguage:function(te,ee){ka[te]=ee}};(Y=W.define)&&Y.amd?Y([],function(){return Z}):W.exports?W.exports=Z:W.FlexSearch=Z})(commonjsGlobal)})(flexsearch_bundle);var flexsearch_bundleExports=flexsearch_bundle.exports;const FlexSearch=getDefaultExportFromCjs(flexsearch_bundleExports);function commonjsRequire(te){throw new Error('Could not dynamically require "'+te+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var fuzzysort$1={exports:{}};(function(te){(function(ee,re){te.exports?te.exports=re():ee.fuzzysort=re()})(commonjsGlobal,function(){function re(ve){var we={single:function(ge,_e,Te){if(!ge||(pe(ge)||(ge=we.getPreparedSearch(ge)),!_e))return null;pe(_e)||(_e=we.getPrepared(_e));var Ne=Te&&Te.allowTypo!==void 0?Te.allowTypo:ve&&ve.allowTypo!==void 0?ve.allowTypo:!0,ye=Ne?we.algorithm:we.algorithmNoTypo;return ye(ge,_e,ge[0])},go:function(ge,_e,Te){if(!ge)return le;ge=we.prepareSearch(ge);var Ne=ge[0],ye=Te&&Te.threshold||ve&&ve.threshold||-9007199254740991,Le=Te&&Te.limit||ve&&ve.limit||9007199254740991,xe=Te&&Te.allowTypo!==void 0?Te.allowTypo:ve&&ve.allowTypo!==void 0?ve.allowTypo:!0,Oe=xe?we.algorithm:we.algorithmNoTypo,Fe=0,De=0,Me=_e.length;if(Te&&Te.keys)for(var We=Te.scoreFn||he,Ge=Te.keys,ht=Ge.length,qe=Me-1;qe>=0;--qe){for(var ot=_e[qe],nt=new Array(ht),je=ht-1;je>=0;--je){var Ke=Ge[je],et=ce(ot,Ke);if(!et){nt[je]=null;continue}pe(et)||(et=we.getPrepared(et)),nt[je]=Oe(ge,et,Ne)}nt.obj=ot;var tt=We(nt);tt!==null&&(tt<ye||(nt.score=tt,Fe<Le?(me.add(nt),++Fe):(++De,tt>me.peek().score&&me.replaceTop(nt))))}else if(Te&&Te.key)for(var Ke=Te.key,qe=Me-1;qe>=0;--qe){var ot=_e[qe],et=ce(ot,Ke);if(et){pe(et)||(et=we.getPrepared(et));var Ye=Oe(ge,et,Ne);Ye!==null&&(Ye.score<ye||(Ye={target:Ye.target,_targetLowerCodes:null,_nextBeginningIndexes:null,score:Ye.score,indexes:Ye.indexes,obj:ot},Fe<Le?(me.add(Ye),++Fe):(++De,Ye.score>me.peek().score&&me.replaceTop(Ye))))}}else for(var qe=Me-1;qe>=0;--qe){var et=_e[qe];if(et){pe(et)||(et=we.getPrepared(et));var Ye=Oe(ge,et,Ne);Ye!==null&&(Ye.score<ye||(Fe<Le?(me.add(Ye),++Fe):(++De,Ye.score>me.peek().score&&me.replaceTop(Ye))))}}if(Fe===0)return le;for(var at=new Array(Fe),qe=Fe-1;qe>=0;--qe)at[qe]=me.poll();return at.total=Fe+De,at},goAsync:function(ge,_e,Te){var Ne=!1,ye=new Promise(function(Le,xe){if(!ge)return Le(le);ge=we.prepareSearch(ge);var Oe=ge[0],Fe=de(),De=_e.length-1,Me=Te&&Te.threshold||ve&&ve.threshold||-9007199254740991,We=Te&&Te.limit||ve&&ve.limit||9007199254740991,Ge=Te&&Te.allowTypo!==void 0?Te.allowTypo:ve&&ve.allowTypo!==void 0?ve.allowTypo:!0,ht=Ge?we.algorithm:we.algorithmNoTypo,qe=0,ot=0;function nt(){if(Ne)return xe("canceled");var je=Date.now();if(Te&&Te.keys)for(var Ke=Te.scoreFn||he,et=Te.keys,tt=et.length;De>=0;--De){for(var Ye=_e[De],at=new Array(tt),Bt=tt-1;Bt>=0;--Bt){var Et=et[Bt],gt=ce(Ye,Et);if(!gt){at[Bt]=null;continue}pe(gt)||(gt=we.getPrepared(gt)),at[Bt]=ht(ge,gt,Oe)}at.obj=Ye;var jt=Ke(at);if(jt!==null&&!(jt<Me)&&(at.score=jt,qe<We?(Fe.add(at),++qe):(++ot,jt>Fe.peek().score&&Fe.replaceTop(at)),De%1e3===0&&Date.now()-je>=10)){ne?setImmediate(nt):setTimeout(nt);return}}else if(Te&&Te.key)for(var Et=Te.key;De>=0;--De){var Ye=_e[De],gt=ce(Ye,Et);if(gt){pe(gt)||(gt=we.getPrepared(gt));var St=ht(ge,gt,Oe);if(St!==null&&!(St.score<Me)&&(St={target:St.target,_targetLowerCodes:null,_nextBeginningIndexes:null,score:St.score,indexes:St.indexes,obj:Ye},qe<We?(Fe.add(St),++qe):(++ot,St.score>Fe.peek().score&&Fe.replaceTop(St)),De%1e3===0&&Date.now()-je>=10)){ne?setImmediate(nt):setTimeout(nt);return}}}else for(;De>=0;--De){var gt=_e[De];if(gt){pe(gt)||(gt=we.getPrepared(gt));var St=ht(ge,gt,Oe);if(St!==null&&!(St.score<Me)&&(qe<We?(Fe.add(St),++qe):(++ot,St.score>Fe.peek().score&&Fe.replaceTop(St)),De%1e3===0&&Date.now()-je>=10)){ne?setImmediate(nt):setTimeout(nt);return}}}if(qe===0)return Le(le);for(var Qe=new Array(qe),Rt=qe-1;Rt>=0;--Rt)Qe[Rt]=Fe.poll();Qe.total=qe+ot,Le(Qe)}ne?setImmediate(nt):nt()});return ye.cancel=function(){Ne=!0},ye},highlight:function(ge,_e,Te){if(ge===null)return null;_e===void 0&&(_e="<b>"),Te===void 0&&(Te="</b>");for(var Ne="",ye=0,Le=!1,xe=ge.target,Oe=xe.length,Fe=ge.indexes,De=0;De<Oe;++De){var Me=xe[De];if(Fe[ye]===De){if(++ye,Le||(Le=!0,Ne+=_e),ye===Fe.length){Ne+=Me+Te+xe.substr(De+1);break}}else Le&&(Le=!1,Ne+=Te);Ne+=Me}return Ne},prepare:function(ge){if(ge)return{target:ge,_targetLowerCodes:we.prepareLowerCodes(ge),_nextBeginningIndexes:null,score:null,indexes:null,obj:null}},prepareSlow:function(ge){if(ge)return{target:ge,_targetLowerCodes:we.prepareLowerCodes(ge),_nextBeginningIndexes:we.prepareNextBeginningIndexes(ge),score:null,indexes:null,obj:null}},prepareSearch:function(ge){if(ge)return we.prepareLowerCodes(ge)},getPrepared:function(ge){if(ge.length>999)return we.prepare(ge);var _e=ie.get(ge);return _e!==void 0||(_e=we.prepare(ge),ie.set(ge,_e)),_e},getPreparedSearch:function(ge){if(ge.length>999)return we.prepareSearch(ge);var _e=se.get(ge);return _e!==void 0||(_e=we.prepareSearch(ge),se.set(ge,_e)),_e},algorithm:function(ge,_e,Te){for(var Ne=_e._targetLowerCodes,ye=ge.length,Le=Ne.length,We=0,xe=0,Oe=0,Fe=0;;){var De=Te===Ne[xe];if(De){if(ue[Fe++]=xe,++We,We===ye)break;Te=ge[Oe===0?We:Oe===We?We+1:Oe===We-1?We-1:We]}if(++xe,xe>=Le)for(;;){if(We<=1)return null;if(Oe===0){--We;var Me=ge[We];if(Te===Me)continue;Oe=We}else{if(Oe===1)return null;--Oe,We=Oe,Te=ge[We+1];var Me=ge[We];if(Te===Me)continue}Fe=We,xe=ue[Fe-1]+1;break}}var We=0,Ge=0,ht=!1,qe=0,ot=_e._nextBeginningIndexes;ot===null&&(ot=_e._nextBeginningIndexes=we.prepareNextBeginningIndexes(_e.target));var nt=xe=ue[0]===0?0:ot[ue[0]-1];if(xe!==Le)for(;;)if(xe>=Le){if(We<=0){if(++Ge,Ge>ye-2)break;if(ge[Ge]===ge[Ge+1])continue;xe=nt;continue}--We;var je=ae[--qe];xe=ot[je]}else{var De=ge[Ge===0?We:Ge===We?We+1:Ge===We-1?We-1:We]===Ne[xe];if(De){if(ae[qe++]=xe,++We,We===ye){ht=!0;break}++xe}else xe=ot[xe]}{if(ht)var Ke=ae,et=qe;else var Ke=ue,et=Fe;for(var tt=0,Ye=-1,at=0;at<ye;++at){var xe=Ke[at];Ye!==xe-1&&(tt-=xe),Ye=xe}ht?Ge!==0&&(tt+=-20):(tt*=1e3,Oe!==0&&(tt+=-20)),tt-=Le-ye,_e.score=tt,_e.indexes=new Array(et);for(var at=et-1;at>=0;--at)_e.indexes[at]=Ke[at];return _e}},algorithmNoTypo:function(ge,_e,Te){for(var Ne=_e._targetLowerCodes,ye=ge.length,Le=Ne.length,De=0,xe=0,Oe=0;;){var Fe=Te===Ne[xe];if(Fe){if(ue[Oe++]=xe,++De,De===ye)break;Te=ge[De]}if(++xe,xe>=Le)return null}var De=0,Me=!1,We=0,Ge=_e._nextBeginningIndexes;if(Ge===null&&(Ge=_e._nextBeginningIndexes=we.prepareNextBeginningIndexes(_e.target)),xe=ue[0]===0?0:Ge[ue[0]-1],xe!==Le)for(;;)if(xe>=Le){if(De<=0)break;--De;var ht=ae[--We];xe=Ge[ht]}else{var Fe=ge[De]===Ne[xe];if(Fe){if(ae[We++]=xe,++De,De===ye){Me=!0;break}++xe}else xe=Ge[xe]}{if(Me)var qe=ae,ot=We;else var qe=ue,ot=Oe;for(var nt=0,je=-1,Ke=0;Ke<ye;++Ke){var xe=qe[Ke];je!==xe-1&&(nt-=xe),je=xe}Me||(nt*=1e3),nt-=Le-ye,_e.score=nt,_e.indexes=new Array(ot);for(var Ke=ot-1;Ke>=0;--Ke)_e.indexes[Ke]=qe[Ke];return _e}},prepareLowerCodes:function(ge){for(var _e=ge.length,Te=[],Ne=ge.toLowerCase(),ye=0;ye<_e;++ye)Te[ye]=Ne.charCodeAt(ye);return Te},prepareBeginningIndexes:function(ge){for(var _e=ge.length,Te=[],Ne=0,ye=!1,Le=!1,xe=0;xe<_e;++xe){var Oe=ge.charCodeAt(xe),Fe=Oe>=65&&Oe<=90,De=Fe||Oe>=97&&Oe<=122||Oe>=48&&Oe<=57,Me=Fe&&!ye||!Le||!De;ye=Fe,Le=De,Me&&(Te[Ne++]=xe)}return Te},prepareNextBeginningIndexes:function(ge){for(var _e=ge.length,Te=we.prepareBeginningIndexes(ge),Ne=[],ye=Te[0],Le=0,xe=0;xe<_e;++xe)ye>xe?Ne[xe]=ye:(ye=Te[++Le],Ne[xe]=ye===void 0?_e:ye);return Ne},cleanup:oe,new:re};return we}var ne=typeof commonjsRequire<"u"&&typeof window>"u",ie=new Map,se=new Map,le=[];le.total=0;var ue=[],ae=[];function oe(){ie.clear(),se.clear(),ue=[],ae=[]}function he(ve){for(var we=-9007199254740991,ge=ve.length-1;ge>=0;--ge){var _e=ve[ge];if(_e!==null){var Te=_e.score;Te>we&&(we=Te)}}return we===-9007199254740991?null:we}function ce(ve,we){var ge=ve[we];if(ge!==void 0)return ge;var _e=we;Array.isArray(we)||(_e=we.split("."));for(var Te=_e.length,Ne=-1;ve&&++Ne<Te;)ve=ve[_e[Ne]];return ve}function pe(ve){return typeof ve=="object"}var de=function(){var ve=[],we=0,ge={};function _e(){for(var Te=0,Ne=ve[Te],ye=1;ye<we;){var Le=ye+1;Te=ye,Le<we&&ve[Le].score<ve[ye].score&&(Te=Le),ve[Te-1>>1]=ve[Te],ye=1+(Te<<1)}for(var xe=Te-1>>1;Te>0&&Ne.score<ve[xe].score;xe=(Te=xe)-1>>1)ve[Te]=ve[xe];ve[Te]=Ne}return ge.add=function(Te){var Ne=we;ve[we++]=Te;for(var ye=Ne-1>>1;Ne>0&&Te.score<ve[ye].score;ye=(Ne=ye)-1>>1)ve[Ne]=ve[ye];ve[Ne]=Te},ge.poll=function(){if(we!==0){var Te=ve[0];return ve[0]=ve[--we],_e(),Te}},ge.peek=function(Te){if(we!==0)return ve[0]},ge.replaceTop=function(Te){ve[0]=Te,_e()},ge},me=de();return re()})})(fuzzysort$1);var fuzzysortExports=fuzzysort$1.exports;const fuzzysort=getDefaultExportFromCjs(fuzzysortExports);function freeze(te,ee){return ee===void 0&&(ee=Object),ee&&typeof ee.freeze=="function"?ee.freeze(te):te}let MIME_TYPE=freeze({HTML:"text/html",isHTML:function(te){return te===MIME_TYPE.HTML},XML_APPLICATION:"application/xml",XML_TEXT:"text/xml",XML_XHTML_APPLICATION:"application/xhtml+xml",XML_SVG_IMAGE:"image/svg+xml"}),NAMESPACE$1=freeze({HTML:"http://www.w3.org/1999/xhtml",isHTML:function(te){return te===NAMESPACE$1.HTML},SVG:"http://www.w3.org/2000/svg",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"});freeze({amp:"&",apos:"'",gt:">",lt:"<",quot:'"'});freeze({lt:"<",gt:">",amp:"&",quot:'"',apos:"'",Agrave:"",Aacute:"",Acirc:"",Atilde:"",Auml:"",Aring:"",AElig:"",Ccedil:"",Egrave:"",Eacute:"",Ecirc:"",Euml:"",Igrave:"",Iacute:"",Icirc:"",Iuml:"",ETH:"",Ntilde:"",Ograve:"",Oacute:"",Ocirc:"",Otilde:"",Ouml:"",Oslash:"",Ugrave:"",Uacute:"",Ucirc:"",Uuml:"",Yacute:"",THORN:"",szlig:"",agrave:"",aacute:"",acirc:"",atilde:"",auml:"",aring:"",aelig:"",ccedil:"",egrave:"",eacute:"",ecirc:"",euml:"",igrave:"",iacute:"",icirc:"",iuml:"",eth:"",ntilde:"",ograve:"",oacute:"",ocirc:"",otilde:"",ouml:"",oslash:"",ugrave:"",uacute:"",ucirc:"",uuml:"",yacute:"",thorn:"",yuml:"",nbsp:"",iexcl:"",cent:"",pound:"",curren:"",yen:"",brvbar:"",sect:"",uml:"",copy:"",ordf:"",laquo:"",not:"",shy:"",reg:"",macr:"",deg:"",plusmn:"",sup2:"",sup3:"",acute:"",micro:"",para:"",middot:"",cedil:"",sup1:"",ordm:"",raquo:"",frac14:"",frac12:"",frac34:"",iquest:"",times:"",divide:"",forall:"",part:"",exist:"",empty:"",nabla:"",isin:"",notin:"",ni:"",prod:"",sum:"",minus:"",lowast:"",radic:"",prop:"",infin:"",ang:"",and:"",or:"",cap:"",cup:"",int:"",there4:"",sim:"",cong:"",asymp:"",ne:"",equiv:"",le:"",ge:"",sub:"",sup:"",nsub:"",sube:"",supe:"",oplus:"",otimes:"",perp:"",sdot:"",Alpha:"",Beta:"",Gamma:"",Delta:"",Epsilon:"",Zeta:"",Eta:"",Theta:"",Iota:"",Kappa:"",Lambda:"",Mu:"",Nu:"",Xi:"",Omicron:"",Pi:"",Rho:"",Sigma:"",Tau:"",Upsilon:"",Phi:"",Chi:"",Psi:"",Omega:"",alpha:"",beta:"",gamma:"",delta:"",epsilon:"",zeta:"",eta:"",theta:"",iota:"",kappa:"",lambda:"",mu:"",nu:"",xi:"",omicron:"",pi:"",rho:"",sigmaf:"",sigma:"",tau:"",upsilon:"",phi:"",chi:"",psi:"",omega:"",thetasym:"",upsih:"",piv:"",OElig:"",oelig:"",Scaron:"",scaron:"",Yuml:"",fnof:"",circ:"",tilde:"",ensp:"",emsp:"",thinsp:"",zwnj:"",zwj:"",lrm:"",rlm:"",ndash:"",mdash:"",lsquo:"",rsquo:"",sbquo:"",ldquo:"",rdquo:"",bdquo:"",dagger:"",Dagger:"",bull:"",hellip:"",permil:"",prime:"",Prime:"",lsaquo:"",rsaquo:"",oline:"",euro:"",trade:"",larr:"",uarr:"",rarr:"",darr:"",harr:"",crarr:"",lceil:"",rceil:"",lfloor:"",rfloor:"",loz:"",spades:"",clubs:"",hearts:"",diams:""});var NAMESPACE=NAMESPACE$1;function copy(te,ee){for(var re in te)ee[re]=te[re]}function _extends(te,ee){var re=te.prototype;if(!(re instanceof ee)){let ne=function(){};ne.prototype=ee.prototype,ne=new ne,copy(re,ne),te.prototype=re=ne}re.constructor!=te&&(typeof te!="function"&&console.error("unknow Class:"+te),re.constructor=te)}var NodeType={},ELEMENT_NODE=NodeType.ELEMENT_NODE=1,ATTRIBUTE_NODE=NodeType.ATTRIBUTE_NODE=2,TEXT_NODE=NodeType.TEXT_NODE=3,CDATA_SECTION_NODE=NodeType.CDATA_SECTION_NODE=4,ENTITY_REFERENCE_NODE=NodeType.ENTITY_REFERENCE_NODE=5,ENTITY_NODE=NodeType.ENTITY_NODE=6,PROCESSING_INSTRUCTION_NODE=NodeType.PROCESSING_INSTRUCTION_NODE=7,COMMENT_NODE=NodeType.COMMENT_NODE=8,DOCUMENT_NODE=NodeType.DOCUMENT_NODE=9,DOCUMENT_TYPE_NODE=NodeType.DOCUMENT_TYPE_NODE=10,DOCUMENT_FRAGMENT_NODE=NodeType.DOCUMENT_FRAGMENT_NODE=11,NOTATION_NODE=NodeType.NOTATION_NODE=12,ExceptionCode={},ExceptionMessage={};ExceptionCode.INDEX_SIZE_ERR=(ExceptionMessage[1]="Index size error",1);ExceptionCode.DOMSTRING_SIZE_ERR=(ExceptionMessage[2]="DOMString size error",2);var HIERARCHY_REQUEST_ERR=ExceptionCode.HIERARCHY_REQUEST_ERR=(ExceptionMessage[3]="Hierarchy request error",3);ExceptionCode.WRONG_DOCUMENT_ERR=(ExceptionMessage[4]="Wrong document",4);ExceptionCode.INVALID_CHARACTER_ERR=(ExceptionMessage[5]="Invalid character",5);ExceptionCode.NO_DATA_ALLOWED_ERR=(ExceptionMessage[6]="No data allowed",6);ExceptionCode.NO_MODIFICATION_ALLOWED_ERR=(ExceptionMessage[7]="No modification allowed",7);var NOT_FOUND_ERR=ExceptionCode.NOT_FOUND_ERR=(ExceptionMessage[8]="Not found",8);ExceptionCode.NOT_SUPPORTED_ERR=(ExceptionMessage[9]="Not supported",9);var INUSE_ATTRIBUTE_ERR=ExceptionCode.INUSE_ATTRIBUTE_ERR=(ExceptionMessage[10]="Attribute in use",10);ExceptionCode.INVALID_STATE_ERR=(ExceptionMessage[11]="Invalid state",11);ExceptionCode.SYNTAX_ERR=(ExceptionMessage[12]="Syntax error",12);ExceptionCode.INVALID_MODIFICATION_ERR=(ExceptionMessage[13]="Invalid modification",13);ExceptionCode.NAMESPACE_ERR=(ExceptionMessage[14]="Invalid namespace",14);ExceptionCode.INVALID_ACCESS_ERR=(ExceptionMessage[15]="Invalid access",15);function DOMException(te,ee){if(ee instanceof Error)var re=ee;else re=this,Error.call(this,ExceptionMessage[te]),this.message=ExceptionMessage[te],Error.captureStackTrace&&Error.captureStackTrace(this,DOMException);return re.code=te,ee&&(this.message=this.message+": "+ee),re}DOMException.prototype=Error.prototype;copy(ExceptionCode,DOMException);function NodeList(){}NodeList.prototype={length:0,item:function(te){return this[te]||null},toString:function(te,ee){for(var re=[],ne=0;ne<this.length;ne++)serializeToString(this[ne],re,te,ee);return re.join("")}};function LiveNodeList(te,ee){this._node=te,this._refresh=ee,_updateLiveList(this)}function _updateLiveList(te){var ee=te._node._inc||te._node.ownerDocument._inc;if(te._inc!=ee){var re=te._refresh(te._node);__set__(te,"length",re.length),copy(re,te),te._inc=ee}}LiveNodeList.prototype.item=function(te){return _updateLiveList(this),this[te]};_extends(LiveNodeList,NodeList);function NamedNodeMap(){}function _findNodeIndex(te,ee){for(var re=te.length;re--;)if(te[re]===ee)return re}function _addNamedNode(te,ee,re,ne){if(ne?ee[_findNodeIndex(ee,ne)]=re:ee[ee.length++]=re,te){re.ownerElement=te;var ie=te.ownerDocument;ie&&(ne&&_onRemoveAttribute(ie,te,ne),_onAddAttribute(ie,te,re))}}function _removeNamedNode(te,ee,re){var ne=_findNodeIndex(ee,re);if(ne>=0){for(var ie=ee.length-1;ne<ie;)ee[ne]=ee[++ne];if(ee.length=ie,te){var se=te.ownerDocument;se&&(_onRemoveAttribute(se,te,re),re.ownerElement=null)}}else throw DOMException(NOT_FOUND_ERR,new Error(te.tagName+"@"+re))}NamedNodeMap.prototype={length:0,item:NodeList.prototype.item,getNamedItem:function(te){for(var ee=this.length;ee--;){var re=this[ee];if(re.nodeName==te)return re}},setNamedItem:function(te){var ee=te.ownerElement;if(ee&&ee!=this._ownerElement)throw new DOMException(INUSE_ATTRIBUTE_ERR);var re=this.getNamedItem(te.nodeName);return _addNamedNode(this._ownerElement,this,te,re),re},setNamedItemNS:function(te){var ee=te.ownerElement,re;if(ee&&ee!=this._ownerElement)throw new DOMException(INUSE_ATTRIBUTE_ERR);return re=this.getNamedItemNS(te.namespaceURI,te.localName),_addNamedNode(this._ownerElement,this,te,re),re},removeNamedItem:function(te){var ee=this.getNamedItem(te);return _removeNamedNode(this._ownerElement,this,ee),ee},removeNamedItemNS:function(te,ee){var re=this.getNamedItemNS(te,ee);return _removeNamedNode(this._ownerElement,this,re),re},getNamedItemNS:function(te,ee){for(var re=this.length;re--;){var ne=this[re];if(ne.localName==ee&&ne.namespaceURI==te)return ne}return null}};function DOMImplementation$1(){}DOMImplementation$1.prototype={hasFeature:function(te,ee){return!0},createDocument:function(te,ee,re){var ne=new Document;if(ne.implementation=this,ne.childNodes=new NodeList,ne.doctype=re||null,re&&ne.appendChild(re),ee){var ie=ne.createElementNS(te,ee);ne.appendChild(ie)}return ne},createDocumentType:function(te,ee,re){var ne=new DocumentType;return ne.name=te,ne.nodeName=te,ne.publicId=ee||"",ne.systemId=re||"",ne}};function Node$1(){}Node$1.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(te,ee){return _insertBefore(this,te,ee)},replaceChild:function(te,ee){this.insertBefore(te,ee),ee&&this.removeChild(ee)},removeChild:function(te){return _removeChild(this,te)},appendChild:function(te){return this.insertBefore(te,null)},hasChildNodes:function(){return this.firstChild!=null},cloneNode:function(te){return cloneNode(this.ownerDocument||this,this,te)},normalize:function(){for(var te=this.firstChild;te;){var ee=te.nextSibling;ee&&ee.nodeType==TEXT_NODE&&te.nodeType==TEXT_NODE?(this.removeChild(ee),te.appendData(ee.data)):(te.normalize(),te=ee)}},isSupported:function(te,ee){return this.ownerDocument.implementation.hasFeature(te,ee)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(te){for(var ee=this;ee;){var re=ee._nsMap;if(re){for(var ne in re)if(re[ne]==te)return ne}ee=ee.nodeType==ATTRIBUTE_NODE?ee.ownerDocument:ee.parentNode}return null},lookupNamespaceURI:function(te){for(var ee=this;ee;){var re=ee._nsMap;if(re&&te in re)return re[te];ee=ee.nodeType==ATTRIBUTE_NODE?ee.ownerDocument:ee.parentNode}return null},isDefaultNamespace:function(te){var ee=this.lookupPrefix(te);return ee==null}};function _xmlEncoder(te){return te=="<"&&"&lt;"||te==">"&&"&gt;"||te=="&"&&"&amp;"||te=='"'&&"&quot;"||"&#"+te.charCodeAt()+";"}copy(NodeType,Node$1);copy(NodeType,Node$1.prototype);function _visitNode(te,ee){if(ee(te))return!0;if(te=te.firstChild)do if(_visitNode(te,ee))return!0;while(te=te.nextSibling)}function Document(){}function _onAddAttribute(te,ee,re){te&&te._inc++;var ne=re.namespaceURI;ne===NAMESPACE.XMLNS&&(ee._nsMap[re.prefix?re.localName:""]=re.value)}function _onRemoveAttribute(te,ee,re,ne){te&&te._inc++;var ie=re.namespaceURI;ie===NAMESPACE.XMLNS&&delete ee._nsMap[re.prefix?re.localName:""]}function _onUpdateChild(te,ee,re){if(te&&te._inc){te._inc++;var ne=ee.childNodes;if(re)ne[ne.length++]=re;else{for(var ie=ee.firstChild,se=0;ie;)ne[se++]=ie,ie=ie.nextSibling;ne.length=se}}}function _removeChild(te,ee){var re=ee.previousSibling,ne=ee.nextSibling;return re?re.nextSibling=ne:te.firstChild=ne,ne?ne.previousSibling=re:te.lastChild=re,_onUpdateChild(te.ownerDocument,te),ee}function _insertBefore(te,ee,re){var ne=ee.parentNode;if(ne&&ne.removeChild(ee),ee.nodeType===DOCUMENT_FRAGMENT_NODE){var ie=ee.firstChild;if(ie==null)return ee;var se=ee.lastChild}else ie=se=ee;var le=re?re.previousSibling:te.lastChild;ie.previousSibling=le,se.nextSibling=re,le?le.nextSibling=ie:te.firstChild=ie,re==null?te.lastChild=se:re.previousSibling=se;do ie.parentNode=te;while(ie!==se&&(ie=ie.nextSibling));return _onUpdateChild(te.ownerDocument||te,te),ee.nodeType==DOCUMENT_FRAGMENT_NODE&&(ee.firstChild=ee.lastChild=null),ee}function _appendSingleChild(te,ee){var re=ee.parentNode;if(re){var ne=te.lastChild;re.removeChild(ee);var ne=te.lastChild}var ne=te.lastChild;return ee.parentNode=te,ee.previousSibling=ne,ee.nextSibling=null,ne?ne.nextSibling=ee:te.firstChild=ee,te.lastChild=ee,_onUpdateChild(te.ownerDocument,te,ee),ee}Document.prototype={nodeName:"#document",nodeType:DOCUMENT_NODE,doctype:null,documentElement:null,_inc:1,insertBefore:function(te,ee){if(te.nodeType==DOCUMENT_FRAGMENT_NODE){for(var re=te.firstChild;re;){var ne=re.nextSibling;this.insertBefore(re,ee),re=ne}return te}return this.documentElement==null&&te.nodeType==ELEMENT_NODE&&(this.documentElement=te),_insertBefore(this,te,ee),te.ownerDocument=this,te},removeChild:function(te){return this.documentElement==te&&(this.documentElement=null),_removeChild(this,te)},importNode:function(te,ee){return importNode(this,te,ee)},getElementById:function(te){var ee=null;return _visitNode(this.documentElement,function(re){if(re.nodeType==ELEMENT_NODE&&re.getAttribute("id")==te)return ee=re,!0}),ee},getElementsByClassName:function(te){var ee=new RegExp("(^|\\s)"+te+"(\\s|$)");return new LiveNodeList(this,function(re){var ne=[];return _visitNode(re.documentElement,function(ie){ie!==re&&ie.nodeType==ELEMENT_NODE&&ee.test(ie.getAttribute("class"))&&ne.push(ie)}),ne})},createElement:function(te){var ee=new Element;ee.ownerDocument=this,ee.nodeName=te,ee.tagName=te,ee.localName=te,ee.childNodes=new NodeList;var re=ee.attributes=new NamedNodeMap;return re._ownerElement=ee,ee},createDocumentFragment:function(){var te=new DocumentFragment;return te.ownerDocument=this,te.childNodes=new NodeList,te},createTextNode:function(te){var ee=new Text;return ee.ownerDocument=this,ee.appendData(te),ee},createComment:function(te){var ee=new Comment;return ee.ownerDocument=this,ee.appendData(te),ee},createCDATASection:function(te){var ee=new CDATASection;return ee.ownerDocument=this,ee.appendData(te),ee},createProcessingInstruction:function(te,ee){var re=new ProcessingInstruction;return re.ownerDocument=this,re.tagName=re.target=te,re.nodeValue=re.data=ee,re},createAttribute:function(te){var ee=new Attr;return ee.ownerDocument=this,ee.name=te,ee.nodeName=te,ee.localName=te,ee.specified=!0,ee},createEntityReference:function(te){var ee=new EntityReference;return ee.ownerDocument=this,ee.nodeName=te,ee},createElementNS:function(te,ee){var re=new Element,ne=ee.split(":"),ie=re.attributes=new NamedNodeMap;return re.childNodes=new NodeList,re.ownerDocument=this,re.nodeName=ee,re.tagName=ee,re.namespaceURI=te,ne.length==2?(re.prefix=ne[0],re.localName=ne[1]):re.localName=ee,ie._ownerElement=re,re},createAttributeNS:function(te,ee){var re=new Attr,ne=ee.split(":");return re.ownerDocument=this,re.nodeName=ee,re.name=ee,re.namespaceURI=te,re.specified=!0,ne.length==2?(re.prefix=ne[0],re.localName=ne[1]):re.localName=ee,re}};_extends(Document,Node$1);function Element(){this._nsMap={}}Element.prototype={nodeType:ELEMENT_NODE,hasAttribute:function(te){return this.getAttributeNode(te)!=null},getAttribute:function(te){var ee=this.getAttributeNode(te);return ee&&ee.value||""},getAttributeNode:function(te){return this.attributes.getNamedItem(te)},setAttribute:function(te,ee){var re=this.ownerDocument.createAttribute(te);re.value=re.nodeValue=""+ee,this.setAttributeNode(re)},removeAttribute:function(te){var ee=this.getAttributeNode(te);ee&&this.removeAttributeNode(ee)},appendChild:function(te){return te.nodeType===DOCUMENT_FRAGMENT_NODE?this.insertBefore(te,null):_appendSingleChild(this,te)},setAttributeNode:function(te){return this.attributes.setNamedItem(te)},setAttributeNodeNS:function(te){return this.attributes.setNamedItemNS(te)},removeAttributeNode:function(te){return this.attributes.removeNamedItem(te.nodeName)},removeAttributeNS:function(te,ee){var re=this.getAttributeNodeNS(te,ee);re&&this.removeAttributeNode(re)},hasAttributeNS:function(te,ee){return this.getAttributeNodeNS(te,ee)!=null},getAttributeNS:function(te,ee){var re=this.getAttributeNodeNS(te,ee);return re&&re.value||""},setAttributeNS:function(te,ee,re){var ne=this.ownerDocument.createAttributeNS(te,ee);ne.value=ne.nodeValue=""+re,this.setAttributeNode(ne)},getAttributeNodeNS:function(te,ee){return this.attributes.getNamedItemNS(te,ee)},getElementsByTagName:function(te){return new LiveNodeList(this,function(ee){var re=[];return _visitNode(ee,function(ne){ne!==ee&&ne.nodeType==ELEMENT_NODE&&(te==="*"||ne.tagName==te)&&re.push(ne)}),re})},getElementsByTagNameNS:function(te,ee){return new LiveNodeList(this,function(re){var ne=[];return _visitNode(re,function(ie){ie!==re&&ie.nodeType===ELEMENT_NODE&&(te==="*"||ie.namespaceURI===te)&&(ee==="*"||ie.localName==ee)&&ne.push(ie)}),ne})}};Document.prototype.getElementsByTagName=Element.prototype.getElementsByTagName;Document.prototype.getElementsByTagNameNS=Element.prototype.getElementsByTagNameNS;_extends(Element,Node$1);function Attr(){}Attr.prototype.nodeType=ATTRIBUTE_NODE;_extends(Attr,Node$1);function CharacterData(){}CharacterData.prototype={data:"",substringData:function(te,ee){return this.data.substring(te,te+ee)},appendData:function(te){te=this.data+te,this.nodeValue=this.data=te,this.length=te.length},insertData:function(te,ee){this.replaceData(te,0,ee)},appendChild:function(te){throw new Error(ExceptionMessage[HIERARCHY_REQUEST_ERR])},deleteData:function(te,ee){this.replaceData(te,ee,"")},replaceData:function(te,ee,re){var ne=this.data.substring(0,te),ie=this.data.substring(te+ee);re=ne+re+ie,this.nodeValue=this.data=re,this.length=re.length}};_extends(CharacterData,Node$1);function Text(){}Text.prototype={nodeName:"#text",nodeType:TEXT_NODE,splitText:function(te){var ee=this.data,re=ee.substring(te);ee=ee.substring(0,te),this.data=this.nodeValue=ee,this.length=ee.length;var ne=this.ownerDocument.createTextNode(re);return this.parentNode&&this.parentNode.insertBefore(ne,this.nextSibling),ne}};_extends(Text,CharacterData);function Comment(){}Comment.prototype={nodeName:"#comment",nodeType:COMMENT_NODE};_extends(Comment,CharacterData);function CDATASection(){}CDATASection.prototype={nodeName:"#cdata-section",nodeType:CDATA_SECTION_NODE};_extends(CDATASection,CharacterData);function DocumentType(){}DocumentType.prototype.nodeType=DOCUMENT_TYPE_NODE;_extends(DocumentType,Node$1);function Notation(){}Notation.prototype.nodeType=NOTATION_NODE;_extends(Notation,Node$1);function Entity(){}Entity.prototype.nodeType=ENTITY_NODE;_extends(Entity,Node$1);function EntityReference(){}EntityReference.prototype.nodeType=ENTITY_REFERENCE_NODE;_extends(EntityReference,Node$1);function DocumentFragment(){}DocumentFragment.prototype.nodeName="#document-fragment";DocumentFragment.prototype.nodeType=DOCUMENT_FRAGMENT_NODE;_extends(DocumentFragment,Node$1);function ProcessingInstruction(){}ProcessingInstruction.prototype.nodeType=PROCESSING_INSTRUCTION_NODE;_extends(ProcessingInstruction,Node$1);Node$1.prototype.toString=nodeSerializeToString;function nodeSerializeToString(te,ee){var re=[],ne=this.nodeType==9&&this.documentElement||this,ie=ne.prefix,se=ne.namespaceURI;if(se&&ie==null){var ie=ne.lookupPrefix(se);if(ie==null)var le=[{namespace:se,prefix:null}]}return serializeToString(this,re,te,ee,le),re.join("")}function needNamespaceDefine(te,ee,re){var ne=te.prefix||"",ie=te.namespaceURI;if(!ie||ne==="xml"&&ie===NAMESPACE.XML||ie===NAMESPACE.XMLNS)return!1;for(var se=re.length;se--;){var le=re[se];if(le.prefix===ne)return le.namespace!==ie}return!0}function serializeToString(te,ee,re,ne,ie){if(ne)if(te=ne(te),te){if(typeof te=="string"){ee.push(te);return}}else return;switch(te.nodeType){case ELEMENT_NODE:ie||(ie=[]),ie.length;var se=te.attributes,le=se.length,de=te.firstChild,ue=te.tagName;re=NAMESPACE.isHTML(te.namespaceURI)||re,ee.push("<",ue);for(var ae=0;ae<le;ae++){var oe=se.item(ae);oe.prefix=="xmlns"?ie.push({prefix:oe.localName,namespace:oe.value}):oe.nodeName=="xmlns"&&ie.push({prefix:"",namespace:oe.value})}for(var ae=0;ae<le;ae++){var oe=se.item(ae);if(needNamespaceDefine(oe,re,ie)){var he=oe.prefix||"",ce=oe.namespaceURI,pe=he?" xmlns:"+he:" xmlns";ee.push(pe,'="',ce,'"'),ie.push({prefix:he,namespace:ce})}serializeToString(oe,ee,re,ne,ie)}if(needNamespaceDefine(te,re,ie)){var he=te.prefix||"",ce=te.namespaceURI,pe=he?" xmlns:"+he:" xmlns";ee.push(pe,'="',ce,'"'),ie.push({prefix:he,namespace:ce})}if(de||re&&!/^(?:meta|link|img|br|hr|input)$/i.test(ue)){if(ee.push(">"),re&&/^script$/i.test(ue))for(;de;)de.data?ee.push(de.data):serializeToString(de,ee,re,ne,ie),de=de.nextSibling;else for(;de;)serializeToString(de,ee,re,ne,ie),de=de.nextSibling;ee.push("</",ue,">")}else ee.push("/>");return;case DOCUMENT_NODE:case DOCUMENT_FRAGMENT_NODE:for(var de=te.firstChild;de;)serializeToString(de,ee,re,ne,ie),de=de.nextSibling;return;case ATTRIBUTE_NODE:return ee.push(" ",te.name,'="',te.value.replace(/[<&"]/g,_xmlEncoder),'"');case TEXT_NODE:return ee.push(te.data.replace(/[<&]/g,_xmlEncoder).replace(/]]>/g,"]]&gt;"));case CDATA_SECTION_NODE:return ee.push("<![CDATA[",te.data,"]]>");case COMMENT_NODE:return ee.push("<!--",te.data,"-->");case DOCUMENT_TYPE_NODE:var me=te.publicId,ve=te.systemId;if(ee.push("<!DOCTYPE ",te.name),me)ee.push(" PUBLIC ",me),ve&&ve!="."&&ee.push(" ",ve),ee.push(">");else if(ve&&ve!=".")ee.push(" SYSTEM ",ve,">");else{var we=te.internalSubset;we&&ee.push(" [",we,"]"),ee.push(">")}return;case PROCESSING_INSTRUCTION_NODE:return ee.push("<?",te.target," ",te.data,"?>");case ENTITY_REFERENCE_NODE:return ee.push("&",te.nodeName,";");default:ee.push("??",te.nodeName)}}function importNode(te,ee,re){var ne;switch(ee.nodeType){case ELEMENT_NODE:ne=ee.cloneNode(!1),ne.ownerDocument=te;case DOCUMENT_FRAGMENT_NODE:break;case ATTRIBUTE_NODE:re=!0;break}if(ne||(ne=ee.cloneNode(!1)),ne.ownerDocument=te,ne.parentNode=null,re)for(var ie=ee.firstChild;ie;)ne.appendChild(importNode(te,ie,re)),ie=ie.nextSibling;return ne}function cloneNode(te,ee,re){var ne=new ee.constructor;for(var ie in ee){var se=ee[ie];typeof se!="object"&&se!=ne[ie]&&(ne[ie]=se)}switch(ee.childNodes&&(ne.childNodes=new NodeList),ne.ownerDocument=te,ne.nodeType){case ELEMENT_NODE:var le=ee.attributes,ue=ne.attributes=new NamedNodeMap,ae=le.length;ue._ownerElement=ne;for(var oe=0;oe<ae;oe++)ne.setAttributeNode(cloneNode(te,le.item(oe),!0));break;case ATTRIBUTE_NODE:re=!0}if(re)for(var he=ee.firstChild;he;)ne.appendChild(cloneNode(te,he,re)),he=he.nextSibling;return ne}function __set__(te,ee,re){te[ee]=re}try{if(Object.defineProperty){let te=function(ee){switch(ee.nodeType){case ELEMENT_NODE:case DOCUMENT_FRAGMENT_NODE:var re=[];for(ee=ee.firstChild;ee;)ee.nodeType!==7&&ee.nodeType!==8&&re.push(te(ee)),ee=ee.nextSibling;return re.join("");default:return ee.nodeValue}};Object.defineProperty(LiveNodeList.prototype,"length",{get:function(){return _updateLiveList(this),this.$$length}}),Object.defineProperty(Node$1.prototype,"textContent",{get:function(){return te(this)},set:function(ee){switch(this.nodeType){case ELEMENT_NODE:case DOCUMENT_FRAGMENT_NODE:for(;this.firstChild;)this.removeChild(this.firstChild);(ee||String(ee))&&this.appendChild(this.ownerDocument.createTextNode(ee));break;default:this.data=ee,this.value=ee,this.nodeValue=ee}}}),__set__=function(ee,re,ne){ee["$$"+re]=ne}}}catch(te){}var nameStartChar=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,nameChar=new RegExp("[\\-\\.0-9"+nameStartChar.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]");new RegExp("^"+nameStartChar.source+nameChar.source+"*(?::"+nameStartChar.source+nameChar.source+"*)?$");function ParseError$1(te,ee){this.message=te,this.locator=ee,Error.captureStackTrace&&Error.captureStackTrace(this,ParseError$1)}ParseError$1.prototype=new Error;ParseError$1.prototype.name=ParseError$1.name;let DOMImplementation=DOMImplementation$1;function DOMHandler(){this.cdata=!1}function position(te,ee){ee.lineNumber=te.lineNumber,ee.columnNumber=te.columnNumber}DOMHandler.prototype={startDocument:function(){this.doc=new DOMImplementation().createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(te,ee,re,ne){var ie=this.doc,se=ie.createElementNS(te,re||ee),le=ne.length;appendElement(this,se),this.currentElement=se,this.locator&&position(this.locator,se);for(var ue=0;ue<le;ue++){var te=ne.getURI(ue),ae=ne.getValue(ue),re=ne.getQName(ue),oe=ie.createAttributeNS(te,re);this.locator&&position(ne.getLocator(ue),oe),oe.value=oe.nodeValue=ae,se.setAttributeNode(oe)}},endElement:function(te,ee,re){var ne=this.currentElement;ne.tagName,this.currentElement=ne.parentNode},startPrefixMapping:function(te,ee){},endPrefixMapping:function(te){},processingInstruction:function(te,ee){var re=this.doc.createProcessingInstruction(te,ee);this.locator&&position(this.locator,re),appendElement(this,re)},ignorableWhitespace:function(te,ee,re){},characters:function(te,ee,re){if(te=_toString.apply(this,arguments),te){if(this.cdata)var ne=this.doc.createCDATASection(te);else var ne=this.doc.createTextNode(te);this.currentElement?this.currentElement.appendChild(ne):/^\s*$/.test(te)&&this.doc.appendChild(ne),this.locator&&position(this.locator,ne)}},skippedEntity:function(te){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(te){(this.locator=te)&&(te.lineNumber=0)},comment:function(te,ee,re){te=_toString.apply(this,arguments);var ne=this.doc.createComment(te);this.locator&&position(this.locator,ne),appendElement(this,ne)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(te,ee,re){var ne=this.doc.implementation;if(ne&&ne.createDocumentType){var ie=ne.createDocumentType(te,ee,re);this.locator&&position(this.locator,ie),appendElement(this,ie)}},warning:function(te){console.warn("[xmldom warning]	"+te,_locator(this.locator))},error:function(te){console.error("[xmldom error]	"+te,_locator(this.locator))},fatalError:function(te){throw new ParseError(te,this.locator)}};function _locator(te){if(te)return`
@`+(te.systemId||"")+"#[line:"+te.lineNumber+",col:"+te.columnNumber+"]"}function _toString(te,ee,re){return typeof te=="string"?te.substr(ee,re):te.length>=ee+re||ee?new java.lang.String(te,ee,re)+"":te}"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(te){DOMHandler.prototype[te]=function(){return null}});function appendElement(te,ee){te.currentElement?te.currentElement.appendChild(ee):te.doc.appendChild(ee)}var ParseError=ParseError$1;class ModelError extends Error{constructor(ee,re){super(ee),this.name="ModelError",this.primitive=re.primitive,this.showEditor=re.showEditor,this.line=re.line,this.details=re.details,this.code=re.code}}function isTrue(te){return te===1||te==="true"||te===!0}function toHTML(te){return te.replace(/[&<>'"]/g,ee=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;","`":"&#96;"})[ee])}function commaStr(te){if(typeof te=="string")return escape(te);if(typeof te=="boolean")return te.toString();if(te==null)return"";if(te>=1e9||te<=1e-9&&te!==0)return te.toPrecision(3);{te=round$1(te,9)+"";let ee=te.split("."),re=ee[0],ne=ee.length>1?"."+ee[1]:"",ie=/(\d+)(\d{3})/;for(;ie.test(re);)re=re.replace(ie,"$1,$2");return re+ne}}function round$1(te,ee=15){return+te.toPrecision(ee)}class Primitive{constructor(ee,re){this._node=ee,this.model=null;for(let ne in re)if(ne in this)this[ne]=re[ne];else throw new Error("Unknown property: "+ne)}delete(){let ee=this.model.find(ne=>ne instanceof Flow||ne instanceof Transition||ne instanceof Link),re=this._node;re.parent.children.includes(re)&&re.parent.children.splice(re.parent.children.indexOf(re),1),ee.forEach(ne=>{ne._node.source===re&&(ne._node.source=null,ne._node.target&&ne._node.target.parent!==ne._node.parent&&(ne.parent=ne._node.target.parent.primitive(this.model))),ne._node.target===re&&(ne._node.target=null,ne._node.source&&ne._node.source.parent!==ne._node.parent&&(ne.parent=ne._node.source.parent.primitive(this.model)))})}get parent(){let ee=this._node.parent;return ee.value&&ee.value.nodeName==="root"||ee.id==="1"?null:ee.primitive(this.model)}set parent(ee){let re;ee===null?re=this.model._graph.children[0].children[0]:re=ee._node,this._node.parent.children.includes(this._node)&&this._node.parent.children.splice(this._node.parent.children.indexOf(this._node),1),re.addChild(this._node)}getParent(ee){let re=this.parent;return re?ee(re)?re:re.getParent(ee):null}isInAgent(){return!!this.getParent(ee=>ee instanceof Agent)}neighbors(){let ee=[],re=this.model.findFlows(),ne=this.model.findLinks();if((this instanceof Flow||this instanceof Link||this instanceof Transition)&&(this.start&&ee.push({item:this.start,type:"direct"}),this.end&&ee.push({item:this.end,type:"direct"})),this instanceof Population&&this.agentBase&&(ee=ee.concat(se(this))),this instanceof Stock)for(let le=0;le<re.length;le++)re[le].start===this&&ee.push({item:re[le],type:"direct",linkHidden:!0}),re[le].end===this&&ee.push({item:re[le],type:"direct",linkHidden:!0});for(let le=0;le<ne.length;le++){if(ne[le].start===this&&ne[le].end){let ue=!ne[le].biDirectional;ee.push({item:ne[le].end,type:"direct",linkHidden:ue}),ee=ee.concat(se(ne[le].end,ue))}ne[le].end===this&&ne[le].start&&!(ne[le].start.isInAgent()&&!this.isInAgent())&&(ee.push({item:ne[le].start,type:"direct"}),ee=ee.concat(se(ne[le].start)))}ee=ee.filter(le=>!!le);let ie=[];for(let le=0;le<ee.length;le++){if(ee[le].linkHidden)continue;let ue=!1;for(let ae=0;ae<ie.length;ae++)if(ie[ae].type===ee[le].type&&ie[ae].item.id===ee[le].item.id){ue=!0,ie[ae].linkHidden&&!ee[le].linkHidden&&(ie[ae].linkHidden=!1);break}ue||(ee[le].item instanceof ValuedPrimitive||ee[le].item instanceof Population)&&ie.push(ee[le])}return ie;function se(le,ue){let ae=[];return le instanceof Population&&le.agentBase&&le.agentBase.children().forEach(he=>{he instanceof ValuedPrimitive&&ae.push({item:he,type:"agent",linkHidden:ue,name:he.name})}),ae.sort((oe,he)=>oe.name===he.name?0:oe.name>he.name?1:-1),ae}}get id(){return this._node.id}get name(){return this._node.getAttribute("name")}set name(ee){this._node.setAttribute("name",ee)}get note(){return this._node.getAttribute("Note")}set note(ee){this._node.setAttribute("Note",ee)}}class ValuedPrimitive extends Primitive{get units(){return this._node.getAttribute("Units")}set units(ee){this._node.setAttribute("Units",ee)}get constraints(){let ee={};return isTrue(this._node.getAttribute("MinConstraintUsed"))&&(ee.min=+this._node.getAttribute("MinConstraint")),isTrue(this._node.getAttribute("MaxConstraintUsed"))&&(ee.max=+this._node.getAttribute("MaxConstraint")),ee}set constraints(ee){this._node.setAttribute("MinConstraint",ee.min),this._node.setAttribute("MinConstraintUsed","min"in ee),this._node.setAttribute("MaxConstraint",ee.max),this._node.setAttribute("MaxConstraintUsed","max"in ee)}get external(){return isTrue(this._node.getAttribute("ShowSlider"))}set external(ee){this._node.setAttribute("ShowSlider",ee)}}class Stock extends ValuedPrimitive{get initial(){return this._node.getAttribute("InitialValue")||""}set initial(ee){this._node.setAttribute("InitialValue",""+ee)}get type(){return this._node.getAttribute("StockMode")}set type(ee){this._node.setAttribute("StockMode",""+ee)}get delay(){return this._node.getAttribute("Delay")}set delay(ee){this._node.setAttribute("Delay",""+ee)}get nonNegative(){return isTrue(this._node.getAttribute("NonNegative"))}set nonNegative(ee){this._node.setAttribute("NonNegative",ee)}}class Variable extends ValuedPrimitive{get value(){return this._node.getAttribute("Equation")||""}set value(ee){this._node.setAttribute("Equation",""+ee)}}class Converter extends ValuedPrimitive{get interpolation(){return this._node.getAttribute("Interpolation")}set interpolation(ee){this._node.setAttribute("Interpolation",ee)}get values(){return this._node.getAttribute("Data").split(";").map(ee=>{let re=ee.split(",");if(re.length!==2)throw new ModelError(`Converter data point should have the form "x, y", got "${ee}"`,{primitive:this,code:2100});let ne={x:+re[0],y:+re[1]};if(isNaN(ne.x)||isNaN(ne.y))throw new ModelError(`Converter has invalid data "${ee}"`,{primitive:this,showEditor:!0,code:2101});return ne})}set values(ee){this._node.setAttribute("Data",ee.map(re=>re.x+","+re.y).join(";"))}get input(){let ee=this._node.getAttribute("Source");return ee==="Time"?ee:this.model.getId(ee)}set input(ee){this._node.setAttribute("Source",ee==="Time"?ee:ee.id)}}class Flow extends ValuedPrimitive{get rate(){return this._node.getAttribute("FlowRate")||""}set rate(ee){this._node.setAttribute("FlowRate",""+ee)}get start(){return this._node.source?this._node.source.primitive(this.model):null}set start(ee){this._node.source=ee._node}get end(){return this._node.target?this._node.target.primitive(this.model):null}set end(ee){this._node.target=ee._node}get nonNegative(){return isTrue(this._node.getAttribute("OnlyPositive"))}set nonNegative(ee){this._node.setAttribute("OnlyPositive",ee)}}class Link extends Primitive{get biDirectional(){return isTrue(this._node.getAttribute("BiDirectional"))}set biDirectional(ee){this._node.setAttribute("BiDirectional",ee)}get start(){return this._node.source?this._node.source.primitive(this.model):null}set start(ee){this._node.source=ee._node}get end(){return this._node.target?this._node.target.primitive(this.model):null}set end(ee){this._node.target=ee._node}}class State extends ValuedPrimitive{get startActive(){return this._node.getAttribute("Active")}set startActive(ee){this._node.setAttribute("Active",ee)}get residency(){return this._node.getAttribute("Residency")}set residency(ee){this._node.setAttribute("Residency",ee)}}class Transition extends ValuedPrimitive{get value(){return this._node.getAttribute("Value")||""}set value(ee){this._node.setAttribute("Value",""+ee)}get start(){return this._node.source?this._node.source.primitive(this.model):null}set start(ee){this._node.source=ee._node}get end(){return this._node.target?this._node.target.primitive(this.model):null}set end(ee){this._node.target=ee._node}get recalculate(){return isTrue(this._node.getAttribute("Recalculate"))}set recalculate(ee){this._node.setAttribute("Recalculate",ee)}get repeat(){return isTrue(this._node.getAttribute("Repeat"))}set repeat(ee){this._node.setAttribute("Repeat",ee)}get trigger(){return this._node.getAttribute("Trigger")}set trigger(ee){this._node.setAttribute("Trigger",ee)}}class Action extends Primitive{get value(){return this._node.getAttribute("Value")||""}set value(ee){this._node.setAttribute("Value",""+ee)}get action(){return this._node.getAttribute("Action")}set action(ee){this._node.setAttribute("Action",""+ee)}get recalculate(){return isTrue(this._node.getAttribute("Recalculate"))}set recalculate(ee){this._node.setAttribute("Recalculate",ee)}get repeat(){return isTrue(this._node.getAttribute("Repeat"))}set repeat(ee){this._node.setAttribute("Repeat",ee)}get trigger(){return this._node.getAttribute("Trigger")}set trigger(ee){this._node.setAttribute("Trigger",ee)}}class Population extends Primitive{get agentBase(){let ee=this._node.getAttribute("Agent");return ee?this.model.getId(ee):null}set agentBase(ee){this._node.setAttribute("Agent",ee.id)}get populationSize(){return+this._node.getAttribute("Size")}set populationSize(ee){this._node.setAttribute("Size",ee)}get geoUnits(){return this._node.getAttribute("GeoDimUnits")}set geoUnits(ee){this._node.setAttribute("GeoDimUnits",ee)}get geoWidth(){return this._node.getAttribute("GeoWidth")}set geoWidth(ee){this._node.setAttribute("GeoWidth",ee)}get geoHeight(){return this._node.getAttribute("GeoHeight")}set geoHeight(ee){this._node.setAttribute("GeoHeight",ee)}get geoWrapAround(){return isTrue(this._node.getAttribute("GeoWrap"))}set geoWrapAround(ee){this._node.setAttribute("GeoWrap",ee)}get geoPlacementType(){return this._node.getAttribute("Placement")}set geoPlacementType(ee){this._node.setAttribute("Placement",ee)}get geoPlacementFunction(){return this._node.getAttribute("PlacementFunction")}set geoPlacementFunction(ee){this._node.setAttribute("PlacementFunction",ee)}get networkType(){return this._node.getAttribute("Network")}set networkType(ee){this._node.setAttribute("Network",ee)}get networkFunction(){return this._node.getAttribute("NetworkFunction")}set networkFunction(ee){this._node.setAttribute("NetworkFunction",ee)}}class Container extends Primitive{children(ee=!0){let re=this._node.children?this._node.children.map(ne=>ne.primitive(this.model)):[];if(ee){let ne=re.length;for(let ie=0;ie<ne;ie++){let se=re[ie];se instanceof Container&&(re=re.concat(se.children(ee)))}}return re}Stock(ee={}){let re=this.model.Stock(ee);return re.parent=this,re}Variable(ee={}){let re=this.model.Variable(ee);return re.parent=this,re}Converter(ee={}){let re=this.model.Converter(ee);return re.parent=this,re}State(ee={}){let re=this.model.State(ee);return re.parent=this,re}Action(ee={}){let re=this.model.Action(ee);return re.parent=this,re}Population(ee={}){let re=this.model.Population(ee);return re.parent=this,re}Flow(ee,re,ne={}){let ie=this.model.Flow(ee,re,ne);return ie.parent=this,ie}Transition(ee,re,ne={}){let ie=this.model.Transition(ee,re,ne);return ie.parent=this,ie}Link(ee,re,ne={}){let ie=this.model.Link(ee,re,ne);return ie.parent=this,ie}get frozen(){return isTrue(this._node.getAttribute("Frozen"))}set frozen(ee){this._node.setAttribute("Frozen",ee)}get customTimeSettings(){let ee=JSON.parse(this._node.getAttribute("Solver")||"{}");return ee.algorithm==="RK1"&&(ee.algorithm="Euler"),ee}set customTimeSettings(ee){let re=Object.assign({},ee);re.algorithm==="Euler"&&(re.algorithm="RK1"),this._node.setAttribute("Solver",JSON.stringify(re))}}class Folder extends Container{}class Agent extends Container{get agentParent(){return this._node.getAttribute("AgentBase")}set agentParent(ee){this._node.setAttribute("AgentBase",ee)}}class ModelNode{constructor(){this.attributes=new Map,this.parent=null,this.children=[],this.id=null,this.value={nodeName:null},this._primitive=void 0,this.source=null,this.target=null}primitive(ee,re={}){return this._primitive===void 0&&(this.value.nodeName==="Stock"?this._primitive=new Stock(this,re):this.value.nodeName==="Variable"?this._primitive=new Variable(this,re):this.value.nodeName==="Converter"?this._primitive=new Converter(this,re):this.value.nodeName==="State"?this._primitive=new State(this,re):this.value.nodeName==="Action"?this._primitive=new Action(this,re):this.value.nodeName==="Agents"?this._primitive=new Population(this,re):this.value.nodeName==="Flow"?this._primitive=new Flow(this,re):this.value.nodeName==="Transition"?this._primitive=new Transition(this,re):this.value.nodeName==="Link"?this._primitive=new Link(this,re):this.value.nodeName==="Folder"?this.getAttribute("Type")==="Agent"?this._primitive=new Agent(this,re):this._primitive=new Folder(this,re):this._primitive=null,this._primitive&&!this._primitive.model&&(this._primitive.model=ee)),this._primitive}addChild(ee){if(ee.parent){let re=ee.parent.children.indexOf(ee);re>-1&&ee.parent.children.splice(re,1)}this.children.push(ee),ee.parent=this}getAttribute(ee){return ee==="id"?this.id:this.attributes.get(ee)}setAttribute(ee,re){if(ee==="id"){this.id=""+re;return}this.attributes.set(ee,""+re)}getValue(){return{removeAttribute:ee=>this.attributes.delete(ee)}}toString(ee=0){let re=" ".repeat(ee)+`<${this.value.nodeName}${this.getAttribute("name")?" ["+this.getAttribute("name")+"]":""}>`,ne=`</${this.value.nodeName}>`;return re+(this.children.length?`
`:"")+this.children.map(ie=>" ".repeat(ee)+ie.toString(ee+2)).join(`
`)+(this.children.length?`
`+" ".repeat(ee):"")+ne}}function findRootParent(te){return te.parent?findRootParent(te.parent):te}function modelNodeClone(te,ee){let re=new ModelNode;re.value=te.cloneNode(!0),re.parent=ee;let ne=["1"].concat(primitives(findRootParent(ee)).map(ie=>ie.id).filter(ie=>!!ie));if(te.attributes.length>0)for(let ie=0;ie<te.attributes.length;ie++){let se=te.attributes.item(ie);re.setAttribute(se.nodeName,se.nodeValue)}return re.setAttribute("id",""+(Math.max.apply(null,ne)+1)),re}function primitives(te,ee){let re=nodeChildren(te.children[0]);if(ee){let ne=[];for(let ie of re)(Array.isArray(ee)?ee.includes(ie.value.nodeName):ie.value.nodeName===ee)&&ne.push(ie);return ne}else return re}function nodeChildren(te){let ee=te.children.slice(),re=ee.length;for(let ne=0;ne<re;ne++){let ie=ee[ne];ee=ee.concat(nodeChildren(ie))}return ee}let fn={"+":function(te,ee){return te+ee},"-":function(te,ee){return ee!==void 0?te-ee:-te},"*":function(te,ee){return te*ee},"/":function(te,ee){return te/ee},"=":function(te,ee){return te===ee},"<":function(te,ee){return te<ee},"<=":function(te,ee){return te<=ee},">":function(te,ee){return te>ee},">=":function(te,ee){return te>=ee},mod:function(te,ee){return te%ee},expt:function(te,ee){return Math.pow(te,ee)},abs:Math.abs,sin:Math.sin,asin:Math.asin,cos:Math.cos,acos:Math.acos,tan:Math.tan,atan:Math.atan,sqrt:Math.sqrt,log:function(te,ee){return ee!==void 0?Math.log(te)/Math.log(ee):Math.log(te)},exp:Math.exp,round:Math.round,floor:Math.floor,ceiling:Math.ceil};function sortAndCollapseUnits(te,ee){if(te.length<=1)te.length===1&&(te[0]=te[0].toLowerCase());else{let re=[];for(let ne=0;ne<te.length;ne++)re.push({name:te[ne].toLowerCase(),exponent:ee[ne]});re.sort((ne,ie)=>ne.name.localeCompare(ie.name)),te=[],ee=[];for(let ne=0;ne<re.length;ne++)te.push(re[ne].name),ee.push(re[ne].exponent);for(let ne=0;ne<te.length;ne++){for(let ie=ne+1;ie<te.length;ie++)te[ne]===te[ie]&&(ee[ne]=ee[ne]+ee[ie],te.splice(ie,1),ee.splice(ie,1),ie--);ee[ne]===0&&(te.splice(ne,1),ee.splice(ne,1),ne--)}}return{names:te,exponents:ee}}function getUnitsId(te,ee){return te.join(",")+ee.join(",")}class UnitStore{constructor(ee,re,ne){this.manager=ee,this.names=re,this.exponents=ne,this.toBase=null,this.baseUnits=null,this.multiples={},this.id=getUnitsId(this.names,this.exponents)}isUnitless(){return!this.exponents.find(ee=>ee!==0)}addBase(){if(this.toBase!==null)return;this.toBase=1;let ee=this.names.slice(),re=this.exponents.slice(),ne=!0;for(;ne;){ne=!1;for(let se=ee.length-1;se>=0;se--){let le=this.manager.findSource(ee[se]);if(le!==null&&!(le.target.names.length===1&&le.target.names[0]===ee[se])){this.toBase=fn["*"](this.toBase,fn.expt(le.scale,re[se])),ee=ee.concat(le.target.names),ee.splice(se,1);let ue=re[se];re=re.concat(le.target.exponents.map(ae=>ae*ue)),re.splice(se,1),ne=!0;break}}}let ie=sortAndCollapseUnits(ee,re);this.baseUnits=this.manager.getUnitStore(ie.names,ie.exponents,!1,!0)}power(ee){let re=this.names.slice(),ne=this.exponents.slice();for(let ie=0;ie<ne.length;ie++)ne[ie]=ne[ie]*ee;return this.manager.getUnitStore(re,ne)}toStringShort(){let ee="";for(let re=0;re<this.names.length;re++)ee!==""&&(ee=ee+","),ee=ee+this.names[re],this.exponents[re]!==1&&(ee=ee+"^"+this.exponents[re]);return ee}multiply(ee,re){let ne=ee.id+";"+re;if(!(ne in this.multiples)){this.toBase===null&&this.addBase(),ee.toBase===null&&ee.addBase();let ie,se;if(this.baseUnits){if(ie=this.baseUnits.names.slice(),se=this.baseUnits.exponents.slice(),ee.baseUnits){for(let le=0;le<ee.baseUnits.names.length;le++){let ue=ie.indexOf(ee.baseUnits.names[le]);if(ue!==-1)se[ue]=se[ue]+ee.baseUnits.exponents[le]*re;else{let ae=!1;for(let oe=0;oe<ie.length;oe++)if(ee.baseUnits.names[le]<ie[oe]){ie.splice(oe,0,ee.baseUnits.names[le]),se.splice(oe,0,ee.baseUnits.exponents[le]*re),ae=!0;break}ae||(ie.push(ee.baseUnits.names[le]),se.push(ee.baseUnits.exponents[le]*re))}}for(let le=se.length-1;le>=0;le--)se[le]===0&&(se.splice(le,1),ie.splice(le,1))}}else ie=ee.baseUnits.names.slice(),se=ee.baseUnits.exponents.slice();this.multiples[ne]=this.manager.getUnitStore(ie,se)}return this.multiples[ne]}toString(){let ee="",re="",ne=0,ie=0;for(let se=0;se<this.names.length;se++)if(this.names[se]!==""){let le='<span class="unit">'+toHTML(toTitleCase(this.names[se]))+"</span>";this.exponents[se]!==1&&this.exponents[se]!==-1&&(le=le+"<span class='markup'>^</span><sup>"+Math.abs(this.exponents[se])+"</sup>"),this.exponents[se]>0?(ne>0&&(ee=ee+"<span class='markup'>*</span>"),ee=ee+le,ne=ne+1):(ie>0&&(re=re+"<span class='markup'>*</span>"),re=re+le,ie=ie+1)}return ee===""&&(ee="Unitless"),re===""?'<div class="units">'+ee+"</div>":(ee==="Unitless"&&(ee="1"),'<span class="units">'+ee+"<hr/><span class='markup'>/(</span>"+re+"<span class='markup'>)</span></span>")}}const titleCaseReg=/\w\S*/g;function titleCaseFunc(te){return te.charAt(0).toUpperCase()+te.substr(1).toLowerCase()}function toTitleCase(te){return te.replace(titleCaseReg,titleCaseFunc)}function convertUnits(te,ee,re=!1){if(te===ee)return 1;let ne=!te||te.isUnitless(),ie=!ee||ee.isUnitless();return ne&&ie?1:!ne&&ie?0:ne&&!ie?re?1:0:(te.toBase===null&&te.addBase(),ee.toBase===null&&ee.addBase(),te.baseUnits!==ee.baseUnits?0:fn["/"](te.toBase,ee.toBase))}const DEFAULT_UNITS=[{source:/^Degree$/i,targetString:"Degrees",scale:1},{source:/^Radians?$/i,targetString:"Degrees",scale:180/Math.PI},{source:/^Ampere$/i,targetString:"Amperes",scale:1},{source:/^Gram$/i,targetString:"Grams",scale:1},{source:/^Second$/i,targetString:"Seconds",scale:1},{source:/^Meter$/i,targetString:"Meters",scale:1},{source:/^(Meters? ?Squared?|Squared? ?Meters?)$/i,targetString:"Meters^2",scale:1},{source:/^(Centimeters? ?Squared?|Squared? ?Centimeters?)$/i,targetString:"Centimeters^2",scale:1},{source:/^(Centimeters? ?Cubed?|Cubic ?Centimeters?)$/i,targetString:"Centimeters^3",scale:1},{source:/^(Meters? Cubed?|Cubic ?Meters?)$/i,targetString:"Meters^3",scale:1},{source:/^(Kilometers? ?Cubed?|Cubic ?Kilometers?)$/i,targetString:"Kilometers^3",scale:1},{source:/^(Inches? Squared?|Squared? ?Inches?)$/i,targetString:"Inches^2",scale:1},{source:/^(Miles? ?Squared?|Squared? ?Miles?)$/i,targetString:"Miles^2",scale:1},{source:/^(Kilometers? Squared?|Squared? ?Kilometers?)$/i,targetString:"Kilometers^2",scale:1},{source:/^Acre? ?(Feet|Foot)$/i,targetString:"Acres,Feet",scale:1},{source:/^Meters? ?per ?Seconds?$/i,targetString:"Meters,Seconds^-1",scale:1},{source:/^Meters? ?per ?Seconds? ?Squared?$/i,targetString:"Meters,Seconds^-2",scale:1},{source:/^(Foot|Feet) ?per ?Seconds?$/i,targetString:"Feet,Seconds^-1",scale:1},{source:/^(Foot|Feet) ?per ?Seconds? ?Squared?$/i,targetString:"Feet,Seconds^-2",scale:1},{source:/^Miles? ?per ?Hours?$/i,targetString:"Miles,Hours^-1",scale:1},{source:/^Miles? ?per ?Hours? ?Squared?$/i,targetString:"Miles,Hours^-2",scale:1},{source:/^Kilometers? ?per ?Hours?$/i,targetString:"Kilometers,Hours^-1",scale:1},{source:/^Kilometers? ?per ?Hours? ?Squared?$/i,targetString:"Kilometers,Hours^-2",scale:1},{source:/^Liters? ?per ?Seconds?$/i,targetString:"Liters,Seconds^-1",scale:1},{source:/^(Cubic ?Meters?|Meters? ?Cubed?) ?per ?Seconds?$/i,targetString:"Meters^3,Seconds^-1",scale:1},{source:/^(Squared? ?Yards?|Yards? ?Squared?)$/i,targetString:"Yards^2",scale:1},{source:/^(Squared? ?(Feet|Foot)|(Feet|Foot) ?Squared?)$/i,targetString:"Feet^2",scale:1},{source:/^(Squared? Millimeters?|Millimeters? ?Squared?)$/i,targetString:"Millimeters^2",scale:1},{source:/^(Millimeters? ?Cubed?|Cubic ?Millimeters?)$/i,targetString:"Millimeters^3",scale:1},{source:/^Gallons? ?per ?Seconds?$/i,targetString:"Gallons,Seconds^-1",scale:1},{source:/^Gallons? ?per ?Minutes?$/i,targetString:"Gallons,Minutes^-1",scale:1},{source:/^Pounds? ?per ?Seconds?$/i,targetString:"Pounds,Seconds^-1",scale:1},{source:/^Kilograms? ?per ?Seconds?$/i,targetString:"Kilograms,Seconds^-1",scale:1},{source:/^Dollars? ?per ?Seconds?$/i,targetString:"Dollars,Seconds^-1",scale:1},{source:/^Dollars? ?per ?Hours?$/i,targetString:"Dollars,Hours^-1",scale:1},{source:/^Dollars? ?per ?Days?$/i,targetString:"Dollars,Days^-1",scale:1},{source:/^Dollars? ?per ?Weeks?$/i,targetString:"Dollars,Weeks^-1",scale:1},{source:/^Dollars? ?per ?Months?$/i,targetString:"Dollars,Months^-1",scale:1},{source:/^Dollars? ?per ?Quarters?$/i,targetString:"Dollars,Quarters^-1",scale:1},{source:/^Dollars? ?per ?Years?$/i,targetString:"Dollars,Years^-1",scale:1},{source:/^Euros? ?per ?Seconds?$/i,targetString:"Euros,Seconds^-1",scale:1},{source:/^Euros? ?per ?Hours?$/i,targetString:"Euros,Hours^-1",scale:1},{source:/^Euros? ?per ?Days?$/i,targetString:"Euros,Days^-1",scale:1},{source:/^Euros? ?per ?Weeks?$/i,targetString:"Euros,Weeks^-1",scale:1},{source:/^Euros? ?per ?Months?$/i,targetString:"Euros,Months^-1",scale:1},{source:/^Euros? ?per ?Quarters?$/i,targetString:"Euros,Quarters^-1",scale:1},{source:/^Euros? ?per ?Years?$/i,targetString:"Euros,Years^-1",scale:1},{source:/^Centimeters?$/i,targetString:"Meters",scale:.01},{source:/^Millimeters?$/i,targetString:"Meters",scale:.001},{source:/^Kilometers?$/i,targetString:"Meters",scale:1e3},{source:/^Inch(es)?$/i,targetString:"Meters",scale:.0254},{source:/^(Foot|Feet)$/i,targetString:"Meters",scale:.3048},{source:/^Yards?$/i,targetString:"Meters",scale:.9144},{source:/^Miles?$/i,targetString:"Meters",scale:1609.344},{source:/^Acres?$/i,targetString:"Meters^2",scale:4046.85642},{source:/^Hectares?$/i,targetString:"Meters^2",scale:1e4},{source:/^Liters?$/i,targetString:"Meters^3",scale:.001},{source:/^Gallons?$/i,targetString:"Meters^3",scale:.003785},{source:/^Quarts?$/i,targetString:"Meters^3",scale:946e-6},{source:/^Fluid ?Ounces?$/i,targetString:"Meters^3",scale:3e-5},{source:/^Years?$/i,targetString:"Seconds",scale:31536e3},{source:/^Quarters?$/i,targetString:"Seconds",scale:7884e3},{source:/^Months?$/i,targetString:"Seconds",scale:2628e3},{source:/^Weeks?$/i,targetString:"Seconds",scale:604800},{source:/^Days?$/i,targetString:"Seconds",scale:86400},{source:/^Hours?$/i,targetString:"Seconds",scale:3600},{source:/^Minutes?$/i,targetString:"Seconds",scale:60},{source:/^Kilograms?$/i,targetString:"Grams",scale:1e3},{source:/^Milligrams?$/i,targetString:"Grams",scale:.001},{source:/^Ounces?$/i,targetString:"Grams",scale:28.349523},{source:/^Pounds?$/i,targetString:"Grams",scale:453.59237},{source:/^Tonnes?$/i,targetString:"Grams",scale:1e6},{source:/^Tons?$/i,targetString:"Grams",scale:907184.74},{source:/^Watts?$/i,targetString:"Joules,Seconds^-1",scale:1},{source:/^Kilowatts?$/i,targetString:"Watts",scale:1e3},{source:/^Megawatts?$/i,targetString:"Watts",scale:1e6},{source:/^Gigawatts?$/i,targetString:"Watts",scale:1e9},{source:/^Calories?$/i,targetString:"Joules",scale:4.184},{source:/^Kilocalories?$/i,targetString:"Joules",scale:4184},{source:/^(BTUs?|British ?Thermal ?units?)$/i,targetString:"Joules",scale:1055.05585},{source:/^Kilojoules?$/i,targetString:"Joules",scale:1e3},{source:/^Joules?$/i,targetString:"Newtons,Meters",scale:1},{source:/^Coulombs?$/i,targetString:"Amperes,Seconds",scale:1},{source:/^Volts?$/i,targetString:"Watts,Amperes^-1",scale:1},{source:/^Millivolts?$/i,targetString:"Volts",scale:.001},{source:/^Kilovolts?$/i,targetString:"Volts",scale:1e3},{source:/^Newtons?$/i,targetString:"Kilograms,Meters,Seconds^-2",scale:1},{source:/^Pounds? ?Force$/i,targetString:"Pounds,Feet per Second Squared",scale:32.17405},{source:/^Atoms?$/i,targetString:"Moles",scale:1/602214076e15},{source:/^Molecules?$/i,targetString:"Moles",scale:1/602214076e15},{source:/^Farads?$/i,targetString:"Joules,Volts^-2",scale:1},{source:/^Pascals?$/i,targetString:"Newton,Meters^-2",scale:1},{source:/^Kilopascals?$/i,targetString:"Pascals",scale:1e3},{source:/^Bars?$/i,targetString:"Pascals",scale:1e5},{source:/^Atmospheres?$/i,targetString:"Pascals",scale:101325},{source:/^Pounds? ?per ?Squared? ?Inch(es)?$/i,targetString:"Pascals",scale:6894}];class UnitManager{constructor(){this.unitDefinitions=[],this.cachedUnits=Object.create(null),this.unitsBank=Object.create(null),this.addUnits(DEFAULT_UNITS)}addUnits(ee){for(let re of ee)re.source||(re.source=new RegExp("^"+re.sourceString+"$","i")),re.target||(re.target=this.unitsFromString(re.targetString.toLowerCase()));this.unitDefinitions=ee.concat(this.unitDefinitions)}findSource(ee){if(!(ee in this.cachedUnits)){this.cachedUnits[ee]=null;for(let re=this.unitDefinitions.length-1;re>=0;re--)if(this.unitDefinitions[re].source.test(ee)){this.cachedUnits[ee]=this.unitDefinitions[re];break}}return this.cachedUnits[ee]}getUnitStore(ee,re,ne=!1,ie=!1){if(ne){let le=sortAndCollapseUnits(ee,re);ee=le.names,re=le.exponents}if(!ie&&!ee.length)return;let se=getUnitsId(ee,re);return this.unitsBank[se]||(this.unitsBank[se]=new UnitStore(this,ee,re)),this.unitsBank[se]}unitsFromString(ee){let re=[],ne=[];if(ee){let ie=ee.split(",");for(let se=0;se<ie.length;se++)re.push(ie[se].split("^")[0]),ie[se].indexOf("^")!==-1?ne.push(parseFloat(ie[se].split("^")[1])):ne.push(1)}return this.getUnitStore(re,ne,!0)}}class Material{constructor(ee,re){this.value=ee,this.units=re}toNum(){return this}toString(){return this.units&&!this.units.isUnitless()?"{"+this.value+" "+this.units.toStringShort()+"}":this.value+""}fullClone(){return new Material(this.value,this.units)}forceUnits(ee){if(!this.units)this.units=ee;else{let re=convertUnits(this.units,ee);re===0?unitAlert(this.units,ee,"conversion of units"):(this.value=fn["*"](this.value,re),this.units=ee)}return this}}function unitAlert(te,ee,re){throw new ModelError("Incompatible units for the "+re+" of "+(te&&!te.isUnitless()?te.toString():"unitless")+" and "+(ee&&!ee.isUnitless()?ee.toString():"unitless")+".",{code:5e3})}class AggregateSeries{constructor(ee,re,ne){this.simulate=ee,this.id=re,this.spacing=ne,this.oldValues=[]}match(ee){return this.id===ee}get(ee){let re=0;for(this.spacing<0?re=0:this.spacing===0?re=Math.floor(div(minus(this.simulate.time(),this.simulate.timeStart),this.simulate.userTimeStep).value):this.spacing instanceof Material?re=Math.floor(div(minus(this.simulate.time(),this.simulate.timeStart),this.spacing.forceUnits(this.simulate.timeUnits)).value):console.error("Invalid spacing:",this.spacing);this.oldValues.length-1<re;){let ne=evaluateNode(ee.node,ee.scope,this.simulate);ne instanceof SPrimitive&&(ne=ne.value()),this.oldValues.push(ne)}return this.oldValues[re].fullClone?this.oldValues[re].fullClone():this.oldValues[re]}}class DataBank{constructor(){this.dataSeries={}}series(){return Object.keys(this.dataSeries)}clone(){let ee=new DataBank,re=this.series();for(let ne=0;ne<re.length;ne++)ee.dataSeries[re[ne]]=this.dataSeries[re[ne]];return ee}getSeries(ee){return ee in this.dataSeries||(this.dataSeries[ee]=[]),this.dataSeries[ee]}trimValues(ee){let re=this.series();for(let ne=0;ne<re.length;ne++){let ie=this.getSeries(re[ne]);ie.length-1>ee&&ie.splice(ee+1,ie.length-ee+1)}}}function print$1(te,ee=re=>re.key){let re=[];return row(te,"",!0,ne=>re.push(ne),ee),re.join("")}function row(te,ee,re,ne,ie){if(te){ne(`${ee}${re?" ":" "}${ie(te)}
`);const se=ee+(re?"    ":"   ");te.left&&row(te.left,se,!1,ne,ie),te.right&&row(te.right,se,!0,ne,ie)}}function isBalanced(te){if(te===null)return!0;let ee=height(te.left),re=height(te.right);return!!(Math.abs(ee-re)<=1&&isBalanced(te.left)&&isBalanced(te.right))}function height(te){return te?1+Math.max(height(te.left),height(te.right)):0}function loadRecursive(te,ee,re,ne,ie){const se=ie-ne;if(se>0){const le=ne+Math.floor(se/2),ue=ee[le],ae=re[le],oe={key:ue,data:ae,parent:te};return oe.left=loadRecursive(oe,ee,re,ne,le),oe.right=loadRecursive(oe,ee,re,le+1,ie),oe}return null}function markBalance(te){if(te===null)return 0;const ee=markBalance(te.left),re=markBalance(te.right);return te.balanceFactor=ee-re,Math.max(ee,re)+1}function sort(te,ee,re,ne,ie){if(re>=ne)return;const se=te[re+ne>>1];let le=re-1,ue=ne+1;for(;;){do le++;while(ie(te[le],se)<0);do ue--;while(ie(te[ue],se)>0);if(le>=ue)break;let ae=te[le];te[le]=te[ue],te[ue]=ae,ae=ee[le],ee[le]=ee[ue],ee[ue]=ae}sort(te,ee,re,ue,ie),sort(te,ee,ue+1,ne,ie)}function DEFAULT_COMPARE(te,ee){return te>ee?1:te<ee?-1:0}function rotateLeft(te){let ee=te.right;return te.right=ee.left,ee.left&&(ee.left.parent=te),ee.parent=te.parent,ee.parent&&(ee.parent.left===te?ee.parent.left=ee:ee.parent.right=ee),te.parent=ee,ee.left=te,te.balanceFactor+=1,ee.balanceFactor<0&&(te.balanceFactor-=ee.balanceFactor),ee.balanceFactor+=1,te.balanceFactor>0&&(ee.balanceFactor+=te.balanceFactor),ee}function rotateRight(te){let ee=te.left;return te.left=ee.right,te.left&&(te.left.parent=te),ee.parent=te.parent,ee.parent&&(ee.parent.left===te?ee.parent.left=ee:ee.parent.right=ee),te.parent=ee,ee.right=te,te.balanceFactor-=1,ee.balanceFactor>0&&(te.balanceFactor-=ee.balanceFactor),ee.balanceFactor-=1,te.balanceFactor<0&&(ee.balanceFactor+=te.balanceFactor),ee}class AVLTree{constructor(ee,re=!1){this._comparator=ee||DEFAULT_COMPARE,this._root=null,this._size=0,this._noDuplicates=!!re}destroy(){return this.clear()}clear(){return this._root=null,this._size=0,this}get size(){return this._size}contains(ee){if(this._root){let re=this._root,ne=this._comparator;for(;re;){let ie=ne(ee,re.key);if(ie===0)return!0;ie<0?re=re.left:re=re.right}}return!1}next(ee){let re=ee;if(re)if(re.right)for(re=re.right;re.left;)re=re.left;else for(re=ee.parent;re&&re.right===ee;)ee=re,re=re.parent;return re}prev(ee){let re=ee;if(re)if(re.left)for(re=re.left;re.right;)re=re.right;else for(re=ee.parent;re&&re.left===ee;)ee=re,re=re.parent;return re}forEach(ee){let re=this._root,ne=[],ie=!1,se=0;for(;!ie;)re?(ne.push(re),re=re.left):ne.length>0?(re=ne.pop(),ee(re,se++),re=re.right):ie=!0;return this}range(ee,re,ne,ie){const se=[],le=this._comparator;let ue=this._root,ae;for(;se.length!==0||ue;)if(ue)se.push(ue),ue=ue.left;else{if(ue=se.pop(),ae=le(ue.key,re),ae>0)break;if(le(ue.key,ee)>=0&&ne.call(ie,ue))return this;ue=ue.right}return this}keys(){let ee=this._root,re=[],ne=[],ie=!1;for(;!ie;)ee?(re.push(ee),ee=ee.left):re.length>0?(ee=re.pop(),ne.push(ee.key),ee=ee.right):ie=!0;return ne}values(){let ee=this._root,re=[],ne=[],ie=!1;for(;!ie;)ee?(re.push(ee),ee=ee.left):re.length>0?(ee=re.pop(),ne.push(ee.data),ee=ee.right):ie=!0;return ne}at(ee){let re=this._root,ne=[],ie=!1,se=0;for(;!ie;)if(re)ne.push(re),re=re.left;else if(ne.length>0){if(re=ne.pop(),se===ee)return re;se++,re=re.right}else ie=!0;return null}minNode(){let ee=this._root;if(!ee)return null;for(;ee.left;)ee=ee.left;return ee}maxNode(){let ee=this._root;if(!ee)return null;for(;ee.right;)ee=ee.right;return ee}min(){let ee=this._root;if(!ee)return null;for(;ee.left;)ee=ee.left;return ee.key}max(){let ee=this._root;if(!ee)return null;for(;ee.right;)ee=ee.right;return ee.key}isEmpty(){return!this._root}pop(){let ee=this._root,re=null;if(ee){for(;ee.left;)ee=ee.left;re={key:ee.key,data:ee.data},this.remove(ee.key)}return re}popMax(){let ee=this._root,re=null;if(ee){for(;ee.right;)ee=ee.right;re={key:ee.key,data:ee.data},this.remove(ee.key)}return re}find(ee){let ne=this._root,ie,se=this._comparator;for(;ne;){if(ie=se(ee,ne.key),ie===0)return ne;ie<0?ne=ne.left:ne=ne.right}return null}insert(ee,re){if(!this._root)return this._root={parent:null,left:null,right:null,balanceFactor:0,key:ee,data:re},this._size++,this._root;let ne=this._comparator,ie=this._root,se=null,le=0;if(this._noDuplicates)for(;ie;){if(le=ne(ee,ie.key),se=ie,le===0)return null;le<0?ie=ie.left:ie=ie.right}else for(;ie;)le=ne(ee,ie.key),se=ie,le<=0?ie=ie.left:ie=ie.right;let ue={left:null,right:null,balanceFactor:0,parent:se,key:ee,data:re},ae;for(le<=0?se.left=ue:se.right=ue;se&&(le=ne(se.key,ee),le<0?se.balanceFactor-=1:se.balanceFactor+=1,se.balanceFactor!==0);){if(se.balanceFactor<-1){se.right.balanceFactor===1&&rotateRight(se.right),ae=rotateLeft(se),se===this._root&&(this._root=ae);break}else if(se.balanceFactor>1){se.left.balanceFactor===-1&&rotateLeft(se.left),ae=rotateRight(se),se===this._root&&(this._root=ae);break}se=se.parent}return this._size++,ue}remove(ee){if(!this._root)return null;let re=this._root,ne=this._comparator,ie=0;for(;re&&(ie=ne(ee,re.key),ie!==0);)ie<0?re=re.left:re=re.right;if(!re)return null;let se=re.key,le,ue;if(re.left){for(le=re.left;le.left||le.right;){for(;le.right;)le=le.right;re.key=le.key,re.data=le.data,le.left&&(re=le,le=le.left)}re.key=le.key,re.data=le.data,re=le}if(re.right){for(ue=re.right;ue.left||ue.right;){for(;ue.left;)ue=ue.left;re.key=ue.key,re.data=ue.data,ue.right&&(re=ue,ue=ue.right)}re.key=ue.key,re.data=ue.data,re=ue}let ae=re.parent,oe=re,he;for(;ae&&(ae.left===oe?ae.balanceFactor-=1:ae.balanceFactor+=1,ae.balanceFactor<-1?(ae.right.balanceFactor===1&&rotateRight(ae.right),he=rotateLeft(ae),ae===this._root&&(this._root=he),ae=he):ae.balanceFactor>1&&(ae.left.balanceFactor===-1&&rotateLeft(ae.left),he=rotateRight(ae),ae===this._root&&(this._root=he),ae=he),!(ae.balanceFactor===-1||ae.balanceFactor===1));)oe=ae,ae=ae.parent;return re.parent&&(re.parent.left===re?re.parent.left=null:re.parent.right=null),re===this._root&&(this._root=null),this._size--,se}load(ee=[],re=[],ne=!1){if(this._size!==0)throw new Error("bulk-load: tree is not empty");const ie=ee.length;return ne&&sort(ee,re,0,ie-1,this._comparator),this._root=loadRecursive(null,ee,re,0,ie),markBalance(this._root),this._size=ie,this}isBalanced(){return isBalanced(this._root)}toString(ee){return print$1(this._root,ee)}}AVLTree.default=AVLTree;class TaskQueue{constructor(ee){ee=ee||{},this.tasks=new AVLTree(compare),this.onMoveEvents=[],this.setTime(ee.start),this.debug=!1,this.end=ee.end,this.states={},this.cursor=null}print(){console.log("Current Time: "+this.time.value);let ee=this.tasks.minNode();for(;ee;)console.log(ee.key.name),console.log("    Time: "+ee.key.time.value),console.log("    Priority: "+ee.key.priority),ee.key.expires!==void 0&&console.log("    Expires: "+ee.key.expires),ee.key.skip!==void 0&&console.log("    Skip: "+ee.key.skip),ee=this.tasks.next(ee)}addEvent(ee){this.onMoveEvents.push(ee)}fireEvents(ee,re,ne){this.debug&&console.log("Firing Events");for(let ie=0;ie<this.onMoveEvents.length;ie++)this.onMoveEvents[ie](ee,re,ne)}setTime(ee){if(this.time===void 0||neq(ee,this.time)){let re=this.time;this.time=ee,re!==void 0&&this.fireEvents(minus(ee,re),re,ee)}}moveTo(ee){if(!eq(this.time,ee)){if(this.debug&&console.log("Shifting time to: "+ee.value),this.cursor){let re=this.tasks.max().time,ne=this.tasks.min().time;for(;lessThan(this.time,ee)&&!greaterThan(this.time,re);)this.step();for(;greaterThan(this.time,ee)&&greaterThan(this.time,ne);)this.stepBack()}this.setTime(ee),this.debug&&console.log("Time shift to  "+ee.value+" completed.")}}add(ee){ee.queue=this,this.tasks.insert(ee)}goNext(){this.cursor=this.tasks.next(this.cursor)}goPrev(){this.cursor=this.tasks.prev(this.cursor)}step(){this.time===void 0&&(this.cursor=this.tasks.minNode(),this.setTime(this.cursor.key.time));let ee=this.cursor.key;if(ee){let re=ee.deadAction;if(ee.execute(),!re&&ee.timeShift){ee.timeShift();return}this.goNext()}this.cursor?this.setTime(this.cursor.key.time):(this.goNext(),this.setTime(mult(this.tasks.max().time,new Material(10))))}stepBack(){if(this.time===void 0){this.cursor=this.tasks.minNode(),this.setTime(this.cursor.key.time);return}this.cursor?this.goPrev():this.cursor=this.tasks.maxNode();let ee=this.cursor.key.time;for(;this.cursor&&eq(ee,this.cursor.key.time);)this.cursor.key.rollback(),this.goPrev();this.cursor?this.goNext():this.cursor=this.tasks.minNode(),this.setTime(this.cursor.key.time)}atStart(){return this.time===void 0||this.cursor.key===this.tasks.min()}completed(){return this.time!==void 0&&(greaterThan(this.time,this.end)||!this.cursor)}remove(ee){ee===this.cursor.key&&this.goNext(),this.tasks.remove(ee)}}let taskIdCounter=0;class Task{constructor(ee){if(this.id=taskIdCounter++,this.name=ee.name,this.time=ee.time,!this.time)throw new TypeError("Task time is missing.");if(isNaN(this.time.value))throw new TypeError("Task time is a NaN.");this.action=ee.action,this.reverse=ee.rollback,this.priority=ee.priority||0,this.expires=ee.expires,this.skip=ee.skip,this.timeShift=ee.timeShift,this.data=ee.data,this.blocker=ee.blocker,this.queue=void 0,this.deadAction=!1,this.deadReverse=!1,this.action&&(this.action.task=this),this.reverse&&(this.action.reverse=this)}execute(){this.action&&!this.deadAction&&(!this.blocker||!this.queue.states[this.blocker])&&(this.skip!==void 0&&this.skip>0?(this.skip--,this.queue.debug&&console.log("Skipping: "+this.name)):(this.queue.debug&&console.log("%c Executing: "+this.name+" (Time: "+this.time.value+")","color:blue"),this.expires!==void 0&&(this.expires--,this.queue.debug&&console.log("    Current count before expire: "+this.expires),this.expires<=0&&(this.queue.debug&&console.log("    Task expired."),this.deadAction=!0))),this.action(this))}rollback(){this.reverse&&!this.deadReverse&&(!this.blocker||!this.queue.states[this.blocker])&&(this.queue.debug&&console.log("Rolling back: "+this.name+" (Time: "+this.time.value+")"),this.expires!==void 0&&this.expires<=0&&(this.queue.debug&&console.log("    Rollback expired."),this.deadReverse=!0),this.reverse())}reschedule(ee){this.queue.remove(this),this.time=ee,this.queue.add(this)}remove(){this.queue.remove(this)}kill(){this.deadAction=!0,this.deadReverse=!0}block(ee){ee=ee||this.blocker,this.queue.states[ee]=!0}unblock(ee){ee=ee||this.blocker,this.queue.states[ee]=!1}toString(){return this.name+" - "+this.id}}function compare(te,ee){return eq(ee.time,te.time)?ee.priority===te.priority?ee.id===te.id?0:ee.id<te.id?1:-1:ee.priority<te.priority?1:-1:lessThan(ee.time,te.time)?1:-1}let jStat={};(function(te,ee){Object.assign(jStat,ee())})(globalThis,function(){var te=function(ee,re){var ne=Array.prototype.concat,ie=Array.prototype.slice,se=Object.prototype.toString;function le(we,ge){var _e=we>ge?we:ge;return ee.pow(10,17-~~(ee.log(_e>0?_e:-_e)*ee.LOG10E))}var ue=Array.isArray||function(ge){return se.call(ge)==="[object Array]"};function ae(we){return se.call(we)==="[object Function]"}function oe(we){return typeof we=="number"?we-we===0:!1}function he(we){return ne.apply([],we)}function ce(){return new ce._init(arguments)}ce.fn=ce.prototype,ce._init=function(ge){if(ue(ge[0]))if(ue(ge[0][0])){ae(ge[1])&&(ge[0]=ce.map(ge[0],ge[1]));for(var _e=0;_e<ge[0].length;_e++)this[_e]=ge[0][_e];this.length=ge[0].length}else this[0]=ae(ge[1])?ce.map(ge[0],ge[1]):ge[0],this.length=1;else if(oe(ge[0]))this[0]=ce.seq.apply(null,ge),this.length=1;else{if(ge[0]instanceof ce)return ce(ge[0].toArray());this[0]=[],this.length=1}return this},ce._init.prototype=ce.prototype,ce._init.constructor=ce,ce.utils={calcRdx:le,isArray:ue,isFunction:ae,isNumber:oe,toVector:he},ce._random_fn=ee.random,ce.setRandom=function(ge){if(typeof ge!="function")throw new TypeError("fn is not a function");ce._random_fn=ge},ce.extend=function(ge){var _e,Te;if(arguments.length===1){for(Te in ge)ce[Te]=ge[Te];return this}for(_e=1;_e<arguments.length;_e++)for(Te in arguments[_e])ge[Te]=arguments[_e][Te];return ge},ce.rows=function(ge){return ge.length||1},ce.cols=function(ge){return ge[0].length||1},ce.dimensions=function(ge){return{rows:ce.rows(ge),cols:ce.cols(ge)}},ce.row=function(ge,_e){return ue(_e)?_e.map(function(Te){return ce.row(ge,Te)}):ge[_e]},ce.rowa=function(ge,_e){return ce.row(ge,_e)},ce.col=function(ge,_e){if(ue(_e)){var Te=ce.arange(ge.length).map(function(){return new Array(_e.length)});return _e.forEach(function(Le,xe){ce.arange(ge.length).forEach(function(Oe){Te[Oe][xe]=ge[Oe][Le]})}),Te}for(var Ne=new Array(ge.length),ye=0;ye<ge.length;ye++)Ne[ye]=[ge[ye][_e]];return Ne},ce.cola=function(ge,_e){return ce.col(ge,_e).map(function(Te){return Te[0]})},ce.diag=function(ge){for(var _e=ce.rows(ge),Te=new Array(_e),Ne=0;Ne<_e;Ne++)Te[Ne]=[ge[Ne][Ne]];return Te},ce.antidiag=function(ge){for(var _e=ce.rows(ge)-1,Te=new Array(_e),Ne=0;_e>=0;_e--,Ne++)Te[Ne]=[ge[Ne][_e]];return Te},ce.transpose=function(ge){var _e=[],Te,Ne,ye,Le,xe;for(ue(ge[0])||(ge=[ge]),Ne=ge.length,ye=ge[0].length,xe=0;xe<ye;xe++){for(Te=new Array(Ne),Le=0;Le<Ne;Le++)Te[Le]=ge[Le][xe];_e.push(Te)}return _e.length===1?_e[0]:_e},ce.map=function(ge,_e,Te){var Ne,ye,Le,xe,Oe;for(ue(ge[0])||(ge=[ge]),ye=ge.length,Le=ge[0].length,xe=Te?ge:new Array(ye),Ne=0;Ne<ye;Ne++)for(xe[Ne]||(xe[Ne]=new Array(Le)),Oe=0;Oe<Le;Oe++)xe[Ne][Oe]=_e(ge[Ne][Oe],Ne,Oe);return xe.length===1?xe[0]:xe},ce.cumreduce=function(ge,_e,Te){var Ne,ye,Le,xe,Oe;for(ue(ge[0])||(ge=[ge]),ye=ge.length,Le=ge[0].length,xe=Te?ge:new Array(ye),Ne=0;Ne<ye;Ne++)for(xe[Ne]||(xe[Ne]=new Array(Le)),Le>0&&(xe[Ne][0]=ge[Ne][0]),Oe=1;Oe<Le;Oe++)xe[Ne][Oe]=_e(xe[Ne][Oe-1],ge[Ne][Oe]);return xe.length===1?xe[0]:xe},ce.alter=function(ge,_e){return ce.map(ge,_e,!0)},ce.create=function(ge,_e,Te){var Ne=new Array(ge),ye,Le;for(ae(_e)&&(Te=_e,_e=ge),ye=0;ye<ge;ye++)for(Ne[ye]=new Array(_e),Le=0;Le<_e;Le++)Ne[ye][Le]=Te(ye,Le);return Ne};function pe(){return 0}ce.zeros=function(ge,_e){return oe(_e)||(_e=ge),ce.create(ge,_e,pe)};function de(){return 1}ce.ones=function(ge,_e){return oe(_e)||(_e=ge),ce.create(ge,_e,de)},ce.rand=function(ge,_e){return oe(_e)||(_e=ge),ce.create(ge,_e,ce._random_fn)};function me(we,ge){return we===ge?1:0}ce.identity=function(ge,_e){return oe(_e)||(_e=ge),ce.create(ge,_e,me)},ce.symmetric=function(ge){var _e=ge.length,Te,Ne;if(ge.length!==ge[0].length)return!1;for(Te=0;Te<_e;Te++)for(Ne=0;Ne<_e;Ne++)if(ge[Ne][Te]!==ge[Te][Ne])return!1;return!0},ce.clear=function(ge){return ce.alter(ge,pe)},ce.seq=function(ge,_e,Te,Ne){ae(Ne)||(Ne=!1);var ye=[],Le=le(ge,_e),xe=(_e*Le-ge*Le)/((Te-1)*Le),Oe=ge,Fe;for(Fe=0;Oe<=_e&&Fe<Te;Fe++,Oe=(ge*Le+xe*Le*Fe)/Le)ye.push(Ne?Ne(Oe,Fe):Oe);return ye},ce.arange=function(ge,_e,Te){var Ne=[],ye;if(Te=Te||1,_e===re&&(_e=ge,ge=0),ge===_e||Te===0)return[];if(ge<_e&&Te<0)return[];if(ge>_e&&Te>0)return[];if(Te>0)for(ye=ge;ye<_e;ye+=Te)Ne.push(ye);else for(ye=ge;ye>_e;ye+=Te)Ne.push(ye);return Ne},ce.slice=function(){function we(_e,Te,Ne,ye){var Le,xe=[],Oe=_e.length;if(Te===re&&Ne===re&&ye===re)return ce.copy(_e);if(Te=Te||0,Ne=Ne||_e.length,Te=Te>=0?Te:Oe+Te,Ne=Ne>=0?Ne:Oe+Ne,ye=ye||1,Te===Ne||ye===0)return[];if(Te<Ne&&ye<0)return[];if(Te>Ne&&ye>0)return[];if(ye>0)for(Le=Te;Le<Ne;Le+=ye)xe.push(_e[Le]);else for(Le=Te;Le>Ne;Le+=ye)xe.push(_e[Le]);return xe}function ge(_e,Te){var Ne,ye;if(Te=Te||{},oe(Te.row)){if(oe(Te.col))return _e[Te.row][Te.col];var Le=ce.rowa(_e,Te.row);return Ne=Te.col||{},we(Le,Ne.start,Ne.end,Ne.step)}if(oe(Te.col)){var xe=ce.cola(_e,Te.col);return ye=Te.row||{},we(xe,ye.start,ye.end,ye.step)}ye=Te.row||{},Ne=Te.col||{};var Oe=we(_e,ye.start,ye.end,ye.step);return Oe.map(function(Fe){return we(Fe,Ne.start,Ne.end,Ne.step)})}return ge}(),ce.sliceAssign=function(ge,_e,Te){var Ne,ye;if(oe(_e.row)){if(oe(_e.col))return ge[_e.row][_e.col]=Te;_e.col=_e.col||{},_e.col.start=_e.col.start||0,_e.col.end=_e.col.end||ge[0].length,_e.col.step=_e.col.step||1,Ne=ce.arange(_e.col.start,ee.min(ge.length,_e.col.end),_e.col.step);var Le=_e.row;return Ne.forEach(function(Oe,Fe){ge[Le][Oe]=Te[Fe]}),ge}if(oe(_e.col)){_e.row=_e.row||{},_e.row.start=_e.row.start||0,_e.row.end=_e.row.end||ge.length,_e.row.step=_e.row.step||1,ye=ce.arange(_e.row.start,ee.min(ge[0].length,_e.row.end),_e.row.step);var xe=_e.col;return ye.forEach(function(Oe,Fe){ge[Oe][xe]=Te[Fe]}),ge}return Te[0].length===re&&(Te=[Te]),_e.row.start=_e.row.start||0,_e.row.end=_e.row.end||ge.length,_e.row.step=_e.row.step||1,_e.col.start=_e.col.start||0,_e.col.end=_e.col.end||ge[0].length,_e.col.step=_e.col.step||1,ye=ce.arange(_e.row.start,ee.min(ge.length,_e.row.end),_e.row.step),Ne=ce.arange(_e.col.start,ee.min(ge[0].length,_e.col.end),_e.col.step),ye.forEach(function(Oe,Fe){Ne.forEach(function(De,Me){ge[Oe][De]=Te[Fe][Me]})}),ge},ce.diagonal=function(ge){var _e=ce.zeros(ge.length,ge.length);return ge.forEach(function(Te,Ne){_e[Ne][Ne]=Te}),_e},ce.copy=function(ge){return ge.map(function(_e){return oe(_e)?_e:_e.map(function(Te){return Te})})};var ve=ce.prototype;return ve.length=0,ve.push=Array.prototype.push,ve.sort=Array.prototype.sort,ve.splice=Array.prototype.splice,ve.slice=Array.prototype.slice,ve.toArray=function(){return this.length>1?ie.call(this):ie.call(this)[0]},ve.map=function(ge,_e){return ce(ce.map(this,ge,_e))},ve.cumreduce=function(ge,_e){return ce(ce.cumreduce(this,ge,_e))},ve.alter=function(ge){return ce.alter(this,ge),this},function(we){for(var ge=0;ge<we.length;ge++)(function(_e){ve[_e]=function(Te){var Ne=this,ye;return Te?(setTimeout(function(){Te.call(Ne,ve[_e].call(Ne))}),this):(ye=ce[_e](this),ue(ye)?ce(ye):ye)}})(we[ge])}("transpose clear symmetric rows cols dimensions diag antidiag".split(" ")),function(we){for(var ge=0;ge<we.length;ge++)(function(_e){ve[_e]=function(Te,Ne){var ye=this;return Ne?(setTimeout(function(){Ne.call(ye,ve[_e].call(ye,Te))}),this):ce(ce[_e](this,Te))}})(we[ge])}("row col".split(" ")),function(we){for(var ge=0;ge<we.length;ge++)(function(_e){ve[_e]=function(){return ce(ce[_e].apply(null,arguments))}})(we[ge])}("create zeros ones rand identity".split(" ")),ce}(Math);return function(ee,re){var ne=ee.utils.isFunction;function ie(ue,ae){return ue-ae}function se(ue,ae,oe){return re.max(ae,re.min(ue,oe))}ee.sum=function(ae){for(var oe=0,he=ae.length;--he>=0;)oe+=ae[he];return oe},ee.sumsqrd=function(ae){for(var oe=0,he=ae.length;--he>=0;)oe+=ae[he]*ae[he];return oe},ee.sumsqerr=function(ae){for(var oe=ee.mean(ae),he=0,ce=ae.length,pe;--ce>=0;)pe=ae[ce]-oe,he+=pe*pe;return he},ee.sumrow=function(ae){for(var oe=0,he=ae.length;--he>=0;)oe+=ae[he];return oe},ee.product=function(ae){for(var oe=1,he=ae.length;--he>=0;)oe*=ae[he];return oe},ee.min=function(ae){for(var oe=ae[0],he=0;++he<ae.length;)ae[he]<oe&&(oe=ae[he]);return oe},ee.max=function(ae){for(var oe=ae[0],he=0;++he<ae.length;)ae[he]>oe&&(oe=ae[he]);return oe},ee.unique=function(ae){for(var oe={},he=[],ce=0;ce<ae.length;ce++)oe[ae[ce]]||(oe[ae[ce]]=!0,he.push(ae[ce]));return he},ee.mean=function(ae){return ee.sum(ae)/ae.length},ee.meansqerr=function(ae){return ee.sumsqerr(ae)/ae.length},ee.geomean=function(ae){return re.pow(ee.product(ae),1/ae.length)},ee.median=function(ae){var oe=ae.length,he=ae.slice().sort(ie);return oe&1?he[oe/2|0]:(he[oe/2-1]+he[oe/2])/2},ee.cumsum=function(ae){return ee.cumreduce(ae,function(oe,he){return oe+he})},ee.cumprod=function(ae){return ee.cumreduce(ae,function(oe,he){return oe*he})},ee.diff=function(ae){var oe=[],he=ae.length,ce;for(ce=1;ce<he;ce++)oe.push(ae[ce]-ae[ce-1]);return oe},ee.rank=function(ue){var ae,oe=[],he={};for(ae=0;ae<ue.length;ae++){var ce=ue[ae];he[ce]?he[ce]++:(he[ce]=1,oe.push(ce))}var pe=oe.sort(ie),de={},me=1;for(ae=0;ae<pe.length;ae++){var ce=pe[ae],ve=he[ce],we=me,ge=me+ve-1,_e=(we+ge)/2;de[ce]=_e,me+=ve}return ue.map(function(Te){return de[Te]})},ee.mode=function(ae){var oe=ae.length,he=ae.slice().sort(ie),ce=1,pe=0,de=0,me=[],ve;for(ve=0;ve<oe;ve++)he[ve]===he[ve+1]?ce++:(ce>pe?(me=[he[ve]],pe=ce,de=0):ce===pe&&(me.push(he[ve]),de++),ce=1);return de===0?me[0]:me},ee.range=function(ae){return ee.max(ae)-ee.min(ae)},ee.variance=function(ae,oe){return ee.sumsqerr(ae)/(ae.length-(oe?1:0))},ee.pooledvariance=function(ae){var oe=ae.reduce(function(ce,pe){return ce+ee.sumsqerr(pe)},0),he=ae.reduce(function(ce,pe){return ce+pe.length},0);return oe/(he-ae.length)},ee.deviation=function(ue){for(var ae=ee.mean(ue),oe=ue.length,he=new Array(oe),ce=0;ce<oe;ce++)he[ce]=ue[ce]-ae;return he},ee.stdev=function(ae,oe){return re.sqrt(ee.variance(ae,oe))},ee.pooledstdev=function(ae){return re.sqrt(ee.pooledvariance(ae))},ee.meandev=function(ae){for(var oe=ee.mean(ae),he=[],ce=ae.length-1;ce>=0;ce--)he.push(re.abs(ae[ce]-oe));return ee.mean(he)},ee.meddev=function(ae){for(var oe=ee.median(ae),he=[],ce=ae.length-1;ce>=0;ce--)he.push(re.abs(ae[ce]-oe));return ee.median(he)},ee.coeffvar=function(ae){return ee.stdev(ae)/ee.mean(ae)},ee.quartiles=function(ae){var oe=ae.length,he=ae.slice().sort(ie);return[he[re.round(oe/4)-1],he[re.round(oe/2)-1],he[re.round(oe*3/4)-1]]},ee.quantiles=function(ae,oe,he,ce){var pe=ae.slice().sort(ie),de=[oe.length],me=ae.length,ve,we,ge,_e,Te,Ne;for(typeof he>"u"&&(he=3/8),typeof ce>"u"&&(ce=3/8),ve=0;ve<oe.length;ve++)we=oe[ve],ge=he+we*(1-he-ce),_e=me*we+ge,Te=re.floor(se(_e,1,me-1)),Ne=se(_e-Te,0,1),de[ve]=(1-Ne)*pe[Te-1]+Ne*pe[Te];return de},ee.percentile=function(ae,oe,he){var ce=ae.slice().sort(ie),pe=oe*(ce.length+(he?1:-1))+(he?0:1),de=parseInt(pe),me=pe-de;return de+1<ce.length?ce[de-1]+me*(ce[de]-ce[de-1]):ce[de-1]},ee.percentileOfScore=function(ae,oe,he){var ce=0,pe=ae.length,de=!1,me,ve;for(he==="strict"&&(de=!0),ve=0;ve<pe;ve++)me=ae[ve],(de&&me<oe||!de&&me<=oe)&&ce++;return ce/pe},ee.histogram=function(ae,oe){oe=oe||4;var he=ee.min(ae),ce=(ee.max(ae)-he)/oe,pe=ae.length,de=[],me;for(me=0;me<oe;me++)de[me]=0;for(me=0;me<pe;me++)de[re.min(re.floor((ae[me]-he)/ce),oe-1)]+=1;return de},ee.covariance=function(ae,oe){var he=ee.mean(ae),ce=ee.mean(oe),pe=ae.length,de=new Array(pe),me;for(me=0;me<pe;me++)de[me]=(ae[me]-he)*(oe[me]-ce);return ee.sum(de)/(pe-1)},ee.corrcoeff=function(ae,oe){return ee.covariance(ae,oe)/ee.stdev(ae,1)/ee.stdev(oe,1)},ee.spearmancoeff=function(ue,ae){return ue=ee.rank(ue),ae=ee.rank(ae),ee.corrcoeff(ue,ae)},ee.stanMoment=function(ae,oe){for(var he=ee.mean(ae),ce=ee.stdev(ae),pe=ae.length,de=0,me=0;me<pe;me++)de+=re.pow((ae[me]-he)/ce,oe);return de/ae.length},ee.skewness=function(ae){return ee.stanMoment(ae,3)},ee.kurtosis=function(ae){return ee.stanMoment(ae,4)-3};var le=ee.prototype;(function(ue){for(var ae=0;ae<ue.length;ae++)(function(oe){le[oe]=function(he,ce){var pe=[],de=0,me=this;if(ne(he)&&(ce=he,he=!1),ce)return setTimeout(function(){ce.call(me,le[oe].call(me,he))}),this;if(this.length>1){for(me=he===!0?this:this.transpose();de<me.length;de++)pe[de]=ee[oe](me[de]);return pe}return ee[oe](this[0],he)}})(ue[ae])})("cumsum cumprod".split(" ")),function(ue){for(var ae=0;ae<ue.length;ae++)(function(oe){le[oe]=function(he,ce){var pe=[],de=0,me=this;if(ne(he)&&(ce=he,he=!1),ce)return setTimeout(function(){ce.call(me,le[oe].call(me,he))}),this;if(this.length>1){for(oe!=="sumrow"&&(me=he===!0?this:this.transpose());de<me.length;de++)pe[de]=ee[oe](me[de]);return he===!0?ee[oe](ee.utils.toVector(pe)):pe}return ee[oe](this[0],he)}})(ue[ae])}("sum sumsqrd sumsqerr sumrow product min max unique mean meansqerr geomean median diff rank mode range variance deviation stdev meandev meddev coeffvar quartiles histogram skewness kurtosis".split(" ")),function(ue){for(var ae=0;ae<ue.length;ae++)(function(oe){le[oe]=function(){var he=[],ce=0,pe=this,de=Array.prototype.slice.call(arguments),me;if(ne(de[de.length-1])){me=de[de.length-1];var ve=de.slice(0,de.length-1);return setTimeout(function(){me.call(pe,le[oe].apply(pe,ve))}),this}else{me=void 0;var we=function(_e){return ee[oe].apply(pe,[_e].concat(de))}}if(this.length>1){for(pe=pe.transpose();ce<pe.length;ce++)he[ce]=we(pe[ce]);return he}return we(this[0])}})(ue[ae])}("quantiles percentileOfScore".split(" "))}(te,Math),function(ee,re){ee.gammaln=function(ie){var se=0,le=[76.18009172947146,-86.50532032941678,24.01409824083091,-1.231739572450155,.001208650973866179,-5395239384953e-18],ue=1.000000000190015,ae,oe,he;for(he=(oe=ae=ie)+5.5,he-=(ae+.5)*re.log(he);se<6;se++)ue+=le[se]/++oe;return re.log(2.5066282746310007*ue/ae)-he},ee.loggam=function(ie){var se,le,ue,ae,oe,he,ce,pe=[.08333333333333333,-.002777777777777778,.0007936507936507937,-.0005952380952380952,.0008417508417508418,-.001917526917526918,.00641025641025641,-.02955065359477124,.1796443723688307,-1.3924322169059];if(se=ie,ce=0,ie==1||ie==2)return 0;for(ie<=7&&(ce=re.floor(7-ie),se=ie+ce),le=1/(se*se),ue=2*re.PI,oe=pe[9],he=8;he>=0;he--)oe*=le,oe+=pe[he];if(ae=oe/se+.5*re.log(ue)+(se-.5)*re.log(se)-se,ie<=7)for(he=1;he<=ce;he++)ae-=re.log(se-1),se-=1;return ae},ee.gammafn=function(ie){var se=[-1.716185138865495,24.76565080557592,-379.80425647094563,629.3311553128184,866.9662027904133,-31451.272968848367,-36144.413418691176,66456.14382024054],le=[-30.8402300119739,315.35062697960416,-1015.1563674902192,-3107.771671572311,22538.11842098015,4755.846277527881,-134659.9598649693,-115132.2596755535],ue=!1,ae=0,oe=0,he=0,ce=ie,pe,de,me,ve;if(ie>171.6243769536076)return 1/0;if(ce<=0)if(ve=ce%1+36e-17,ve)ue=(ce&1?-1:1)*re.PI/re.sin(re.PI*ve),ce=1-ce;else return 1/0;for(me=ce,ce<1?de=ce++:de=(ce-=ae=(ce|0)-1)-1,pe=0;pe<8;++pe)he=(he+se[pe])*de,oe=oe*de+le[pe];if(ve=he/oe+1,me<ce)ve/=me;else if(me>ce)for(pe=0;pe<ae;++pe)ve*=ce,ce++;return ue&&(ve=ue/ve),ve},ee.gammap=function(ie,se){return ee.lowRegGamma(ie,se)*ee.gammafn(ie)},ee.lowRegGamma=function(ie,se){var le=ee.gammaln(ie),ue=ie,ae=1/ie,oe=ae,he=se+1-ie,ce=1/1e-30,pe=1/he,de=pe,me=1,ve=-~(re.log(ie>=1?ie:1/ie)*8.5+ie*.4+17),we;if(se<0||ie<=0)return NaN;if(se<ie+1){for(;me<=ve;me++)ae+=oe*=se/++ue;return ae*re.exp(-se+ie*re.log(se)-le)}for(;me<=ve;me++)we=-me*(me-ie),he+=2,pe=we*pe+he,ce=he+we/ce,pe=1/pe,de*=pe*ce;return 1-de*re.exp(-se+ie*re.log(se)-le)},ee.factorialln=function(ie){return ie<0?NaN:ee.gammaln(ie+1)},ee.factorial=function(ie){return ie<0?NaN:ee.gammafn(ie+1)},ee.combination=function(ie,se){return ie>170||se>170?re.exp(ee.combinationln(ie,se)):ee.factorial(ie)/ee.factorial(se)/ee.factorial(ie-se)},ee.combinationln=function(ie,se){return ee.factorialln(ie)-ee.factorialln(se)-ee.factorialln(ie-se)},ee.permutation=function(ie,se){return ee.factorial(ie)/ee.factorial(ie-se)},ee.betafn=function(ie,se){if(!(ie<=0||se<=0))return ie+se>170?re.exp(ee.betaln(ie,se)):ee.gammafn(ie)*ee.gammafn(se)/ee.gammafn(ie+se)},ee.betaln=function(ie,se){return ee.gammaln(ie)+ee.gammaln(se)-ee.gammaln(ie+se)},ee.betacf=function(ie,se,le){var ue=1e-30,ae=1,oe=se+le,he=se+1,ce=se-1,pe=1,de=1-oe*ie/he,me,ve,we,ge;for(re.abs(de)<ue&&(de=ue),de=1/de,ge=de;ae<=100&&(me=2*ae,ve=ae*(le-ae)*ie/((ce+me)*(se+me)),de=1+ve*de,re.abs(de)<ue&&(de=ue),pe=1+ve/pe,re.abs(pe)<ue&&(pe=ue),de=1/de,ge*=de*pe,ve=-(se+ae)*(oe+ae)*ie/((se+me)*(he+me)),de=1+ve*de,re.abs(de)<ue&&(de=ue),pe=1+ve/pe,re.abs(pe)<ue&&(pe=ue),de=1/de,we=de*pe,ge*=we,!(re.abs(we-1)<3e-7));ae++);return ge},ee.gammapinv=function(ie,se){var le=0,ue=se-1,ae=1e-8,oe=ee.gammaln(se),he,ce,pe,de,me,ve,we;if(ie>=1)return re.max(100,se+100*re.sqrt(se));if(ie<=0)return 0;for(se>1?(ve=re.log(ue),we=re.exp(ue*(ve-1)-oe),me=ie<.5?ie:1-ie,pe=re.sqrt(-2*re.log(me)),he=(2.30753+pe*.27061)/(1+pe*(.99229+pe*.04481))-pe,ie<.5&&(he=-he),he=re.max(.001,se*re.pow(1-1/(9*se)-he/(3*re.sqrt(se)),3))):(pe=1-se*(.253+se*.12),ie<pe?he=re.pow(ie/pe,1/se):he=1-re.log(1-(ie-pe)/(1-pe)));le<12;le++){if(he<=0)return 0;if(ce=ee.lowRegGamma(se,he)-ie,se>1?pe=we*re.exp(-(he-ue)+ue*(re.log(he)-ve)):pe=re.exp(-he+ue*re.log(he)-oe),de=ce/pe,he-=pe=de/(1-.5*re.min(1,de*((se-1)/he-1))),he<=0&&(he=.5*(he+pe)),re.abs(pe)<ae*he)break}return he},ee.erf=function(ie){var se=[-1.3026537197817094,.6419697923564902,.019476473204185836,-.00956151478680863,-.000946595344482036,.000366839497852761,42523324806907e-18,-20278578112534e-18,-1624290004647e-18,130365583558e-17,15626441722e-18,-85238095915e-18,6529054439e-18,5059343495e-18,-991364156e-18,-227365122e-18,96467911e-18,2394038e-18,-6886027e-18,894487e-18,313092e-18,-112708e-18,381e-18,7106e-18,-1523e-18,-94e-18,121e-18,-28e-18],le=se.length-1,ue=!1,ae=0,oe=0,he,ce,pe,de;for(ie<0&&(ie=-ie,ue=!0),he=2/(2+ie),ce=4*he-2;le>0;le--)pe=ae,ae=ce*ae-oe+se[le],oe=pe;return de=he*re.exp(-ie*ie+.5*(se[0]+ce*ae)-oe),ue?de-1:1-de},ee.erfc=function(ie){return 1-ee.erf(ie)},ee.erfcinv=function(ie){var se=0,le,ue,ae,oe;if(ie>=2)return-100;if(ie<=0)return 100;for(oe=ie<1?ie:2-ie,ae=re.sqrt(-2*re.log(oe/2)),le=-.70711*((2.30753+ae*.27061)/(1+ae*(.99229+ae*.04481))-ae);se<2;se++)ue=ee.erfc(le)-oe,le+=ue/(1.1283791670955126*re.exp(-le*le)-le*ue);return ie<1?le:-le},ee.ibetainv=function(ie,se,le){var ue=1e-8,ae=se-1,oe=le-1,he=0,ce,pe,de,me,ve,we,ge,_e,Te,Ne,ye;if(ie<=0)return 0;if(ie>=1)return 1;for(se>=1&&le>=1?(de=ie<.5?ie:1-ie,me=re.sqrt(-2*re.log(de)),ge=(2.30753+me*.27061)/(1+me*(.99229+me*.04481))-me,ie<.5&&(ge=-ge),_e=(ge*ge-3)/6,Te=2/(1/(2*se-1)+1/(2*le-1)),Ne=ge*re.sqrt(_e+Te)/Te-(1/(2*le-1)-1/(2*se-1))*(_e+5/6-2/(3*Te)),ge=se/(se+le*re.exp(2*Ne))):(ce=re.log(se/(se+le)),pe=re.log(le/(se+le)),me=re.exp(se*ce)/se,ve=re.exp(le*pe)/le,Ne=me+ve,ie<me/Ne?ge=re.pow(se*Ne*ie,1/se):ge=1-re.pow(le*Ne*(1-ie),1/le)),ye=-ee.gammaln(se)-ee.gammaln(le)+ee.gammaln(se+le);he<10;he++){if(ge===0||ge===1)return ge;if(we=ee.ibeta(ge,se,le)-ie,me=re.exp(ae*re.log(ge)+oe*re.log(1-ge)+ye),ve=we/me,ge-=me=ve/(1-.5*re.min(1,ve*(ae/ge-oe/(1-ge)))),ge<=0&&(ge=.5*(ge+me)),ge>=1&&(ge=.5*(ge+me+1)),re.abs(me)<ue*ge&&he>0)break}return ge},ee.ibeta=function(ie,se,le){var ue=ie===0||ie===1?0:re.exp(ee.gammaln(se+le)-ee.gammaln(se)-ee.gammaln(le)+se*re.log(ie)+le*re.log(1-ie));return ie<0||ie>1?!1:ie<(se+1)/(se+le+2)?ue*ee.betacf(ie,se,le)/se:1-ue*ee.betacf(1-ie,le,se)/le},ee.randn=function(ie,se){var le,ue,ae,oe,he;if(se||(se=ie),ie)return ee.create(ie,se,function(){return ee.randn()});do le=ee._random_fn(),ue=1.7156*(ee._random_fn()-.5),ae=le-.449871,oe=re.abs(ue)+.386595,he=ae*ae+oe*(.196*oe-.25472*ae);while(he>.27597&&(he>.27846||ue*ue>-4*re.log(le)*le*le));return ue/le},ee.randg=function(ie,se,le){var ue=ie,ae,oe,he,ce,pe,de;if(le||(le=se),ie||(ie=1),se)return de=ee.zeros(se,le),de.alter(function(){return ee.randg(ie)}),de;ie<1&&(ie+=1),ae=ie-1/3,oe=1/re.sqrt(9*ae);do{do pe=ee.randn(),ce=1+oe*pe;while(ce<=0);ce=ce*ce*ce,he=ee._random_fn()}while(he>1-.331*re.pow(pe,4)&&re.log(he)>.5*pe*pe+ae*(1-ce+re.log(ce)));if(ie==ue)return ae*ce;do he=ee._random_fn();while(he===0);return re.pow(he,1/ue)*ae*ce},function(ne){for(var ie=0;ie<ne.length;ie++)(function(se){ee.fn[se]=function(){return ee(ee.map(this,function(le){return ee[se](le)}))}})(ne[ie])}("gammaln gammafn factorial factorialln".split(" ")),function(ne){for(var ie=0;ie<ne.length;ie++)(function(se){ee.fn[se]=function(){return ee(ee[se].apply(null,arguments))}})(ne[ie])}("randn".split(" "))}(te,Math),function(ee,re){(function(ue){for(var ae=0;ae<ue.length;ae++)(function(oe){ee[oe]=function he(ce,pe,de){return this instanceof he?(this._a=ce,this._b=pe,this._c=de,this):new he(ce,pe,de)},ee.fn[oe]=function(he,ce,pe){var de=ee[oe](he,ce,pe);return de.data=this,de},ee[oe].prototype.sample=function(he){var ce=this._a,pe=this._b,de=this._c;return he?ee.alter(he,function(){return ee[oe].sample(ce,pe,de)}):ee[oe].sample(ce,pe,de)},function(he){for(var ce=0;ce<he.length;ce++)(function(pe){ee[oe].prototype[pe]=function(de){var me=this._a,ve=this._b,we=this._c;return!de&&de!==0&&(de=this.data),typeof de!="number"?ee.fn.map.call(de,function(ge){return ee[oe][pe](ge,me,ve,we)}):ee[oe][pe](de,me,ve,we)}})(he[ce])}("pdf cdf inv".split(" ")),function(he){for(var ce=0;ce<he.length;ce++)(function(pe){ee[oe].prototype[pe]=function(){return ee[oe][pe](this._a,this._b,this._c)}})(he[ce])}("mean median mode variance".split(" "))})(ue[ae])})("beta centralF cauchy chisquare exponential gamma invgamma kumaraswamy laplace lognormal noncentralt normal pareto studentt weibull uniform binomial negbin hypgeom poisson triangular tukey arcsine".split(" ")),ee.extend(ee.beta,{pdf:function(ae,oe,he){return ae>1||ae<0?0:oe==1&&he==1?1:oe<512&&he<512?re.pow(ae,oe-1)*re.pow(1-ae,he-1)/ee.betafn(oe,he):re.exp((oe-1)*re.log(ae)+(he-1)*re.log(1-ae)-ee.betaln(oe,he))},cdf:function(ae,oe,he){return ae>1||ae<0?(ae>1)*1:ee.ibeta(ae,oe,he)},inv:function(ae,oe,he){return ee.ibetainv(ae,oe,he)},mean:function(ae,oe){return ae/(ae+oe)},median:function(ae,oe){return ee.ibetainv(.5,ae,oe)},mode:function(ae,oe){return(ae-1)/(ae+oe-2)},sample:function(ae,oe){var he=ee.randg(ae);return he/(he+ee.randg(oe))},variance:function(ae,oe){return ae*oe/(re.pow(ae+oe,2)*(ae+oe+1))}}),ee.extend(ee.centralF,{pdf:function(ae,oe,he){var ce,pe,de;return ae<0?0:oe<=2?ae===0&&oe<2?1/0:ae===0&&oe===2?1:1/ee.betafn(oe/2,he/2)*re.pow(oe/he,oe/2)*re.pow(ae,oe/2-1)*re.pow(1+oe/he*ae,-(oe+he)/2):(ce=oe*ae/(he+ae*oe),pe=he/(he+ae*oe),de=oe*pe/2,de*ee.binomial.pdf((oe-2)/2,(oe+he-2)/2,ce))},cdf:function(ae,oe,he){return ae<0?0:ee.ibeta(oe*ae/(oe*ae+he),oe/2,he/2)},inv:function(ae,oe,he){return he/(oe*(1/ee.ibetainv(ae,oe/2,he/2)-1))},mean:function(ae,oe){return oe>2?oe/(oe-2):void 0},mode:function(ae,oe){return ae>2?oe*(ae-2)/(ae*(oe+2)):void 0},sample:function(ae,oe){var he=ee.randg(ae/2)*2,ce=ee.randg(oe/2)*2;return he/ae/(ce/oe)},variance:function(ae,oe){if(!(oe<=4))return 2*oe*oe*(ae+oe-2)/(ae*(oe-2)*(oe-2)*(oe-4))}}),ee.extend(ee.cauchy,{pdf:function(ae,oe,he){return he<0?0:he/(re.pow(ae-oe,2)+re.pow(he,2))/re.PI},cdf:function(ae,oe,he){return re.atan((ae-oe)/he)/re.PI+.5},inv:function(ue,ae,oe){return ae+oe*re.tan(re.PI*(ue-.5))},median:function(ae){return ae},mode:function(ae){return ae},sample:function(ae,oe){return ee.randn()*re.sqrt(1/(2*ee.randg(.5)))*oe+ae}}),ee.extend(ee.chisquare,{pdf:function(ae,oe){return ae<0?0:ae===0&&oe===2?.5:re.exp((oe/2-1)*re.log(ae)-ae/2-oe/2*re.log(2)-ee.gammaln(oe/2))},cdf:function(ae,oe){return ae<0?0:ee.lowRegGamma(oe/2,ae/2)},inv:function(ue,ae){return 2*ee.gammapinv(ue,.5*ae)},mean:function(ue){return ue},median:function(ae){return ae*re.pow(1-2/(9*ae),3)},mode:function(ae){return ae-2>0?ae-2:0},sample:function(ae){return ee.randg(ae/2)*2},variance:function(ae){return 2*ae}}),ee.extend(ee.exponential,{pdf:function(ae,oe){return ae<0?0:oe*re.exp(-oe*ae)},cdf:function(ae,oe){return ae<0?0:1-re.exp(-oe*ae)},inv:function(ue,ae){return-re.log(1-ue)/ae},mean:function(ue){return 1/ue},median:function(ue){return 1/ue*re.log(2)},mode:function(){return 0},sample:function(ae){return-1/ae*re.log(ee._random_fn())},variance:function(ue){return re.pow(ue,-2)}}),ee.extend(ee.gamma,{pdf:function(ae,oe,he){return ae<0?0:ae===0&&oe===1?1/he:re.exp((oe-1)*re.log(ae)-ae/he-ee.gammaln(oe)-oe*re.log(he))},cdf:function(ae,oe,he){return ae<0?0:ee.lowRegGamma(oe,ae/he)},inv:function(ue,ae,oe){return ee.gammapinv(ue,ae)*oe},mean:function(ue,ae){return ue*ae},mode:function(ae,oe){if(ae>1)return(ae-1)*oe},sample:function(ae,oe){return ee.randg(ae)*oe},variance:function(ae,oe){return ae*oe*oe}}),ee.extend(ee.invgamma,{pdf:function(ae,oe,he){return ae<=0?0:re.exp(-(oe+1)*re.log(ae)-he/ae-ee.gammaln(oe)+oe*re.log(he))},cdf:function(ae,oe,he){return ae<=0?0:1-ee.lowRegGamma(oe,he/ae)},inv:function(ue,ae,oe){return oe/ee.gammapinv(1-ue,ae)},mean:function(ue,ae){return ue>1?ae/(ue-1):void 0},mode:function(ae,oe){return oe/(ae+1)},sample:function(ae,oe){return oe/ee.randg(ae)},variance:function(ae,oe){if(!(ae<=2))return oe*oe/((ae-1)*(ae-1)*(ae-2))}}),ee.extend(ee.kumaraswamy,{pdf:function(ae,oe,he){return ae===0&&oe===1?he:ae===1&&he===1?oe:re.exp(re.log(oe)+re.log(he)+(oe-1)*re.log(ae)+(he-1)*re.log(1-re.pow(ae,oe)))},cdf:function(ae,oe,he){return ae<0?0:ae>1?1:1-re.pow(1-re.pow(ae,oe),he)},inv:function(ae,oe,he){return re.pow(1-re.pow(1-ae,1/he),1/oe)},mean:function(ue,ae){return ae*ee.gammafn(1+1/ue)*ee.gammafn(ae)/ee.gammafn(1+1/ue+ae)},median:function(ae,oe){return re.pow(1-re.pow(2,-1/oe),1/ae)},mode:function(ae,oe){if(ae>=1&&oe>=1&&ae!==1&&oe!==1)return re.pow((ae-1)/(ae*oe-1),1/ae)},variance:function(){throw new Error("variance not yet implemented")}}),ee.extend(ee.lognormal,{pdf:function(ae,oe,he){return ae<=0?0:re.exp(-re.log(ae)-.5*re.log(2*re.PI)-re.log(he)-re.pow(re.log(ae)-oe,2)/(2*he*he))},cdf:function(ae,oe,he){return ae<0?0:.5+.5*ee.erf((re.log(ae)-oe)/re.sqrt(2*he*he))},inv:function(ue,ae,oe){return re.exp(-1.4142135623730951*oe*ee.erfcinv(2*ue)+ae)},mean:function(ae,oe){return re.exp(ae+oe*oe/2)},median:function(ae){return re.exp(ae)},mode:function(ae,oe){return re.exp(ae-oe*oe)},sample:function(ae,oe){return re.exp(ee.randn()*oe+ae)},variance:function(ae,oe){return(re.exp(oe*oe)-1)*re.exp(2*ae+oe*oe)}}),ee.extend(ee.noncentralt,{pdf:function(ae,oe,he){var ce=1e-14;return re.abs(he)<ce?ee.studentt.pdf(ae,oe):re.abs(ae)<ce?re.exp(ee.gammaln((oe+1)/2)-he*he/2-.5*re.log(re.PI*oe)-ee.gammaln(oe/2)):oe/ae*(ee.noncentralt.cdf(ae*re.sqrt(1+2/oe),oe+2,he)-ee.noncentralt.cdf(ae,oe,he))},cdf:function(ae,oe,he){var ce=1e-14,pe=200;if(re.abs(he)<ce)return ee.studentt.cdf(ae,oe);var de=!1;ae<0&&(de=!0,he=-he);for(var me=ee.normal.cdf(-he,0,1),ve=ce+1,we=ve,ge=ae*ae/(ae*ae+oe),_e=0,Te=re.exp(-he*he/2),Ne=re.exp(-he*he/2-.5*re.log(2)-ee.gammaln(3/2))*he;_e<pe||we>ce||ve>ce;)we=ve,_e>0&&(Te*=he*he/(2*_e),Ne*=he*he/(2*(_e+1/2))),ve=Te*ee.beta.cdf(ge,_e+.5,oe/2)+Ne*ee.beta.cdf(ge,_e+1,oe/2),me+=.5*ve,_e++;return de?1-me:me}}),ee.extend(ee.normal,{pdf:function(ae,oe,he){return re.exp(-.5*re.log(2*re.PI)-re.log(he)-re.pow(ae-oe,2)/(2*he*he))},cdf:function(ae,oe,he){return .5*(1+ee.erf((ae-oe)/re.sqrt(2*he*he)))},inv:function(ue,ae,oe){return-1.4142135623730951*oe*ee.erfcinv(2*ue)+ae},mean:function(ue){return ue},median:function(ae){return ae},mode:function(ue){return ue},sample:function(ae,oe){return ee.randn()*oe+ae},variance:function(ue,ae){return ae*ae}}),ee.extend(ee.pareto,{pdf:function(ae,oe,he){return ae<oe?0:he*re.pow(oe,he)/re.pow(ae,he+1)},cdf:function(ae,oe,he){return ae<oe?0:1-re.pow(oe/ae,he)},inv:function(ae,oe,he){return oe/re.pow(1-ae,1/he)},mean:function(ae,oe){if(!(oe<=1))return oe*re.pow(ae,oe)/(oe-1)},median:function(ae,oe){return ae*(oe*re.SQRT2)},mode:function(ae){return ae},variance:function(ue,ae){if(!(ae<=2))return ue*ue*ae/(re.pow(ae-1,2)*(ae-2))}}),ee.extend(ee.studentt,{pdf:function(ae,oe){return oe=oe>1e100?1e100:oe,1/(re.sqrt(oe)*ee.betafn(.5,oe/2))*re.pow(1+ae*ae/oe,-((oe+1)/2))},cdf:function(ae,oe){var he=oe/2;return ee.ibeta((ae+re.sqrt(ae*ae+oe))/(2*re.sqrt(ae*ae+oe)),he,he)},inv:function(ue,ae){var oe=ee.ibetainv(2*re.min(ue,1-ue),.5*ae,.5);return oe=re.sqrt(ae*(1-oe)/oe),ue>.5?oe:-oe},mean:function(ae){return ae>1?0:void 0},median:function(){return 0},mode:function(){return 0},sample:function(ae){return ee.randn()*re.sqrt(ae/(2*ee.randg(ae/2)))},variance:function(ae){return ae>2?ae/(ae-2):ae>1?1/0:void 0}}),ee.extend(ee.weibull,{pdf:function(ae,oe,he){return ae<0||oe<0||he<0?0:he/oe*re.pow(ae/oe,he-1)*re.exp(-re.pow(ae/oe,he))},cdf:function(ae,oe,he){return ae<0?0:1-re.exp(-re.pow(ae/oe,he))},inv:function(ue,ae,oe){return ae*re.pow(-re.log(1-ue),1/oe)},mean:function(ue,ae){return ue*ee.gammafn(1+1/ae)},median:function(ae,oe){return ae*re.pow(re.log(2),1/oe)},mode:function(ae,oe){return oe<=1?0:ae*re.pow((oe-1)/oe,1/oe)},sample:function(ae,oe){return ae*re.pow(-re.log(ee._random_fn()),1/oe)},variance:function(ae,oe){return ae*ae*ee.gammafn(1+2/oe)-re.pow(ee.weibull.mean(ae,oe),2)}}),ee.extend(ee.uniform,{pdf:function(ae,oe,he){return ae<oe||ae>he?0:1/(he-oe)},cdf:function(ae,oe,he){return ae<oe?0:ae<he?(ae-oe)/(he-oe):1},inv:function(ue,ae,oe){return ae+ue*(oe-ae)},mean:function(ae,oe){return .5*(ae+oe)},median:function(ae,oe){return ee.mean(ae,oe)},mode:function(){throw new Error("mode is not yet implemented")},sample:function(ae,oe){return ae/2+oe/2+(oe/2-ae/2)*(2*ee._random_fn()-1)},variance:function(ae,oe){return re.pow(oe-ae,2)/12}});function ne(ue,ae,oe,he){for(var ce=0,pe=1,de=1,me=1,ve=0,we=0,ge;re.abs((de-we)/de)>he;)we=de,ge=-(ae+ve)*(ae+oe+ve)*ue/(ae+2*ve)/(ae+2*ve+1),ce=de+ge*ce,pe=me+ge*pe,ve=ve+1,ge=ve*(oe-ve)*ue/(ae+2*ve-1)/(ae+2*ve),de=ce+ge*de,me=pe+ge*me,ce=ce/me,pe=pe/me,de=de/me,me=1;return de/ae}ee.extend(ee.binomial,{pdf:function(ae,oe,he){return he===0||he===1?oe*he===ae?1:0:ee.combination(oe,ae)*re.pow(he,ae)*re.pow(1-he,oe-ae)},cdf:function(ae,oe,he){var ce,pe=1e-10;if(ae<0)return 0;if(ae>=oe)return 1;if(he<0||he>1||oe<=0)return NaN;ae=re.floor(ae);var de=he,me=ae+1,ve=oe-ae,we=me+ve,ge=re.exp(ee.gammaln(we)-ee.gammaln(ve)-ee.gammaln(me)+me*re.log(de)+ve*re.log(1-de));return de<(me+1)/(we+2)?ce=ge*ne(de,me,ve,pe):ce=1-ge*ne(1-de,ve,me,pe),re.round((1-ce)*(1/pe))/(1/pe)}}),ee.extend(ee.negbin,{pdf:function(ae,oe,he){return ae!==ae>>>0?!1:ae<0?0:ee.combination(ae+oe-1,oe-1)*re.pow(1-he,ae)*re.pow(he,oe)},cdf:function(ae,oe,he){var ce=0,pe=0;if(ae<0)return 0;for(;pe<=ae;pe++)ce+=ee.negbin.pdf(pe,oe,he);return ce}}),ee.extend(ee.hypgeom,{pdf:function(ae,oe,he,ce){if(ae!==ae|0)return!1;if(ae<0||ae<he-(oe-ce))return 0;if(ae>ce||ae>he)return 0;if(he*2>oe)return ce*2>oe?ee.hypgeom.pdf(oe-he-ce+ae,oe,oe-he,oe-ce):ee.hypgeom.pdf(ce-ae,oe,oe-he,ce);if(ce*2>oe)return ee.hypgeom.pdf(he-ae,oe,he,oe-ce);if(he<ce)return ee.hypgeom.pdf(ae,oe,ce,he);for(var pe=1,de=0,me=0;me<ae;me++){for(;pe>1&&de<ce;)pe*=1-he/(oe-de),de++;pe*=(ce-me)*(he-me)/((me+1)*(oe-he-ce+me+1))}for(;de<ce;de++)pe*=1-he/(oe-de);return re.min(1,re.max(0,pe))},cdf:function(ae,oe,he,ce){if(ae<0||ae<he-(oe-ce))return 0;if(ae>=ce||ae>=he)return 1;if(he*2>oe)return ce*2>oe?ee.hypgeom.cdf(oe-he-ce+ae,oe,oe-he,oe-ce):1-ee.hypgeom.cdf(ce-ae-1,oe,oe-he,ce);if(ce*2>oe)return 1-ee.hypgeom.cdf(he-ae-1,oe,he,oe-ce);if(he<ce)return ee.hypgeom.cdf(ae,oe,ce,he);for(var pe=1,de=1,me=0,ve=0;ve<ae;ve++){for(;pe>1&&me<ce;){var we=1-he/(oe-me);de*=we,pe*=we,me++}de*=(ce-ve)*(he-ve)/((ve+1)*(oe-he-ce+ve+1)),pe+=de}for(;me<ce;me++)pe*=1-he/(oe-me);return re.min(1,re.max(0,pe))}}),ee.extend(ee.poisson,{pdf:function(ae,oe){return oe<0||ae%1!==0||ae<0?0:re.pow(oe,ae)*re.exp(-oe)/ee.factorial(ae)},cdf:function(ae,oe){var he=[],ce=0;if(ae<0)return 0;for(;ce<=ae;ce++)he.push(ee.poisson.pdf(ce,oe));return ee.sum(he)},mean:function(ue){return ue},variance:function(ue){return ue},sampleSmall:function(ae){var oe=1,he=0,ce=re.exp(-ae);do he++,oe*=ee._random_fn();while(oe>ce);return he-1},sampleLarge:function(ae){var oe=ae,he,ce,pe,de,me,ve,we,ge,_e,Te;for(de=re.sqrt(oe),me=re.log(oe),we=.931+2.53*de,ve=-.059+.02483*we,ge=1.1239+1.1328/(we-3.4),_e=.9277-3.6224/(we-2);;){if(ce=re.random()-.5,pe=re.random(),Te=.5-re.abs(ce),he=re.floor((2*ve/Te+we)*ce+oe+.43),Te>=.07&&pe<=_e)return he;if(!(he<0||Te<.013&&pe>Te)&&re.log(pe)+re.log(ge)-re.log(ve/(Te*Te)+we)<=-oe+he*me-ee.loggam(he+1))return he}},sample:function(ae){return ae<10?this.sampleSmall(ae):this.sampleLarge(ae)}}),ee.extend(ee.triangular,{pdf:function(ae,oe,he,ce){return he<=oe||ce<oe||ce>he?NaN:ae<oe||ae>he?0:ae<ce?2*(ae-oe)/((he-oe)*(ce-oe)):ae===ce?2/(he-oe):2*(he-ae)/((he-oe)*(he-ce))},cdf:function(ae,oe,he,ce){return he<=oe||ce<oe||ce>he?NaN:ae<=oe?0:ae>=he?1:ae<=ce?re.pow(ae-oe,2)/((he-oe)*(ce-oe)):1-re.pow(he-ae,2)/((he-oe)*(he-ce))},inv:function(ae,oe,he,ce){return he<=oe||ce<oe||ce>he?NaN:ae<=(ce-oe)/(he-oe)?oe+(he-oe)*re.sqrt(ae*((ce-oe)/(he-oe))):oe+(he-oe)*(1-re.sqrt((1-ae)*(1-(ce-oe)/(he-oe))))},mean:function(ae,oe,he){return(ae+oe+he)/3},median:function(ae,oe,he){if(he<=(ae+oe)/2)return oe-re.sqrt((oe-ae)*(oe-he))/re.sqrt(2);if(he>(ae+oe)/2)return ae+re.sqrt((oe-ae)*(he-ae))/re.sqrt(2)},mode:function(ae,oe,he){return he},sample:function(ae,oe,he){var ce=ee._random_fn();return ce<(he-ae)/(oe-ae)?ae+re.sqrt(ce*(oe-ae)*(he-ae)):oe-re.sqrt((1-ce)*(oe-ae)*(oe-he))},variance:function(ae,oe,he){return(ae*ae+oe*oe+he*he-ae*oe-ae*he-oe*he)/18}}),ee.extend(ee.arcsine,{pdf:function(ae,oe,he){return he<=oe?NaN:ae<=oe||ae>=he?0:2/re.PI*re.pow(re.pow(he-oe,2)-re.pow(2*ae-oe-he,2),-.5)},cdf:function(ae,oe,he){return ae<oe?0:ae<he?2/re.PI*re.asin(re.sqrt((ae-oe)/(he-oe))):1},inv:function(ue,ae,oe){return ae+(.5-.5*re.cos(re.PI*ue))*(oe-ae)},mean:function(ae,oe){return oe<=ae?NaN:(ae+oe)/2},median:function(ae,oe){return oe<=ae?NaN:(ae+oe)/2},mode:function(){throw new Error("mode is not yet implemented")},sample:function(ae,oe){return(ae+oe)/2+(oe-ae)/2*re.sin(2*re.PI*ee.uniform.sample(0,1))},variance:function(ae,oe){return oe<=ae?NaN:re.pow(oe-ae,2)/8}});function ie(ue){return ue/re.abs(ue)}ee.extend(ee.laplace,{pdf:function(ae,oe,he){return he<=0?0:re.exp(-re.abs(ae-oe)/he)/(2*he)},cdf:function(ae,oe,he){return he<=0?0:ae<oe?.5*re.exp((ae-oe)/he):1-.5*re.exp(-(ae-oe)/he)},mean:function(ue){return ue},median:function(ue){return ue},mode:function(ue){return ue},variance:function(ue,ae){return 2*ae*ae},sample:function(ae,oe){var he=ee._random_fn()-.5;return ae-oe*ie(he)*re.log(1-2*re.abs(he))}});function se(ue,ae,oe){var he=12,ce=6,pe=-30,de=-50,me=60,ve=8,we=3,ge=2,_e=3,Te=[.9815606342467192,.9041172563704749,.7699026741943047,.5873179542866175,.3678314989981802,.1252334085114689],Ne=[.04717533638651183,.10693932599531843,.16007832854334622,.20316742672306592,.2334925365383548,.24914704581340277],ye=ue*.5;if(ye>=ve)return 1;var Le=2*ee.normal.cdf(ye,0,1,1,0)-1;Le>=re.exp(de/oe)?Le=re.pow(Le,oe):Le=0;var xe;ue>we?xe=ge:xe=_e;for(var Oe=ye,Fe=(ve-ye)/xe,De=Oe+Fe,Me=0,We=oe-1,Ge=1;Ge<=xe;Ge++){for(var ht=0,qe=.5*(De+Oe),ot=.5*(De-Oe),nt=1;nt<=he;nt++){var je,Ke;ce<nt?(je=he-nt+1,Ke=Te[je-1]):(je=nt,Ke=-Te[je-1]);var et=ot*Ke,tt=qe+et,Ye=tt*tt;if(Ye>me)break;var at=2*ee.normal.cdf(tt,0,1,1,0),Bt=2*ee.normal.cdf(tt,ue,1,1,0),Et=at*.5-Bt*.5;Et>=re.exp(pe/We)&&(Et=Ne[je-1]*re.exp(-(.5*Ye))*re.pow(Et,We),ht+=Et)}ht*=2*ot*oe/re.sqrt(2*re.PI),Me+=ht,Oe=De,De+=Fe}return Le+=Me,Le<=re.exp(pe/ae)?0:(Le=re.pow(Le,ae),Le>=1?1:Le)}function le(ue,ae,oe){var he=.322232421088,ce=.099348462606,pe=-1,de=.588581570495,me=-.342242088547,ve=.531103462366,we=-.204231210125,ge=.10353775285,_e=-453642210148e-16,Te=.0038560700634,Ne=.8832,ye=.2368,Le=1.214,xe=1.208,Oe=1.4142,Fe=120,De=.5-.5*ue,Me=re.sqrt(re.log(1/(De*De))),We=Me+((((Me*_e+we)*Me+me)*Me+pe)*Me+he)/((((Me*Te+ge)*Me+ve)*Me+de)*Me+ce);oe<Fe&&(We+=(We*We*We+We)/oe/4);var Ge=Ne-ye*We;return oe<Fe&&(Ge+=-Le/oe+xe*We/oe),We*(Ge*re.log(ae-1)+Oe)}ee.extend(ee.tukey,{cdf:function(ae,oe,he){var ce=1,pe=oe,de=16,me=8,ve=-30,we=1e-14,ge=100,_e=800,Te=5e3,Ne=25e3,ye=1,Le=.5,xe=.25,Oe=.125,Fe=[.9894009349916499,.9445750230732326,.8656312023878318,.755404408355003,.6178762444026438,.45801677765722737,.2816035507792589,.09501250983763744],De=[.027152459411754096,.062253523938647894,.09515851168249279,.12462897125553388,.14959598881657674,.16915651939500254,.18260341504492358,.1894506104550685];if(ae<=0)return 0;if(he<2||ce<1||pe<2)return NaN;if(!Number.isFinite(ae))return 1;if(he>Ne)return se(ae,ce,pe);var Me=he*.5,We=Me*re.log(he)-he*re.log(2)-ee.gammaln(Me),Ge=Me-1,ht=he*.25,qe;he<=ge?qe=ye:he<=_e?qe=Le:he<=Te?qe=xe:qe=Oe,We+=re.log(qe);for(var ot=0,nt=1;nt<=50;nt++){for(var je=0,Ke=(2*nt-1)*qe,et=1;et<=de;et++){var tt,Ye;me<et?(tt=et-me-1,Ye=We+Ge*re.log(Ke+Fe[tt]*qe)-(Fe[tt]*qe+Ke)*ht):(tt=et-1,Ye=We+Ge*re.log(Ke-Fe[tt]*qe)+(Fe[tt]*qe-Ke)*ht);var at;if(Ye>=ve){me<et?at=ae*re.sqrt((Fe[tt]*qe+Ke)*.5):at=ae*re.sqrt((-(Fe[tt]*qe)+Ke)*.5);var Bt=se(at,ce,pe),Et=Bt*De[tt]*re.exp(Ye);je+=Et}}if(nt*qe>=1&&je<=we)break;ot+=je}if(je>we)throw new Error("tukey.cdf failed to converge");return ot>1&&(ot=1),ot},inv:function(ue,ae,oe){var he=1,ce=ae,pe=1e-4,de=50;if(oe<2||he<1||ce<2)return NaN;if(ue<0||ue>1)return NaN;if(ue===0)return 0;if(ue===1)return 1/0;var me=le(ue,ce,oe),ve=ee.tukey.cdf(me,ae,oe)-ue,we;ve>0?we=re.max(0,me-1):we=me+1;for(var ge=ee.tukey.cdf(we,ae,oe)-ue,_e,Te=1;Te<de;Te++){_e=we-ge*(we-me)/(ge-ve),ve=ge,me=we,_e<0&&(_e=0,ge=-ue),ge=ee.tukey.cdf(_e,ae,oe)-ue,we=_e;var Ne=re.abs(we-me);if(Ne<pe)return _e}throw new Error("tukey.inv failed to converge")}})}(te,Math),function(ee,re){var ne=Array.prototype.push,ie=ee.utils.isArray;function se(le){return ie(le)||le instanceof ee}ee.extend({add:function(ue,ae){return se(ae)?(se(ae[0])||(ae=[ae]),ee.map(ue,function(oe,he,ce){return oe+ae[he][ce]})):ee.map(ue,function(oe){return oe+ae})},subtract:function(ue,ae){return se(ae)?(se(ae[0])||(ae=[ae]),ee.map(ue,function(oe,he,ce){return oe-ae[he][ce]||0})):ee.map(ue,function(oe){return oe-ae})},divide:function(ue,ae){return se(ae)?(se(ae[0])||(ae=[ae]),ee.multiply(ue,ee.inv(ae))):ee.map(ue,function(oe){return oe/ae})},multiply:function(ue,ae){var oe,he,ce,pe,de,me,ve,we;if(ue.length===void 0&&ae.length===void 0)return ue*ae;if(de=ue.length,me=ue[0].length,ve=ee.zeros(de,ce=se(ae)?ae[0].length:me),we=0,se(ae)){for(;we<ce;we++)for(oe=0;oe<de;oe++){for(pe=0,he=0;he<me;he++)pe+=ue[oe][he]*ae[he][we];ve[oe][we]=pe}return de===1&&we===1?ve[0][0]:ve}return ee.map(ue,function(ge){return ge*ae})},outer:function(ue,ae){return ee.multiply(ue.map(function(oe){return[oe]}),[ae])},dot:function(ue,ae){se(ue[0])||(ue=[ue]),se(ae[0])||(ae=[ae]);for(var oe=ue[0].length===1&&ue.length!==1?ee.transpose(ue):ue,he=ae[0].length===1&&ae.length!==1?ee.transpose(ae):ae,ce=[],pe=0,de=oe.length,me=oe[0].length,ve,we;pe<de;pe++){for(ce[pe]=[],ve=0,we=0;we<me;we++)ve+=oe[pe][we]*he[pe][we];ce[pe]=ve}return ce.length===1?ce[0]:ce},pow:function(ue,ae){return ee.map(ue,function(oe){return re.pow(oe,ae)})},exp:function(ue){return ee.map(ue,function(ae){return re.exp(ae)})},log:function(ue){return ee.map(ue,function(ae){return re.log(ae)})},abs:function(ue){return ee.map(ue,function(ae){return re.abs(ae)})},norm:function(ue,ae){var oe=0,he=0;for(isNaN(ae)&&(ae=2),se(ue[0])&&(ue=ue[0]);he<ue.length;he++)oe+=re.pow(re.abs(ue[he]),ae);return re.pow(oe,1/ae)},angle:function(ue,ae){return re.acos(ee.dot(ue,ae)/(ee.norm(ue)*ee.norm(ae)))},aug:function(ue,ae){var oe=[],he;for(he=0;he<ue.length;he++)oe.push(ue[he].slice());for(he=0;he<oe.length;he++)ne.apply(oe[he],ae[he]);return oe},inv:function(ue){for(var ae=ue.length,oe=ue[0].length,he=ee.identity(ae,oe),ce=ee.gauss_jordan(ue,he),pe=[],de=0,me;de<ae;de++)for(pe[de]=[],me=oe;me<ce[0].length;me++)pe[de][me-oe]=ce[de][me];return pe},det:function(ue){var ae=ue.length,oe=ae*2,he=new Array(oe),ce=ae-1,pe=oe-1,de=ce-ae+1,me=pe,ve=0,we=0,ge;if(ae===2)return ue[0][0]*ue[1][1]-ue[0][1]*ue[1][0];for(;ve<oe;ve++)he[ve]=1;for(ve=0;ve<ae;ve++){for(ge=0;ge<ae;ge++)he[de<0?de+ae:de]*=ue[ve][ge],he[me<ae?me+ae:me]*=ue[ve][ge],de++,me--;de=--ce-ae+1,me=--pe}for(ve=0;ve<ae;ve++)we+=he[ve];for(;ve<oe;ve++)we-=he[ve];return we},gauss_elimination:function(ue,ae){var oe=0,he=0,ce=ue.length,pe=ue[0].length,de=1,me=0,ve=[],we,ge,_e,Te;for(ue=ee.aug(ue,ae),we=ue[0].length,oe=0;oe<ce;oe++){for(ge=ue[oe][oe],he=oe,Te=oe+1;Te<pe;Te++)ge<re.abs(ue[Te][oe])&&(ge=ue[Te][oe],he=Te);if(he!=oe)for(Te=0;Te<we;Te++)_e=ue[oe][Te],ue[oe][Te]=ue[he][Te],ue[he][Te]=_e;for(he=oe+1;he<ce;he++)for(de=ue[he][oe]/ue[oe][oe],Te=oe;Te<we;Te++)ue[he][Te]=ue[he][Te]-de*ue[oe][Te]}for(oe=ce-1;oe>=0;oe--){for(me=0,he=oe+1;he<=ce-1;he++)me=me+ve[he]*ue[oe][he];ve[oe]=(ue[oe][we-1]-me)/ue[oe][oe]}return ve},gauss_jordan:function(ue,ae){var oe=ee.aug(ue,ae),he=oe.length,ce=oe[0].length,pe=0,de,me,ve;for(me=0;me<he;me++){var we=me;for(ve=me+1;ve<he;ve++)re.abs(oe[ve][me])>re.abs(oe[we][me])&&(we=ve);var ge=oe[me];for(oe[me]=oe[we],oe[we]=ge,ve=me+1;ve<he;ve++)for(pe=oe[ve][me]/oe[me][me],de=me;de<ce;de++)oe[ve][de]-=oe[me][de]*pe}for(me=he-1;me>=0;me--){for(pe=oe[me][me],ve=0;ve<me;ve++)for(de=ce-1;de>me-1;de--)oe[ve][de]-=oe[me][de]*oe[ve][me]/pe;for(oe[me][me]/=pe,de=he;de<ce;de++)oe[me][de]/=pe}return oe},triaUpSolve:function(ue,ae){var oe=ue[0].length,he=ee.zeros(1,oe)[0],ce,pe=!1;return ae[0].length!=null&&(ae=ae.map(function(de){return de[0]}),pe=!0),ee.arange(oe-1,-1,-1).forEach(function(de){ce=ee.arange(de+1,oe).map(function(me){return he[me]*ue[de][me]}),he[de]=(ae[de]-ee.sum(ce))/ue[de][de]}),pe?he.map(function(de){return[de]}):he},triaLowSolve:function(ue,ae){var oe=ue[0].length,he=ee.zeros(1,oe)[0],ce,pe=!1;return ae[0].length!=null&&(ae=ae.map(function(de){return de[0]}),pe=!0),ee.arange(oe).forEach(function(de){ce=ee.arange(de).map(function(me){return ue[de][me]*he[me]}),he[de]=(ae[de]-ee.sum(ce))/ue[de][de]}),pe?he.map(function(de){return[de]}):he},lu:function(ue){var ae=ue.length,oe=ee.identity(ae),he=ee.zeros(ue.length,ue[0].length),ce;return ee.arange(ae).forEach(function(pe){he[0][pe]=ue[0][pe]}),ee.arange(1,ae).forEach(function(pe){ee.arange(pe).forEach(function(de){ce=ee.arange(de).map(function(me){return oe[pe][me]*he[me][de]}),oe[pe][de]=(ue[pe][de]-ee.sum(ce))/he[de][de]}),ee.arange(pe,ae).forEach(function(de){ce=ee.arange(pe).map(function(me){return oe[pe][me]*he[me][de]}),he[pe][de]=ue[ce.length][de]-ee.sum(ce)})}),[oe,he]},cholesky:function(ue){var ae=ue.length,oe=ee.zeros(ue.length,ue[0].length),he;return ee.arange(ae).forEach(function(ce){he=ee.arange(ce).map(function(pe){return re.pow(oe[ce][pe],2)}),oe[ce][ce]=re.sqrt(ue[ce][ce]-ee.sum(he)),ee.arange(ce+1,ae).forEach(function(pe){he=ee.arange(ce).map(function(de){return oe[ce][de]*oe[pe][de]}),oe[pe][ce]=(ue[ce][pe]-ee.sum(he))/oe[ce][ce]})}),oe},gauss_jacobi:function(ue,ae,oe,he){for(var ce=0,pe=0,de=ue.length,me=[],ve=[],we=[],ge,_e,Te,Ne;ce<de;ce++)for(me[ce]=[],ve[ce]=[],we[ce]=[],pe=0;pe<de;pe++)ce>pe?(me[ce][pe]=ue[ce][pe],ve[ce][pe]=we[ce][pe]=0):ce<pe?(ve[ce][pe]=ue[ce][pe],me[ce][pe]=we[ce][pe]=0):(we[ce][pe]=ue[ce][pe],me[ce][pe]=ve[ce][pe]=0);for(Te=ee.multiply(ee.multiply(ee.inv(we),ee.add(me,ve)),-1),_e=ee.multiply(ee.inv(we),ae),ge=oe,Ne=ee.add(ee.multiply(Te,oe),_e),ce=2;re.abs(ee.norm(ee.subtract(Ne,ge)))>he;)ge=Ne,Ne=ee.add(ee.multiply(Te,ge),_e),ce++;return Ne},gauss_seidel:function(ue,ae,oe,he){for(var ce=0,pe=ue.length,de=[],me=[],ve=[],we,ge,_e,Te,Ne;ce<pe;ce++)for(de[ce]=[],me[ce]=[],ve[ce]=[],we=0;we<pe;we++)ce>we?(de[ce][we]=ue[ce][we],me[ce][we]=ve[ce][we]=0):ce<we?(me[ce][we]=ue[ce][we],de[ce][we]=ve[ce][we]=0):(ve[ce][we]=ue[ce][we],de[ce][we]=me[ce][we]=0);for(Te=ee.multiply(ee.multiply(ee.inv(ee.add(ve,de)),me),-1),_e=ee.multiply(ee.inv(ee.add(ve,de)),ae),ge=oe,Ne=ee.add(ee.multiply(Te,oe),_e),ce=2;re.abs(ee.norm(ee.subtract(Ne,ge)))>he;)ge=Ne,Ne=ee.add(ee.multiply(Te,ge),_e),ce=ce+1;return Ne},SOR:function(ue,ae,oe,he,ce){for(var pe=0,de=ue.length,me=[],ve=[],we=[],ge,_e,Te,Ne,ye;pe<de;pe++)for(me[pe]=[],ve[pe]=[],we[pe]=[],ge=0;ge<de;ge++)pe>ge?(me[pe][ge]=ue[pe][ge],ve[pe][ge]=we[pe][ge]=0):pe<ge?(ve[pe][ge]=ue[pe][ge],me[pe][ge]=we[pe][ge]=0):(we[pe][ge]=ue[pe][ge],me[pe][ge]=ve[pe][ge]=0);for(Ne=ee.multiply(ee.inv(ee.add(we,ee.multiply(me,ce))),ee.subtract(ee.multiply(we,1-ce),ee.multiply(ve,ce))),Te=ee.multiply(ee.multiply(ee.inv(ee.add(we,ee.multiply(me,ce))),ae),ce),_e=oe,ye=ee.add(ee.multiply(Ne,oe),Te),pe=2;re.abs(ee.norm(ee.subtract(ye,_e)))>he;)_e=ye,ye=ee.add(ee.multiply(Ne,_e),Te),pe++;return ye},householder:function(ue){for(var ae=ue.length,oe=ue[0].length,he=0,ce=[],pe=[],de,me,ve,we,ge;he<ae-1;he++){for(de=0,we=he+1;we<oe;we++)de+=ue[we][he]*ue[we][he];for(ge=ue[he+1][he]>0?-1:1,de=ge*re.sqrt(de),me=re.sqrt((de*de-ue[he+1][he]*de)/2),ce=ee.zeros(ae,1),ce[he+1][0]=(ue[he+1][he]-de)/(2*me),ve=he+2;ve<ae;ve++)ce[ve][0]=ue[ve][he]/(2*me);pe=ee.subtract(ee.identity(ae,oe),ee.multiply(ee.multiply(ce,ee.transpose(ce)),2)),ue=ee.multiply(pe,ee.multiply(ue,pe))}return ue},QR:function(){var le=ee.sum,ue=ee.arange;function ae(oe){var he=oe.length,ce=oe[0].length,pe=ee.zeros(ce,ce);oe=ee.copy(oe);var de,me,ve;for(me=0;me<ce;me++){for(pe[me][me]=re.sqrt(le(ue(he).map(function(we){return oe[we][me]*oe[we][me]}))),de=0;de<he;de++)oe[de][me]=oe[de][me]/pe[me][me];for(ve=me+1;ve<ce;ve++)for(pe[me][ve]=le(ue(he).map(function(we){return oe[we][me]*oe[we][ve]})),de=0;de<he;de++)oe[de][ve]=oe[de][ve]-oe[de][me]*pe[me][ve]}return[oe,pe]}return ae}(),lstsq:function(){function le(ae){ae=ee.copy(ae);var oe=ae.length,he=ee.identity(oe);return ee.arange(oe-1,-1,-1).forEach(function(ce){ee.sliceAssign(he,{row:ce},ee.divide(ee.slice(he,{row:ce}),ae[ce][ce])),ee.sliceAssign(ae,{row:ce},ee.divide(ee.slice(ae,{row:ce}),ae[ce][ce])),ee.arange(ce).forEach(function(pe){var de=ee.multiply(ae[pe][ce],-1),me=ee.slice(ae,{row:pe}),ve=ee.multiply(ee.slice(ae,{row:ce}),de);ee.sliceAssign(ae,{row:pe},ee.add(me,ve));var we=ee.slice(he,{row:pe}),ge=ee.multiply(ee.slice(he,{row:ce}),de);ee.sliceAssign(he,{row:pe},ee.add(we,ge))})}),he}function ue(ae,oe){var he=!1;oe[0].length===void 0&&(oe=oe.map(function(Ne){return[Ne]}),he=!0);var ce=ee.QR(ae),pe=ce[0],de=ce[1],me=ae[0].length,ve=ee.slice(pe,{col:{end:me}}),we=ee.slice(de,{row:{end:me}}),ge=le(we),_e=ee.transpose(ve);_e[0].length===void 0&&(_e=[_e]);var Te=ee.multiply(ee.multiply(ge,_e),oe);return Te.length===void 0&&(Te=[[Te]]),he?Te.map(function(Ne){return Ne[0]}):Te}return ue}(),jacobi:function(ue){for(var ae=1,oe=ue.length,he=ee.identity(oe,oe),ce=[],pe,de,me,ve,we,ge,_e,Te;ae===1;){for(ge=ue[0][1],ve=0,we=1,de=0;de<oe;de++)for(me=0;me<oe;me++)de!=me&&ge<re.abs(ue[de][me])&&(ge=re.abs(ue[de][me]),ve=de,we=me);for(ue[ve][ve]===ue[we][we]?_e=ue[ve][we]>0?re.PI/4:-re.PI/4:_e=re.atan(2*ue[ve][we]/(ue[ve][ve]-ue[we][we]))/2,Te=ee.identity(oe,oe),Te[ve][ve]=re.cos(_e),Te[ve][we]=-re.sin(_e),Te[we][ve]=re.sin(_e),Te[we][we]=re.cos(_e),he=ee.multiply(he,Te),pe=ee.multiply(ee.multiply(ee.inv(Te),ue),Te),ue=pe,ae=0,de=1;de<oe;de++)for(me=1;me<oe;me++)de!=me&&re.abs(ue[de][me])>.001&&(ae=1)}for(de=0;de<oe;de++)ce.push(ue[de][de]);return[he,ce]},rungekutta:function(ue,ae,oe,he,ce,pe){var de,me,ve,we,ge;if(pe===2)for(;he<=oe;)de=ae*ue(he,ce),me=ae*ue(he+ae,ce+de),ve=ce+(de+me)/2,ce=ve,he=he+ae;if(pe===4)for(;he<=oe;)de=ae*ue(he,ce),me=ae*ue(he+ae/2,ce+de/2),we=ae*ue(he+ae/2,ce+me/2),ge=ae*ue(he+ae,ce+we),ve=ce+(de+2*me+2*we+ge)/6,ce=ve,he=he+ae;return ce},romberg:function(ue,ae,oe,he){for(var ce=0,pe=(oe-ae)/2,de=[],me=[],ve=[],we,ge,_e,Te,Ne;ce<he/2;){for(Ne=ue(ae),_e=ae,Te=0;_e<=oe;_e=_e+pe,Te++)de[Te]=_e;for(we=de.length,_e=1;_e<we-1;_e++)Ne+=(_e%2!==0?4:2)*ue(de[_e]);Ne=pe/3*(Ne+ue(oe)),ve[ce]=Ne,pe/=2,ce++}for(ge=ve.length,we=1;ge!==1;){for(_e=0;_e<ge-1;_e++)me[_e]=(re.pow(4,we)*ve[_e+1]-ve[_e])/(re.pow(4,we)-1);ge=me.length,ve=me,me=[],we++}return ve},richardson:function(ue,ae,oe,he){function ce(ye,Le){for(var xe=0,Oe=ye.length,Fe;xe<Oe;xe++)ye[xe]===Le&&(Fe=xe);return Fe}for(var pe=re.abs(oe-ue[ce(ue,oe)+1]),de=0,me=[],ve=[],we,ge,_e,Te,Ne;he>=pe;)we=ce(ue,oe+he),ge=ce(ue,oe),me[de]=(ae[we]-2*ae[ge]+ae[2*ge-we])/(he*he),he/=2,de++;for(Te=me.length,_e=1;Te!=1;){for(Ne=0;Ne<Te-1;Ne++)ve[Ne]=(re.pow(4,_e)*me[Ne+1]-me[Ne])/(re.pow(4,_e)-1);Te=ve.length,me=ve,ve=[],_e++}return me},simpson:function(ue,ae,oe,he){for(var ce=(oe-ae)/he,pe=ue(ae),de=[],me=ae,ve=0,we=1,ge;me<=oe;me=me+ce,ve++)de[ve]=me;for(ge=de.length;we<ge-1;we++)pe+=(we%2!==0?4:2)*ue(de[we]);return ce/3*(pe+ue(oe))},hermite:function(ue,ae,oe,he){for(var ce=ue.length,pe=0,de=0,me=[],ve=[],we=[],ge=[],_e;de<ce;de++){for(me[de]=1,_e=0;_e<ce;_e++)de!=_e&&(me[de]*=(he-ue[_e])/(ue[de]-ue[_e]));for(ve[de]=0,_e=0;_e<ce;_e++)de!=_e&&(ve[de]+=1/(ue[de]-ue[_e]));we[de]=(1-2*(he-ue[de])*ve[de])*(me[de]*me[de]),ge[de]=(he-ue[de])*(me[de]*me[de]),pe+=we[de]*ae[de]+ge[de]*oe[de]}return pe},lagrange:function(ue,ae,oe){for(var he=0,ce=0,pe,de,me=ue.length;ce<me;ce++){for(de=ae[ce],pe=0;pe<me;pe++)ce!=pe&&(de*=(oe-ue[pe])/(ue[ce]-ue[pe]));he+=de}return he},cubic_spline:function(ue,ae,oe){for(var he=ue.length,ce=0,pe,de=[],me=[],ve=[],we=[],ge=[],_e=[],Te=[];ce<he-1;ce++)ge[ce]=ue[ce+1]-ue[ce];for(ve[0]=0,ce=1;ce<he-1;ce++)ve[ce]=3/ge[ce]*(ae[ce+1]-ae[ce])-3/ge[ce-1]*(ae[ce]-ae[ce-1]);for(ce=1;ce<he-1;ce++)de[ce]=[],me[ce]=[],de[ce][ce-1]=ge[ce-1],de[ce][ce]=2*(ge[ce-1]+ge[ce]),de[ce][ce+1]=ge[ce],me[ce][0]=ve[ce];for(we=ee.multiply(ee.inv(de),me),pe=0;pe<he-1;pe++)_e[pe]=(ae[pe+1]-ae[pe])/ge[pe]-ge[pe]*(we[pe+1][0]+2*we[pe][0])/3,Te[pe]=(we[pe+1][0]-we[pe][0])/(3*ge[pe]);for(pe=0;pe<he&&!(ue[pe]>oe);pe++);return pe-=1,ae[pe]+(oe-ue[pe])*_e[pe]+ee.sq(oe-ue[pe])*we[pe]+(oe-ue[pe])*ee.sq(oe-ue[pe])*Te[pe]},gauss_quadrature:function(){throw new Error("gauss_quadrature not yet implemented")},PCA:function(ue){var ae=ue.length,oe=ue[0].length,he=0,ce,pe,de=[],me=[],ve=[],we=[],ge=[],_e=[],Te=[],Ne=[],ye=[],Le=[];for(he=0;he<ae;he++)de[he]=ee.sum(ue[he])/oe;for(he=0;he<oe;he++)for(Te[he]=[],ce=0;ce<ae;ce++)Te[he][ce]=ue[ce][he]-de[ce];for(Te=ee.transpose(Te),he=0;he<ae;he++)for(Ne[he]=[],ce=0;ce<ae;ce++)Ne[he][ce]=ee.dot([Te[he]],[Te[ce]])/(oe-1);for(ve=ee.jacobi(Ne),ye=ve[0],me=ve[1],Le=ee.transpose(ye),he=0;he<me.length;he++)for(ce=he;ce<me.length;ce++)me[he]<me[ce]&&(pe=me[he],me[he]=me[ce],me[ce]=pe,we=Le[he],Le[he]=Le[ce],Le[ce]=we);for(_e=ee.transpose(Te),he=0;he<ae;he++)for(ge[he]=[],ce=0;ce<_e.length;ce++)ge[he][ce]=ee.dot([Le[he]],[_e[ce]]);return[ue,me,Le,ge]}}),function(le){for(var ue=0;ue<le.length;ue++)(function(ae){ee.fn[ae]=function(oe,he){var ce=this;return he?(setTimeout(function(){he.call(ce,ee.fn[ae].call(ce,oe))},15),this):typeof ee[ae](this,oe)=="number"?ee[ae](this,oe):ee(ee[ae](this,oe))}})(le[ue])}("add divide multiply subtract dot pow exp log abs norm angle".split(" "))}(te,Math),function(ee,re){var ne=[].slice,ie=ee.utils.isNumber,se=ee.utils.isArray;ee.extend({zscore:function(){var ae=ne.call(arguments);return ie(ae[1])?(ae[0]-ae[1])/ae[2]:(ae[0]-ee.mean(ae[1]))/ee.stdev(ae[1],ae[2])},ztest:function(){var ae=ne.call(arguments),oe;return se(ae[1])?(oe=ee.zscore(ae[0],ae[1],ae[3]),ae[2]===1?ee.normal.cdf(-re.abs(oe),0,1):ee.normal.cdf(-re.abs(oe),0,1)*2):ae.length>2?(oe=ee.zscore(ae[0],ae[1],ae[2]),ae[3]===1?ee.normal.cdf(-re.abs(oe),0,1):ee.normal.cdf(-re.abs(oe),0,1)*2):(oe=ae[0],ae[1]===1?ee.normal.cdf(-re.abs(oe),0,1):ee.normal.cdf(-re.abs(oe),0,1)*2)}}),ee.extend(ee.fn,{zscore:function(ae,oe){return(ae-this.mean())/this.stdev(oe)},ztest:function(ae,oe,he){var ce=re.abs(this.zscore(ae,he));return oe===1?ee.normal.cdf(-ce,0,1):ee.normal.cdf(-ce,0,1)*2}}),ee.extend({tscore:function(){var ae=ne.call(arguments);return ae.length===4?(ae[0]-ae[1])/(ae[2]/re.sqrt(ae[3])):(ae[0]-ee.mean(ae[1]))/(ee.stdev(ae[1],!0)/re.sqrt(ae[1].length))},ttest:function(){var ae=ne.call(arguments),oe;return ae.length===5?(oe=re.abs(ee.tscore(ae[0],ae[1],ae[2],ae[3])),ae[4]===1?ee.studentt.cdf(-oe,ae[3]-1):ee.studentt.cdf(-oe,ae[3]-1)*2):ie(ae[1])?(oe=re.abs(ae[0]),ae[2]==1?ee.studentt.cdf(-oe,ae[1]-1):ee.studentt.cdf(-oe,ae[1]-1)*2):(oe=re.abs(ee.tscore(ae[0],ae[1])),ae[2]==1?ee.studentt.cdf(-oe,ae[1].length-1):ee.studentt.cdf(-oe,ae[1].length-1)*2)}}),ee.extend(ee.fn,{tscore:function(ae){return(ae-this.mean())/(this.stdev(!0)/re.sqrt(this.cols()))},ttest:function(ae,oe){return oe===1?1-ee.studentt.cdf(re.abs(this.tscore(ae)),this.cols()-1):ee.studentt.cdf(-re.abs(this.tscore(ae)),this.cols()-1)*2}}),ee.extend({anovafscore:function(){var ae=ne.call(arguments),oe,he,ce,pe,de,me,ve,we;if(ae.length===1){for(de=new Array(ae[0].length),ve=0;ve<ae[0].length;ve++)de[ve]=ae[0][ve];ae=de}for(he=new Array,ve=0;ve<ae.length;ve++)he=he.concat(ae[ve]);for(ce=ee.mean(he),oe=0,ve=0;ve<ae.length;ve++)oe=oe+ae[ve].length*re.pow(ee.mean(ae[ve])-ce,2);for(oe/=ae.length-1,me=0,ve=0;ve<ae.length;ve++)for(pe=ee.mean(ae[ve]),we=0;we<ae[ve].length;we++)me+=re.pow(ae[ve][we]-pe,2);return me/=he.length-ae.length,oe/me},anovaftest:function(){var ae=ne.call(arguments),oe,he,ce,pe;if(ie(ae[0]))return 1-ee.centralF.cdf(ae[0],ae[1],ae[2]);var de=ee.anovafscore(ae);for(oe=ae.length-1,ce=0,pe=0;pe<ae.length;pe++)ce=ce+ae[pe].length;return he=ce-oe-1,1-ee.centralF.cdf(de,oe,he)},ftest:function(ae,oe,he){return 1-ee.centralF.cdf(ae,oe,he)}}),ee.extend(ee.fn,{anovafscore:function(){return ee.anovafscore(this.toArray())},anovaftes:function(){var ae=0,oe;for(oe=0;oe<this.length;oe++)ae=ae+this[oe].length;return ee.ftest(this.anovafscore(),this.length-1,ae-this.length)}}),ee.extend({qscore:function(){var ae=ne.call(arguments),oe,he,ce,pe,de;return ie(ae[0])?(oe=ae[0],he=ae[1],ce=ae[2],pe=ae[3],de=ae[4]):(oe=ee.mean(ae[0]),he=ee.mean(ae[1]),ce=ae[0].length,pe=ae[1].length,de=ae[2]),re.abs(oe-he)/(de*re.sqrt((1/ce+1/pe)/2))},qtest:function(){var ae=ne.call(arguments),oe;ae.length===3?(oe=ae[0],ae=ae.slice(1)):ae.length===7?(oe=ee.qscore(ae[0],ae[1],ae[2],ae[3],ae[4]),ae=ae.slice(5)):(oe=ee.qscore(ae[0],ae[1],ae[2]),ae=ae.slice(3));var he=ae[0],ce=ae[1];return 1-ee.tukey.cdf(oe,ce,he-ce)},tukeyhsd:function(ae){for(var oe=ee.pooledstdev(ae),he=ae.map(function(we){return ee.mean(we)}),ce=ae.reduce(function(we,ge){return we+ge.length},0),pe=[],de=0;de<ae.length;++de)for(var me=de+1;me<ae.length;++me){var ve=ee.qtest(he[de],he[me],ae[de].length,ae[me].length,oe,ce,ae.length);pe.push([[de,me],ve])}return pe}}),ee.extend({normalci:function(){var ae=ne.call(arguments),oe=new Array(2),he;return ae.length===4?he=re.abs(ee.normal.inv(ae[1]/2,0,1)*ae[2]/re.sqrt(ae[3])):he=re.abs(ee.normal.inv(ae[1]/2,0,1)*ee.stdev(ae[2])/re.sqrt(ae[2].length)),oe[0]=ae[0]-he,oe[1]=ae[0]+he,oe},tci:function(){var ae=ne.call(arguments),oe=new Array(2),he;return ae.length===4?he=re.abs(ee.studentt.inv(ae[1]/2,ae[3]-1)*ae[2]/re.sqrt(ae[3])):he=re.abs(ee.studentt.inv(ae[1]/2,ae[2].length-1)*ee.stdev(ae[2],!0)/re.sqrt(ae[2].length)),oe[0]=ae[0]-he,oe[1]=ae[0]+he,oe},significant:function(ae,oe){return ae<oe}}),ee.extend(ee.fn,{normalci:function(ae,oe){return ee.normalci(ae,oe,this.toArray())},tci:function(ae,oe){return ee.tci(ae,oe,this.toArray())}});function le(ue,ae,oe,he){if(ue>1||oe>1||ue<=0||oe<=0)throw new Error("Proportions should be greater than 0 and less than 1");var ce=(ue*ae+oe*he)/(ae+he),pe=re.sqrt(ce*(1-ce)*(1/ae+1/he));return(ue-oe)/pe}ee.extend(ee.fn,{oneSidedDifferenceOfProportions:function(ae,oe,he,ce){var pe=le(ae,oe,he,ce);return ee.ztest(pe,1)},twoSidedDifferenceOfProportions:function(ae,oe,he,ce){var pe=le(ae,oe,he,ce);return ee.ztest(pe,2)}})}(te,Math),te.models=function(){function ee(le){var ue=le[0].length,ae=te.arange(ue).map(function(oe){var he=te.arange(ue).filter(function(ce){return ce!==oe});return re(te.col(le,oe).map(function(ce){return ce[0]}),te.col(le,he))});return ae}function re(le,ue){var ae=le.length,oe=ue[0].length-1,he=ae-oe-1,ce=te.lstsq(ue,le),pe=te.multiply(ue,ce.map(function(Te){return[Te]})).map(function(Te){return Te[0]}),de=te.subtract(le,pe),me=te.mean(le),ve=te.sum(pe.map(function(Te){return Math.pow(Te-me,2)})),we=te.sum(le.map(function(Te,Ne){return Math.pow(Te-pe[Ne],2)})),ge=ve+we,_e=ve/ge;return{exog:ue,endog:le,nobs:ae,df_model:oe,df_resid:he,coef:ce,predict:pe,resid:de,ybar:me,SST:ge,SSE:ve,SSR:we,R2:_e}}function ne(le){var ue=ee(le.exog),ae=Math.sqrt(le.SSR/le.df_resid),oe=ue.map(function(me){var ve=me.SST,we=me.R2;return ae/Math.sqrt(ve*(1-we))}),he=le.coef.map(function(me,ve){return(me-0)/oe[ve]}),ce=he.map(function(me){var ve=te.studentt.cdf(me,le.df_resid);return(ve>.5?1-ve:ve)*2}),pe=te.studentt.inv(.975,le.df_resid),de=le.coef.map(function(me,ve){var we=pe*oe[ve];return[me-we,me+we]});return{se:oe,t:he,p:ce,sigmaHat:ae,interval95:de}}function ie(le){var ue=le.R2/le.df_model/((1-le.R2)/le.df_resid),ae=function(he,ce,pe){return te.beta.cdf(he/(pe/ce+he),ce/2,pe/2)},oe=1-ae(ue,le.df_model,le.df_resid);return{F_statistic:ue,pvalue:oe}}function se(le,ue){var ae=re(le,ue),oe=ne(ae),he=ie(ae),ce=1-(1-ae.R2)*((ae.nobs-1)/ae.df_resid);return ae.t=oe,ae.f=he,ae.adjust_R2=ce,ae}return{ols:se}}(),te.extend({buildxmatrix:function(){for(var re=new Array(arguments.length),ne=0;ne<arguments.length;ne++){var ie=[1];re[ne]=ie.concat(arguments[ne])}return te(re)},builddxmatrix:function(){for(var re=new Array(arguments[0].length),ne=0;ne<arguments[0].length;ne++){var ie=[1];re[ne]=ie.concat(arguments[0][ne])}return te(re)},buildjxmatrix:function(re){for(var ne=new Array(re.length),ie=0;ie<re.length;ie++)ne[ie]=re[ie];return te.builddxmatrix(ne)},buildymatrix:function(re){return te(re).transpose()},buildjymatrix:function(re){return re.transpose()},matrixmult:function(re,ne){var ie,se,le,ue,ae;if(re.cols()==ne.rows()){if(ne.rows()>1){for(ue=[],ie=0;ie<re.rows();ie++)for(ue[ie]=[],se=0;se<ne.cols();se++){for(ae=0,le=0;le<re.cols();le++)ae+=re.toArray()[ie][le]*ne.toArray()[le][se];ue[ie][se]=ae}return te(ue)}for(ue=[],ie=0;ie<re.rows();ie++)for(ue[ie]=[],se=0;se<ne.cols();se++){for(ae=0,le=0;le<re.cols();le++)ae+=re.toArray()[ie][le]*ne.toArray()[se];ue[ie][se]=ae}return te(ue)}},regress:function(re,ne){var ie=te.xtranspxinv(re),se=re.transpose(),le=te.matrixmult(te(ie),se);return te.matrixmult(le,ne)},regresst:function(re,ne,ie){var se=te.regress(re,ne),le={};le.anova={};var ue=te.jMatYBar(re,se);le.yBar=ue;var ae=ne.mean();le.anova.residuals=te.residuals(ne,ue),le.anova.ssr=te.ssr(ue,ae),le.anova.msr=le.anova.ssr/(re[0].length-1),le.anova.sse=te.sse(ne,ue),le.anova.mse=le.anova.sse/(ne.length-(re[0].length-1)-1),le.anova.sst=te.sst(ne,ae),le.anova.mst=le.anova.sst/(ne.length-1),le.anova.r2=1-le.anova.sse/le.anova.sst,le.anova.r2<0&&(le.anova.r2=0),le.anova.fratio=le.anova.msr/le.anova.mse,le.anova.pvalue=te.anovaftest(le.anova.fratio,re[0].length-1,ne.length-(re[0].length-1)-1),le.anova.rmse=Math.sqrt(le.anova.mse),le.anova.r2adj=1-le.anova.mse/le.anova.mst,le.anova.r2adj<0&&(le.anova.r2adj=0),le.stats=new Array(re[0].length);for(var oe=te.xtranspxinv(re),he,ce,pe,de=0;de<se.length;de++)he=Math.sqrt(le.anova.mse*Math.abs(oe[de][de])),ce=Math.abs(se[de]/he),pe=te.ttest(ce,ne.length-re[0].length-1,ie),le.stats[de]=[se[de],he,ce,pe];return le.regress=se,le},xtranspx:function(re){return te.matrixmult(re.transpose(),re)},xtranspxinv:function(re){var ne=te.matrixmult(re.transpose(),re),ie=te.inv(ne);return ie},jMatYBar:function(re,ne){var ie=te.matrixmult(re,ne);return new te(ie)},residuals:function(re,ne){return te.matrixsubtract(re,ne)},ssr:function(re,ne){for(var ie=0,se=0;se<re.length;se++)ie+=Math.pow(re[se]-ne,2);return ie},sse:function(re,ne){for(var ie=0,se=0;se<re.length;se++)ie+=Math.pow(re[se]-ne[se],2);return ie},sst:function(re,ne){for(var ie=0,se=0;se<re.length;se++)ie+=Math.pow(re[se]-ne,2);return ie},matrixsubtract:function(re,ne){for(var ie=new Array(re.length),se=0;se<re.length;se++){ie[se]=new Array(re[se].length);for(var le=0;le<re[se].length;le++)ie[se][le]=re[se][le]-ne[se][le]}return te(ie)}}),te.jStat=te,te});class RandList{constructor(ee){this.simulate=ee,this.vals=[]}get(ee){if(ee>this.vals.length-1)for(let re=this.vals.length;re<=ee;re++)this.simulate.random?this.vals.push(this.simulate.random()):this.vals.push(Math.random());return this.vals[ee]}}function getRandPos(te){return Math.floor((te.time().value-te.timeStart.value)/te.timeStep.value)}function Rand(te,ee=null,re=null){if(te.stochastic=!0,ee!=null)return isNormalNumber(ee,"Rand","Minimum"),isNormalNumber(re,"Rand","Maximum"),Rand(te)*(re-ee)+(0+ee);if(te.RKOrder===1)return te.random?te.random():Math.random();let ne=getRandPos(te);for(ne!==te.lastRandPos&&(te.randLoc=-1,te.lastRandPos=ne);te.previousRandLists.length<=ne;)te.previousRandLists.push(new RandList(te));return te.randLoc=te.randLoc+1,te.previousRandLists[ne].get(te.randLoc)}function RandNormal(te,ee=null,re=null){isNormalNumber(ee,"RandNormal","mu"),isNormalNumber(re,"RandNormal","sigma"),ee===null&&(ee=0),re===null&&(re=1);let ne;return ne=Math.sqrt(-2*Math.log(1-Rand(te)))*Math.cos(Rand(te)*2*3.141593),ne*re+(0+ee)}function RandExp(te,ee=null){if(ee===null&&(ee=1),ee<0)throw new ModelError(`Lambda for RandExp must be greater than or equal to 0; got ${ee}.`,{code:4e3});return isNormalNumber(ee,"RandExp","lambda"),-(1/ee)*Math.log(Rand(te))}function RandLognormal(te,ee,re){if(isNormalNumber(ee,"RandLognormal","mu"),isNormalNumber(re,"RandLognormal","sigma"),ee<=0)throw new ModelError(`<i>Mu</i> for RandLognormal() must be greater than 0; got ${ee}.`,{code:4001});if(re<=0)throw new ModelError(`<i>Sigma</i> for RandLognormal() must be greater than 0; got ${re}.`,{code:4002});let ne=Math.log(ee)-.5*Math.log(1+Math.pow(re/ee,2)),ie=Math.sqrt(Math.log(1+Math.pow(re/ee,2)));return Math.exp(RandNormal(te,ne,ie))}function RandBinomial(te,ee,re){if(isNormalNumber(ee,"RandBinomial","count"),isNormalNumber(re,"RandBinomial","probability"),ee<0)throw new ModelError(`<i>Count</i> for RandBinomial() must be greater than or equal to 0; got ${ee}.`,{code:4003});if(re<0||re>1)throw new ModelError(`<i>Probability</i> for RandBinomial() must be between 0 and 1 (inclusive); got ${re}.`,{code:4004});if(ee===0||re===0)return 0;if(re<=.5)return re*ee<=30?randomBinomialInversion(te,ee,re):randomBinomialBtpe(te,ee,re);{let ne=1-re;return ne*ee<=30?ee-randomBinomialInversion(te,ee,ne):ee-randomBinomialBtpe(te,ee,ne)}}function randomBinomialBtpe(te,ee,re){let ne,ie,se,le,ue,ae,oe,he,ce,pe,de,me,ve,we,ge,_e,Te,Ne,ye,Le,xe,Oe,Fe,De,Me,We,Ge,ht,qe,ot,nt,je,Ke,et,tt;for(ne=Math.min(re,1-re),ie=1-ne,se=ee*ne+ne,je=Math.floor(se),le=Math.floor(2.195*Math.sqrt(ee*ne*ie)-4.6*ie)+.5,ue=je+.5,ae=ue-le,oe=ue+le,he=.134+20.5/(15.3+je),we=(se-ae)/(se-ae*ne),ce=we*(1+we/2),we=(oe-se)/(oe*ie),pe=we*(1+we/2),de=le*(1+2*he),me=de+he/ce,ve=me+he/pe;;){if(Oe=ee*ne*ie,ge=Rand(te)*ve,_e=Rand(te),!(ge>le)){Ke=Math.floor(ue-le*_e+ge);break}if(ge>de)if(ge>me){if(Ke=Math.floor(oe-Math.log(_e)/pe),Ke>ee||_e===0)continue;_e=_e*(ge-me)*pe}else{if(Ke=Math.floor(ae+Math.log(_e)/ce),Ke<0||_e===0)continue;_e=_e*(ge-de)*ce}else{if(nt=ae+(ge-le)/he,_e=_e*he+1-Math.abs(je-nt+.5)/le,_e>1)continue;Ke=Math.floor(nt)}if(et=Math.abs(Ke-je),et>20&&et<Oe/2-1){if(ye=et/Oe*((et*(et/3+.625)+.16666666666666666)/Oe+.5),Le=-et*et/(2*Oe),xe=Math.log(_e),xe<Le-ye)break;if(xe>Le+ye||(Fe=Ke+1,Me=je+1,Ge=ee+1-je,qe=ee-Ke+1,De=Fe*Fe,We=Me*Me,ht=Ge*Ge,ot=qe*qe,xe>ue*Math.log(Me/Fe)+(ee-je+.5)*Math.log(Ge/qe)+(Ke-je)*Math.log(qe*ne/(Fe*ie))+(13680-(462-(132-(99-140/We)/We)/We)/We)/Me/166320+(13680-(462-(132-(99-140/ht)/ht)/ht)/ht)/Ge/166320+(13680-(462-(132-(99-140/De)/De)/De)/De)/Fe/166320+(13680-(462-(132-(99-140/ot)/ot)/ot)/ot)/qe/166320))continue}else{if(Te=ne/ie,we=Te*(ee+1),Ne=1,je<Ke)for(tt=je+1;tt<=Ke;tt++)Ne*=we/tt-Te;else if(je>Ke)for(tt=Ke+1;tt<=je;tt++)Ne/=we/tt-Te;if(_e>Ne)continue;break}}return re>.5&&(Ke=ee-Ke),Ke}function randomBinomialInversion(te,ee,re){let ne,ie,se,le,ue,ae,oe;for(ne=1-re,ie=Math.exp(ee*Math.log(ne)),se=ee*re,oe=Math.min(ee,se+10*Math.sqrt(se*ne+1)),ae=0,le=ie,ue=Rand(te);ue>le;)ae++,ae>oe?(ae=0,le=ie,ue=Rand(te)):(ue-=le,le=(ee-ae+1)*re*le/(ae*ne));return ae}function RandNegativeBinomial(te,ee,re){if(isNormalNumber(ee,"RandNegativeBinomial","successes"),isNormalNumber(re,"RandNegativeBinomial","probability"),ee<0)throw new ModelError(`<i>Successes</i> for RandNegativeBinomial() must be greater than or equal to 0; got ${ee}.`,{code:4005});if(re<0||re>1)throw new ModelError(`<i>Probability</i> for RandNegativeBinomial() must be between 0 and 1 (inclusive); got ${re}.`,{code:4006});let ne=0,ie=0;for(;ie<ee;)Rand(te)<=re&&(ie=ie+1),ne=ne+1;return ne}function RandPoisson(te,ee){if(isNormalNumber(ee,"RandPoisson","lambda"),ee<0)throw new ModelError(`<i>Lambda</i> for RandPoisson() must be greater than or equal to 0; got ${ee}.`,{code:4007});if(ee<50){let re=Math.exp(-ee),ne=0,ie=1;for(;ne=ne+1,ie=ie*Rand(te),ie>re;);return ne-1}else{let re=.767-3.36/ee,ne=Math.PI/Math.sqrt(3*ee),ie=ne*ee,se=Math.log(re)-ee-Math.log(ne);for(;;){let le=Rand(te),ue=(ie-Math.log((1-le)/le))/ne,ae=Math.floor(ue+.5);if(ae<0)continue;let oe=Rand(te),he=ie-ne*ue,ce=he+Math.log(oe/Math.pow(1+Math.exp(he),2)),pe=se+ae*Math.log(ee)-jStat.gammaln(ae+1);if(ce<=pe)return ae}}}function RandGamma(te,ee,re){if(isNormalNumber(ee,"RandGamma","alpha"),isNormalNumber(re,"RandGamma","beta"),ee<=0)throw new ModelError(`<i>Alpha</i> (shape parameter) for RandGamma() must be greater than 0; got ${ee}.`,{code:4008});if(re<=0)throw new ModelError(`<i>Beta</i> (rate parameter) for RandGamma() must be greater than 0; got ${re}.`,{code:4009});let ne=1;for(let ie=1;ie<=ee;ie++)ne=ne*Rand(te);return-re*Math.log(ne)}function RandBeta(te,ee,re){if(isNormalNumber(ee,"RandBeta","alpha"),isNormalNumber(re,"RandBeta","beta"),ee<=0)throw new ModelError(`<i>Alpha</i> for RandBeta() must be greater than 0; got ${ee}.`,{code:4010});if(re<=0)throw new ModelError(`<i>Beta</i> for RandBeta() must be greater than 0; got ${re}.`,{code:4011});let ne=RandGamma(te,ee,1),ie=RandGamma(te,re,1);return ne/(ne+ie)}function RandTriangular(te,ee,re,ne){isNormalNumber(ee,"RandTriangular","minimum"),isNormalNumber(re,"RandTriangular","maximum"),isNormalNumber(ne,"RandTriangular","peak");let ie=0+ee,se=0+re,le=0+ne;if(ie===se)throw new ModelError("Maximum can't equal the minimum for the triangular distribution.",{code:4012});if(le<ie||le>se)throw new ModelError("The peak must be within the maximum and minimum for the triangular distribution.",{code:4013});let ue=(le-ie)/(se-ie),ae=Rand(te);return ae<ue?ie+Math.sqrt(ae*(se-ie)*(le-ie)):se-Math.sqrt((1-ae)*(se-ie)*(se-le))}function RandDist(te,ee,re){if(ee.length!==re.length)throw new ModelError("The lengths of the 'x' and 'y' vectors must be the same.",{code:4014});if(ee.length<2)throw new ModelError("There must be at least 2 points in a distribution to generate a random number.",{code:4015});for(let se=0;se<ee.length;se++)if(isNormalNumber(ee[se],"RandDist","x"),isNormalNumber(re[se],"RandDist","y"),re[se]<0)throw new ModelError("The y values of RandDist cannot be negative.",{code:4016});let ne=0;for(let se=0;se<ee.length-1;se++)ne+=(ee[se+1]-ee[se])*(re[se+1]+re[se])/2;if(ne===0)throw new ModelError("The area of the distribution in RandDist cannot be 0.",{code:4017});let ie=ne*Rand(te);ne=0;for(let se=0;se<ee.length-1;se++){let le=(ee[se+1]-ee[se])*(re[se+1]+re[se])/2;if(ie>ne&&ie<ne+le){let ue=ie-ne,ae=(re[se+1]-re[se])/(ee[se+1]-ee[se]),oe;return ae===0?oe=ue/re[se]:oe=(-re[se]+Math.sqrt(Math.pow(re[se],2)+2*ae*ue))/ae,ee[se]+oe}ne+=le}}function isNormalNumber(te,ee,re){if(isNaN(te))throw new ModelError(`The <i>${re}</i> passed to ${ee}() was not a number.`,{code:4018});if(!isFinite(te))throw new ModelError(`The <i>${re}</i> passed to ${ee}() must not be infinite.`,{code:4019});if(te>1e15)throw new ModelError(`The <i>${re}</i> passed to ${ee}() must not be not be greater than 1e15 (got ${te}).`,{code:4020})}function stringify$1(te,ee){if(te instanceof Vector)return te.recurseApply(ne=>stringify$1(ne,ee));let re=new String(te);return re.parent=ee.varBank.stringbase,re}function selectFromMatrix(te,ee,re,ne){let ie=re.length;function se(oe){if(!(oe instanceof Vector)){if(re[0]==="*")throw oe instanceof Material?new ModelError("Can't use * selector on a number.",{code:3e3}):oe instanceof Boolean||typeof oe=="boolean"?new ModelError("Can't use * selector on an boolean.",{code:3001}):oe instanceof String||typeof oe=="string"?new ModelError("Can't use * selector on an string.",{code:3002}):new ModelError("Can't use * selector on an object.",{code:3003});oe.vector?oe=oe.vector:oe.parent&&(oe=new Vector([],ee,[],oe.parent))}return ne===void 0&&oe.fullClone&&(oe=oe.fullClone()),oe}let le=se(te),ue=selectFromVector(le,ee,re.shift(),re.length?void 0:ne,ne!==void 0),ae=[];if(ue.collapsed)ae=[ue.data];else{if(!ue.data.items)throw new ModelError(`No element available for selector ${ie-re.length+1}`,{code:3004});ae=ue.data.items}for(;re.length;){let oe=[],he=re.shift();for(let ce=0;ce<ae.length;ce++){if(!(ae[ce]instanceof Vector))throw new ModelError(`No element available for selector ${ie-re.length}`,{code:3005});let pe=selectFromVector(ae[ce],ee,he,re.length?void 0:ne);pe.collapsed?(ne||(ae[ce].items=[pe.data],ae[ce].names=["!!BREAKOUT DATA"]),oe=oe.concat(pe.data)):(oe=oe.concat(pe.data.items),ne||(ae[ce].items=pe.data.items,ae[ce].names=pe.data.names))}ae=oe}return doBreakouts(ue.data)}function doBreakouts(te){if(!(te instanceof Vector))return te;if(te.items.length===1&&te.names&&te.names[0]==="!!BREAKOUT DATA")return doBreakouts(te.items[0]);for(let ee=0;ee<te.items.length;ee++)te.items[ee]=doBreakouts(te.items[ee]);return te}function selectFromVector(te,ee,re,ne,ie){if(re==="*")return{data:te};if(typeof re=="function")return{data:re([te]),collapsed:!0};if(re==="parent"){if(te.parent)return{data:ie?te.parent:te.parent.fullClone(),collapsed:!0};throw new ModelError("Vector does not have a parent.",{code:3006})}if(re instanceof Vector){let se=[],le=te.names?[]:void 0;for(let ue=0;ue<re.items.length;ue++){let ae=re.items[ue],oe=!0;if(typeof ae=="boolean"&&(ae?ae=new Material(ue+1):oe=!1),oe){let he=selectElementFromVector(te,ae,ne);se.push(he.value),le&&le.push(he.name)}}return{collapsed:!1,parent:te,data:new Vector(se,ee,le,te.parent)}}else return{collapsed:!0,parent:te,data:selectElementFromVector(te,re,ne).value}}function selectElementFromVector(te,ee,re){let ne,ie,se;if(typeof ee=="string"||ee instanceof String)try{if(re===void 0&&!te.names){if(te.parent)return selectElementFromVector(te.parent,ee,re);throw new ModelError(`Key '${ee}' not in vector.`,{code:3007})}if(te.names){se=-1;let le=ee.toLowerCase();for(let ue=0;ue<te.names.length;ue++)if(te.names[ue]&&te.names[ue].toLowerCase()===le){se=ue;break}se<0&&(se=te.names.indexOf("*"))}if(se<0||se===void 0)if(re===void 0){if(te.parent)return selectElementFromVector(te.parent,ee,re);throw new ModelError(`Key '${ee}' not in vector.`,{code:3008})}else se=ee}catch(le){if(te.parent)return selectElementFromVector(te.parent,ee,re);throw le}else se=parseFloat(toNum(ee))-1;if(se instanceof String||typeof se=="string"){if(!te.names){te.names=[];for(let le=0;le<te.items.length;le++)te.names.push(void 0)}te.items.push(re),te.names.push(se.valueOf()),ie=re,ne=se}else{if(se<0||!te.items||se>=te.items.length||se%1!==0)throw new ModelError("Index "+(1+se)+" is not in the vector.",{code:3009});re!==void 0&&(te.items[se]=re),ie=te.items[se],te.names&&(ne=te.names[se])}return{name:ne,value:ie}}function strictEquals(te,ee){if(te instanceof SAgent||ee instanceof SAgent){if(te instanceof SAgent&&ee instanceof SAgent&&te.instanceId===ee.instanceId)return!0}else if(te instanceof Vector||ee instanceof Vector){if(te instanceof Vector&&ee instanceof Vector&&te.equals(ee))return!0}else if(eq(te,ee))return!0;return!1}function keysMatch(te,ee){if(!ee.includes("*")){for(let re=0;re<te.length;re++)if(te[re]!=="*"&&(te[re]===void 0||!ee.includes(te[re])))return!1}if(!te.includes("*")){for(let re=0;re<ee.length;re++)if(ee[re]!=="*"&&(ee[re]===void 0||!te.includes(ee[re])))return!1}return!0}class Vector{constructor(ee,re,ne,ie){if(this.simulate=re,this.parent=ie||re.varBank.vectorbase,this.items=ee,this.names=ne,this.namesLC=void 0,this.isNum=void 0,this.terminateApply=void 0,ne){this.namesLC=[];for(let se of ne)se?this.namesLC.push(se.toLowerCase()):this.namesLC.push(void 0)}}toNum(){if(this.isNum)return this;let ee=this.fullClone();for(let re=0;re<ee.items.length;re++)ee.items[re]=toNum(ee.items[re]);return ee.isNum=!0,ee}toString(){let ee=[];for(let re=0;re<this.items.length;re++)try{let ne=toNum(this.items[re]).toString();this.names&&this.names[re]&&(ne=this.names[re]+": "+ne),ee.push(ne)}catch{ee.push("{Cannot convert value to string}")}return"{"+ee.join(", ")+"}"}length(){return this.items.length}cloneCombine(ee,re,ne,ie){return this.fullClone().combine(ee,re,ne,ie)}combine(ee,re,ne,ie){if(ee instanceof Vector&&this.length()!==ee.length()&&!this.names&&!ee.names)throw new ModelError("Vectors must have equal length when combined.",{code:2001});if(ee instanceof Vector&&this.names&&ee.names){if(!ie&&ee.depth()>this.depth())return ee.combine(this,re,!ne);if(!this.keysMatch(ee.namesLC))if(this.items[0]instanceof Vector){for(let se=0;se<this.items.length;se++)this.items[se].combine(ee,re,ne,!0);return this}else throw new ModelError("Keys do not match for vector operation.",{code:2e3})}for(let se=0;se<this.length();se++){let le;if(ee instanceof Vector)if(this.names&&ee.names){let ue=ee.namesLC.indexOf(this.namesLC[se]);if(this.names.length===1&&this.names[0]==="*"&&(ue=-2),ue===-1&&(ue=ee.names.indexOf("*")),ue===-1)throw new ModelError("Mismatched keys for vector operation.",{code:2002});ue===-2?le=void 0:le=ee.items[ue]}else le=ee.items[se];else le=ee;le!==void 0&&(ne?this.items[se]=re(le,this.items[se]):this.items[se]=re(this.items[se],le))}if(this.names&&this.names.includes("*")&&ee instanceof Vector&&ee.names){let se=this.items[this.names.indexOf("*")];for(let le=0;le<ee.names.length;le++)ee.names[le]&&!this.namesLC.includes(ee.namesLC[le])&&(ne?this.items.push(re(ee.items[le],se)):this.items.push(re(se,ee.items[le])),this.names.push(ee.names[le]),this.namesLC.push(ee.namesLC[le]))}return this}collapseDimensions(ee){if(ee instanceof Vector){if(this.depth()===ee.depth())return this;{let re=[],ne=this,ie=ee;for(let se=0;se<this.depth();se++)ie instanceof Vector?ne.namesLC===void 0&&ie.namesLC===void 0||ne.namesLC!==void 0&&ie.namesLC!==void 0&&keysMatch(ne.namesLC,ie.namesLC)?(re.push("*"),ne=ne.items[0],ie=ie.items[0]):(re.push(le=>this.simulate.varBank.sum(le[0].items)),ne=ne.items[0]):(re.push(le=>this.simulate.varBank.sum(le[0].items)),ne=ne.items[0]);if(ie.items)throw new ModelError("Keys do not match for vector collapsing.",{code:2003});return selectFromMatrix(this,this.simulate,re)}}else return this.simulate.varBank.sum([this.simulate.varBank.flatten([this])])}depth(){if(!this.items.length)return 1;let ee=this.items[0];return ee instanceof Vector?ee.depth()+1:1}keysMatch(ee){return this.names?keysMatch(this.namesLC,ee):!1}cloneApply(ee){return this.fullClone().apply(ee)}apply(ee){for(let re=0;re<this.items.length;re++)this.items[re]=ee(this.items[re],this.names?this.names[re]:void 0);return this}stackApply(ee){return this.depth()===1?ee(this):this.stack().recurseApply(ee)}stack(ee){let re=[];ee=ee||[0];let ne=this.select(ee);for(let ie=1;ie<this.items.length;ie++){ee[0]=ie;let se=this.select(ee);if(ne instanceof Vector&&se instanceof Vector){if(ne.names&&!se.names||se.names&&!ne.names)throw new ModelError("Mismatched keys for vector collapsing.",{code:2004});if(ne.items.length!==se.items.length)throw new ModelError("Vectors of unequal size.",{code:2005})}else if(!(ne instanceof Vector||se instanceof Vector))throw new ModelError("Mismatched keys for vector collapsing.",{code:2006})}ee[0]=0,ee.push(0);for(let ie=0;ie<ne.items.length;ie++)if(ee[ee.length-1]=ne.names?ne.namesLC[ie]:ie,ne.items[ie]instanceof Vector)re.push(this.stack(ee.slice()));else{let se=[];for(let ue=0;ue<this.items.length;ue++){let ae=ee.slice();ae[0]=ue;let oe=this.select(ae);if(oe instanceof Vector)throw new ModelError("Number where vector expected in vector collapsing.",{code:2007});se.push(oe)}let le=new Vector(se,this.simulate);le.terminateApply=!0,re.push(le)}return new Vector(re,this.simulate,ne.names?ne.names.slice():void 0)}select(ee){let re=this;for(let ne=0;ne<ee.length;ne++){if(!(re instanceof Vector))throw new ModelError("Number where vector expected in vector collapsing.",{code:2008});if(ee[ne]instanceof String||typeof ee[ne]=="string"){let ie=re.namesLC.indexOf(ee[ne].valueOf());if(ie===-1)throw new ModelError("Mismatched keys for vector collapsing.",{code:2009});re=re.items[ie]}else re=re.items[ee[ne]]}return re}recurseApply(ee){for(let re=0;re<this.items.length;re++){let ne=this.items[re];ne instanceof Vector&&!ne.terminateApply?this.items[re]=ne.recurseApply(ee):this.items[re]=ee(this.items[re])}return this}fullNames(){let ee=this.items[0];if(ee instanceof Vector&&ee.names){let re=ee.fullNames(),ne=[];for(let ie=0;ie<this.names.length;ie++)for(let se=0;se<re.length;se++)ne.push([this.names[ie]].concat(re[se]));return ne}else return this.names.map(re=>[re])}clone(){let ee=[];for(let re of this.items)re instanceof Vector?ee.push(re.clone()):ee.push(re);return new Vector(ee,this.simulate,this.names?this.names.slice():void 0,this.parent)}fullClone(){let ee=[];for(let re of this.items)re instanceof Vector||re instanceof Material?ee.push(re.fullClone()):ee.push(re);return new Vector(ee,this.simulate,this.names?this.names.slice():void 0,this.parent)}equals(ee){if(this.length()!==ee.length())return!1;for(let re=0;re<this.items.length;re++)if(!strictEquals(this.items[re],ee.items[re]))return!1;return!0}}let DP=20,RM=1,MAX_DP=1e6,MAX_POWER=1e6,NE=-7,PE=21,STRICT=!1,NAME="[big.js] ",INVALID=NAME+"Invalid ",INVALID_DP=INVALID+"decimal places",INVALID_RM=INVALID+"rounding mode",DIV_BY_ZERO=NAME+"Division by zero",P={},UNDEFINED,NUMERIC=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i;function _Big_(){function te(ee){let re=this;if(!(re instanceof te))return ee===UNDEFINED?_Big_():new te(ee);if(ee instanceof te)re.s=ee.s,re.e=ee.e,re.c=ee.c.slice();else{if(typeof ee!="string"){if(te.strict===!0)throw TypeError(INVALID+"number");ee=ee===0&&1/ee<0?"-0":String(ee)}parse(re,ee)}re.constructor=te}return te.prototype=P,te.DP=DP,te.RM=RM,te.NE=NE,te.PE=PE,te.strict=STRICT,te.roundDown=0,te.roundHalfUp=1,te.roundHalfEven=2,te.roundUp=3,te}function parse(te,ee){let re,ne,ie;if(!NUMERIC.test(ee))throw Error(INVALID+"number");for(te.s=ee.charAt(0)=="-"?(ee=ee.slice(1),-1):1,(re=ee.indexOf("."))>-1&&(ee=ee.replace(".","")),(ne=ee.search(/e/i))>0?(re<0&&(re=ne),re+=+ee.slice(ne+1),ee=ee.substring(0,ne)):re<0&&(re=ee.length),ie=ee.length,ne=0;ne<ie&&ee.charAt(ne)=="0";)++ne;if(ne==ie)te.c=[te.e=0];else{for(;ie>0&&ee.charAt(--ie)=="0";);for(te.e=re-ne-1,te.c=[],re=0;ne<=ie;)te.c[re++]=+ee.charAt(ne++)}return te}function round(te,ee,re,ne){let ie=te.c;if(re===UNDEFINED&&(re=te.constructor.RM),re!==0&&re!==1&&re!==2&&re!==3)throw Error(INVALID_RM);if(ee<1)ne=re===3&&(ne||!!ie[0])||ee===0&&(re===1&&ie[0]>=5||re===2&&(ie[0]>5||ie[0]===5&&(ne||ie[1]!==UNDEFINED))),ie.length=1,ne?(te.e=te.e-ee+1,ie[0]=1):ie[0]=te.e=0;else if(ee<ie.length){if(ne=re===1&&ie[ee]>=5||re===2&&(ie[ee]>5||ie[ee]===5&&(ne||ie[ee+1]!==UNDEFINED||ie[ee-1]&1))||re===3&&(ne||!!ie[0]),ie.length=ee--,ne)for(;++ie[ee]>9;)ie[ee]=0,ee--||(++te.e,ie.unshift(1));for(ee=ie.length;!ie[--ee];)ie.pop()}return te}function stringify(te,ee,re){let ne=te.e,ie=te.c.join(""),se=ie.length;if(ee)ie=ie.charAt(0)+(se>1?"."+ie.slice(1):"")+(ne<0?"e":"e+")+ne;else if(ne<0){for(;++ne;)ie="0"+ie;ie="0."+ie}else if(ne>0)if(++ne>se)for(ne-=se;ne--;)ie+="0";else ne<se&&(ie=ie.slice(0,ne)+"."+ie.slice(ne));else se>1&&(ie=ie.charAt(0)+"."+ie.slice(1));return te.s<0&&re?"-"+ie:ie}P.abs=function(){let te=new this.constructor(this);return te.s=1,te};P.cmp=function(te){let ee,re=this,ne=re.c,ie=(te=new re.constructor(te)).c,se=re.s,le=te.s,ue=re.e,ae=te.e;if(!ne[0]||!ie[0])return ne[0]?se:ie[0]?-le:0;if(se!=le)return se;if(ee=se<0,ue!=ae)return ue>ae^ee?1:-1;for(le=(ue=ne.length)<(ae=ie.length)?ue:ae,se=-1;++se<le;)if(ne[se]!=ie[se])return ne[se]>ie[se]^ee?1:-1;return ue==ae?0:ue>ae^ee?1:-1};P.div=function(te){let ee=this,re=ee.constructor,ne=ee.c,ie=(te=new re(te)).c,se=ee.s==te.s?1:-1,le=re.DP;if(le!==~~le||le<0||le>MAX_DP)throw Error(INVALID_DP);if(!ie[0])throw Error(DIV_BY_ZERO);if(!ne[0])return te.s=se,te.c=[te.e=0],te;let ue,ae,oe,he,ce,pe=ie.slice(),de=ue=ie.length,me=ne.length,ve=ne.slice(0,ue),we=ve.length,ge=te,_e=ge.c=[],Te=0,Ne=le+(ge.e=ee.e-te.e)+1;for(ge.s=se,se=Ne<0?0:Ne,pe.unshift(0);we++<ue;)ve.push(0);do{for(oe=0;oe<10;oe++){if(ue!=(we=ve.length))he=ue>we?1:-1;else for(ce=-1,he=0;++ce<ue;)if(ie[ce]!=ve[ce]){he=ie[ce]>ve[ce]?1:-1;break}if(he<0){for(ae=we==ue?ie:pe;we;){if(ve[--we]<ae[we]){for(ce=we;ce&&!ve[--ce];)ve[ce]=9;--ve[ce],ve[we]+=10}ve[we]-=ae[we]}for(;!ve[0];)ve.shift()}else break}_e[Te++]=he?oe:++oe,ve[0]&&he?ve[we]=ne[de]||0:ve=[ne[de]]}while((de++<me||ve[0]!==UNDEFINED)&&se--);return!_e[0]&&Te!=1&&(_e.shift(),ge.e--,Ne--),Te>Ne&&round(ge,Ne,re.RM,ve[0]!==UNDEFINED),ge};P.eq=function(te){return this.cmp(te)===0};P.gt=function(te){return this.cmp(te)>0};P.gte=function(te){return this.cmp(te)>-1};P.lt=function(te){return this.cmp(te)<0};P.lte=function(te){return this.cmp(te)<1};P.minus=P.sub=function(te){let ee,re,ne,ie,se=this,le=se.constructor,ue=se.s,ae=(te=new le(te)).s;if(ue!=ae)return te.s=-ae,se.plus(te);let oe=se.c.slice(),he=se.e,ce=te.c,pe=te.e;if(!oe[0]||!ce[0])return ce[0]?te.s=-ae:oe[0]?te=new le(se):te.s=1,te;if(ue=he-pe){for((ie=ue<0)?(ue=-ue,ne=oe):(pe=he,ne=ce),ne.reverse(),ae=ue;ae--;)ne.push(0);ne.reverse()}else for(re=((ie=oe.length<ce.length)?oe:ce).length,ue=ae=0;ae<re;ae++)if(oe[ae]!=ce[ae]){ie=oe[ae]<ce[ae];break}if(ie&&(ne=oe,oe=ce,ce=ne,te.s=-te.s),(ae=(re=ce.length)-(ee=oe.length))>0)for(;ae--;)oe[ee++]=0;for(ae=ee;re>ue;){if(oe[--re]<ce[re]){for(ee=re;ee&&!oe[--ee];)oe[ee]=9;--oe[ee],oe[re]+=10}oe[re]-=ce[re]}for(;oe[--ae]===0;)oe.pop();for(;oe[0]===0;)oe.shift(),--pe;return oe[0]||(te.s=1,oe=[pe=0]),te.c=oe,te.e=pe,te};P.mod=function(te){let ee,re=this,ne=re.constructor,ie=re.s,se=(te=new ne(te)).s;if(!te.c[0])throw Error(DIV_BY_ZERO);return re.s=te.s=1,ee=te.cmp(re)==1,re.s=ie,te.s=se,ee?new ne(re):(ie=ne.DP,se=ne.RM,ne.DP=ne.RM=0,re=re.div(te),ne.DP=ie,ne.RM=se,this.minus(re.times(te)))};P.plus=P.add=function(te){let ee,re,ne,ie=this,se=ie.constructor;if(te=new se(te),ie.s!=te.s)return te.s=-te.s,ie.minus(te);let le=ie.e,ue=ie.c,ae=te.e,oe=te.c;if(!ue[0]||!oe[0])return oe[0]||(ue[0]?te=new se(ie):te.s=ie.s),te;if(ue=ue.slice(),ee=le-ae){for(ee>0?(ae=le,ne=oe):(ee=-ee,ne=ue),ne.reverse();ee--;)ne.push(0);ne.reverse()}for(ue.length-oe.length<0&&(ne=oe,oe=ue,ue=ne),ee=oe.length,re=0;ee;ue[ee]%=10)re=(ue[--ee]=ue[ee]+oe[ee]+re)/10|0;for(re&&(ue.unshift(re),++ae),ee=ue.length;ue[--ee]===0;)ue.pop();return te.c=ue,te.e=ae,te};P.pow=function(te){let ee=this,re=new ee.constructor("1"),ne=re,ie=te<0;if(te!==~~te||te<-MAX_POWER||te>MAX_POWER)throw Error(INVALID+"exponent");for(ie&&(te=-te);te&1&&(ne=ne.times(ee)),te>>=1,!!te;)ee=ee.times(ee);return ie?re.div(ne):ne};P.prec=function(te,ee){if(te!==~~te||te<1||te>MAX_DP)throw Error(INVALID+"precision");return round(new this.constructor(this),te,ee)};P.round=function(te,ee){if(te===UNDEFINED)te=0;else if(te!==~~te||te<-MAX_DP||te>MAX_DP)throw Error(INVALID_DP);return round(new this.constructor(this),te+this.e+1,ee)};P.sqrt=function(){let te,ee,re,ne=this,ie=ne.constructor,se=ne.s,le=ne.e,ue=new ie("0.5");if(!ne.c[0])return new ie(ne);if(se<0)throw Error(NAME+"No square root");se=Math.sqrt(ne+""),se===0||se===1/0?(ee=ne.c.join(""),ee.length+le&1||(ee+="0"),se=Math.sqrt(ee),le=((le+1)/2|0)-(le<0||le&1),te=new ie((se==1/0?"5e":(se=se.toExponential()).slice(0,se.indexOf("e")+1))+le)):te=new ie(se+""),le=te.e+(ie.DP+=4);do re=te,te=ue.times(re.plus(ne.div(re)));while(re.c.slice(0,le).join("")!==te.c.slice(0,le).join(""));return round(te,(ie.DP-=4)+te.e+1,ie.RM)};P.times=P.mul=function(te){let ee,re=this,ne=re.constructor,ie=re.c,se=(te=new ne(te)).c,le=ie.length,ue=se.length,ae=re.e,oe=te.e;if(te.s=re.s==te.s?1:-1,!ie[0]||!se[0])return te.c=[te.e=0],te;for(te.e=ae+oe,le<ue&&(ee=ie,ie=se,se=ee,oe=le,le=ue,ue=oe),ee=new Array(oe=le+ue);oe--;)ee[oe]=0;for(ae=ue;ae--;){for(ue=0,oe=le+ae;oe>ae;)ue=ee[oe]+se[ae]*ie[oe-ae-1]+ue,ee[oe--]=ue%10,ue=ue/10|0;ee[oe]=ue}for(ue?++te.e:ee.shift(),ae=ee.length;!ee[--ae];)ee.pop();return te.c=ee,te};P.toExponential=function(te,ee){let re=this,ne=re.c[0];if(te!==UNDEFINED){if(te!==~~te||te<0||te>MAX_DP)throw Error(INVALID_DP);for(re=round(new re.constructor(re),++te,ee);re.c.length<te;)re.c.push(0)}return stringify(re,!0,!!ne)};P.toFixed=function(te,ee){let re=this,ne=re.c[0];if(te!==UNDEFINED){if(te!==~~te||te<0||te>MAX_DP)throw Error(INVALID_DP);for(re=round(new re.constructor(re),te+re.e+1,ee),te=te+re.e+1;re.c.length<te;)re.c.push(0)}return stringify(re,!1,!!ne)};P.toJSON=P.toString=function(){let te=this,ee=te.constructor;return stringify(te,te.e<=ee.NE||te.e>=ee.PE,!!te.c[0])};P.toNumber=function(){let te=Number(stringify(this,!0,!0));if(this.constructor.strict===!0&&!this.eq(te.toString()))throw Error(NAME+"Imprecise conversion");return te};P.toPrecision=function(te,ee){let re=this,ne=re.constructor,ie=re.c[0];if(te!==UNDEFINED){if(te!==~~te||te<1||te>MAX_DP)throw Error(INVALID+"precision");for(re=round(new ne(re),te,ee);re.c.length<te;)re.c.push(0)}return stringify(re,te<=re.e||re.e<=ne.NE||re.e>=ne.PE,!!ie)};P.valueOf=function(){let te=this,ee=te.constructor;if(ee.strict===!0)throw Error(NAME+"valueOf disallowed");return stringify(te,te.e<=ee.NE||te.e>=ee.PE,!0)};var Big=_Big_();class SPrimitive{constructor(ee){this.id=null,this.agentId=null,this.index=null,this.instanceId=null,this.container=null,this.constructorFunction=null,this.dna=null,this.DNAs=null,this.equation=null,this.cachedValue=void 0,this.pastValues=[],this.pastData=new DataBank,this.frozen=!1,this.simulate=ee,this.neighborProxyPrimitive=null,this.parent=ee.varBank.primitivebase}orig(){return this.neighborProxyPrimitive||this}clone(){let ee=new this.constructorFunction(this.simulate);return ee.dna=this.dna,ee.container=this.container,ee.agentId=this.agentId,ee.index=this.index,ee.id=this.id,ee.createIds(),ee.pastValues=this.pastValues.slice(),ee.neighborProxyPrimitive=this.neighborProxyPrimitive,this.dna.slider&&(this.simulate.sliders[this.dna.id]?this.simulate.sliders[this.dna.id].push(ee):this.simulate.sliders[this.dna.id]=[ee]),ee.cachedValue=this.cachedValue?this.cachedValue.fullClone():this.cachedValue,this.innerClone(ee),ee}innerClone(ee){}clearCached(){this.cachedValue=void 0}storeValue(){this.cachedValue===void 0&&this.value(),this.pastValues.push(this.cachedValue)}toNum(){let ee=this.value();return typeof ee=="string"?stringify$1(ee,this.simulate):ee}calculateValue(){throw new ModelError(`<i>[${toHTML(this.dna.name)}]</i> does not have a value and can not be used as a value in an equation.`,{code:1080})}createIds(){this.instanceId=this.simulate.getID(this.agentId+"-"+this.index)}getPastValues(ee){let re=this.pastValues.slice(),ne=Math.ceil(div(this.simulate.time(),this.dna.solver.userTimeStep).value)+1;re.length<ne&&re.push(this.value());let ie;if(ee===void 0)ie=re.map(se=>se.fullClone());else{let se=Math.ceil(div(ee.forceUnits(this.simulate.timeUnits),this.dna.solver.userTimeStep).value);ie=[];for(let le=Math.max(0,re.length-1-se);le<re.length;le++)ie.push(re[le].fullClone())}return ie}pastValue(ee,re=null){let ne;if(this.pastValues.length-1<Math.round((this.simulate.time().value-this.simulate.timeStart.value)/this.dna.solver.userTimeStep.value)?ne=div(ee.forceUnits(this.simulate.timeUnits),this.dna.solver.userTimeStep).value:ne=div(ee.forceUnits(this.simulate.timeUnits),this.dna.solver.userTimeStep).value+1,ne===0)return this.value();if(Math.ceil(ne)>this.pastValues.length)return re===null?this.pastValues.length>0?this.pastValues[0].fullClone():this.value():re;if(ne===Math.round(ne))return this.pastValues[this.pastValues.length-ne].fullClone();let ie=ne-Math.floor(ne),se=Math.floor(ne),le,ue;return se===0?le=this.value():le=this.pastValues[this.pastValues.length-se],ue=this.pastValues[this.pastValues.length-1-se],plus(mult(le,new Material(1-ie)),mult(ue,new Material(ie)))}testUnits(ee,re){if(ee instanceof Vector){ee.recurseApply(ne=>(this.testUnits(ne,re),ne));return}if(this.dna.adoptUnits&&(ee.units||(ee.units=this.simulate.unitManager.getUnitStore([],[],!1,!0)),this.dna.units=ee.units,this.dna.flowUnitless=!1),!this.dna.units&&ee.units&&!ee.units.isUnitless())throw new ModelError(`Wrong units generated for <i>[${toHTML(this.dna.name)}]</i>. Expected no units and got <i>${ee.units.toString()}</i>. Either specify units for the primitive or adjust the equation.`,{primitive:this.orig(),showEditor:!0,code:1081});if(this.dna.units!==ee.units){if(typeof ee=="boolean"||typeof ee=="string"||ee instanceof String||ee instanceof Boolean){if(!this.dna.units)return;throw new ModelError(`Cannot add units to a String or Boolean in <i>[${toHTML(this.dna.name)}]</i>.`,{primitive:this.orig(),showEditor:!0,code:1082})}let ne=convertUnits(ee.units,this.dna.units,!0);if(ne===0)throw new ModelError(`Wrong units generated for <i>[${toHTML(this.dna.name)}]</i>. Expected <i>${this.dna.units?this.dna.units.toString():"unitless"}</i>, and got <i>${ee.units?ee.units.toString():"unitless"}</i>.`,{primitive:this.orig(),showEditor:!0,code:1083});ee.value=ee.value*ne,ee.units=this.dna.units}if(this instanceof SFlow&&re!==!0&&this.dna.flowUnitless){let ne=mult(ee,new Material(1,this.simulate.timeUnits));ee.value=ne.value,ee.units=ne.units}}setValue(ee){throw new ModelError("You cannot set the value for that primitive.",{code:1084})}value(){if(this.cachedValue===void 0&&this.frozen&&this.pastValues.length>0){let ee=this.pastValues[this.pastValues.length-1];ee.fullClone?this.cachedValue=ee.fullClone():this.cachedValue=ee}if(this.cachedValue===void 0){if(this.simulate.valuedPrimitives.includes(this))throw new ModelError(`Circular equation loop identified including the primitives: ${toHTML(this.simulate.valuedPrimitives.slice(this.simulate.valuedPrimitives.indexOf(this)).map(re=>re.dna.name).join(", "))}`,{primitive:this.orig(),showEditor:!0,code:1085});this.simulate.valuedPrimitives.push(this);let ee;try{if(ee=toNum(this.calculateValue()),ee instanceof Material&&!isFinite(ee.value))throw this instanceof SStock?new ModelError("The stock has become infinite in size. Check the flows into it for rapid growth.",{primitive:this.orig(),showEditor:!0,code:1086}):new ModelError("The result of this calculation is not finite (are you dividing by 0?).",{primitive:this.orig(),showEditor:!0,code:1087})}catch(re){throw re instanceof ModelError?re.primitive&&re.showEditor?re:new ModelError(re.message,{primitive:this.orig(),showEditor:!0,code:1088}):re}this instanceof SState||(this.testUnits(ee),this.testConstraints(ee)),this.cachedValue=ee}return this.cachedValue.fullClone?this.cachedValue.fullClone():this.cachedValue}testConstraints(ee){let re=ne=>(this.dna.useMaxConstraint&&ne.value>this.dna.maxConstraint&&constraintAlert(this,"max",ne,this.simulate),this.dna.useMinConstraint&&ne.value<this.dna.minConstraint&&constraintAlert(this,"min",ne,this.simulate),ne);ee instanceof Vector?ee.recurseApply(re):re(ee)}setEquation(ee,re){(this instanceof SFlow||this instanceof STransition)&&(this.omega!==null&&(re.omega=this.omega),this.alpha!==null&&(re.alpha=this.alpha));try{this.equation=trimTree(ee,re,this.simulate)}catch(ne){throw ne instanceof ModelError?ne.primitive&&ne.showEditor?ne:new ModelError(ne.message,{primitive:this.orig(),showEditor:!0,code:1089}):ne}}}class Placeholder extends SPrimitive{constructor(ee,re,ne){super(ne),this.dna=ee,this.id=ee.id,this.primitive=re}calculateValue(){throw new ModelError(`<i>[${toHTML(this.dna.name)}]</i> is a placeholder and cannot be used as a direct value in equations.`,{primitive:this.primitive.dna.primitive,showEditor:!0,code:1091})}}class SState extends SPrimitive{constructor(ee){super(ee),this.active=null,this.downStreamTransitions=[],this.constructorFunction=SState}innerClone(ee){ee.setValue(this.active)}setValue(ee){this.setActive(trueValue(ee)),this.cachedValue=void 0,this.simulate.valuedPrimitives=[],this.value(),this.agentId&&this.container.updateStates()}calculateValue(){return this.active===null&&this.setInitialActive(!0),this.active?new Material(1):new Material(0)}setInitialActive(ee){let re;try{re=toNum(evaluateTree(this.equation,globalVars(this,this.simulate),this.simulate))}catch(ne){throw ne instanceof ModelError?ne.primitive&&ne.showEditor?ne:new ModelError(ne.message,{primitive:this.orig(),showEditor:!0,code:1092}):ne}this.setActive(trueValue(re),ee),this.agentId&&this.container.updateStates()}setActive(ee,re){if(this.active=ee,!ee||this.dna.residency===null){if(!re){if(ee){if(this.simulate.transitionPrimitives||(this.simulate.transitionPrimitives=[]),this.simulate.transitionPrimitives.length>1200&&this.simulate.transitionPrimitives.includes(this))throw new ModelError(`Circular fully active transition loop identified including the states: ${toHTML(this.simulate.transitionPrimitives.slice(0,5).map(ne=>"["+ne.dna.name+"]").join(", "))}`,{code:1105});this.simulate.transitionPrimitives.push(this)}for(let ne of this.downStreamTransitions)scheduleTrigger.call(ne);ee&&(this.simulate.transitionPrimitives=[])}}else this.simulate.tasks.add(new Task({name:"State Residency",time:plus(this.simulate.time(),this.dna.residency),priority:5,expires:1,action:ne=>{for(let ie of this.downStreamTransitions)scheduleTrigger.call(ie)}}))}getActive(){return this.active===null&&this.setInitialActive(!0),this.active}}class STransition extends SPrimitive{constructor(ee){super(ee),this.alpha=null,this.omega=null,this.scheduledTrigger=null,this.initialized=!1,this.constructorFunction=STransition}innerClone(){}setEnds(ee,re){this.alpha=ee,this.omega=re,ee&&ee.downStreamTransitions.push(this)}canTrigger(){return!this.alpha||this.alpha&&this.alpha.getActive()||this.dna.repeat&&this.dna.trigger!=="Condition"}trigger(){this.scheduledTrigger=null,!this.frozen&&(this.alpha&&this.alpha.setActive(!1),this.omega&&this.omega.setActive(!0),this.agentId&&this.container.updateStates(),this.dna.repeat&&this.dna.trigger!=="Condition"&&scheduleTrigger.call(this))}}function scheduleTrigger(){updateTrigger.call(this,!0)}function clearTrigger(te){this.scheduledTrigger&&(te||!this.dna.repeat)&&(this.scheduledTrigger.kill(),this.scheduledTrigger=null)}function updateTrigger(te){if(this.initialized=!0,te&&clearTrigger.call(this),this.canTrigger()){let ee;try{ee=toNum(evaluateTree(this.equation,globalVars(this,this.simulate),this.simulate))}catch(re){throw re instanceof ModelError?re.primitive&&re.showEditor?re:new ModelError(re.message,{primitive:this.orig(),showEditor:!1,code:1090}):re}try{if(this.dna.trigger==="Condition")trueValue(ee)&&this.trigger();else{if(!(ee instanceof Material))throw new ModelError(`The value of this trigger must evaluate to a number. Got <i>${toHTML(""+ee)}</i>.`,{primitive:this.orig(),showEditor:!0,code:1112});let re;if(this.dna.trigger==="Timeout"){if(!ee.units)verifyValuedType(ee,this),ee.units=this.simulate.timeUnits;else{ee.units.addBase();let ie=ee.units.baseUnits;if(ie.names.length!==1||ie.names[0]!=="seconds"||ie.exponents[0]!==1)throw new ModelError(`A trigger Timeout must have units of time, got <i>${ee.units.toString()}</i>.`,{primitive:this.orig(),showEditor:!0,code:1113})}if(this.scheduledTrigger&&eq(ee,this.scheduledTrigger.data.value))return;if(ee.value===0){if(this.dna.repeat)throw new ModelError("A trigger Timeout of 0 with 'Repeat' set to true results in an infinite loop.",{primitive:this.orig(),showEditor:!0,code:1114});this.trigger();return}if(ee.value<0)throw new ModelError("The timeout for a transition cannot be less than 0.",{primitive:this.orig(),showEditor:!0,code:1115});if(isNaN(ee.value))throw new ModelError("The timeout for the transition is not a valid number.",{primitive:this.orig(),showEditor:!0,code:1116});re=ee}else if(this.dna.trigger==="Probability"){if(ee.units&&!ee.units.isUnitless())throw new ModelError(`The probability for the trigger had units of <i>${ee.units.toString()}</i>. Probabilities must be unitless.`,{primitive:this.orig(),showEditor:!0,code:1121});if(isNaN(ee.value))throw new ModelError("The probability for the transition is not a valid number.",{primitive:this.orig(),showEditor:!0,code:1117});if(ee=ee.value,this.scheduledTrigger&&eq(ee,this.scheduledTrigger.data.value))return;if(ee===1){if(this.dna.repeat)throw new ModelError("A trigger probability of 1 with 'Repeat' as true results in an infinite loop.",{primitive:this.orig(),showEditor:!0,code:1118});this.trigger();return}else{if(ee>1)throw new ModelError("The probability for the trigger must be less than or equal to 1.",{primitive:this.orig(),showEditor:!0,code:1119});if(ee<0)throw new ModelError("The probability for the trigger must be greater than or equal to 0.",{primitive:this.orig(),showEditor:!0,code:1120});if(ee===0){if(!this.scheduledTrigger)return}else{let ie=-Math.log(1-ee);re=new Material(RandExp(this.simulate,ie),this.simulate.timeUnits)}}}let ne=this.simulate.time();if(this.scheduledTrigger){if(this.scheduledTrigger.kill(),this.dna.trigger==="Timeout")if(lessThanEq(re,minus(this.simulate.time(),this.scheduledTrigger.data.start))){this.scheduledTrigger=null,this.trigger();return}else ne=this.scheduledTrigger.data.start,re=minus(re,minus(this.simulate.time(),ne)),this.scheduledTrigger=null;else if(this.dna.trigger==="Probability"){if(ee===0){this.scheduledTrigger=null;return}re=minus(this.scheduledTrigger.time,this.simulate.time());let ie=this.scheduledTrigger.data.value;if(ie!==ee){let se=-Math.log(1-ie),le=-Math.log(1-ee);re=mult(re,new Material(se/le))}ne=this.scheduledTrigger.data.start,this.scheduledTrigger=null}}re=plus(re,this.simulate.time()),this.scheduledTrigger=new Task({name:"Trigger",time:re,priority:5,expires:1,action:ie=>{this.trigger()},data:{start:ne,value:ee}}),this.simulate.tasks.add(this.scheduledTrigger)}}catch(re){throw re instanceof ModelError?re.primitive&&re.showEditor?re:new ModelError(re.message,{primitive:this.orig(),showEditor:!0,code:1094}):re}}}class SAction extends SPrimitive{constructor(ee){super(ee),this.action=null,this.scheduledTrigger=null,this.block=!1,this.initialized=!1,this.constructorFunction=SAction}innerClone(){}canTrigger(){return!this.block}resetTimer(){scheduleTrigger.call(this)}trigger(){if(this.scheduledTrigger=null,!this.frozen)try{evaluateTree(this.action,globalVars(this,this.simulate),this.simulate),this.dna.repeat?this.dna.trigger!=="Condition"&&scheduleTrigger.call(this):this.block=!0}catch(ee){throw ee instanceof ModelError?ee.primitive&&ee.showEditor?ee:new ModelError(ee.message,{primitive:this.orig(),showEditor:!0,code:1096}):ee}}}class SPopulation extends SPrimitive{constructor(ee){super(ee),this.size=null,this.agents=null,this.geoWidth=null,this.geoHeight=null,this.halfWidth=null,this.halfHeight=null,this.geoDimUnits=null,this.geoDimUnitsObject=null,this.geoWrap=null,this.DNAs=null,this.stateIds=new Set,this.placement=void 0,this.placementFunction=void 0,this.network=void 0,this.networkFunction=void 0,this.agentBase=void 0,this.constructorFunction=SPopulation,this.vector=new Vector([],ee,[],ee.varBank.primitivebase)}collectData(){let ee=[];for(let re of this.agents)ee.push({instanceId:re.instanceId,connected:re.connected.map(ne=>ne.instanceId),location:simpleNum(re.location.clone(),this.geoDimUnitsObject,this.simulate),state:re.states.length>0?re.states.slice():null});return ee}states(){return this.stateIds}toNum(){throw new ModelError(`<i>[${toHTML(this.dna.name)}]</i> is a population of agents and cannot be used as a direct value in equations.`,{code:1107})}add(ee){this.size=1+this.size;let re;if(ee){re=ee.agentClone(),re.agentId=this.agentId,re.setIndex(this.size-1),re.createAgentIds();for(let ne=0;ne<this.DNAs.length;ne++){let ie=re.children[ne],se=this.DNAs[ne];ie.container=re,linkPrimitive(ie,se,this.simulate)}re.updateStates()}else{re=new SAgent(this.simulate),re.container=this,re.children=[],re.childrenId={},re.agentId=this.agentId;for(let ie of this.DNAs)decodeDNA(ie,re,this.simulate);re.setIndex(this.size-1),re.createAgentIds();for(let ie=0;ie<this.DNAs.length;ie++)linkPrimitive(re.children[ie],this.DNAs[ie],this.simulate);setAgentInitialValues(re);let ne=getPrimitiveNeighborhood(this,this.dna,this.simulate,[]);if(this.placement==="Custom Function"?(ne.self=re,re.location=simpleUnitsTest(simpleEquation(this.placementFunction,this.simulate,{"-parent":this.simulate.varBank,self:re},ne),this.geoDimUnitsObject,this.simulate,null,null,"Agent placement functions must return a two element vector"),validateAgentLocation(re.location,this),re.location.names||(re.location.names=["x","y"],re.location.namesLC=["x","y"])):re.location=new Vector([mult(this.geoWidth,new Material(Rand(this.simulate))),mult(this.geoHeight,new Material(Rand(this.simulate)))],this.simulate,["x","y"]),this.network==="Custom Function"){let ie=trimTree(createTree(this.networkFunction),ne,this.simulate);for(let se of this.agents)re!==se&&trueValue(simpleEquation(this.networkFunction,this.simulate,{"-parent":this.simulate.varBank,a:re,b:se},ne,ie))&&re.connect(se)}}return this.simulate.tasks.add(new Task({priority:10,expires:1,name:"Add Agent",time:this.simulate.time(),action:ne=>{this.agents.push(re);for(let ie=0;ie<re.children.length;ie++){let se=re.children[ie],le=this.DNAs[ie];(se instanceof SAction||se instanceof STransition)&&le.trigger!=="Condition"&&scheduleTrigger.call(se),ee&&(se instanceof SAction?le.solver.actions.push(se):se instanceof STransition?le.solver.transitions.push(se):se instanceof SPopulation||(le.solver.valued.push(se),se instanceof SFlow?le.solver.flows.push(se):se instanceof SStock?le.solver.stocks.push(se):se instanceof SState&&le.solver.states.push(se)))}}})),re}}class SAgent{constructor(ee){this.agentId=null,this.instanceId=null,this.index=null,this.children=null,this.location=null,this.connected=[],this.connectedWeights=[],this.dead=!1,this.constructorFunction=SAgent,this.stateIDs=new Set,this.states=[],this.container=void 0,this.dna=void 0,this.childrenId=void 0,this.simulate=ee,this.vector=new Vector([],ee,[],ee.varBank.agentbase)}createIds(){this.instanceId=this.simulate.getID(this.agentId+"-"+this.index)}toString(){return"Agent "+(this.index+1)}toNum(){return this}updateStates(){this.states=[],this.stateIDs=new Set;for(let ee of this.children)ee instanceof SState&&ee.active&&(this.states.push(ee),this.stateIDs.add(ee.dna.id))}agentClone(){let ee=new SAgent(this.simulate);ee.dna=this.dna,ee.children=[],ee.childrenId={};for(let re of this.children)ee.children.push(re.clone()),ee.childrenId[re.dna.id]=re;return ee.location=this.location.clone(),ee.connected=this.connected.slice(),ee.connectedWeights=this.connectedWeights.slice(),ee.container=this.container,ee}setIndex(ee){this.index=ee;for(let re of this.children)re.index=ee}createAgentIds(){this.createIds();for(let ee of this.children)ee.createIds()}die(){for(;this.connected.length>0;)this.unconnect(this.connected[0]);for(let ee=0;ee<this.container.agents.length;ee++)if(this.container.agents[ee]===this){this.container.agents.splice(ee,1);break}for(let ee of this.children){let re=ee.dna.solver;ee instanceof SAction?(re.actions.splice(re.actions.indexOf(ee),1),clearTrigger.call(ee,!0)):ee instanceof STransition?(re.transitions.splice(re.transitions.indexOf(ee),1),clearTrigger.call(ee,!0)):ee instanceof SPopulation||(re.valued.splice(re.valued.indexOf(ee),1),ee instanceof SFlow?re.flows.splice(re.flows.indexOf(ee),1):ee instanceof SStock?re.stocks.splice(re.stocks.indexOf(ee),1):ee instanceof SState&&re.states.splice(re.states.indexOf(ee),1))}this.dead=!0}connect(ee,re){let ne=re===void 0?new Material(1):re;if(ee!==this)if(this.connected.includes(ee))re!==void 0&&(this.connectedWeights[this.connected.indexOf(ee)]=re,ee.connectedWeights[ee.connected.indexOf(ee)]=re);else if(ee instanceof SAgent)this.connected.push(ee),this.connectedWeights.push(ne),ee.connected.push(this),ee.connectedWeights.push(ne);else throw new ModelError("Only agents may be connected.",{code:1106})}unconnect(ee){if(ee!==this){let re=this.connected.indexOf(ee);re!==-1&&(this.connected.splice(re,1),this.connectedWeights.splice(re,1),re=ee.connected.indexOf(this),ee.connected.splice(re,1),ee.connectedWeights.splice(re,1))}}connectionWeight(ee){if(ee!==this){let re=this.connected.indexOf(ee);if(re!==-1)return this.connectedWeights[re].fullClone()}throw new ModelError("Agents are not connected and so do not have a connection weight.",{code:1108})}setConnectionWeight(ee,re){if(ee!==this){let ne=this.connected.indexOf(ee);if(ne!==-1){this.connectedWeights[ne]=re.fullClone();return}}throw new ModelError("Agents are not connected and so do not have a connection weight.",{code:1109})}}function verifyValuedType(te,ee){if(!(te instanceof Vector||te instanceof Material))throw new ModelError(`This value may only be numbers or vectors, found a ${typeof te}.`,{primitive:ee,showEditor:!1,code:1110})}class SStock extends SPrimitive{constructor(ee){super(ee),this.level=null,this.constructorFunction=SStock,this.delay=void 0,this.tasks=[],this.initRate=null,this.oldLevel=null}innerClone(ee){ee.level=this.level,ee.oldLevel=this.oldLevel,ee.tasks=this.tasks,ee.delay=this.delay}setValue(ee){this.level=ee,this.cachedValue=void 0,this.simulate.valuedPrimitives=[],this.value()}preserveLevel(){for(let ee=this.tasks.length-1;ee>=0;ee--)this.tasks[ee].data.tentative=!1;this.oldLevel=this.level}restoreLevel(){for(let ee=this.tasks.length-1;ee>=0;ee--)this.tasks[ee].data.tentative&&(this.tasks[ee].remove(),this.tasks.splice(ee,1));this.level=this.oldLevel}setDelay(ee){var re;ee=ee||this.dna.delay,this.delay=ee,((re=this.delay)==null?void 0:re.value)===0&&(this.delay=void 0)}setInitialValue(){let ee;try{ee=toNum(evaluateTree(this.equation,globalVars(this,this.simulate),this.simulate))}catch(re){throw re instanceof ModelError?re.primitive&&re.showEditor?re:new ModelError(re.message,{primitive:this.orig(),showEditor:!0,code:1098}):re}if(typeof ee=="boolean"&&(ee?ee=new Material(1):ee=new Material(0)),ee instanceof Vector){let re=this.dna;ee.recurseApply(ne=>(verifyValuedType(ne),re.nonNegative&&ne.value<0&&(ne=new Material(0,re.units)),ne.units||(ne.units=re.units),ne))}else verifyValuedType(ee),this.dna.nonNegative&&ee.value<0&&(ee=new Material(0,this.dna.units)),ee.units||(ee.units=this.dna.units);if(this.delay===void 0||lessThanEq(this.delay,this.simulate.timeStep.fullClone()))this.level=ee;else{this.initRate=div(ee,this.delay.forceUnits(this.simulate.timeUnits));let re=mult(this.initRate,this.simulate.userTimeStep.fullClone());this.level=re,this.simulate.tasks.addEvent((ne,ie,se)=>{if(ne.value>0){let le=minus(this.delay,this.simulate.userTimeStep),ue=[minus(ie,this.simulate.timeStart),minus(se,this.simulate.timeStart)];if(lessThan(le,ue[0]))return;let ae=minus(this.simulate.varBank.min([le,ue[1]]),ue[0]);this.level=plus(this.level,mult(ae,this.initRate))}})}}subtract(ee){if(this.level=minus(this.level,ee),this.dna.nonNegative)if(this.level instanceof Vector){let re=this.dna;this.level.recurseApply(ne=>ne.value<0?new Material(0,re.units):ne)}else this.level.value<0&&(this.level=new Material(0,this.dna.units))}add(ee,re){let ne;if(this.delay!==void 0&&(ne=new Material(Big(re.value).plus(this.delay.forceUnits(re.units).value).toNumber(),re.units)),this.delay===void 0||lessThanEq(ne,this.simulate.time())){if(this.level=plus(this.level,ee),this.dna.nonNegative)if(this.level instanceof Vector){let ie=this.dna;this.level.recurseApply(se=>se.value<0?new Material(0,ie.units):se)}else this.level.value<0&&(this.level=new Material(0,this.dna.units))}else this.scheduleAdd(ee,ne)}scheduleAdd(ee,re){let ne,ie=new Task({time:re,data:{amnt:ee,tentative:!0},priority:-100,name:"Conveyor Add ("+this.dna.name+")",action:se=>{if(ne=this.level,this.level=plus(this.level,ee),this.dna.nonNegative)if(this.level instanceof Vector){let le=this.dna;this.level.recurseApply(ue=>ue.value<0?new Material(0,le.units):ue)}else this.level.value<0&&(this.level=new Material(0,this.dna.units))},rollback:()=>{this.level=ne}});this.tasks.push(ie),this.simulate.tasks.add(ie)}totalContents(){if(this.level===null&&this.setInitialValue(),this.delay!==void 0){let ee=this.level,re=this.simulate.time();for(let ie=this.tasks.length-1;ie>=0&&greaterThan(this.tasks[ie].time,re);ie--)ee=plus(ee,this.tasks[ie].data.amnt);let ne=plus(this.simulate.timeProgressed(),this.simulate.userTimeStep);if(greaterThan(this.delay,ne)){let ie=minus(this.delay,ne);ee=plus(ee,mult(this.initRate,ie))}return ee}else return this.level}calculateValue(){if(this.level===null&&this.setInitialValue(),this.delay!==void 0&&this.dna.solver.RKOrder===4){let ee=this.level;for(let re=0;re<this.tasks.length;re++)greaterThan(this.tasks[re].time,this.simulate.time())&&lessThanEq(this.tasks[re].time,plus(this.simulate.time(),this.dna.solver.timeStep))&&(ee=plus(ee,this.tasks[re].data.amnt));return ee}else return this.level}}class SConverter extends SPrimitive{constructor(ee){super(ee),this.source=null,this.constructorFunction=SConverter}innerClone(){}setSource(ee){this.source=ee}getInputValue(){if(this.source==="*time")return this.simulate.time();if(this.source instanceof SPrimitive){let ee=toNum(this.source.value());if(!ee)throw new ModelError("Undefined input value.",{primitive:this.orig(),showEditor:!1,code:1199});if(ee instanceof Vector)throw new ModelError("Converters do not accept vectors as input values.",{primitive:this.orig(),showEditor:!1,code:1200});return ee}else throw console.error("Invalid source",this.source),new Error("Invalid source")}calculateValue(){return new Material(this.getOutputValue().value,this.dna.units)}getOutputValue(){let ee=this.getInputValue();if(!this.dna.inputs.length)return new Material(0);for(let re=0;re<this.dna.inputs.length;re++)if(this.dna.interpolation==="discrete"){if(greaterThan(this.dna.inputs[re],ee))return re===0?this.dna.outputs[0]:this.dna.outputs[re-1]}else if(this.dna.interpolation==="linear"){if(eq(this.dna.inputs[re],ee))return this.dna.outputs[re];if(greaterThan(this.dna.inputs[re],ee))return re===0?this.dna.outputs[0]:div(plus(mult(minus(ee,this.dna.inputs[re-1]),this.dna.outputs[re]),mult(minus(this.dna.inputs[re],ee),this.dna.outputs[re-1])),minus(this.dna.inputs[re],this.dna.inputs[re-1]))}return this.dna.outputs[this.dna.outputs.length-1]}}class SVariable extends SPrimitive{constructor(ee){super(ee),this.constructorFunction=SVariable}innerClone(){}calculateValue(){let ee=evaluateTree(this.equation,globalVars(this,this.simulate),this.simulate);if(typeof ee=="boolean")ee?ee=new Material(1):ee=new Material(0);else{if(ee instanceof Vector)return ee;if(typeof ee=="string")return ee}return ee.units||(ee.units=this.dna.units),ee}}class SFlow extends SPrimitive{constructor(ee){super(ee),this.alpha=null,this.omega=null,this.rate=null,this.blendedRate=null,this.RKPrimary=[],this.constructorFunction=SFlow}innerClone(){}setEnds(ee,re){this.alpha=ee,this.omega=re}calculateValue(){return this.predict(),this.rate.fullClone()}clean(){this.rate=null,this.blendedRate=null,this.RKPrimary=[]}doRK4Aggregation(){this.blendedRate=div(plus(plus(plus(this.RKPrimary[0],mult(new Material(2),this.RKPrimary[1])),mult(new Material(2),this.RKPrimary[2])),this.RKPrimary[3]),new Material(6)),this.blendedRate=this.checkRate(this.blendedRate)}checkRate(ee){let re=div(ee,this.dna.adoptUnits?new Material(this.dna.solver.timeStep.value):this.dna.solver.timeStep.fullClone());return this.dna.nonNegative&&(re instanceof Vector?re.recurseApply(ne=>ne.value>=0?ne:new Material(0,ne.units)):re.value<=0&&(re=new Material(0,re.units))),re}predict(ee){if(this.rate===null||ee){let re;try{if(re=toNum(evaluateTree(this.equation,globalVars(this,this.simulate),this.simulate)),!(re instanceof Vector||isFinite(re.value)))throw verifyValuedType(re,this),new ModelError("The result of this calculation is not finite. Flows must have finite values. Are you dividing by 0?",{primitive:this.orig(),showEditor:!0,code:1111})}catch(ne){throw ne instanceof ModelError?ne.primitive&&ne.showEditor?ne:new ModelError(ne.message,{primitive:this.orig(),showEditor:!0,code:1100}):ne}if(typeof re=="boolean"&&(re?re=new Material(1):re=new Material(0)),this.rate=re.fullClone(),!this.dna.adoptUnits)if(this.rate instanceof Vector){let ne=this.dna;this.rate.recurseApply(ie=>(verifyValuedType(ie,this),ie.units||(ie.units=ne.units),ie))}else this.rate.units||(verifyValuedType(this.rate,this),this.rate.units=this.dna.units);this.testUnits(this.rate,!0),this.rate=mult(this.rate,this.dna.adoptUnits?new Material(this.dna.solver.timeStep.value):this.dna.solver.timeStep.fullClone()),ee?this.RKPrimary.length>0?this.RKPrimary[this.RKPrimary.length-1]=this.rate:this.RKPrimary.push(this.rate):this.RKPrimary.push(this.rate),this.rate=this.checkRate(this.rate)}}apply(ee,re){try{if(this.rate===null&&this.blendedRate===null)return;let ne=this.blendedRate?this.blendedRate.fullClone():this.rate.fullClone();ne=mult(ne,this.dna.adoptUnits?new Material(ee.forceUnits(this.simulate.timeUnits).value):ee);let ie=ne,se=ne,le=!1;if(this.alpha!==null){let ae=this.alpha.level;if(ne instanceof Vector&&(!(ae instanceof Vector)||ae.depth()<ne.depth()))ie=ne.fullClone().collapseDimensions(ae),le=!0;else if(ae instanceof Vector&&(!(ne instanceof Vector)||ae.depth()>ne.depth()))throw new ModelError("The start of the flow is a vector with a higher order than the flow rate. There has to be at least one element in the flow rate for each element in the start.",{primitive:this.orig(),showEditor:!0,code:1201})}if(this.omega!==null){let ae=this.omega.level;if(ne instanceof Vector&&(!(ae instanceof Vector)||ae.depth()<ne.depth()))se=ne.fullClone().collapseDimensions(ae),le=!0;else if(ae instanceof Vector&&(!(ne instanceof Vector)||ae.depth()>ne.depth()))throw new ModelError("The end of the flow is a vector with a higher order than the flow rate. There has to be at least one element in the flow rate for each element in the end.",{primitive:this.orig(),showEditor:!0,code:1202})}if(le){if(this.alpha&&this.alpha.dna.nonNegative)throw new ModelError("Cannot use non-negative stocks when the flow rate is a vector that needs to be collapsed.",{primitive:this.alpha.dna.primitive,showEditor:!1,code:1207});if(this.omega&&this.omega.dna.nonNegative)throw new ModelError("Cannot use non-negative stocks when the flow rate is a vector that needs to be collapsed.",{primitive:this.omega.dna.primitive,showEditor:!1,code:1208})}else{if(this.omega!==null&&this.omega.dna.nonNegative){let ae;try{ae=plus(toNum(this.omega.level),ne)}catch{throw new ModelError(`Incompatible units for flow <i>[${toHTML(this.dna.name)}]</i> and connected stock <i>[${toHTML(this.omega.dna.name)}]</i>. Stock has units of <i>${this.omega.dna.units?this.omega.dna.units.toString():"unitless"}</i>. The flow should have the equivalent units divided by some time unit such as Years.`,{primitive:this.orig(),showEditor:!1,code:1203})}ae instanceof Vector?(ae.recurseApply(oe=>oe.value<0?oe:new Material(0,oe.units)),ne=minus(ne,ae)):ae.value<0&&(ne=negate(toNum(this.omega.level)))}if(this.alpha!==null&&this.alpha.dna.nonNegative){let ae;try{ae=minus(toNum(this.alpha.level),ne)}catch{throw new ModelError(`Incompatible units for flow <i>[${toHTML(this.dna.name)}]</i> and connected stock <i>[${toHTML(this.alpha.dna.name)}]</i>. Stock has units of <i>${this.alpha.dna.units?this.alpha.dna.units.toString():"unitless"}</i>. The flow should have the equivalent units divided by some time unit such as Years.`,{primitive:this.orig(),showEditor:!1,code:1204})}ae instanceof Vector?(ae.recurseApply(oe=>oe.value<0?oe:new Material(0,oe.units)),ne=minus(ne,ae),ne=minus(ne,ae)):ae.value<0&&(ne=toNum(this.alpha.level))}if(this.omega&&this.omega.dna.nonNegative)if(ne instanceof Vector){let ae=this.simulate.varBank.flatten([plus(toNum(this.omega.level),ne)]);for(let oe of ae.items)if(oe instanceof Material&&oe.value<0)throw new ModelError("Inconsistent non-negative constraints for flow.",{primitive:this.orig(),showEditor:!1,code:1205})}else{let ae=plus(toNum(this.omega.level),ne);if(ae instanceof Material&&ae.value<0)throw new ModelError("Inconsistent non-negative constraints for flow.",{primitive:this.orig(),showEditor:!1,code:1206})}}let ue=0;try{this.omega!==null&&(ue=1,le?this.omega.add(se,re):this.omega.add(ne,re)),this.alpha!==null&&(ue=2,le?this.alpha.subtract(ie):this.alpha.subtract(ne))}catch(ae){let oe;throw ue===1?oe=this.omega:ue===2&&(oe=this.alpha),ae.code===2e3?new ModelError(`Incompatible vector keys for flow <i>[${toHTML(this.dna.name)}]</i> and connected stock <i>[${toHTML(oe.dna.name)}]</i>.`,{primitive:this.orig(),showEditor:!1,code:1209}):new ModelError(`Incompatible units for flow <i>[${toHTML(this.dna.name)}]</i> and connected stock <i>[${toHTML(oe.dna.name)}]</i>. Stock has units of <i>${oe.dna.units?oe.dna.units.toString():"unitless"}</i>. The flow should have the equivalent units divided by some time unit such as Years.`,{primitive:this.orig(),showEditor:!1,code:1210})}}catch(ne){throw ne instanceof ModelError?ne.primitive&&ne.showEditor?ne:new ModelError(ne.message,{primitive:this.orig(),showEditor:!0,code:1102}):ne}}}function globalVars(te,ee){return te instanceof SAgent?{"-parent":ee.varBank,self:te}:te.container?{"-parent":ee.varBank,self:te.container}:ee.varBank}function constraintAlert(te,ee,re,ne){let ie="The "+(ee==="max"?"maximum":"minimum")+" constraint on the primitive [<i>"+toHTML(ne.model.getId(te.id).name)+"</i>] has been violated. The primitive's value attempted to become "+toHTML(""+re.value)+" when the "+(ee==="max"?"maximum":"minimum")+" allowed value is "+(ee==="max"?te.dna.maxConstraint:te.dna.minConstraint)+".";throw new ModelError(ie,{primitive:te.dna.primitive,showEditor:!1,code:1150})}function createFunctions$1(te){let ee={},re={};defineFunction(te,"Stop",{params:[]},()=>{throw te.config.showNotification&&te.config.showNotification("Simulation ended early by a call to stop()."),{simulationCommand:"STOP"}}),defineFunction(te,"Pause",{params:[]},()=>(te.sleep(!0),new Material(0))),defineFunction(te,"Time",{params:[]},()=>te.time().fullClone()),defineFunction(te,"TimeStep",{params:[]},()=>te.timeStep.fullClone()),defineFunction(te,"TimeLength",{params:[]},()=>te.timeLength.fullClone()),defineFunction(te,"TimeStart",{params:[]},()=>te.timeStart.fullClone()),defineFunction(te,"TimeEnd",{params:[]},()=>te.timeEnd.fullClone()),defineFunction(te,"Seconds",{params:[{name:"Value",defaultVal:"time",vectorize:!0}]},ie=>{let se;return ie.length?se=toNum(ie[0]):se=te.time().fullClone(),mult(se,new Material(1,te.unitManager.getUnitStore(["seconds"],[-1])))}),defineFunction(te,"Minutes",{params:[{name:"Value",defaultVal:"time",vectorize:!0}]},ie=>{let se;return ie.length?se=toNum(ie[0]):se=te.time().fullClone(),mult(se,new Material(1,te.unitManager.getUnitStore(["minutes"],[-1])))}),defineFunction(te,"Hours",{params:[{name:"Value",defaultVal:"time",vectorize:!0}]},ie=>{let se;return ie.length?se=toNum(ie[0]):se=te.time().fullClone(),mult(se,new Material(1,te.unitManager.getUnitStore(["hours"],[-1])))}),defineFunction(te,"Days",{params:[{name:"Value",defaultVal:"time",vectorize:!0}]},ie=>{let se;return ie.length?se=toNum(ie[0]):se=te.time().fullClone(),mult(se,new Material(1,te.unitManager.getUnitStore(["days"],[-1])))}),defineFunction(te,"Weeks",{params:[{name:"Value",defaultVal:"time",vectorize:!0}]},ie=>{let se;return ie.length?se=toNum(ie[0]):se=te.time().fullClone(),mult(se,new Material(1,te.unitManager.getUnitStore(["weeks"],[-1])))}),defineFunction(te,"Months",{params:[{name:"Value",defaultVal:"time",vectorize:!0}]},ie=>{let se;return ie.length?se=toNum(ie[0]):se=te.time().fullClone(),mult(se,new Material(1,te.unitManager.getUnitStore(["months"],[-1])))}),defineFunction(te,"Years",{params:[{name:"Value",defaultVal:"time",vectorize:!0}]},ie=>{let se;return ie.length?se=toNum(ie[0]):se=te.time().fullClone(),mult(se,new Material(1,te.unitManager.getUnitStore(["years"],[-1])))}),defineFunction(te,"Seasonal",{params:[{name:"Peak",defaultVal:"0",vectorize:!0}]},ie=>{let se;ie.length?(se=toNum(ie[0]).fullClone(),se.units||(se.units=te.timeUnits)):se=new Material(0,te.timeUnits);let ue=minus(te.varBank.time([]),se).forceUnits(createUnitStore("years",te)).value*2*3.14159265359;return new Material(Math.cos(ue))}),defineFunction(te,"Unitless",{params:[{name:"Value",noVector:!0}]},ie=>new Material(toNum(ie[0]).value)),defineFunction(te,"RemoveUnits",{params:[{name:"Value",noVector:!0},{name:"ExpectedUnits",needString:!0}]},ie=>{let se=toNum(ie[0]);return new Material(se.forceUnits(createUnitStore(ie[1],te)).value)}),defineFunction(te,"PastMean",{object:[te.varBank,re],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",vectorize:!0}]},ie=>ie.length===1?te.varBank.mean(ie[0].getPastValues()):te.varBank.mean(ie[0].getPastValues(toNum(ie[1])))),defineFunction(te,"PastMedian",{object:[te.varBank,re],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",vectorize:!0}]},ie=>ie.length===1?te.varBank.median(ie[0].getPastValues()):te.varBank.median(ie[0].getPastValues(toNum(ie[1])))),defineFunction(te,"PastValues",{object:[te.varBank,re],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",vectorize:!0}]},ie=>{let se;return ie.length===1?se=ie[0].getPastValues():se=ie[0].getPastValues(toNum(ie[1])),new Vector(se,te)}),defineFunction(te,"PastStdDev",{object:[te.varBank,re],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",vectorize:!0}]},ie=>{let se;return ie.length===1?se=ie[0].getPastValues():se=ie[0].getPastValues(toNum(ie[1])),se.length>1?te.varBank.stddev(se):new Material(0)}),defineFunction(te,"PastCorrelation",{params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"[Primitive]",noVector:!0,needPrimitive:!0,object:[te.varBank,re]},{name:"Past Range",vectorize:!0,defaultVal:"All Time"}]},ie=>{let se,le;return ie[2]!=="All Time"?(se=ie[0].getPastValues(),le=ie[1].getPastValues()):(se=ie[0].getPastValues(toNum(ie[2])),le=ie[1].getPastValues(toNum(ie[2]))),se.length>1?te.varBank.correlation([new Vector(se,te),new Vector(le,te)]):new Material(0)}),defineFunction(te,"PastMax",{object:[te.varBank,re],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",vectorize:!0}]},ie=>ie.length===1?te.varBank.max(ie[0].getPastValues()):te.varBank.max(ie[0].getPastValues(toNum(ie[1])))),defineFunction(te,"PastMin",{object:[te.varBank,re],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",vectorize:!0}]},ie=>ie.length===1?te.varBank.min(ie[0].getPastValues()):te.varBank.min(ie[0].getPastValues(toNum(ie[1])))),defineFunction(te,"Pulse",{params:[{name:"Start Time",vectorize:!0},{name:"Height",vectorize:!0,defaultVal:1},{name:"Width",vectorize:!0,defaultVal:0},{name:"Repeat Period",vectorize:!0,defaultVal:0}]},ie=>{let se=toNum(ie[0]),le=new Material(1),ue=new Material(0),ae=new Material(0);if(ie.length>1&&(le=toNum(ie[1]),ie.length>2&&(ue=toNum(ie[2]),ie.length>3&&(ae=toNum(ie[3])))),se.units||(se.units=te.timeUnits),ue.units||(ue.units=te.timeUnits),ae.units||(ae.units=te.timeUnits),ae.value<=0){if(eq(te.time(),se)||greaterThanEq(te.time(),se)&&lessThanEq(te.time(),plus(se,ue)))return le}else if(greaterThanEq(te.time(),se)){let oe=minus(te.time(),mult(te.varBank.floor([div(minus(te.time(),se),ae)]),ae)),he=minus(te.time(),se);if(minus(te.varBank.round([div(he,ae)]),div(he,ae)).value===0||greaterThanEq(oe,se)&&lessThanEq(oe,plus(se,ue)))return le}return new Material(0,le.units)}),defineFunction(te,"Ramp",{params:[{name:"Start Time",vectorize:!0},{name:"Finish Time",vectorize:!0},{name:"Height",vectorize:!0,defaultVal:1}]},ie=>{let se=toNum(ie[0]),le=toNum(ie[1]),ue=new Material(1);return ie.length===3&&(ue=toNum(ie[2])),se.units||(se.units=te.timeUnits),le.units||(le.units=te.timeUnits),greaterThanEq(te.time(),se)?div(mult(te.varBank.min([minus(le,se),minus(te.time(),se)]),ue),minus(le,se)):new Material(0,ue.units)}),defineFunction(te,"Step",{params:[{name:"Start Time",vectorize:!0},{name:"Height",vectorize:!0,defaultVal:1}]},ie=>{let se=toNum(ie[0]),le=new Material(1);return ie.length===2&&(le=toNum(ie[1])),se.units||(se.units=te.timeUnits),greaterThanEq(te.time(),se)?le:new Material(0,le.units)}),te.varBank.staircase=te.varBank.step,defineFunction(te,"Delay",{object:[te.varBank,re],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Delay",vectorize:!0},{name:"Initial Value",defaultVal:"None",vectorize:!0}]},ie=>{if(toNum(ie[1]).value<0)throw new ModelError("The delay must be greater than or equal to 0.",{code:1026});return ie.length===2?ie[0].pastValue(toNum(ie[1])):ie[0].pastValue(toNum(ie[1]),toNum(ie[2]))}),defineFunction(te,"Smooth",{object:[te.varBank,re],params:[{name:"Expression",noVector:!0},{name:"Period",vectorize:!0},{name:"Initial Value",vectorize:!0,defaultVal:"None"}]},ie=>{throw new ModelError("Smooth() may only be called in a top level primitive equation",{code:1052})}),defineFunction(te,"Delay1",{object:[te.varBank,re],params:[{name:"Expression",noVector:!0},{name:"Delay",vectorize:!0},{name:"Initial Value",vectorize:!0,defaultVal:"None"}]},ie=>{throw new ModelError("Delay1() may only be called in a top level primitive equation",{code:1053})}),defineFunction(te,"Delay3",{object:[te.varBank,re],params:[{name:"Expression",noVector:!0},{name:"Delay",vectorize:!0},{name:"Initial Value",vectorize:!0,defaultVal:"None"}]},ie=>{throw new ModelError("Delay3() may only be called in a top level primitive equation",{code:1054})}),te.varBank.fix=function(ie,se){testArgumentsSize(ie,"Fix",1,2);let le=-1;ie.length===2&&(le=toNum(evaluateNode(ie[1].node,ie[1].scope,te)));let ue=null;for(let ae=0;ae<te.oldAggregateSeries.length;ae++)if(te.oldAggregateSeries[ae].match(se)){ue=te.oldAggregateSeries[ae];break}return ue===null&&(ue=new AggregateSeries(te,se,le),te.oldAggregateSeries.push(ue)),ue.get(ie[0])},te.varBank.fix.delayEvalParams=!0,te.varBank.populationsize=function(ie){if(testArgumentsSize(ie,"PopulationSize",1,1),ie[0]instanceof SPopulation)return new Material(ie[0].agents.length);throw new ModelError("PopulationSize must be passed an agent population as an argument.",{code:1327})},re.populationsize=te.varBank.populationsize,defineFunction(te,"Remove",{object:[te.varBank,ee],params:[{needAgent:!0,name:"[Agent]"}]},ie=>{if(ie[0].dead)throw new ModelError("Cannot remove an already removed agent.",{code:1328});return te.tasks.add(new Task({time:te.time(),priority:10,expires:1,name:"Remove Agent",action:se=>{ie[0].die()}})),new Material(1)}),defineFunction(te,"Add",{object:[te.varBank,re],params:[{name:"[Agent Population]"},{needAgent:!0,name:"[Base]",defaultVal:"Agent Base"}]},ie=>{for(;!(ie[0]instanceof SPopulation)&&ie[0].container!==null;)ie[0]=ie[0].container;if(!(ie[0]instanceof SPopulation))throw new ModelError("You must pass an agent population as the first argument to Add().",{code:1029});return ie.length===2?ie[0].add(ie[1]):ie[0].add()}),defineFunction(te,"FindAll",{object:[te.varBank,VectorObject,re],params:[{needPopulation:!0,name:"[Agent Population]"}]},ie=>ie[0]),defineFunction(te,"ResetTimer",{object:[te.varBank,re],params:[{needPrimitive:!0,name:"[Action]"}]},ie=>{if(!(ie[0]instanceof SAction))throw new ModelError("ResetTimer requires an Action primitive.",{code:1030});return ie[0].resetTimer(),new Material(0)}),defineFunction(te,"Transition",{object:[te.varBank,re],params:[{needPrimitive:!0,name:"[Transition]"}]},ie=>{if(!(ie[0]instanceof STransition))throw new ModelError("Transition requires an Transition primitive.",{code:1031});return ie[0].trigger(),new Material(0)}),defineFunction(te,"Value",{object:[te.varBank,VectorObject,ee],params:[{name:"[Population]"},{needPrimitive:!0,name:"[Primitive]"}]},ie=>{let se=ie[1].id,le=null;if(ie[0]instanceof SPopulation||ie[0]instanceof SAgent||ie[0]instanceof Vector||!ie[0]||(ie[0]=toNum(ie[0])),ie[0]instanceof SPopulation&&(le=getPopulation(ie[0],te)),ie[0]instanceof Vector&&(le=ie[0]),le!==null){let ue=[],ae=-1;for(let oe of le.items){if(!(oe instanceof SAgent))throw new ModelError('Cannot take "Value()" of vector that does not contain agents.',{code:1172});if(ae!==-1)ue.push(oe.children[ae]);else for(let he=0;he<oe.children.length;he++)if(oe.children[he].id===se){ue.push(oe.children[he]),ae=he;break}}return new Vector(ue,te)}else if(ie[0]instanceof SAgent){for(let ue of ie[0].children)if(ue.id===se)return ue;throw new ModelError('Could not find referenced primitive for "Value()".',{code:1032})}throw new ModelError('Invalid type for the first argument of "Value()".',{code:1033})}),defineFunction(te,"SetValue",{object:[te.varBank,VectorObject,re,ee],params:[{name:"[Population]"},{needPrimitive:!0,name:"[Primitive]"},{name:"Value",noVector:!0,allowBoolean:!0}]},ie=>{let se=ie[1].id,le=null;if(ie[0]instanceof SPopulation&&(le=getPopulation(ie[0],te)),ie[0]instanceof Vector&&(le=ie[0]),le!==null){for(let ue=0;ue<le.length();ue++)for(let ae of le.items[ue].children)ae.id===se&&ae.setValue(ie[2]);return new Material(1)}else if(ie[0]instanceof SAgent){for(let ue of ie[0].children)if(ue.id===se)return ue.setValue(ie[2]),new Material(1);throw new ModelError('Could not find referenced primitive for "SetValue()".',{code:1034})}throw new ModelError('Invalid type for the first argument of "SetValue()".',{code:1035})}),defineFunction(te,"FindIndex",{object:[te.varBank,VectorObject,re],params:[{needPopulation:!0,name:"[Agent Population]"},{name:"Index",noVector:!0,needNum:!0,noUnits:!0}]},ie=>{let se=ie[0];for(let le of se.items)if(le.index+1===ie[1].value)return le;throw new ModelError("Index not found in population.",{code:1036})}),defineFunction(te,"FindState",{object:[te.varBank,VectorObject,re],params:[{needPopulation:!0,name:"[Agent Population]"},{needPrimitive:!0,name:"[State]"}]},ie=>{let se=ie[0];if(!(ie[1]instanceof SState||ie[1].dna.primitive instanceof State))throw new ModelError("FindState() requires a State primitive as its argument.",{code:1037});let le=ie[1].id,ue=[];for(let ae=0;ae<se.items.length;ae++)se.items[ae].stateIDs.has(le)&&ue.push(se.items[ae]);return new Vector(ue,te)}),defineFunction(te,"FindNotState",{object:[te.varBank,VectorObject,re],params:[{needPopulation:!0,name:"[Agent Population]"},{needPrimitive:!0,name:"[State]"}]},ie=>{let se=ie[0];if(!(ie[1]instanceof SState||ie[1].dna.primitive instanceof State))throw new ModelError("FindNotState() requires a State primitive as its argument.",{code:1038});let le=ie[1].id,ue=[];for(let ae of se.items)ae.stateIDs.has(le)||ue.push(ae);return new Vector(ue,te)}),defineFunction(te,"FindNearby",{object:[te.varBank,VectorObject,re],params:[{needPopulation:!0,name:"[Agent Population]"},{name:"Target"},{name:"Distance Limit",needNum:!0,noVector:!0}]},ie=>{let se=ie[0],le=ne(ie[1]),ue;try{ue=agent(ie[1],te)}catch{}let ae=[];for(let oe=0;oe<se.length();oe++){let he=agent(se.items[oe]);he!==ue&&lessThanEq(distance(le,ne(he),te),ie[2])&&ae.push(he)}return new Vector(ae,te)}),defineFunction(te,"FindNearest",{object:[te.varBank,VectorObject,re],params:[{needPopulation:!0,name:"[Agent Population]"},{name:"Target"},{noUnits:!0,noVector:!0,needNum:!0,defaultVal:1,name:"Count"}]},ie=>{let se=ie[0],le=1;if(ie.length===3){if(le=ie[2].value,le<1)throw new ModelError("You must select at least one agent in FindNearest().",{code:1039});if(le!==Math.floor(le))throw new ModelError("Count must be an integer.",{code:1040})}let ue=ne(ie[1]),ae;try{ae=agent(ie[1],te)}catch{}let oe=[];for(let ce of se.items)ce=agent(ce),ce!==ae&&oe.push({distance:distance(ue,ne(ce),te),item:ce});if(oe.length<le)throw new ModelError(`Can't find nearest ${le} agents of a population of size ${oe.length}.`,{code:1041});let he=[oe[0]];for(let ce=1;ce<oe.length;ce++){let pe=!1;for(let de=0;de<he.length;de++)if(lessThan(oe[ce].distance,he[de].distance)){he.splice(de,0,oe[ce]),pe=!0;break}!pe&&he.length<le?he.push(oe[ce]):he.length>le&&(he.length=le)}return he.length===1?he[0].item:new Vector(he.map(ce=>ce.item),te)}),defineFunction(te,"FindFurthest",{object:[te.varBank,VectorObject,re],params:[{needPopulation:!0,name:"[Agent Population]"},{name:"Target"},{noUnits:!0,noVector:!0,needNum:!0,defaultVal:1,name:"Count"}]},ie=>{let se=ie[0],le=1;if(ie.length===3){if(le=ie[2].value,le<1)throw new ModelError("You must select at least one agent in FindFurthest().",{code:1042});if(le!==Math.floor(le))throw new ModelError("Count must be an integer.",{code:1043})}let ue=ne(ie[1]),ae;try{ae=agent(ie[1],te)}catch{}let oe=[];for(let ce of se.items){let pe=agent(ce);pe!==ae&&oe.push({distance:distance(ue,ne(pe),te),item:pe})}if(oe.length<le)throw new ModelError(`Can't find furthest ${le} agents of a population of size ${oe.length}.`,{code:1044});let he=[oe[0]];for(let ce=1;ce<oe.length;ce++){let pe=!1;for(let de=0;de<he.length;de++)if(greaterThan(oe[ce].distance,he[de].distance)){he.splice(de,0,oe[ce]),pe=!0;break}!pe&&he.length<le?he.push(oe[ce]):he.length>le&&(he.length=le)}return he.length===1?he[0].item:new Vector(he.map(ce=>ce.item),te)}),defineFunction(te,"Index",{object:[te.varBank,ee],params:[{noVector:!0,needAgent:!0,name:"[Agent]"}]},ie=>new Material(ie[0].index+1)),defineFunction(te,"Connect",{object:[te.varBank,ee],params:[{needAgent:!0,name:"[Agent 1]"},{name:"[Agent 2]"},{name:"Weight",defaultVal:"missing",needNum:!0}]},ie=>{let se;return ie[2]!=="missing"&&(se=ie[2]),ie[1]instanceof Vector?ie[1].items.forEach(le=>{ie[0].connect(le,se)}):ie[0].connect(ie[1],se),new Material(1)}),defineFunction(te,"Unconnect",{object:[te.varBank,ee],params:[{needAgent:!0,name:"[Agent 1]"},{name:"[Agent 2]"}]},ie=>(ie[1]instanceof Vector?ie[1].items.forEach(se=>{ie[0].unconnect(se)}):ie[0].unconnect(ie[1]),new Material(1))),defineFunction(te,"Connected",{object:[te.varBank,ee],params:[{needAgent:!0,name:"[Agent]"}]},ie=>new Vector(ie[0].connected.slice(),te)),defineFunction(te,"ConnectionWeight",{object:[te.varBank,ee],params:[{needAgent:!0,name:"[Agent 1]"},{name:"[Agent 2]"}]},ie=>ie[1]instanceof Vector?new Vector(ie[1].items.map(se=>ie[0].connectionWeight(se)),te):ie[0].connectionWeight(ie[1])),defineFunction(te,"SetConnectionWeight",{object:[te.varBank,ee],params:[{needAgent:!0,name:"[Agent 1]"},{name:"[Agent 2]"},{name:"Weight",needNum:!0}]},ie=>(ie[1]instanceof Vector?ie[1].items.forEach(se=>{ie[0].setConnectionWeight(se,ie[2])}):ie[0].setConnectionWeight(ie[1],ie[2]),new Material(1))),te.varBank.print=function(ie){function se(le){return le instanceof String&&(le=""+le),le}return ie.length===2?(console.log(se(ie[0].value.toString())),console.log(se(ie[1])),ie[1]):(console.log(se(ie[0])),ie[0])},defineFunction(te,"Width",{params:[{needAgents:!0,name:"[Agent Population]"}]},ie=>ie[0].geoWidth),defineFunction(te,"Height",{params:[{needAgents:!0,name:"[Agent Population]"}]},ie=>ie[0].geoHeight),defineFunction(te,"Distance",{object:[te.varBank,ee],params:[{name:"Location 1"},{name:"Location 2"}]},ie=>{let se=ne(ie[0]),le=ne(ie[1]);return distance(se,le,te)}),defineFunction(te,"Location",{object:[te.varBank,ee],params:[{needAgent:!0,name:"[Agent]"}]},ie=>{if(ie[0].location)return ie[0].location.fullClone();throw new ModelError("The location is not defined.",{code:1046})}),defineFunction(te,"SetLocation",{object:[te.varBank,ee],params:[{needAgent:!0,name:"[Agent]"},{needVector:!0,name:"Direction"}]},ie=>{let se=toNum(ie[1]),le=ie[0];return le.location=se.fullClone(),le.location.names||(le.location.names=["x","y"],le.location.namesLC=["x","y"]),new Material(0)}),defineFunction(te,"Move",{object:[te.varBank,ee],params:[{needAgent:!0,name:"[Mover]"},{needVector:!0,name:"Direction"}]},ie=>{let se=toNum(ie[1]);return shiftLocation(ie[0],plus(ie[0].location,se)),new Material(0)});function ne(ie){const se="Location not initialized yet for agents. Location initialization happens after agent primitive value initialization.";if(ie instanceof Vector){if(ie.items.length!==2||!(ie.items[0]instanceof Material)||!(ie.items[1]instanceof Material))throw new ModelError("Location vector does not contain exactly two numbers.",{code:1047});return{location:ie,agent:null}}else try{let le=agent(ie,te),ue=le.location;if(ue===null)throw new ModelError(se,{code:1048});return{location:ue,agent:le}}catch(le){throw le.message===se?le:new ModelError("Location must be a vector or an agent.",{code:1049})}}defineFunction(te,"MoveTowards",{object:[te.varBank,ee],params:[{needAgent:!0,name:"[Mover]"},{name:"[Target]"},{name:"Distance",noVector:!0,needNum:!0}]},ie=>{let se=ne(ie[0]),le=ne(ie[1]),ue=se.location,ae=le.location,oe=minus(ae.items[0],ue.items[0]),he=minus(ae.items[1],ue.items[1]);if(oe.value===0&&he.value===0)return new Material(1);let ce=se.agent;ce.container.geoWrap&&(greaterThan(oe,ce.container.halfWidth)?oe=minus(oe,ce.container.geoWidth):lessThan(oe,negate(ce.container.halfWidth))&&(oe=plus(oe,ce.container.geoWidth)),greaterThan(he,ce.container.halfHeight)?he=minus(he,ce.container.geoHeight):lessThan(he,negate(ce.container.halfHeight))&&(he=plus(he,ce.container.geoHeight)));let pe=new Vector([oe,he],te,["x","y"]);return shiftLocation(ce,plus(ce.location,mult(pe,div(ie[2],distance(se,le,te))))),new Material(1)}),te.varBank.primitivebase=makeObjectBase(re,te),te.varBank.agentbase=makeObjectBase(ee,te),te.varBank.primitivebase.parent=te.varBank.agentbase,te.varBank.vectorbase=makeObjectBase(VectorObject,te)}const MAX_DISTANCE_CACHES=1e6;function distance(te,ee,re){let ne=te.location,ie=ee.location;re.distanceCacheCount++;let se=te.agent?te.agent.container:ee.agent?ee.agent.container:null,le;if(re.distanceCacheCount<MAX_DISTANCE_CACHES){let de=ne.items[0].toString()+","+ne.items[1].toString(),me=ie.items[0].toString()+","+ie.items[1].toString();if(me<de&&([de,me]=[me,de]),le=de+":"+me,se&&(le+="/"+se.id),le in re.distanceCache)return re.distanceCache[le]}let ue=minus(ne.items[0],ie.items[0]),ae=minus(ne.items[1],ie.items[1]);se&&se.geoWrap&&(greaterThan(ue,se.halfWidth)?ue=minus(se.geoWidth,ue):lessThan(ue,negate(se.halfWidth))&&(ue=minus(ue,negate(se.geoWidth))),greaterThan(ae,se.halfHeight)?ae=minus(se.geoHeight,ae):lessThan(ae,negate(se.halfHeight))&&(ae=minus(ae,negate(se.geoHeight))));let oe=ue.value,he=ae.value;ue.units!==ae.units&&(he=fn["*"](he,convertUnits(ue.units,ae.units)));let ce=fn.sqrt(fn["+"](fn["*"](oe,oe),fn["*"](he,he))),pe=new Material(ce,ue.units);return re.distanceCacheCount<MAX_DISTANCE_CACHES&&(re.distanceCache[le]=pe),pe}function agent(te,ee){if((te instanceof SVariable||te instanceof SStock)&&(te=toNum(te)),te instanceof SAgent)return te;if(te instanceof SPrimitive)return agent(te.container);throw new ModelError("An agent is required here.",{code:1050})}function agents(te){if(te instanceof SPopulation)return te;if(te instanceof SPrimitive||te instanceof SAgent)return agents(te.container);throw new ModelError("An agent population is required here.",{code:1051})}function getPopulation(te,ee){return te.items?te:te instanceof SPopulation?new Vector(te.agents.slice(),ee):toNum(te)instanceof Vector?toNum(te):new Vector([agent(te)],ee)}function shiftLocation(te,ee){if(te.container.geoWrap){for(;lessThan(ee.items[0],new Material(0));)ee.items[0]=plus(ee.items[0],te.container.geoWidth);for(;greaterThan(ee.items[0],te.container.geoWidth);)ee.items[0]=minus(ee.items[0],te.container.geoWidth);for(;lessThan(ee.items[1],new Material(0));)ee.items[1]=plus(ee.items[1],te.container.geoHeight);for(;greaterThan(ee.items[1],te.container.geoHeight);)ee.items[1]=minus(ee.items[1],te.container.geoHeight)}te.location=ee,te.location.names||(te.location.names=["x","y"],te.location.namesLC=["x","y"])}let SeedRandom={};(function(te,ee,re){var ne=256,ie=6,se=52,le="random",ue=re.pow(ne,ie),ae=re.pow(2,se),oe=ae*2,he=ne-1,ce;function pe(Te,Ne,ye){var Le=[];Ne=Ne==!0?{entropy:!0}:Ne||{};var xe=we(ve(Ne.entropy?[Te,_e(ee)]:Te??ge(),3),Le),Oe=new de(Le),Fe=function(){for(var De=Oe.g(ie),Me=ue,We=0;De<ae;)De=(De+We)*ne,Me*=ne,We=Oe.g(1);for(;De>=oe;)De/=2,Me/=2,We>>>=1;return(De+We)/Me};return Fe.int32=function(){return Oe.g(4)|0},Fe.quick=function(){return Oe.g(4)/4294967296},Fe.double=Fe,we(_e(Oe.S),ee),(Ne.pass||ye||function(De,Me,We,Ge){return Ge&&(Ge.S&&me(Ge,Oe),De.state=function(){return me(Oe,{})}),We?(re[le]=De,Me):De})(Fe,xe,"global"in Ne?Ne.global:this==re,Ne.state)}function de(Te){var Ne,ye=Te.length,Le=this,xe=0,Oe=Le.i=Le.j=0,Fe=Le.S=[];for(ye||(Te=[ye++]);xe<ne;)Fe[xe]=xe++;for(xe=0;xe<ne;xe++)Fe[xe]=Fe[Oe=he&Oe+Te[xe%ye]+(Ne=Fe[xe])],Fe[Oe]=Ne;(Le.g=function(De){for(var Me,We=0,Ge=Le.i,ht=Le.j,qe=Le.S;De--;)Me=qe[Ge=he&Ge+1],We=We*ne+qe[he&(qe[Ge]=qe[ht=he&ht+Me])+(qe[ht]=Me)];return Le.i=Ge,Le.j=ht,We})(ne)}function me(Te,Ne){return Ne.i=Te.i,Ne.j=Te.j,Ne.S=Te.S.slice(),Ne}function ve(Te,Ne){var ye=[],Le=typeof Te,xe;if(Ne&&Le=="object")for(xe in Te)try{ye.push(ve(Te[xe],Ne-1))}catch{}return ye.length?ye:Le=="string"?Te:Te+"\0"}function we(Te,Ne){for(var ye=Te+"",Le,xe=0;xe<ye.length;)Ne[he&xe]=he&(Le^=Ne[he&xe]*19)+ye.charCodeAt(xe++);return _e(Ne)}function ge(){try{var Te;return ce&&(Te=ce.randomBytes)||(Te=new Uint8Array(ne),(te.crypto||te.msCrypto).getRandomValues(Te)),_e(Te)}catch{var Ne=te.navigator,ye=Ne&&Ne.plugins;return[+new Date,te,ye,te.screen,_e(ee)]}}function _e(Te){return String.fromCharCode.apply(0,Te)}we(re.random(),ee),SeedRandom.seedrandom=pe})(typeof self<"u"?self:globalThis,[],Math);function createFunctions(te){defineFunction(te,"RandBeta",{params:[{name:"Alpha",noUnits:!0,noVector:!0},{name:"Beta",noUnits:!0,noVector:!0}]},ae=>new Material(RandBeta(te,ae[0].value,ae[1].value))),defineFunction(te,"RandDist",{params:[{name:"Distribution",noUnits:!0,needVector:!0},{name:"Y (in which case Distribution is X)",noUnits:!0,needVector:!0,defaultVal:!1}]},ae=>{let oe,he;if(ae.length===1||ae[1]===!1){let ce=ae[0];oe=[],he=[];for(let pe=0;pe<ce.items.length;pe++){if(!(ce.items[pe]instanceof Vector))throw new ModelError("Invalid vector provided to RandDist.",{code:6e3});oe.push(toNum(ce.items[pe].items[0]).value),he.push(toNum(ce.items[pe].items[1]).value)}}else oe=toNum(ae[0]).items.map(ce=>ce.value),he=toNum(ae[1]).items.map(ce=>ce.value);return new Material(RandDist(te,oe,he))}),defineFunction(te,"RandBoolean",{params:[{name:"Probability",defaultVal:.5,noUnits:!0,noVector:!0}]},ae=>{let oe;return ae.length!==0?oe=toNum(ae[0]).value:oe=.5,Rand(te)<oe}),defineFunction(te,"Rand",{params:[{name:"Lower Bound",defaultVal:0,noUnits:!0,noVector:!0},{name:"Upper Bound",defaultVal:1,noUnits:!0,noVector:!0}]},ae=>{if(ae.length===0)return new Material(Rand(te));if(ae.length===2)return new Material(Rand(te,toNum(ae[0]).value,toNum(ae[1]).value));throw new ModelError("Rand() must either have no parameters or a two: Min and Max bounds.",{code:6001})}),defineFunction(te,"RandNormal",{params:[{name:"Mean",defaultVal:0,noUnits:!0,noVector:!0},{name:"Standard Deviation",defaultVal:1,noUnits:!0,noVector:!0}]},ae=>{if(ae.length===0)return new Material(RandNormal(te));if(ae.length===2)return new Material(RandNormal(te,toNum(ae[0]).value,toNum(ae[1]).value));throw new ModelError("RandNormal() must either have no parameters or a two: Mean and Standard Deviation.",{code:6002})}),defineFunction(te,"RandExp",{params:[{name:"Rate",defaultVal:1,noUnits:!0,noVector:!0}]},ae=>ae.length!==0?new Material(RandExp(te,toNum(ae[0]).value)):new Material(RandExp(te))),defineFunction(te,"RandLognormal",{params:[{name:"Mean",noUnits:!0,noVector:!0},{name:"Standard Deviation",noUnits:!0,noVector:!0}]},ae=>new Material(RandLognormal(te,toNum(ae[0]).value,toNum(ae[1]).value))),defineFunction(te,"RandBinomial",{params:[{name:"Count",noUnits:!0,noVector:!0},{name:"Probability",noUnits:!0,noVector:!0}]},ae=>new Material(RandBinomial(te,toNum(ae[0]).value,toNum(ae[1]).value))),defineFunction(te,"RandNegativeBinomial",{params:[{name:"Successes",noUnits:!0,noVector:!0},{name:"Probability",noUnits:!0,noVector:!0}]},ae=>new Material(RandNegativeBinomial(te,toNum(ae[0]).value,toNum(ae[1]).value))),defineFunction(te,"RandGamma",{params:[{name:"Alpha",noUnits:!0,noVector:!0},{name:"Beta",noUnits:!0,noVector:!0}]},ae=>new Material(RandGamma(te,toNum(ae[0]).value,toNum(ae[1]).value))),defineFunction(te,"RandPoisson",{params:[{name:"Rate",noUnits:!0,noVector:!0}]},ae=>new Material(RandPoisson(te,toNum(ae[0]).value))),defineFunction(te,"RandTriangular",{params:[{name:"Minimum",noUnits:!0,noVector:!0},{name:"Maximum",noUnits:!0,noVector:!0},{name:"Peak",noUnits:!0,noVector:!0}]},ae=>new Material(RandTriangular(te,toNum(ae[0]).value,toNum(ae[1]).value,toNum(ae[2]).value))),defineFunction(te,"Magnitude",{params:[{name:"Number"}]},ae=>{if(toNum(ae[0])instanceof Vector)return te.varBank.sqrt([te.varBank.sum([mult(ae[0],ae[0])])]);let oe=toNum(ae[0]);return oe.value=fn.magnitude(oe.value),oe}),defineFunction(te,"Abs",{params:[{name:"Number"}],recurse:!0,leafNeedNum:!0},ae=>{let oe=toNum(ae[0]);return oe.value=fn.abs(oe.value),oe}),defineFunction(te,"sin",{params:[{name:"Number"}],recurse:!0,leafNeedNum:!0},ae=>{let oe=toNum(ae[0]);if(oe.units&&!oe.units.isUnitless()&&(oe=mult(oe,new Material(1,te.unitManager.getUnitStore(["radians"],[-1])))),oe.units)throw new ModelError("Non-angular units cannot be used in Sin().",{code:6003});return new Material(fn.sin(oe.value))}),defineFunction(te,"cos",{params:[{name:"Number"}],recurse:!0,leafNeedNum:!0},ae=>{let oe=toNum(ae[0]);if(oe.units&&!oe.units.isUnitless()&&(oe=mult(oe,new Material(1,te.unitManager.getUnitStore(["radians"],[-1])))),oe.units)throw new ModelError("Non-angular units cannot be used in Cos().",{code:6004});return new Material(fn.cos(oe.value))}),defineFunction(te,"tan",{params:[{name:"Number"}],recurse:!0,leafNeedNum:!0},ae=>{let oe=toNum(ae[0]);if(oe.units&&!oe.units.isUnitless()&&(oe=mult(oe,new Material(1,te.unitManager.getUnitStore(["radians"],[-1])))),oe.units)throw new ModelError("Non-angular units cannot be used in Tan().",{code:6005});return new Material(fn.tan(oe.value))}),defineFunction(te,"asin",{params:[{name:"Number",noUnits:!0}],recurse:!0,leafNeedNum:!0},ae=>new Material(fn.asin(toNum(ae[0]).value))),defineFunction(te,"acos",{params:[{name:"Number",noUnits:!0}],recurse:!0,leafNeedNum:!0},ae=>new Material(fn.acos(toNum(ae[0]).value))),defineFunction(te,"atan",{params:[{name:"Number",noUnits:!0}],recurse:!0,leafNeedNum:!0},ae=>new Material(fn.atan(toNum(ae[0]).value))),defineFunction(te,"arcsin",{params:[{name:"Number",noUnits:!0}],recurse:!0,leafNeedNum:!0},ae=>new Material(fn.asin(toNum(ae[0]).value),te.unitManager.getUnitStore(["radians"],[1]))),defineFunction(te,"arccos",{params:[{name:"Number",noUnits:!0,leafNeedNum:!0}],recurse:!0},ae=>new Material(fn.acos(toNum(ae[0]).value),te.unitManager.getUnitStore(["radians"],[1]))),defineFunction(te,"arctan",{params:[{name:"Number",noUnits:!0,leafNeedNum:!0}],recurse:!0},ae=>new Material(fn.atan(toNum(ae[0]).value),te.unitManager.getUnitStore(["radians"],[1]))),defineFunction(te,"Sign",{params:[{name:"Number",leafNeedNum:!0}],recurse:!0},ae=>{let oe=toNum(ae[0]);if(oe.value<0)return div(new Material(-1),new Material(1));if(oe.value>0)return div(new Material(1),new Material(1));if(oe.value===0)return new Material(0);throw new ModelError("Invalid value for <i>Sign</i>.",{code:6006})}),defineFunction(te,"Sqrt",{params:[{name:"Number",leafNeedNum:!0}],recurse:!0},ae=>{let oe=toNum(ae[0]).fullClone();if(oe.value<0)throw new ModelError("Sqrt() requires a number greater than or equal to 0.",{code:6007});return oe.value=fn.sqrt(oe.value),oe.units&&!oe.units.isUnitless()&&(oe.units=oe.units.power(.5)),oe}),defineFunction(te,"Ln",{params:[{name:"Number",noUnits:!0,leafNeedNum:!0}],recurse:!0},ae=>{let oe=toNum(ae[0]).value;if(oe<0)throw new ModelError("Ln() requires a number greater than or equal to 0.",{code:6008});return new Material(fn.log(oe))}),defineFunction(te,"Log",{params:[{name:"Number",noUnits:!0,leafNeedNum:!0}],recurse:!0},ae=>{let oe=toNum(ae[0]).value;if(oe<0)throw new ModelError("Log() requires a number greater than or equal to 0.",{code:6009});return new Material(fn.log(oe,10))}),defineFunction(te,"Logit",{params:[{name:"Number",noUnits:!0,leafNeedNum:!0}],recurse:!0},ae=>{let oe=toNum(ae[0]);return oe.value=fn["-"](fn.log(oe.value),fn.log(fn["-"](1,oe.value))),oe}),defineFunction(te,"Expit",{params:[{name:"Number",noUnits:!0,leafNeedNum:!0}],recurse:!0},ae=>{let oe=toNum(ae[0]);return oe.value=fn["/"](1,fn["+"](1,fn.exp(fn["-"](oe.value)))),oe}),defineFunction(te,"Round",{params:[{name:"Number",noUnits:!1,leafNeedNum:!0}],recurse:!0},ae=>{let oe=toNum(ae[0]);return oe.value=fn.round(oe.value),oe}),defineFunction(te,"Ceiling",{params:[{name:"Number",noUnits:!1,leafNeedNum:!0}],recurse:!0},ae=>{let oe=toNum(ae[0]);return oe.value=fn.ceiling(oe.value),oe}),defineFunction(te,"Floor",{params:[{name:"Number",noUnits:!1,leafNeedNum:!0}],recurse:!0},ae=>{let oe=toNum(ae[0]);return oe.value=fn.floor(oe.value),oe}),defineFunction(te,"Exp",{params:[{name:"Number",noUnits:!0,leafNeedNum:!0}],recurse:!0},ae=>new Material(fn.exp(toNum(ae[0]).value))),te.varBank.ifthenelse=function(ae){testArgumentsSize(ae,"IfThenElse",3,3);let oe=toNum(evaluateNode(ae[0].node,ae[0].scope,te));return oe instanceof Vector?ee(oe,evaluateNode(ae[1].node,ae[1].scope,te),evaluateNode(ae[2].node,ae[2].scope,te)):trueValue(oe)?evaluateNode(ae[1].node,ae[1].scope,te):evaluateNode(ae[2].node,ae[2].scope,te)},te.varBank.ifthenelse.delayEvalParams=!0,te.varBank.assert=function(ae){testArgumentsSize(ae,"Assert",1,2);let oe=evaluateNode(ae[0].node,ae[0].scope,te);if(trueValue(oe))return new Material(1);throw new ModelError(ae[1]?evaluateNode(ae[1].node,ae[1].scope,te):"Assert() failed",{code:2e4})},te.varBank.assert.delayEvalParams=!0;function ee(ae,oe,he){let ce=function(me,ve){return me instanceof Vector?me.combine(ve,ce):[me,ve]};oe=toNum(oe),he=toNum(he);let pe;oe instanceof Vector?pe=oe.cloneCombine(he,ce):he instanceof Vector?pe=he.cloneCombine(oe,(me,ve)=>ce(ve,me)):pe=ce(oe,he);let de=function(me,ve){return me instanceof Vector?me.combine(ve,de):trueValue(me)?ve[0]:ve[1]};return ae.cloneCombine(pe,de)}te.varBank.map=function(ae){testArgumentsSize(ae,"Map",2,2);let oe;if(ae[0].node instanceof Vector?oe=ae[0].node:ae[0]instanceof Vector?oe=ae[0]:oe=evaluateNode(ae[0].node,ae[1].scope,te),oe instanceof SPrimitive&&(oe=toNum(oe)),!(oe instanceof Vector))throw new ModelError("Map() requires a vector as its first argument.",{code:6010});oe=oe.fullClone();let he,ce={x:null,"-parent":ae[1].scope},pe=ae[1].node;try{he=evaluateNode(pe,ce,te)}catch{}let de;return he instanceof Function||he instanceof UserFunction?(he.fn&&(he=he.fn),de=function(me){return he([me])}):de=function(me,ve){return ce.x=me,ce.key=ve||"",evaluateNode(pe,ce,te)},oe.apply(de)},te.varBank.map.delayEvalParams=!0,VectorObject.map=te.varBank.map,defineFunction(te,"Sample",{object:[te.varBank,VectorObject],params:[{name:"Vector",needVector:!0},{name:"Sample Size"},{name:"Repeat",noVector:!0,allowBoolean:!0,defaultVal:!1}]},ae=>{let oe=toNum(ae[0]),he=toNum(ae[1]).value;if(he===0)return new Vector([],te);let ce=oe.length(),pe=ae[2]&&trueValue(toNum(ae[2]));if(ce===0)throw new ModelError("Sample() requires a non-empty vector.",{code:6011});let de=[];if(pe)for(let me=0;me<he;me++)de.push(oe.items[Math.floor(Rand(te)*ce)]);else{if(ce<he)throw new ModelError("Vector for Sample() is too small for the given sample size.",{code:6012});let me=oe.items.slice();for(let ve=0;ve<he;ve++)de.push(me.splice(Math.floor(Rand(te)*me.length),1)[0])}return new Vector(de,te)}),defineFunction(te,"IndexOf",{object:[te.varBank,VectorObject],params:[{name:"Haystack",needVector:!0,noUnits:!0},{name:"Needle",allowBoolean:!0,allowString:!0}]},ae=>{let oe=ae[1];if(oe instanceof Vector){let he=[];for(let ce=0;ce<oe.items.length;ce++)he.push(re(oe.items[ce],ae[0]));return new Vector(he,te)}else return re(oe,ae[0])}),defineFunction(te,"Contains",{object:[te.varBank,VectorObject],params:[{name:"Haystack",needVector:!0,noUnits:!0},{name:"Needle",allowBoolean:!0,noVector:!0,allowString:!0}]},ae=>!eq(new Material(0),te.varBank.indexof(ae))),defineFunction(te,"Collapse",{params:[{name:"Source",needVector:!0,noUnits:!1},{name:"Target",noVector:!1}]},ae=>toNum(ae[0]).collapseDimensions(toNum(ae[1])));function re(ae,oe){for(let he=0;he<oe.length();he++)if(eq(ae,oe.items[he]))return new Material(he+1);return new Material(0)}te.varBank.filter=function(ae){testArgumentsSize(ae,"Filter",2,2);let oe;if(ae[0].node instanceof Vector?oe=ae[0].node:ae[0]instanceof Vector?oe=ae[0]:oe=evaluateNode(ae[0].node,ae[0].scope,te),oe instanceof SPrimitive&&(oe=toNum(oe)),!(oe instanceof Vector))throw new ModelError("Filter() requires a vector as its first argument.",{code:6013});oe=oe.fullClone();let he=te.varBank.map(ae);return te.varBank.select([oe,he])},te.varBank.filter.delayEvalParams=!0,VectorObject.filter=te.varBank.filter,te.varBank.join=function(ae){let oe=[],he=[],ce=!1;for(let pe=0;pe<ae.length;pe++){let de=ae[pe];if(de instanceof SPrimitive&&(de=toNum(de)),de instanceof Vector)if(oe=oe.concat(de.items),de.names)he=he.concat(de.names),ce=!0;else for(let me=0;me<de.items.length;me++)he.push(void 0);else oe.push(de),he.push(void 0)}return new Vector(oe,te,ce?he:void 0)},te.varBank.repeat=function(ae){testArgumentsSize(ae,"Repeat",2,2);let oe=toNum(evaluateNode(ae[1].node,ae[1].scope,te)),he=oe;if(oe instanceof Vector){if(oe.names&&oe.names.length)throw new ModelError(`If a repeat count is a vector, it can't have names. Got, <i>${oe}</i>.`,{code:6070});let de=oe.items;if(de.find(me=>!(typeof me=="string"||me instanceof String)))throw new ModelError(`If a repeat count is a vector, it must consist of all strings. Got, <i>${oe}</i>.`,{code:6071});if(new Set(de).size!==de.length)throw new ModelError(`If a repeat count is a vector, it must contain unique strings. Got, <i>${oe}</i>.`,{code:6072});he=oe.items.length}else if(oe instanceof Material){if(oe.units&&!oe.units.isUnitless())throw new ModelError(`Repeat count must be unitless. Got, <i>${oe}</i>.`,{code:6073})}else throw new ModelError(`Repeat count must be a Number or Vector. Got, <i>${oe}</i>.`,{code:6074});let ce=[],pe={x:null,"-parent":ae[1].scope,key:null};for(let de=0;de<he;de++)oe instanceof Vector&&(pe.key=oe.items[de]),pe.x=new Material(de+1),ce.push(evaluateNode(ae[0].node,pe,te));return new Vector(ce,te,oe instanceof Vector?oe.items.slice():void 0)},te.varBank.repeat.delayEvalParams=!0,defineFunction(te,"Select",{params:[{name:"Haystack",needVector:!0,noUnits:!0},{name:"Indexes",noUnits:!0}]},ae=>{if(ae[1]instanceof Vector){let oe=toNum(ae[1]),he=!0;for(let ce=0;ce<oe.length();ce++)if(oe.items[ce]instanceof Material){he=!1;break}if(he===!0){let ce=[],pe=ae[0].names?[]:void 0;if(oe.length()!==ae[0].length())throw new ModelError("Length of vector must be equal for boolean selection.",{code:6014});for(let de=0;de<oe.length();de++)trueValue(oe.items[de])&&(ce.push(ae[0].items[de]),ae[0].names&&pe.push(ae[0].names[de]));return new Vector(ce,te,pe)}else{let ce=[],pe=ae[0].names?[]:void 0;for(let de=0;de<oe.length();de++){let me=oe.items[de].value;if(me<=0||me>ae[0].length())throw new ModelError("Selected element out of range.",{code:6015});ce.push(ae[0].items[me-1]),ae[0].names&&pe.push(ae[0].names[me-1])}return new Vector(ce,te,pe)}}else{if(ae[1].value>0&&ae[1].value<=ae[0].length())return ae[0].items[ae[1].value-1];throw new ModelError("Selected element out of range.",{code:6016})}}),defineFunction(te,"Reverse",{allowEmpty:!0,params:{name:"Items..."},prep:function(ae){return te.varBank.join(ae)}},ae=>new Vector(ae.items.slice().reverse(),te,ae.names?ae.names.slice().reverse():void 0)),defineFunction(te,"Reverse",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},ae=>te.varBank.reverse(ae)),defineFunction(te,"Sort",{allowEmpty:!0,params:{name:"Items..."},prep:function(ae){return toNum(te.varBank.join(ae))}},ae=>ae.stackApply(he=>{let ce=[];for(let me=0;me<he.items.length;me++)ce.push({item:he.items[me],name:he.names?he.names[me]:void 0});let pe=ce.sort((me,ve)=>lessThan(me.item,ve.item)?-1:greaterThan(me.item,ve.item)?1:0),de=he.names?[]:void 0;ce=[];for(let me=0;me<pe.length;me++)ce.push(pe[me].item),de&&de.push(pe[me].name);return new Vector(ce,te,de)})),defineFunction(te,"Sort",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},ae=>te.varBank.sort(ae)),defineFunction(te,"Unique",{allowEmpty:!0,params:{name:"Items....",allowBoolean:!0},prep:function(ae){return toNum(te.varBank.join(ae))}},ae=>{if(!ae.items.length)return new Vector([],te);let oe=[],he=ae.names?[]:void 0;for(let ce=0;ce<ae.items.length;ce++){let pe=!1;for(let de=0;de<oe.length;de++)if(strictEquals(ae.items[ce],oe[de])){pe=!0;break}pe||(oe.push(ae.items[ce]),he&&he.push(ae.names[ce]))}return new Vector(oe,te,he)}),defineFunction(te,"Unique",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},ae=>te.varBank.unique(ae)),defineFunction(te,"Union",{object:[te.varBank,VectorObject],params:[{name:"Vector 1",needVector:!0},{name:"Vector 2",needVector:!0}]},ae=>te.varBank.unique(te.varBank.join(ae).items)),defineFunction(te,"Intersection",{object:[te.varBank,VectorObject],params:[{name:"Vector 1",needVector:!0},{name:"Vector 2",needVector:!0}]},ae=>{let oe=ae[0],he=ae[1],ce=[];for(let pe=0;pe<oe.items.length;pe++)for(let de=0;de<he.items.length;de++)if(strictEquals(oe.items[pe],he.items[de])){ce.push(oe.items[pe]);break}return te.varBank.unique(ce)}),defineFunction(te,"Difference",{object:[te.varBank,VectorObject],params:[{name:"Vector 1",needVector:!0},{name:"Vector 2",needVector:!0}]},ae=>{let oe=ae[0],he=ae[1],ce=[];for(let pe=0;pe<oe.items.length;pe++){let de=!1;for(let me=0;me<he.items.length;me++)if(strictEquals(oe.items[pe],he.items[me])){de=!0;break}de||ce.push(oe.items[pe])}for(let pe=0;pe<he.items.length;pe++){let de=!1;for(let me=0;me<oe.items.length;me++)if(strictEquals(he.items[pe],oe.items[me])){de=!0;break}de||ce.push(he.items[pe])}return te.varBank.unique(ce)}),defineFunction(te,"Factorial",{params:[{name:"Number",noUnits:!0,leafNeedNum:!0}],recurse:!0},ae=>new Material(factorial(toNum(ae[0]).value))),defineFunction(te,"Max",{params:{name:"Items..."},prep:ne},ae=>ae.stackApply(he=>{let ce=he.items;if(ce.length>0){let pe=ce[0];for(let de=1;de<ce.length;de++)greaterThan(ce[de],pe)&&(pe=ce[de]);return pe}else throw new ModelError("You must have at least one element to calculate a max.",{code:6017})})),defineFunction(te,"Max",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},ae=>te.varBank.max(ae));function ne(ae,oe,he){if(!oe)for(let ce=0;ce<ae.length;ce++)ae[ce]=toNum(ae[ce]);return ae.length===1&&ae[0]instanceof Vector?he?ae[0]:te.varBank.flatten([ae[0]]):new Vector(se(ae),te)}function ie(ae){for(let oe=0;oe<ae.length;oe++)ae[oe].toNum&&(ae[oe]=toNum(ae[oe]));return ae.length===1&&ae[0]instanceof Vector?te.varBank.flatten([toNum(ae[0])]).items:ne(ae,void 0,!0).items}function se(ae){let oe=!1,he;for(let ce=0;ce<ae.length;ce++)if(ae[ce]instanceof Vector){he=ae[ce],oe=!0;break}if(oe)for(let ce=0;ce<ae.length;ce++)ae[ce]instanceof Vector||(ae[ce]=le(he,ae[ce]));return ae}function le(ae,oe){let he=ae.fullClone();for(let ce=0;ce<he.items.length;ce++)he.items[ce]instanceof Vector?he.items[ce]=le(he.items[ce],oe):he.items[ce]=oe;return he}defineFunction(te,"Lookup",{params:[{name:"Value",noVector:!0},{name:"Value Vector",needVector:!0},{name:"Results Vector",needVector:!0}]},ae=>{let oe=toNum(ae[0]),he=toNum(ae[1]),ce=toNum(ae[2]);if(he.items.length!==ce.items.length)throw new ModelError("The <i>value</i> and <i>results</i> vectors must be the same length",{code:6018});if(he.items.length<1)throw new ModelError("You must have at least one element in your vectors",{code:6019});let pe=[];for(let de=0;de<he.items.length;de++)pe.push({x:he.items[de],y:ce.items[de]});pe.sort((de,me)=>greaterThan(de.x,me.x)?1:lessThan(de.x,me.x)?-1:0);for(let de=0;de<pe.length;de++){if(eq(pe[de].x,oe))return pe[de].y.fullClone();if(greaterThan(pe[de].x,oe)){if(de===0)return pe[de].y.fullClone();let me=minus(pe[de].x,pe[de-1].x),ve=minus(oe,pe[de-1].x),we=minus(pe[de].x,oe),ge=div(we,me),_e=div(ve,me);return plus(mult(pe[de-1].y,ge),mult(pe[de].y,_e))}}return pe[pe.length-1].y.fullClone()}),defineFunction(te,"Fill",{object:[te.varBank,VectorObject],params:[{name:"Vector",needVector:!0},{name:"Value",allowBoolean:!0}]},ae=>le(ae[0],ae[1])),defineFunction(te,"Min",{params:{name:"Items..."},prep:ne},ae=>ae.stackApply(he=>{let ce=he.items;if(ce.length>0){let pe=ce[0];for(let de=1;de<ce.length;de++)lessThan(ce[de],pe)&&(pe=ce[de]);return pe}else throw new ModelError("You must have at least one element to calculate a min.",{code:6020})})),defineFunction(te,"Min",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},ae=>te.varBank.min(ae)),defineFunction(te,"Mean",{params:{name:"Items..."},prep:ie},ae=>{let oe=ae[0];for(let he=1;he<ae.length;he++)oe=plus(oe,ae[he]);return div(oe,new Material(ae.length))}),defineFunction(te,"Mean",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},ae=>te.varBank.mean(ae)),defineFunction(te,"Sum",{params:{name:"Items..."},prep:ie},ae=>{let oe=ae[0];for(let he=1;he<ae.length;he++)oe=plus(oe,ae[he]);return oe}),defineFunction(te,"Sum",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},ae=>te.varBank.sum(ae)),defineFunction(te,"Product",{params:{name:"Items..."},prep:ie},ae=>{let oe=ae[0];for(let he=1;he<ae.length;he++)oe=mult(oe,ae[he]);return oe}),defineFunction(te,"Product",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},ae=>te.varBank.product(ae)),defineFunction(te,"Median",{params:{name:"Items..."},prep:ne},ae=>ae.stackApply(he=>{let ce=te.varBank.sort([he]).items;if(ce.length>0)return Math.floor((ce.length-1)/2)===(ce.length-1)/2?ce[(ce.length-1)/2]:div(plus(ce[Math.floor((ce.length-1)/2)],ce[Math.ceil((ce.length-1)/2)]),new Material(2));throw new ModelError("You must have at least one element to calculate a median.",{code:6021})})),defineFunction(te,"Median",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},ae=>te.varBank.median(ae)),defineFunction(te,"StdDev",{params:{name:"Items..."},prep:ne},ae=>ae.stackApply(he=>{let ce=he.items;if(ce.length>1){let pe=te.varBank.mean(ce),de=power(minus(ce[0],pe),new Material(2));for(let ve=1;ve<ce.length;ve++)de=plus(de,power(minus(ce[ve],pe),new Material(2)));return power(div(de,new Material(ce.length-1)),new Material(.5))}else throw new ModelError("You must have at least two elements to calculate the standard deviation.",{code:6022})})),defineFunction(te,"StdDev",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},ae=>te.varBank.stddev(ae)),defineFunction(te,"Correlation",{params:[{name:"Vector 1",needVector:!0},{name:"Vector 2",needVector:!0}]},ae=>{let oe=toNum(ae[0]),he=toNum(ae[1]);if(oe.length()<=1)throw new ModelError("You must have at least two elements in your vectors to calculate their correlation.",{code:6023});if(oe.length()!==he.length())throw new ModelError("The vectors for Correlation() must be of the same size.",{code:6024});let ce=te.varBank.mean([oe]),pe=te.varBank.mean([he]),de=te.varBank.stddev([oe]),me=te.varBank.stddev([he]);return de.value===0||me.value===0?new Material(0):div(te.varBank.sum([mult(minus(oe.clone(),ce),minus(he.clone(),pe))]),mult(minus(te.varBank.count([oe]),new Material(1)),mult(de,me)))}),te.varBank.count=function(ae){return ae=te.varBank.join(ae).items,new Material(ae.length)},te.varBank.flatten=function(ae){let oe=ue(te.varBank.join(ae));return new Vector(oe.items,te,oe.hasName?oe.names:void 0)},defineFunction(te,"Keys",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},ae=>ae[0].names?new Vector(ae[0].names.filter(oe=>oe!==void 0).map(oe=>stringify$1(oe,te)),te):new Vector([],te)),defineFunction(te,"Values",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},ae=>new Vector(ae[0].items,te)),defineFunction(te,"Length",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},ae=>new Material(ae[0].items.length)),defineFunction(te,"Count",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},ae=>new Material(ae[0].items.length)),defineFunction(te,"Flatten",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},ae=>te.varBank.flatten(ae));function ue(ae){let oe=[],he=[],ce;for(let pe=0;pe<ae.length();pe++)if(ae.items[pe]instanceof Vector){let de=ue(ae.items[pe]);oe=oe.concat(de.items),he=he.concat(de.names),ce=ce||de.hasName}else oe.push(ae.items[pe]),ae.names?(he.push(ae.names[pe]),ce=!0):he.push(void 0);return{items:oe,names:he,hasName:ce}}defineFunction(te,"CDFNormal",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Mean",defaultVal:0,noUnits:!0,noVector:!0},{name:"Standard Deviation",defaultVal:1,noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value,he=ae[1]?toNum(ae[1]).value:0,ce=ae[2]?toNum(ae[2]).value:1;return new Material(jStat.normal.cdf(oe,he,ce))}),defineFunction(te,"PDFNormal",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Mean",defaultVal:0,noUnits:!0,noVector:!0},{name:"Standard Deviation",defaultVal:1,noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value,he=ae[1]?toNum(ae[1]).value:0,ce=ae[2]?toNum(ae[2]).value:1;return new Material(jStat.normal.pdf(oe,he,ce))}),defineFunction(te,"InvNormal",{params:[{name:"p",noUnits:!0,noVector:!0},{name:"Mean",defaultVal:0,noUnits:!0,noVector:!0},{name:"Standard Deviation",defaultVal:1,noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value;if(oe<0||oe>1)throw new ModelError("<i>p</i> is a probability and must be between 0 and 1 inclusive.",{code:6025});let he=ae[1]?toNum(ae[1]).value:0,ce=ae[2]?toNum(ae[2]).value:1;return new Material(jStat.normal.inv(oe,he,ce))}),defineFunction(te,"CDFLogNormal",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Mean",defaultVal:0,noUnits:!0,noVector:!0},{name:"Standard Deviation",defaultVal:1,noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value,he=ae[1]?toNum(ae[1]).value:0,ce=ae[2]?toNum(ae[2]).value:1;return new Material(jStat.lognormal.cdf(oe,he,ce))}),defineFunction(te,"PDFLogNormal",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Mean",defaultVal:0,noUnits:!0,noVector:!0},{name:"Standard Deviation",defaultVal:1,noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value,he=ae[1]?toNum(ae[1]).value:0,ce=ae[2]?toNum(ae[2]).value:1;return new Material(jStat.lognormal.pdf(oe,he,ce))}),defineFunction(te,"InvLogNormal",{params:[{name:"p",noUnits:!0,noVector:!0},{name:"Mean",defaultVal:0,noUnits:!0,noVector:!0},{name:"Standard Deviation",defaultVal:1,noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value;if(oe<0||oe>1)throw new ModelError("<i>p</i> is a probability and must be between 0 and 1 inclusive.",{code:6026});let he=ae[1]?toNum(ae[1]).value:0,ce=ae[2]?toNum(ae[2]).value:1;return new Material(jStat.lognormal.inv(oe,he,ce))}),defineFunction(te,"CDFt",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Degrees of Freedom",noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value,he=toNum(ae[1]).value;if(he<=0)throw new ModelError("<i>Degrees of Freedom</i> must be greater than 0.",{code:6027});return new Material(jStat.studentt.cdf(oe,he))}),defineFunction(te,"PDFt",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Degrees of Freedom",noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value,he=toNum(ae[1]).value;if(he<=0)throw new ModelError("<i>Degrees of Freedom</i> must be greater than 0.",{code:6028});return new Material(jStat.studentt.pdf(oe,he))}),defineFunction(te,"Invt",{params:[{name:"p",noUnits:!0,noVector:!0},{name:"Degrees of Freedom",noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value;if(oe<0||oe>1)throw new ModelError("<i>p</i> is a probability and must be between 0 and 1 inclusive.",{code:6029});let he=toNum(ae[1]).value;if(he<=0)throw new ModelError("<i>Degrees of Freedom</i> must be greater than 0.",{code:6030});return new Material(jStat.studentt.inv(oe,he))}),defineFunction(te,"CDFF",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Degrees of Freedom 1",noUnits:!0,noVector:!0},{name:"Degrees of Freedom 2",noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value,he=toNum(ae[1]).value;if(he<=0)throw new ModelError("<i>Degrees of Freedom</i> must be greater than 0.",{code:6031});let ce=toNum(ae[2]).value;if(ce<=0)throw new ModelError("<i>Degrees of Freedom</i> must be greater than 0.",{code:6032});return new Material(jStat.centralF.cdf(oe,he,ce))}),defineFunction(te,"PDFF",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Degrees of Freedom 1",noUnits:!0,noVector:!0},{name:"Degrees of Freedom 2",noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value,he=toNum(ae[1]).value;if(he<=0)throw new ModelError("<i>Degrees of Freedom 1</i> must be greater than 0.",{code:6033});let ce=toNum(ae[2]).value;if(ce<=0)throw new ModelError("<i>Degrees of Freedom 2</i> must be greater than 0.",{code:6034});return new Material(jStat.centralF.pdf(oe,he,ce))}),defineFunction(te,"InvF",{params:[{name:"p",noUnits:!0,noVector:!0},{name:"Degrees of Freedom 1",noUnits:!0,noVector:!0},{name:"Degrees of Freedom 2",noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value;if(oe<0||oe>1)throw new ModelError("<i>p</i> is a probability and must be between 0 and 1 inclusive.",{code:6035});let he=toNum(ae[1]).value;if(he<=0)throw new ModelError("<i>Degrees of Freedom 1</i> must be greater than 0.",{code:6036});let ce=toNum(ae[2]).value;if(ce<=0)throw new ModelError("<i>Degrees of Freedom</i> must be greater than 0.",{code:6037});return new Material(jStat.centralF.inv(oe,he,ce))}),defineFunction(te,"CDFChiSquared",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Degrees of Freedom",noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value,he=toNum(ae[1]).value;if(he<=0)throw new ModelError("<i>Degrees of Freedom</i> must be greater than 0.",{code:6038});return new Material(jStat.chisquare.cdf(oe,he))}),defineFunction(te,"PDFChiSquared",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Degrees of Freedom",noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value,he=toNum(ae[1]).value;if(he<=0)throw new ModelError("<i>Degrees of Freedom</i> must be greater than 0.",{code:6039});return new Material(jStat.chisquare.pdf(oe,he))}),defineFunction(te,"InvChiSquared",{params:[{name:"p",noUnits:!0,noVector:!0},{name:"Degrees of Freedom",noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value;if(oe<0||oe>1)throw new ModelError("<i>p</i> is a probability and must be between 0 and 1 inclusive.",{code:6040});let he=toNum(ae[1]).value;if(he<=0)throw new ModelError("<i>Degrees of Freedom</i> must be greater than 0.",{code:6041});return new Material(jStat.chisquare.inv(oe,he))}),defineFunction(te,"CDFExponential",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Rate",noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value,he=toNum(ae[1]).value;if(he<=0)throw new ModelError("<i>Rate</i> must be greater than 0.",{code:6042});return new Material(jStat.exponential.cdf(oe,he))}),defineFunction(te,"PDFExponential",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Rate",noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value,he=toNum(ae[1]).value;if(he<=0)throw new ModelError("<i>Rate</i> must be greater than 0.",{code:6043});return new Material(jStat.exponential.pdf(oe,he))}),defineFunction(te,"InvExponential",{params:[{name:"p",noUnits:!0,noVector:!0},{name:"DRate",noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value;if(oe<0||oe>1)throw new ModelError("<i>p</i> is a probability and must be between 0 and 1 inclusive.",{code:6044});let he=toNum(ae[1]).value;if(he<=0)throw new ModelError("<i>Rate</i> must be greater than 0.",{code:6045});return new Material(jStat.exponential.inv(oe,he))}),defineFunction(te,"CDFPoisson",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Lambda",noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value,he=toNum(ae[1]).value;if(he<=0)throw new ModelError("<i>Lambda</i> must be greater than 0.",{code:6046});return new Material(jStat.poisson.cdf(oe,he))}),defineFunction(te,"PMFPoisson",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Lambda",noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value,he=toNum(ae[1]).value;if(he<=0)throw new ModelError("<i>Rate</i> must be greater than 0.",{code:6047});return new Material(jStat.poisson.pdf(oe,he))}),defineFunction(te,"SetRandSeed",{params:[{name:"Seed Number",noUnits:!0,noVector:!0}]},ae=>(te.random=new SeedRandom.seedrandom(toNum(ae[0]).value),stringify$1("Random Seed Set",te))),defineFunction(te,"Alert",{params:[{name:"Message",allowString:!0,allowBoolean:!0}]},ae=>{if(typeof alert>"u")throw new ModelError("Alert() is not implemented on this platform.",{code:6048});return alert(ae[0]),new Material(1)}),defineFunction(te,"Console",{params:[{name:"Message",allowString:!0,allowBoolean:!0}]},ae=>(console.log(ae[0]),new Material(1))),defineFunction(te,"Prompt",{params:[{name:"Message",allowString:!0,allowBoolean:!0},{name:"Default",defaultVal:"",allowString:!0,allowBoolean:!0}]},ae=>{if(typeof prompt>"u")throw new ModelError("Prompt() is not implemented on this platform.",{code:6049});let oe=ae[1];return oe instanceof Material&&!oe.units&&(oe=oe.value),ae=prompt(ae[0],oe),parseFloat(ae).toString()===ae?new Material(parseFloat(ae)):ae===null?new Material(0):stringify$1(ae,te)}),defineFunction(te,"Confirm",{params:[{name:"Message",allowString:!0,allowBoolean:!0}]},ae=>{if(typeof window>"u"||typeof window.confirm>"u")throw new ModelError("Confirm() is not implemented on this platform.",{code:6050});return window.confirm(ae[0])}),defineFunction(te,"Parse",{object:StringObject,params:[{name:"String",allowString:!0}]},ae=>new Material(parseFloat(ae[0]))),defineFunction(te,"Split",{object:StringObject,params:[{name:"String",needString:!0},{name:"Splitter",needString:!0}]},ae=>stringify$1(new Vector(ae[0].split(ae[1]),te),te)),defineFunction(te,"Join",{object:VectorObject,params:[{name:"String",needVector:!0},{name:"Joiner",needString:!0}]},ae=>stringify$1(ae[0].items.join(ae[1]),te)),defineFunction(te,"Trim",{object:StringObject,params:[{name:"String",needString:!0}],recurse:!0},ae=>stringify$1(ae[0].trim(),te)),defineFunction(te,"Range",{object:StringObject,params:[{name:"String",needString:!0},{name:"Indexes",noUnits:!0,allowVector:!0}]},ae=>{if(ae[1]instanceof Vector){let oe="";for(let he=0;he<ae[1].items.length;he++)oe+=ae[0].charAt(toNum(ae[1].items[he]).value-1);return stringify$1(oe,te)}else return stringify$1(ae[0].charAt(toNum(ae[1]).value-1),te)}),defineFunction(te,"Length",{object:StringObject,params:[{name:"String",needString:!0}]},ae=>new Material(ae[0].length)),defineFunction(te,"IndexOf",{object:StringObject,params:[{name:"Haystack",needString:!0},{name:"Needle",needString:!0}]},ae=>new Material(ae[0].indexOf(ae[1])+1)),defineFunction(te,"Contains",{object:StringObject,params:[{name:"Haystack",needString:!0},{name:"Needle",needString:!0}]},ae=>!eq(StringObject.indexof(ae),new Material(0))),defineFunction(te,"Lowercase",{object:StringObject,params:[{name:"String",needString:!0}]},ae=>stringify$1(ae[0].toLowerCase(),te)),defineFunction(te,"Uppercase",{object:StringObject,params:[{name:"String",needString:!0}]},ae=>stringify$1(ae[0].toUpperCase(),te)),te.varBank.stringbase=makeObjectBase(StringObject,te),te.varBank.vectorbase=makeObjectBase(VectorObject,te)}function makeObjectBase(te,ee){let re=Object.keys(te),ne=[];for(let se of re)ne.push(objectizeFunction(te[se]));let ie=new Vector(ne,ee,re);return ie.parent=void 0,ie}function defineFunction(te,ee,re,ne){let ie=re.params,se=Array.isArray(ie),le=[],ue=ie.length;for(let ce=0;ce<ie.length;ce++)if("defaultVal"in ie[ce]){ue=ce;break}for(let ce=0;ce<ie.length;ce++)if(ie[ce].vectorize&&(le.push(ce),ie[ce].noVector))throw new ModelError(`Cannot have a non-vector vectorized parameter. Function '${ee}', parameter '${ie[ce].name}'.`,{code:6051});let ae,oe;se?(ae=ee+"("+ie.map(ce=>ce.name+("defaultVal"in ce?"="+ce.defaultVal.toString():"")).join(", ")+")",oe=ee+"("+ie.slice(1).map(ce=>ce.name+("defaultVal"in ce?"="+ce.defaultVal.toString():"")).join(", ")+")"):(ae=ee+"(items...)",oe=ee+"(items...)");let he=function(ce,pe,de,me={}){let ve;if(me.isObjectCaller?ve=oe:ve=ae,re.prep&&(ce=re.prep(ce)),se&&(ce.length>ie.length||ce.length<ue))throw new ModelError(`Wrong number of parameters for ${ve}.`,{code:6052});if(!se&&!ce.length&&!re.allowEmpty)throw new ModelError(`At least one parameter required for ${ee}().`,{code:6053});for(let ge=0;ge<ce.length;ge++){let _e=se?ie[ge]:ie;if(_e.noUnits&&toNum(ce[ge])instanceof Material&&toNum(ce[ge]).units&&!toNum(ce[ge]).units.isUnitless())throw new ModelError(`${ve} does not accept units for the parameter '${_e.name}'.`,{code:6054});if(_e.noVector&&ce[ge]instanceof Vector)throw new ModelError(`${ve} does not accept vectors for the parameter '${_e.name}'.`,{code:6055});if(_e.vectorize&&ce[ge]instanceof Vector&&!ce[ge].names)throw new ModelError(`${ve} does not accepted non-named vectors for the parameter '${_e.name}'.`,{code:6056});if(_e.needVector&&(ce[ge]instanceof SPrimitive&&(ce[ge]=toNum(ce[ge])),!(ce[ge]instanceof Vector)))throw new ModelError(`${ve} requires a vector for the parameter '${_e.name}'.`,{code:6057});if(_e.needNum&&(ce[ge]instanceof SPrimitive&&(ce[ge]=toNum(ce[ge])),!(ce[ge]instanceof Material)))throw new ModelError(`${ve} requires a number for the parameter '${_e.name}'.`,{code:6058});if(_e.needPrimitive&&!(ce[ge]instanceof SPrimitive))throw new ModelError(`${ve} requires a primitive for the parameter '${_e.name}'.`,{code:6059});if(!_e.allowBoolean&&typeof ce[ge]=="boolean")throw new ModelError(`${ve} does not accept boolean values for the parameter '${_e.name}'.`,{code:6060});if(_e.needAgent&&!(ce[ge]instanceof SAgent)&&(ce[ge]=agent(ce[ge])),_e.needString&&!(typeof ce[ge]=="string"||ce[ge]instanceof String))throw new ModelError(`${ve} requires a string for the parameter '${_e.name}'.`,{code:6061});if(!_e.allowString&&!_e.needString&&(typeof ce[ge]=="string"||ce[ge]instanceof String))throw new ModelError(`${ve} does not accept string values for the parameter '${_e.name}'.`,{code:6062});if(_e.needAgents&&!(ce[ge]instanceof SPopulation)&&(ce[ge]=agents(ce[ge])),_e.needPopulation&&!(ce[ge]instanceof Vector)&&(ce[ge]=getPopulation(ce[ge],te)),_e.needFunction&&!(ce[ge]instanceof Function||ce[ge]instanceof UserFunction))throw new ModelError(`${ve} requires a function for the parameter '${_e.name}'.`,{code:6063})}let we;if(re.recurse&&(we=toNum(ce[0]),ie[0]&&ie[0].leafNeedNum&&!(we instanceof Vector)&&!(we instanceof Material)))throw new ModelError(`${ve} requires a number for the parameter '${ie[0].name}'.`,{code:6058});if(re.recurse&&we instanceof Vector)return we.cloneApply(ge=>{if(!(ge instanceof Vector)&&ie[0]&&ie[0].leafNeedNum&&!(ge instanceof Material))throw new ModelError(`${ve} requires a number for the parameter '${ie[0].name}'.`,{code:6058});return he([ge].concat(ce.slice(1)),pe)});if(le.length>0){let ge,_e=-1;for(let Te=0;Te<le.length;Te++)if(ce[le[Te]]){let Ne=toNum(ce[le[Te]]);if(Ne instanceof Vector&&Ne.namesLC){if(!ge)ge=Ne,_e=le[Te];else if(!ge.keysMatch(Ne.namesLC))throw new ModelError(`Vector keys do not match between parameters '${ie[_e].name}' and '${ie[le[Te]].name}' in ${ve}.`,{code:6064})}}if(ge){let Te=ge.namesLC,Ne=[];for(let ye=0;ye<Te.length;ye++){let Le=[];for(let Oe=0;Oe<ce.length;Oe++)if(le.indexOf(Oe)===-1)Le.push(ce[Oe]);else{let Fe=toNum(ce[Oe]);Fe instanceof Vector&&Fe.namesLC?Le.push(Fe.select([Te[ye]])):Le.push(Fe)}let xe=ne(Le,pe);if(xe instanceof Vector){if(!ge.keysMatch(xe.namesLC))throw new ModelError(`Vector keys do not match between parameter '${ie[_e].name}' and calculation result.`,{code:6065});Ne.push(xe.select([Te[ye]]))}else Ne.push(xe)}return new Vector(Ne,te,Te)}else return ne(ce,pe)}else return ne(ce,pe)};if(!re.object)te.varBank[ee.toLowerCase()]=he;else if(re.object instanceof Array)for(let ce=0;ce<re.object.length;ce++)re.object[ce][ee.toLowerCase()]=he;else re.object[ee.toLowerCase()]=he;re.recurse&&(VectorObject[ee.toLowerCase()]=he)}function objectizeFunction(te){let ee=function(re,ne,ie){if(!ie)throw new ModelError("Object function not used on object",{code:6066});return te([ie].concat(re),ne,ie,{isObjectCaller:!0})};return ee.delayEvalParams=te.delayEvalParams,ee}function factorial(te){if(Math.round(te)!==te)throw new ModelError("The factorial() function only accepts integers.",{code:6067});if(te<0)throw new ModelError("The factorial() function is only defined for integers 0 or larger.",{code:6068});return te>1?te*factorial(te-1):1}function testArgumentsSize(te,ee,re,ne){if(te.length<re||te.length>ne)throw new ModelError(`Wrong number of parameters for ${ee}().`,{code:6069})}let org={};(typeof org.antlr>"u"||!org.antlr)&&(org.antlr={});org.antlr.global={org};org.antlr.namespace=function(){var te=arguments,ee=null,re,ne,ie;for(re=0;re<te.length;re=re+1)for(ie=te[re].split("."),ee=org.antlr.global,ne=0;ne<ie.length;ne=ne+1)ee[ie[ne]]=ee[ie[ne]]||{},ee=ee[ie[ne]];return ee};org.antlr.env=org.antlr.env||{};org.antlr.env.ua=function(){var te={ie:0,opera:0,gecko:0,webkit:0,mobile:null,air:0,rhino:!1},ee,re;try{ee=navigator.userAgent,/KHTML/.test(ee)&&(te.webkit=1),re=ee.match(/AppleWebKit\/([^\s]*)/),re&&re[1]&&(te.webkit=parseFloat(re[1]),/ Mobile\//.test(ee)?te.mobile="Apple":(re=ee.match(/NokiaN[^\/]*/),re&&(te.mobile=re[0])),re=ee.match(/AdobeAIR\/([^\s]*)/),re&&(te.air=re[0])),te.webkit||(re=ee.match(/Opera[\s\/]([^\s]*)/),re&&re[1]?(te.opera=parseFloat(re[1]),re=ee.match(/Opera Mini[^;]*/),re&&(te.mobile=re[0])):(re=ee.match(/MSIE\s([^;]*)/),re&&re[1]?te.ie=parseFloat(re[1]):(re=ee.match(/Gecko\/([^\s]*)/),re&&(te.gecko=1,re=ee.match(/rv:([^\s\)]*)/),re&&re[1]&&(te.gecko=parseFloat(re[1]))))))}catch{}try{typeof window>"u"&&loadClass&&(te.rhino=!0)}catch{}return te}();org.antlr.namespace("org.antlr.runtime.tree");org.antlr.lang=org.antlr.lang||{isArray:function(te){if(te){var ee=org.antlr.lang;return ee.isNumber(te.length)&&ee.isFunction(te.splice)}return!1},isBoolean:function(te){return typeof te=="boolean"},isFunction:function(te){return typeof te=="function"},isNull:function(te){return te===null},isNumber:function(te){return typeof te=="number"&&isFinite(te)},isObject:function(te){return te&&(typeof te=="object"||org.antlr.lang.isFunction(te))||!1},isString:function(te){return typeof te=="string"},isUndefined:function(te){return typeof te>"u"},_IEEnumFix:function(te,ee){if(org.antlr.env.ua.ie){var re=["toString","valueOf"],ne;for(ne=0;ne<re.length;ne=ne+1){var ie=re[ne],se=ee[ie];org.antlr.lang.isFunction(se)&&se!=Object.prototype[ie]&&(te[ie]=se)}}},extend:function(te,ee,re){if(!ee||!te)throw new Error("org.antlr.lang.extend failed, please check that all dependencies are included.");var ne=function(){};if(ne.prototype=ee.prototype,te.prototype=new ne,te.prototype.constructor=te,te.superclass=ee.prototype,ee.prototype.constructor==Object.prototype.constructor&&(ee.prototype.constructor=ee),re){for(var ie in re)te.prototype[ie]=re[ie];org.antlr.lang._IEEnumFix(te.prototype,re)}},augmentObject:function(te,ee){if(!ee||!te)throw new Error("Absorb failed, verify dependencies.");var re=arguments,ne,ie,se=re[2];if(se&&se!==!0)for(ne=2;ne<re.length;ne=ne+1)te[re[ne]]=ee[re[ne]];else{for(ie in ee)(se||!te[ie])&&(te[ie]=ee[ie]);org.antlr.lang._IEEnumFix(te,ee)}},augmentProto:function(te,ee){if(!ee||!te)throw new Error("Augment failed, verify dependencies.");for(var re=[te.prototype,ee.prototype],ne=2;ne<arguments.length;ne=ne+1)re.push(arguments[ne]);org.antlr.lang.augmentObject.apply(this,re)},merge:function(){for(var te={},ee=arguments,re=0,ne=ee.length;re<ne;re=re+1)org.antlr.lang.augmentObject(te,ee[re],!0);return te},isValue:function(te){var ee=org.antlr.lang;return ee.isObject(te)||ee.isString(te)||ee.isNumber(te)||ee.isBoolean(te)},array:{peek:function(te){if(!org.antlr.lang.isArray(te))throw new Error("org.antlr.lang.array.peek: a is not an array.");var ee=te.length;if(ee<=0)throw new Error("org.antlr.lang.array.peek: a is empty.");return te[ee-1]}}};org.antlr.runtime.RecognizerSharedState=function(){this.following=[],this._fsp=-1,this.errorRecovery=!1,this.lastErrorIndex=-1,this.failed=!1,this.syntaxErrors=0,this.backtracking=0,this.ruleMemo=null,this.token=null,this.tokenStartCharIndex=-1,this.text=null};org.antlr.runtime.IndexOutOfBoundsException=function(te){org.antlr.runtime.IndexOutOfBoundsException.superclass.constructor.call(this,te)};org.antlr.lang.extend(org.antlr.runtime.IndexOutOfBoundsException,Error,{name:"org.antlr.runtime.IndexOutOfBoundsException"});org.antlr.runtime.RecognitionException=function(te){org.antlr.runtime.RecognitionException.superclass.constructor.call(this),this.input=te,this.index=te.index(),te instanceof org.antlr.runtime.CommonTokenStream&&(this.token=te.LT(1),this.line=this.token.getLine(),this.charPositionInLine=this.token.getCharPositionInLine()),te instanceof org.antlr.runtime.tree.TreeNodeStream?this.extractInformationFromTreeNodeStream(te):te instanceof org.antlr.runtime.ANTLRStringStream?(this.c=te.LA(1),this.line=te.getLine(),this.charPositionInLine=te.getCharPositionInLine()):this.c=te.LA(1),this.message=this.toString()};org.antlr.lang.extend(org.antlr.runtime.RecognitionException,Error,{input:null,index:null,token:null,node:null,c:null,line:null,name:"org.antlr.runtime.RecognitionException",charPositionInLine:null,approximateLineInfo:null,extractInformationFromTreeNodeStream:function(te){var ee=te,re,ne,ie,se;this.node=ee.LT(1);var le=ee.getTreeAdaptor(),ue=le.getToken(this.node);if(ue)if(this.token=ue,ue.getLine()<=0)for(se=-1,re=ee.LT(se);re;){if(priorPayload=le.getToken(re),priorPayload&&priorPayload.getLine()>0){this.line=priorPayload.getLine(),this.charPositionInLine=priorPayload.getCharPositionInLine(),this.approximateLineInfo=!0;break}--se,re=ee.LT(se)}else this.line=ue.getLine(),this.charPositionInLine=ue.getCharPositionInLine();else this.node instanceof org.antlr.runtime.tree.CommonTree?(this.line=this.node.getLine(),this.charPositionInLine=this.node.getCharPositionInLine(),this.node instanceof org.antlr.runtime.tree.CommonTree&&(this.token=this.node.token)):(ne=le.getType(this.node),ie=le.getText(this.node),this.token=new org.antlr.runtime.CommonToken(ne,ie))},getUnexpectedType:function(){if(this.input instanceof org.antlr.runtime.CommonTokenStream)return this.token.getType();if(this.input instanceof org.antlr.runtime.tree.TreeNodeStream){var te=this.input,ee=te.getTreeAdaptor();return ee.getType(this.node)}else return this.c}});org.antlr.runtime.MismatchedTokenException=function(te,ee){arguments.length===0?this.expecting=org.antlr.runtime.Token.INVALID_TOKEN_TYPE:(org.antlr.runtime.MismatchedTokenException.superclass.constructor.call(this,ee),this.expecting=te)};org.antlr.lang.extend(org.antlr.runtime.MismatchedTokenException,org.antlr.runtime.RecognitionException,{toString:function(){return"MismatchedTokenException("+this.getUnexpectedType()+"!="+this.expecting+")"},name:"org.antlr.runtime.MismatchedTokenException"});org.antlr.runtime.UnwantedTokenException=function(te,ee){arguments.length>0&&org.antlr.runtime.UnwantedTokenException.superclass.constructor.call(this,te,ee)};org.antlr.lang.extend(org.antlr.runtime.UnwantedTokenException,org.antlr.runtime.MismatchedTokenException,{getUnexpectedToken:function(){return this.token},toString:function(){var te=", expected "+this.expecting;return this.expecting===org.antlr.runtime.Token.INVALID_TOKEN_TYPE&&(te=""),org.antlr.lang.isValue(this.token)?"UnwantedTokenException(found="+this.token.getText()+te+")":"UnwantedTokenException(found="+te+")"},name:"org.antlr.runtime.UnwantedTokenException"});org.antlr.runtime.MissingTokenException=function(te,ee,re){arguments.length>0&&(org.antlr.runtime.MissingTokenException.superclass.constructor.call(this,te,ee),this.inserted=re)};org.antlr.lang.extend(org.antlr.runtime.MissingTokenException,org.antlr.runtime.MismatchedTokenException,{getMissingType:function(){return this.expecting},toString:function(){return org.antlr.lang.isValue(this.inserted)&&org.antlr.lang.isValue(this.token)?"MissingTokenException(inserted "+this.inserted+" at "+this.token.getText()+")":org.antlr.lang.isValue(this.token)?"MissingTokenException(at "+this.token.getText()+")":"MissingTokenException"},name:"org.antlr.runtime.MissingTokenException"});org.antlr.runtime.NoViableAltException=function(te,ee,re,ne){org.antlr.runtime.NoViableAltException.superclass.constructor.call(this,ne),this.grammarDecisionDescription=te,this.decisionNumber=ee,this.stateNumber=re};org.antlr.lang.extend(org.antlr.runtime.NoViableAltException,org.antlr.runtime.RecognitionException,{toString:function(){return this.input instanceof org.antlr.runtime.ANTLRStringStream?"NoViableAltException('"+this.getUnexpectedType()+"'@["+this.grammarDecisionDescription+"])":"NoViableAltException("+this.getUnexpectedType()+"@["+this.grammarDecisionDescription+"])"},name:"org.antlr.runtime.NoViableAltException"});org.antlr.runtime.EarlyExitException=function(te,ee){org.antlr.runtime.EarlyExitException.superclass.constructor.call(this,ee),this.decisionNumber=te};org.antlr.lang.extend(org.antlr.runtime.EarlyExitException,org.antlr.runtime.RecognitionException,{name:"org.antlr.runtime.EarlyExitException"});org.antlr.runtime.MismatchedSetException=function(te,ee){org.antlr.runtime.MismatchedSetException.superclass.constructor.call(this,ee),this.expecting=te};org.antlr.lang.extend(org.antlr.runtime.MismatchedSetException,org.antlr.runtime.RecognitionException,{toString:function(){return"MismatchedSetException("+this.getUnexpectedType()+"!="+this.expecting+")"},name:"org.antlr.runtime.MismatchedSetException"});org.antlr.runtime.MismatchedNotSetException=function(te,ee){org.antlr.runtime.MismatchedNotSetException.superclass.constructor.call(this,te,ee)};org.antlr.lang.extend(org.antlr.runtime.MismatchedNotSetException,org.antlr.runtime.MismatchedSetException,{toString:function(){return"MismatchedNotSetException("+this.getUnexpectedType()+"!="+this.expecting+")"},name:"org.antlr.runtime.MismatchedNotSetException"});org.antlr.runtime.MismatchedRangeException=function(te,ee,re){if(arguments.length===0)return this;org.antlr.runtime.MismatchedRangeException.superclass.constructor.call(this,re),this.a=te,this.b=ee};org.antlr.lang.extend(org.antlr.runtime.MismatchedRangeException,org.antlr.runtime.RecognitionException,{toString:function(){return"MismatchedRangeException("+this.getUnexpectedType()+" not in ["+this.a+","+this.b+"])"},name:"org.antlr.runtime.MismatchedRangeException"});org.antlr.runtime.FailedPredicateException=function(te,ee,re){org.antlr.runtime.FailedPredicateException.superclass.constructor.call(this,te),this.ruleName=ee,this.predicateText=re};org.antlr.lang.extend(org.antlr.runtime.FailedPredicateException,org.antlr.runtime.RecognitionException,{toString:function(){return"FailedPredicateException("+this.ruleName+",{"+this.predicateText+"}?)"},name:"org.antlr.runtime.FailedPredicateException"});org.antlr.runtime.BitSet=function(te){te||(te=org.antlr.runtime.BitSet.BITS),org.antlr.lang.isArray(te)?this.bits=te:org.antlr.lang.isNumber(te)&&(this.bits=[])};org.antlr.lang.augmentObject(org.antlr.runtime.BitSet,{BITS:32,LOG_BITS:5,MOD_MASK:31,bitMask:function(te){var ee=te&org.antlr.runtime.BitSet.MOD_MASK;return 1<<ee},numWordsToHold:function(te){return(te>>org.antlr.runtime.BitSet.LOG_BITS)+1},wordNumber:function(te){return te>>org.antlr.runtime.BitSet.LOG_BITS},of:function(te,ee){var re,ne,ie,se;if(org.antlr.lang.isNumber(te))if(org.antlr.lang.isNumber(ee)){for(ie=new org.antlr.runtime.BitSet(ee+1),re=te;re<=ee;re++)ne=org.antlr.runtime.BitSet.wordNumber(re),ie.bits[ne]|=org.antlr.runtime.BitSet.bitMask(re);return ie}else return ie=new org.antlr.runtime.BitSet(te+1),ie.add(te),ie;else if(org.antlr.lang.isArray(te)){for(ie=new org.antlr.runtime.BitSet,re=te.length-1;re>=0;re--)ie.add(te[re]);return ie}else{if(te instanceof org.antlr.runtime.BitSet)return te||null;if(te instanceof org.antlr.runtime.IntervalSet)return te?(ie=new org.antlr.runtime.BitSet,ie.addAll(te),ie):null;if(org.antlr.lang.isObject(te)){se=[];for(re in te)org.antlr.lang.isNumber(re)&&se.push(re);return org.antlr.runtime.BitSet.of(se)}}}});org.antlr.runtime.BitSet.prototype={add:function(te){var ee=org.antlr.runtime.BitSet.wordNumber(te);ee>=this.bits.length&&this.growToInclude(te),this.bits[ee]|=org.antlr.runtime.BitSet.bitMask(te)},addAll:function(te){var ee,re;if(te instanceof org.antlr.runtime.BitSet)this.orInPlace(te);else if(!(te instanceof org.antlr.runtime.IntervalSet))if(org.antlr.lang.isArray(te))for(ee=0;ee<te.length;ee++)re=te[ee],this.add(re);else return},and:function(te){var ee=this.clone();return ee.andInPlace(te),ee},andInPlace:function(te){var ee=Math.min(this.bits.length,te.bits.length),re;for(re=ee-1;re>=0;re--)this.bits[re]&=te.bits[re];for(re=ee;re<this.bits.length;re++)this.bits[re]=0},clear:function(te){if(arguments.length===0){var ee;for(ee=this.bits.length-1;ee>=0;ee--)this.bits[ee]=0;return}var re=org.antlr.runtime.BitSet.wordNumber(te);re>=this.bits.length&&this.growToInclude(te),this.bits[re]&=~org.antlr.runtime.BitSet.bitMask(te)},clone:function(){var te,ee,re=[];for(te=0,ee=this.bits.length;te<ee;te++)re[te]=this.bits[te];return new org.antlr.runtime.BitSet(re)},size:function(){var te=0,ee,re,ne;for(ee=this.bits.length-1;ee>=0;ee--)if(re=this.bits[ee],re!==0)for(ne=org.antlr.runtime.BitSet.BITS-1;ne>=0;ne--)re&1<<ne&&te++;return te},equals:function(te){if(!te||!(te instanceof org.antlr.runtime.BitSet))return!1;var ee=te,re,ne=Math.min(this.bits.length,ee.bits.length);for(re=0;re<ne;re++)if(this.bits[re]!=ee.bits[re])return!1;if(this.bits.length>ne){for(re=ne+1;re<this.bits.length;re++)if(this.bits[re]!==0)return!1}else if(ee.bits.length>ne){for(re=ne+1;re<ee.bits.length;re++)if(ee.bits[re]!==0)return!1}return!0},growToInclude:function(te){Math.max(this.bits.length<<1,org.antlr.runtime.BitSet.numWordsToHold(te));var ee=[],re;for(re=0,len=this.bits.length;re<len;re++)ee[re]=this.bits[re];this.bits=ee},member:function(te){var ee=org.antlr.runtime.BitSet.wordNumber(te);return ee>=this.bits.length?!1:(this.bits[ee]&org.antlr.runtime.BitSet.bitMask(te))!==0},getSingleElement:function(){var te;for(te=0;te<this.bits.length<<org.antlr.runtime.BitSet.LOG_BITS;te++)if(this.member(te))return te;return-1},isNil:function(){var te;for(te=this.bits.length-1;te>=0;te--)if(this.bits[te]!==0)return!1;return!0},complement:function(te){if(te)return te.subtract(this);var ee=this.clone();return ee.notInPlace(),ee},notInPlace:function(){var te,ee,re,ne;if(arguments.length===0)for(re=this.bits.length-1;re>=0;re--)this.bits[re]=~this.bits[re];else for(arguments.length===1?(te=0,ee=arguments[0]):(te=arguments[0],ee=arguments[1]),this.growToInclude(ee),re=te;re<=ee;re++)ne=org.antlr.runtime.BitSet.wordNumber(re),this.bits[ne]^=org.antlr.runtime.BitSet.bitMask(re)},or:function(te){if(!te)return this;var ee=this.clone();return ee.orInPlace(te),ee},orInPlace:function(te){if(te){te.bits.length>this.bits.length&&this.setSize(te.bits.length);var ee=Math.min(this.bits.length,te.bits.length),re;for(re=ee-1;re>=0;re--)this.bits[re]|=te.bits[re]}},remove:function(te){var ee=org.antlr.runtime.BitSet.wordNumber(te);ee>=this.bits.length&&this.growToInclude(te),this.bits[ee]&=~org.antlr.runtime.BitSet.bitMask(te)},setSize:function(te){for(var ee=te-this.bits.length;ee>=0;)this.bits.push(0),ee--},numBits:function(){return this.bits.length<<org.antlr.runtime.BitSet.LOG_BITS},lengthInLongWords:function(){return this.bits.length},subset:function(te){return te?this.and(te).equals(this):!1},subtractInPlace:function(te){if(te){var ee;for(ee=0;ee<this.bits.length&&ee<te.bits.length;ee++)this.bits[ee]&=~te.bits[ee]}},subtract:function(te){if(!te||!(te instanceof org.antlr.runtime.BitSet))return null;var ee=this.clone();return ee.subtractInPlace(te),ee},toArray:function(){var te=[],ee,re=0;for(ee=0;ee<this.bits.length<<org.antlr.runtime.BitSet.LOG_BITS;ee++)this.member(ee)&&(te[re++]=ee);return te},toPackedArray:function(){return this.bits},toString:function(){return arguments.length===0?this.toString1(null):org.antlr.lang.isString(arguments[0])?org.antlr.lang.isValue(arguments[1])?this.toString2(arguments[0],arguments[1]):this.toString1(null):this.toString1(arguments[0])},toString1:function(te){var ee="{",re=",",ne,ie=!1;for(ne=0;ne<this.bits.length<<org.antlr.runtime.BitSet.LOG_BITS;ne++)this.member(ne)&&(ne>0&&ie&&(ee+=re),te?ee+=te.getTokenDisplayName(ne):ee+=ne.toString(),ie=!0);return ee+"}"},toString2:function(te,ee){var re="",ne;for(ne=0;ne<this.bits.length<<org.antlr.runtime.BitSet.LOG_BITS;ne++)this.member(ne)&&(re.length>0&&(re+=te),ne>=ee.size()?re+="'"+ne+"'":org.antlr.lang.isValue(ee.get(ne))?re+=ee.get(ne):re+="'"+ne+"'");return re}};org.antlr.runtime.CharStream={EOF:-1};org.antlr.runtime.CommonToken=function(){var te;this.charPositionInLine=-1,this.channel=0,this.index=-1,arguments.length==1?org.antlr.lang.isNumber(arguments[0])?this.type=arguments[0]:(te=arguments[0],this.text=te.getText(),this.type=te.getType(),this.line=te.getLine(),this.index=te.getTokenIndex(),this.charPositionInLine=te.getCharPositionInLine(),this.channel=te.getChannel(),te instanceof org.antlr.runtime.CommonToken&&(this.start=te.start,this.stop=te.stop)):arguments.length==2?(this.type=arguments[0],this.text=arguments[1],this.channel=0):arguments.length==5&&(this.input=arguments[0],this.type=arguments[1],this.channel=arguments[2],this.start=arguments[3],this.stop=arguments[4])};org.antlr.runtime.CommonToken.prototype={getType:function(){return this.type},setLine:function(te){this.line=te},getText:function(){return org.antlr.lang.isString(this.text)?this.text:this.input?(this.text=this.input.substring(this.start,this.stop),this.text):null},setText:function(te){this.text=te},getLine:function(){return this.line},getCharPositionInLine:function(){return this.charPositionInLine},setCharPositionInLine:function(te){this.charPositionInLine=te},getChannel:function(){return this.channel},setChannel:function(te){this.channel=te},setType:function(te){this.type=te},getStartIndex:function(){return this.start},setStartIndex:function(te){this.start=te},getStopIndex:function(){return this.stop},setStopIndex:function(te){this.stop=te},getTokenIndex:function(){return this.index},setTokenIndex:function(te){this.index=te},getInputStream:function(){return this.input},setInputStream:function(te){this.input=te},toString:function(){var te="";this.channel>0&&(te=",channel="+this.channel);var ee=this.getText();return org.antlr.lang.isNull(ee)?ee="<no text>":(ee=ee.replace(/\n/g,"\\\\n"),ee=ee.replace(/\r/g,"\\\\r"),ee=ee.replace(/\t/g,"\\\\t")),"[@"+this.getTokenIndex()+","+this.start+":"+this.stop+"='"+ee+"',<"+this.type+">"+te+","+this.line+":"+this.getCharPositionInLine()+"]"}};org.antlr.runtime.Token=function(){};org.antlr.lang.augmentObject(org.antlr.runtime.Token,{EOR_TOKEN_TYPE:1,DOWN:2,UP:3,MIN_TOKEN_TYPE:4,EOF:org.antlr.runtime.CharStream.EOF,EOF_TOKEN:new org.antlr.runtime.CommonToken(org.antlr.runtime.CharStream.EOF),INVALID_TOKEN_TYPE:0,INVALID_TOKEN:new org.antlr.runtime.CommonToken(0),SKIP_TOKEN:new org.antlr.runtime.CommonToken(0),DEFAULT_CHANNEL:0,HIDDEN_CHANNEL:99});org.antlr.lang.augmentObject(org.antlr.runtime.CommonToken,org.antlr.runtime.Token);org.antlr.runtime.tree.RewriteCardinalityException=function(te){this.elementDescription=te};org.antlr.lang.extend(org.antlr.runtime.tree.RewriteCardinalityException,Error,{getMessage:function(){return org.antlr.lang.isString(this.elementDescription)?this.elementDescription:null},name:function(){return"org.antlr.runtime.tree.RewriteCardinalityException"}});org.antlr.runtime.tree.RewriteEmptyStreamException=function(te){var ee=org.antlr.runtime.tree.RewriteEmptyStreamException.superclass;ee.constructor.call(this,te)};org.antlr.lang.extend(org.antlr.runtime.tree.RewriteEmptyStreamException,org.antlr.runtime.tree.RewriteCardinalityException,{name:function(){return"org.antlr.runtime.tree.RewriteEmptyStreamException"}});org.antlr.runtime.tree.RewriteEarlyExitException=function(te){var ee=org.antlr.runtime.tree.RewriteEarlyExitException.superclass;org.antlr.lang.isUndefined(te)&&(te=null),ee.constructor.call(this,te)};org.antlr.lang.extend(org.antlr.runtime.tree.RewriteEarlyExitException,org.antlr.runtime.tree.RewriteCardinalityException,{name:function(){return"org.antlr.runtime.tree.RewriteEarlyExitException"}});org.antlr.runtime.MismatchedTreeNodeException=function(te,ee){te&&ee&&(org.antlr.runtime.MismatchedTreeNodeException.superclass.constructor.call(this,ee),this.expecting=te)};org.antlr.lang.extend(org.antlr.runtime.MismatchedTreeNodeException,org.antlr.runtime.RecognitionException,{toString:function(){return"MismatchedTreeNodeException("+this.getUnexpectedType()+"!="+this.expecting+")"},name:"org.antlr.runtime.MismatchedTreeNodeException"});org.antlr.runtime.tree.BaseTree=function(){};org.antlr.runtime.tree.BaseTree.prototype={getChild:function(te){return!this.children||te>=this.children.length?null:this.children[te]},getChildren:function(){return this.children},getFirstChildWithType:function(te){var ee,re;for(ee=0;this.children&&ee<this.children.length;ee++)if(re=this.children[ee],re.getType()===te)return re;return null},getChildCount:function(){return this.children?this.children.length:0},addChild:function(te){if(org.antlr.lang.isValue(te)){var ee=te,re,ne,ie;if(ee.isNil()){if(this.children&&this.children==ee.children)throw new Error("attempt to add child list to itself");if(ee.children)if(this.children)for(re=ee.children.length,ne=0;ne<re;ne++)ie=ee.children[ne],this.children.push(ie),ie.setParent(this),ie.setChildIndex(this.children.length-1);else this.children=ee.children,this.freshenParentAndChildIndexes()}else this.children||(this.children=this.createChildrenList()),this.children.push(te),ee.setParent(this),ee.setChildIndex(this.children.length-1)}},addChildren:function(te){var ee,re;for(ee=0;ee<te.length;ee++)re=te[ee],this.addChild(re)},setChild:function(te,ee){if(ee){if(ee.isNil())throw new Error("Can't set single child to a list");this.children||(this.children=this.createChildrenList()),this.children[te]=ee,ee.setParent(this),ee.setChildIndex(te)}},deleteChild:function(te){if(!this.children)return null;if(te<0||te>=this.children.length)throw new Error("Index out of bounds.");var ee=this.children.splice(te,1)[0];return this.freshenParentAndChildIndexes(te),ee},replaceChildren:function(te,ee,re){if(!this.children)throw new Error("indexes invalid; no children in list");var ne=ee-te+1,ie,se=re,le=null;se.isNil()?le=se.children:(le=[],le.push(se)),ie=le.length;var ue=le.length,ae=ne-ie,oe,he,ce,pe,de;if(ae===0)for(oe=0,he=te;he<=ee;he++)ce=le[oe],this.children[he]=ce,ce.setParent(this),ce.setChildIndex(he),oe++;else if(ae>0){for(oe=0;oe<ue;oe++)this.children[te+oe]=le[oe];for(pe=te+ue,de=pe;de<=ee;de++)this.children.splice(pe,1)[0];this.freshenParentAndChildIndexes(te)}else{for(oe=0;oe<ne;oe++)this.children[te+oe]=le[oe];for(oe=ne;oe<ie;oe++)this.children.splice(te+oe,0,le[oe]);this.freshenParentAndChildIndexes(te)}},createChildrenList:function(){return[]},isNil:function(){return!1},freshenParentAndChildIndexes:function(te){org.antlr.lang.isNumber(te)||(te=0);var ee=this.getChildCount(),re,ne;for(re=te;re<ee;re++)ne=this.getChild(re),ne.setChildIndex(re),ne.setParent(this)},sanityCheckParentAndChildIndexes:function(te,ee){if(arguments.length===0&&(te=null,ee=-1),te!==this.getParent())throw new Error("parents don't match; expected "+te+" found "+this.getParent());if(ee!==this.getChildIndex())throw new Error("child indexes don't match; expected "+ee+" found "+this.getChildIndex());var re=this.getChildCount(),ne,ie;for(ne=0;ne<re;ne++)ie=this.getChild(ne),ie.sanityCheckParentAndChildIndexes(this,ne)},getChildIndex:function(){return 0},setChildIndex:function(te){},getParent:function(){return null},setParent:function(te){},getTree:function(){return this},toStringTree:function(){if(!this.children||this.children.length===0)return this.toString();var te="",ee,re;for(this.isNil()||(te+="(",te+=this.toString(),te+=" "),ee=0;this.children&&ee<this.children.length;ee++)re=this.children[ee],ee>0&&(te+=" "),te+=re.toStringTree();return this.isNil()||(te+=")"),te},getLine:function(){return 0},getCharPositionInLine:function(){return 0}};org.antlr.runtime.tree.CommonTree=function(te){this.startIndex=-1,this.stopIndex=-1,this.childIndex=-1,this.parent=null,this.token=null,te instanceof org.antlr.runtime.tree.CommonTree?(org.antlr.runtime.tree.CommonTree.superclass.constructor.call(this,te),this.token=te.token,this.startIndex=te.startIndex,this.stopIndex=te.stopIndex):te instanceof org.antlr.runtime.CommonToken&&(this.token=te)};org.antlr.lang.extend(org.antlr.runtime.tree.CommonTree,org.antlr.runtime.tree.BaseTree,{getToken:function(){return this.token},dupNode:function(){return new org.antlr.runtime.tree.CommonTree(this)},isNil:function(){return!this.token},getType:function(){return this.token?this.token.getType():org.antlr.runtime.Token.INVALID_TOKEN_TYPE},getText:function(){return this.token?this.token.getText():null},getLine:function(){return!this.token||this.token.getLine()===0?this.getChildCount()>0?this.getChild(0).getLine():0:this.token.getLine()},getCharPositionInLine:function(){return!this.token||this.token.getCharPositionInLine()===-1?this.getChildCount()>0?this.getChild(0).getCharPositionInLine():0:this.token.getCharPositionInLine()},getTokenStartIndex:function(){return this.token?this.token.getTokenIndex():this.startIndex},setTokenStartIndex:function(te){this.startIndex=te},getTokenStopIndex:function(){return this.token?this.token.getTokenIndex():this.stopIndex},setTokenStopIndex:function(te){this.stopIndex=te},getChildIndex:function(){return this.childIndex},getParent:function(){return this.parent},setParent:function(te){this.parent=te},setChildIndex:function(te){this.childIndex=te},toString:function(){return this.isNil()?"nil":this.getType()===org.antlr.runtime.Token.INVALID_TOKEN_TYPE?"<errornode>":this.token?this.token.getText():null}});org.antlr.runtime.tree.Tree={INVALID_NODE:new org.antlr.runtime.tree.CommonTree(org.antlr.runtime.Token.INVALID_TOKEN)};org.antlr.runtime.tree.CommonErrorNode=function(te,ee,re,ne){(!re||re.getTokenIndex()<ee.getTokenIndex()&&re.getType()!=org.antlr.runtime.Token.EOF)&&(re=ee),this.input=te,this.start=ee,this.stop=re,this.trappedException=ne};org.antlr.lang.extend(org.antlr.runtime.tree.CommonErrorNode,org.antlr.runtime.tree.CommonTree,{isNil:function(){return!1},getType:function(){return org.antlr.runtime.Token.INVALID_TOKEN_TYPE},getText:function(){var te=null;if(this.start instanceof org.antlr.runtime.CommonToken){var ee=this.start.getTokenIndex(),re=this.stop.getTokenIndex();this.stop.getType()===org.antlr.runtime.Token.EOF&&(re=this.input.size()),te=this.input.toString(ee,re)}else this.start instanceof org.antlr.runtime.tree.CommonTree?te=this.input.toString(this.start,this.stop):te="<unknown>";return te},toString:function(){return this.trappedException instanceof org.antlr.runtime.MissingTokenException?"<missing type: "+this.trappedException.getMissingType()+">":this.trappedException instanceof org.antlr.runtime.UnwantedTokenException?"<extraneous: "+this.trappedException.getUnexpectedToken()+", resync="+this.getText()+">":this.trappedException instanceof org.antlr.runtime.MismatchedTokenException?"<mismatched token: "+this.trappedException.token+", resync="+this.getText()+">":this.trappedException instanceof org.antlr.runtime.NoViableAltException?"<unexpected: "+this.trappedException.token+", resync="+this.getText()+">":"<error: "+this.getText()+">"}});org.antlr.runtime.tree.BaseTreeAdaptor=function(){this.uniqueNodeID=1};org.antlr.runtime.tree.BaseTreeAdaptor.prototype={nil:function(){return this.create(null)},errorNode:function(te,ee,re,ne){var ie=new org.antlr.runtime.tree.CommonErrorNode(te,ee,re,ne);return ie},isNil:function(te){return te.isNil()},dupTree:function(te,ee){if(arguments.length===1&&(ee=null),!te)return null;var re=this.dupNode(te);this.setChildIndex(re,this.getChildIndex(te)),this.setParent(re,ee);var ne=this.getChildCount(te),ie,se,le;for(ie=0;ie<ne;ie++)se=this.getChild(te,ie),le=this.dupTree(se,te),this.addChild(re,le);return re},addChild:function(te,ee){te&&org.antlr.lang.isValue(ee)&&te.addChild(ee)},becomeRoot:function(te,ee){(te instanceof org.antlr.runtime.CommonToken||!te)&&(te=this.create(te));var re=te,ne=ee;if(!ee)return te;if(re.isNil()){if(re.getChildCount()>1)throw new Error("more than one node as root (TODO: make exception hierarchy)");re=re.getChild(0)}return re.addChild(ne),re},rulePostProcessing:function(te){var ee=te;return ee&&ee.isNil()&&(ee.getChildCount()===0?ee=null:ee.getChildCount()===1&&(ee=ee.getChild(0),ee.setParent(null),ee.setChildIndex(-1))),ee},create:function(te,ee){var re,ne;if(arguments.length===2)return org.antlr.lang.isString(arguments[1])?(re=arguments[1],ee=this.createToken(te,re),ne=this.create(ee),ne):(ee=this.createToken(ee),ee.setType(te),ne=this.create(ee),ne);if(arguments.length===3)return re=arguments[2],ee=this.createToken(ee),ee.setType(te),ee.setText(re),ne=this.create(ee),ne},getType:function(te){return te.getType(),0},setType:function(te,ee){throw new Error("don't know enough about Tree node")},getText:function(te){return te.getText()},setText:function(te,ee){throw new Error("don't know enough about Tree node")},getChild:function(te,ee){return te.getChild(ee)},setChild:function(te,ee,re){te.setChild(ee,re)},deleteChild:function(te,ee){return te.deleteChild(ee)},getChildCount:function(te){return te.getChildCount()},getUniqueID:function(te){this.treeToUniqueIDMap||(this.treeToUniqueIDMap={});var ee=this.treeToUniqueIDMap[te];if(org.antlr.lang.isValue(ee))return ee;var re=this.uniqueNodeID;return this.treeToUniqueIDMap[te]=re,this.uniqueNodeID++,re}};org.antlr.runtime.tree.CommonTreeAdaptor=function(){};org.antlr.lang.extend(org.antlr.runtime.tree.CommonTreeAdaptor,org.antlr.runtime.tree.BaseTreeAdaptor,{dupNode:function(te){return org.antlr.lang.isValue(te)?te.dupNode():null},create:function(te){return arguments.length>1?org.antlr.runtime.tree.CommonTreeAdaptor.superclass.create.apply(this,arguments):new org.antlr.runtime.tree.CommonTree(te)},createToken:function(te){return arguments.length===2?new org.antlr.runtime.CommonToken(arguments[0],arguments[1]):new org.antlr.runtime.CommonToken(arguments[0])},setTokenBoundaries:function(te,ee,re){if(org.antlr.lang.isValue(te)){var ne=0,ie=0;org.antlr.lang.isValue(ee)&&(ee.getTokenIndex?ne=ee.getTokenIndex():ee.getStartIndex?ne=ee.getStartIndex():ne=ee.getTokenStartIndex()),org.antlr.lang.isValue(re)&&(ie.getTokenIndex?ie=re.getTokenIndex():re.getStopIndex?ie=re.getStopIndex():ie=re.getTokenStopIndex()),te.setTokenStartIndex(ne),te.setTokenStopIndex(ie)}},getTokenStartIndex:function(te){return te?te.getTokenStartIndex():-1},getTokenStopIndex:function(te){return te?te.getTokenStopIndex():-1},getText:function(te){return te?te.getText():null},getType:function(te){return te?te.getType():org.antlr.runtime.Token.INVALID_TOKEN_TYPE},getToken:function(te){return te instanceof org.antlr.runtime.tree.CommonTree?te.getToken():null},getChild:function(te,ee){return te?te.getChild(ee):null},getChildCount:function(te){return te?te.getChildCount():0},getParent:function(te){return te.getParent()},setParent:function(te,ee){te.setParent(ee)},getChildIndex:function(te){return te.getChildIndex()},setChildIndex:function(te,ee){te.setChildIndex(ee)},replaceChildren:function(te,ee,re,ne){te&&te.replaceChildren(ee,re,ne)}});org.antlr.runtime.ANTLRStringStream=function(te){this.p=0,this.line=1,this.charPositionInLine=0,this.markDepth=0,this.markers=null,this.lastMarker=null,this.data=te,this.n=te.length};org.antlr.runtime.ANTLRStringStream.prototype={reset:function(){this.p=0,this.line=1,this.charPositionInLine=0,this.markDepth=0},consume:function(){this.p<this.n&&(this.charPositionInLine++,this.data.charAt(this.p)===`
`&&(this.line++,this.charPositionInLine=0),this.p++)},LA:function(te){te<0&&te++;var ee=this.p+te-1;return ee>=this.n||ee<0?org.antlr.runtime.CharStream.EOF:this.data.charAt(ee)},index:function(){return this.p},size:function(){return this.n},mark:function(){this.markers||(this.markers=[],this.markers.push(null)),this.markDepth++;var te=null;return this.markDepth>=this.markers.length?(te={},this.markers.push(te)):te=this.markers[this.markDepth],te.p=this.p,te.line=this.line,te.charPositionInLine=this.charPositionInLine,this.lastMarker=this.markDepth,this.markDepth},rewind:function(te){org.antlr.lang.isNumber(te)||(te=this.lastMarker);var ee=this.markers[te];this.seek(ee.p),this.line=ee.line,this.charPositionInLine=ee.charPositionInLine,this.release(te)},release:function(te){this.markDepth=te,this.markDepth--},seek:function(te){if(te<=this.p){this.p=te;return}for(;this.p<te;)this.consume()},substring:function(te,ee){return this.data.substr(te,ee-te+1)},getLine:function(){return this.line},getCharPositionInLine:function(){return this.charPositionInLine},setLine:function(te){this.line=te},setCharPositionInLine:function(te){this.charPositionInLine=te},getSourceName:function(){return null}};org.antlr.runtime.ANTLRStringStream.LT=org.antlr.runtime.ANTLRStringStream.LA;org.antlr.runtime.CommonTokenStream=function(te,ee){this.p=-1,this.channel=org.antlr.runtime.Token.DEFAULT_CHANNEL,this.v_discardOffChannelTokens=!1,this.tokens=[],arguments.length>=2?this.channel=ee:arguments.length===1&&(this.tokenSource=te)};org.antlr.runtime.CommonTokenStream.prototype={setTokenSource:function(te){this.tokenSource=te,this.tokens=[],this.p=-1,this.channel=org.antlr.runtime.Token.DEFAULT_CHANNEL},fillBuffer:function(){for(var te=0,ee=this.tokenSource.nextToken(),re,ne;org.antlr.lang.isValue(ee)&&ee.getType()!=org.antlr.runtime.CharStream.EOF;)re=!1,this.channelOverrideMap&&(ne=this.channelOverrideMap[ee.getType()],org.antlr.lang.isValue(ne)&&ee.setChannel(ne)),(this.discardSet&&this.discardSet[ee.getType()]||this.v_discardOffChannelTokens&&ee.getChannel()!=this.channel)&&(re=!0),re||(ee.setTokenIndex(te),this.tokens.push(ee),te++),ee=this.tokenSource.nextToken();this.p=0,this.p=this.skipOffTokenChannels(this.p)},consume:function(){this.p<this.tokens.length&&(this.p++,this.p=this.skipOffTokenChannels(this.p))},skipOffTokenChannels:function(te){for(var ee=this.tokens.length;te<ee&&this.tokens[te].getChannel()!=this.channel;)te++;return te},skipOffTokenChannelsReverse:function(te){for(;te>=0&&this.tokens[te].getChannel()!=this.channel;)te--;return te},setTokenTypeChannel:function(te,ee){this.channelOverrideMap||(this.channelOverrideMap={}),this.channelOverrideMap[te]=ee},discardTokenType:function(te){this.discardSet||(this.discardSet={}),this.discardSet[te]=!0},discardOffChannelTokens:function(te){this.v_discardOffChannelTokens=te},getTokens:function(te,ee,re){if(this.p===-1&&this.fillBuffer(),arguments.length===0)return this.tokens;if(org.antlr.lang.isArray(re)?re=new org.antlr.runtime.BitSet(re):org.antlr.lang.isNumber(re)&&(re=org.antlr.runtime.BitSet.of(re)),ee>=this.tokens.length&&(ee=this.tokens.length-1),te<0&&(te=0),te>ee)return null;var ne=[],ie,se;for(ie=te;ie<=ee;ie++)se=this.tokens[ie],(!this.types||re.member(se.getType()))&&ne.push(se);return ne.length===0&&(ne=null),ne},LT:function(te){if(this.p===-1&&this.fillBuffer(),te===0)return null;if(te<0)return this.LB(-1*te);if(this.p+te-1>=this.tokens.length)return org.antlr.runtime.Token.EOF_TOKEN;for(var ee=this.p,re=1;re<te;)ee=this.skipOffTokenChannels(ee+1),re++;return ee>=this.tokens.length?org.antlr.runtime.Token.EOF_TOKEN:this.tokens[ee]},LB:function(te){if(this.p===-1&&this.fillBuffer(),te===0||this.p-te<0)return null;for(var ee=this.p,re=1;re<=te;)ee=this.skipOffTokenChannelsReverse(ee-1),re++;return ee<0?null:this.tokens[ee]},get:function(te){return this.tokens[te]},LA:function(te){return this.LT(te).getType()},mark:function(){return this.p===-1&&this.fillBuffer(),this.lastMarker=this.index(),this.lastMarker},release:function(te){},size:function(){return this.tokens.length},index:function(){return this.p},rewind:function(te){org.antlr.lang.isNumber(te)||(te=this.lastMarker),this.seek(te)},reset:function(){this.p=-1,this.lastMarker=0},seek:function(te){this.p=te},getTokenSource:function(){return this.tokenSource},getSourceName:function(){return this.getTokenSource().getSourceName()},toString:function(te,ee){if(arguments.length===0&&(this.p===-1&&this.fillBuffer(),te=0,ee=this.tokens.length-1),!org.antlr.lang.isNumber(te)&&!org.antlr.lang.isNumber(ee))if(org.antlr.lang.isValue(te)&&org.antlr.lang.isValue(ee))te=te.getTokenIndex(),ee=ee.getTokenIndex();else return null;var re="",ne;if(te<0||ee<0)return null;for(this.p==-1&&this.fillBuffer(),ee>=this.tokens.length&&(ee=this.tokens.length-1),ne=te;ne<=ee;ne++)t=this.tokens[ne],re=re+this.tokens[ne].getText();return re}};org.antlr.runtime.TokenRewriteStream=function(){var te=org.antlr.runtime.TokenRewriteStream.superclass;this.programs=null,this.lastRewriteTokenIndexes=null,arguments.length===0?this.init():(te.constructor.apply(this,arguments),this.init())};(function(){var te=org.antlr.runtime.TokenRewriteStream;org.antlr.lang.augmentObject(te,{DEFAULT_PROGRAM_NAME:"default",PROGRAM_INIT_SIZE:100,MIN_TOKEN_INDEX:0}),te.RewriteOperation=function(ee,re){this.index=ee,this.text=re},te.RewriteOperation.prototype={execute:function(ee){return this.index},toString:function(){return this.text}},te.InsertBeforeOp=function(ee,re){te.InsertBeforeOp.superclass.constructor.call(this,ee,re)},org.antlr.lang.extend(te.InsertBeforeOp,te.RewriteOperation,{execute:function(ee){return ee.push(this.text),this.index}}),te.ReplaceOp=function(ee,re,ne){te.ReplaceOp.superclass.constructor.call(this,ee,ne),this.lastIndex=re},org.antlr.lang.extend(te.ReplaceOp,te.RewriteOperation,{execute:function(ee){return org.antlr.lang.isValue(this.text)&&ee.push(this.text),this.lastIndex+1}}),te.DeleteOp=function(ee,re){te.DeleteOp.superclass.constructor.call(this,ee,re)},org.antlr.lang.extend(te.DeleteOp,te.ReplaceOp),org.antlr.lang.extend(te,org.antlr.runtime.CommonTokenStream,{init:function(){this.programs={},this.programs[te.DEFAULT_PROGRAM_NAME]=[],this.lastRewriteTokenIndexes={}},rollback:function(){var ee;arguments.length===1?ee=te.DEFAULT_PROGRAM_NAME:arguments.length===2&&(ee=arguments[0]);var re=this.programs[ee];re&&(programs[ee]=re.slice(te.MIN_TOKEN_INDEX,this.instructionIndex))},deleteProgram:function(ee){ee=ee||te.DEFAULT_PROGRAM_NAME,this.rollback(ee,te.MIN_TOKEN_INDEX)},addToSortedRewriteList:function(){var ee,re;arguments.length===1?(ee=te.DEFAULT_PROGRAM_NAME,re=arguments[0]):arguments.length===2&&(ee=arguments[0],re=arguments[1]);var ne=this.getProgram(ee),ie,se,le,ue,ae,oe;for(se=0,ie=ne.length;se<ie;se++)if(le=ne[se],le.index===re.index){if(re instanceof te.ReplaceOp){for(ue=!1,oe=se;oe<ne.length&&(ae=ne[se],ae.index===re.index);oe++)if(ae instanceof te.ReplaceOp){ne[se]=re,ue=!0;break}ue||ne.splice(oe,0,re)}else ne.splice(se,0,re);break}else if(le.index>re.index){ne.splice(se,0,re);break}se===ie&&ne.push(re)},insertAfter:function(){var ee,re,ne;arguments.length===2?(re=te.DEFAULT_PROGRAM_NAME,ee=arguments[0],ne=arguments[1]):arguments.length===3&&(re=arguments[0],ee=arguments[1],ne=arguments[2]),ee instanceof org.antlr.runtime.CommonToken&&(ee=ee.index),this.insertBefore(re,ee+1,ne)},insertBefore:function(){var ee,re,ne;arguments.length===2?(re=te.DEFAULT_PROGRAM_NAME,ee=arguments[0],ne=arguments[1]):arguments.length===3&&(re=arguments[0],ee=arguments[1],ne=arguments[2]),ee instanceof org.antlr.runtime.CommonToken&&(ee=ee.index),this.addToSortedRewriteList(re,new te.InsertBeforeOp(ee,ne))},replace:function(){var ee,re,ne,ie;arguments.length===2?(ee=te.DEFAULT_PROGRAM_NAME,re=arguments[0],ne=arguments[0],ie=arguments[1]):arguments.length===3&&(ee=te.DEFAULT_PROGRAM_NAME,re=arguments[0],ne=arguments[1],ie=arguments[2]),arguments.length===4&&(ee=arguments[0],re=arguments[1],ne=arguments[2],ie=arguments[3]),re instanceof org.antlr.runtime.CommonToken&&(re=re.index),ne instanceof org.antlr.runtime.CommonToken&&(ne=ne.index),!(re>ne||ne<0||re<0)&&this.addToSortedRewriteList(ee,new te.ReplaceOp(re,ne,ie))},remove:function(){for(var ee=[],re=arguments.length-1;re>=0;)ee[re]=arguments[re],re--;ee.push(""),this.replace.apply(this,ee)},getLastRewriteTokenIndex:function(ee){return ee=ee||te.DEFAULT_PROGRAM_NAME,this.lastRewriteTokenIndexes[ee]||-1},setLastRewriteTokenIndex:function(ee,re){this.lastRewriteTokenIndexes[ee]=re},getProgram:function(ee){var re=this.programs[ee];return re||(re=this.initializeProgram(ee)),re},initializeProgram:function(ee){var re=[];return this.programs[ee]=re,re},toOriginalString:function(ee,re){org.antlr.lang.isNumber(ee)||(ee=te.MIN_TOKEN_INDEX),org.antlr.lang.isNumber(re)||(re=this.size()-1);var ne=[],ie;for(ie=ee;ie>=te.MIN_TOKEN_INDEX&&ie<=re&&ie<this.tokens.length;ie++)ne.push(this.get(ie).getText());return ne.join("")},toString:function(){var ee,re,ne;arguments.length===0?(ee=te.DEFAULT_PROGRAM_NAME,re=te.MIN_TOKEN_INDEX,ne=this.size()-1):arguments.length===1?(ee=arguments[0],re=te.MIN_TOKEN_INDEX,ne=this.size()-1):arguments.length===2&&(ee=te.DEFAULT_PROGRAM_NAME,re=arguments[0],ne=arguments[1]);var ie=this.programs[ee];if(!ie||ie.length===0)return this.toOriginalString(re,ne);for(var se=0,le=re,ue=[],ae;le>=te.MIN_TOKEN_INDEX&&le<=ne&&le<this.tokens.length;){if(se<ie.length){for(ae=ie[se];ae.index<le&&se<ie.length;)se++,se<ie.length&&(ae=ie[se]);for(;le===ae.index&&se<ie.length;)le=ae.execute(ue),se++,se<ie.length&&(ae=ie[se])}le<=ne&&(ue.push(this.get(le).getText()),le++)}var oe;for(oe=se;oe<ie.length;oe++)ae=ie[oe],ae.index>=this.size()&&ae.execute(ue);return ue.join("")},toDebugString:function(ee,re){org.antlr.lang.isNumber(ee)||(ee=te.MIN_TOKEN_INDEX),org.antlr.lang.isNumber(re)||(re=this.size()-1);var ne=[],ie;for(ie=ee;ie>=te.MIN_TOKEN_INDEX&&ie<=re&&ie<this.tokens.length;ie++)ne.push(this.get(ie));return ne.join("")}})})();org.antlr.runtime.tree.TreeNodeStream=function(){};org.antlr.runtime.tree.CommonTreeNodeStream=function(te,ee,re){arguments.length===1&&(ee=te,te=new org.antlr.runtime.tree.CommonTreeAdaptor),arguments.length<=2&&(re=org.antlr.runtime.tree.CommonTreeNodeStream.DEFAULT_INITIAL_BUFFER_SIZE),this.uniqueNavigationNodes=!1,this.p=-1;var ne=org.antlr.runtime.Token;this.root=ee,this.adaptor=te,this.nodes=[],this.down=this.adaptor.create(ne.DOWN,"DOWN"),this.up=this.adaptor.create(ne.UP,"UP"),this.eof=this.adaptor.create(ne.EOF,"EOF")};org.antlr.lang.augmentObject(org.antlr.runtime.tree.CommonTreeNodeStream,{DEFAULT_INITIAL_BUFFER_SIZE:100,INITIAL_CALL_STACK_SIZE:10});org.antlr.lang.extend(org.antlr.runtime.tree.CommonTreeNodeStream,org.antlr.runtime.tree.TreeNodeStream,{StreamIterator:function(){var te=0,ee=this.nodes,re=this.eof;return{hasNext:function(){return te<ee.length},next:function(){var ne=te;return te++,ne<ee.length?ee[ne]:re},remove:function(){throw new Error("cannot remove nodes from stream")}}},fillBuffer:function(te){var ee=!1;org.antlr.lang.isUndefined(te)&&(te=this.root,ee=!0);var re=this.adaptor.isNil(te);re||this.nodes.push(te);var ne=this.adaptor.getChildCount(te);!re&&ne>0&&this.addNavigationNode(org.antlr.runtime.Token.DOWN);var ie,se;for(ie=0;ie<ne;ie++)se=this.adaptor.getChild(te,ie),this.fillBuffer(se);!re&&ne>0&&this.addNavigationNode(org.antlr.runtime.Token.UP),ee&&(this.p=0)},getNodeIndex:function(te){this.p==-1&&this.fillBuffer();var ee,re;for(ee=0;ee<this.nodes.length;ee++)if(re=this.nodes[ee],re===te)return ee;return-1},addNavigationNode:function(te){var ee=null;te===org.antlr.runtime.Token.DOWN?this.hasUniqueNavigationNodes()?ee=this.adaptor.create(org.antlr.runtime.Token.DOWN,"DOWN"):ee=this.down:this.hasUniqueNavigationNodes()?ee=this.adaptor.create(org.antlr.runtime.Token.UP,"UP"):ee=this.up,this.nodes.push(ee)},get:function(te){return this.p===-1&&this.fillBuffer(),this.nodes[te]},LT:function(te){return this.p===-1&&this.fillBuffer(),te===0?null:te<0?this.LB(-1*te):this.p+te-1>=this.nodes.length?this.eof:this.nodes[this.p+te-1]},getCurrentSymbol:function(){return this.LT(1)},LB:function(te){return te===0||this.p-te<0?null:this.nodes[this.p-te]},getTreeSource:function(){return this.root},getSourceName:function(){return this.getTokenStream().getSourceName()},getTokenStream:function(){return this.tokens},setTokenStream:function(te){this.tokens=te},getTreeAdaptor:function(){return this.adaptor},setTreeAdaptor:function(te){this.adaptor=te},hasUniqueNavigationNodes:function(){return this.uniqueNavigationNodes},setUniqueNavigationNodes:function(te){this.uniqueNavigationNodes=te},consume:function(){this.p===-1&&this.fillBuffer(),this.p++},LA:function(te){return this.adaptor.getType(this.LT(te))},mark:function(){return this.p===-1&&this.fillBuffer(),this.lastMarker=this.index(),this.lastMarker},release:function(te){},index:function(){return this.p},rewind:function(te){org.antlr.lang.isNumber(te)||(te=this.lastMarker),this.seek(te)},seek:function(te){this.p===-1&&this.fillBuffer(),this.p=te},push:function(te){this.calls||(this.calls=[]),this.calls.push(this.p),this.seek(te)},pop:function(){var te=this.calls.pop();return this.seek(te),te},reset:function(){this.p=-1,this.lastMarker=0,this.calls&&(this.calls=[])},size:function(){return this.p===-1&&this.fillBuffer(),this.nodes.length},iterator:function(){return this.p===-1&&this.fillBuffer(),this.StreamIterator()},replaceChildren:function(te,ee,re,ne){te&&this.adaptor.replaceChildren(te,ee,re,ne)},toTokenString:function(te,ee){this.p===-1&&this.fillBuffer();var re="",ne,ie;for(ne=te;ne<this.nodes.length&&ne<=ee;ne++)ie=this.nodes[ne],re+=" "+this.adaptor.getToken(ie);return re},toString:function(te,ee){var re="",ne,ie,se;if(arguments.length===0){for(this.p===-1&&this.fillBuffer(),se=0;se<this.nodes.length;se++)ie=this.nodes[se],re+=" ",re+=this.adaptor.getType(ie);return re}else{if(!org.antlr.lang.isNumber(te)||!org.antlr.lang.isNumber(ee))return null;this.p===-1&&this.fillBuffer(),te instanceof org.antlr.runtime.tree.CommonTree,ee instanceof org.antlr.runtime.tree.CommonTree;var le,ue;if(this.tokens)return le=this.adaptor.getTokenStartIndex(te),ue=this.adaptor.getTokenStopIndex(ee),this.adaptor.getType(ee)===org.antlr.runtime.Token.UP?ue=this.adaptor.getTokenStopIndex(te):this.adaptor.getType(ee)==org.antlr.runtime.Token.EOF&&(ue=this.size()-2),this.tokens.toString(le,ue);for(ie=null,se=0;se<this.nodes.length&&(ie=this.nodes[se],ie!==te);se++);for(re=ne="",ie=this.nodes[se];ie!==ee;)ne=this.adaptor.getText(ie),org.antlr.lang.isString(ne)||(ne=" "+this.adaptor.getType(ie).toString()),re+=ne,se++,ie=nodes[se];return ne=this.adaptor.getText(ee),org.antlr.lang.isString(ne)||(ne=" "+this.adaptor.getType(ee).toString()),re+=ne,re}}});org.antlr.runtime.tree.RewriteRuleElementStream=function(te,ee,re){this.cursor=0,this.dirty=!1,this.elementDescription=ee,this.adaptor=te,re&&(org.antlr.lang.isArray(re)?(this.singleElement=null,this.elements=re):this.add(re))};org.antlr.runtime.tree.RewriteRuleElementStream.prototype={reset:function(){this.cursor=0,this.dirty=!0},add:function(te){if(org.antlr.lang.isValue(te)){if(this.elements){this.elements.push(te);return}if(!org.antlr.lang.isValue(this.singleElement)){this.singleElement=te;return}this.elements=[],this.elements.push(this.singleElement),this.singleElement=null,this.elements.push(te)}},nextTree:function(){var te=this.size(),ee;return this.dirty||this.cursor>=te&&te==1?(ee=this._next(),this.dup(ee)):(ee=this._next(),ee)},_next:function(){var te=this.size();if(te===0)throw new org.antlr.runtime.tree.RewriteEmptyStreamException(this.elementDescription);if(this.cursor>=te){if(te===1)return this.toTree(this.singleElement);throw new org.antlr.runtime.tree.RewriteCardinalityException(this.elementDescription)}if(org.antlr.lang.isValue(this.singleElement))return this.cursor++,this.toTree(this.singleElement);var ee=this.toTree(this.elements[this.cursor]);return this.cursor++,ee},toTree:function(te){return te&&te.getTree?te.getTree():te},hasNext:function(){return org.antlr.lang.isValue(this.singleElement)&&this.cursor<1||this.elements&&this.cursor<this.elements.length},size:function(){var te=0;return org.antlr.lang.isValue(this.singleElement)&&(te=1),this.elements?this.elements.length:te},getDescription:function(){return this.elementDescription}};org.antlr.runtime.tree.RewriteRuleNodeStream=function(te,ee,re){org.antlr.runtime.tree.RewriteRuleNodeStream.superclass.constructor.apply(this,arguments)};org.antlr.lang.extend(org.antlr.runtime.tree.RewriteRuleNodeStream,org.antlr.runtime.tree.RewriteRuleElementStream,{nextNode:function(){return this._next()},toTree:function(te){return this.adaptor.dupNode(te)},dup:function(){throw new Error("dup can't be called for a node stream.")}});org.antlr.runtime.tree.RewriteRuleTokenStream=function(te,ee,re){var ne=org.antlr.runtime.tree.RewriteRuleTokenStream.superclass;ne.constructor.apply(this,arguments)};org.antlr.lang.extend(org.antlr.runtime.tree.RewriteRuleTokenStream,org.antlr.runtime.tree.RewriteRuleElementStream,{nextNode:function(){var te=this._next();return this.adaptor.create(te)},nextToken:function(){return this._next()},toTree:function(te){return te},dup:function(te){throw new Error("dup can't be called for a token stream.")}});org.antlr.runtime.tree.RewriteRuleSubtreeStream=function(){var te=org.antlr.runtime.tree.RewriteRuleSubtreeStream.superclass;te.constructor.apply(this,arguments)};org.antlr.lang.extend(org.antlr.runtime.tree.RewriteRuleSubtreeStream,org.antlr.runtime.tree.RewriteRuleElementStream,{nextNode:function(){var te=this.size(),ee;return this.dirty||this.cursor>=te&&te===1?(ee=this._next(),this.adaptor.dupNode(ee)):(ee=this._next(),ee)},dup:function(te){return this.adaptor.dupTree(te)}});org.antlr.runtime.BaseRecognizer=function(te){this.state=te||new org.antlr.runtime.RecognizerSharedState};org.antlr.lang.augmentObject(org.antlr.runtime.BaseRecognizer,{MEMO_RULE_FAILED:-2,MEMO_RULE_UNKNOWN:-1,INITIAL_FOLLOW_STACK_SIZE:100,MEMO_RULE_FAILED_I:-2,DEFAULT_TOKEN_CHANNEL:org.antlr.runtime.Token.DEFAULT_CHANNEL,HIDDEN:org.antlr.runtime.Token.HIDDEN_CHANNEL,NEXT_TOKEN_RULE_NAME:"nextToken"});org.antlr.runtime.BaseRecognizer.prototype={reset:function(){var te,ee;if(this.state&&(this.state._fsp=-1,this.state.errorRecovery=!1,this.state.lastErrorIndex=-1,this.state.failed=!1,this.state.syntaxErrors=0,this.state.backtracking=0,this.state.ruleMemo))for(te=0,ee=this.state.ruleMemo.length;te<ee;te++)this.state.ruleMemo[te]=null},match:function(te,ee,re){var ne=this.getCurrentInputSymbol(te);return te.LA(1)===ee?(te.consume(),this.state.errorRecovery=!1,this.state.failed=!1,ne):this.state.backtracking>0?(this.state.failed=!0,ne):(ne=this.recoverFromMismatchedToken(te,ee,re),ne)},matchAny:function(te){this.state.errorRecovery=!1,this.state.failed=!1,te.consume()},mismatchIsUnwantedToken:function(te,ee){return te.LA(2)===ee},mismatchIsMissingToken:function(te,ee){return ee?(ee.member(org.antlr.runtime.Token.EOR_TOKEN_TYPE)&&(this.state._fsp>=0&&ee.remove(org.antlr.runtime.Token.EOR_TOKEN_TYPE),this.computeContextSensitiveRuleFOLLOW(),ee=ee.or(this.viableTokensFollowingThisRule)),!!(ee.member(te.LA(1))||ee.member(org.antlr.runtime.Token.EOR_TOKEN_TYPE))):!1},mismatch:function(te,ee,re){throw this.mismatchIsUnwantedToken(te,ee)?new org.antlr.runtime.UnwantedTokenException(ee,te):this.mismatchIsMissingToken(te,re)?new org.antlr.runtime.MissingTokenException(ee,te,null):new org.antlr.runtime.MismatchedTokenException(ee,te)},reportError:function(te){this.state.errorRecovery||(this.state.syntaxErrors++,this.state.errorRecovery=!0,this.displayRecognitionError(this.getTokenNames(),te))},displayRecognitionError:function(te,ee){var re=this.getErrorHeader(ee),ne=this.getErrorMessage(ee,te);this.emitErrorMessage(re+" "+ne)},getErrorHeader:function(te){return org.antlr.lang.isNumber(te.line)||(te.line=0),"line "+te.line+":"+te.charPositionInLine},emitErrorMessage:function(te){typeof window<"u"&&window.alert?alert(te):print(te)},getErrorMessage:function(te,ee){var re=te&&te.getMessage?te.getMessage():null,ne,ie;if(te instanceof org.antlr.runtime.UnwantedTokenException){var se=te;ie="<unknown>",se.expecting==org.antlr.runtime.Token.EOF?ie="EOF":ie=ee[se.expecting],re="extraneous input "+this.getTokenErrorDisplay(se.getUnexpectedToken())+" expecting "+ie}else te instanceof org.antlr.runtime.MissingTokenException?(ne=te,ie="<unknown>",ne.expecting==org.antlr.runtime.Token.EOF?ie="EOF":ie=ee[ne.expecting],re="missing "+ie+" at "+this.getTokenErrorDisplay(te.token)):te instanceof org.antlr.runtime.MismatchedTokenException?(ne=te,ie="<unknown>",ne.expecting==org.antlr.runtime.Token.EOF?ie="EOF":ie=ee[ne.expecting],re="mismatched input "+this.getTokenErrorDisplay(te.token)+" expecting "+ie):te instanceof org.antlr.runtime.NoViableAltException?re="no viable alternative at input "+this.getTokenErrorDisplay(te.token):te instanceof org.antlr.runtime.EarlyExitException?re="required (...)+ loop did not match anything at input "+this.getTokenErrorDisplay(te.token):te instanceof org.antlr.runtime.MismatchedSetException?re="mismatched input "+this.getTokenErrorDisplay(te.token)+" expecting set "+te.expecting:te instanceof org.antlr.runtime.MismatchedNotSetException?re="mismatched input "+this.getTokenErrorDisplay(te.token)+" expecting set "+te.expecting:te instanceof org.antlr.runtime.FailedPredicateException&&(re="rule "+te.ruleName+" failed predicate: {"+te.predicateText+"}?");return re},getNumberOfSyntaxErrors:function(){return this.state.syntaxErrors},getTokenErrorDisplay:function(te){var ee=te.getText();return org.antlr.lang.isValue(ee)||(te.getType()==org.antlr.runtime.Token.EOF?ee="<EOF>":ee="<"+te.getType()+">"),ee=ee.replace(/\n/g,"\\n"),ee=ee.replace(/\r/g,"\\r"),ee=ee.replace(/\t/g,"\\t"),"'"+ee+"'"},recover:function(te,ee){this.state.lastErrorIndex==te.index()&&te.consume(),this.state.lastErrorIndex=te.index();var re=this.computeErrorRecoverySet();this.beginResync(),this.consumeUntil(te,re),this.endResync()},beginResync:function(){},endResync:function(){},computeErrorRecoverySet:function(){return this.combineFollows(!1)},computeContextSensitiveRuleFOLLOW:function(){return this.combineFollows(!0)},combineFollows:function(te){var ee=this.state._fsp,re,ne,ie=new org.antlr.runtime.BitSet;for(re=ee;re>=0;re--)if(ne=this.state.following[re],ie.orInPlace(ne),te)if(ne.member(org.antlr.runtime.Token.EOR_TOKEN_TYPE))re>0&&ie.remove(org.antlr.runtime.Token.EOR_TOKEN_TYPE);else break;return ie},recoverFromMismatchedToken:function(te,ee,re){var ne=null;if(this.mismatchIsUnwantedToken(te,ee)){ne=new org.antlr.runtime.UnwantedTokenException(ee,te),this.beginResync(),te.consume(),this.endResync(),this.reportError(ne);var ie=this.getCurrentInputSymbol(te);return te.consume(),ie}if(this.mismatchIsMissingToken(te,re)){var se=this.getMissingSymbol(te,ne,ee,re);return ne=new org.antlr.runtime.MissingTokenException(ee,te,se),this.reportError(ne),se}throw ne=new org.antlr.runtime.MismatchedTokenException(ee,te),ne},recoverFromMismatchedSet:function(te,ee,re){if(this.mismatchIsMissingToken(te,re))return this.reportError(ee),this.getMissingSymbol(te,ee,org.antlr.runtime.Token.INVALID_TOKEN_TYPE,re);throw ee},getCurrentInputSymbol:function(te){return null},getMissingSymbol:function(te,ee,re,ne){return null},consumeUntil:function(te,ee){for(var re=te.LA(1);re!=org.antlr.runtime.Token.EOF&&!ee.member(re);)te.consume(),re=te.LA(1)},pushFollow:function(te){if(this.state._fsp+1>=this.state.following.length){var ee=[],re;for(re=this.state.following.length-1;re>=0;re--)ee[re]=this.state.following[re];this.state.following=ee}this.state._fsp++,this.state.following[this.state._fsp]=te},getRuleInvocationStack:function(te,ee){throw new Error("Not implemented.")},getBacktrackingLevel:function(){return this.state.backtracking},getTokenNames:function(){return null},getGrammarFileName:function(){return null},toStrings:function(te){if(!te)return null;var ee=[],re;for(re=0;re<te.length;re++)ee.push(te[re].getText());return ee},getRuleMemoization:function(te,ee){this.state.ruleMemo[te]||(this.state.ruleMemo[te]={});var re=this.state.ruleMemo[te][ee];return org.antlr.lang.isNumber(re)?re:org.antlr.runtime.BaseRecognizer.MEMO_RULE_UNKNOWN},alreadyParsedRule:function(te,ee){var re=this.getRuleMemoization(ee,te.index());return re==org.antlr.runtime.BaseRecognizer.MEMO_RULE_UNKNOWN?!1:(re==org.antlr.runtime.BaseRecognizer.MEMO_RULE_FAILED?this.state.failed=!0:te.seek(re+1),!0)},memoize:function(te,ee,re){var ne=this.state.failed?org.antlr.runtime.BaseRecognizer.MEMO_RULE_FAILED:te.index()-1;if(!org.antlr.lang.isValue(this.state.ruleMemo))throw new Error("!!!!!!!!! memo array is null for "+this.getGrammarFileName());if(ee>=this.state.ruleMemo.length)throw new Error("!!!!!!!!! memo size is "+this.state.ruleMemo.length+", but rule index is "+ee);org.antlr.lang.isValue(this.state.ruleMemo[ee])&&(this.state.ruleMemo[ee][re]=ne)},getRuleMemoizationCacheSize:function(){var te=0,ee;for(ee=0;this.state.ruleMemo&&ee<this.state.ruleMemo.length;ee++){var re=this.state.ruleMemo[ee];re&&(te+=re.length)}return te},traceIn:function(te,ee,re){this.emitErrorMessage("enter "+te+" "+re),this.state.failed&&this.emitErrorMessage(" failed="+this.failed),this.state.backtracking>0&&this.emitErrorMessage(" backtracking="+this.state.backtracking)},traceOut:function(te,ee,re){this.emitErrorMessage("exit "+te+" "+re),this.state.failed&&this.emitErrorMessage(" failed="+this.state.failed),this.state.backtracking>0&&this.emitErrorMessage(" backtracking="+this.state.backtracking)}};org.antlr.runtime.Lexer=function(te,ee){ee&&org.antlr.runtime.Lexer.superclass.constructor.call(this,ee),te&&(this.input=te)};org.antlr.lang.extend(org.antlr.runtime.Lexer,org.antlr.runtime.BaseRecognizer,{reset:function(){org.antlr.runtime.Lexer.superclass.reset.call(this),org.antlr.lang.isValue(this.input)&&this.input.seek(0),org.antlr.lang.isValue(this.state)&&(this.state.token=null,this.state.type=org.antlr.runtime.Token.INVALID_TOKEN_TYPE,this.state.channel=org.antlr.runtime.Token.DEFAULT_CHANNEL,this.state.tokenStartCharIndex=-1,this.state.tokenStartCharPositionInLine=-1,this.state.tokenStartLine=-1,this.state.text=null)},nextToken:function(){for(;;){if(this.state.token=null,this.state.channel=org.antlr.runtime.Token.DEFAULT_CHANNEL,this.state.tokenStartCharIndex=this.input.index(),this.state.tokenStartCharPositionInLine=this.input.getCharPositionInLine(),this.state.tokenStartLine=this.input.getLine(),this.state.text=null,this.input.LA(1)===org.antlr.runtime.CharStream.EOF)return org.antlr.runtime.Token.EOF_TOKEN;try{if(this.mTokens(),!org.antlr.lang.isValue(this.state.token))this.emit();else if(this.state.token==org.antlr.runtime.Token.SKIP_TOKEN)continue;return this.state.token}catch(te){if(te instanceof org.antlr.runtime.RecognitionException)this.reportError(te);else if(te instanceof org.antlr.runtime.NoViableAltException)this.reportError(te),this.recover(te);else throw te}}},skip:function(){this.state.token=org.antlr.runtime.Token.SKIP_TOKEN},setCharStream:function(te){this.input=null,this.reset(),this.input=te},getCharStream:function(){return this.input},getSourceName:function(){return this.input.getSourceName()},emit:function(){if(arguments.length===0){var te=new org.antlr.runtime.CommonToken(this.input,this.state.type,this.state.channel,this.state.tokenStartCharIndex,this.getCharIndex()-1);return te.setLine(this.state.tokenStartLine),te.setText(this.state.text),te.setCharPositionInLine(this.state.tokenStartCharPositionInLine),this.state.token=te,te}else this.state.token=arguments[0]},match:function(te){var ee=0,re;if(org.antlr.lang.isString(te))for(;ee<te.length;){if(this.input.LA(1)!=te.charAt(ee)){if(this.state.backtracking>0){this.state.failed=!0;return}throw re=new org.antlr.runtime.MismatchedTokenException(te.charAt(ee),this.input),this.recover(re),re}ee++,this.input.consume(),this.state.failed=!1}else if(org.antlr.lang.isNumber(te)){if(this.input.LA(1)!=te){if(this.state.backtracking>0){this.state.failed=!0;return}throw re=new org.antlr.runtime.MismatchedTokenException(te,this.input),this.recover(re),re}this.input.consume(),this.state.failed=!1}},matchAny:function(){this.input.consume()},matchRange:function(te,ee){if(this.input.LA(1)<te||this.input.LA(1)>ee){if(this.state.backtracking>0){this.state.failed=!0;return}throw mre=new org.antlr.runtime.MismatchedRangeException(te,ee,this.input),this.recover(mre),mre}this.input.consume(),this.state.failed=!1},getLine:function(){return this.input.getLine()},getCharPositionInLine:function(){return this.input.getCharPositionInLine()},getCharIndex:function(){return this.input.index()},getText:function(){return org.antlr.lang.isString(this.state.text)?this.state.text:this.input.substring(this.state.tokenStartCharIndex,this.getCharIndex()-1)},setText:function(te){this.state.text=te},reportError:function(te){this.displayRecognitionError(this.getTokenNames(),te)},getErrorMessage:function(te,ee){var re=null;return te instanceof org.antlr.runtime.MismatchedTokenException?re="mismatched character "+this.getCharErrorDisplay(te.c)+" expecting "+this.getCharErrorDisplay(te.expecting):te instanceof org.antlr.runtime.NoViableAltException?re="no viable alternative at character "+this.getCharErrorDisplay(te.c):te instanceof org.antlr.runtime.EarlyExitException?re="required (...)+ loop did not match anything at character "+this.getCharErrorDisplay(te.c):te instanceof org.antlr.runtime.MismatchedNotSetException?re="mismatched character "+this.getCharErrorDisplay(te.c)+" expecting set "+te.expecting:te instanceof org.antlr.runtime.MismatchedSetException?re="mismatched character "+this.getCharErrorDisplay(te.c)+" expecting set "+te.expecting:te instanceof org.antlr.runtime.MismatchedRangeException?re="mismatched character "+this.getCharErrorDisplay(te.c)+" expecting set "+this.getCharErrorDisplay(te.a)+".."+this.getCharErrorDisplay(te.b):re=org.antlr.runtime.Lexer.superclass.getErrorMessage.call(this,te,ee),re},getCharErrorDisplay:function(te){var ee=te;switch(ee){case org.antlr.runtime.Token.EOF:ee="<EOF>";break;case`
`:ee="\\n";break;case"	":ee="\\t";break;case"\r":ee="\\r";break}return"'"+ee+"'"},recover:function(te){this.input.consume()},traceIn:function(te,ee){var re=String.fromCharCode(this.input.LT(1))+" line="+this.getLine()+":"+this.getCharPositionInLine();org.antlr.runtime.Lexer.superclass.traceIn.call(this,te,ee,re)},traceOut:function(te,ee){var re=String.fromCharCode(this.input.LT(1))+" line="+this.getLine()+":"+this.getCharPositionInLine();org.antlr.runtime.Lexer.superclass.traceOut.call(this,te,ee,re)}});org.antlr.runtime.ParserRuleReturnScope=function(){};org.antlr.runtime.ParserRuleReturnScope.prototype={getStart:function(){return this.start},getStop:function(){return this.stop}};org.antlr.runtime.tree.TreeRuleReturnScope=function(){};org.antlr.runtime.tree.TreeRuleReturnScope.prototype={getStart:function(){return this.start}};org.antlr.runtime.Parser=function(te,ee){org.antlr.runtime.Parser.superclass.constructor.call(this,ee),this.setTokenStream(te)};org.antlr.lang.extend(org.antlr.runtime.Parser,org.antlr.runtime.BaseRecognizer,{reset:function(){org.antlr.runtime.Parser.superclass.reset.call(this),org.antlr.lang.isValue(this.input)&&this.input.seek(0)},getCurrentInputSymbol:function(te){return te.LT(1)},getMissingSymbol:function(te,ee,re,ne){var ie="<missing "+this.getTokenNames()[re]+">",se=new org.antlr.runtime.CommonToken(re,ie),le=te.LT(1),ue;return le.getType()===org.antlr.runtime.Token.EOF&&(ue=le,le=te.LT(-1),le||(le=ue)),se.line=le.getLine(),se.charPositionInLine=le.getCharPositionInLine(),se.channel=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,se},setTokenStream:function(te){this.input=null,this.reset(),this.input=te},getTokenStream:function(){return this.input},getSourceName:function(){return this.input.getSourceName()},traceIn:function(te,ee){org.antlr.runtime.Parser.superclass.traceIn.call(this,te,ee,this.input.LT(1))},traceOut:function(te,ee){org.antlr.runtime.Parser.superclass.traceOut.call(this,te,ee,this.input.LT(1))}});org.antlr.runtime.DFA=function(){};org.antlr.runtime.DFA.prototype={predict:function(te){var ee=te.mark(),re=0,ne,ie,se;try{for(;;){if(ne=this.special[re],ne>=0){if(re=this.specialStateTransition(ne,te),re===-1)return this.noViableAlt(re,te),0;te.consume();continue}if(this.accept[re]>=1)return this.accept[re];if(ie=te.LA(1),ie===org.antlr.runtime.Token.EOF?ie=-1:org.antlr.lang.isString(ie)&&(ie=ie.charCodeAt(0)),ie>=this.min[re]&&ie<=this.max[re]){if(se=this.transition[re][ie-this.min[re]],se<0){if(this.eot[re]>=0){re=this.eot[re],te.consume();continue}return this.noViableAlt(re,te),0}re=se,te.consume();continue}if(this.eot[re]>=0){re=this.eot[re],te.consume();continue}return ie==org.antlr.runtime.Token.EOF&&this.eof[re]>=0?this.accept[this.eof[re]]:(this.noViableAlt(re,te),0)}}finally{te.rewind(ee)}},noViableAlt:function(te,ee){if(this.recognizer.state.backtracking>0){this.recognizer.state.failed=!0;return}var re=new org.antlr.runtime.NoViableAltException(this.getDescription(),this.decisionNumber,te,ee);throw this.error(re),re},error:function(te){throw new ModelError("Invalid equation syntax",{code:9e3})},specialStateTransition:function(te,ee){return-1},getDescription:function(){return"n/a"}};org.antlr.lang.augmentObject(org.antlr.runtime.DFA,{unpackEncodedString:function(te){var ee,re=[],ne=0,ie,se,le;for(ee=0;ee<te.length;ee+=2)for(ie=te.charCodeAt(ee),se=te.charCodeAt(ee+1),se===65535&&(se=-1),le=1;le<=ie;le++)re[ne++]=se;return re},unpackEncodedStringToUnsignedChars:function(te){return org.antlr.runtime.DFA.unpackEncodedString(te)}});org.antlr.runtime.tree.TreeParser=function(te){org.antlr.runtime.tree.TreeParser.superclass.constructor.call(this,arguments[1]),this.setTreeNodeStream(te)};(function(){var te=org.antlr.runtime.tree.TreeParser;org.antlr.lang.augmentObject(te,{DOWN:org.antlr.runtime.Token.DOWN,UP:org.antlr.runtime.Token.UP}),org.antlr.lang.extend(te,org.antlr.runtime.BaseRecognizer,{reset:function(){te.superclass.reset.call(this),this.input&&this.input.seek(0)},setTreeNodeStream:function(ee){this.input=ee},getTreeNodeStream:function(){return this.input},getSourceName:function(){return this.input.getSourceName()},getCurrentInputSymbol:function(ee){return ee.LT(1)},getMissingSymbol:function(ee,re,ne,ie){var se="<missing "+this.getTokenNames()[ne]+">";return new org.antlr.runtime.tree.CommonTree(new org.antlr.runtime.CommonToken(ne,se))},matchAny:function(ee){this.state.errorRecovery=!1,this.state.failed=!1;var re=this.input.LT(1);if(this.input.getTreeAdaptor().getChildCount(re)===0){this.input.consume();return}for(var ne=0,ie=this.input.getTreeAdaptor().getType(re);ie!==org.antlr.runtime.Token.EOF&&!(ie===te.UP&&ne===0);)this.input.consume(),re=this.input.LT(1),ie=this.input.getTreeAdaptor().getType(re),ie===te.DOWN?ne++:ie===te.UP&&ne--;this.input.consume()},mismatch:function(ee,re,ne){throw new org.antlr.runtime.MismatchedTreeNodeException(re,ee)},getErrorHeader:function(ee){return this.getGrammarFileName()+": node from "+(ee.approximateLineInfo?"after ":"")+"line "+ee.line+":"+ee.charPositionInLine},getErrorMessage:function(ee,re){var ne;return this instanceof te&&(ne=ee.input.getTreeAdaptor(),ee.token=ne.getToken(ee.node),org.antlr.lang.isValue(ee.token)||(ee.token=new org.antlr.runtime.CommonToken(ne.getType(ee.node),ne.getText(ee.node)))),te.superclass.getErrorMessage.call(this,ee,re)},traceIn:function(ee,re){te.superclass.traceIn.call(this,ee,re,this.input.LT(1))},traceOut:function(ee,re){te.superclass.traceOut.call(this,ee,re,this.input.LT(1))}})})();function FormulaLexer(te,ee){ee||(ee=new org.antlr.runtime.RecognizerSharedState),function(){}.call(this),this.dfa30=new FormulaLexer.DFA30(this),FormulaLexer.superclass.constructor.call(this,te,ee)}org.antlr.lang.augmentObject(FormulaLexer,{EOF:-1,T__113:113,T__114:114,T__115:115,T__116:116,NEGATE:4,ASSIGN:5,FUNCALL:6,MATERIAL:7,UNIT:8,POWER:9,DEFAULTS:10,PARAMS:11,UNITCLUMP:12,ARRAY:13,LINES:14,WHILE:15,IFTHENELSE:16,ELSE:17,FOR:18,FORIN:19,FUNCTION:20,ANONFUNCTION:21,NUMBER:22,LABEL:23,RANGE:24,INNER:25,ASSIGNED:26,SELECTOR:27,DOTSELECTOR:28,NEW:29,TRYCATCH:30,THROW:31,NEWLINE:32,W:33,H:34,I:35,L:36,E:37,WHILESTATEMENT:38,F:39,O:40,R:41,FORSTATEMENT:42,M:43,FROMSTATEMENT:44,N:45,INSTATEMENT:46,T:47,TOSTATEMENT:48,B:49,Y:50,BYSTATEMENT:51,P:52,LOOPSTATEMENT:53,IFSTATEMENT:54,THENSTATEMENT:55,S:56,ELSESTATEMENT:57,U:58,C:59,FUNCTIONSTATEMENT:60,D:61,ENDBLOCK:62,RETURNSTATEMENT:63,NEWSTATEMENT:64,TRYSTATEMENT:65,A:66,CATCHSTATEMENT:67,THROWSTATEMENT:68,IDENT:69,EQUALS:70,PRIMITIVE:71,OR:72,XOR:73,X:74,AND:75,NOTEQUALS:76,LT:77,LTEQ:78,GT:79,GTEQ:80,PLUS:81,MINUS:82,MULT:83,DIV:84,MOD:85,COLON:86,POW:87,NOT:88,LARR:89,RARR:90,LCURL:91,RCURL:92,COMMA:93,STRING:94,INTEGER:95,FLOAT:96,TRUE:97,FALSE:98,PER:99,CUBED:100,SQUARED:101,Q:102,LBRACKET:103,RBRACKET:104,COMMENT:105,LINE_COMMENT:106,WS:107,G:108,J:109,K:110,V:111,Z:112});(function(){var te=org.antlr.runtime.Token.HIDDEN_CHANNEL;org.antlr.runtime.Token.EOF,org.antlr.lang.extend(FormulaLexer,org.antlr.runtime.Lexer,{EOF:-1,T__113:113,T__114:114,T__115:115,T__116:116,NEGATE:4,ASSIGN:5,FUNCALL:6,MATERIAL:7,UNIT:8,POWER:9,DEFAULTS:10,PARAMS:11,UNITCLUMP:12,ARRAY:13,LINES:14,WHILE:15,IFTHENELSE:16,ELSE:17,FOR:18,FORIN:19,FUNCTION:20,ANONFUNCTION:21,NUMBER:22,LABEL:23,RANGE:24,INNER:25,ASSIGNED:26,SELECTOR:27,DOTSELECTOR:28,NEW:29,TRYCATCH:30,THROW:31,NEWLINE:32,W:33,H:34,I:35,L:36,E:37,WHILESTATEMENT:38,F:39,O:40,R:41,FORSTATEMENT:42,M:43,FROMSTATEMENT:44,N:45,INSTATEMENT:46,T:47,TOSTATEMENT:48,B:49,Y:50,BYSTATEMENT:51,P:52,LOOPSTATEMENT:53,IFSTATEMENT:54,THENSTATEMENT:55,S:56,ELSESTATEMENT:57,U:58,C:59,FUNCTIONSTATEMENT:60,D:61,ENDBLOCK:62,RETURNSTATEMENT:63,NEWSTATEMENT:64,TRYSTATEMENT:65,A:66,CATCHSTATEMENT:67,THROWSTATEMENT:68,IDENT:69,EQUALS:70,PRIMITIVE:71,OR:72,XOR:73,X:74,AND:75,NOTEQUALS:76,LT:77,LTEQ:78,GT:79,GTEQ:80,PLUS:81,MINUS:82,MULT:83,DIV:84,MOD:85,COLON:86,POW:87,NOT:88,LARR:89,RARR:90,LCURL:91,RCURL:92,COMMA:93,STRING:94,INTEGER:95,FLOAT:96,TRUE:97,FALSE:98,PER:99,CUBED:100,SQUARED:101,Q:102,LBRACKET:103,RBRACKET:104,COMMENT:105,LINE_COMMENT:106,WS:107,G:108,J:109,K:110,V:111,Z:112,getGrammarFileName:function(){return"/Library/WebServer/Documents/calc/Formula.g"}}),org.antlr.lang.augmentObject(FormulaLexer.prototype,{mT__113:function(){try{var ee=this.T__113,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("("),this.state.type=ee,this.state.channel=re}finally{}},mT__114:function(){try{var ee=this.T__114,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match(")"),this.state.type=ee,this.state.channel=re}finally{}},mT__115:function(){try{var ee=this.T__115,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("<-"),this.state.type=ee,this.state.channel=re}finally{}},mT__116:function(){try{var ee=this.T__116,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("."),this.state.type=ee,this.state.channel=re}finally{}},mNEWLINE:function(){try{var ee=this.NEWLINE,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,ne=2,ie=this.input.LA(1);switch(ie=="\r"&&(ne=1),ne){case 1:this.match("\r");break}this.match(`
`),this.state.type=ee,this.state.channel=re}finally{}},mWHILESTATEMENT:function(){try{var ee=this.WHILESTATEMENT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mW(),this.mH(),this.mI(),this.mL(),this.mE(),this.state.type=ee,this.state.channel=re}finally{}},mFORSTATEMENT:function(){try{var ee=this.FORSTATEMENT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mF(),this.mO(),this.mR(),this.state.type=ee,this.state.channel=re}finally{}},mFROMSTATEMENT:function(){try{var ee=this.FROMSTATEMENT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mF(),this.mR(),this.mO(),this.mM(),this.state.type=ee,this.state.channel=re}finally{}},mINSTATEMENT:function(){try{var ee=this.INSTATEMENT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mI(),this.mN(),this.state.type=ee,this.state.channel=re}finally{}},mTOSTATEMENT:function(){try{var ee=this.TOSTATEMENT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mT(),this.mO(),this.state.type=ee,this.state.channel=re}finally{}},mBYSTATEMENT:function(){try{var ee=this.BYSTATEMENT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mB(),this.mY(),this.state.type=ee,this.state.channel=re}finally{}},mLOOPSTATEMENT:function(){try{var ee=this.LOOPSTATEMENT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mL(),this.mO(),this.mO(),this.mP(),this.state.type=ee,this.state.channel=re}finally{}},mIFSTATEMENT:function(){try{var ee=this.IFSTATEMENT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mI(),this.mF(),this.state.type=ee,this.state.channel=re}finally{}},mTHENSTATEMENT:function(){try{var ee=this.THENSTATEMENT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mT(),this.mH(),this.mE(),this.mN(),this.state.type=ee,this.state.channel=re}finally{}},mELSESTATEMENT:function(){try{var ee=this.ELSESTATEMENT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mE(),this.mL(),this.mS(),this.mE(),this.state.type=ee,this.state.channel=re}finally{}},mFUNCTIONSTATEMENT:function(){try{var ee=this.FUNCTIONSTATEMENT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mF(),this.mU(),this.mN(),this.mC(),this.mT(),this.mI(),this.mO(),this.mN(),this.state.type=ee,this.state.channel=re}finally{}},mENDBLOCK:function(){try{var ee=this.ENDBLOCK,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mE(),this.mN(),this.mD(),this.state.type=ee,this.state.channel=re}finally{}},mRETURNSTATEMENT:function(){try{var ee=this.RETURNSTATEMENT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mR(),this.mE(),this.mT(),this.mU(),this.mR(),this.mN(),this.state.type=ee,this.state.channel=re}finally{}},mNEWSTATEMENT:function(){try{var ee=this.NEWSTATEMENT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mN(),this.mE(),this.mW(),this.state.type=ee,this.state.channel=re}finally{}},mTRYSTATEMENT:function(){try{var ee=this.TRYSTATEMENT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mT(),this.mR(),this.mY(),this.state.type=ee,this.state.channel=re}finally{}},mCATCHSTATEMENT:function(){try{var ee=this.CATCHSTATEMENT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mC(),this.mA(),this.mT(),this.mC(),this.mH(),this.state.type=ee,this.state.channel=re}finally{}},mTHROWSTATEMENT:function(){try{var ee=this.THROWSTATEMENT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mT(),this.mH(),this.mR(),this.mO(),this.mW(),this.state.type=ee,this.state.channel=re}finally{}},mOR:function(){try{var ee=this.OR,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,ne=2,ie=this.input.LA(1);if(ie=="|")ne=1;else if(ie=="O"||ie=="o")ne=2;else{var se=new org.antlr.runtime.NoViableAltException("",2,0,this.input);throw se}switch(ne){case 1:this.match("||");break;case 2:this.mO(),this.mR();break}this.state.type=ee,this.state.channel=re}finally{}},mXOR:function(){try{var ee=this.XOR,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mX(),this.mO(),this.mR(),this.state.type=ee,this.state.channel=re}finally{}},mAND:function(){try{var ee=this.AND,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,ne=2,ie=this.input.LA(1);if(ie=="&")ne=1;else if(ie=="A"||ie=="a")ne=2;else{var se=new org.antlr.runtime.NoViableAltException("",3,0,this.input);throw se}switch(ne){case 1:this.match("&&");break;case 2:this.mA(),this.mN(),this.mD();break}this.state.type=ee,this.state.channel=re}finally{}},mEQUALS:function(){try{var ee=this.EQUALS,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,ne=2,ie=this.input.LA(1);if(ie=="="){var se=this.input.LA(2);se=="="?ne=2:ne=1}else{var le=new org.antlr.runtime.NoViableAltException("",4,0,this.input);throw le}switch(ne){case 1:this.match("=");break;case 2:this.match("==");break}this.state.type=ee,this.state.channel=re}finally{}},mNOTEQUALS:function(){try{var ee=this.NOTEQUALS,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,ne=2,ie=this.input.LA(1);if(ie=="!")ne=1;else if(ie=="<")ne=2;else{var se=new org.antlr.runtime.NoViableAltException("",5,0,this.input);throw se}switch(ne){case 1:this.match("!=");break;case 2:this.match("<>");break}this.state.type=ee,this.state.channel=re}finally{}},mLT:function(){try{var ee=this.LT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("<"),this.state.type=ee,this.state.channel=re}finally{}},mLTEQ:function(){try{var ee=this.LTEQ,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("<="),this.state.type=ee,this.state.channel=re}finally{}},mGT:function(){try{var ee=this.GT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match(">"),this.state.type=ee,this.state.channel=re}finally{}},mGTEQ:function(){try{var ee=this.GTEQ,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match(">="),this.state.type=ee,this.state.channel=re}finally{}},mPLUS:function(){try{var ee=this.PLUS,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("+"),this.state.type=ee,this.state.channel=re}finally{}},mMINUS:function(){try{var ee=this.MINUS,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("-"),this.state.type=ee,this.state.channel=re}finally{}},mMULT:function(){try{var ee=this.MULT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("*"),this.state.type=ee,this.state.channel=re}finally{}},mDIV:function(){try{var ee=this.DIV,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("/"),this.state.type=ee,this.state.channel=re}finally{}},mMOD:function(){try{var ee=this.MOD,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,ne=2,ie=this.input.LA(1);if(ie=="%")ne=1;else if(ie=="M"||ie=="m")ne=2;else{var se=new org.antlr.runtime.NoViableAltException("",6,0,this.input);throw se}switch(ne){case 1:this.match("%");break;case 2:this.mM(),this.mO(),this.mD();break}this.state.type=ee,this.state.channel=re}finally{}},mPOW:function(){try{var ee=this.POW,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("^"),this.state.type=ee,this.state.channel=re}finally{}},mNOT:function(){try{var ee=this.NOT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,ne=2,ie=this.input.LA(1);if(ie=="!")ne=1;else if(ie=="N"||ie=="n")ne=2;else{var se=new org.antlr.runtime.NoViableAltException("",7,0,this.input);throw se}switch(ne){case 1:this.match("!");break;case 2:this.mN(),this.mO(),this.mT();break}this.state.type=ee,this.state.channel=re}finally{}},mLARR:function(){try{var ee=this.LARR,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,ne=2,ie=this.input.LA(1);if(ie=="")ne=1;else if(ie=="<")ne=2;else{var se=new org.antlr.runtime.NoViableAltException("",8,0,this.input);throw se}switch(ne){case 1:this.match("");break;case 2:this.match("<<");break}this.state.type=ee,this.state.channel=re}finally{}},mRARR:function(){try{var ee=this.RARR,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,ne=2,ie=this.input.LA(1);if(ie=="")ne=1;else if(ie==">")ne=2;else{var se=new org.antlr.runtime.NoViableAltException("",9,0,this.input);throw se}switch(ne){case 1:this.match("");break;case 2:this.match(">>");break}this.state.type=ee,this.state.channel=re}finally{}},mLCURL:function(){try{var ee=this.LCURL,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("{"),this.state.type=ee,this.state.channel=re}finally{}},mRCURL:function(){try{var ee=this.RCURL,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("}"),this.state.type=ee,this.state.channel=re}finally{}},mINTEGER:function(){try{var ee=this.INTEGER,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,ne=0;e:do{var ie=2,se=this.input.LA(1);switch(se>="0"&&se<="9"&&(ie=1),ie){case 1:this.matchRange("0","9");break;default:if(ne>=1)break e;var le=new org.antlr.runtime.EarlyExitException(10,this.input);throw le}ne++}while(!0);var ue=2,ae=this.input.LA(1);switch(ae=="e"&&(ue=1),ue){case 1:this.match("e");var oe=2,he=this.input.LA(1);switch((he=="+"||he=="-")&&(oe=1),oe){case 1:if(this.input.LA(1)=="+"||this.input.LA(1)=="-")this.input.consume();else{var ce=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ce),ce}break}e:do{var pe=2,de=this.input.LA(1);switch(de>="0"&&de<="9"&&(pe=1),pe){case 1:this.matchRange("0","9");break;default:break e}}while(!0);break}this.state.type=ee,this.state.channel=re}finally{}},mFLOAT:function(){try{var ee=this.FLOAT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;e:do{var ne=2,ie=this.input.LA(1);switch(ie>="0"&&ie<="9"&&(ne=1),ne){case 1:this.matchRange("0","9");break;default:break e}}while(!0);this.match(".");var se=0;e:do{var le=2,ue=this.input.LA(1);switch(ue>="0"&&ue<="9"&&(le=1),le){case 1:this.matchRange("0","9");break;default:if(se>=1)break e;var ae=new org.antlr.runtime.EarlyExitException(15,this.input);throw ae}se++}while(!0);var oe=2,he=this.input.LA(1);switch(he=="e"&&(oe=1),oe){case 1:this.match("e");var ce=2,pe=this.input.LA(1);switch((pe=="+"||pe=="-")&&(ce=1),ce){case 1:if(this.input.LA(1)=="+"||this.input.LA(1)=="-")this.input.consume();else{var de=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(de),de}break}e:do{var me=2,ve=this.input.LA(1);switch(ve>="0"&&ve<="9"&&(me=1),me){case 1:this.matchRange("0","9");break;default:break e}}while(!0);break}this.state.type=ee,this.state.channel=re}finally{}},mTRUE:function(){try{var ee=this.TRUE,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mT(),this.mR(),this.mU(),this.mE(),this.state.type=ee,this.state.channel=re}finally{}},mFALSE:function(){try{var ee=this.FALSE,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mF(),this.mA(),this.mL(),this.mS(),this.mE(),this.state.type=ee,this.state.channel=re}finally{}},mPER:function(){try{var ee=this.PER,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mP(),this.mE(),this.mR(),this.state.type=ee,this.state.channel=re}finally{}},mSQUARED:function(){try{var ee=this.SQUARED,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mS(),this.mQ(),this.mU(),this.mA(),this.mR(),this.mE(),this.mD(),this.state.type=ee,this.state.channel=re}finally{}},mCUBED:function(){try{var ee=this.CUBED,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mC(),this.mU(),this.mB(),this.mE(),this.mD(),this.state.type=ee,this.state.channel=re}finally{}},mIDENT:function(){try{var ee=this.IDENT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;if(this.input.LA(1)>="A"&&this.input.LA(1)<="Z"||this.input.LA(1)>="a"&&this.input.LA(1)<="z")this.input.consume();else{var ne=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ne),ne}e:do{var ie=2,se=this.input.LA(1);switch((se>="0"&&se<="9"||se>="A"&&se<="Z"||se=="_"||se>="a"&&se<="z")&&(ie=1),ie){case 1:if(this.input.LA(1)>="0"&&this.input.LA(1)<="9"||this.input.LA(1)>="A"&&this.input.LA(1)<="Z"||this.input.LA(1)=="_"||this.input.LA(1)>="a"&&this.input.LA(1)<="z")this.input.consume();else{var ne=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ne),ne}break;default:break e}}while(!0);this.state.type=ee,this.state.channel=re}finally{}},mPRIMITIVE:function(){try{var ee=this.PRIMITIVE,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,ne=2,ie=this.input.LA(1);if(ie=="["){var se=this.input.LA(2);if(se>="\0"&&se<="Z"||se>="\\"&&se<="")ne=1;else if(se=="[")ne=2;else{var le=new org.antlr.runtime.NoViableAltException("",22,1,this.input);throw le}}else{var le=new org.antlr.runtime.NoViableAltException("",22,0,this.input);throw le}switch(ne){case 1:if(this.mLBRACKET(),this.input.LA(1)>="\0"&&this.input.LA(1)<="Z"||this.input.LA(1)>="\\"&&this.input.LA(1)<="")this.input.consume();else{var ue=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ue),ue}e:do{var ae=2,oe=this.input.LA(1);switch(oe=="]"?ae=2:(oe>="\0"&&oe<="\\"||oe>="^"&&oe<="")&&(ae=1),ae){case 1:this.matchAny();break;default:break e}}while(!0);this.mRBRACKET();break;case 2:this.mLBRACKET(),this.mLBRACKET();e:do{var he=2,ce=this.input.LA(1);switch(ce=="]"?he=2:(ce>="\0"&&ce<="\\"||ce>="^"&&ce<="")&&(he=1),he){case 1:this.matchAny();break;default:break e}}while(!0);this.mRBRACKET(),this.mRBRACKET();break}this.state.type=ee,this.state.channel=re}finally{}},mLBRACKET:function(){try{var ee=this.LBRACKET,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("["),this.state.type=ee,this.state.channel=re}finally{}},mRBRACKET:function(){try{var ee=this.RBRACKET,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("]"),this.state.type=ee,this.state.channel=re}finally{}},mCOMMENT:function(){try{var ee=this.COMMENT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("/*");e:do{var ne=2,ie=this.input.LA(1);if(ie=="*"){var se=this.input.LA(2);se=="/"?ne=2:(se>="\0"&&se<="."||se>="0"&&se<="")&&(ne=1)}else(ie>="\0"&&ie<=")"||ie>="+"&&ie<="")&&(ne=1);switch(ne){case 1:this.matchAny();break;default:break e}}while(!0);this.match("*/"),re=te,this.state.type=ee,this.state.channel=re}finally{}},mLINE_COMMENT:function(){try{var ee=this.LINE_COMMENT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,ne=2,ie=this.input.LA(1);if(ie=="/")ne=1;else if(ie=="#")ne=2;else{var se=new org.antlr.runtime.NoViableAltException("",24,0,this.input);throw se}switch(ne){case 1:this.match("//");break;case 2:this.match("#");break}e:do{var le=2,ue=this.input.LA(1);switch((ue>="\0"&&ue<="	"||ue>="\v"&&ue<="\f"||ue>=""&&ue<="")&&(le=1),le){case 1:if(this.input.LA(1)>="\0"&&this.input.LA(1)<="	"||this.input.LA(1)>="\v"&&this.input.LA(1)<="\f"||this.input.LA(1)>=""&&this.input.LA(1)<="")this.input.consume();else{var ae=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ae),ae}break;default:break e}}while(!0);re=te,this.state.type=ee,this.state.channel=re}finally{}},mCOLON:function(){try{var ee=this.COLON,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match(":"),this.state.type=ee,this.state.channel=re}finally{}},mWS:function(){try{var ee=this.WS,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,ne=0;e:do{var ie=2,se=this.input.LA(1);switch((se=="	"||se=="\f"||se==" ")&&(ie=1),ie){case 1:if(this.input.LA(1)=="	"||this.input.LA(1)=="\f"||this.input.LA(1)==" ")this.input.consume();else{var le=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(le),le}break;default:if(ne>=1)break e;var ue=new org.antlr.runtime.EarlyExitException(26,this.input);throw ue}ne++}while(!0);re=te,this.state.type=ee,this.state.channel=re}finally{}},mA:function(){try{if(this.input.LA(1)=="A"||this.input.LA(1)=="a")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mB:function(){try{if(this.input.LA(1)=="B"||this.input.LA(1)=="b")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mC:function(){try{if(this.input.LA(1)=="C"||this.input.LA(1)=="c")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mD:function(){try{if(this.input.LA(1)=="D"||this.input.LA(1)=="d")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mE:function(){try{if(this.input.LA(1)=="E"||this.input.LA(1)=="e")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mF:function(){try{if(this.input.LA(1)=="F"||this.input.LA(1)=="f")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mG:function(){try{if(this.input.LA(1)=="G"||this.input.LA(1)=="g")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mH:function(){try{if(this.input.LA(1)=="H"||this.input.LA(1)=="h")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mI:function(){try{if(this.input.LA(1)=="I"||this.input.LA(1)=="i")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mJ:function(){try{if(this.input.LA(1)=="J"||this.input.LA(1)=="j")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mK:function(){try{if(this.input.LA(1)=="K"||this.input.LA(1)=="k")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mL:function(){try{if(this.input.LA(1)=="L"||this.input.LA(1)=="l")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mM:function(){try{if(this.input.LA(1)=="M"||this.input.LA(1)=="m")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mN:function(){try{if(this.input.LA(1)=="N"||this.input.LA(1)=="n")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mO:function(){try{if(this.input.LA(1)=="O"||this.input.LA(1)=="o")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mP:function(){try{if(this.input.LA(1)=="P"||this.input.LA(1)=="p")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mQ:function(){try{if(this.input.LA(1)=="Q"||this.input.LA(1)=="q")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mR:function(){try{if(this.input.LA(1)=="R"||this.input.LA(1)=="r")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mS:function(){try{if(this.input.LA(1)=="S"||this.input.LA(1)=="s")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mT:function(){try{if(this.input.LA(1)=="T"||this.input.LA(1)=="t")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mU:function(){try{if(this.input.LA(1)=="U"||this.input.LA(1)=="u")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mV:function(){try{if(this.input.LA(1)=="V"||this.input.LA(1)=="v")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mW:function(){try{if(this.input.LA(1)=="W"||this.input.LA(1)=="w")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mX:function(){try{if(this.input.LA(1)=="X"||this.input.LA(1)=="x")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mY:function(){try{if(this.input.LA(1)=="Y"||this.input.LA(1)=="y")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mZ:function(){try{if(this.input.LA(1)=="Z"||this.input.LA(1)=="z")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mCOMMA:function(){try{var ee=this.COMMA,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match(","),this.state.type=ee,this.state.channel=re}finally{}},mSTRING:function(){try{var ee=this.STRING,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,ne=2,ie=this.input.LA(1);if(ie=="'")ne=1;else if(ie=='"')ne=2;else{var se=new org.antlr.runtime.NoViableAltException("",29,0,this.input);throw se}switch(ne){case 1:this.match("'");e:do{var le=2,ue=this.input.LA(1);switch(ue=="'"?le=2:(ue>="\0"&&ue<="&"||ue>="("&&ue<="")&&(le=1),le){case 1:this.matchAny();break;default:break e}}while(!0);this.match("'");break;case 2:this.match('"');e:do{var ae=3,oe=this.input.LA(1);if(oe=="\\"){var he=this.input.LA(2);if(he=='"'){var ce=this.input.LA(3);ce>="\0"&&ce<=""?ae=1:ae=2}else(he>="\0"&&he<="!"||he>="#"&&he<="")&&(ae=2)}else(oe>="\0"&&oe<="!"||oe>="#"&&oe<="["||oe>="]"&&oe<="")&&(ae=2);switch(ae){case 1:this.match('\\"');break;case 2:if(this.input.LA(1)>="\0"&&this.input.LA(1)<="!"||this.input.LA(1)>="#"&&this.input.LA(1)<="")this.input.consume();else{var pe=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(pe),pe}break;default:break e}}while(!0);this.match('"');break}this.state.type=ee,this.state.channel=re}finally{}},mTokens:function(){var ee=59;switch(ee=this.dfa30.predict(this.input),ee){case 1:this.mT__113();break;case 2:this.mT__114();break;case 3:this.mT__115();break;case 4:this.mT__116();break;case 5:this.mNEWLINE();break;case 6:this.mWHILESTATEMENT();break;case 7:this.mFORSTATEMENT();break;case 8:this.mFROMSTATEMENT();break;case 9:this.mINSTATEMENT();break;case 10:this.mTOSTATEMENT();break;case 11:this.mBYSTATEMENT();break;case 12:this.mLOOPSTATEMENT();break;case 13:this.mIFSTATEMENT();break;case 14:this.mTHENSTATEMENT();break;case 15:this.mELSESTATEMENT();break;case 16:this.mFUNCTIONSTATEMENT();break;case 17:this.mENDBLOCK();break;case 18:this.mRETURNSTATEMENT();break;case 19:this.mNEWSTATEMENT();break;case 20:this.mTRYSTATEMENT();break;case 21:this.mCATCHSTATEMENT();break;case 22:this.mTHROWSTATEMENT();break;case 23:this.mOR();break;case 24:this.mXOR();break;case 25:this.mAND();break;case 26:this.mEQUALS();break;case 27:this.mNOTEQUALS();break;case 28:this.mLT();break;case 29:this.mLTEQ();break;case 30:this.mGT();break;case 31:this.mGTEQ();break;case 32:this.mPLUS();break;case 33:this.mMINUS();break;case 34:this.mMULT();break;case 35:this.mDIV();break;case 36:this.mMOD();break;case 37:this.mPOW();break;case 38:this.mNOT();break;case 39:this.mLARR();break;case 40:this.mRARR();break;case 41:this.mLCURL();break;case 42:this.mRCURL();break;case 43:this.mINTEGER();break;case 44:this.mFLOAT();break;case 45:this.mTRUE();break;case 46:this.mFALSE();break;case 47:this.mPER();break;case 48:this.mSQUARED();break;case 49:this.mCUBED();break;case 50:this.mIDENT();break;case 51:this.mPRIMITIVE();break;case 52:this.mLBRACKET();break;case 53:this.mRBRACKET();break;case 54:this.mCOMMENT();break;case 55:this.mLINE_COMMENT();break;case 56:this.mCOLON();break;case 57:this.mWS();break;case 58:this.mCOMMA();break;case 59:this.mSTRING();break}}},!0),org.antlr.lang.augmentObject(FormulaLexer,{DFA30_eotS:`12
&&&JLN&P&S\f&Z[\\&a\b&&&&&p&&v&&z&|J&&&&&&&&&&&&`,DFA30_eofS:"",DFA30_minS:"	-0HAFHYOLEARON=*O.EQ\0\fIRONL0EU0OSDTWTB0RDDRUL0MCSNO0EPE0U0CE0AE0TE0W0RHDR0I00N0EO0DN0",DFA30_maxS:">9hunryoneouron=>/o9eq\fironlzryzosdtwtbzrddrulzmcsnozepezuzcezaeztezwzrhdrzizznzeozdnz",DFA30_acceptS:`
 !"$%'()*25789:;\x1B,&6#+43	\r
\v\x07/\b-\f.10`,DFA30_specialS:"'\0u}>",DFA30_transitionS:[`+++-)-,\x1B
#*
&\f\x07&\b&\v$&\r%	&&'(
&\f\x07&\b&\v$&\r%	&&!"- `,"","",".0/",`
3`,"","44","8\r567\v8\r567",":\x079:\x079","<;=<;=",">>","??","@A@A","BB","C	DC	D","EF\vEF","","GG","HH","","II","","/","K ","","","","M)","","OO","","","","","",`3
#`,"QQ","RR","","\0T","","","","","","","","","","","","","UU","VV","WW","XX","YY",`
&\x07&&&`,`
&\x07&&&`,`
&\x07&&&`,"]\f^]\f^","`_\x1B`_",`
&\x07&&&`,"bb","cc","dd","ee","ff","gg","hh","ii",`
&\x07&&&`,"jj","kk","","","","","","ll","","mm","nn","","","oo",`
&\x07&&&`,"qq","rr","ss","","","","tt","uu",`
&\x07&&&`,"ww","","xx","yy",`
&\x07&&&`,"{{",`
&\x07&&&`,`
&\x07&&&`,"}}","~~",`
&\x07&&&`,`
&\x07&&&`,`
&\x07&&&`,`
&\x07&&&`,"","","",`
&\x07&&&`,"","",`
&\x07&&&`,"","",`
&\x07&&&`,`
&\x07&&&`,`
&\x07&&&`,"","","","","","","","",`
&\x07&&&`,"","",`
&\x07&&&`,"",`
&\x07&&&`,"","","","",`
&\x07&&&`,`
&\x07&&&`,"","","","","",`
&\x07&&&`,"","","","","",`
&\x07&&&`,`
&\x07&&&`,"",""]}),org.antlr.lang.augmentObject(FormulaLexer,{DFA30_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaLexer.DFA30_eotS),DFA30_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaLexer.DFA30_eofS),DFA30_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaLexer.DFA30_minS),DFA30_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaLexer.DFA30_maxS),DFA30_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaLexer.DFA30_acceptS),DFA30_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaLexer.DFA30_specialS),DFA30_transition:function(){var ee=[],re,ne=FormulaLexer.DFA30_transitionS.length;for(re=0;re<ne;re++)ee.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaLexer.DFA30_transitionS[re]));return ee}()}),FormulaLexer.DFA30=function(ee){this.recognizer=ee,this.decisionNumber=30,this.eot=FormulaLexer.DFA30_eot,this.eof=FormulaLexer.DFA30_eof,this.min=FormulaLexer.DFA30_min,this.max=FormulaLexer.DFA30_max,this.accept=FormulaLexer.DFA30_accept,this.special=FormulaLexer.DFA30_special,this.transition=FormulaLexer.DFA30_transition},org.antlr.lang.extend(FormulaLexer.DFA30,org.antlr.runtime.DFA,{getDescription:function(){return"1:1: Tokens : ( T__113 | T__114 | T__115 | T__116 | NEWLINE | WHILESTATEMENT | FORSTATEMENT | FROMSTATEMENT | INSTATEMENT | TOSTATEMENT | BYSTATEMENT | LOOPSTATEMENT | IFSTATEMENT | THENSTATEMENT | ELSESTATEMENT | FUNCTIONSTATEMENT | ENDBLOCK | RETURNSTATEMENT | NEWSTATEMENT | TRYSTATEMENT | CATCHSTATEMENT | THROWSTATEMENT | OR | XOR | AND | EQUALS | NOTEQUALS | LT | LTEQ | GT | GTEQ | PLUS | MINUS | MULT | DIV | MOD | POW | NOT | LARR | RARR | LCURL | RCURL | INTEGER | FLOAT | TRUE | FALSE | PER | SQUARED | CUBED | IDENT | PRIMITIVE | LBRACKET | RBRACKET | COMMENT | LINE_COMMENT | COLON | WS | COMMA | STRING );"},specialStateTransition:function(ee,re){var ne=ee,ie=function(le,ue){switch(le){case 0:var ae=ue.LA(1);if(le=-1,ae>="\0"&&ae<=""?le=84:le=83,le>=0)return le;break}}.call(this.recognizer,ee,re);if(!org.antlr.lang.isUndefined(ie))return ie;var se=new org.antlr.runtime.NoViableAltException(this.getDescription(),30,ne,re);throw this.error(se),se},dummy:null})})();function FormulaParser(te,ee){ee||(ee=new org.antlr.runtime.RecognizerSharedState),function(){}.call(this),FormulaParser.superclass.constructor.call(this,te,ee),this.dfa5=new FormulaParser.DFA5(this),this.dfa57=new FormulaParser.DFA57(this),this.dfa58=new FormulaParser.DFA58(this),this.dfa65=new FormulaParser.DFA65(this),this.dfa72=new FormulaParser.DFA72(this),this.dfa85=new FormulaParser.DFA85(this),this.adaptor=new org.antlr.runtime.tree.CommonTreeAdaptor}org.antlr.lang.augmentObject(FormulaParser,{EOF:-1,T__113:113,T__114:114,T__115:115,T__116:116,NEGATE:4,ASSIGN:5,FUNCALL:6,MATERIAL:7,UNIT:8,POWER:9,DEFAULTS:10,PARAMS:11,UNITCLUMP:12,ARRAY:13,LINES:14,WHILE:15,IFTHENELSE:16,ELSE:17,FOR:18,FORIN:19,FUNCTION:20,ANONFUNCTION:21,NUMBER:22,LABEL:23,RANGE:24,INNER:25,ASSIGNED:26,SELECTOR:27,DOTSELECTOR:28,NEW:29,TRYCATCH:30,THROW:31,NEWLINE:32,W:33,H:34,I:35,L:36,E:37,WHILESTATEMENT:38,F:39,O:40,R:41,FORSTATEMENT:42,M:43,FROMSTATEMENT:44,N:45,INSTATEMENT:46,T:47,TOSTATEMENT:48,B:49,Y:50,BYSTATEMENT:51,P:52,LOOPSTATEMENT:53,IFSTATEMENT:54,THENSTATEMENT:55,S:56,ELSESTATEMENT:57,U:58,C:59,FUNCTIONSTATEMENT:60,D:61,ENDBLOCK:62,RETURNSTATEMENT:63,NEWSTATEMENT:64,TRYSTATEMENT:65,A:66,CATCHSTATEMENT:67,THROWSTATEMENT:68,IDENT:69,EQUALS:70,PRIMITIVE:71,OR:72,XOR:73,X:74,AND:75,NOTEQUALS:76,LT:77,LTEQ:78,GT:79,GTEQ:80,PLUS:81,MINUS:82,MULT:83,DIV:84,MOD:85,COLON:86,POW:87,NOT:88,LARR:89,RARR:90,LCURL:91,RCURL:92,COMMA:93,STRING:94,INTEGER:95,FLOAT:96,TRUE:97,FALSE:98,PER:99,CUBED:100,SQUARED:101,Q:102,LBRACKET:103,RBRACKET:104,COMMENT:105,LINE_COMMENT:106,WS:107,G:108,J:109,K:110,V:111,Z:112});(function(){var te=-1,ee=4,re=5,ne=6,ie=7,se=8,le=9,ue=10,ae=11,oe=12,he=13,ce=14,pe=15,de=16,me=18,ve=19,we=20,ge=21,_e=23,Te=24,Ne=25,ye=26,Le=27,xe=28,Oe=29,Fe=30,De=31,Me=32,We=38,Ge=42,ht=44,qe=46,ot=48,nt=51,je=53,Ke=54,et=55,tt=57,Ye=60,at=62,Bt=63,Et=64,gt=65,jt=67,St=68,Qe=69,Rt=70,Pt=71,Ut=72,Zt=73,fr=75,dr=76,pr=77,mr=80,gr=81,Ct=82,Wt=83,vr=84,_r=85,tr=86,ir=87,Kt=88,xt=89,Tr=90,kt=91,Er=92,pt=93,$t=94,ar=95,wr=96,Nr=97,Vt=98,br=99,lr=100,cr=101;org.antlr.lang.extend(FormulaParser,org.antlr.runtime.Parser,{setTreeAdaptor:function(fe){this.adaptor=fe},getTreeAdaptor:function(){return this.adaptor},getTokenNames:function(){return FormulaParser.tokenNames},getGrammarFileName:function(){return"/Library/WebServer/Documents/calc/Formula.g"}}),org.antlr.lang.augmentObject(FormulaParser.prototype,{lines_return:function(){FormulaParser.lines_return=function(){},org.antlr.lang.extend(FormulaParser.lines_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),lines:function(){var fe=new FormulaParser.lines_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=null,ke=null,Ae=null,Re=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),Ce=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token EOF"),Ie=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule expression");try{e:do{var Ve=2,$e=this.input.LA(1);switch($e==Me&&(Ve=1),Ve){case 1:if(be=this.match(this.input,Me,FormulaParser.FOLLOW_NEWLINE_in_lines160),this.state.failed)return fe;this.state.backtracking===0&&Re.add(be);break;default:break e}}while(!0);e:do{var Ue=2,Be=this.input.LA(1);switch((Be==We||Be==Ge||Be==Ke||Be==Ye||Be>=Bt&&Be<=gt||Be>=St&&Be<=Qe||Be==Pt||Be==Ct||Be>=Kt&&Be<=xt||Be==kt||Be>=$t&&Be<=Vt||Be==113)&&(Ue=1),Ue){case 1:if(this.pushFollow(FormulaParser.FOLLOW_expression_in_lines164),Ae=this.expression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&Ie.add(Ae.getTree());var Je=2,st=this.input.LA(1);if(st==Me)Je=1;else if(st==te)Je=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Ze=new org.antlr.runtime.NoViableAltException("",3,0,this.input);throw Ze}switch(Je){case 1:var ze=0;t:do{var it=2,ct=this.input.LA(1);switch(ct==Me&&(it=1),it){case 1:if(Pe=this.match(this.input,Me,FormulaParser.FOLLOW_NEWLINE_in_lines168),this.state.failed)return fe;this.state.backtracking===0&&Re.add(Pe);break;default:if(ze>=1)break t;if(this.state.backtracking>0)return this.state.failed=!0,fe;var ft=new org.antlr.runtime.EarlyExitException(2,this.input);throw ft}ze++}while(!0);break;case 2:if(Se=this.match(this.input,te,FormulaParser.FOLLOW_EOF_in_lines171),this.state.failed)return fe;this.state.backtracking===0&&Ce.add(Se);break}break;default:break e}}while(!0);if(ke=this.match(this.input,te,FormulaParser.FOLLOW_EOF_in_lines176),this.state.failed)return fe;if(this.state.backtracking===0&&Ce.add(ke),this.state.backtracking===0){fe.tree=Ee;var lt=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var ut=this.adaptor.nil();for(ut=this.adaptor.becomeRoot(this.adaptor.create(ce,"LINES"),ut);Ie.hasNext();)this.adaptor.addChild(ut,Ie.nextTree());Ie.reset(),this.adaptor.addChild(Ee,ut)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(He){if(He instanceof org.antlr.runtime.RecognitionException)this.reportError(He),this.recover(this.input,He),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),He);else throw He}finally{}return fe},expression_return:function(){FormulaParser.expression_return=function(){},org.antlr.lang.extend(FormulaParser.expression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),expression:function(){var fe=new FormulaParser.expression_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=null,ke=null,Ae=null,Re=null,Ce=null,Ie=null,Ve=null,$e=null;try{var Ue=10;switch(Ue=this.dfa5.predict(this.input),Ue){case 1:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_assignment_in_expression508),be=this.assignment(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,be.getTree());break;case 2:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_expression514),Pe=this.logicalExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Pe.getTree());break;case 3:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_whileLoop_in_expression520),Se=this.whileLoop(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Se.getTree());break;case 4:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_forLoop_in_expression526),ke=this.forLoop(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,ke.getTree());break;case 5:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_forInLoop_in_expression532),Ae=this.forInLoop(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Ae.getTree());break;case 6:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_ifThenElse_in_expression538),Re=this.ifThenElse(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Re.getTree());break;case 7:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_functionDef_in_expression544),Ce=this.functionDef(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Ce.getTree());break;case 8:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_returnExp_in_expression550),Ie=this.returnExp(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Ie.getTree());break;case 9:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_tryCatch_in_expression556),Ve=this.tryCatch(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Ve.getTree());break;case 10:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_throwExp_in_expression562),$e=this.throwExp(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,$e.getTree());break}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Be){if(Be instanceof org.antlr.runtime.RecognitionException)this.reportError(Be),this.recover(this.input,Be),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Be);else throw Be}finally{}return fe},returnExp_return:function(){FormulaParser.returnExp_return=function(){},org.antlr.lang.extend(FormulaParser.returnExp_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),returnExp:function(){var fe=new FormulaParser.returnExp_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=null;try{if(Ee=this.adaptor.nil(),be=this.match(this.input,Bt,FormulaParser.FOLLOW_RETURNSTATEMENT_in_returnExp574),this.state.failed||(this.state.backtracking===0&&(Se=this.adaptor.create(be),Ee=this.adaptor.becomeRoot(Se,Ee)),this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_returnExp577),Pe=this.logicalExpression(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Pe.getTree()),fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(ke){if(ke instanceof org.antlr.runtime.RecognitionException)this.reportError(ke),this.recover(this.input,ke),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),ke);else throw ke}finally{}return fe},innerBlock_return:function(){FormulaParser.innerBlock_return=function(){},org.antlr.lang.extend(FormulaParser.innerBlock_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),innerBlock:function(){var fe=new FormulaParser.innerBlock_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),ke=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule expression");try{e:do{var Ae=2,Re=this.input.LA(1);switch((Re==We||Re==Ge||Re==Ke||Re==Ye||Re>=Bt&&Re<=gt||Re>=St&&Re<=Qe||Re==Pt||Re==Ct||Re>=Kt&&Re<=xt||Re==kt||Re>=$t&&Re<=Vt||Re==113)&&(Ae=1),Ae){case 1:if(this.pushFollow(FormulaParser.FOLLOW_expression_in_innerBlock590),Pe=this.expression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&ke.add(Pe.getTree());var Ce=0;t:do{var Ie=2,Ve=this.input.LA(1);switch(Ve==Me&&(Ie=1),Ie){case 1:if(be=this.match(this.input,Me,FormulaParser.FOLLOW_NEWLINE_in_innerBlock594),this.state.failed)return fe;this.state.backtracking===0&&Se.add(be);break;default:if(Ce>=1)break t;if(this.state.backtracking>0)return this.state.failed=!0,fe;var $e=new org.antlr.runtime.EarlyExitException(6,this.input);throw $e}Ce++}while(!0);break;default:break e}}while(!0);if(this.state.backtracking===0){fe.tree=Ee;var Ue=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var Be=this.adaptor.nil();if(Be=this.adaptor.becomeRoot(this.adaptor.create(ce,"LINES"),Be),!ke.hasNext())throw new org.antlr.runtime.tree.RewriteEarlyExitException;for(;ke.hasNext();)this.adaptor.addChild(Be,ke.nextTree());ke.reset(),this.adaptor.addChild(Ee,Be)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Je){if(Je instanceof org.antlr.runtime.RecognitionException)this.reportError(Je),this.recover(this.input,Je),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Je);else throw Je}finally{}return fe},whileLoop_return:function(){FormulaParser.whileLoop_return=function(){},org.antlr.lang.extend(FormulaParser.whileLoop_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),whileLoop:function(){var fe=new FormulaParser.whileLoop_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=null,ke=null,Ae=null,Re=null,Ce=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),Ie=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),Ve=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token LOOPSTATEMENT"),$e=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token WHILESTATEMENT"),Ue=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),Be=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{if(be=this.match(this.input,We,FormulaParser.FOLLOW_WHILESTATEMENT_in_whileLoop619),this.state.failed||(this.state.backtracking===0&&$e.add(be),this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_whileLoop621),Ae=this.logicalExpression(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&Be.add(Ae.getTree());var Je=0;e:do{var st=2,Ze=this.input.LA(1);switch(Ze==Me&&(st=1),st){case 1:if(Pe=this.match(this.input,Me,FormulaParser.FOLLOW_NEWLINE_in_whileLoop623),this.state.failed)return fe;this.state.backtracking===0&&Ce.add(Pe);break;default:if(Je>=1)break e;if(this.state.backtracking>0)return this.state.failed=!0,fe;var ze=new org.antlr.runtime.EarlyExitException(8,this.input);throw ze}Je++}while(!0);if(this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_whileLoop626),Re=this.innerBlock(),this.state._fsp--,this.state.failed||(this.state.backtracking===0&&Ue.add(Re.getTree()),Se=this.match(this.input,at,FormulaParser.FOLLOW_ENDBLOCK_in_whileLoop629),this.state.failed)||(this.state.backtracking===0&&Ie.add(Se),ke=this.match(this.input,je,FormulaParser.FOLLOW_LOOPSTATEMENT_in_whileLoop631),this.state.failed))return fe;if(this.state.backtracking===0&&Ve.add(ke),this.state.backtracking===0){fe.tree=Ee;var it=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var ct=this.adaptor.nil();ct=this.adaptor.becomeRoot(this.adaptor.create(pe,"WHILE"),ct),this.adaptor.addChild(ct,Be.nextTree()),this.adaptor.addChild(ct,Ue.nextTree()),this.adaptor.addChild(Ee,ct)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(ft){if(ft instanceof org.antlr.runtime.RecognitionException)this.reportError(ft),this.recover(this.input,ft),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),ft);else throw ft}finally{}return fe},forLoop_return:function(){FormulaParser.forLoop_return=function(){},org.antlr.lang.extend(FormulaParser.forLoop_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),forLoop:function(){var fe=new FormulaParser.forLoop_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=null,ke=null,Ae=null,Re=null,Ce=null,Ie=null,Ve=null,$e=null,Ue=null,Be=null,Je=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token FORSTATEMENT"),st=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),Ze=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token FROMSTATEMENT"),ze=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),it=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token TOSTATEMENT"),ct=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),ft=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token LOOPSTATEMENT"),lt=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token BYSTATEMENT"),ut=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),He=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{if(be=this.match(this.input,Ge,FormulaParser.FOLLOW_FORSTATEMENT_in_forLoop652),this.state.failed||(this.state.backtracking===0&&Je.add(be),Pe=this.match(this.input,Qe,FormulaParser.FOLLOW_IDENT_in_forLoop654),this.state.failed)||(this.state.backtracking===0&&st.add(Pe),Se=this.match(this.input,ht,FormulaParser.FOLLOW_FROMSTATEMENT_in_forLoop656),this.state.failed)||(this.state.backtracking===0&&Ze.add(Se),this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_forLoop658),Ve=this.logicalExpression(),this.state._fsp--,this.state.failed)||(this.state.backtracking===0&&He.add(Ve.getTree()),ke=this.match(this.input,ot,FormulaParser.FOLLOW_TOSTATEMENT_in_forLoop660),this.state.failed)||(this.state.backtracking===0&&it.add(ke),this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_forLoop662),$e=this.logicalExpression(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&He.add($e.getTree());var rt=2,vt=this.input.LA(1);switch(vt==nt&&(rt=1),rt){case 1:if(Ae=this.match(this.input,nt,FormulaParser.FOLLOW_BYSTATEMENT_in_forLoop665),this.state.failed||(this.state.backtracking===0&&lt.add(Ae),this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_forLoop667),Ue=this.logicalExpression(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&He.add(Ue.getTree());break}var wt=0;e:do{var Ot=2,Xe=this.input.LA(1);switch(Xe==Me&&(Ot=1),Ot){case 1:if(Re=this.match(this.input,Me,FormulaParser.FOLLOW_NEWLINE_in_forLoop671),this.state.failed)return fe;this.state.backtracking===0&&ze.add(Re);break;default:if(wt>=1)break e;if(this.state.backtracking>0)return this.state.failed=!0,fe;var _t=new org.antlr.runtime.EarlyExitException(10,this.input);throw _t}wt++}while(!0);if(this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_forLoop674),Be=this.innerBlock(),this.state._fsp--,this.state.failed||(this.state.backtracking===0&&ut.add(Be.getTree()),Ce=this.match(this.input,at,FormulaParser.FOLLOW_ENDBLOCK_in_forLoop677),this.state.failed)||(this.state.backtracking===0&&ct.add(Ce),Ie=this.match(this.input,je,FormulaParser.FOLLOW_LOOPSTATEMENT_in_forLoop679),this.state.failed))return fe;if(this.state.backtracking===0&&ft.add(Ie),this.state.backtracking===0){fe.tree=Ee;var mt=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var Tt=this.adaptor.nil();Tt=this.adaptor.becomeRoot(this.adaptor.create(me,"FOR"),Tt),this.adaptor.addChild(Tt,st.nextNode());{var Nt=this.adaptor.nil();for(Nt=this.adaptor.becomeRoot(this.adaptor.create(ae,"PARAMS"),Nt);He.hasNext();)this.adaptor.addChild(Nt,He.nextTree());He.reset(),this.adaptor.addChild(Tt,Nt)}this.adaptor.addChild(Tt,ut.nextTree()),this.adaptor.addChild(Ee,Tt)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(bt){if(bt instanceof org.antlr.runtime.RecognitionException)this.reportError(bt),this.recover(this.input,bt),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),bt);else throw bt}finally{}return fe},forInLoop_return:function(){FormulaParser.forInLoop_return=function(){},org.antlr.lang.extend(FormulaParser.forInLoop_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),forInLoop:function(){var fe=new FormulaParser.forInLoop_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=null,ke=null,Ae=null,Re=null,Ce=null,Ie=null,Ve=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token FORSTATEMENT"),$e=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),Ue=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),Be=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),Je=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token LOOPSTATEMENT"),st=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token INSTATEMENT"),Ze=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),ze=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{if(be=this.match(this.input,Ge,FormulaParser.FOLLOW_FORSTATEMENT_in_forInLoop707),this.state.failed||(this.state.backtracking===0&&Ve.add(be),Pe=this.match(this.input,Qe,FormulaParser.FOLLOW_IDENT_in_forInLoop709),this.state.failed)||(this.state.backtracking===0&&$e.add(Pe),Se=this.match(this.input,qe,FormulaParser.FOLLOW_INSTATEMENT_in_forInLoop711),this.state.failed)||(this.state.backtracking===0&&st.add(Se),this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_forInLoop713),Ce=this.logicalExpression(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&ze.add(Ce.getTree());var it=0;e:do{var ct=2,ft=this.input.LA(1);switch(ft==Me&&(ct=1),ct){case 1:if(ke=this.match(this.input,Me,FormulaParser.FOLLOW_NEWLINE_in_forInLoop715),this.state.failed)return fe;this.state.backtracking===0&&Ue.add(ke);break;default:if(it>=1)break e;if(this.state.backtracking>0)return this.state.failed=!0,fe;var lt=new org.antlr.runtime.EarlyExitException(11,this.input);throw lt}it++}while(!0);if(this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_forInLoop718),Ie=this.innerBlock(),this.state._fsp--,this.state.failed||(this.state.backtracking===0&&Ze.add(Ie.getTree()),Ae=this.match(this.input,at,FormulaParser.FOLLOW_ENDBLOCK_in_forInLoop721),this.state.failed)||(this.state.backtracking===0&&Be.add(Ae),Re=this.match(this.input,je,FormulaParser.FOLLOW_LOOPSTATEMENT_in_forInLoop723),this.state.failed))return fe;if(this.state.backtracking===0&&Je.add(Re),this.state.backtracking===0){fe.tree=Ee;var ut=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var He=this.adaptor.nil();He=this.adaptor.becomeRoot(this.adaptor.create(ve,"FORIN"),He),this.adaptor.addChild(He,$e.nextNode()),this.adaptor.addChild(He,ze.nextTree()),this.adaptor.addChild(He,Ze.nextTree()),this.adaptor.addChild(Ee,He)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(rt){if(rt instanceof org.antlr.runtime.RecognitionException)this.reportError(rt),this.recover(this.input,rt),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),rt);else throw rt}finally{}return fe},ifThenElse_return:function(){FormulaParser.ifThenElse_return=function(){},org.antlr.lang.extend(FormulaParser.ifThenElse_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),ifThenElse:function(){var fe=new FormulaParser.ifThenElse_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=null,ke=null,Ae=null,Re=null,Ce=null,Ie=null,Ve=null,$e=null,Ue=null,Be=null,Je=null,st=null,Ze=null,ze=null,it=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IFSTATEMENT"),ct=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),ft=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),lt=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ELSESTATEMENT"),ut=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token THENSTATEMENT"),He=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),rt=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{if(be=this.match(this.input,Ke,FormulaParser.FOLLOW_IFSTATEMENT_in_ifThenElse748),this.state.failed||(this.state.backtracking===0&&it.add(be),this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_ifThenElse750),Be=this.logicalExpression(),this.state._fsp--,this.state.failed)||(this.state.backtracking===0&&rt.add(Be.getTree()),Pe=this.match(this.input,et,FormulaParser.FOLLOW_THENSTATEMENT_in_ifThenElse752),this.state.failed))return fe;this.state.backtracking===0&&ut.add(Pe);var vt=0;e:do{var wt=2,Ot=this.input.LA(1);switch(Ot==Me&&(wt=1),wt){case 1:if(Se=this.match(this.input,Me,FormulaParser.FOLLOW_NEWLINE_in_ifThenElse755),this.state.failed)return fe;this.state.backtracking===0&&ct.add(Se);break;default:if(vt>=1)break e;if(this.state.backtracking>0)return this.state.failed=!0,fe;var Xe=new org.antlr.runtime.EarlyExitException(12,this.input);throw Xe}vt++}while(!0);if(this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_ifThenElse758),Je=this.innerBlock(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&He.add(Je.getTree());e:do{var _t=2,mt=this.input.LA(1);if(mt==tt){var Tt=this.input.LA(2);Tt==Ke&&(_t=1)}switch(_t){case 1:if(ke=this.match(this.input,tt,FormulaParser.FOLLOW_ELSESTATEMENT_in_ifThenElse762),this.state.failed||(this.state.backtracking===0&&lt.add(ke),Ae=this.match(this.input,Ke,FormulaParser.FOLLOW_IFSTATEMENT_in_ifThenElse764),this.state.failed)||(this.state.backtracking===0&&it.add(Ae),this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_ifThenElse766),st=this.logicalExpression(),this.state._fsp--,this.state.failed)||(this.state.backtracking===0&&rt.add(st.getTree()),Re=this.match(this.input,et,FormulaParser.FOLLOW_THENSTATEMENT_in_ifThenElse768),this.state.failed))return fe;this.state.backtracking===0&&ut.add(Re);var Nt=0;t:do{var bt=2,yt=this.input.LA(1);switch(yt==Me&&(bt=1),bt){case 1:if(Ce=this.match(this.input,Me,FormulaParser.FOLLOW_NEWLINE_in_ifThenElse770),this.state.failed)return fe;this.state.backtracking===0&&ct.add(Ce);break;default:if(Nt>=1)break t;if(this.state.backtracking>0)return this.state.failed=!0,fe;var Xe=new org.antlr.runtime.EarlyExitException(13,this.input);throw Xe}Nt++}while(!0);if(this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_ifThenElse773),Ze=this.innerBlock(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&He.add(Ze.getTree());break;default:break e}}while(!0);var Ft=2,It=this.input.LA(1);switch(It==tt&&(Ft=1),Ft){case 1:if(Ie=this.match(this.input,tt,FormulaParser.FOLLOW_ELSESTATEMENT_in_ifThenElse778),this.state.failed)return fe;this.state.backtracking===0&&lt.add(Ie);var Yt=0;e:do{var Qt=2,Ht=this.input.LA(1);switch(Ht==Me&&(Qt=1),Qt){case 1:if(Ve=this.match(this.input,Me,FormulaParser.FOLLOW_NEWLINE_in_ifThenElse780),this.state.failed)return fe;this.state.backtracking===0&&ct.add(Ve);break;default:if(Yt>=1)break e;if(this.state.backtracking>0)return this.state.failed=!0,fe;var Xe=new org.antlr.runtime.EarlyExitException(15,this.input);throw Xe}Yt++}while(!0);if(this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_ifThenElse783),ze=this.innerBlock(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&He.add(ze.getTree());break}if($e=this.match(this.input,at,FormulaParser.FOLLOW_ENDBLOCK_in_ifThenElse787),this.state.failed||(this.state.backtracking===0&&ft.add($e),Ue=this.match(this.input,Ke,FormulaParser.FOLLOW_IFSTATEMENT_in_ifThenElse789),this.state.failed))return fe;if(this.state.backtracking===0&&it.add(Ue),this.state.backtracking===0){fe.tree=Ee;var Xt=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var Dt=this.adaptor.nil();Dt=this.adaptor.becomeRoot(this.adaptor.create(de,"IFTHENELSE"),Dt);{var dt=this.adaptor.nil();if(dt=this.adaptor.becomeRoot(this.adaptor.create(ae,"PARAMS"),dt),!rt.hasNext())throw new org.antlr.runtime.tree.RewriteEarlyExitException;for(;rt.hasNext();)this.adaptor.addChild(dt,rt.nextTree());rt.reset(),this.adaptor.addChild(Dt,dt)}{var dt=this.adaptor.nil();if(dt=this.adaptor.becomeRoot(this.adaptor.create(ae,"PARAMS"),dt),!He.hasNext())throw new org.antlr.runtime.tree.RewriteEarlyExitException;for(;He.hasNext();)this.adaptor.addChild(dt,He.nextTree());He.reset(),this.adaptor.addChild(Dt,dt)}this.adaptor.addChild(Ee,Dt)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(zt){if(zt instanceof org.antlr.runtime.RecognitionException)this.reportError(zt),this.recover(this.input,zt),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),zt);else throw zt}finally{}return fe},functionDef_return:function(){FormulaParser.functionDef_return=function(){},org.antlr.lang.extend(FormulaParser.functionDef_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),functionDef:function(){var fe=new FormulaParser.functionDef_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=null,ke=null,Ae=null,Re=null,Ce=null,Ie=null,Ve=null,$e=null,Ue=null,Be=null,Je=null,st=null,Ze=null,ze=null,it=null,ct=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token FUNCTIONSTATEMENT"),ft=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 114"),lt=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),ut=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token EQUALS"),He=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 113"),rt=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),vt=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COMMA"),wt=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),Ot=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),Xe=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule defaultValue");try{if(be=this.match(this.input,Ye,FormulaParser.FOLLOW_FUNCTIONSTATEMENT_in_functionDef820),this.state.failed||(this.state.backtracking===0&&ct.add(be),Pe=this.match(this.input,Qe,FormulaParser.FOLLOW_IDENT_in_functionDef822),this.state.failed)||(this.state.backtracking===0&&lt.add(Pe),Se=this.match(this.input,113,FormulaParser.FOLLOW_113_in_functionDef824),this.state.failed))return fe;this.state.backtracking===0&&He.add(Se);var _t=2,mt=this.input.LA(1);switch(mt==Qe&&(_t=1),_t){case 1:if(ke=this.match(this.input,Qe,FormulaParser.FOLLOW_IDENT_in_functionDef827),this.state.failed)return fe;this.state.backtracking===0&&lt.add(ke);var Tt=2,Nt=this.input.LA(1);if(Nt==Rt)Tt=1;else if(Nt==pt||Nt==114)Tt=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var bt=new org.antlr.runtime.NoViableAltException("",18,0,this.input);throw bt}switch(Tt){case 1:if(Ae=this.match(this.input,Rt,FormulaParser.FOLLOW_EQUALS_in_functionDef831),this.state.failed||(this.state.backtracking===0&&ut.add(Ae),this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_functionDef834),Ze=this.defaultValue(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&Xe.add(Ze.getTree());break;case 2:e:do{var yt=2,Ft=this.input.LA(1);if(Ft==pt){var It=this.input.LA(2);if(It==Qe){var Yt=this.input.LA(3);(Yt==pt||Yt==114)&&(yt=1)}}switch(yt){case 1:if(Re=this.match(this.input,pt,FormulaParser.FOLLOW_COMMA_in_functionDef839),this.state.failed||(this.state.backtracking===0&&vt.add(Re),Ce=this.match(this.input,Qe,FormulaParser.FOLLOW_IDENT_in_functionDef841),this.state.failed))return fe;this.state.backtracking===0&&lt.add(Ce);break;default:break e}}while(!0);break}e:do{var Qt=2,Ht=this.input.LA(1);switch(Ht==pt&&(Qt=1),Qt){case 1:if(Ie=this.match(this.input,pt,FormulaParser.FOLLOW_COMMA_in_functionDef848),this.state.failed||(this.state.backtracking===0&&vt.add(Ie),Ve=this.match(this.input,Qe,FormulaParser.FOLLOW_IDENT_in_functionDef850),this.state.failed)||(this.state.backtracking===0&&lt.add(Ve),$e=this.match(this.input,Rt,FormulaParser.FOLLOW_EQUALS_in_functionDef852),this.state.failed)||(this.state.backtracking===0&&ut.add($e),this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_functionDef854),ze=this.defaultValue(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&Xe.add(ze.getTree());break;default:break e}}while(!0);break}if(Ue=this.match(this.input,114,FormulaParser.FOLLOW_114_in_functionDef861),this.state.failed)return fe;this.state.backtracking===0&&ft.add(Ue);var Xt=0;e:do{var Dt=2,dt=this.input.LA(1);switch(dt==Me&&(Dt=1),Dt){case 1:if(Be=this.match(this.input,Me,FormulaParser.FOLLOW_NEWLINE_in_functionDef863),this.state.failed)return fe;this.state.backtracking===0&&rt.add(Be);break;default:if(Xt>=1)break e;if(this.state.backtracking>0)return this.state.failed=!0,fe;var zt=new org.antlr.runtime.EarlyExitException(21,this.input);throw zt}Xt++}while(!0);if(this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_functionDef866),it=this.innerBlock(),this.state._fsp--,this.state.failed||(this.state.backtracking===0&&Ot.add(it.getTree()),Je=this.match(this.input,at,FormulaParser.FOLLOW_ENDBLOCK_in_functionDef869),this.state.failed)||(this.state.backtracking===0&&wt.add(Je),st=this.match(this.input,Ye,FormulaParser.FOLLOW_FUNCTIONSTATEMENT_in_functionDef871),this.state.failed))return fe;if(this.state.backtracking===0&&ct.add(st),this.state.backtracking===0){fe.tree=Ee;var er=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var Gt=this.adaptor.nil();Gt=this.adaptor.becomeRoot(this.adaptor.create(we,"FUNCTION"),Gt);{var qt=this.adaptor.nil();for(qt=this.adaptor.becomeRoot(this.adaptor.create(ae,"PARAMS"),qt);lt.hasNext();)this.adaptor.addChild(qt,lt.nextNode());lt.reset(),this.adaptor.addChild(Gt,qt)}{var qt=this.adaptor.nil();for(qt=this.adaptor.becomeRoot(this.adaptor.create(ue,"DEFAULTS"),qt);Xe.hasNext();)this.adaptor.addChild(qt,Xe.nextTree());Xe.reset(),this.adaptor.addChild(Gt,qt)}this.adaptor.addChild(Gt,Ot.nextTree()),this.adaptor.addChild(Ee,Gt)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Jt){if(Jt instanceof org.antlr.runtime.RecognitionException)this.reportError(Jt),this.recover(this.input,Jt),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Jt);else throw Jt}finally{}return fe},tryCatch_return:function(){FormulaParser.tryCatch_return=function(){},org.antlr.lang.extend(FormulaParser.tryCatch_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),tryCatch:function(){var fe=new FormulaParser.tryCatch_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=null,ke=null,Ae=null,Re=null,Ce=null,Ie=null,Ve=null,$e=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),Ue=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token TRYSTATEMENT"),Be=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),Je=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token CATCHSTATEMENT"),st=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),Ze=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock");try{if(be=this.match(this.input,gt,FormulaParser.FOLLOW_TRYSTATEMENT_in_tryCatch904),this.state.failed)return fe;this.state.backtracking===0&&Ue.add(be);var ze=0;e:do{var it=2,ct=this.input.LA(1);switch(ct==Me&&(it=1),it){case 1:if(Pe=this.match(this.input,Me,FormulaParser.FOLLOW_NEWLINE_in_tryCatch906),this.state.failed)return fe;this.state.backtracking===0&&Be.add(Pe);break;default:if(ze>=1)break e;if(this.state.backtracking>0)return this.state.failed=!0,fe;var ft=new org.antlr.runtime.EarlyExitException(22,this.input);throw ft}ze++}while(!0);if(this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_tryCatch909),Ie=this.innerBlock(),this.state._fsp--,this.state.failed||(this.state.backtracking===0&&Ze.add(Ie.getTree()),Se=this.match(this.input,jt,FormulaParser.FOLLOW_CATCHSTATEMENT_in_tryCatch911),this.state.failed)||(this.state.backtracking===0&&Je.add(Se),ke=this.match(this.input,Qe,FormulaParser.FOLLOW_IDENT_in_tryCatch913),this.state.failed))return fe;this.state.backtracking===0&&$e.add(ke);var lt=0;e:do{var ut=2,He=this.input.LA(1);switch(He==Me&&(ut=1),ut){case 1:if(Ae=this.match(this.input,Me,FormulaParser.FOLLOW_NEWLINE_in_tryCatch915),this.state.failed)return fe;this.state.backtracking===0&&Be.add(Ae);break;default:if(lt>=1)break e;if(this.state.backtracking>0)return this.state.failed=!0,fe;var ft=new org.antlr.runtime.EarlyExitException(23,this.input);throw ft}lt++}while(!0);if(this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_tryCatch919),Ve=this.innerBlock(),this.state._fsp--,this.state.failed||(this.state.backtracking===0&&Ze.add(Ve.getTree()),Re=this.match(this.input,at,FormulaParser.FOLLOW_ENDBLOCK_in_tryCatch921),this.state.failed)||(this.state.backtracking===0&&st.add(Re),Ce=this.match(this.input,gt,FormulaParser.FOLLOW_TRYSTATEMENT_in_tryCatch923),this.state.failed))return fe;if(this.state.backtracking===0&&Ue.add(Ce),this.state.backtracking===0){fe.tree=Ee;var rt=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var vt=this.adaptor.nil();for(vt=this.adaptor.becomeRoot(this.adaptor.create(Fe,"TRYCATCH"),vt);Ze.hasNext();)this.adaptor.addChild(vt,Ze.nextTree());Ze.reset(),this.adaptor.addChild(vt,$e.nextNode()),this.adaptor.addChild(Ee,vt)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(wt){if(wt instanceof org.antlr.runtime.RecognitionException)this.reportError(wt),this.recover(this.input,wt),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),wt);else throw wt}finally{}return fe},throwExp_return:function(){FormulaParser.throwExp_return=function(){},org.antlr.lang.extend(FormulaParser.throwExp_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),throwExp:function(){var fe=new FormulaParser.throwExp_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token THROWSTATEMENT"),ke=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule primaryExpression");try{if(be=this.match(this.input,St,FormulaParser.FOLLOW_THROWSTATEMENT_in_throwExp945),this.state.failed||(this.state.backtracking===0&&Se.add(be),this.pushFollow(FormulaParser.FOLLOW_primaryExpression_in_throwExp947),Pe=this.primaryExpression(),this.state._fsp--,this.state.failed))return fe;if(this.state.backtracking===0&&ke.add(Pe.getTree()),this.state.backtracking===0){fe.tree=Ee;var Ae=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var Re=this.adaptor.nil();Re=this.adaptor.becomeRoot(this.adaptor.create(De,"THROW"),Re),this.adaptor.addChild(Re,ke.nextTree()),this.adaptor.addChild(Ee,Re)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Ce){if(Ce instanceof org.antlr.runtime.RecognitionException)this.reportError(Ce),this.recover(this.input,Ce),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Ce);else throw Ce}finally{}return fe},anonFunctionDef_return:function(){FormulaParser.anonFunctionDef_return=function(){},org.antlr.lang.extend(FormulaParser.anonFunctionDef_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),anonFunctionDef:function(){var fe=new FormulaParser.anonFunctionDef_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=null,ke=null,Ae=null,Re=null,Ce=null,Ie=null,Ve=null,$e=null,Ue=null,Be=null,Je=null,st=null,Ze=null,ze=null,it=null,ct=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token FUNCTIONSTATEMENT"),ft=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 114"),lt=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),ut=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token EQUALS"),He=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 113"),rt=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),vt=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COMMA"),wt=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),Ot=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule expression"),Xe=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),_t=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule defaultValue");try{if(be=this.match(this.input,Ye,FormulaParser.FOLLOW_FUNCTIONSTATEMENT_in_anonFunctionDef967),this.state.failed||(this.state.backtracking===0&&ct.add(be),Pe=this.match(this.input,113,FormulaParser.FOLLOW_113_in_anonFunctionDef970),this.state.failed))return fe;this.state.backtracking===0&&He.add(Pe);var mt=2,Tt=this.input.LA(1);switch(Tt==Qe&&(mt=1),mt){case 1:if(Se=this.match(this.input,Qe,FormulaParser.FOLLOW_IDENT_in_anonFunctionDef973),this.state.failed)return fe;this.state.backtracking===0&&lt.add(Se);var Nt=2,bt=this.input.LA(1);if(bt==Rt)Nt=1;else if(bt==pt||bt==114)Nt=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var yt=new org.antlr.runtime.NoViableAltException("",25,0,this.input);throw yt}switch(Nt){case 1:if(ke=this.match(this.input,Rt,FormulaParser.FOLLOW_EQUALS_in_anonFunctionDef977),this.state.failed||(this.state.backtracking===0&&ut.add(ke),this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_anonFunctionDef980),st=this.defaultValue(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&_t.add(st.getTree());break;case 2:e:do{var Ft=2,It=this.input.LA(1);if(It==pt){var Yt=this.input.LA(2);if(Yt==Qe){var Qt=this.input.LA(3);(Qt==pt||Qt==114)&&(Ft=1)}}switch(Ft){case 1:if(Ae=this.match(this.input,pt,FormulaParser.FOLLOW_COMMA_in_anonFunctionDef985),this.state.failed||(this.state.backtracking===0&&vt.add(Ae),Re=this.match(this.input,Qe,FormulaParser.FOLLOW_IDENT_in_anonFunctionDef987),this.state.failed))return fe;this.state.backtracking===0&&lt.add(Re);break;default:break e}}while(!0);break}e:do{var Ht=2,Xt=this.input.LA(1);switch(Xt==pt&&(Ht=1),Ht){case 1:if(Ce=this.match(this.input,pt,FormulaParser.FOLLOW_COMMA_in_anonFunctionDef994),this.state.failed||(this.state.backtracking===0&&vt.add(Ce),Ie=this.match(this.input,Qe,FormulaParser.FOLLOW_IDENT_in_anonFunctionDef996),this.state.failed)||(this.state.backtracking===0&&lt.add(Ie),Ve=this.match(this.input,Rt,FormulaParser.FOLLOW_EQUALS_in_anonFunctionDef998),this.state.failed)||(this.state.backtracking===0&&ut.add(Ve),this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_anonFunctionDef1000),Ze=this.defaultValue(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&_t.add(Ze.getTree());break;default:break e}}while(!0);break}if($e=this.match(this.input,114,FormulaParser.FOLLOW_114_in_anonFunctionDef1007),this.state.failed)return fe;this.state.backtracking===0&&ft.add($e);var Dt=2,dt=this.input.LA(1);if(dt==Me)Dt=1;else if(dt==We||dt==Ge||dt==Ke||dt==Ye||dt>=Bt&&dt<=gt||dt>=St&&dt<=Qe||dt==Pt||dt==Ct||dt>=Kt&&dt<=xt||dt==kt||dt>=$t&&dt<=Vt||dt==113)Dt=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var yt=new org.antlr.runtime.NoViableAltException("",29,0,this.input);throw yt}switch(Dt){case 1:var zt=0;e:do{var er=2,Gt=this.input.LA(1);switch(Gt==Me&&(er=1),er){case 1:if(Ue=this.match(this.input,Me,FormulaParser.FOLLOW_NEWLINE_in_anonFunctionDef1012),this.state.failed)return fe;this.state.backtracking===0&&rt.add(Ue);break;default:if(zt>=1)break e;if(this.state.backtracking>0)return this.state.failed=!0,fe;var qt=new org.antlr.runtime.EarlyExitException(28,this.input);throw qt}zt++}while(!0);if(this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_anonFunctionDef1015),ze=this.innerBlock(),this.state._fsp--,this.state.failed||(this.state.backtracking===0&&Xe.add(ze.getTree()),Be=this.match(this.input,at,FormulaParser.FOLLOW_ENDBLOCK_in_anonFunctionDef1018),this.state.failed)||(this.state.backtracking===0&&wt.add(Be),Je=this.match(this.input,Ye,FormulaParser.FOLLOW_FUNCTIONSTATEMENT_in_anonFunctionDef1020),this.state.failed))return fe;this.state.backtracking===0&&ct.add(Je);break;case 2:if(this.pushFollow(FormulaParser.FOLLOW_expression_in_anonFunctionDef1025),it=this.expression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&Ot.add(it.getTree());break}if(this.state.backtracking===0){fe.tree=Ee;var Jt=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var Lt=this.adaptor.nil();Lt=this.adaptor.becomeRoot(this.adaptor.create(ge,"ANONFUNCTION"),Lt);{var At=this.adaptor.nil();for(At=this.adaptor.becomeRoot(this.adaptor.create(ae,"PARAMS"),At);lt.hasNext();)this.adaptor.addChild(At,lt.nextNode());lt.reset(),this.adaptor.addChild(Lt,At)}{var At=this.adaptor.nil();for(At=this.adaptor.becomeRoot(this.adaptor.create(ue,"DEFAULTS"),At);_t.hasNext();)this.adaptor.addChild(At,_t.nextTree());_t.reset(),this.adaptor.addChild(Lt,At)}Xe.hasNext()&&this.adaptor.addChild(Lt,Xe.nextTree()),Xe.reset(),Ot.hasNext()&&this.adaptor.addChild(Lt,Ot.nextTree()),Ot.reset(),this.adaptor.addChild(Ee,Lt)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Mt){if(Mt instanceof org.antlr.runtime.RecognitionException)this.reportError(Mt),this.recover(this.input,Mt),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Mt);else throw Mt}finally{}return fe},assignment_return:function(){FormulaParser.assignment_return=function(){},org.antlr.lang.extend(FormulaParser.assignment_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),assignment:function(){var fe=new FormulaParser.assignment_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=null,ke=null,Ae=null,Re=null,Ce=null,Ie=null,Ve=null,$e=null,Ue=null,Be=null,Je=null,st=null,Ze=null,ze=null,it=null,ct=null,ft=null,lt=null,ut=null,He=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 114"),rt=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),vt=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 115"),wt=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token EQUALS"),Ot=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 113"),Xe=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COMMA"),_t=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token PRIMITIVE"),mt=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule assigned"),Tt=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule defaultValue"),Nt=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{var bt=2,yt=this.input.LA(1);if(yt==Qe){var Ft=this.input.LA(2);if(Ft==113)bt=1;else if(Ft==xt||Ft==kt||Ft==pt||Ft>=115&&Ft<=116)bt=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var It=new org.antlr.runtime.NoViableAltException("",37,1,this.input);throw It}}else if(yt==Pt)bt=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var It=new org.antlr.runtime.NoViableAltException("",37,0,this.input);throw It}switch(bt){case 1:if(be=this.match(this.input,Qe,FormulaParser.FOLLOW_IDENT_in_assignment1067),this.state.failed||(this.state.backtracking===0&&rt.add(be),Pe=this.match(this.input,113,FormulaParser.FOLLOW_113_in_assignment1069),this.state.failed))return fe;this.state.backtracking===0&&Ot.add(Pe);var Yt=2,Qt=this.input.LA(1);switch(Qt==Qe&&(Yt=1),Yt){case 1:if(Se=this.match(this.input,Qe,FormulaParser.FOLLOW_IDENT_in_assignment1072),this.state.failed)return fe;this.state.backtracking===0&&rt.add(Se);var Ht=2,Xt=this.input.LA(1);if(Xt==Rt)Ht=1;else if(Xt==pt||Xt==114)Ht=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var It=new org.antlr.runtime.NoViableAltException("",31,0,this.input);throw It}switch(Ht){case 1:if(ke=this.match(this.input,Rt,FormulaParser.FOLLOW_EQUALS_in_assignment1076),this.state.failed||(this.state.backtracking===0&&wt.add(ke),this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_assignment1078),ze=this.defaultValue(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&Tt.add(ze.getTree());break;case 2:e:do{var Dt=2,dt=this.input.LA(1);if(dt==pt){var zt=this.input.LA(2);if(zt==Qe){var er=this.input.LA(3);(er==pt||er==114)&&(Dt=1)}}switch(Dt){case 1:if(Ae=this.match(this.input,pt,FormulaParser.FOLLOW_COMMA_in_assignment1083),this.state.failed||(this.state.backtracking===0&&Xe.add(Ae),Re=this.match(this.input,Qe,FormulaParser.FOLLOW_IDENT_in_assignment1085),this.state.failed))return fe;this.state.backtracking===0&&rt.add(Re);break;default:break e}}while(!0);break}e:do{var Gt=2,qt=this.input.LA(1);switch(qt==pt&&(Gt=1),Gt){case 1:if(Ce=this.match(this.input,pt,FormulaParser.FOLLOW_COMMA_in_assignment1092),this.state.failed||(this.state.backtracking===0&&Xe.add(Ce),Ie=this.match(this.input,Qe,FormulaParser.FOLLOW_IDENT_in_assignment1094),this.state.failed)||(this.state.backtracking===0&&rt.add(Ie),Ve=this.match(this.input,Rt,FormulaParser.FOLLOW_EQUALS_in_assignment1096),this.state.failed)||(this.state.backtracking===0&&wt.add(Ve),this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_assignment1098),it=this.defaultValue(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&Tt.add(it.getTree());break;default:break e}}while(!0);break}if($e=this.match(this.input,114,FormulaParser.FOLLOW_114_in_assignment1105),this.state.failed||(this.state.backtracking===0&&He.add($e),Ue=this.match(this.input,115,FormulaParser.FOLLOW_115_in_assignment1107),this.state.failed)||(this.state.backtracking===0&&vt.add(Ue),this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_assignment1109),ct=this.logicalExpression(),this.state._fsp--,this.state.failed))return fe;if(this.state.backtracking===0&&Nt.add(ct.getTree()),this.state.backtracking===0){fe.tree=Ee;var Jt=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var Lt=this.adaptor.nil();Lt=this.adaptor.becomeRoot(this.adaptor.create(we,"FUNCTION"),Lt);{var At=this.adaptor.nil();for(At=this.adaptor.becomeRoot(this.adaptor.create(ae,"PARAMS"),At);rt.hasNext();)this.adaptor.addChild(At,rt.nextNode());rt.reset(),this.adaptor.addChild(Lt,At)}{var At=this.adaptor.nil();for(At=this.adaptor.becomeRoot(this.adaptor.create(ue,"DEFAULTS"),At);Tt.hasNext();)this.adaptor.addChild(At,Tt.nextTree());Tt.reset(),this.adaptor.addChild(Lt,At)}this.adaptor.addChild(Lt,Nt.nextTree()),this.adaptor.addChild(Ee,Lt)}fe.tree=Ee}break;case 2:var Mt=2,sr=this.input.LA(1);if(sr==Pt)Mt=1;else if(sr==Qe)Mt=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var It=new org.antlr.runtime.NoViableAltException("",34,0,this.input);throw It}switch(Mt){case 1:if(Be=this.match(this.input,Pt,FormulaParser.FOLLOW_PRIMITIVE_in_assignment1137),this.state.failed)return fe;this.state.backtracking===0&&_t.add(Be);break;case 2:if(this.pushFollow(FormulaParser.FOLLOW_assigned_in_assignment1141),ft=this.assigned(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&mt.add(ft.getTree());break}e:do{var hr=2,yr=this.input.LA(1);switch(yr==pt&&(hr=1),hr){case 1:if(Je=this.match(this.input,pt,FormulaParser.FOLLOW_COMMA_in_assignment1145),this.state.failed)return fe;this.state.backtracking===0&&Xe.add(Je);var nr=2,or=this.input.LA(1);if(or==Pt)nr=1;else if(or==Qe)nr=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var It=new org.antlr.runtime.NoViableAltException("",35,0,this.input);throw It}switch(nr){case 1:if(st=this.match(this.input,Pt,FormulaParser.FOLLOW_PRIMITIVE_in_assignment1148),this.state.failed)return fe;this.state.backtracking===0&&_t.add(st);break;case 2:if(this.pushFollow(FormulaParser.FOLLOW_assigned_in_assignment1152),lt=this.assigned(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&mt.add(lt.getTree());break}break;default:break e}}while(!0);if(Ze=this.match(this.input,115,FormulaParser.FOLLOW_115_in_assignment1158),this.state.failed||(this.state.backtracking===0&&vt.add(Ze),this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_assignment1160),ut=this.logicalExpression(),this.state._fsp--,this.state.failed))return fe;if(this.state.backtracking===0&&Nt.add(ut.getTree()),this.state.backtracking===0){fe.tree=Ee;var Jt=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var Lt=this.adaptor.nil();for(Lt=this.adaptor.becomeRoot(this.adaptor.create(re,"ASSIGN"),Lt);_t.hasNext();)this.adaptor.addChild(Lt,_t.nextNode());for(_t.reset();mt.hasNext();)this.adaptor.addChild(Lt,mt.nextTree());mt.reset(),this.adaptor.addChild(Lt,Nt.nextTree()),this.adaptor.addChild(Ee,Lt)}fe.tree=Ee}break}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(rr){if(rr instanceof org.antlr.runtime.RecognitionException)this.reportError(rr),this.recover(this.input,rr),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),rr);else throw rr}finally{}return fe},assigned_return:function(){FormulaParser.assigned_return=function(){},org.antlr.lang.extend(FormulaParser.assigned_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),assigned:function(){var fe=new FormulaParser.assigned_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),ke=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule selector");try{if(be=this.match(this.input,Qe,FormulaParser.FOLLOW_IDENT_in_assigned1186),this.state.failed)return fe;this.state.backtracking===0&&Se.add(be);var Ae=2,Re=this.input.LA(1);switch((Re==xt||Re==kt||Re==116)&&(Ae=1),Ae){case 1:if(this.pushFollow(FormulaParser.FOLLOW_selector_in_assigned1188),Pe=this.selector(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&ke.add(Pe.getTree());break}if(this.state.backtracking===0){fe.tree=Ee;var Ce=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var Ie=this.adaptor.nil();Ie=this.adaptor.becomeRoot(this.adaptor.create(ye,"ASSIGNED"),Ie),this.adaptor.addChild(Ie,Se.nextNode()),ke.hasNext()&&this.adaptor.addChild(Ie,ke.nextTree()),ke.reset(),this.adaptor.addChild(Ee,Ie)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Ve){if(Ve instanceof org.antlr.runtime.RecognitionException)this.reportError(Ve),this.recover(this.input,Ve),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Ve);else throw Ve}finally{}return fe},logicalExpression_return:function(){FormulaParser.logicalExpression_return=function(){},org.antlr.lang.extend(FormulaParser.logicalExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),logicalExpression:function(){var fe=new FormulaParser.logicalExpression_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=null,ke=null;try{if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_booleanXORExpression_in_logicalExpression1214),Pe=this.booleanXORExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Pe.getTree());e:do{var Ae=2,Re=this.input.LA(1);if(Re==Ut){var Ce=this.input.LA(2);this.synpred47_Formula()&&(Ae=1)}switch(Ae){case 1:if(be=this.match(this.input,Ut,FormulaParser.FOLLOW_OR_in_logicalExpression1217),this.state.failed||(this.state.backtracking===0&&(ke=this.adaptor.create(be),Ee=this.adaptor.becomeRoot(ke,Ee)),this.pushFollow(FormulaParser.FOLLOW_booleanXORExpression_in_logicalExpression1220),Se=this.booleanXORExpression(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Se.getTree());break;default:break e}}while(!0);fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Ie){if(Ie instanceof org.antlr.runtime.RecognitionException)this.reportError(Ie),this.recover(this.input,Ie),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Ie);else throw Ie}finally{}return fe},booleanXORExpression_return:function(){FormulaParser.booleanXORExpression_return=function(){},org.antlr.lang.extend(FormulaParser.booleanXORExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),booleanXORExpression:function(){var fe=new FormulaParser.booleanXORExpression_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=null,ke=null;try{if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_booleanAndExpression_in_booleanXORExpression1250),Pe=this.booleanAndExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Pe.getTree());e:do{var Ae=2,Re=this.input.LA(1);if(Re==Zt){var Ce=this.input.LA(2);this.synpred48_Formula()&&(Ae=1)}switch(Ae){case 1:if(be=this.match(this.input,Zt,FormulaParser.FOLLOW_XOR_in_booleanXORExpression1253),this.state.failed||(this.state.backtracking===0&&(ke=this.adaptor.create(be),Ee=this.adaptor.becomeRoot(ke,Ee)),this.pushFollow(FormulaParser.FOLLOW_booleanAndExpression_in_booleanXORExpression1256),Se=this.booleanAndExpression(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Se.getTree());break;default:break e}}while(!0);fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Ie){if(Ie instanceof org.antlr.runtime.RecognitionException)this.reportError(Ie),this.recover(this.input,Ie),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Ie);else throw Ie}finally{}return fe},booleanAndExpression_return:function(){FormulaParser.booleanAndExpression_return=function(){},org.antlr.lang.extend(FormulaParser.booleanAndExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),booleanAndExpression:function(){var fe=new FormulaParser.booleanAndExpression_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=null,ke=null;try{if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_equalityExpression_in_booleanAndExpression1285),Pe=this.equalityExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Pe.getTree());e:do{var Ae=2,Re=this.input.LA(1);if(Re==fr){var Ce=this.input.LA(2);this.synpred49_Formula()&&(Ae=1)}switch(Ae){case 1:if(be=this.match(this.input,fr,FormulaParser.FOLLOW_AND_in_booleanAndExpression1288),this.state.failed||(this.state.backtracking===0&&(ke=this.adaptor.create(be),Ee=this.adaptor.becomeRoot(ke,Ee)),this.pushFollow(FormulaParser.FOLLOW_equalityExpression_in_booleanAndExpression1291),Se=this.equalityExpression(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Se.getTree());break;default:break e}}while(!0);fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Ie){if(Ie instanceof org.antlr.runtime.RecognitionException)this.reportError(Ie),this.recover(this.input,Ie),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Ie);else throw Ie}finally{}return fe},equalityExpression_return:function(){FormulaParser.equalityExpression_return=function(){},org.antlr.lang.extend(FormulaParser.equalityExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),equalityExpression:function(){var fe=new FormulaParser.equalityExpression_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=null;try{if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_relationalExpression_in_equalityExpression1322),Pe=this.relationalExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Pe.getTree());e:do{var ke=2,Ae=this.input.LA(1);if(Ae==Rt||Ae==dr){var Re=this.input.LA(2);this.synpred51_Formula()&&(ke=1)}switch(ke){case 1:if(be=this.input.LT(1),this.input.LA(1)==Rt||this.input.LA(1)==dr)this.input.consume(),this.state.backtracking===0&&(Ee=this.adaptor.becomeRoot(this.adaptor.create(be),Ee)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Ce=new org.antlr.runtime.MismatchedSetException(null,this.input);throw Ce}if(this.pushFollow(FormulaParser.FOLLOW_relationalExpression_in_equalityExpression1332),Se=this.relationalExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Se.getTree());break;default:break e}}while(!0);fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Ie){if(Ie instanceof org.antlr.runtime.RecognitionException)this.reportError(Ie),this.recover(this.input,Ie),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Ie);else throw Ie}finally{}return fe},relationalExpression_return:function(){FormulaParser.relationalExpression_return=function(){},org.antlr.lang.extend(FormulaParser.relationalExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),relationalExpression:function(){var fe=new FormulaParser.relationalExpression_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=null;try{if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_additiveExpression_in_relationalExpression1374),Pe=this.additiveExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Pe.getTree());e:do{var ke=2,Ae=this.input.LA(1);if(Ae>=pr&&Ae<=mr){var Re=this.input.LA(2);this.synpred55_Formula()&&(ke=1)}switch(ke){case 1:if(be=this.input.LT(1),this.input.LA(1)>=pr&&this.input.LA(1)<=mr)this.input.consume(),this.state.backtracking===0&&(Ee=this.adaptor.becomeRoot(this.adaptor.create(be),Ee)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Ce=new org.antlr.runtime.MismatchedSetException(null,this.input);throw Ce}if(this.pushFollow(FormulaParser.FOLLOW_additiveExpression_in_relationalExpression1389),Se=this.additiveExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Se.getTree());break;default:break e}}while(!0);fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Ie){if(Ie instanceof org.antlr.runtime.RecognitionException)this.reportError(Ie),this.recover(this.input,Ie),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Ie);else throw Ie}finally{}return fe},additiveExpression_return:function(){FormulaParser.additiveExpression_return=function(){},org.antlr.lang.extend(FormulaParser.additiveExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),additiveExpression:function(){var fe=new FormulaParser.additiveExpression_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=null;try{if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_multiplicativeExpression_in_additiveExpression1432),Pe=this.multiplicativeExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Pe.getTree());e:do{var ke=2,Ae=this.input.LA(1);if(Ae>=gr&&Ae<=Ct){var Re=this.input.LA(2);this.synpred57_Formula()&&(ke=1)}switch(ke){case 1:if(be=this.input.LT(1),this.input.LA(1)>=gr&&this.input.LA(1)<=Ct)this.input.consume(),this.state.backtracking===0&&(Ee=this.adaptor.becomeRoot(this.adaptor.create(be),Ee)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Ce=new org.antlr.runtime.MismatchedSetException(null,this.input);throw Ce}if(this.pushFollow(FormulaParser.FOLLOW_multiplicativeExpression_in_additiveExpression1443),Se=this.multiplicativeExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Se.getTree());break;default:break e}}while(!0);fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Ie){if(Ie instanceof org.antlr.runtime.RecognitionException)this.reportError(Ie),this.recover(this.input,Ie),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Ie);else throw Ie}finally{}return fe},multiplicativeExpression_return:function(){FormulaParser.multiplicativeExpression_return=function(){},org.antlr.lang.extend(FormulaParser.multiplicativeExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),multiplicativeExpression:function(){var fe=new FormulaParser.multiplicativeExpression_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=null;try{if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_arrayExpression_in_multiplicativeExpression1473),Pe=this.arrayExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Pe.getTree());e:do{var ke=2,Ae=this.input.LA(1);if(Ae>=Wt&&Ae<=_r){var Re=this.input.LA(2);this.synpred60_Formula()&&(ke=1)}switch(ke){case 1:if(be=this.input.LT(1),this.input.LA(1)>=Wt&&this.input.LA(1)<=_r)this.input.consume(),this.state.backtracking===0&&(Ee=this.adaptor.becomeRoot(this.adaptor.create(be),Ee)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Ce=new org.antlr.runtime.MismatchedSetException(null,this.input);throw Ce}if(this.pushFollow(FormulaParser.FOLLOW_arrayExpression_in_multiplicativeExpression1486),Se=this.arrayExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Se.getTree());break;default:break e}}while(!0);fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Ie){if(Ie instanceof org.antlr.runtime.RecognitionException)this.reportError(Ie),this.recover(this.input,Ie),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Ie);else throw Ie}finally{}return fe},arrayExpression_return:function(){FormulaParser.arrayExpression_return=function(){},org.antlr.lang.extend(FormulaParser.arrayExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),arrayExpression:function(){var fe=new FormulaParser.arrayExpression_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=null,ke=null,Ae=null,Re=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COLON"),Ce=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule negationExpression");try{if(this.pushFollow(FormulaParser.FOLLOW_negationExpression_in_arrayExpression1532),Se=this.negationExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&Ce.add(Se.getTree());var Ie=2,Ve=this.input.LA(1);if(Ve==tr){var $e=this.input.LA(2);this.synpred61_Formula()&&this.input.get(this.input.index()-1).getText()!=" "&&(Ie=1)}switch(Ie){case 1:if(this.input.get(this.input.index()-1).getText()==" "){if(this.state.backtracking>0)return this.state.failed=!0,fe;throw new org.antlr.runtime.FailedPredicateException(this.input,"arrayExpression",' this.input.get(this.input.index()-1).getText()!=" "')}if(be=this.match(this.input,tr,FormulaParser.FOLLOW_COLON_in_arrayExpression1538),this.state.failed)return fe;if(this.state.backtracking===0&&Re.add(be),this.input.get(this.input.index()-1).getText()==" "){if(this.state.backtracking>0)return this.state.failed=!0,fe;throw new org.antlr.runtime.FailedPredicateException(this.input,"arrayExpression",' this.input.get(this.input.index()-1).getText()!=" "')}if(this.pushFollow(FormulaParser.FOLLOW_negationExpression_in_arrayExpression1542),ke=this.negationExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&Ce.add(ke.getTree());break}var Ue=2,Be=this.input.LA(1);if(Be==tr){var Je=this.input.LA(2);this.synpred62_Formula()&&this.input.get(this.input.index()-1).getText()!=" "&&(Ue=1)}switch(Ue){case 1:if(this.input.get(this.input.index()-1).getText()==" "){if(this.state.backtracking>0)return this.state.failed=!0,fe;throw new org.antlr.runtime.FailedPredicateException(this.input,"arrayExpression",' this.input.get(this.input.index()-1).getText()!=" "')}if(Pe=this.match(this.input,tr,FormulaParser.FOLLOW_COLON_in_arrayExpression1551),this.state.failed)return fe;if(this.state.backtracking===0&&Re.add(Pe),this.input.get(this.input.index()-1).getText()==" "){if(this.state.backtracking>0)return this.state.failed=!0,fe;throw new org.antlr.runtime.FailedPredicateException(this.input,"arrayExpression",' this.input.get(this.input.index()-1).getText()!=" "')}if(this.pushFollow(FormulaParser.FOLLOW_negationExpression_in_arrayExpression1555),Ae=this.negationExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&Ce.add(Ae.getTree());break}if(this.state.backtracking===0){fe.tree=Ee;var st=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var Ze=this.adaptor.nil();for(Ze=this.adaptor.becomeRoot(this.adaptor.create(Te,"RANGE"),Ze);Ce.hasNext();)this.adaptor.addChild(Ze,Ce.nextTree());Ce.reset(),this.adaptor.addChild(Ee,Ze)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(ze){if(ze instanceof org.antlr.runtime.RecognitionException)this.reportError(ze),this.recover(this.input,ze),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),ze);else throw ze}finally{}return fe},negationExpression_return:function(){FormulaParser.negationExpression_return=function(){},org.antlr.lang.extend(FormulaParser.negationExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),negationExpression:function(){var fe=new FormulaParser.negationExpression_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=null,ke=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token MINUS"),Ae=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule powerExpression");try{var Re=2,Ce=this.input.LA(1);if(Ce==Ct)Re=1;else if(Ce==Ye||Ce==Et||Ce==Qe||Ce==Pt||Ce>=Kt&&Ce<=xt||Ce==kt||Ce>=$t&&Ce<=Vt||Ce==113)Re=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Ie=new org.antlr.runtime.NoViableAltException("",48,0,this.input);throw Ie}switch(Re){case 1:if(be=this.match(this.input,Ct,FormulaParser.FOLLOW_MINUS_in_negationExpression1580),this.state.failed||(this.state.backtracking===0&&ke.add(be),this.pushFollow(FormulaParser.FOLLOW_powerExpression_in_negationExpression1582),Pe=this.powerExpression(),this.state._fsp--,this.state.failed))return fe;if(this.state.backtracking===0&&Ae.add(Pe.getTree()),this.state.backtracking===0){fe.tree=Ee;var Ve=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var $e=this.adaptor.nil();$e=this.adaptor.becomeRoot(this.adaptor.create(ee,"NEGATE"),$e),this.adaptor.addChild($e,Ae.nextTree()),this.adaptor.addChild(Ee,$e)}fe.tree=Ee}break;case 2:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_powerExpression_in_negationExpression1596),Se=this.powerExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Se.getTree());break}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Ue){if(Ue instanceof org.antlr.runtime.RecognitionException)this.reportError(Ue),this.recover(this.input,Ue),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Ue);else throw Ue}finally{}return fe},powerExpression_return:function(){FormulaParser.powerExpression_return=function(){},org.antlr.lang.extend(FormulaParser.powerExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),powerExpression:function(){var fe=new FormulaParser.powerExpression_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=null,ke=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token POW"),Ae=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unaryOrNegate"),Re=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unaryExpression");try{if(this.pushFollow(FormulaParser.FOLLOW_unaryExpression_in_powerExpression1607),Pe=this.unaryExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&Re.add(Pe.getTree());e:do{var Ce=2,Ie=this.input.LA(1);if(Ie==ir){var Ve=this.input.LA(2);this.synpred64_Formula()&&(Ce=1)}switch(Ce){case 1:if(be=this.match(this.input,ir,FormulaParser.FOLLOW_POW_in_powerExpression1610),this.state.failed||(this.state.backtracking===0&&ke.add(be),this.pushFollow(FormulaParser.FOLLOW_unaryOrNegate_in_powerExpression1612),Se=this.unaryOrNegate(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&Ae.add(Se.getTree());break;default:break e}}while(!0);if(this.state.backtracking===0){fe.tree=Ee;var $e=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var Ue=this.adaptor.nil();for(Ue=this.adaptor.becomeRoot(this.adaptor.create(le,"POWER"),Ue),this.adaptor.addChild(Ue,Re.nextTree());Ae.hasNext();)this.adaptor.addChild(Ue,Ae.nextTree());Ae.reset(),this.adaptor.addChild(Ee,Ue)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Be){if(Be instanceof org.antlr.runtime.RecognitionException)this.reportError(Be),this.recover(this.input,Be),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Be);else throw Be}finally{}return fe},unaryOrNegate_return:function(){FormulaParser.unaryOrNegate_return=function(){},org.antlr.lang.extend(FormulaParser.unaryOrNegate_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unaryOrNegate:function(){var fe=new FormulaParser.unaryOrNegate_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=null,ke=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token MINUS"),Ae=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unaryExpression");try{var Re=2,Ce=this.input.LA(1);if(Ce==Ye||Ce==Et||Ce==Qe||Ce==Pt||Ce>=Kt&&Ce<=xt||Ce==kt||Ce>=$t&&Ce<=Vt||Ce==113)Re=1;else if(Ce==Ct)Re=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Ie=new org.antlr.runtime.NoViableAltException("",50,0,this.input);throw Ie}switch(Re){case 1:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_unaryExpression_in_unaryOrNegate1639),Pe=this.unaryExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Pe.getTree());break;case 2:if(be=this.match(this.input,Ct,FormulaParser.FOLLOW_MINUS_in_unaryOrNegate1645),this.state.failed||(this.state.backtracking===0&&ke.add(be),this.pushFollow(FormulaParser.FOLLOW_unaryExpression_in_unaryOrNegate1647),Se=this.unaryExpression(),this.state._fsp--,this.state.failed))return fe;if(this.state.backtracking===0&&Ae.add(Se.getTree()),this.state.backtracking===0){fe.tree=Ee;var Ve=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var $e=this.adaptor.nil();$e=this.adaptor.becomeRoot(this.adaptor.create(ee,"NEGATE"),$e),this.adaptor.addChild($e,Ae.nextTree()),this.adaptor.addChild(Ee,$e)}fe.tree=Ee}break}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Ue){if(Ue instanceof org.antlr.runtime.RecognitionException)this.reportError(Ue),this.recover(this.input,Ue),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Ue);else throw Ue}finally{}return fe},unaryExpression_return:function(){FormulaParser.unaryExpression_return=function(){},org.antlr.lang.extend(FormulaParser.unaryExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unaryExpression:function(){var fe=new FormulaParser.unaryExpression_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=null,ke=null;try{var Ae=2,Re=this.input.LA(1);if(Re==Kt)Ae=1;else if(Re==Ye||Re==Et||Re==Qe||Re==Pt||Re==xt||Re==kt||Re>=$t&&Re<=Vt||Re==113)Ae=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Ce=new org.antlr.runtime.NoViableAltException("",51,0,this.input);throw Ce}switch(Ae){case 1:if(Ee=this.adaptor.nil(),be=this.match(this.input,Kt,FormulaParser.FOLLOW_NOT_in_unaryExpression1675),this.state.failed||(this.state.backtracking===0&&(ke=this.adaptor.create(be),Ee=this.adaptor.becomeRoot(ke,Ee)),this.pushFollow(FormulaParser.FOLLOW_innerPrimaryExpression_in_unaryExpression1678),Pe=this.innerPrimaryExpression(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Pe.getTree());break;case 2:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_innerPrimaryExpression_in_unaryExpression1687),Se=this.innerPrimaryExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Se.getTree());break}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Ie){if(Ie instanceof org.antlr.runtime.RecognitionException)this.reportError(Ie),this.recover(this.input,Ie),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Ie);else throw Ie}finally{}return fe},innerPrimaryExpression_return:function(){FormulaParser.innerPrimaryExpression_return=function(){},org.antlr.lang.extend(FormulaParser.innerPrimaryExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),innerPrimaryExpression:function(){var fe=new FormulaParser.innerPrimaryExpression_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule selectionExpression");try{if(this.pushFollow(FormulaParser.FOLLOW_selectionExpression_in_innerPrimaryExpression1718),be=this.selectionExpression(),this.state._fsp--,this.state.failed)return fe;if(this.state.backtracking===0&&Pe.add(be.getTree()),this.state.backtracking===0){fe.tree=Ee;var Se=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var ke=this.adaptor.nil();ke=this.adaptor.becomeRoot(this.adaptor.create(Ne,"INNER"),ke),this.adaptor.addChild(ke,Pe.nextTree()),this.adaptor.addChild(Ee,ke)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Ae){if(Ae instanceof org.antlr.runtime.RecognitionException)this.reportError(Ae),this.recover(this.input,Ae),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Ae);else throw Ae}finally{}return fe},selectionExpression_return:function(){FormulaParser.selectionExpression_return=function(){},org.antlr.lang.extend(FormulaParser.selectionExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),selectionExpression:function(){var fe=new FormulaParser.selectionExpression_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=null;try{if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_primaryExpression_in_selectionExpression1738),be=this.primaryExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,be.getTree());e:do{var ke=2;switch(this.input.LA(1)){case xt:var Ae=this.input.LA(2);this.synpred68_Formula()&&this.input.get(this.input.index()-1).getText()!=" "&&(ke=1);break;case kt:var Re=this.input.LA(2);this.synpred68_Formula()&&this.input.get(this.input.index()-1).getText()!=" "&&(ke=1);break;case 116:var Ce=this.input.LA(2);this.synpred68_Formula()&&this.input.get(this.input.index()-1).getText()!=" "&&(ke=1);break;case 113:var Ie=this.input.LA(2);this.synpred68_Formula()&&this.input.get(this.input.index()-1).getText()!=" "&&(ke=1);break}switch(ke){case 1:if(this.input.get(this.input.index()-1).getText()==" "){if(this.state.backtracking>0)return this.state.failed=!0,fe;throw new org.antlr.runtime.FailedPredicateException(this.input,"selectionExpression",' this.input.get(this.input.index()-1).getText()!=" "')}var Ve=2,$e=this.input.LA(1);if($e==xt||$e==kt||$e==116)Ve=1;else if($e==113)Ve=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Ue=new org.antlr.runtime.NoViableAltException("",52,0,this.input);throw Ue}switch(Ve){case 1:if(this.pushFollow(FormulaParser.FOLLOW_selector_in_selectionExpression1744),Pe=this.selector(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Pe.getTree());break;case 2:if(this.pushFollow(FormulaParser.FOLLOW_funCall_in_selectionExpression1746),Se=this.funCall(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Se.getTree());break}break;default:break e}}while(!0);fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Be){if(Be instanceof org.antlr.runtime.RecognitionException)this.reportError(Be),this.recover(this.input,Be),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Be);else throw Be}finally{}return fe},funCall_return:function(){FormulaParser.funCall_return=function(){},org.antlr.lang.extend(FormulaParser.funCall_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),funCall:function(){var fe=new FormulaParser.funCall_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=null,ke=null,Ae=null,Re=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 114"),Ce=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 113"),Ie=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COMMA"),Ve=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{if(be=this.match(this.input,113,FormulaParser.FOLLOW_113_in_funCall1761),this.state.failed)return fe;this.state.backtracking===0&&Ce.add(be);var $e=2,Ue=this.input.LA(1);switch((Ue==Ye||Ue==Et||Ue==Qe||Ue==Pt||Ue==Ct||Ue>=Kt&&Ue<=xt||Ue==kt||Ue>=$t&&Ue<=Vt||Ue==113)&&($e=1),$e){case 1:if(this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_funCall1765),ke=this.logicalExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&Ve.add(ke.getTree());e:do{var Be=2,Je=this.input.LA(1);switch(Je==pt&&(Be=1),Be){case 1:if(Pe=this.match(this.input,pt,FormulaParser.FOLLOW_COMMA_in_funCall1768),this.state.failed||(this.state.backtracking===0&&Ie.add(Pe),this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_funCall1770),Ae=this.logicalExpression(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&Ve.add(Ae.getTree());break;default:break e}}while(!0);break}if(Se=this.match(this.input,114,FormulaParser.FOLLOW_114_in_funCall1777),this.state.failed)return fe;if(this.state.backtracking===0&&Re.add(Se),this.state.backtracking===0){fe.tree=Ee;var st=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var Ze=this.adaptor.nil();for(Ze=this.adaptor.becomeRoot(this.adaptor.create(ne,"FUNCALL"),Ze);Ve.hasNext();)this.adaptor.addChild(Ze,Ve.nextTree());Ve.reset(),this.adaptor.addChild(Ee,Ze)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(ze){if(ze instanceof org.antlr.runtime.RecognitionException)this.reportError(ze),this.recover(this.input,ze),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),ze);else throw ze}finally{}return fe},primaryExpression_return:function(){FormulaParser.primaryExpression_return=function(){},org.antlr.lang.extend(FormulaParser.primaryExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),primaryExpression:function(){var fe=new FormulaParser.primaryExpression_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=null,ke=null;try{var Ae=2,Re=this.input.LA(1);if(Re==113)Ae=1;else if(Re==Ye||Re==Et||Re==Qe||Re==Pt||Re==xt||Re==kt||Re>=$t&&Re<=Vt)Ae=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Ce=new org.antlr.runtime.NoViableAltException("",56,0,this.input);throw Ce}switch(Ae){case 1:if(Ee=this.adaptor.nil(),be=this.match(this.input,113,FormulaParser.FOLLOW_113_in_primaryExpression1798),this.state.failed||(this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_primaryExpression1801),Se=this.logicalExpression(),this.state._fsp--,this.state.failed)||(this.state.backtracking===0&&this.adaptor.addChild(Ee,Se.getTree()),Pe=this.match(this.input,114,FormulaParser.FOLLOW_114_in_primaryExpression1803),this.state.failed))return fe;break;case 2:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_value_in_primaryExpression1809),ke=this.value(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,ke.getTree());break}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Ie){if(Ie instanceof org.antlr.runtime.RecognitionException)this.reportError(Ie),this.recover(this.input,Ie),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Ie);else throw Ie}finally{}return fe},value_return:function(){FormulaParser.value_return=function(){},org.antlr.lang.extend(FormulaParser.value_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),value:function(){var fe=new FormulaParser.value_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=null,ke=null,Ae=null,Re=null,Ce=null,Ie=null,Ve=null,$e=null;try{var Ue=9;switch(Ue=this.dfa57.predict(this.input),Ue){case 1:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_number_in_value1823),Pe=this.number(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Pe.getTree());break;case 2:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_bool_in_value1829),Se=this.bool(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Se.getTree());break;case 3:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_string_in_value1835),ke=this.string(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,ke.getTree());break;case 4:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_material_in_value1841),Ae=this.material(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Ae.getTree());break;case 5:if(Ee=this.adaptor.nil(),be=this.match(this.input,Qe,FormulaParser.FOLLOW_IDENT_in_value1846),this.state.failed)return fe;this.state.backtracking===0&&($e=this.adaptor.create(be),this.adaptor.addChild(Ee,$e));break;case 6:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_primitive_in_value1851),Re=this.primitive(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Re.getTree());break;case 7:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_array_in_value1856),Ce=this.array(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Ce.getTree());break;case 8:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_anonFunctionDef_in_value1861),Ie=this.anonFunctionDef(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Ie.getTree());break;case 9:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_newObject_in_value1866),Ve=this.newObject(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Ve.getTree());break}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Be){if(Be instanceof org.antlr.runtime.RecognitionException)this.reportError(Be),this.recover(this.input,Be),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Be);else throw Be}finally{}return fe},newObject_return:function(){FormulaParser.newObject_return=function(){},org.antlr.lang.extend(FormulaParser.newObject_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),newObject:function(){var fe=new FormulaParser.newObject_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=null,ke=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),Ae=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWSTATEMENT"),Re=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule funCall");try{if(be=this.match(this.input,Et,FormulaParser.FOLLOW_NEWSTATEMENT_in_newObject1876),this.state.failed||(this.state.backtracking===0&&Ae.add(be),Pe=this.match(this.input,Qe,FormulaParser.FOLLOW_IDENT_in_newObject1878),this.state.failed))return fe;this.state.backtracking===0&&ke.add(Pe);var Ce=2;switch(Ce=this.dfa58.predict(this.input),Ce){case 1:if(this.pushFollow(FormulaParser.FOLLOW_funCall_in_newObject1880),Se=this.funCall(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&Re.add(Se.getTree());break}if(this.state.backtracking===0){fe.tree=Ee;var Ie=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var Ve=this.adaptor.nil();Ve=this.adaptor.becomeRoot(this.adaptor.create(Oe,"NEW"),Ve),this.adaptor.addChild(Ve,ke.nextNode()),Re.hasNext()&&this.adaptor.addChild(Ve,Re.nextTree()),Re.reset(),this.adaptor.addChild(Ee,Ve)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch($e){if($e instanceof org.antlr.runtime.RecognitionException)this.reportError($e),this.recover(this.input,$e),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),$e);else throw $e}finally{}return fe},defaultValue_return:function(){FormulaParser.defaultValue_return=function(){},org.antlr.lang.extend(FormulaParser.defaultValue_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),defaultValue:function(){var fe=new FormulaParser.defaultValue_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=null,ke=null,Ae=null;try{var Re=5;switch(this.input.LA(1)){case Ct:Re=1;break;case ar:case wr:Re=2;break;case Nr:case Vt:Re=3;break;case $t:Re=4;break;case xt:case kt:Re=5;break;default:if(this.state.backtracking>0)return this.state.failed=!0,fe;var Ce=new org.antlr.runtime.NoViableAltException("",59,0,this.input);throw Ce}switch(Re){case 1:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_negnumber_in_defaultValue1906),be=this.negnumber(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,be.getTree());break;case 2:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_number_in_defaultValue1912),Pe=this.number(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Pe.getTree());break;case 3:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_bool_in_defaultValue1918),Se=this.bool(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Se.getTree());break;case 4:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_string_in_defaultValue1924),ke=this.string(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,ke.getTree());break;case 5:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_array_in_defaultValue1930),Ae=this.array(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Ae.getTree());break}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Ie){if(Ie instanceof org.antlr.runtime.RecognitionException)this.reportError(Ie),this.recover(this.input,Ie),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Ie);else throw Ie}finally{}return fe},array_return:function(){FormulaParser.array_return=function(){},org.antlr.lang.extend(FormulaParser.array_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),array:function(){var fe=new FormulaParser.array_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=null,ke=null,Ae=null,Re=null,Ce=null,Ie=null,Ve=null,$e=null,Ue=null,Be=null,Je=null,st=null,Ze=null,ze=null,it=null,ct=null,ft=null,lt=null,ut=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token LCURL"),He=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),rt=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token RARR"),vt=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COMMA"),wt=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token LARR"),Ot=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token RCURL"),Xe=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule label");try{var _t=2,mt=this.input.LA(1);if(mt==xt)_t=1;else if(mt==kt)_t=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Tt=new org.antlr.runtime.NoViableAltException("",74,0,this.input);throw Tt}switch(_t){case 1:if(be=this.match(this.input,xt,FormulaParser.FOLLOW_LARR_in_array1944),this.state.failed)return fe;this.state.backtracking===0&&wt.add(be);e:do{var Nt=2,bt=this.input.LA(1);if(bt==Me){var yt=this.input.LA(2);this.synpred85_Formula()&&(Nt=1)}switch(Nt){case 1:if(Pe=this.match(this.input,Me,FormulaParser.FOLLOW_NEWLINE_in_array1946),this.state.failed)return fe;this.state.backtracking===0&&He.add(Pe);break;default:break e}}while(!0);var Ft=2;switch(Ft=this.dfa65.predict(this.input),Ft){case 1:if(this.pushFollow(FormulaParser.FOLLOW_label_in_array1950),it=this.label(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&Xe.add(it.getTree());e:do{var It=2,Yt=this.input.LA(1);if(Yt==Me){var Qt=this.input.LA(2);this.synpred86_Formula()&&(It=1)}switch(It){case 1:if(Se=this.match(this.input,Me,FormulaParser.FOLLOW_NEWLINE_in_array1952),this.state.failed)return fe;this.state.backtracking===0&&He.add(Se);break;default:break e}}while(!0);e:do{var Ht=2,Xt=this.input.LA(1);switch(Xt==pt&&(Ht=1),Ht){case 1:if(ke=this.match(this.input,pt,FormulaParser.FOLLOW_COMMA_in_array1956),this.state.failed)return fe;this.state.backtracking===0&&vt.add(ke);t:do{var Dt=2,dt=this.input.LA(1);if(dt==Me){var zt=this.input.LA(2);this.synpred87_Formula()&&(Dt=1)}switch(Dt){case 1:if(Ae=this.match(this.input,Me,FormulaParser.FOLLOW_NEWLINE_in_array1958),this.state.failed)return fe;this.state.backtracking===0&&He.add(Ae);break;default:break t}}while(!0);if(this.pushFollow(FormulaParser.FOLLOW_label_in_array1961),ct=this.label(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&Xe.add(ct.getTree());t:do{var er=2,Gt=this.input.LA(1);if(Gt==Me){var qt=this.input.LA(2);this.synpred88_Formula()&&(er=1)}switch(er){case 1:if(Re=this.match(this.input,Me,FormulaParser.FOLLOW_NEWLINE_in_array1963),this.state.failed)return fe;this.state.backtracking===0&&He.add(Re);break;default:break t}}while(!0);break;default:break e}}while(!0);break}e:do{var Jt=2,Lt=this.input.LA(1);switch(Lt==Me&&(Jt=1),Jt){case 1:if(Ce=this.match(this.input,Me,FormulaParser.FOLLOW_NEWLINE_in_array1970),this.state.failed)return fe;this.state.backtracking===0&&He.add(Ce);break;default:break e}}while(!0);if(Ie=this.match(this.input,Tr,FormulaParser.FOLLOW_RARR_in_array1973),this.state.failed)return fe;if(this.state.backtracking===0&&rt.add(Ie),this.state.backtracking===0){fe.tree=Ee;var At=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var Mt=this.adaptor.nil();for(Mt=this.adaptor.becomeRoot(this.adaptor.create(he,"ARRAY"),Mt);Xe.hasNext();)this.adaptor.addChild(Mt,Xe.nextTree());Xe.reset(),this.adaptor.addChild(Ee,Mt)}fe.tree=Ee}break;case 2:if(Ve=this.match(this.input,kt,FormulaParser.FOLLOW_LCURL_in_array1987),this.state.failed)return fe;this.state.backtracking===0&&ut.add(Ve);e:do{var sr=2,hr=this.input.LA(1);if(hr==Me){var yr=this.input.LA(2);this.synpred93_Formula()&&(sr=1)}switch(sr){case 1:if($e=this.match(this.input,Me,FormulaParser.FOLLOW_NEWLINE_in_array1989),this.state.failed)return fe;this.state.backtracking===0&&He.add($e);break;default:break e}}while(!0);var nr=2;switch(nr=this.dfa72.predict(this.input),nr){case 1:if(this.pushFollow(FormulaParser.FOLLOW_label_in_array1993),ft=this.label(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&Xe.add(ft.getTree());e:do{var or=2,rr=this.input.LA(1);if(rr==Me){var Pr=this.input.LA(2);this.synpred94_Formula()&&(or=1)}switch(or){case 1:if(Ue=this.match(this.input,Me,FormulaParser.FOLLOW_NEWLINE_in_array1995),this.state.failed)return fe;this.state.backtracking===0&&He.add(Ue);break;default:break e}}while(!0);e:do{var kr=2,Sr=this.input.LA(1);switch(Sr==pt&&(kr=1),kr){case 1:if(Be=this.match(this.input,pt,FormulaParser.FOLLOW_COMMA_in_array1998),this.state.failed)return fe;this.state.backtracking===0&&vt.add(Be);t:do{var xr=2,Or=this.input.LA(1);if(Or==Me){var Cr=this.input.LA(2);this.synpred95_Formula()&&(xr=1)}switch(xr){case 1:if(Je=this.match(this.input,Me,FormulaParser.FOLLOW_NEWLINE_in_array2000),this.state.failed)return fe;this.state.backtracking===0&&He.add(Je);break;default:break t}}while(!0);if(this.pushFollow(FormulaParser.FOLLOW_label_in_array2003),lt=this.label(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&Xe.add(lt.getTree());t:do{var Fr=2,Ar=this.input.LA(1);if(Ar==Me){var Mr=this.input.LA(2);this.synpred96_Formula()&&(Fr=1)}switch(Fr){case 1:if(st=this.match(this.input,Me,FormulaParser.FOLLOW_NEWLINE_in_array2005),this.state.failed)return fe;this.state.backtracking===0&&He.add(st);break;default:break t}}while(!0);break;default:break e}}while(!0);break}e:do{var Lr=2,Rr=this.input.LA(1);switch(Rr==Me&&(Lr=1),Lr){case 1:if(Ze=this.match(this.input,Me,FormulaParser.FOLLOW_NEWLINE_in_array2012),this.state.failed)return fe;this.state.backtracking===0&&He.add(Ze);break;default:break e}}while(!0);if(ze=this.match(this.input,Er,FormulaParser.FOLLOW_RCURL_in_array2015),this.state.failed)return fe;if(this.state.backtracking===0&&Ot.add(ze),this.state.backtracking===0){fe.tree=Ee;var At=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var Mt=this.adaptor.nil();for(Mt=this.adaptor.becomeRoot(this.adaptor.create(he,"ARRAY"),Mt);Xe.hasNext();)this.adaptor.addChild(Mt,Xe.nextTree());Xe.reset(),this.adaptor.addChild(Ee,Mt)}fe.tree=Ee}break}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(ur){if(ur instanceof org.antlr.runtime.RecognitionException)this.reportError(ur),this.recover(this.input,ur),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),ur);else throw ur}finally{}return fe},selector_return:function(){FormulaParser.selector_return=function(){},org.antlr.lang.extend(FormulaParser.selector_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),selector:function(){var fe=new FormulaParser.selector_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule dotselector"),ke=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule minarray");try{var Ae=2,Re=this.input.LA(1);if(Re==xt||Re==kt)Ae=1;else if(Re==116)Ae=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Ce=new org.antlr.runtime.NoViableAltException("",75,0,this.input);throw Ce}switch(Ae){case 1:if(this.pushFollow(FormulaParser.FOLLOW_minarray_in_selector2036),be=this.minarray(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&ke.add(be.getTree());break;case 2:if(this.pushFollow(FormulaParser.FOLLOW_dotselector_in_selector2040),Pe=this.dotselector(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&Se.add(Pe.getTree());break}if(this.state.backtracking===0){fe.tree=Ee;var Ie=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var Ve=this.adaptor.nil();Ve=this.adaptor.becomeRoot(this.adaptor.create(Le,"SELECTOR"),Ve),ke.hasNext()&&this.adaptor.addChild(Ve,ke.nextTree()),ke.reset(),Se.hasNext()&&this.adaptor.addChild(Ve,Se.nextTree()),Se.reset(),this.adaptor.addChild(Ee,Ve)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch($e){if($e instanceof org.antlr.runtime.RecognitionException)this.reportError($e),this.recover(this.input,$e),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),$e);else throw $e}finally{}return fe},minarray_return:function(){FormulaParser.minarray_return=function(){},org.antlr.lang.extend(FormulaParser.minarray_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),minarray:function(){var fe=new FormulaParser.minarray_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=null,ke=null,Ae=null,Re=null,Ce=null,Ie=null,Ve=null,$e=null,Ue=null,Be=null,Je=null,st=null,Ze=null,ze=null,it=null,ct=null;try{var ft=2,lt=this.input.LA(1);if(lt==xt)ft=1;else if(lt==kt)ft=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var ut=new org.antlr.runtime.NoViableAltException("",82,0,this.input);throw ut}switch(ft){case 1:if(Ee=this.adaptor.nil(),be=this.match(this.input,xt,FormulaParser.FOLLOW_LARR_in_minarray2067),this.state.failed)return fe;var He=2,rt=this.input.LA(1);if(rt==Ye||rt==Et||rt==Qe||rt==Pt||rt==Ct||rt>=Kt&&rt<=xt||rt==kt||rt>=$t&&rt<=Vt||rt==113)He=1;else if(rt==Wt)He=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var ut=new org.antlr.runtime.NoViableAltException("",76,0,this.input);throw ut}switch(He){case 1:if(this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_minarray2072),Ue=this.logicalExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Ue.getTree());break;case 2:if(Pe=this.match(this.input,Wt,FormulaParser.FOLLOW_MULT_in_minarray2074),this.state.failed)return fe;this.state.backtracking===0&&(Ze=this.adaptor.create(Pe),this.adaptor.addChild(Ee,Ze));break}e:do{var vt=2,wt=this.input.LA(1);switch(wt==pt&&(vt=1),vt){case 1:if(Se=this.match(this.input,pt,FormulaParser.FOLLOW_COMMA_in_minarray2078),this.state.failed)return fe;var Ot=2,Xe=this.input.LA(1);if(Xe==Ye||Xe==Et||Xe==Qe||Xe==Pt||Xe==Ct||Xe>=Kt&&Xe<=xt||Xe==kt||Xe>=$t&&Xe<=Vt||Xe==113)Ot=1;else if(Xe==Wt)Ot=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var ut=new org.antlr.runtime.NoViableAltException("",77,0,this.input);throw ut}switch(Ot){case 1:if(this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_minarray2082),Be=this.logicalExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Be.getTree());break;case 2:if(ke=this.match(this.input,Wt,FormulaParser.FOLLOW_MULT_in_minarray2084),this.state.failed)return fe;this.state.backtracking===0&&(ze=this.adaptor.create(ke),this.adaptor.addChild(Ee,ze));break}break;default:break e}}while(!0);if(Ae=this.match(this.input,Tr,FormulaParser.FOLLOW_RARR_in_minarray2091),this.state.failed)return fe;break;case 2:if(Ee=this.adaptor.nil(),Re=this.match(this.input,kt,FormulaParser.FOLLOW_LCURL_in_minarray2097),this.state.failed)return fe;var _t=2,mt=this.input.LA(1);if(mt==Ye||mt==Et||mt==Qe||mt==Pt||mt==Ct||mt>=Kt&&mt<=xt||mt==kt||mt>=$t&&mt<=Vt||mt==113)_t=1;else if(mt==Wt)_t=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var ut=new org.antlr.runtime.NoViableAltException("",79,0,this.input);throw ut}switch(_t){case 1:if(this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_minarray2102),Je=this.logicalExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Je.getTree());break;case 2:if(Ce=this.match(this.input,Wt,FormulaParser.FOLLOW_MULT_in_minarray2104),this.state.failed)return fe;this.state.backtracking===0&&(it=this.adaptor.create(Ce),this.adaptor.addChild(Ee,it));break}e:do{var Tt=2,Nt=this.input.LA(1);switch(Nt==pt&&(Tt=1),Tt){case 1:if(Ie=this.match(this.input,pt,FormulaParser.FOLLOW_COMMA_in_minarray2108),this.state.failed)return fe;var bt=2,yt=this.input.LA(1);if(yt==Ye||yt==Et||yt==Qe||yt==Pt||yt==Ct||yt>=Kt&&yt<=xt||yt==kt||yt>=$t&&yt<=Vt||yt==113)bt=1;else if(yt==Wt)bt=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var ut=new org.antlr.runtime.NoViableAltException("",80,0,this.input);throw ut}switch(bt){case 1:if(this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_minarray2112),st=this.logicalExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,st.getTree());break;case 2:if(Ve=this.match(this.input,Wt,FormulaParser.FOLLOW_MULT_in_minarray2114),this.state.failed)return fe;this.state.backtracking===0&&(ct=this.adaptor.create(Ve),this.adaptor.addChild(Ee,ct));break}break;default:break e}}while(!0);if($e=this.match(this.input,Er,FormulaParser.FOLLOW_RCURL_in_minarray2121),this.state.failed)return fe;break}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Ft){if(Ft instanceof org.antlr.runtime.RecognitionException)this.reportError(Ft),this.recover(this.input,Ft),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Ft);else throw Ft}finally{}return fe},dotselector_return:function(){FormulaParser.dotselector_return=function(){},org.antlr.lang.extend(FormulaParser.dotselector_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),dotselector:function(){var fe=new FormulaParser.dotselector_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 116"),ke=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule arrayName");try{var Ae=0;e:do{var Re=2,Ce=this.input.LA(1);if(Ce==116){var Ie=this.input.LA(2);this.synpred108_Formula()&&(Re=1)}switch(Re){case 1:if(be=this.match(this.input,116,FormulaParser.FOLLOW_116_in_dotselector2133),this.state.failed||(this.state.backtracking===0&&Se.add(be),this.pushFollow(FormulaParser.FOLLOW_arrayName_in_dotselector2135),Pe=this.arrayName(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&ke.add(Pe.getTree());break;default:if(Ae>=1)break e;if(this.state.backtracking>0)return this.state.failed=!0,fe;var Ve=new org.antlr.runtime.EarlyExitException(83,this.input);throw Ve}Ae++}while(!0);if(this.state.backtracking===0){fe.tree=Ee;var $e=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var Ue=this.adaptor.nil();if(Ue=this.adaptor.becomeRoot(this.adaptor.create(xe,"DOTSELECTOR"),Ue),!ke.hasNext())throw new org.antlr.runtime.tree.RewriteEarlyExitException;for(;ke.hasNext();)this.adaptor.addChild(Ue,ke.nextTree());ke.reset(),this.adaptor.addChild(Ee,Ue)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Be){if(Be instanceof org.antlr.runtime.RecognitionException)this.reportError(Be),this.recover(this.input,Be),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Be);else throw Be}finally{}return fe},arrayName_return:function(){FormulaParser.arrayName_return=function(){},org.antlr.lang.extend(FormulaParser.arrayName_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),arrayName:function(){var fe=new FormulaParser.arrayName_return;fe.start=this.input.LT(1);var Ee=null,be=null;try{if(Ee=this.adaptor.nil(),be=this.input.LT(1),this.input.LA(1)==Qe||this.input.LA(1)==Wt||this.input.LA(1)==$t)this.input.consume(),this.state.backtracking===0&&this.adaptor.addChild(Ee,this.adaptor.create(be)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Pe=new org.antlr.runtime.MismatchedSetException(null,this.input);throw Pe}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Se){if(Se instanceof org.antlr.runtime.RecognitionException)this.reportError(Se),this.recover(this.input,Se),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Se);else throw Se}finally{}return fe},label_return:function(){FormulaParser.label_return=function(){},org.antlr.lang.extend(FormulaParser.label_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),label:function(){var fe=new FormulaParser.label_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=null,ke=null,Ae=null,Re=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COLON"),Ce=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),Ie=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule arrayName"),Ve=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{var $e=2;switch($e=this.dfa85.predict(this.input),$e){case 1:if(this.pushFollow(FormulaParser.FOLLOW_arrayName_in_label2173),ke=this.arrayName(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&Ie.add(ke.getTree());e:do{var Ue=2,Be=this.input.LA(1);switch(Be==Me&&(Ue=1),Ue){case 1:if(be=this.match(this.input,Me,FormulaParser.FOLLOW_NEWLINE_in_label2175),this.state.failed)return fe;this.state.backtracking===0&&Ce.add(be);break;default:break e}}while(!0);if(Pe=this.match(this.input,tr,FormulaParser.FOLLOW_COLON_in_label2178),this.state.failed)return fe;this.state.backtracking===0&&Re.add(Pe);break}e:do{var Je=2,st=this.input.LA(1);switch(st==Me&&(Je=1),Je){case 1:if(Se=this.match(this.input,Me,FormulaParser.FOLLOW_NEWLINE_in_label2182),this.state.failed)return fe;this.state.backtracking===0&&Ce.add(Se);break;default:break e}}while(!0);if(this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_label2185),Ae=this.logicalExpression(),this.state._fsp--,this.state.failed)return fe;if(this.state.backtracking===0&&Ve.add(Ae.getTree()),this.state.backtracking===0){fe.tree=Ee;var Ze=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var ze=this.adaptor.nil();ze=this.adaptor.becomeRoot(this.adaptor.create(_e,"LABEL"),ze),this.adaptor.addChild(ze,Ve.nextTree()),Ie.hasNext()&&this.adaptor.addChild(ze,Ie.nextTree()),Ie.reset(),this.adaptor.addChild(Ee,ze)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(it){if(it instanceof org.antlr.runtime.RecognitionException)this.reportError(it),this.recover(this.input,it),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),it);else throw it}finally{}return fe},number_return:function(){FormulaParser.number_return=function(){},org.antlr.lang.extend(FormulaParser.number_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),number:function(){var fe=new FormulaParser.number_return;fe.start=this.input.LT(1);var Ee=null,be=null;try{if(Ee=this.adaptor.nil(),be=this.input.LT(1),this.input.LA(1)>=ar&&this.input.LA(1)<=wr)this.input.consume(),this.state.backtracking===0&&this.adaptor.addChild(Ee,this.adaptor.create(be)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Pe=new org.antlr.runtime.MismatchedSetException(null,this.input);throw Pe}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Se){if(Se instanceof org.antlr.runtime.RecognitionException)this.reportError(Se),this.recover(this.input,Se),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Se);else throw Se}finally{}return fe},negnumber_return:function(){FormulaParser.negnumber_return=function(){},org.antlr.lang.extend(FormulaParser.negnumber_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),negnumber:function(){var fe=new FormulaParser.negnumber_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token MINUS"),ke=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule number");try{if(be=this.match(this.input,Ct,FormulaParser.FOLLOW_MINUS_in_negnumber2261),this.state.failed||(this.state.backtracking===0&&Se.add(be),this.pushFollow(FormulaParser.FOLLOW_number_in_negnumber2263),Pe=this.number(),this.state._fsp--,this.state.failed))return fe;if(this.state.backtracking===0&&ke.add(Pe.getTree()),this.state.backtracking===0){fe.tree=Ee;var Ae=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var Re=this.adaptor.nil();Re=this.adaptor.becomeRoot(this.adaptor.create(ee,"NEGATE"),Re),this.adaptor.addChild(Re,ke.nextTree()),this.adaptor.addChild(Ee,Re)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Ce){if(Ce instanceof org.antlr.runtime.RecognitionException)this.reportError(Ce),this.recover(this.input,Ce),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Ce);else throw Ce}finally{}return fe},bool_return:function(){FormulaParser.bool_return=function(){},org.antlr.lang.extend(FormulaParser.bool_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),bool:function(){var fe=new FormulaParser.bool_return;fe.start=this.input.LT(1);var Ee=null,be=null;try{if(Ee=this.adaptor.nil(),be=this.input.LT(1),this.input.LA(1)>=Nr&&this.input.LA(1)<=Vt)this.input.consume(),this.state.backtracking===0&&this.adaptor.addChild(Ee,this.adaptor.create(be)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Pe=new org.antlr.runtime.MismatchedSetException(null,this.input);throw Pe}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Se){if(Se instanceof org.antlr.runtime.RecognitionException)this.reportError(Se),this.recover(this.input,Se),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Se);else throw Se}finally{}return fe},material_return:function(){FormulaParser.material_return=function(){},org.antlr.lang.extend(FormulaParser.material_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),material:function(){var fe=new FormulaParser.material_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=null,ke=null,Ae=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token LCURL"),Re=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token RCURL"),Ce=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unitMultiplicativeExpression"),Ie=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule additiveExpression");try{if(be=this.match(this.input,kt,FormulaParser.FOLLOW_LCURL_in_material2415),this.state.failed||(this.state.backtracking===0&&Ae.add(be),this.pushFollow(FormulaParser.FOLLOW_additiveExpression_in_material2417),Se=this.additiveExpression(),this.state._fsp--,this.state.failed))return fe;if(this.state.backtracking===0&&Ie.add(Se.getTree()),this.input.get(this.input.index()-1).getText()!=" "){if(this.state.backtracking>0)return this.state.failed=!0,fe;throw new org.antlr.runtime.FailedPredicateException(this.input,"material",' this.input.get(this.input.index()-1).getText()==" "')}if(this.pushFollow(FormulaParser.FOLLOW_unitMultiplicativeExpression_in_material2421),ke=this.unitMultiplicativeExpression(),this.state._fsp--,this.state.failed||(this.state.backtracking===0&&Ce.add(ke.getTree()),Pe=this.match(this.input,Er,FormulaParser.FOLLOW_RCURL_in_material2423),this.state.failed))return fe;if(this.state.backtracking===0&&Re.add(Pe),this.state.backtracking===0){fe.tree=Ee;var Ve=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var $e=this.adaptor.nil();$e=this.adaptor.becomeRoot(this.adaptor.create(ie,"MATERIAL"),$e),this.adaptor.addChild($e,Ce.nextTree()),this.adaptor.addChild($e,Ie.nextTree()),this.adaptor.addChild(Ee,$e)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Ue){if(Ue instanceof org.antlr.runtime.RecognitionException)this.reportError(Ue),this.recover(this.input,Ue),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Ue);else throw Ue}finally{}return fe},unitMultiplicativeExpression_return:function(){FormulaParser.unitMultiplicativeExpression_return=function(){},org.antlr.lang.extend(FormulaParser.unitMultiplicativeExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unitMultiplicativeExpression:function(){var fe=new FormulaParser.unitMultiplicativeExpression_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=null,ke=null;try{if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_unitInnerMultiplicativeExpression_in_unitMultiplicativeExpression2460),Pe=this.unitInnerMultiplicativeExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Pe.getTree());e:do{var Ae=2,Re=this.input.LA(1);switch(Re==br&&(Ae=1),Ae){case 1:if(be=this.match(this.input,br,FormulaParser.FOLLOW_PER_in_unitMultiplicativeExpression2464),this.state.failed||(this.state.backtracking===0&&(ke=this.adaptor.create(be),Ee=this.adaptor.becomeRoot(ke,Ee)),this.pushFollow(FormulaParser.FOLLOW_unitInnerMultiplicativeExpression_in_unitMultiplicativeExpression2467),Se=this.unitInnerMultiplicativeExpression(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Se.getTree());break;default:break e}}while(!0);fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Ce){if(Ce instanceof org.antlr.runtime.RecognitionException)this.reportError(Ce),this.recover(this.input,Ce),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Ce);else throw Ce}finally{}return fe},unitInnerMultiplicativeExpression_return:function(){FormulaParser.unitInnerMultiplicativeExpression_return=function(){},org.antlr.lang.extend(FormulaParser.unitInnerMultiplicativeExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unitInnerMultiplicativeExpression:function(){var fe=new FormulaParser.unitInnerMultiplicativeExpression_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=null;try{if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_unitClump_in_unitInnerMultiplicativeExpression2483),Pe=this.unitClump(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Pe.getTree());e:do{var ke=2,Ae=this.input.LA(1);switch(Ae>=Wt&&Ae<=vr&&(ke=1),ke){case 1:if(be=this.input.LT(1),this.input.LA(1)>=Wt&&this.input.LA(1)<=vr)this.input.consume(),this.state.backtracking===0&&(Ee=this.adaptor.becomeRoot(this.adaptor.create(be),Ee)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Re=new org.antlr.runtime.MismatchedSetException(null,this.input);throw Re}if(this.pushFollow(FormulaParser.FOLLOW_unitClump_in_unitInnerMultiplicativeExpression2494),Se=this.unitClump(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Se.getTree());break;default:break e}}while(!0);fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Ce){if(Ce instanceof org.antlr.runtime.RecognitionException)this.reportError(Ce),this.recover(this.input,Ce),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Ce);else throw Ce}finally{}return fe},unitClump_return:function(){FormulaParser.unitClump_return=function(){},org.antlr.lang.extend(FormulaParser.unitClump_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unitClump:function(){var fe=new FormulaParser.unitClump_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=null,ke=null,Ae=null,Re=null,Ce=null,Ie=null,Ve=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token INTEGER"),$e=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token SQUARED"),Ue=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token DIV"),Be=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token CUBED"),Je=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unitPowerExpression");try{var st=2,Ze=this.input.LA(1);if(Ze==ar)st=1;else if(Ze==Qe||Ze==113)st=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var ze=new org.antlr.runtime.NoViableAltException("",93,0,this.input);throw ze}switch(st){case 1:if(be=this.match(this.input,ar,FormulaParser.FOLLOW_INTEGER_in_unitClump2510),this.state.failed||(this.state.backtracking===0&&Ve.add(be),Pe=this.match(this.input,vr,FormulaParser.FOLLOW_DIV_in_unitClump2512),this.state.failed)||(this.state.backtracking===0&&Ue.add(Pe),this.pushFollow(FormulaParser.FOLLOW_unitPowerExpression_in_unitClump2515),Ce=this.unitPowerExpression(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&Je.add(Ce.getTree());var it=2,ct=this.input.LA(1);switch(ct==lr&&(it=1),it){case 1:if(Se=this.match(this.input,lr,FormulaParser.FOLLOW_CUBED_in_unitClump2517),this.state.failed)return fe;this.state.backtracking===0&&Be.add(Se);break}var ft=2,lt=this.input.LA(1);switch(lt==cr&&(ft=1),ft){case 1:if(ke=this.match(this.input,cr,FormulaParser.FOLLOW_SQUARED_in_unitClump2520),this.state.failed)return fe;this.state.backtracking===0&&$e.add(ke);break}if(this.state.backtracking===0){fe.tree=Ee;var ut=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var He=this.adaptor.nil();for(He=this.adaptor.becomeRoot(this.adaptor.create(oe,"UNITCLUMP"),He),this.adaptor.addChild(He,Je.nextTree()),this.adaptor.addChild(He,this.adaptor.create(ee,"NEGATE"));Be.hasNext();)this.adaptor.addChild(He,Be.nextNode());for(Be.reset();$e.hasNext();)this.adaptor.addChild(He,$e.nextNode());$e.reset(),this.adaptor.addChild(Ee,He)}fe.tree=Ee}break;case 2:if(this.pushFollow(FormulaParser.FOLLOW_unitPowerExpression_in_unitClump2543),Ie=this.unitPowerExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&Je.add(Ie.getTree());var rt=2,vt=this.input.LA(1);switch(vt==lr&&(rt=1),rt){case 1:if(Ae=this.match(this.input,lr,FormulaParser.FOLLOW_CUBED_in_unitClump2545),this.state.failed)return fe;this.state.backtracking===0&&Be.add(Ae);break}var wt=2,Ot=this.input.LA(1);switch(Ot==cr&&(wt=1),wt){case 1:if(Re=this.match(this.input,cr,FormulaParser.FOLLOW_SQUARED_in_unitClump2548),this.state.failed)return fe;this.state.backtracking===0&&$e.add(Re);break}if(this.state.backtracking===0){fe.tree=Ee;var ut=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var He=this.adaptor.nil();for(He=this.adaptor.becomeRoot(this.adaptor.create(oe,"UNITCLUMP"),He),this.adaptor.addChild(He,Je.nextTree());Be.hasNext();)this.adaptor.addChild(He,Be.nextNode());for(Be.reset();$e.hasNext();)this.adaptor.addChild(He,$e.nextNode());$e.reset(),this.adaptor.addChild(Ee,He)}fe.tree=Ee}break}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Xe){if(Xe instanceof org.antlr.runtime.RecognitionException)this.reportError(Xe),this.recover(this.input,Xe),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Xe);else throw Xe}finally{}return fe},unitPowerExpression_return:function(){FormulaParser.unitPowerExpression_return=function(){},org.antlr.lang.extend(FormulaParser.unitPowerExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unitPowerExpression:function(){var fe=new FormulaParser.unitPowerExpression_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=null,ke=null,Ae=null,Re=null;try{if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_unit_in_unitPowerExpression2610),ke=this.unit(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,ke.getTree());e:do{var Ce=2,Ie=this.input.LA(1);switch(Ie==ir&&(Ce=1),Ce){case 1:if(be=this.match(this.input,ir,FormulaParser.FOLLOW_POW_in_unitPowerExpression2614),this.state.failed)return fe;this.state.backtracking===0&&(Ae=this.adaptor.create(be),Ee=this.adaptor.becomeRoot(Ae,Ee));var Ve=2,$e=this.input.LA(1);switch($e==Ct&&(Ve=1),Ve){case 1:if(Pe=this.match(this.input,Ct,FormulaParser.FOLLOW_MINUS_in_unitPowerExpression2617),this.state.failed)return fe;this.state.backtracking===0&&(Re=this.adaptor.create(Pe),this.adaptor.addChild(Ee,Re));break}if(Se=this.input.LT(1),this.input.LA(1)>=ar&&this.input.LA(1)<=wr)this.input.consume(),this.state.backtracking===0&&this.adaptor.addChild(Ee,this.adaptor.create(Se)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Ue=new org.antlr.runtime.MismatchedSetException(null,this.input);throw Ue}break;default:break e}}while(!0);fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Be){if(Be instanceof org.antlr.runtime.RecognitionException)this.reportError(Be),this.recover(this.input,Be),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Be);else throw Be}finally{}return fe},unit_return:function(){FormulaParser.unit_return=function(){},org.antlr.lang.extend(FormulaParser.unit_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unit:function(){var fe=new FormulaParser.unit_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null,Se=null,ke=null,Ae=null,Re=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 114"),Ce=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),Ie=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 113"),Ve=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unitMultiplicativeExpression");try{var $e=2,Ue=this.input.LA(1);if(Ue==Qe)$e=1;else if(Ue==113)$e=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Be=new org.antlr.runtime.NoViableAltException("",97,0,this.input);throw Be}switch($e){case 1:if(be=this.match(this.input,Qe,FormulaParser.FOLLOW_IDENT_in_unit2638),this.state.failed)return fe;this.state.backtracking===0&&Ce.add(be);e:do{var Je=2,st=this.input.LA(1);switch(st==Qe&&(Je=1),Je){case 1:if(Pe=this.match(this.input,Qe,FormulaParser.FOLLOW_IDENT_in_unit2641),this.state.failed)return fe;this.state.backtracking===0&&Ce.add(Pe);break;default:break e}}while(!0);if(this.state.backtracking===0){fe.tree=Ee;var Ze=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var ze=this.adaptor.nil();if(ze=this.adaptor.becomeRoot(this.adaptor.create(se,"UNIT"),ze),!Ce.hasNext())throw new org.antlr.runtime.tree.RewriteEarlyExitException;for(;Ce.hasNext();)this.adaptor.addChild(ze,Ce.nextNode());Ce.reset(),this.adaptor.addChild(Ee,ze)}fe.tree=Ee}break;case 2:if(Se=this.match(this.input,113,FormulaParser.FOLLOW_113_in_unit2658),this.state.failed||(this.state.backtracking===0&&Ie.add(Se),this.pushFollow(FormulaParser.FOLLOW_unitMultiplicativeExpression_in_unit2660),Ae=this.unitMultiplicativeExpression(),this.state._fsp--,this.state.failed)||(this.state.backtracking===0&&Ve.add(Ae.getTree()),ke=this.match(this.input,114,FormulaParser.FOLLOW_114_in_unit2662),this.state.failed))return fe;if(this.state.backtracking===0&&Re.add(ke),this.state.backtracking===0){fe.tree=Ee;var Ze=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var ze=this.adaptor.nil();ze=this.adaptor.becomeRoot(this.adaptor.create(oe,"UNITCLUMP"),ze),this.adaptor.addChild(ze,Ve.nextTree()),this.adaptor.addChild(Ee,ze)}fe.tree=Ee}break}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(it){if(it instanceof org.antlr.runtime.RecognitionException)this.reportError(it),this.recover(this.input,it),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),it);else throw it}finally{}return fe},primitive_return:function(){FormulaParser.primitive_return=function(){},org.antlr.lang.extend(FormulaParser.primitive_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),primitive:function(){var fe=new FormulaParser.primitive_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null;try{if(Ee=this.adaptor.nil(),be=this.match(this.input,Pt,FormulaParser.FOLLOW_PRIMITIVE_in_primitive2731),this.state.failed)return fe;this.state.backtracking===0&&(Pe=this.adaptor.create(be),this.adaptor.addChild(Ee,Pe)),fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Se){if(Se instanceof org.antlr.runtime.RecognitionException)this.reportError(Se),this.recover(this.input,Se),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Se);else throw Se}finally{}return fe},string_return:function(){FormulaParser.string_return=function(){},org.antlr.lang.extend(FormulaParser.string_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),string:function(){var fe=new FormulaParser.string_return;fe.start=this.input.LT(1);var Ee=null,be=null,Pe=null;try{if(Ee=this.adaptor.nil(),be=this.match(this.input,$t,FormulaParser.FOLLOW_STRING_in_string3200),this.state.failed)return fe;this.state.backtracking===0&&(Pe=this.adaptor.create(be),Ee=this.adaptor.becomeRoot(Pe,Ee)),fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Se){if(Se instanceof org.antlr.runtime.RecognitionException)this.reportError(Se),this.recover(this.input,Se),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Se);else throw Se}finally{}return fe},synpred5_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_assignment_in_synpred5_Formula508),this.assignment(),this.state._fsp--,this.state.failed},synpred6_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_synpred6_Formula514),this.logicalExpression(),this.state._fsp--,this.state.failed},synpred8_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_forLoop_in_synpred8_Formula526),this.forLoop(),this.state._fsp--,this.state.failed},synpred9_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_forInLoop_in_synpred9_Formula532),this.forInLoop(),this.state._fsp--,this.state.failed},synpred11_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_functionDef_in_synpred11_Formula544),this.functionDef(),this.state._fsp--,this.state.failed},synpred47_Formula_fragment:function(){this.match(this.input,Ut,FormulaParser.FOLLOW_OR_in_synpred47_Formula1217),!this.state.failed&&(this.pushFollow(FormulaParser.FOLLOW_booleanXORExpression_in_synpred47_Formula1220),this.booleanXORExpression(),this.state._fsp--,this.state.failed)},synpred48_Formula_fragment:function(){this.match(this.input,Zt,FormulaParser.FOLLOW_XOR_in_synpred48_Formula1253),!this.state.failed&&(this.pushFollow(FormulaParser.FOLLOW_booleanAndExpression_in_synpred48_Formula1256),this.booleanAndExpression(),this.state._fsp--,this.state.failed)},synpred49_Formula_fragment:function(){this.match(this.input,fr,FormulaParser.FOLLOW_AND_in_synpred49_Formula1288),!this.state.failed&&(this.pushFollow(FormulaParser.FOLLOW_equalityExpression_in_synpred49_Formula1291),this.equalityExpression(),this.state._fsp--,this.state.failed)},synpred51_Formula_fragment:function(){if(this.input.LA(1)==Rt||this.input.LA(1)==dr)this.input.consume(),this.state.errorRecovery=!1,this.state.failed=!1;else{if(this.state.backtracking>0){this.state.failed=!0;return}var fe=new org.antlr.runtime.MismatchedSetException(null,this.input);throw fe}this.pushFollow(FormulaParser.FOLLOW_relationalExpression_in_synpred51_Formula1332),this.relationalExpression(),this.state._fsp--,this.state.failed},synpred55_Formula_fragment:function(){if(this.input.LA(1)>=pr&&this.input.LA(1)<=mr)this.input.consume(),this.state.errorRecovery=!1,this.state.failed=!1;else{if(this.state.backtracking>0){this.state.failed=!0;return}var fe=new org.antlr.runtime.MismatchedSetException(null,this.input);throw fe}this.pushFollow(FormulaParser.FOLLOW_additiveExpression_in_synpred55_Formula1389),this.additiveExpression(),this.state._fsp--,this.state.failed},synpred57_Formula_fragment:function(){if(this.input.LA(1)>=gr&&this.input.LA(1)<=Ct)this.input.consume(),this.state.errorRecovery=!1,this.state.failed=!1;else{if(this.state.backtracking>0){this.state.failed=!0;return}var fe=new org.antlr.runtime.MismatchedSetException(null,this.input);throw fe}this.pushFollow(FormulaParser.FOLLOW_multiplicativeExpression_in_synpred57_Formula1443),this.multiplicativeExpression(),this.state._fsp--,this.state.failed},synpred60_Formula_fragment:function(){if(this.input.LA(1)>=Wt&&this.input.LA(1)<=_r)this.input.consume(),this.state.errorRecovery=!1,this.state.failed=!1;else{if(this.state.backtracking>0){this.state.failed=!0;return}var fe=new org.antlr.runtime.MismatchedSetException(null,this.input);throw fe}this.pushFollow(FormulaParser.FOLLOW_arrayExpression_in_synpred60_Formula1486),this.arrayExpression(),this.state._fsp--,this.state.failed},synpred61_Formula_fragment:function(){if(this.input.get(this.input.index()-1).getText()==" "){if(this.state.backtracking>0){this.state.failed=!0;return}throw new org.antlr.runtime.FailedPredicateException(this.input,"synpred61_Formula",' this.input.get(this.input.index()-1).getText()!=" "')}if(this.match(this.input,tr,FormulaParser.FOLLOW_COLON_in_synpred61_Formula1538),!this.state.failed){if(this.input.get(this.input.index()-1).getText()==" "){if(this.state.backtracking>0){this.state.failed=!0;return}throw new org.antlr.runtime.FailedPredicateException(this.input,"synpred61_Formula",' this.input.get(this.input.index()-1).getText()!=" "')}this.pushFollow(FormulaParser.FOLLOW_negationExpression_in_synpred61_Formula1542),this.negationExpression(),this.state._fsp--,this.state.failed}},synpred62_Formula_fragment:function(){if(this.input.get(this.input.index()-1).getText()==" "){if(this.state.backtracking>0){this.state.failed=!0;return}throw new org.antlr.runtime.FailedPredicateException(this.input,"synpred62_Formula",' this.input.get(this.input.index()-1).getText()!=" "')}if(this.match(this.input,tr,FormulaParser.FOLLOW_COLON_in_synpred62_Formula1551),!this.state.failed){if(this.input.get(this.input.index()-1).getText()==" "){if(this.state.backtracking>0){this.state.failed=!0;return}throw new org.antlr.runtime.FailedPredicateException(this.input,"synpred62_Formula",' this.input.get(this.input.index()-1).getText()!=" "')}this.pushFollow(FormulaParser.FOLLOW_negationExpression_in_synpred62_Formula1555),this.negationExpression(),this.state._fsp--,this.state.failed}},synpred64_Formula_fragment:function(){this.match(this.input,ir,FormulaParser.FOLLOW_POW_in_synpred64_Formula1610),!this.state.failed&&(this.pushFollow(FormulaParser.FOLLOW_unaryOrNegate_in_synpred64_Formula1612),this.unaryOrNegate(),this.state._fsp--,this.state.failed)},synpred68_Formula_fragment:function(){if(this.input.get(this.input.index()-1).getText()==" "){if(this.state.backtracking>0){this.state.failed=!0;return}throw new org.antlr.runtime.FailedPredicateException(this.input,"synpred68_Formula",' this.input.get(this.input.index()-1).getText()!=" "')}var fe=2,Ee=this.input.LA(1);if(Ee==xt||Ee==kt||Ee==116)fe=1;else if(Ee==113)fe=2;else{if(this.state.backtracking>0){this.state.failed=!0;return}var be=new org.antlr.runtime.NoViableAltException("",119,0,this.input);throw be}switch(fe){case 1:if(this.pushFollow(FormulaParser.FOLLOW_selector_in_synpred68_Formula1744),this.selector(),this.state._fsp--,this.state.failed)return;break;case 2:if(this.pushFollow(FormulaParser.FOLLOW_funCall_in_synpred68_Formula1746),this.funCall(),this.state._fsp--,this.state.failed)return;break}},synpred75_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_material_in_synpred75_Formula1841),this.material(),this.state._fsp--,this.state.failed},synpred78_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_array_in_synpred78_Formula1856),this.array(),this.state._fsp--,this.state.failed},synpred80_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_funCall_in_synpred80_Formula1880),this.funCall(),this.state._fsp--,this.state.failed},synpred85_Formula_fragment:function(){this.match(this.input,Me,FormulaParser.FOLLOW_NEWLINE_in_synpred85_Formula1946),this.state.failed},synpred86_Formula_fragment:function(){this.match(this.input,Me,FormulaParser.FOLLOW_NEWLINE_in_synpred86_Formula1952),this.state.failed},synpred87_Formula_fragment:function(){this.match(this.input,Me,FormulaParser.FOLLOW_NEWLINE_in_synpred87_Formula1958),this.state.failed},synpred88_Formula_fragment:function(){this.match(this.input,Me,FormulaParser.FOLLOW_NEWLINE_in_synpred88_Formula1963),this.state.failed},synpred93_Formula_fragment:function(){this.match(this.input,Me,FormulaParser.FOLLOW_NEWLINE_in_synpred93_Formula1989),this.state.failed},synpred94_Formula_fragment:function(){this.match(this.input,Me,FormulaParser.FOLLOW_NEWLINE_in_synpred94_Formula1995),this.state.failed},synpred95_Formula_fragment:function(){this.match(this.input,Me,FormulaParser.FOLLOW_NEWLINE_in_synpred95_Formula2000),this.state.failed},synpred96_Formula_fragment:function(){this.match(this.input,Me,FormulaParser.FOLLOW_NEWLINE_in_synpred96_Formula2005),this.state.failed},synpred108_Formula_fragment:function(){this.match(this.input,116,FormulaParser.FOLLOW_116_in_synpred108_Formula2133),!this.state.failed&&(this.pushFollow(FormulaParser.FOLLOW_arrayName_in_synpred108_Formula2135),this.arrayName(),this.state._fsp--,this.state.failed)},synpred112_Formula_fragment:function(){if(this.pushFollow(FormulaParser.FOLLOW_arrayName_in_synpred112_Formula2173),this.arrayName(),this.state._fsp--,!this.state.failed){e:do{var fe=2,Ee=this.input.LA(1);switch(Ee==Me&&(fe=1),fe){case 1:if(this.match(this.input,Me,FormulaParser.FOLLOW_NEWLINE_in_synpred112_Formula2175),this.state.failed)return;break;default:break e}}while(!0);this.match(this.input,tr,FormulaParser.FOLLOW_COLON_in_synpred112_Formula2178),this.state.failed}},synpred95_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred95_Formula_fragment()}catch(be){throw be}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred94_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred94_Formula_fragment()}catch(be){throw be}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred80_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred80_Formula_fragment()}catch(be){throw be}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred49_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred49_Formula_fragment()}catch(be){throw be}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred57_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred57_Formula_fragment()}catch(be){throw be}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred68_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred68_Formula_fragment()}catch(be){throw be}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred51_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred51_Formula_fragment()}catch(be){throw be}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred62_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred62_Formula_fragment()}catch(be){throw be}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred64_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred64_Formula_fragment()}catch(be){throw be}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred93_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred93_Formula_fragment()}catch(be){throw be}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred55_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred55_Formula_fragment()}catch(be){throw be}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred85_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred85_Formula_fragment()}catch(be){throw be}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred87_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred87_Formula_fragment()}catch(be){throw be}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred48_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred48_Formula_fragment()}catch(be){throw be}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred86_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred86_Formula_fragment()}catch(be){throw be}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred9_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred9_Formula_fragment()}catch(be){throw be}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred75_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred75_Formula_fragment()}catch(be){throw be}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred96_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred96_Formula_fragment()}catch(be){throw be}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred47_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred47_Formula_fragment()}catch(be){throw be}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred8_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred8_Formula_fragment()}catch(be){throw be}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred112_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred112_Formula_fragment()}catch(be){throw be}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred6_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred6_Formula_fragment()}catch(be){throw be}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred5_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred5_Formula_fragment()}catch(be){throw be}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred60_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred60_Formula_fragment()}catch(be){throw be}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred61_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred61_Formula_fragment()}catch(be){throw be}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred108_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred108_Formula_fragment()}catch(be){throw be}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred11_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred11_Formula_fragment()}catch(be){throw be}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred78_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred78_Formula_fragment()}catch(be){throw be}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred88_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred88_Formula_fragment()}catch(be){throw be}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee}},!0),org.antlr.lang.augmentObject(FormulaParser,{DFA5_eotS:"",DFA5_eofS:"",DFA5_minS:"&\0\b\0\0\b",DFA5_maxS:"q\0\b\0\0\b",DFA5_acceptS:`	\b	
\x07`,DFA5_specialS:"\0\b\b}>",DFA5_transitionS:[`\r\v\v
`,"","","","","","","","","","","","","","","","","","","","","",""]}),org.antlr.lang.augmentObject(FormulaParser,{DFA5_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA5_eotS),DFA5_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA5_eofS),DFA5_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA5_minS),DFA5_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA5_maxS),DFA5_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA5_acceptS),DFA5_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA5_specialS),DFA5_transition:function(){var fe=[],Ee,be=FormulaParser.DFA5_transitionS.length;for(Ee=0;Ee<be;Ee++)fe.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA5_transitionS[Ee]));return fe}()}),FormulaParser.DFA5=function(fe){this.recognizer=fe,this.decisionNumber=5,this.eot=FormulaParser.DFA5_eot,this.eof=FormulaParser.DFA5_eof,this.min=FormulaParser.DFA5_min,this.max=FormulaParser.DFA5_max,this.accept=FormulaParser.DFA5_accept,this.special=FormulaParser.DFA5_special,this.transition=FormulaParser.DFA5_transition},org.antlr.lang.extend(FormulaParser.DFA5,org.antlr.runtime.DFA,{getDescription:function(){return"120:1: expression : ( assignment | logicalExpression | whileLoop | forLoop | forInLoop | ifThenElse | functionDef | returnExp | tryCatch | throwExp );"},specialStateTransition:function(fe,Ee){var be=fe,Pe=function(ke,Ae){switch(ke){case 0:Ae.LA(1);var Re=Ae.index();if(Ae.rewind(),ke=-1,this.synpred5_Formula()?ke=19:this.synpred6_Formula()&&(ke=3),Ae.seek(Re),ke>=0)return ke;break;case 1:Ae.LA(1);var Ce=Ae.index();if(Ae.rewind(),ke=-1,this.synpred5_Formula()?ke=19:this.synpred6_Formula()&&(ke=3),Ae.seek(Ce),ke>=0)return ke;break;case 2:Ae.LA(1);var Ie=Ae.index();if(Ae.rewind(),ke=-1,this.synpred6_Formula()?ke=3:this.synpred11_Formula()&&(ke=20),Ae.seek(Ie),ke>=0)return ke;break;case 3:Ae.LA(1);var Ve=Ae.index();if(Ae.rewind(),ke=-1,this.synpred8_Formula()?ke=21:this.synpred9_Formula()&&(ke=22),Ae.seek(Ve),ke>=0)return ke;break}}.call(this.recognizer,fe,Ee);if(!org.antlr.lang.isUndefined(Pe))return Pe;if(this.recognizer.state.backtracking>0)return this.recognizer.state.failed=!0,-1;var Se=new org.antlr.runtime.NoViableAltException(this.getDescription(),5,be,Ee);throw this.error(Se),Se},dummy:null}),org.antlr.lang.augmentObject(FormulaParser,{DFA57_eotS:"\v",DFA57_eofS:"\v",DFA57_minS:"<\0",DFA57_maxS:"b\0",DFA57_acceptS:"\x07\b	",DFA57_specialS:"\0}>",DFA57_transitionS:["\b	\x07","","","","","","","","","",""]}),org.antlr.lang.augmentObject(FormulaParser,{DFA57_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA57_eotS),DFA57_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA57_eofS),DFA57_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA57_minS),DFA57_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA57_maxS),DFA57_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA57_acceptS),DFA57_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA57_specialS),DFA57_transition:function(){var fe=[],Ee,be=FormulaParser.DFA57_transitionS.length;for(Ee=0;Ee<be;Ee++)fe.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA57_transitionS[Ee]));return fe}()}),FormulaParser.DFA57=function(fe){this.recognizer=fe,this.decisionNumber=57,this.eot=FormulaParser.DFA57_eot,this.eof=FormulaParser.DFA57_eof,this.min=FormulaParser.DFA57_min,this.max=FormulaParser.DFA57_max,this.accept=FormulaParser.DFA57_accept,this.special=FormulaParser.DFA57_special,this.transition=FormulaParser.DFA57_transition},org.antlr.lang.extend(FormulaParser.DFA57,org.antlr.runtime.DFA,{getDescription:function(){return"283:1: value : ( number | bool | string | material | IDENT | primitive | array | anonFunctionDef | newObject );"},specialStateTransition:function(fe,Ee){var be=fe,Pe=function(ke,Ae){switch(ke){case 0:Ae.LA(1);var Re=Ae.index();if(Ae.rewind(),ke=-1,this.synpred75_Formula()?ke=10:this.synpred78_Formula()&&(ke=7),Ae.seek(Re),ke>=0)return ke;break}}.call(this.recognizer,fe,Ee);if(!org.antlr.lang.isUndefined(Pe))return Pe;if(this.recognizer.state.backtracking>0)return this.recognizer.state.failed=!0,-1;var Se=new org.antlr.runtime.NoViableAltException(this.getDescription(),57,be,Ee);throw this.error(Se),Se},dummy:null}),org.antlr.lang.augmentObject(FormulaParser,{DFA58_eotS:"",DFA58_eofS:"",DFA58_minS:" \0",DFA58_maxS:"t\0",DFA58_acceptS:"",DFA58_specialS:"\0}>",DFA58_transitionS:["\r\r","","","","","","","","","","","","","","","","","","","","","","","","",""]}),org.antlr.lang.augmentObject(FormulaParser,{DFA58_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA58_eotS),DFA58_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA58_eofS),DFA58_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA58_minS),DFA58_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA58_maxS),DFA58_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA58_acceptS),DFA58_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA58_specialS),DFA58_transition:function(){var fe=[],Ee,be=FormulaParser.DFA58_transitionS.length;for(Ee=0;Ee<be;Ee++)fe.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA58_transitionS[Ee]));return fe}()}),FormulaParser.DFA58=function(fe){this.recognizer=fe,this.decisionNumber=58,this.eot=FormulaParser.DFA58_eot,this.eof=FormulaParser.DFA58_eof,this.min=FormulaParser.DFA58_min,this.max=FormulaParser.DFA58_max,this.accept=FormulaParser.DFA58_accept,this.special=FormulaParser.DFA58_special,this.transition=FormulaParser.DFA58_transition},org.antlr.lang.extend(FormulaParser.DFA58,org.antlr.runtime.DFA,{getDescription:function(){return"296:22: ( funCall )?"},specialStateTransition:function(fe,Ee){var be=fe,Pe=function(ke,Ae){switch(ke){case 0:Ae.LA(1);var Re=Ae.index();if(Ae.rewind(),ke=-1,this.synpred80_Formula()?ke=25:(this.input.get(this.input.index()-1).getText()==" "||this.input.get(this.input.index()-1).getText()!=" ")&&(ke=2),Ae.seek(Re),ke>=0)return ke;break}}.call(this.recognizer,fe,Ee);if(!org.antlr.lang.isUndefined(Pe))return Pe;if(this.recognizer.state.backtracking>0)return this.recognizer.state.failed=!0,-1;var Se=new org.antlr.runtime.NoViableAltException(this.getDescription(),58,be,Ee);throw this.error(Se),Se},dummy:null}),org.antlr.lang.augmentObject(FormulaParser,{DFA65_eotS:"",DFA65_eofS:"",DFA65_minS:"  ",DFA65_maxS:"qq",DFA65_acceptS:"",DFA65_specialS:"}>",DFA65_transitionS:[`\x1B
`,"",`\x1B
`,""]}),org.antlr.lang.augmentObject(FormulaParser,{DFA65_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA65_eotS),DFA65_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA65_eofS),DFA65_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA65_minS),DFA65_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA65_maxS),DFA65_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA65_acceptS),DFA65_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA65_specialS),DFA65_transition:function(){var fe=[],Ee,be=FormulaParser.DFA65_transitionS.length;for(Ee=0;Ee<be;Ee++)fe.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA65_transitionS[Ee]));return fe}()}),FormulaParser.DFA65=function(fe){this.recognizer=fe,this.decisionNumber=65,this.eot=FormulaParser.DFA65_eot,this.eof=FormulaParser.DFA65_eof,this.min=FormulaParser.DFA65_min,this.max=FormulaParser.DFA65_max,this.accept=FormulaParser.DFA65_accept,this.special=FormulaParser.DFA65_special,this.transition=FormulaParser.DFA65_transition},org.antlr.lang.extend(FormulaParser.DFA65,org.antlr.runtime.DFA,{getDescription:function(){return"309:16: ( label ( NEWLINE )* ( ',' ( NEWLINE )* label ( NEWLINE )* )* )?"},dummy:null}),org.antlr.lang.augmentObject(FormulaParser,{DFA72_eotS:"",DFA72_eofS:"",DFA72_minS:"  ",DFA72_maxS:"qq",DFA72_acceptS:"",DFA72_specialS:"}>",DFA72_transitionS:[`\x1B
`,"",`\x1B
`,""]}),org.antlr.lang.augmentObject(FormulaParser,{DFA72_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA72_eotS),DFA72_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA72_eofS),DFA72_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA72_minS),DFA72_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA72_maxS),DFA72_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA72_acceptS),DFA72_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA72_specialS),DFA72_transition:function(){var fe=[],Ee,be=FormulaParser.DFA72_transitionS.length;for(Ee=0;Ee<be;Ee++)fe.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA72_transitionS[Ee]));return fe}()}),FormulaParser.DFA72=function(fe){this.recognizer=fe,this.decisionNumber=72,this.eot=FormulaParser.DFA72_eot,this.eof=FormulaParser.DFA72_eof,this.min=FormulaParser.DFA72_min,this.max=FormulaParser.DFA72_max,this.accept=FormulaParser.DFA72_accept,this.special=FormulaParser.DFA72_special,this.transition=FormulaParser.DFA72_transition},org.antlr.lang.extend(FormulaParser.DFA72,org.antlr.runtime.DFA,{getDescription:function(){return"310:19: ( label ( NEWLINE )* ( ',' ( NEWLINE )* label ( NEWLINE )* )* )?"},dummy:null}),org.antlr.lang.augmentObject(FormulaParser,{DFA85_eotS:"",DFA85_eofS:"",DFA85_minS:" \0\0",DFA85_maxS:"q\0\0",DFA85_acceptS:"\x07",DFA85_specialS:"\0}>",DFA85_transitionS:[`\x1B\b

`,"","","","","","","","","","","","","",""]}),org.antlr.lang.augmentObject(FormulaParser,{DFA85_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA85_eotS),DFA85_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA85_eofS),DFA85_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA85_minS),DFA85_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA85_maxS),DFA85_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA85_acceptS),DFA85_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA85_specialS),DFA85_transition:function(){var fe=[],Ee,be=FormulaParser.DFA85_transitionS.length;for(Ee=0;Ee<be;Ee++)fe.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA85_transitionS[Ee]));return fe}()}),FormulaParser.DFA85=function(fe){this.recognizer=fe,this.decisionNumber=85,this.eot=FormulaParser.DFA85_eot,this.eof=FormulaParser.DFA85_eof,this.min=FormulaParser.DFA85_min,this.max=FormulaParser.DFA85_max,this.accept=FormulaParser.DFA85_accept,this.special=FormulaParser.DFA85_special,this.transition=FormulaParser.DFA85_transition},org.antlr.lang.extend(FormulaParser.DFA85,org.antlr.runtime.DFA,{getDescription:function(){return"331:2: ( arrayName ( NEWLINE )* COLON )?"},specialStateTransition:function(fe,Ee){var be=fe,Pe=function(ke,Ae){switch(ke){case 0:Ae.LA(1);var Re=Ae.index();if(Ae.rewind(),ke=-1,this.synpred112_Formula()?ke=10:ke=2,Ae.seek(Re),ke>=0)return ke;break;case 1:Ae.LA(1);var Ce=Ae.index();if(Ae.rewind(),ke=-1,this.synpred112_Formula()?ke=10:ke=2,Ae.seek(Ce),ke>=0)return ke;break}}.call(this.recognizer,fe,Ee);if(!org.antlr.lang.isUndefined(Pe))return Pe;if(this.recognizer.state.backtracking>0)return this.recognizer.state.failed=!0,-1;var Se=new org.antlr.runtime.NoViableAltException(this.getDescription(),85,be,Ee);throw this.error(Se),Se},dummy:null}),org.antlr.lang.augmentObject(FormulaParser,{tokenNames:["<invalid>","<EOR>","<DOWN>","<UP>","NEGATE","ASSIGN","FUNCALL","MATERIAL","UNIT","POWER","DEFAULTS","PARAMS","UNITCLUMP","ARRAY","LINES","WHILE","IFTHENELSE","ELSE","FOR","FORIN","FUNCTION","ANONFUNCTION","NUMBER","LABEL","RANGE","INNER","ASSIGNED","SELECTOR","DOTSELECTOR","NEW","TRYCATCH","THROW","NEWLINE","W","H","I","L","E","WHILESTATEMENT","F","O","R","FORSTATEMENT","M","FROMSTATEMENT","N","INSTATEMENT","T","TOSTATEMENT","B","Y","BYSTATEMENT","P","LOOPSTATEMENT","IFSTATEMENT","THENSTATEMENT","S","ELSESTATEMENT","U","C","FUNCTIONSTATEMENT","D","ENDBLOCK","RETURNSTATEMENT","NEWSTATEMENT","TRYSTATEMENT","A","CATCHSTATEMENT","THROWSTATEMENT","IDENT","EQUALS","PRIMITIVE","OR","XOR","X","AND","NOTEQUALS","LT","LTEQ","GT","GTEQ","PLUS","MINUS","MULT","DIV","MOD","COLON","POW","NOT","LARR","RARR","LCURL","RCURL","COMMA","STRING","INTEGER","FLOAT","TRUE","FALSE","PER","CUBED","SQUARED","Q","LBRACKET","RBRACKET","COMMENT","LINE_COMMENT","WS","G","J","K","V","Z","'('","')'","'<-'","'.'"],FOLLOW_NEWLINE_in_lines160:new org.antlr.runtime.BitSet([0,2420114497,3406037171,131079]),FOLLOW_expression_in_lines164:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_lines168:new org.antlr.runtime.BitSet([0,2420114497,3406037171,131079]),FOLLOW_EOF_in_lines171:new org.antlr.runtime.BitSet([0,2420114496,3406037171,131079]),FOLLOW_EOF_in_lines176:new org.antlr.runtime.BitSet([2,0]),FOLLOW_assignment_in_expression508:new org.antlr.runtime.BitSet([2,0]),FOLLOW_logicalExpression_in_expression514:new org.antlr.runtime.BitSet([2,0]),FOLLOW_whileLoop_in_expression520:new org.antlr.runtime.BitSet([2,0]),FOLLOW_forLoop_in_expression526:new org.antlr.runtime.BitSet([2,0]),FOLLOW_forInLoop_in_expression532:new org.antlr.runtime.BitSet([2,0]),FOLLOW_ifThenElse_in_expression538:new org.antlr.runtime.BitSet([2,0]),FOLLOW_functionDef_in_expression544:new org.antlr.runtime.BitSet([2,0]),FOLLOW_returnExp_in_expression550:new org.antlr.runtime.BitSet([2,0]),FOLLOW_tryCatch_in_expression556:new org.antlr.runtime.BitSet([2,0]),FOLLOW_throwExp_in_expression562:new org.antlr.runtime.BitSet([2,0]),FOLLOW_RETURNSTATEMENT_in_returnExp574:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_returnExp577:new org.antlr.runtime.BitSet([2,0]),FOLLOW_expression_in_innerBlock590:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_innerBlock594:new org.antlr.runtime.BitSet([2,2420114497,3406037171,131079]),FOLLOW_WHILESTATEMENT_in_whileLoop619:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_whileLoop621:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_whileLoop623:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_whileLoop626:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_whileLoop629:new org.antlr.runtime.BitSet([0,2097152]),FOLLOW_LOOPSTATEMENT_in_whileLoop631:new org.antlr.runtime.BitSet([2,0]),FOLLOW_FORSTATEMENT_in_forLoop652:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_forLoop654:new org.antlr.runtime.BitSet([0,4096]),FOLLOW_FROMSTATEMENT_in_forLoop656:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_forLoop658:new org.antlr.runtime.BitSet([0,65536]),FOLLOW_TOSTATEMENT_in_forLoop660:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_forLoop662:new org.antlr.runtime.BitSet([0,524289]),FOLLOW_BYSTATEMENT_in_forLoop665:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_forLoop667:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_forLoop671:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_forLoop674:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_forLoop677:new org.antlr.runtime.BitSet([0,2097152]),FOLLOW_LOOPSTATEMENT_in_forLoop679:new org.antlr.runtime.BitSet([2,0]),FOLLOW_FORSTATEMENT_in_forInLoop707:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_forInLoop709:new org.antlr.runtime.BitSet([0,16384]),FOLLOW_INSTATEMENT_in_forInLoop711:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_forInLoop713:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_forInLoop715:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_forInLoop718:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_forInLoop721:new org.antlr.runtime.BitSet([0,2097152]),FOLLOW_LOOPSTATEMENT_in_forInLoop723:new org.antlr.runtime.BitSet([2,0]),FOLLOW_IFSTATEMENT_in_ifThenElse748:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_ifThenElse750:new org.antlr.runtime.BitSet([0,8388608]),FOLLOW_THENSTATEMENT_in_ifThenElse752:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_ifThenElse755:new org.antlr.runtime.BitSet([0,3527410753,3406037171,131079]),FOLLOW_innerBlock_in_ifThenElse758:new org.antlr.runtime.BitSet([0,1107296256]),FOLLOW_ELSESTATEMENT_in_ifThenElse762:new org.antlr.runtime.BitSet([0,4194304]),FOLLOW_IFSTATEMENT_in_ifThenElse764:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_ifThenElse766:new org.antlr.runtime.BitSet([0,8388608]),FOLLOW_THENSTATEMENT_in_ifThenElse768:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_ifThenElse770:new org.antlr.runtime.BitSet([0,3527410753,3406037171,131079]),FOLLOW_innerBlock_in_ifThenElse773:new org.antlr.runtime.BitSet([0,1107296256]),FOLLOW_ELSESTATEMENT_in_ifThenElse778:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_ifThenElse780:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_ifThenElse783:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_ifThenElse787:new org.antlr.runtime.BitSet([0,4194304]),FOLLOW_IFSTATEMENT_in_ifThenElse789:new org.antlr.runtime.BitSet([2,0]),FOLLOW_FUNCTIONSTATEMENT_in_functionDef820:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_functionDef822:new org.antlr.runtime.BitSet([0,0,0,131072]),FOLLOW_113_in_functionDef824:new org.antlr.runtime.BitSet([0,0,32,262144]),FOLLOW_IDENT_in_functionDef827:new org.antlr.runtime.BitSet([0,0,536870976,262144]),FOLLOW_EQUALS_in_functionDef831:new org.antlr.runtime.BitSet([0,0,3389259776,7]),FOLLOW_defaultValue_in_functionDef834:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_functionDef839:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_functionDef841:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_functionDef848:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_functionDef850:new org.antlr.runtime.BitSet([0,0,64,0]),FOLLOW_EQUALS_in_functionDef852:new org.antlr.runtime.BitSet([0,0,3389259776,7]),FOLLOW_defaultValue_in_functionDef854:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_114_in_functionDef861:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_functionDef863:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_functionDef866:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_functionDef869:new org.antlr.runtime.BitSet([0,268435456]),FOLLOW_FUNCTIONSTATEMENT_in_functionDef871:new org.antlr.runtime.BitSet([2,0]),FOLLOW_TRYSTATEMENT_in_tryCatch904:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_tryCatch906:new org.antlr.runtime.BitSet([0,2420114497,3406037179,131079]),FOLLOW_innerBlock_in_tryCatch909:new org.antlr.runtime.BitSet([0,0,8,0]),FOLLOW_CATCHSTATEMENT_in_tryCatch911:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_tryCatch913:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_tryCatch915:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_tryCatch919:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_tryCatch921:new org.antlr.runtime.BitSet([0,0,2,0]),FOLLOW_TRYSTATEMENT_in_tryCatch923:new org.antlr.runtime.BitSet([2,0]),FOLLOW_THROWSTATEMENT_in_throwExp945:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_primaryExpression_in_throwExp947:new org.antlr.runtime.BitSet([2,0]),FOLLOW_FUNCTIONSTATEMENT_in_anonFunctionDef967:new org.antlr.runtime.BitSet([0,0,0,131072]),FOLLOW_113_in_anonFunctionDef970:new org.antlr.runtime.BitSet([0,0,32,262144]),FOLLOW_IDENT_in_anonFunctionDef973:new org.antlr.runtime.BitSet([0,0,536870976,262144]),FOLLOW_EQUALS_in_anonFunctionDef977:new org.antlr.runtime.BitSet([0,0,3389259776,7]),FOLLOW_defaultValue_in_anonFunctionDef980:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_anonFunctionDef985:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_anonFunctionDef987:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_anonFunctionDef994:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_anonFunctionDef996:new org.antlr.runtime.BitSet([0,0,64,0]),FOLLOW_EQUALS_in_anonFunctionDef998:new org.antlr.runtime.BitSet([0,0,3389259776,7]),FOLLOW_defaultValue_in_anonFunctionDef1000:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_114_in_anonFunctionDef1007:new org.antlr.runtime.BitSet([0,2420114497,3406037171,131079]),FOLLOW_NEWLINE_in_anonFunctionDef1012:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_anonFunctionDef1015:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_anonFunctionDef1018:new org.antlr.runtime.BitSet([0,268435456]),FOLLOW_FUNCTIONSTATEMENT_in_anonFunctionDef1020:new org.antlr.runtime.BitSet([2,0]),FOLLOW_expression_in_anonFunctionDef1025:new org.antlr.runtime.BitSet([2,0]),FOLLOW_IDENT_in_assignment1067:new org.antlr.runtime.BitSet([0,0,0,131072]),FOLLOW_113_in_assignment1069:new org.antlr.runtime.BitSet([0,0,32,262144]),FOLLOW_IDENT_in_assignment1072:new org.antlr.runtime.BitSet([0,0,536870976,262144]),FOLLOW_EQUALS_in_assignment1076:new org.antlr.runtime.BitSet([0,0,3389259776,7]),FOLLOW_defaultValue_in_assignment1078:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_assignment1083:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_assignment1085:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_assignment1092:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_assignment1094:new org.antlr.runtime.BitSet([0,0,64,0]),FOLLOW_EQUALS_in_assignment1096:new org.antlr.runtime.BitSet([0,0,3389259776,7]),FOLLOW_defaultValue_in_assignment1098:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_114_in_assignment1105:new org.antlr.runtime.BitSet([0,0,0,524288]),FOLLOW_115_in_assignment1107:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_assignment1109:new org.antlr.runtime.BitSet([2,0]),FOLLOW_PRIMITIVE_in_assignment1137:new org.antlr.runtime.BitSet([0,0,536870912,524288]),FOLLOW_assigned_in_assignment1141:new org.antlr.runtime.BitSet([0,0,536870912,524288]),FOLLOW_COMMA_in_assignment1145:new org.antlr.runtime.BitSet([0,0,160,0]),FOLLOW_PRIMITIVE_in_assignment1148:new org.antlr.runtime.BitSet([0,0,536870912,524288]),FOLLOW_assigned_in_assignment1152:new org.antlr.runtime.BitSet([0,0,536870912,524288]),FOLLOW_115_in_assignment1158:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_assignment1160:new org.antlr.runtime.BitSet([2,0]),FOLLOW_IDENT_in_assigned1186:new org.antlr.runtime.BitSet([2,0,167772160,1048576]),FOLLOW_selector_in_assigned1188:new org.antlr.runtime.BitSet([2,0]),FOLLOW_booleanXORExpression_in_logicalExpression1214:new org.antlr.runtime.BitSet([2,0,256,0]),FOLLOW_OR_in_logicalExpression1217:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_booleanXORExpression_in_logicalExpression1220:new org.antlr.runtime.BitSet([2,0,256,0]),FOLLOW_booleanAndExpression_in_booleanXORExpression1250:new org.antlr.runtime.BitSet([2,0,512,0]),FOLLOW_XOR_in_booleanXORExpression1253:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_booleanAndExpression_in_booleanXORExpression1256:new org.antlr.runtime.BitSet([2,0,512,0]),FOLLOW_equalityExpression_in_booleanAndExpression1285:new org.antlr.runtime.BitSet([2,0,2048,0]),FOLLOW_AND_in_booleanAndExpression1288:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_equalityExpression_in_booleanAndExpression1291:new org.antlr.runtime.BitSet([2,0,2048,0]),FOLLOW_relationalExpression_in_equalityExpression1322:new org.antlr.runtime.BitSet([2,0,4160,0]),FOLLOW_set_in_equalityExpression1325:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_relationalExpression_in_equalityExpression1332:new org.antlr.runtime.BitSet([2,0,4160,0]),FOLLOW_additiveExpression_in_relationalExpression1374:new org.antlr.runtime.BitSet([2,0,122880,0]),FOLLOW_set_in_relationalExpression1378:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_additiveExpression_in_relationalExpression1389:new org.antlr.runtime.BitSet([2,0,122880,0]),FOLLOW_multiplicativeExpression_in_additiveExpression1432:new org.antlr.runtime.BitSet([2,0,393216,0]),FOLLOW_set_in_additiveExpression1436:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_multiplicativeExpression_in_additiveExpression1443:new org.antlr.runtime.BitSet([2,0,393216,0]),FOLLOW_arrayExpression_in_multiplicativeExpression1473:new org.antlr.runtime.BitSet([2,0,3670016,0]),FOLLOW_set_in_multiplicativeExpression1477:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_arrayExpression_in_multiplicativeExpression1486:new org.antlr.runtime.BitSet([2,0,3670016,0]),FOLLOW_negationExpression_in_arrayExpression1532:new org.antlr.runtime.BitSet([2,0,4194304,0]),FOLLOW_COLON_in_arrayExpression1538:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_negationExpression_in_arrayExpression1542:new org.antlr.runtime.BitSet([2,0,4194304,0]),FOLLOW_COLON_in_arrayExpression1551:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_negationExpression_in_arrayExpression1555:new org.antlr.runtime.BitSet([2,0]),FOLLOW_MINUS_in_negationExpression1580:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_powerExpression_in_negationExpression1582:new org.antlr.runtime.BitSet([2,0]),FOLLOW_powerExpression_in_negationExpression1596:new org.antlr.runtime.BitSet([2,0]),FOLLOW_unaryExpression_in_powerExpression1607:new org.antlr.runtime.BitSet([2,0,8388608,0]),FOLLOW_POW_in_powerExpression1610:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_unaryOrNegate_in_powerExpression1612:new org.antlr.runtime.BitSet([2,0,8388608,0]),FOLLOW_unaryExpression_in_unaryOrNegate1639:new org.antlr.runtime.BitSet([2,0]),FOLLOW_MINUS_in_unaryOrNegate1645:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_unaryExpression_in_unaryOrNegate1647:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NOT_in_unaryExpression1675:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_innerPrimaryExpression_in_unaryExpression1678:new org.antlr.runtime.BitSet([2,0]),FOLLOW_innerPrimaryExpression_in_unaryExpression1687:new org.antlr.runtime.BitSet([2,0]),FOLLOW_selectionExpression_in_innerPrimaryExpression1718:new org.antlr.runtime.BitSet([2,0]),FOLLOW_primaryExpression_in_selectionExpression1738:new org.antlr.runtime.BitSet([2,0,167772160,1179648]),FOLLOW_selector_in_selectionExpression1744:new org.antlr.runtime.BitSet([2,0,167772160,1179648]),FOLLOW_funCall_in_selectionExpression1746:new org.antlr.runtime.BitSet([2,0,167772160,1179648]),FOLLOW_113_in_funCall1761:new org.antlr.runtime.BitSet([0,268435456,3406037153,393223]),FOLLOW_logicalExpression_in_funCall1765:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_funCall1768:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_funCall1770:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_114_in_funCall1777:new org.antlr.runtime.BitSet([2,0]),FOLLOW_113_in_primaryExpression1798:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_primaryExpression1801:new org.antlr.runtime.BitSet([0,0,0,262144]),FOLLOW_114_in_primaryExpression1803:new org.antlr.runtime.BitSet([2,0]),FOLLOW_value_in_primaryExpression1809:new org.antlr.runtime.BitSet([2,0]),FOLLOW_number_in_value1823:new org.antlr.runtime.BitSet([2,0]),FOLLOW_bool_in_value1829:new org.antlr.runtime.BitSet([2,0]),FOLLOW_string_in_value1835:new org.antlr.runtime.BitSet([2,0]),FOLLOW_material_in_value1841:new org.antlr.runtime.BitSet([2,0]),FOLLOW_IDENT_in_value1846:new org.antlr.runtime.BitSet([2,0]),FOLLOW_primitive_in_value1851:new org.antlr.runtime.BitSet([2,0]),FOLLOW_array_in_value1856:new org.antlr.runtime.BitSet([2,0]),FOLLOW_anonFunctionDef_in_value1861:new org.antlr.runtime.BitSet([2,0]),FOLLOW_newObject_in_value1866:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWSTATEMENT_in_newObject1876:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_newObject1878:new org.antlr.runtime.BitSet([2,0,167772160,1179648]),FOLLOW_funCall_in_newObject1880:new org.antlr.runtime.BitSet([2,0]),FOLLOW_negnumber_in_defaultValue1906:new org.antlr.runtime.BitSet([2,0]),FOLLOW_number_in_defaultValue1912:new org.antlr.runtime.BitSet([2,0]),FOLLOW_bool_in_defaultValue1918:new org.antlr.runtime.BitSet([2,0]),FOLLOW_string_in_defaultValue1924:new org.antlr.runtime.BitSet([2,0]),FOLLOW_array_in_defaultValue1930:new org.antlr.runtime.BitSet([2,0]),FOLLOW_LARR_in_array1944:new org.antlr.runtime.BitSet([0,268435457,3473670305,131079]),FOLLOW_NEWLINE_in_array1946:new org.antlr.runtime.BitSet([0,268435457,3473670305,131079]),FOLLOW_label_in_array1950:new org.antlr.runtime.BitSet([0,1,603979776,0]),FOLLOW_NEWLINE_in_array1952:new org.antlr.runtime.BitSet([0,1,603979776,0]),FOLLOW_COMMA_in_array1956:new org.antlr.runtime.BitSet([0,268435457,3406561441,131079]),FOLLOW_NEWLINE_in_array1958:new org.antlr.runtime.BitSet([0,268435457,3406561441,131079]),FOLLOW_label_in_array1961:new org.antlr.runtime.BitSet([0,1,603979776,0]),FOLLOW_NEWLINE_in_array1963:new org.antlr.runtime.BitSet([0,1,603979776,0]),FOLLOW_NEWLINE_in_array1970:new org.antlr.runtime.BitSet([0,1,67108864,0]),FOLLOW_RARR_in_array1973:new org.antlr.runtime.BitSet([2,0]),FOLLOW_LCURL_in_array1987:new org.antlr.runtime.BitSet([0,268435457,3674996897,131079]),FOLLOW_NEWLINE_in_array1989:new org.antlr.runtime.BitSet([0,268435457,3674996897,131079]),FOLLOW_label_in_array1993:new org.antlr.runtime.BitSet([0,1,805306368,0]),FOLLOW_NEWLINE_in_array1995:new org.antlr.runtime.BitSet([0,1,805306368,0]),FOLLOW_COMMA_in_array1998:new org.antlr.runtime.BitSet([0,268435457,3406561441,131079]),FOLLOW_NEWLINE_in_array2000:new org.antlr.runtime.BitSet([0,268435457,3406561441,131079]),FOLLOW_label_in_array2003:new org.antlr.runtime.BitSet([0,1,805306368,0]),FOLLOW_NEWLINE_in_array2005:new org.antlr.runtime.BitSet([0,1,805306368,0]),FOLLOW_NEWLINE_in_array2012:new org.antlr.runtime.BitSet([0,1,268435456,0]),FOLLOW_RCURL_in_array2015:new org.antlr.runtime.BitSet([2,0]),FOLLOW_minarray_in_selector2036:new org.antlr.runtime.BitSet([2,0]),FOLLOW_dotselector_in_selector2040:new org.antlr.runtime.BitSet([2,0]),FOLLOW_LARR_in_minarray2067:new org.antlr.runtime.BitSet([0,268435456,3406561441,131079]),FOLLOW_logicalExpression_in_minarray2072:new org.antlr.runtime.BitSet([0,0,603979776,0]),FOLLOW_MULT_in_minarray2074:new org.antlr.runtime.BitSet([0,0,603979776,0]),FOLLOW_COMMA_in_minarray2078:new org.antlr.runtime.BitSet([0,268435456,3406561441,131079]),FOLLOW_logicalExpression_in_minarray2082:new org.antlr.runtime.BitSet([0,0,603979776,0]),FOLLOW_MULT_in_minarray2084:new org.antlr.runtime.BitSet([0,0,603979776,0]),FOLLOW_RARR_in_minarray2091:new org.antlr.runtime.BitSet([2,0]),FOLLOW_LCURL_in_minarray2097:new org.antlr.runtime.BitSet([0,268435456,3406561441,131079]),FOLLOW_logicalExpression_in_minarray2102:new org.antlr.runtime.BitSet([0,0,805306368,0]),FOLLOW_MULT_in_minarray2104:new org.antlr.runtime.BitSet([0,0,805306368,0]),FOLLOW_COMMA_in_minarray2108:new org.antlr.runtime.BitSet([0,268435456,3406561441,131079]),FOLLOW_logicalExpression_in_minarray2112:new org.antlr.runtime.BitSet([0,0,805306368,0]),FOLLOW_MULT_in_minarray2114:new org.antlr.runtime.BitSet([0,0,805306368,0]),FOLLOW_RCURL_in_minarray2121:new org.antlr.runtime.BitSet([2,0]),FOLLOW_116_in_dotselector2133:new org.antlr.runtime.BitSet([0,0,1074266144,0]),FOLLOW_arrayName_in_dotselector2135:new org.antlr.runtime.BitSet([2,0,0,1048576]),FOLLOW_set_in_arrayName0:new org.antlr.runtime.BitSet([2,0]),FOLLOW_arrayName_in_label2173:new org.antlr.runtime.BitSet([0,1,4194304,0]),FOLLOW_NEWLINE_in_label2175:new org.antlr.runtime.BitSet([0,1,4194304,0]),FOLLOW_COLON_in_label2178:new org.antlr.runtime.BitSet([0,268435457,3406037153,131079]),FOLLOW_NEWLINE_in_label2182:new org.antlr.runtime.BitSet([0,268435457,3406037153,131079]),FOLLOW_logicalExpression_in_label2185:new org.antlr.runtime.BitSet([2,0]),FOLLOW_set_in_number0:new org.antlr.runtime.BitSet([2,0]),FOLLOW_MINUS_in_negnumber2261:new org.antlr.runtime.BitSet([0,0,2147483648,1]),FOLLOW_number_in_negnumber2263:new org.antlr.runtime.BitSet([2,0]),FOLLOW_set_in_bool0:new org.antlr.runtime.BitSet([2,0]),FOLLOW_LCURL_in_material2415:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_additiveExpression_in_material2417:new org.antlr.runtime.BitSet([0,0,2147483680,131072]),FOLLOW_unitMultiplicativeExpression_in_material2421:new org.antlr.runtime.BitSet([0,0,268435456,0]),FOLLOW_RCURL_in_material2423:new org.antlr.runtime.BitSet([2,0]),FOLLOW_unitInnerMultiplicativeExpression_in_unitMultiplicativeExpression2460:new org.antlr.runtime.BitSet([2,0,0,8]),FOLLOW_PER_in_unitMultiplicativeExpression2464:new org.antlr.runtime.BitSet([0,0,2147483680,131072]),FOLLOW_unitInnerMultiplicativeExpression_in_unitMultiplicativeExpression2467:new org.antlr.runtime.BitSet([2,0,0,8]),FOLLOW_unitClump_in_unitInnerMultiplicativeExpression2483:new org.antlr.runtime.BitSet([2,0,1572864,0]),FOLLOW_set_in_unitInnerMultiplicativeExpression2487:new org.antlr.runtime.BitSet([0,0,2147483680,131072]),FOLLOW_unitClump_in_unitInnerMultiplicativeExpression2494:new org.antlr.runtime.BitSet([2,0,1572864,0]),FOLLOW_INTEGER_in_unitClump2510:new org.antlr.runtime.BitSet([0,0,1048576,0]),FOLLOW_DIV_in_unitClump2512:new org.antlr.runtime.BitSet([0,0,2147483680,131072]),FOLLOW_unitPowerExpression_in_unitClump2515:new org.antlr.runtime.BitSet([2,0,0,48]),FOLLOW_CUBED_in_unitClump2517:new org.antlr.runtime.BitSet([2,0,0,32]),FOLLOW_SQUARED_in_unitClump2520:new org.antlr.runtime.BitSet([2,0]),FOLLOW_unitPowerExpression_in_unitClump2543:new org.antlr.runtime.BitSet([2,0,0,48]),FOLLOW_CUBED_in_unitClump2545:new org.antlr.runtime.BitSet([2,0,0,32]),FOLLOW_SQUARED_in_unitClump2548:new org.antlr.runtime.BitSet([2,0]),FOLLOW_unit_in_unitPowerExpression2610:new org.antlr.runtime.BitSet([2,0,8388608,0]),FOLLOW_POW_in_unitPowerExpression2614:new org.antlr.runtime.BitSet([0,0,2147745792,1]),FOLLOW_MINUS_in_unitPowerExpression2617:new org.antlr.runtime.BitSet([0,0,2147483648,1]),FOLLOW_set_in_unitPowerExpression2620:new org.antlr.runtime.BitSet([2,0,8388608,0]),FOLLOW_IDENT_in_unit2638:new org.antlr.runtime.BitSet([2,0,32,0]),FOLLOW_IDENT_in_unit2641:new org.antlr.runtime.BitSet([2,0,32,0]),FOLLOW_113_in_unit2658:new org.antlr.runtime.BitSet([0,0,2147483680,131072]),FOLLOW_unitMultiplicativeExpression_in_unit2660:new org.antlr.runtime.BitSet([0,0,0,262144]),FOLLOW_114_in_unit2662:new org.antlr.runtime.BitSet([2,0]),FOLLOW_PRIMITIVE_in_primitive2731:new org.antlr.runtime.BitSet([2,0]),FOLLOW_STRING_in_string3200:new org.antlr.runtime.BitSet([2,0]),FOLLOW_assignment_in_synpred5_Formula508:new org.antlr.runtime.BitSet([2,0]),FOLLOW_logicalExpression_in_synpred6_Formula514:new org.antlr.runtime.BitSet([2,0]),FOLLOW_forLoop_in_synpred8_Formula526:new org.antlr.runtime.BitSet([2,0]),FOLLOW_forInLoop_in_synpred9_Formula532:new org.antlr.runtime.BitSet([2,0]),FOLLOW_functionDef_in_synpred11_Formula544:new org.antlr.runtime.BitSet([2,0]),FOLLOW_OR_in_synpred47_Formula1217:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_booleanXORExpression_in_synpred47_Formula1220:new org.antlr.runtime.BitSet([2,0]),FOLLOW_XOR_in_synpred48_Formula1253:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_booleanAndExpression_in_synpred48_Formula1256:new org.antlr.runtime.BitSet([2,0]),FOLLOW_AND_in_synpred49_Formula1288:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_equalityExpression_in_synpred49_Formula1291:new org.antlr.runtime.BitSet([2,0]),FOLLOW_set_in_synpred51_Formula1325:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_relationalExpression_in_synpred51_Formula1332:new org.antlr.runtime.BitSet([2,0]),FOLLOW_set_in_synpred55_Formula1378:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_additiveExpression_in_synpred55_Formula1389:new org.antlr.runtime.BitSet([2,0]),FOLLOW_set_in_synpred57_Formula1436:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_multiplicativeExpression_in_synpred57_Formula1443:new org.antlr.runtime.BitSet([2,0]),FOLLOW_set_in_synpred60_Formula1477:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_arrayExpression_in_synpred60_Formula1486:new org.antlr.runtime.BitSet([2,0]),FOLLOW_COLON_in_synpred61_Formula1538:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_negationExpression_in_synpred61_Formula1542:new org.antlr.runtime.BitSet([2,0]),FOLLOW_COLON_in_synpred62_Formula1551:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_negationExpression_in_synpred62_Formula1555:new org.antlr.runtime.BitSet([2,0]),FOLLOW_POW_in_synpred64_Formula1610:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_unaryOrNegate_in_synpred64_Formula1612:new org.antlr.runtime.BitSet([2,0]),FOLLOW_selector_in_synpred68_Formula1744:new org.antlr.runtime.BitSet([2,0]),FOLLOW_funCall_in_synpred68_Formula1746:new org.antlr.runtime.BitSet([2,0]),FOLLOW_material_in_synpred75_Formula1841:new org.antlr.runtime.BitSet([2,0]),FOLLOW_array_in_synpred78_Formula1856:new org.antlr.runtime.BitSet([2,0]),FOLLOW_funCall_in_synpred80_Formula1880:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred85_Formula1946:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred86_Formula1952:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred87_Formula1958:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred88_Formula1963:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred93_Formula1989:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred94_Formula1995:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred95_Formula2000:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred96_Formula2005:new org.antlr.runtime.BitSet([2,0]),FOLLOW_116_in_synpred108_Formula2133:new org.antlr.runtime.BitSet([0,0,1074266144,0]),FOLLOW_arrayName_in_synpred108_Formula2135:new org.antlr.runtime.BitSet([2,0]),FOLLOW_arrayName_in_synpred112_Formula2173:new org.antlr.runtime.BitSet([0,1,4194304,0]),FOLLOW_NEWLINE_in_synpred112_Formula2175:new org.antlr.runtime.BitSet([0,1,4194304,0]),FOLLOW_COLON_in_synpred112_Formula2178:new org.antlr.runtime.BitSet([2,0])})})();org.antlr.runtime.BaseRecognizer.prototype.emitErrorMessage=()=>{};function bootCalc(te){te.varBank=Object.create(null),te.varBank["-parent"]=null,te.varBank.e=new Material(2.718281828459045),te.varBank.pi=new Material(3.141592653589793),te.varBank.phi=new Material(1.61803399),createFunctions(te),createFunctions$1(te)}class PrimitiveStore{constructor(ee,re){this.primitive=ee,this.type=re}}function toNum(te){return te instanceof Material||te instanceof SPrimitive||te instanceof Vector||te instanceof UserFunction||te instanceof SPopulation?te.toNum():te instanceof Function?te([]):te.valueOf()}class UserFunction{constructor(){this.localScope=void 0,this.defaults=void 0,this.fn=void 0}toNum(){return this.fn([])}}let StringObject={},VectorObject={};function createTree(te){let ee=new org.antlr.runtime.ANTLRStringStream(te.replace(/\\n/g,`
`)),re=new FormulaLexer(ee),ne=new org.antlr.runtime.CommonTokenStream(re),ie=new FormulaParser(ne),se=ie.lines();return convertToObject(se.tree,ie)}function trimTree(te,ee,re){return trimNode(te,ee,re)}function evaluateTree(te,ee,re){re.evaluatingLine=void 0;try{return evaluateNode(te,ee,re)}catch(ne){if(ne.returnVal)return ne.data;throw ne}}class TreeNode{constructor(ee,re,ne,ie=[]){this.origText=ee,this.text=ee.toLowerCase(),this.typeName=re,this.line=ne,this.children=ie,this.functionFingerprint=null,this.delayEvalParams=null}cloneStructure(){let ee=new TreeNode(this.origText,this.typeName,this.line);return ee.children=this.children.map(re=>{if(re instanceof TreeNode)return re.cloneStructure();throw console.error(this,re),new TypeError("Unknown structure clone type")}),ee}}function convertToObject(te,ee){let re=te.getToken();if(!re)throw new ModelError("Invalid syntax.",{code:7e3});let ne=new TreeNode(re.getText(),ee.getTokenNames()[re.getType()],re.line);if(te.getChildCount()>0){let ie=te.getChildren();for(let se=0;se<ie.length;se++)ne.children.push(convertToObject(ie[se],ee)),!ne.line&&ne.children[ne.children.length-1].line&&(ne.line=ne.children[ne.children.length-1].line)}return ne}let funcEvalMap=Object.create(null);funcEvalMap.LINES=function(te,ee,re){if(!te.children.length)return new Material(0);let ne;for(let ie of te.children){if(ie.text==="return")throw{returnVal:!0,data:evaluateNode(ie.children[0],ee,re)};ne=evaluateNode(ie,ee,re)}return ne};funcEvalMap.NEGATE=function(te,ee,re){return negate(toNum(evaluateNode(te.children[0],ee,re)))};function negate(te){if(te instanceof Vector)return te.cloneApply(negate);if(te instanceof Material)return new Material(fn["-"](te.value),te.units);throw typeof te=="boolean"?new ModelError("Cannot convert Booleans to Numbers.",{code:7001}):te instanceof String||typeof te=="string"?new ModelError("Cannot convert Strings to Numbers.",{code:7002}):te instanceof SAgent?new ModelError("Cannot convert Agents to Numbers.",{code:7003}):new ModelError("Invalid type - negate",{code:7004})}funcEvalMap.AND=function(te,ee,re){return funAnd(toNum(evaluateNode(te.children[0],ee,re)),toNum(evaluateNode(te.children[1],ee,re)))};function funAnd(te,ee){return te instanceof Vector?te.cloneCombine(ee,funAnd,!1):ee instanceof Vector?ee.cloneCombine(te,funAnd,!0):trueValue(te)&&trueValue(ee)}funcEvalMap.OR=function(te,ee,re){return funOr(toNum(evaluateNode(te.children[0],ee,re)),toNum(evaluateNode(te.children[1],ee,re)))};function funOr(te,ee){return te instanceof Vector?te.cloneCombine(ee,funOr,!1):ee instanceof Vector?ee.cloneCombine(te,funOr,!0):trueValue(te)||trueValue(ee)}funcEvalMap.XOR=function(te,ee,re){return funXor(toNum(evaluateNode(te.children[0],ee,re)),toNum(evaluateNode(te.children[1],ee,re)))};function funXor(te,ee){return te instanceof Vector?te.cloneCombine(ee,funXor,!1):ee instanceof Vector?ee.cloneCombine(te,funXor,!0):(trueValue(te)||trueValue(ee))&&!(trueValue(te)&&trueValue(ee))}funcEvalMap.NOT=function(te,ee,re){return fNot(toNum(evaluateNode(te.children[0],ee,re)))};function fNot(te){return te instanceof Vector?te.cloneApply(fNot):!trueValue(te)}funcEvalMap.NOTEQUALS=function(te,ee,re){return neq(toNum(evaluateNode(te.children[0],ee,re)),toNum(evaluateNode(te.children[1],ee,re)))};function neq(te,ee){if(typeof te=="boolean"&&!(ee instanceof Vector)||typeof ee=="boolean"&&!(te instanceof Vector))return trueValue(te)!==trueValue(ee);if((te instanceof String||typeof te=="string")&&!(ee instanceof Vector)||(ee instanceof String||typeof ee=="string")&&!(te instanceof Vector))return(""+te).toLowerCase()!==(""+ee).toLowerCase();if(te instanceof Vector)return te.cloneCombine(ee,neq,!1);if(ee instanceof Vector)return ee.cloneCombine(te,neq,!0);if(!(te instanceof Material)||!(ee instanceof Material))return te!==ee;if(te.units!==ee.units){let re=convertUnits(ee.units,te.units);if(re===0)return!0;ee.value=fn["*"](ee.value,re),ee.units=te.units}return!fn["="](te.value,ee.value)}funcEvalMap.EQUALS=function(te,ee,re){return eq(toNum(evaluateNode(te.children[0],ee,re)),toNum(evaluateNode(te.children[1],ee,re)))};function eq(te,ee){if(typeof te=="boolean"&&!(ee instanceof Vector)||typeof ee=="boolean"&&!(te instanceof Vector))return trueValue(te)===trueValue(ee);if((typeof te=="string"||te instanceof String)&&!(ee instanceof Vector)||(typeof ee=="string"||ee instanceof String)&&!(te instanceof Vector))return(""+te).toLowerCase()===(""+ee).toLowerCase();if(te instanceof Vector)return te.cloneCombine(ee,eq,!1);if(ee instanceof Vector)return ee.cloneCombine(te,eq,!0);if(!(te instanceof Material)||!(ee instanceof Material))return te===ee;if(te.units!==ee.units){let re=convertUnits(ee.units,te.units);if(re===0)return!1;ee.value=fn["*"](ee.value,re),ee.units=te.units}return fn["="](te.value,ee.value)}function comparisonValid(te,ee){if(te instanceof String||typeof te=="string"||ee instanceof String||typeof ee=="string")throw new ModelError("Cannot use Strings in logical inequality comparisons.",{code:7005});if(te instanceof Boolean||typeof te=="boolean"||ee instanceof Boolean||typeof ee=="boolean")throw new ModelError("Cannot use Booleans in logical inequality comparisons.",{code:7006});if(te instanceof SAgent||ee instanceof SAgent)throw new ModelError("Cannot use Agents in logical inequality comparisons.",{code:7007})}funcEvalMap.LT=function(te,ee,re){return lessThan(toNum(evaluateNode(te.children[0],ee,re)),toNum(evaluateNode(te.children[1],ee,re)))};function lessThan(te,ee){if(comparisonValid(te,ee),te instanceof Vector)return te.cloneCombine(ee,lessThan,!1);if(ee instanceof Vector)return ee.cloneCombine(te,lessThan,!0);if(te instanceof Material&&ee instanceof Material){if(te.units!==ee.units){let re=convertUnits(ee.units,te.units);re===0?unitAlert(te.units,ee.units,"comparison"):(ee.value=fn["*"](ee.value,re),ee.units=te.units)}return fn["<"](te.value,ee.value)}throw new ModelError("Invalid type - lessThan",{code:7008})}funcEvalMap.LTEQ=function(te,ee,re){return lessThanEq(toNum(evaluateNode(te.children[0],ee,re)),toNum(evaluateNode(te.children[1],ee,re)))};function lessThanEq(te,ee){if(comparisonValid(te,ee),te instanceof Vector)return te.cloneCombine(ee,lessThanEq,!1);if(ee instanceof Vector)return ee.cloneCombine(te,lessThanEq,!0);if(te instanceof Material&&ee instanceof Material){if(te.units!==ee.units){let re=convertUnits(ee.units,te.units);re===0?unitAlert(te.units,ee.units,"comparison"):(ee.value=fn["*"](ee.value,re),ee.units=te.units)}return fn["<="](te.value,ee.value)}throw new ModelError("Invalid type - lessThanEq",{code:7009})}funcEvalMap.GT=function(te,ee,re){return greaterThan(toNum(evaluateNode(te.children[0],ee,re)),toNum(evaluateNode(te.children[1],ee,re)))};function greaterThan(te,ee){if(comparisonValid(te,ee),te instanceof Vector)return te.cloneCombine(ee,greaterThan,!1);if(ee instanceof Vector)return ee.cloneCombine(te,greaterThan,!0);if(te instanceof Material&&ee instanceof Material){if(te.units!==ee.units){let re=convertUnits(ee.units,te.units);re===0?unitAlert(te.units,ee.units,"comparison"):(ee.value=fn["*"](ee.value,re),ee.units=te.units)}return fn[">"](te.value,ee.value)}throw new ModelError("Invalid type - greaterThan",{code:7010})}funcEvalMap.GTEQ=function(te,ee,re){return greaterThanEq(toNum(evaluateNode(te.children[0],ee,re)),toNum(evaluateNode(te.children[1],ee,re)))};function greaterThanEq(te,ee){if(comparisonValid(te,ee),te instanceof Vector)return te.cloneCombine(ee,greaterThanEq,!1);if(ee instanceof Vector)return ee.cloneCombine(te,greaterThanEq,!0);if(te instanceof Material&&ee instanceof Material){if(te.units!==ee.units){let re=convertUnits(ee.units,te.units);re===0?unitAlert(te.units,ee.units,"comparison"):(ee.value=fn["*"](ee.value,re),ee.units=te.units)}return fn[">="](te.value,ee.value)}throw new ModelError("Invalid type - greaterThanEq",{code:7011})}funcEvalMap.PLUS=function(te,ee,re){return plus(toNum(evaluateNode(te.children[0],ee,re)),toNum(evaluateNode(te.children[1],ee,re)))};function plus(te,ee){if(te instanceof Vector)return te.cloneCombine(ee,plus,!1);if(ee instanceof Vector)return ee.cloneCombine(te,plus,!0);if(te instanceof Material&&ee instanceof Material){if(te.units!==ee.units){let re=convertUnits(ee.units,te.units);re===0?unitAlert(te.units,ee.units,"addition"):(ee.value=fn["*"](ee.value,re),ee.units=te.units)}return new Material(fn["+"](te.value,ee.value),ee.units)}if(typeof te=="boolean"||typeof ee=="boolean")throw new ModelError("Cannot convert Booleans to Numbers.",{code:7012});if(te instanceof SAgent||ee instanceof SAgent)throw new ModelError("Cannot convert Agents to Numbers.",{code:7013});if(typeof te=="string"||te instanceof String||typeof ee=="string"||ee instanceof String)return te.toString()+ee.toString();throw new ModelError("Invalid type - plus",{code:7014})}funcEvalMap.MINUS=function(te,ee,re){return minus(toNum(evaluateNode(te.children[0],ee,re)),toNum(evaluateNode(te.children[1],ee,re)))};function minus(te,ee){if(te instanceof Vector)return te.cloneCombine(ee,minus,!1);if(ee instanceof Vector)return ee.cloneCombine(te,minus,!0);if(te instanceof Material&&ee instanceof Material){if(te.units!==ee.units){let re=convertUnits(ee.units,te.units);re===0?unitAlert(te.units,ee.units,"subtraction"):(ee.value=fn["*"](ee.value,re),ee.units=te.units)}return new Material(fn["-"](te.value,ee.value),ee.units)}throw typeof te=="boolean"||typeof ee=="boolean"?new ModelError("Cannot convert Booleans to Numbers.",{code:7015}):te instanceof SAgent||ee instanceof SAgent?new ModelError("Cannot convert Agents to Numbers.",{code:7016}):typeof te=="string"||te instanceof String||typeof ee=="string"||ee instanceof String?new ModelError("Cannot convert Strings to Numbers.",{code:7017}):new ModelError("Invalid type - minus",{code:7018})}funcEvalMap.MULT=function(te,ee,re){return mult(toNum(evaluateNode(te.children[0],ee,re)),toNum(evaluateNode(te.children[1],ee,re)))};function mult(te,ee){if(te instanceof Vector)return te.cloneCombine(ee,mult,!1);if(ee instanceof Vector)return ee.cloneCombine(te,mult,!0);if(te instanceof Material&&ee instanceof Material){let re=fn["*"](te.value,ee.value);return te.units&&ee.units?(te.units.addBase(),ee.units.addBase(),new Material(fn["*"](fn["*"](te.units.toBase,re),ee.units.toBase),te.units.multiply(ee.units,1))):te.units?new Material(re,te.units):ee.units?new Material(re,ee.units):new Material(re)}throw typeof te=="boolean"||typeof ee=="boolean"?new ModelError("Cannot convert Booleans to Numbers.",{code:7019}):te instanceof SAgent||ee instanceof SAgent?new ModelError("Cannot convert Agents to Numbers.",{code:7020}):typeof te=="string"||te instanceof String||typeof ee=="string"||ee instanceof String?new ModelError("Cannot convert Strings to Numbers.",{code:7021}):new ModelError("Invalid type - mult",{code:7022})}funcEvalMap.DIV=function(te,ee,re){return div(toNum(evaluateNode(te.children[0],ee,re)),toNum(evaluateNode(te.children[1],ee,re)))};function div(te,ee){if(te instanceof Vector)return te.cloneCombine(ee,div,!1);if(ee instanceof Vector)return ee.cloneCombine(te,div,!0);if(te instanceof Material&&ee instanceof Material){let re=fn["/"](te.value,ee.value);return te.units&&ee.units?(te.units.addBase(),ee.units.addBase(),new Material(fn["/"](fn["*"](te.units.toBase,re),ee.units.toBase),te.units.multiply(ee.units,-1))):te.units?new Material(re,te.units):ee.units?new Material(re,ee.units.power(-1)):new Material(re)}throw typeof te=="boolean"||typeof ee=="boolean"?new ModelError("Cannot convert Booleans to Numbers.",{code:7023}):te instanceof SAgent||ee instanceof SAgent?new ModelError("Cannot convert Agents to Numbers.",{code:7024}):typeof te=="string"||te instanceof String||typeof ee=="string"||ee instanceof String?new ModelError("Cannot convert Strings to Numbers.",{code:7025}):new ModelError("Invalid type - div",{code:7026})}funcEvalMap.POWER=function(te,ee,re){if(te.children.length===1)return evaluateNode(te.children[0],ee,re);let ne=toNum(evaluateNode(te.children[te.children.length-1],ee,re));for(let ie=te.children.length-1;ie>0;ie--){let se=toNum(evaluateNode(te.children[ie-1],ee,re));if(ne instanceof Vector||!ne.units)ne=power(se,ne);else throw new ModelError("Exponents may not have units.",{code:7027})}return ne};function power(te,ee){if(te instanceof Vector)return te.cloneCombine(ee,power,!1);if(ee instanceof Vector)return ee.cloneCombine(te,power,!0);if(te instanceof Material&&ee instanceof Material){let re=te.value,ne=ee.value;if(re<0&&ne!==Math.round(ne))throw new ModelError(`Cannot take a negative number (${re}) to a fractional power (${ne}).`,{code:7028});return new Material(fn.expt(re,ne),te.units?te.units.power(ne):void 0)}throw typeof te=="boolean"||typeof ee=="boolean"?new ModelError("Cannot convert Booleans to Numbers.",{code:7029}):te instanceof SAgent||ee instanceof SAgent?new ModelError("Cannot convert Agents to Numbers.",{code:7030}):typeof te=="string"||te instanceof String||typeof ee=="string"||ee instanceof String?new ModelError("Cannot convert Strings to Numbers.",{code:7031}):new ModelError("Invalid type - power",{code:7032})}funcEvalMap.MOD=function(te,ee,re){return doMod(toNum(evaluateNode(te.children[0],ee,re)),toNum(evaluateNode(te.children[1],ee,re)))};function doMod(te,ee){if(te instanceof Vector)return te.cloneCombine(ee,doMod,!1);if(ee instanceof Vector)return ee.cloneCombine(te,doMod,!0);if(te instanceof Material&&ee instanceof Material){if(ee.units)throw new ModelError('The right hand side of "mod" may not have units.',{code:7033});return new Material(fn.mod(te.value,ee.value),te.units)}throw typeof te=="boolean"||typeof ee=="boolean"?new ModelError("Cannot convert Booleans to Numbers.",{code:7034}):te instanceof SAgent||ee instanceof SAgent?new ModelError("Cannot convert Agents to Numbers.",{code:7035}):typeof te=="string"||te instanceof String||typeof ee=="string"||ee instanceof String?new ModelError("Cannot convert Strings to Numbers.",{code:7036}):new ModelError("Invalid type - mod",{code:7037})}funcEvalMap.IDENT=function(te,ee,re){let ne=te.text;for(;!(ne in ee);)if(ee["-parent"])ee=ee["-parent"];else throw new ModelError(`The variable or function "${te.origText}" does not exist.`,{code:7038});let ie=ee[ne];return ie instanceof TreeNode&&ie.typeName==="ARRAY"&&(ie=evaluateNode(ie,ee,re)),ie.fullClone&&!(ie instanceof Vector)?ie.fullClone():ie};funcEvalMap.NEW=function(te,ee,re){let ne=evaluateNode(te.children[0],ee,re);if(ne instanceof Vector){let ie=new Vector([],re,void 0,ne),se,le;try{le=selectFromVector(ne,re,"constructor"),se=le.data}catch{}if(se)te.children.length===2?callFunction(se,te.children[1],re,ee,ie,le.parent):callFunction(se,{children:[]},re,ee,ie,le.parent);else if(te.children.length===2&&te.children[1].children.length>0)throw new ModelError(`No constructor available for '${te.children[0].text}'.`,{code:7039});return ie}else throw new ModelError("'New' can only be use to create instances of Vectors.",{code:7040})};funcEvalMap.INNER=function(te,ee,re){let ne=evaluateNode(te.children[0],ee,re);if(te.children.length===2&&te.children[1].typeName==="FUNCALL")return callFunction(ne,te.children[1],re,ee);let ie,se;ee.self&&te.children[0].text==="parent"?ie=ee.self:ne instanceof Function||ne instanceof UserFunction||(ie=ne);for(let le=1;le<te.children.length;le++)if(te.children[le].typeName==="SELECTOR")if(te.children[le].children[0].typeName==="DOTSELECTOR")for(let ue=0;ue<te.children[le].children[0].children.length;ue++){let ae=[];te.children[le].children[0].children[ue].text?ae.push(te.children[le].children[0].children[ue].text):ae.push(te.children[le].children[0].children[ue].valueOf());try{ne=selectFromMatrix(ne,re,ae)}catch(oe){if(ne instanceof SPrimitive&&!(ne instanceof SAgent))ne=toNum(ne),ue--;else throw oe}ne instanceof Function||ne instanceof UserFunction||(ie=ne,se=ne)}else{ne instanceof SPrimitive&&(ne=toNum(ne),ne instanceof Function||ne instanceof UserFunction||(ie=ne,se=ne));try{ne=selectFromMatrix(ne,re,createMatrixSelector(te.children[le],ee,0,re))}catch(ue){if(ne instanceof SPrimitive)ne=toNum(ne),le--;else throw ue}ne instanceof Function||ne instanceof UserFunction||(ie=ne,se=ne)}else ne=callFunction(ne,te.children[le],re,ee,ie,se),ne instanceof Function||ne instanceof UserFunction||(ie=ne,se=ne);return ne};let fingerprintCounter=0;function callFunction(te,ee,re,ne,ie,se){if(typeof te!="function"&&!(te instanceof UserFunction))throw new ModelError("Trying to call a non-function.",{code:7041});let le=[],ue="";if(ee instanceof Array)le=ee;else if(ee.functionFingerprint||(ee.functionFingerprint="FINGERPRINT-"+fingerprintCounter++),ue=ee.functionFingerprint,te.delayEvalParams)for(let ce=0;ce<ee.children.length;ce++)le.push({node:ee.children[ce],scope:ne});else for(let ce=0;ce<ee.children.length;ce++){let pe=evaluateNode(ee.children[ce],ne,re);pe.fullClone&&!(pe instanceof Vector)&&(pe=pe.fullClone()),le.push(pe)}let ae;te.fn?ae=te.fn:(ee.delayEvalParams=te.delayEvalParams,ae=te);let oe=re.evaluatingLine,he=ae(le,ue,ie,se);return re.evaluatingLine=oe,he}function createMatrixSelector(te,ee,re,ne){let ie=[];re=re||0;for(let se=re;se<te.children.length;se++)if(te.children[se].typeName==="MULT")ie.push("*");else{let ue=evaluateNode(te.children[se],ee,ne);if(typeof ue=="function"||ue instanceof UserFunction){let ae;typeof ue=="function"?ae=ue:ae=ue.fn,function(oe){ie.push(he=>{if(!he[0].stackApply)throw new ModelError("Can't apply function across elements of non-vector.",{code:7042});return he[0].stackApply(ce=>oe([ce]))})}(ae)}else ie.push(toNum(ue))}return ie}funcEvalMap.ARRAY=function(te,ee,re){if(te.children.length===1&&te.children[0]instanceof Vector)return te.children[0].fullClone();let ne=[],ie=[],se=!1;for(let le=0;le<te.children.length;le++)ne.push(evaluateNode(te.children[le].children[0],ee,re)),te.children[le].children.length>1?(te.children[le].children[1].text?ie.push(te.children[le].children[1].origText):ie.push(te.children[le].children[1].valueOf()),se=!0):ie.push(void 0);return new Vector(ne,re,se?ie:void 0)};funcEvalMap.RANGE=function(te,ee,re){if(te.children.length===1)return evaluateNode(te.children[0],ee,re);let ne=[],ie=toNum(evaluateNode(te.children[0],ee,re)),se=toNum(evaluateNode(te.children[te.children.length-1],ee,re));if(!(ie instanceof Material)||!(se instanceof Material))throw new ModelError("Range elements must be numbers.",{code:7043});if(ne.push(ie.fullClone()),ie.units!==se.units&&convertUnits(ie.units,se.units)!==1)throw new ModelError("Units on both sides of ':' must be equal.",{code:7044});let le=te.children.length===2?new Material(1,ie.units):toNum(evaluateNode(te.children[1],ee,re));if(!(le instanceof Material))throw new ModelError("Range elements must be numbers.",{code:7045});if(!eq(ie,se)){if(lessThan(ie,se)){let ue=plus(ie,le);for(;lessThanEq(ue,se);)ne.push(ue),ue=plus(ue,le)}else if(greaterThan(ie,se)){te.children.length===2&&(le=negate(le));let ue=plus(ie,le);for(;greaterThanEq(ue,se);)ne.push(ue),ue=plus(ue,le)}}return new Vector(ne,re)};function makeFunctionCall(te,ee,re,ne,ie,se){let le=new UserFunction;le.localScope={},le.localScope.nVars=ee.length;for(let ue=0;ue<ee.length;ue++)le.localScope[ue+""]=ee[ue];return le.localScope["-parent"]=ie,le.defaults=re,le.fn=function(ue,ae,oe,he){let ce=ue.length;for(let de=0;de<ue.length;de++)ue[de].optional&&ce--;if(le.localScope.nVars-le.defaults.length>ue.length||ce>le.localScope.nVars){let de=[];for(let me=0;me<le.localScope.nVars;me++)le.defaults.length-(le.localScope.nVars-me)>-1?de.push(le.localScope[me+""]+"="+le.defaults[le.defaults.length-(le.localScope.nVars-me)]):de.push(le.localScope[me+""]);throw new ModelError("Wrong number of parameters for "+te+"("+de.join(", ")+").",{code:7049})}let pe={"-parent":ie};for(let de=0;de<ue.length;de++)pe[le.localScope[de+""]]=ue[de];for(let de=ue.length;de<le.localScope.nVars;de++)pe[le.localScope[de+""]]=le.defaults[le.defaults.length-(le.localScope.nVars-de)];oe&&(pe.self||(pe.self=oe)),he&&he.parent&&(pe.parent=he.parent);try{return evaluateNode(ne,pe,se)}catch(de){if(de.returnVal)return de.data;throw de}},le}funcEvalMap.THROW=function(te,ee,re){throw new ModelError(evaluateNode(te.children[0],ee,re),{code:1e4})};funcEvalMap.TRYCATCH=function(te,ee,re){try{return evaluateNode(te.children[0],ee,re)}catch(ne){let ie={"-parent":ee};return ne instanceof ModelError?ie[te.children[2].text]=stringify$1(ne.message,re):ie[te.children[2].text]=stringify$1("An error has occurred.",re),evaluateNode(te.children[1],ie,re)}};funcEvalMap.WHILE=function(te,ee,re){let ne=new Material(0),ie={"-parent":ee};for(;trueValue(toNum(evaluateNode(te.children[0],ee,re)));)ne=evaluateNode(te.children[1],ie,re);return ne};funcEvalMap.IFTHENELSE=function(te,ee,re){let ne={"-parent":ee},ie;for(ie=0;ie<te.children[0].children.length;ie++)if(trueValue(toNum(evaluateNode(te.children[0].children[ie],ee,re))))return evaluateNode(te.children[1].children[ie],ne,re);return te.children[0].children.length!==te.children[1].children.length?evaluateNode(te.children[1].children[ie],ne,re):new Material(0)};funcEvalMap.FORIN=function(te,ee,re){let ne=new Material(0),ie=te.children[0].text,se={"-parent":ee},le=evaluateNode(te.children[1],ee,re);if(!(le instanceof Vector))throw new ModelError("The in argument of a For-In loop must be a vector.",{code:7050});for(let ue=0;ue<le.items.length;ue++)se[ie]=le.items[ue],ne=evaluateNode(te.children[2],se,re);return ne};funcEvalMap.FOR=function(te,ee,re){let ne=new Material(0),ie=te.children[0].text,se=toNum(evaluateNode(te.children[1].children[0],ee,re)),le=new Material(1);te.children[1].children.length===3&&(le=toNum(evaluateNode(te.children[1].children[2],ee,re)));let ue={"-parent":ee};for(ue[ie]=se;fn[le.value>=0?"<=":">="](ue[ie].value,toNum(evaluateNode(te.children[1].children[1],ee,re)));)ne=evaluateNode(te.children[2],ue,re),ue[ie]=plus(ue[ie],le);return ne};funcEvalMap.FUNCTION=function(te,ee,re){let ne=te.children[0].children[0].text;return functionGenerator(ne,te.children[0],te.children[1],te.children[2],ee,re),`"${ne}" defined`};funcEvalMap.ANONFUNCTION=function(te,ee,re){return functionGenerator(null,te.children[0],te.children[1],te.children[2],ee,re)};funcEvalMap.ASSIGN=function(te,ee,re){let ne=te.children.length-1,ie=evaluateNode(te.children[te.children.length-1],ee,re);if(ne>1&&(!(ie instanceof Vector)||ie.items.length<ne))throw new ModelError("Too few elements returned for assignment.",{code:7051});for(let se=0;se<ne;se++)if(te.children[se]instanceof PrimitiveStore)ne===1?te.children[se].primitive.setValue(ie):te.children[se].primitive.setValue(ie.items[se]);else{let le=te.children[se].children[0].text,ue;te.children[se].children.length>1&&(ue=createSelector(te.children[se].children[1],ee,re));let ae=ee;for(;ee["-parent"]!==null&&ee[le]===void 0;)ee=ee["-parent"];ee["-parent"]===null&&ee[le]===void 0&&(ee=ae);let oe;if(ne===1?oe=ie:oe=ie.items[se],te.children[se].children.length===1)ee[le]=oe;else if(ee[le]!==void 0)selectFromMatrix(ee[le],re,ue,oe);else throw new ModelError(`The variable '${te.children[se].children[0].origText}' does not exist.`,{code:7052})}return ne>1?new Vector(ie.items.slice(0,ne),re):ie};function createSelector(te,ee,re){if(te.children[0].typeName==="DOTSELECTOR"){let ne=[];for(let ie=0;ie<te.children[0].children.length;ie++)te.children[0].children[ie].text?ne.push(te.children[0].children[ie].text):ne.push(te.children[0].children[ie].valueOf());return ne}else return createMatrixSelector(te,ee,0,re)}funcEvalMap.MATERIAL=function(te,ee,re){let ne=toNum(evaluateNode(te.children[0],ee,re));if(ne.units)throw new ModelError("Cannot create material where numeric part itself has units.",{code:7053});return new Material(ne.value,te.children[1])};function functionGenerator(te,ee,re,ne,ie,se){let le=[],ue=[];for(let ae=te===null?0:1;ae<ee.children.length;ae++)le.push(ee.children[ae].text);for(let ae=0;ae<re.children.length;ae++)ue.push(re.children[ae]);if(te===null)return makeFunctionCall("Function",le,ue,ne,ie,se);ie[te]=makeFunctionCall(te,le,ue,ne,ie,se)}let unitEvalMap=Object.create(null);unitEvalMap.MULT=function(te){return evaluateUnits(te.children[0]).concat(evaluateUnits(te.children[1]))};unitEvalMap.POW=function(te){let ee=1,re=1,ne=0;te.children.length===3+ne&&(ee=ee*-1,re++);let ie=evaluateUnits(te.children[ne]),se=evaluateUnits(te.children[re])*ee;if(ie instanceof Array){for(let le=0;le<ie.length;le++)ie[le].exponent=ie[le].exponent*se;return ie}else return Math.pow(ie,se)};unitEvalMap.DIV=function(te){let ee=evaluateUnits(te.children[0]),re=evaluateUnits(te.children[1]);for(let ne=0;ne<re.length;ne++)re[ne].exponent=re[ne].exponent*-1;return ee.concat(re)};unitEvalMap.PER=unitEvalMap.DIV;unitEvalMap.UNIT=function(te){let ee="";for(let re=0;re<te.children.length;re++)ee=ee+te.children[re].text,re<te.children.length-1&&(ee=ee+" ");return[{id:ee,exponent:1}]};unitEvalMap.UNITCLUMP=function(te){let ee=evaluateUnits(te.children[0]);if(te.children.length>1){for(let re=1;re<te.children.length;re++)if(te.children[re].typeName==="NEGATE")for(let ne=0;ne<ee.length;ne++)ee[ne].exponent=ee[ne].exponent*-1;else if(te.children[re].typeName==="SQUARED")for(let ne=0;ne<ee.length;ne++)ee[ne].exponent=ee[ne].exponent*2;else if(te.children[re].typeName==="CUBED")for(let ne=0;ne<ee.length;ne++)ee[ne].exponent=ee[ne].exponent*3}return ee};unitEvalMap.INTEGER=function(te){return parseInt(te.text,10)};unitEvalMap.FLOAT=function(te){return parseFloat(te.text)};function evaluateUnits(te){return te instanceof Material?te.value:unitEvalMap[te.typeName](te)}function evaluateNode(te,ee,re){if(te instanceof TreeNode)return re.evaluatingLine=te.line||re.evaluatingLine,funcEvalMap[te.typeName](te,ee,re);if(te instanceof PrimitiveStore){if(te.type==="totalValue"){if(!te.primitive.totalContents)throw new ModelError("You can only use the double-bracket notation for total conveyor contents on Stock primitives.",{code:7054});return te.primitive.totalContents()}else if(te.type==="object")return te.primitive}else return te}let trimEvalMap=Object.create(null);trimEvalMap.POWER=function(te,ee,re){if(te.children.length===1)return trimNode(te.children[0],ee,re);{let ne=new TreeNode(te.origText,te.typeName,te.line);for(let ie=0;ie<te.children.length;ie++)ne.children.push(trimNode(te.children[ie],ee,re));return ne}};trimEvalMap.INNER=function(te,ee,re){if(te.children.length===1)return trimNode(te.children[0],ee,re);{let ne=new TreeNode(te.origText,te.typeName,te.line);for(let ie=0;ie<te.children.length;ie++)ne.children.push(trimNode(te.children[ie],ee,re));return ne}};trimEvalMap.RANGE=trimEvalMap.POWER;trimEvalMap.TRUE=function(){return!0};trimEvalMap.FALSE=function(){return!1};trimEvalMap.STRING=function(te,ee,re){let ne=te.origText.substr(1,te.origText.length-2),ie;return te.origText[0]==='"'?ie=ne.replace(/\\\\/g,"\\\\TEMPTXT\\\\").replace(/\\"/g,'"').replace(/\\'/g,"'").replace(/\\t/g,"	").replace(/\\b/g,"\b").replace(/\\f/g,"\f").replace(/\\n/g,`
`).replace(/\\r/g,"\r").replace(/\\\\TEMPTXT\\\\/g,"\\"):ie=ne.replace(/\n/,"\\n"),ie=new String(ie),ie.vector=new Vector([],re,[],re.varBank.stringbase),ie};trimEvalMap.INTEGER=function(te){return new Material(+te.text)};trimEvalMap.MATERIAL=function(te,ee,re){let ne=trimNode(te.children[1],ee,re),ie=evaluateUnits(te.children[0]),se=[],le=[];for(let ue=0;ue<ie.length;ue++){let ae=le.indexOf(ie[ue].id);ae===-1?(se.push(ie[ue].exponent),le.push(ie[ue].id)):se[ae]=se[ae]+ie[ue].exponent}if(ne instanceof Material){if(ne.units)throw new ModelError("Cannot create material where numeric part itself has units.",{code:7055});return new Material(ne.value,re.unitManager.getUnitStore(le,se,!0))}else{let ue=new TreeNode(te.origText,"MATERIAL",te.line);return ue.children=[ne,re.unitManager.getUnitStore(le,se,!0)],ue}};trimEvalMap.MULT=function(te,ee,re){if(!te.children.length)return"*";let ne=trimNode(te.children[0],ee,re),ie=trimNode(te.children[1],ee,re);if(isConst(ne)&&isConst(ie))return mult(ne,ie);{let se=new TreeNode(te.origText,te.typeName,te.line);return se.children=[ne,ie],se}};trimEvalMap.DIV=function(te,ee,re){let ne=trimNode(te.children[0],ee,re),ie=trimNode(te.children[1],ee,re);if(isConst(ne)&&isConst(ie))return div(ne,ie);{let se=new TreeNode(te.origText,te.typeName,te.line);return se.children=[ne,ie],se}};trimEvalMap.PLUS=function(te,ee,re){let ne=trimNode(te.children[0],ee,re),ie=trimNode(te.children[1],ee,re);if(isConst(ne)&&isConst(ie))return plus(ne,ie);{let se=new TreeNode(te.origText,te.typeName,te.line);return se.children=[ne,ie],se}};trimEvalMap.MINUS=function(te,ee,re){let ne=trimNode(te.children[0],ee,re),ie=trimNode(te.children[1],ee,re);if(isConst(ne)&&isConst(ie))return minus(ne,ie);{let se=new TreeNode(te.origText,te.typeName,te.line);return se.children=[ne,ie],se}};trimEvalMap.FLOAT=trimEvalMap.INTEGER;trimEvalMap.PRIMITIVE=function(te,ee){let re;if(te.text.substr(0,2)==="[["?re=new PrimitiveStore(ee[te.text.substr(2,te.text.length-4)],"totalValue"):re=new PrimitiveStore(ee[te.text.substr(1,te.text.length-2)],"object"),re.primitive===void 0)throw new ModelError(`The primitive <i>${toHTML(te.origText)}</i> could not be found.`,{code:7056});return re};trimEvalMap.NEGATE=function(te,ee,re){if(!te.children.length)return new TreeNode(te.origText,te.typeName,te.line);let ne=trimNode(te.children[0],ee,re);if(isConst(ne))return negate(ne);{let ie=new TreeNode(te.origText,te.typeName,te.line);return ie.children=[ne],ie}};trimEvalMap.ARRAY=function(te,ee,re){let ne=new TreeNode(te.origText,te.typeName,te.line),ie=[],se=[],le=!1;for(let ae=0;ae<te.children.length;ae++)ne.children.push(trimNode(te.children[ae],ee,re)),ie.push(ne.children[ae].children[0]),ne.children[ae].children.length>1?(ne.children[ae].children[1].text?se.push(ne.children[ae].children[1].origText):se.push(ne.children[ae].children[1].valueOf()),le=!0):se.push(void 0);let ue=!0;for(let ae=0;ae<ie.length;ae++)if(!isConst(ie[ae])){ue=!1;break}return ue&&(ne.children=[new Vector(ie,re,le?se:void 0)]),ne};function isConst(te){return te instanceof Material||typeof te=="string"||te instanceof String||typeof te=="boolean"||te instanceof Vector}function trimNode(te,ee,re){if(te.typeName in trimEvalMap)return re.evaluatingLine=te.line||re.evaluatingLine,trimEvalMap[te.typeName](te,ee,re);{let ne=new TreeNode(te.origText,te.typeName,te.line);for(let ie=0;ie<te.children.length;ie++)ne.children.push(trimNode(te.children[ie],ee,re));return ne}}function trueValue(te){if(typeof te=="boolean")return te;if(te instanceof Material)return neq(te.value,0);throw te instanceof Vector?new ModelError("Cannot convert a Vector to a boolean.",{code:7057}):typeof te=="string"||te instanceof String?new ModelError("Cannot convert a String to a boolean.",{code:7058}):new ModelError("Only numbers can be used in place of booleans.",{code:7059})}class Simulator{constructor(){this.resultsWindow=void 0,this.setResultsCallback=void 0,this.setStatusCallback=void 0,this.finished=void 0,this.status=void 0,this.valueChange=void 0,this.transitionPrimitives=void 0,this.timer=void 0,this.displayInformation=void 0,this.randLoc=-1,this.model=null,this.lastRandPos=-1,this.previousRandLists=[],this.valuedPrimitives=[],this.unitsToBases={},this.distanceCache={},this.distanceCacheCount=0,this.sliders={},this.ids={},this.idCount=0,this.stochastic=!1,this.allPlaceholders={},this.RKOrder=void 0,this.config=null,this.results=void 0,this.evaluatingLine=null,this.varBank=Object.create(null),this.unitManager=new UnitManager,this.random=null,this.clusters=null,this.timeUnitsString=null}setup(ee){this.simulationModel=ee,this.solversCompletedFirstPass=0,this.timeStart=this.simulationModel.timeStart,this.timeLength=this.simulationModel.timeLength,this.timePause=this.simulationModel.timePause,this.timeEnd=new Material(Big(this.timeStart.value).plus(this.timeLength.value).toNumber(),this.timeLength.units),this.timeStep=this.simulationModel.solvers.base.timeStep,this.userTimeStep=this.simulationModel.solvers.base.userTimeStep,this.timeStepCount=Math.floor(this.timeLength.value/this.userTimeStep.value),this.timeUnits=this.timeStart.units,this.timeUnits.addBase(),this.oldAggregateSeries=[],this.distanceCache={},this.tasks=new TaskQueue({start:this.timeStart,end:this.timeEnd})}getID(ee){return this.ids[ee]||(this.idCount++,this.ids[ee]=this.idCount),this.ids[ee]}time(){return this.tasks.time.fullClone()}timeProgressed(){return minus(this.time(),this.timeStart)}frame(ee,re){let ne=ee.length;for(let ie=0;ie<ne;ie++)ee[ie].storeValue();this.printStates(re)}step(ee){if(ee.completedFirstPass||(ee.completedFirstPass=!0,this.solversCompletedFirstPass++,this.solversCompletedFirstPass===Object.keys(this.simulationModel.solvers).length&&this.config.onCompletedFirstPass&&this.config.onCompletedFirstPass()),ee.displayed.length>0)for(let re=this.results.children[ee.displayed[0].id].results.length;re<this.results.times.length;re++)for(let ne of ee.displayed)this.results.children[ne.id].results.push(this.results.data[re][ne.id]);this.config.onStep&&this.config.onStep(ee)}sleep(ee){this.config&&(this.config.silent?this.config.onPause&&(this.shouldSleep=!0):(this.shouldSleep=!0,this.shouldUpdateValues=ee))}resume(){try{this.run()}catch(ee){return checkErr(ee,this.config,this)}}completed(){return this.terminated||this.tasks.completed()}terminate(){this.setStatus("TERMINATED"),this.terminated||(clearTimeout(this.timer),this.sleep(),this.terminated=!0)}setStatus(ee){this.status=ee,this.setStatusCallback&&this.setStatusCallback(ee)}run(ee){this.setStatus("RUNNING");let re=this,ne=(ie,se)=>{this.tasks.add(new Task({time:ie,expires:1,name:"Interval Pause",priority:1,action:le=>{this.sleep(!0),se&&lessThan(plus(ie,this.timePause),this.timeEnd)&&ne(plus(ie,this.timePause),se)}})),this.tasks.add(new Task({time:ie,expires:1,name:"Interval Pause",priority:1,action:le=>{if(this.valueChange){re.valuedPrimitives=[];for(let ue in this.simulationModel.solvers){let ae=this.simulationModel.solvers[ue];for(let oe=0;oe<ae.valued.length;oe++)ae.valued[oe].clearCached();for(let oe=0;oe<ae.flows.length;oe++)ae.flows[oe].predict(!0)}this.valueChange=!1}}}))};if(ee){for(let ie in this.simulationModel.solvers)this.createSolver(this.simulationModel.solvers[ie]);this.timePause&&ne(plus(this.timeStart,this.timePause),!0),this.tasks.cursor=this.tasks.tasks.minNode()}this.wakeUpTime=Date.now();try{for(;!this.completed();)if(this.tasks.step(),this.shouldSleep){for(let ie in this.simulationModel.solvers)updateDisplayed(this.simulationModel.solvers[ie],this);this.setResultsCallback&&this.setResultsCallback(formatSimResults(this.results)),this.shouldUpdateValues&&(this.setStatus("PAUSED"),this.shouldUpdateValues=!1),this.config.onPause&&setTimeout(()=>{let ie=formatSimResults(this.results),se=ie.data.length,le=ie.data[se-1];for(let ue in le)if(ue!=="time"){if(!ie.children[ue])return;ie.children[ue].results.length<se&&ie.children[ue].results.push(le[ue])}ie.resume=this.resume.bind(this),ie.setValue=(ue,ae)=>{let oe=simpleEquation(""+ae,this,{"-parent":this.varBank});this.valuedPrimitives.forEach(he=>{he.id===ue.id&&(oe.fullClone?(he.dna.equation=oe.fullClone(),he.equation=oe.fullClone()):(he.dna.equation=oe,he.equation=oe))}),this.valueChange=!0},this.config.onPause(ie)},10),this.shouldSleep=!1;return}}catch(ie){if(ie.simulationCommand!=="STOP")throw ie}if(this.results=formatSimResults(this.results),this.results.stochastic=this.stochastic,this.config.onSuccess&&this.config.onSuccess(this.results),this.terminate(),this.resultsWindow){this.results.window=this.resultsWindow;for(let ie in this.simulationModel.solvers)updateDisplayed(this.simulationModel.solvers[ie],this)}return this.results}progress(){return div(minus(this.time(),this.timeStart),this.timeLength).value}printStates(ee){let re=parseFloat(this.time().value.toPrecision(20));if(!this.results.times.includes(re)){let ie;for(ie=this.results.times.length;ie>0;ie--)if(this.results.times[ie-1]<re){this.results.times.splice(ie,0,re),this.results.data.splice(ie,0,{});break}ie===0&&(this.results.times.splice(0,0,re),this.results.data.splice(0,0,{}))}let ne=this.results.data[this.results.times.indexOf(re)];for(let ie=0;ie<ee.length;ie++){let se=ee[ie];if(!(se instanceof SState&&ne[se.id]!==void 0))if(se instanceof SPopulation)this.results.children[se.id].dataMode="agents",ne[se.id]={current:se.collectData()};else{let le=se.value();le instanceof Vector&&!le.names?(le.recurseApply(ue=>this.adjustNum(se,ue)),ne[se.id]=cleanData(le),this.results.children[se.id].dataMode="auto"):le instanceof Vector?(le.recurseApply(ue=>this.adjustNum(se,ue)),ne[se.id]=cleanData(le)):le instanceof SAgent?(ne[se.id]=le,this.results.children[se.id].dataMode="auto"):ne[se.id]=cleanData(this.adjustNum(se,le))}}}unitsToBase(ee,re,ne){let ie=ee.id+"-"+(re?re.id:"");if(ie in this.unitsToBases)return this.unitsToBases[ie];let se=1;ne&&(se=this.timeUnits.toBase);let le=1;return re&&(re.addBase(),le=re.toBase),this.unitsToBases[ie]=fn["/"](fn["/"](le,ee.dna.toBase),se),this.unitsToBases[ie]}adjustNum(ee,re){if(ee.dna.unitless&&re.units)throw new ModelError(`The result of the calculation has units <i>${re.units.toString()}</i>, but the primitive is unitless. Please set the units for the primitive so we can determine the proper output.`,{primitive:ee,showEditor:!0,code:8e3});return ee instanceof SFlow&&!ee.dna.flowUnitless&&(re=mult(re,new Material(1,this.timeUnits))),ee instanceof SState||!re.units&&!(ee instanceof SFlow)?typeof re=="object"&&"value"in re?+re.value:re:+fn["*"](re.value,this.unitsToBase(ee,re.units,ee instanceof SFlow))}createSolver(ee){let re=this,ne=ee.stocks,ie=ee.flows,se=ee.actions,le=ee.transitions,ue=ee.valued,ae=ee.displayed,oe=ee.id,he=ee.timeStep,ce=ee.RKOrder;ee.RKPosition=1;let pe=0,de=[],me=Math.ceil(new Big(this.timeEnd.value).minus(this.timeStart.value).div(he.value).toNumber());for(let ye=0;ye<=me+2;ye++)de.push(new Material(new Big(this.timeStart.value).plus(new Big(ye).times(he.value)).toNumber(),he.units));let ve=(ye,Le,xe)=>{this.tasks.add(new Task({time:ye,expires:1,priority:0,name:"RK1 Solver - "+ee.id,action:Oe=>{if(re.valuedPrimitives=[],xe){let De=ie.length;for(let Me=0;Me<De;Me++)ie[Me].clean();De=ue.length;for(let Me=0;Me<De;Me++)ue[Me].clearCached()}this.frame(ue,ae);let Fe=se.length;for(let De=0;De<Fe;De++)(!se[De].initialized||se[De].dna.recalculate&&!se[De].block)&&updateTrigger.call(se[De]);Fe=le.length;for(let De=0;De<Fe;De++)(!le[De].initialized||le[De].dna.recalculate)&&updateTrigger.call(le[De]);this.step(ee),Le&&pe<=me&&(pe++,ve(de[pe],!0,!0))}}))},we=(ye,Le)=>{this.tasks.add(new Task({time:ye,name:"RK4 Solver (Init)  - "+ee.id,priority:-10,expires:1,blocker:oe+" init",action:xe=>{let Oe=ie.length;for(let Fe=0;Fe<Oe;Fe++)ie[Fe].clean();re.valuedPrimitives=[],Oe=ue.length;for(let Fe=0;Fe<Oe;Fe++)ue[Fe].clearCached();ee.RKPosition=1,xe.unblock(oe+" start"),xe.block()}})),this.tasks.add(new Task({time:ye,name:"RK4 Solver (step 1) - "+ee.id,priority:-5,expires:4,blocker:oe+" start",action:xe=>{if(ee.RKPosition>1){re.valuedPrimitives=[];let Oe=ue.length;for(let Fe=0;Fe<Oe;Fe++)ue[Fe].clearCached(),ue[Fe].pastValues.pop();if(ee.RKPosition===4){Oe=ie.length;for(let Fe=0;Fe<Oe;Fe++){let De=ie[Fe].checkRate(ie[Fe].RKPrimary[0].fullClone());ie[Fe].doRK4Aggregation(),ie[Fe].rate=De}}}if(this.frame(ue,ae),ee.RKPosition===4){let Oe=se.length;for(let Fe=0;Fe<Oe;Fe++)(!se[Fe].initialized||se[Fe].dna.recalculate&&!se[Fe].block)&&updateTrigger.call(se[Fe]);Oe=le.length;for(let Fe=0;Fe<Oe;Fe++)(!le[Fe].initialized||le[Fe].dna.recalculate)&&updateTrigger.call(le[Fe]);xe.unblock(oe+" init"),Le&&pe<=me&&(pe+=2,we(de[pe],!0)),this.step(ee)}else if(eq(re.time(),re.timeEnd))this.step(ee);else{let Oe=ne.length;for(let Fe=0;Fe<Oe;Fe++)ne[Fe].preserveLevel()}xe.block(),xe.unblock(oe+" mid")},rollback:function(){let xe=ne.length;for(let Oe=0;Oe<xe;Oe++)ne[Oe].restoreLevel()}})),this.tasks.add(new Task({time:de[pe+1],name:"RK4 Solver (step 2,3) - "+ee.id,priority:-10,expires:2,blocker:oe+" mid",action:xe=>{re.valuedPrimitives=[];let Oe=ue.length;for(let Fe=0;Fe<Oe;Fe++)ue[Fe]instanceof SState||ue[Fe].clearCached();ee.RKPosition++,Oe=ie.length;for(let Fe=0;Fe<Oe;Fe++)ie[Fe].rate=null;for(let Fe=0;Fe<Oe;Fe++)ie[Fe].value();xe.unblock(oe+" start"),xe.block()},timeShift:()=>{this.tasks.moveTo(de[pe])}})),this.tasks.add(new Task({time:de[pe+2],name:"RK4 Solver (step 4) - "+ee.id,priority:-30,expires:1,action:xe=>{re.valuedPrimitives=[];let Oe=ue.length;for(let Fe=0;Fe<Oe;Fe++)ue[Fe]instanceof SState||ue[Fe].clearCached();ee.RKPosition++,Oe=ie.length;for(let Fe=0;Fe<Oe;Fe++)ie[Fe].rate=null;for(let Fe=0;Fe<Oe;Fe++)ie[Fe].value();xe.unblock(oe+" start")},timeShift:()=>{this.tasks.moveTo(de[pe])}}))};function ge(ye,Le){if(ye instanceof Vector){let xe=!1;return ye.recurseApply(Oe=>{xe=xe||Le(Oe)}),xe}else return Le(ye)}function _e(ye){return ye&&ge(toNum(ye),Le=>Le instanceof Material&&Le.value<0)}function Te(ye){return ye&&ge(toNum(ye),Le=>Le instanceof Material&&Le.value>0)}function Ne(ye,Le){let xe=[];for(let Oe of ie)Oe.alpha&&Oe.alpha.dna.nonNegative&&Te(Oe.rate)||Oe.omega&&Oe.omega.dna.nonNegative&&_e(Oe.rate)?xe.push(Oe):Oe.apply(ye,Le);xe.sort((Oe,Fe)=>{let De=re.clusters[Oe.id],Me=re.clusters[Fe.id];return De.cluster<Me.cluster?-1:De.cluster>Me.cluster?1:De.flow<Me.flow?-1:De.flow>Me.flow?1:0});for(let Oe of xe)Oe.apply(ye,Le)}if(ce===1)this.tasks.addEvent((ye,Le)=>{Ne(ye,Le)}),ve(this.timeStart,!0);else if(ce===4)this.tasks.addEvent((ye,Le)=>{ye.value>0&&Ne(ye,Le)}),we(this.timeStart,!0);else throw new ModelError("Unknown solution algorithm.",{code:8001})}}class DNA{constructor(ee,re){this.primitive=ee,this.id=re||ee.id,this.name=ee.name,this.units=null,this.solver=void 0,this.frozen=void 0,this.slider=void 0,this.targetId=void 0,this.sourceId=void 0,this.value=void 0,this.trigger=void 0,this.repeat=void 0,this.delay=void 0,this.stockType=void 0,this.recalculate=void 0,this.nonNegative=void 0,this.residency=void 0,this.source=void 0,this.interpolation=void 0,this.triggerValue=void 0,this.inputs=void 0,this.outputs=void 0,this.flowUnitless=void 0,this.useMaxConstraint=void 0,this.useMinConstraint=void 0,this.minConstraint=void 0,this.maxConstraint=void 0,this.toBase=void 0,this.unitless=void 0,this.equation=void 0,this.agents=void 0,this.noOutput=!1,this.neighborProxyDNA=null,this.extraLinksPrimitives=[],this.adoptUnits=!1}}let Graph=function(){this.nodeSet={},this.nodes=[],this.edges=[],this.adjacency={},this.nextNodeId=0,this.nextEdgeId=0,this.eventListeners=[]};var Node=function(te,ee){this.id=te,this.data=typeof ee<"u"?ee:{}},Edge=function(te,ee,re,ne){this.id=te,this.source=ee,this.target=re,this.data=typeof ne<"u"?ne:{}};Graph.prototype.addNode=function(te){return typeof this.nodeSet[te.id]>"u"&&this.nodes.push(te),this.nodeSet[te.id]=te,this.notify(),te};Graph.prototype.addEdge=function(te){var ee=!1;return this.edges.forEach(function(re){te.id===re.id&&(ee=!0)}),ee||this.edges.push(te),typeof this.adjacency[te.source.id]>"u"&&(this.adjacency[te.source.id]={}),typeof this.adjacency[te.source.id][te.target.id]>"u"&&(this.adjacency[te.source.id][te.target.id]=[]),ee=!1,this.adjacency[te.source.id][te.target.id].forEach(function(re){te.id===re.id&&(ee=!0)}),ee||this.adjacency[te.source.id][te.target.id].push(te),this.notify(),te};Graph.prototype.newNode=function(te){var ee=new Node(this.nextNodeId++,te);return this.addNode(ee),ee};Graph.prototype.newEdge=function(te,ee,re){var ne=new Edge(this.nextEdgeId++,te,ee,re);return this.addEdge(ne),ne};Graph.prototype.getEdges=function(te,ee){return typeof this.adjacency[te.id]<"u"&&typeof this.adjacency[te.id][ee.id]<"u"?this.adjacency[te.id][ee.id]:[]};Graph.prototype.removeNode=function(te){typeof this.nodeSet[te.id]<"u"&&delete this.nodeSet[te.id];for(var ee=this.nodes.length-1;ee>=0;ee--)this.nodes[ee].id===te.id&&this.nodes.splice(ee,1);this.detachNode(te)};Graph.prototype.detachNode=function(te){var ee=this.edges.slice();ee.forEach(function(re){(re.source.id===te.id||re.target.id===te.id)&&this.removeEdge(re)},this),this.notify()};Graph.prototype.removeEdge=function(te){for(var ee=this.edges.length-1;ee>=0;ee--)this.edges[ee].id===te.id&&this.edges.splice(ee,1);for(var re in this.adjacency)for(var ne in this.adjacency[re])for(var ie=this.adjacency[re][ne],se=ie.length-1;se>=0;se--)this.adjacency[re][ne][se].id===te.id&&this.adjacency[re][ne].splice(se,1);this.notify()};Graph.prototype.merge=function(te){var ee=[];te.nodes.forEach(function(re){ee.push(this.addNode(new Node(re.id,re.data)))},this),te.edges.forEach(function(re){var ne=ee[re.from],ie=ee[re.to],se=re.directed?se=re.type+"-"+ne.id+"-"+ie.id:ne.id<ie.id?re.type+"-"+ne.id+"-"+ie.id:re.type+"-"+ie.id+"-"+ne.id,le=this.addEdge(new Edge(se,ne,ie,re.data));le.data.type=re.type},this)};Graph.prototype.filterNodes=function(te){var ee=this.nodes.slice();ee.forEach(function(re){te(re)||this.removeNode(re)},this)};Graph.prototype.filterEdges=function(te){var ee=this.edges.slice();ee.forEach(function(re){te(re)||this.removeEdge(re)},this)};Graph.prototype.addGraphListener=function(te){this.eventListeners.push(te)};Graph.prototype.notify=function(){this.eventListeners.forEach(function(te){te.graphChanged()})};let Layout={};Layout.ForceDirected=function(te,ee,re,ne){this.graph=te,this.stiffness=ee,this.repulsion=re,this.damping=ne,this.nodePoints={},this.edgeSprings={},this.getRandom=()=>Math.random()};Layout.ForceDirected.prototype.point=function(te){if(typeof this.nodePoints[te.id]>"u"){var ee=typeof te.data.mass<"u"?te.data.mass:1;this.nodePoints[te.id]=new Layout.ForceDirected.Point(gVector.random(this.getRandom),ee)}return this.nodePoints[te.id]};Layout.ForceDirected.prototype.spring=function(te){if(typeof this.edgeSprings[te.id]>"u"){var ee=typeof te.data.length<"u"?te.data.length:1,re=!1,ne=this.graph.getEdges(te.source,te.target);if(ne.forEach(function(ie){re===!1&&typeof this.edgeSprings[ie.id]<"u"&&(re=this.edgeSprings[ie.id])},this),re!==!1)return new Layout.ForceDirected.Spring(re.point1,re.point2,0,0);if(this.graph.getEdges(te.target,te.source),ne.forEach(function(ie){re===!1&&typeof this.edgeSprings[ie.id]<"u"&&(re=this.edgeSprings[ie.id])},this),re!==!1)return new Layout.ForceDirected.Spring(re.point2,re.point1,0,0);this.edgeSprings[te.id]=new Layout.ForceDirected.Spring(this.point(te.source),this.point(te.target),ee,this.stiffness)}return this.edgeSprings[te.id]};Layout.ForceDirected.prototype.eachNode=function(te){var ee=this;this.graph.nodes.forEach(function(re){te.call(ee,re,ee.point(re))})};Layout.ForceDirected.prototype.eachEdge=function(te){var ee=this;this.graph.edges.forEach(function(re){te.call(ee,re,ee.spring(re))})};Layout.ForceDirected.prototype.eachSpring=function(te){var ee=this;this.graph.edges.forEach(function(re){te.call(ee,ee.spring(re))})};Layout.ForceDirected.prototype.applyCoulombsLaw=function(){this.eachNode(function(te,ee){this.eachNode(function(re,ne){if(ee!==ne){var ie=ee.p.subtract(ne.p),se=ie.magnitude()+.1,le=ie.normalise();ee.applyForce(le.multiply(this.repulsion).divide(se*se*.5)),ne.applyForce(le.multiply(this.repulsion).divide(se*se*-.5))}})})};Layout.ForceDirected.prototype.applyHookesLaw=function(){this.eachSpring(function(te){var ee=te.point2.p.subtract(te.point1.p),re=te.length-ee.magnitude(),ne=ee.normalise();te.point1.applyForce(ne.multiply(te.k*re*-.5)),te.point2.applyForce(ne.multiply(te.k*re*.5))})};Layout.ForceDirected.prototype.attractToCentre=function(){this.eachNode(function(te,ee){var re=ee.p.multiply(-1);ee.applyForce(re.multiply(this.repulsion/50))})};Layout.ForceDirected.prototype.updateVelocity=function(te){this.eachNode(function(ee,re){re.v=re.v.add(re.a.multiply(te)).multiply(this.damping),re.a=new gVector(0,0)})};Layout.ForceDirected.prototype.updatePosition=function(te){this.eachNode(function(ee,re){re.p=re.p.add(re.v.multiply(te))})};Layout.ForceDirected.prototype.totalEnergy=function(te){var ee=0;return this.eachNode(function(re,ne){var ie=ne.v.magnitude();ee+=.5*ne.m*ie*ie}),ee};Layout.ForceDirected.prototype.nearest=function(te){var ee={node:null,point:null,distance:null},re=this;return this.graph.nodes.forEach(function(ne){var ie=re.point(ne),se=ie.p.subtract(te).magnitude();(ee.distance===null||se<ee.distance)&&(ee={node:ne,point:ie,distance:se})}),ee};Layout.ForceDirected.prototype.getBoundingBox=function(){var te=new gVector(-2,-2),ee=new gVector(2,2);this.eachNode(function(ne,ie){ie.p.x<te.x&&(te.x=ie.p.x),ie.p.y<te.y&&(te.y=ie.p.y),ie.p.x>ee.x&&(ee.x=ie.p.x),ie.p.y>ee.y&&(ee.y=ie.p.y)});var re=ee.subtract(te).multiply(.07);return{bottomleft:te.subtract(re),topright:ee.add(re)}};var gVector=function(te,ee){this.x=te,this.y=ee};gVector.random=function(te){return new gVector(10*(te()-.5),10*(te()-.5))};gVector.prototype.add=function(te){return new gVector(this.x+te.x,this.y+te.y)};gVector.prototype.subtract=function(te){return new gVector(this.x-te.x,this.y-te.y)};gVector.prototype.multiply=function(te){return new gVector(this.x*te,this.y*te)};gVector.prototype.divide=function(te){return new gVector(this.x/te||0,this.y/te||0)};gVector.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};gVector.prototype.normal=function(){return new gVector(-this.y,this.x)};gVector.prototype.normalise=function(){return this.divide(this.magnitude())};Layout.ForceDirected.Point=function(te,ee){this.p=te,this.m=ee,this.v=new gVector(0,0),this.a=new gVector(0,0)};Layout.ForceDirected.Point.prototype.applyForce=function(te){this.a=this.a.add(te.divide(this.m))};Layout.ForceDirected.Spring=function(te,ee,re,ne){this.point1=te,this.point2=ee,this.length=re,this.k=ne};function toposort(te){return toposort$1(uniqueNodes(te),te)}function toposort$1(te,ee){let re=te.length,ne=new Array(re),ie={},se=re,le=makeOutgoingEdges(ee),ue=makeNodesHash(te);for(ee.forEach(oe=>{if(!ue.has(oe[0])||!ue.has(oe[1]))throw new Error("Unknown node. There is an unknown node in the supplied edges.")});se--;)ie[se]||ae(te[se],se,new Set);return ne;function ae(oe,he,ce){if(ce.has(oe)){let de;try{de=", node was:"+JSON.stringify(oe)}catch{de=""}throw new Error("Cyclic dependency"+de)}if(!ue.has(oe))throw new Error("Found unknown node. Make sure to provided all involved nodes. Unknown node: "+JSON.stringify(oe));if(ie[he])return;ie[he]=!0;let pe=le.get(oe)||new Set;if(pe=Array.from(pe),he=pe.length){ce.add(oe);do{let de=pe[--he];ae(de,ue.get(de),ce)}while(he);ce.delete(oe)}ne[--re]=oe}}function uniqueNodes(te){let ee=new Set;for(let re=0,ne=te.length;re<ne;re++){let ie=te[re];ee.add(ie[0]),ee.add(ie[1])}return Array.from(ee)}function makeOutgoingEdges(te){let ee=new Map;for(let re=0,ne=te.length;re<ne;re++){let ie=te[re];ee.has(ie[0])||ee.set(ie[0],new Set),ee.has(ie[1])||ee.set(ie[1],new Set),ee.get(ie[0]).add(ie[1])}return ee}function makeNodesHash(te){let ee=new Map;for(let re=0,ne=te.length;re<ne;re++)ee.set(te[re],re);return ee}function runSimulation(te){let ee;try{return ee=new Simulator,ee.model=te.model,innerRunSimulation(ee,te)}catch(re){return checkErr(re,te,ee)}}function checkErr(te,ee,re){re.terminate();let ne;if(te instanceof ModelError?ne={error:te.message,errorPrimitive:te.primitive?re.model.getId(te.primitive.id):null,errorCode:te.code}:(console.log(te),ee.processError&&ee.processError(te),ne={error:"An unknown simulation error occurred. Please report this issue to the Insight Maker team at <a href='mailto:support@insightmaker.com' style='color: white'>support@insightmaker.com</a>.",errorPrimitive:null,errorCode:1},te=new ModelError(ne.error,{code:1})),re.results||(re.results={}),re.results.error=te.msg,ne.error&&(ne.error=ne.error.replace(/<br\s*\/?>/g,`
`).replace(/<[^>]*>?/gm,"")),ee.onError&&ee.onError(ne),ee.handleErrorObject)ee.handleErrorObject(te,re);else return ne}function innerRunSimulation(te,ee){ee&&(te.config=ee),te.evaluatingLine=null,ee.resultsWindow&&(ee.resultsWindow.windowContext.simulate.completed()||ee.resultsWindow.windowContext.simulate.terminate(),te.resultsWindow=ee.resultsWindow,ee.resultsWindow.windowContext.simulate=te,ee.resultsWindow.data.simulation=te,ee.resultsWindow.windowContext.componentRef.rerender(),ee.resultsWindow.windowContext.notFirstRun=!0),bootCalc(te),te.allPlaceholders={};let re=te.model.timeUnits;if(!re)throw new ModelError("You must set the time units in the model settings.",{code:1072});re=re.toLowerCase(),te.timeUnitsString=re;let ne={};ne.submodels={base:{id:"base",DNAs:[],agents:[{children:[],childrenId:{}}],size:1}};let ie=te.model.customUnits;if(ie){let ae=[];for(let oe of ie)if(oe.target.trim()){let he={sourceString:oe.name,scale:oe.scale},ce=createUnitStore(oe.target,te);if(ce)he.target=ce;else throw new ModelError('You cannot define a units synonym for "unitless".',{code:1001});ae.push(he)}te.unitManager.addUnits(ae)}let se=te.unitManager.getUnitStore([re],[1]);if(ne.timeLength=new Material(te.model.timeLength,se),ne.timeStart=new Material(te.model.timeStart||0,se),ne.timeStep=new Material(te.model.timeStep,se),ne.timeStep.value<=0||isNaN(ne.timeStep.value))throw new ModelError("The model time step must be a positive number.",{code:1002});if(ne.timeLength.value<=0||isNaN(ne.timeLength.value))throw new ModelError("The model time length must be a positive number.",{code:1003});if(te.model.timePause>0&&(ne.timePause=new Material(te.model.timePause,se),ne.timePause.value<ne.timeStep.value))throw new ModelError("Time pause cannot be smaller than the time step.",{code:1004});te.timeUnits=se;let le={};le.base={timeStep:new Material(te.model.timeStep,se),algorithm:te.model.algorithm,id:"base",maxLoaded:-1},ne.solvers=le;let ue=te.model.findFolders().concat(te.model.findAgents());for(let ae=0;ae<ue.length;ae++){let oe=ue[ae].customTimeSettings;if(oe&&oe.enabled){if(le[ue[ae].id]=Object.assign({},oe,{timeStep:new Material(+oe.timeStep,se)}),le[ue[ae].id].timeStep.value<=0||isNaN(le[ue[ae].id].timeStep.value))throw new ModelError("The folder time step must be a positive number.",{primitive:ue[ae],showEditor:!1,code:1005});le[ue[ae].id].id=ue[ae].id,le[ue[ae].id].maxLoaded=-1}}for(let ae of Object.values(le))ae.userTimeStep=ae.timeStep,ae.algorithm==="RK4"?ae.RKOrder=4:ae.RKOrder=1,ae.RKOrder===4&&(ae.timeStep=div(ae.userTimeStep,new Material(2))),ae.stocks=[],ae.flows=[],ae.transitions=[],ae.actions=[],ae.states=[],ae.valued=[],ae.displayed=[];try{let he=function(){if(!oe)if(oe=!0,te.displayInformation.populated)for(let ce=0;ce<te.displayInformation.origIds.length;ce++){let pe=te.displayInformation.origIds[ce],de=te.displayInformation.objects[ce];if(de instanceof SPopulation)te.results.children[pe].states=de.stateIds,te.displayInformation.agents[pe.toString()].data=te.results.children[pe].data,te.displayInformation.agents[pe.toString()].results=te.results.children[pe].results;else if(te.results.data[0][pe]instanceof Vector&&te.results.data[0][pe].names){let me=te.results.data[0][pe].fullNames();te.results.children[pe].indexedFullNames=me.slice();for(let ve=0;ve<me.length;ve++)me[ve]=me[ve].join(", ");te.results.children[pe].indexedNames=me}}else{te.displayInformation.populated=!0,te.displayInformation.colors=[],te.displayInformation.headers=[],te.displayInformation.agents=[],te.displayInformation.displayedItems=[],te.displayInformation.renderers=[],te.displayInformation.elementIds=[],te.displayInformation.res=te.results;let ce=[];te.displayInformation.origIds=te.displayInformation.ids.slice();for(let pe=0;pe<te.displayInformation.origIds.length;pe++){let de=te.displayInformation.origIds[pe],me=te.displayInformation.objects[pe],ve=me.dna;if(te.displayInformation.displayedItems.push({id:de,header:ve.name,type:ve.primitive._node.value.nodeName}),me instanceof SPopulation){let we=me.stateIds;te.results.children[de].states=we,we.forEach(ge=>{let _e=te.model.getId(ge);ce.push(de),te.displayInformation.elementIds.push("e"+de+"-"+ge),te.displayInformation.headers.push(_e.name),te.displayInformation.colors.push(ee.getColor?ee.getColor(_e):"#000000"),te.results.children[de].dataMode==="float"?te.displayInformation.renderers.push(commaStr):te.results.children[de].dataMode==="agents"?te.displayInformation.renderers.push(Te=>Te):te.displayInformation.renderers.push(void 0)}),te.displayInformation.agents[de.toString()]={id:de,item:ve.primitive,data:te.results.children[de].data,results:te.results.children[de].results}}else if(te.results.data.length&&te.results.data[0][de]instanceof Vector&&te.results.data[0][de].names){let we=ee.getColor?ee.getColor(ve.primitive):"#000000",ge=te.results.data[0][de].fullNames();te.results.children[de].indexedFullNames=ge.slice();for(let _e=0;_e<ge.length;_e++)ge[_e]=ge[_e].join(", ");te.results.children[de].indexedNames=ge;for(let _e=0;_e<ge.length;_e++)ce.push(de),te.displayInformation.elementIds.push("e"+de+"-"+_e),te.displayInformation.headers.push(ve.name+" ("+ge[_e]+")"),te.displayInformation.colors.push(we),te.displayInformation.renderers.push(commaStr)}else ce.push(de),te.displayInformation.elementIds.push("e"+de),te.displayInformation.headers.push(ve.name),te.displayInformation.colors.push(ee.getColor?ee.getColor(ve.primitive):"#000000"),te.results.children[de].dataMode==="float"?te.displayInformation.renderers.push(commaStr):te.displayInformation.renderers.push(void 0)}te.displayInformation.store={data:[]},te.displayInformation.ids=ce}};if(te.setup(ne),te.model.globals!==void 0)try{evaluateGlobals(te.model.globals,te)}catch(ce){if(ce.simulationCommand==="STOP")throw ce;let pe=[],de="An error with the macros prevented the simulation from running.";if(ce instanceof ModelError)de=de+"<br/><br/>"+ce.message;else{if(ce.toString&&ce.match&&ce.match(/line (\d+)/i)){let me=ce.match(/line (\d+)/i)[1];pe.push({type:"error",row:me!==void 0?me-1:te.evaluatingLine-1,text:ce})}ee.processError&&ee.processError(ce)}throw ee.showMacros&&ee.showMacros(pe),new ModelError(de,{code:1e3})}let ae=te.model.find();te.clusters=makeClusters(te);for(let ce of ae)if(ce instanceof Population){if(ce.isInAgent())throw new ModelError(`Cannot have the agent population <i>[${toHTML(ce.name)}]</i> placed within an agent folder.`,{primitive:ce,showEditor:!1,code:1006});let pe=ce.agentBase;if(!pe||!(pe instanceof Agent))throw new ModelError(`You must select a base agent for the primitive <i>[${toHTML(ce.name)}]</i>. You can create agent definitions using Folder primitives.`,{primitive:ce,showEditor:!1,code:1007});let de=new SPopulation(te);de.dna=new DNA(ce,pe.id),de.id=ce.id,de.agentId=pe.id,de.createIds(),de.dna.solver=folderSolvers(ce,le),de.dna.solver.displayed.push(de),de.geoDimUnits=ce.geoUnits,de.geoDimUnitsObject=createUnitStore(ce.geoUnits,te,ce);try{de.geoWidth=simpleUnitsTest(simpleEquation(ce.geoWidth,te),de.geoDimUnitsObject,te,ce)}catch{throw new ModelError(`Invalid width for the agent population <i>[${toHTML(ce.name)}]</i>.`,{primitive:ce,showEditor:!1,code:1008})}try{de.geoHeight=simpleUnitsTest(simpleEquation(ce.geoHeight,te),de.geoDimUnitsObject,te,ce)}catch{throw new ModelError(`Invalid height for the agent population <i>[${toHTML(ce.name)}]</i>.`,{primitive:ce,showEditor:!1,code:1009})}if(de.halfWidth=div(de.geoWidth,new Material(2)),de.halfHeight=div(de.geoHeight,new Material(2)),de.geoWrap=ce.geoWrapAround,de.placement=ce.geoPlacementType,de.placementFunction=ce.geoPlacementFunction,de.network=ce.networkType,de.networkFunction=ce.networkFunction,de.agentBase=pe.agentParent,de.agentBase&&de.agentBase.trim())try{de.agentBase=simpleEquation(de.agentBase,te,te.varBank)}catch{throw new ModelError(`Invalid Agent Parent for the primitive <i>[${toHTML(pe.name)}]</i>.`,{primitive:pe,showEditor:!1,code:1010})}let me=pe.children();de.DNAs=[];for(let ve of me)modelType(ve)&&de.DNAs.push(getDNA(ve,de,le,te)),ve instanceof State&&de.stateIds.add(ve.id);de.size=ce.populationSize,de.agents=[],de.dna.agents=de,ne.submodels[ce.id]=de,ne.submodels.base.DNAs.push(de.dna)}else ce.isInAgent()||modelType(ce)&&ne.submodels.base.DNAs.push(getDNA(ce,ne.submodels.base,le,te));for(let ce of Object.values(ne.submodels)){ce.DNAs.sort((pe,de)=>pe.neighborProxyDNA&&!de.neighborProxyDNA?1:de.neighborProxyDNA&&!pe.neighborProxyDNA?-1:0);for(let pe=0;pe<ce.size;pe++){let de;ce.id==="base"?de=ce.agents[0]:(de=new SAgent(te),de.container=ce,de.index=pe,de.children=[],de.childrenId={},de.agentId=ce.id,de.createIds(),ce.agentBase&&(de.vector.parent=ce.agentBase),ce.agents.push(de));for(let me of ce.DNAs)decodeDNA(me,de,te)}}for(let ce in ne.submodels){let pe=ne.submodels[ce];for(let de=0;de<pe.size;de++)for(let me=0;me<pe.DNAs.length;me++)linkPrimitive(pe.agents[de].children[me],pe.DNAs[me],te)}for(let ce in ne.submodels){let pe=ne.submodels[ce];for(let de=0;de<pe.size;de++)setAgentInitialValues(pe.agents[de])}for(let ce in ne.submodels)if(ce!=="base"){try{buildNetwork(ne.submodels[ce],te)}catch(pe){let de="An error with the custom network function prevented the simulation from running.";throw pe instanceof ModelError&&(de=de+"<br/><br/>"+pe.message),new ModelError(de,{primitive:ne.submodels[ce].node,showEditor:!1,code:1011})}try{buildPlacements(ne.submodels[ce],te)}catch(pe){let de="An error with the agent placement function prevented the simulation from running.";throw pe instanceof ModelError&&(de=de+"<br/><br/>"+pe.message),new ModelError(de,{primitive:ne.submodels[ce].node,showEditor:!1,code:1012})}}te.results={times:[],data:[],timeUnits:te.timeUnitsString},te.displayInformation={populated:!1,ids:[],times:[],objects:[],maps:[],histograms:[]},ne.submodels.base.agents[0].children.forEach(ce=>{if(!(ce instanceof SAction||ce instanceof STransition)){ce.dna.noOutput||(te.displayInformation.objects.push(ce),te.displayInformation.ids.push(ce.id));let pe={};ce instanceof SPopulation?(pe.width=ce.geoWidth,pe.height=ce.geoHeight,pe.units=ce.geoDimUnitsObject,pe.states=ce.states()):ce.dna.noOutput||ce.dna.solver.displayed.push(ce),te.results.children||(te.results.children={}),te.results.children[ce.id]={data:pe,results:[],dataMode:"float"}}});let oe=!1;if(ee.silent)if(ee.onPause)te.run(ee);else return formatSimResults(te.run(ee));else{let ce=div(ne.timeLength,ne.timeStep);for(let ve=0;ve<=ce.value;ve++)te.displayInformation.times.push(plus(ne.timeStart,mult(ne.timeStep,new Material(ve))).value);let pe=ee.onSuccess;ee.onSuccess=function(ve){he();for(let we in te.simulationModel.solvers)updateDisplayed(te.simulationModel.solvers[we],te);te.setResultsCallback&&te.setResultsCallback(formatSimResults(te.results)),pe&&pe(ve)},ee.onCompletedFirstPass=function(){he()};let de=ee.onStep;ee.onStep=function(ve){let we=!1,ge=te.progress();if(!te.shouldSleep){let _e=Date.now()-te.wakeUpTime,Te=1;te.results.times.length>2e4?Te=4:te.results.times.length>5e3?Te=2:te.results.times.length>1e3&&(Te=1.3),(!te.resultsWindow&&_e>100*Te||_e>600*Te)&&(updateDisplayed(ve,te),we=!0,te.timer=setTimeout(()=>{te.resume()},20*Math.pow(Te,1.5)),te.sleep())}ge===1&&!we&&updateDisplayed(ve,te),de&&de(ve)};let me=ee.onError;ee.onError=function(ve){try{for(let we in te.simulationModel.solvers)updateDisplayed(te.simulationModel.solvers[we],te)}catch{}te.finished&&te.finished(),me&&me(ve)},te.run(ee)}}catch(ae){if(ae.simulationCommand!=="STOP")throw ae;if(ee.silent)return{times:[],value:()=>[],lastValue:()=>{},error:"stop() called during initialization"}}}function cleanData(te,ee=!1){if(te instanceof Vector)if(ee)if(te.names&&te.names.length){let re={};for(let ne=0;ne<te.names.length;ne++)re[te.names[ne]]=cleanData(te.items[ne]);return re}else return te.items.map(re=>cleanData(re,ee));else return new Vector(te.items.map(re=>cleanData(re,ee)),te.simulate,te.names,te.parent);else{if(typeof te=="number")return+te.toPrecision(15);if(Array.isArray(te))return te.map(re=>cleanData(re,ee))}return te}function formatSimResults(te){let ee={};return ee.times=te.times.slice(),ee.data=te.data,ee.timeUnits=te.timeUnits,ee.children=te.children,ee.error=te.error,ee.errorPrimitive=te.errorPrimitive,ee.stochastic=te.stochastic,ee.error||(ee.error=null,ee.errorPrimitive=null),ee.value=function(re){if(!re)throw new Error("Cannot get result value() of null or undefined primitive.");let ne=this.children[re.id];if(!ne)throw new Error("Cannot find primitive in value() results.");return cleanData(ne.results,!0)},ee.lastValue=function(re){if(!re)throw new Error("Cannot get result lastValue() of null or undefined primitive.");let ne=this.children[re.id];if(!ne)throw new Error("Cannot find primitive in lastValue() results.");return cleanData(ne.results[ne.results.length-1],!0)},ee.times&&(ee.periods=ee.times.length),ee}function createUnitStore(te,ee,re){if(!(!te||te.trim()===""||te.trim().toLowerCase()==="unitless"))try{return simpleEquation("{1 "+te+"}",ee,{}).units}catch{throw new ModelError(`Invalid units: "<i>${te}</i>"`,{primitive:re,showEditor:!0,code:1012})}}function simpleEquation(te,ee,re,ne,ie){return re||(re=Object.create(null)),ne||(ne=Object.create(null)),ie||(ie=trimTree(createTree(te),ne,ee)),evaluateTree(ie,re,ee)}function simpleNum(te,ee,re){if(te instanceof Vector)return new Vector(te.items.map(ne=>simpleNum(ne,ee,re)),re);if(te instanceof Material){if(!ee&&te.units)throw new ModelError(`The result of the calculation has units <i>${te.units.toString()}</i>, but no units are specified for the calculation. Please set the units for the calculation so we can determine the proper output.`,{code:1013});return te.units?(te.units.addBase(),ee.addBase(),+fn["*"](te.value,fn["/"](te.units.toBase,ee.toBase))):+te.value}}function simpleUnitsTest(te,ee,re,ne=null,ie=!1,se="Unknown simpleUnits type"){if(te instanceof Vector)return new Vector(te.items.map(le=>simpleUnitsTest(le,ee,re,ne,ie,se)),re);if(te instanceof Material){if(!te.units&&!ee)return te;if(te.units){if(te.units===ee)return te;{let le=convertUnits(te.units,ee);if(le===0)throw new ModelError(`Wrong units generated. Expected <i>${ee?ee.toString():"unitless"}</i>, and got <i>${te.units.toString()}</i>.`,{primitive:ne,showEditor:ie,code:1014});return te.value=te.value*le,te.units=ee,te}}else return te.units=ee,te}throw new ModelError(se,{code:1015})}function evaluateGlobals(te,ee){evaluateTree(trimTree(createTree(te),{},ee),ee.varBank,ee)}function getDNA(te,ee,re,ne){let ie=new DNA(te),se;if(ie.solver=folderSolvers(te,re),te){let le=te.parent;le&&(ie.frozen=le.frozen)}if((te instanceof Variable||te instanceof Flow)&&te.external&&(ie.slider=!0),(te instanceof Flow||te instanceof Transition)&&(te.end!==null&&(ie.targetId=te.end.id),te.start!==null&&(ie.sourceId=te.start.id)),te instanceof Converter)ie.value=te.values;else try{te instanceof Stock?ie.value=replaceMacros(te,ie,createTree(te.initial),ee,re,ne,!0):te instanceof Flow?ie.value=replaceMacros(te,ie,createTree(te.rate),ee,re,ne,!1):te instanceof Variable?ie.value=replaceMacros(te,ie,createTree(te.value),ee,re,ne,!1):te instanceof State?ie.value=replaceMacros(te,ie,createTree(te.startActive),ee,re,ne,!0):te instanceof Transition?ie.value=replaceMacros(te,ie,createTree(te.value),ee,re,ne,!1):te instanceof Action&&(ie.value=replaceMacros(te,ie,createTree(te.action),ee,re,ne,!1))}catch(le){let ue=`The primitive <i>[${toHTML(ie.name)}]</i> has an equation error that must be corrected before the model can be run.`;throw le instanceof ModelError?ue=ue+"<br/><br/>"+le.message:(console.error(le),ue=ue+"<br/><br/>Unknown error."),se=void 0,le.match&&le.match(/line (\d+)/i)&&(se=le.match(/line (\d+)/i)[1]),new ModelError(ue,{code:1055,primitive:te,showEditor:!0,line:se,details:le.match?le:void 0})}if(te instanceof Action){ie.trigger=te.trigger,ie.repeat=te.repeat,ie.recalculate=te.recalculate||te.trigger==="Condition";try{ie.triggerValue=createTree(te.value)}catch(le){let ue=`The trigger for <i>[${toHTML(ie.name)}]</i> has an equation error that must be corrected before the model can be run.`;throw le instanceof ModelError&&(ue=ue+"<br/><br/>"+le.message),new ModelError(ue,{code:1056,primitive:te,showEditor:!0,line:se})}}else if(te instanceof Transition)ie.trigger=te.trigger,ie.repeat=te.repeat,ie.recalculate=te.recalculate||te.trigger==="Condition";else if(te instanceof State)if(te.residency===void 0||te.residency.trim()==="")ie.residency=null;else try{ie.residency=evaluateTree(trimTree(createTree(te.residency),{},ne),{},ne),ie.residency.units||(ie.residency.units=ne.timeUnits),eq(ie.residency,new Material(0,ne.timeUnits))&&(ie.residency=null)}catch{throw new ModelError("Invalid state residency.",{primitive:te,showEditor:!1,code:1016})}else if(te instanceof Stock){if(ie.nonNegative=te.nonNegative,te.type==="Conveyor"){ie.stockType="Conveyor";try{ie.delay=evaluateTree(trimTree(createTree(te.delay),{},ne),{},ne),ie.delay.units||(ie.delay.units=ne.timeUnits)}catch{throw new ModelError("Invalid stock delay.",{primitive:te,showEditor:!1,code:1017})}if(!(ie.delay instanceof Material))throw new ModelError("Stock delay must be a number.",{primitive:te,showEditor:!1,code:1073});if(ie.delay.value<0)throw new ModelError("Stock delay cannot be less than 0.",{primitive:te,showEditor:!1,code:1074})}}else if(te instanceof Flow)ie.nonNegative=te.nonNegative;else if(te instanceof Converter){ie.interpolation=te.interpolation==="Linear"?"linear":"discrete";let le=te.values;if(!le||!le.length)throw new ModelError(`The converter <i>[${toHTML(ie.name)}]</i> does not have any data.`,{primitive:te,showEditor:!0,code:1018});let ue=[],ae=[],oe;if(te.input==="Time")oe=ne.timeUnits;else{let he=te.input;if(he)oe=createUnitStore(he.units,ne,te);else throw new ModelError(`The converter <i>[${toHTML(ie.name)}]</i> does not have a source.`,{primitive:te,showEditor:!0,code:1019})}ie.source=te.input==="Time"?te.input:te.input.id;for(let he=0;he<le.length;he++)ue.push(new Material(le[he].x,oe)),ae.push(new Material(le[he].y));ie.inputs=ue,ie.outputs=ae}if(te instanceof ValuedPrimitive){if(!(te instanceof Transition)&&!(te instanceof Action)){let ue=te.units;try{!(te instanceof Flow)||ue&&ue.trim()&&ue.trim().toLowerCase()!=="unitless"?ie.units=createUnitStore(ue,ne,te):(ie.units=ne.timeUnits.power(-1),ie.flowUnitless=!0)}catch{throw new ModelError(`Invalid units specified for primitive: "<i>${toHTML(ue)}</i>"`,{primitive:te,showEditor:!0,code:1020})}}else ie.trigger==="Timeout"&&(ie.units=ne.timeUnits);let le=te.constraints;ie.maxConstraint=le.max,ie.useMaxConstraint="max"in le,ie.minConstraint=le.min,ie.useMinConstraint="min"in le}return ie.units&&!ie.units.isUnitless()?(ie.units.addBase(),ie.toBase=ie.units.toBase):ie.toBase=1,ie.unitless=!ie.units,ie}function folderSolvers(te,ee){if(!te)return ee.base;if(te instanceof Population){let ne=te.agentBase;if(ne&&ee[ne.id])return ee[ne.id]}let re=te.parent;return re&&ee[re.id]?ee[re.id]:folderSolvers(re,ee)}function decodeDNA(te,ee,re){let ne;te.primitive instanceof Variable?ne=new SVariable(re):te.primitive instanceof State?ne=new SState(re):te.primitive instanceof Transition?ne=new STransition(re):te.primitive instanceof Action?ne=new SAction(re):te.primitive instanceof Stock?ne=new SStock(re):te.primitive instanceof Flow?ne=new SFlow(re):te.primitive instanceof Converter&&(ne=new SConverter(re)),ne?(ne.dna=te,ne.id=te.id,ne.index=ee.index,ne.agentId=ee.agentId,ne.container=ee,ne.createIds(),ne.frozen=te.frozen,ee.children.push(ne),ee.childrenId[ne.id]=ne,te.slider&&(re.sliders[te.id]?re.sliders[te.id].push(ne):re.sliders[te.id]=[ne]),ne instanceof SAction?te.solver.actions.push(ne):ne instanceof STransition?te.solver.transitions.push(ne):ne instanceof SPopulation||(te.solver.valued.push(ne),ne instanceof SFlow?te.solver.flows.push(ne):ne instanceof SStock?te.solver.stocks.push(ne):ne instanceof SState&&te.solver.states.push(ne)),te.neighborProxyDNA&&(ne.neighborProxyPrimitive=ee.children.find(ie=>ie.dna===te.neighborProxyDNA))):te.primitive instanceof Population&&(ee.children.push(te.agents),ee.childrenId[te.id]=te.agents)}function linkPrimitive(te,ee,re){if(!(te instanceof SPopulation)){let ne=getPrimitiveNeighborhood(te.neighborProxyPrimitive?te.neighborProxyPrimitive:te,te.neighborProxyPrimitive?te.dna.neighborProxyDNA:ee,re,te.dna.extraLinksPrimitives);if(te instanceof SFlow||te instanceof STransition){let ie=ne;te.neighborProxyPrimitive&&(ie=getPrimitiveNeighborhood(te,ee,re,te.dna.extraLinksPrimitives));let se=null,le=null;if(ie["[alpha"]&&(se=ie["[alpha"],ie.alpha||(ie.alpha=se)),ie["[omega"]&&(le=ie["[omega"],ie.omega||(ie.omega=le)),te instanceof STransition){if(se&&!(se instanceof SState))throw new ModelError(`The start of the primitive <i>[${ee.name}]</i> must be a state.`,{primitive:ee.primitive,showEditor:!1,code:1060});if(le&&!(le instanceof SState))throw new ModelError(`The end of the primitive <i>[${ee.name}]</i> must be a state.`,{primitive:ee.primitive,showEditor:!1,code:1061})}if(te instanceof SFlow){if(se&&!(se instanceof SStock))throw new ModelError(`The start of the primitive <i>[${ee.name}]</i> must be a stock.`,{primitive:ee.primitive,showEditor:!1,code:1062});if(le&&!(le instanceof SStock))throw new ModelError(`The end of the primitive <i>[${ee.name}]</i> must be a stock.`,{primitive:ee.primitive,showEditor:!1,code:1063})}te.setEnds(se,le)}if(te instanceof SAction){try{te.equation=trimTree(ee.triggerValue,ne,te.simulate)}catch(ie){let se=`The primitive <i>[${toHTML(ee.name)}]</i> has an equation error that must be corrected before the model can be run.`;throw ie instanceof ModelError&&(se=se+"<br/><br/>"+ie.message),new ModelError(se,{primitive:ee.primitive,showEditor:!1,code:1064})}try{te.action=trimTree(ee.value,ne,te.simulate)}catch(ie){let se=`The primitive <i>[${toHTML(ee.name)}]</i> has an equation error that must be corrected before the model can be run.`;ie instanceof ModelError&&(se=se+"<br/><br/>"+ie.message);let le;throw ie.match&&ie.match(/line (\d+)/i)&&(le=ie.match(/line (\d+)/i)[1]),new ModelError(se,{primitive:ee.primitive,showEditor:!0,code:1065,line:le,details:ie.match?ie:void 0})}}else if(te instanceof SConverter)if(ee.source==="Time")te.setSource("*time");else{let ie=ee.source,se=!1;for(let le in ne)if(ie===ne[le].id){te.setSource(ne[le]),se=!0;break}if(!se)throw new ModelError("Converter source could not be found. Please redefine it.",{primitive:ee.primitive,showEditor:!1,code:1066})}else te.setEquation(ee.value,ne)}}function setAgentInitialValues(te){for(let ee of te.children)if(ee instanceof SStock){ee.setDelay();try{ee.setInitialValue()}catch(re){throw re instanceof ModelError&&(re.primitive||(re.primitive=ee.orig())),re}}else if(ee instanceof SState)try{ee.active===null&&ee.setInitialActive(!0)}catch(re){throw re instanceof ModelError&&(re.primitive||(re.primitive=ee.orig())),re}}function buildNetwork(te,ee){if(te.network==="Custom Function"){let re=getPrimitiveNeighborhood(te,te.dna,ee,[]),ne=trimTree(createTree(te.networkFunction),re,ee);for(let ie=0;ie<te.agents.length-1;ie++)for(let se=ie+1;se<te.agents.length;se++)trueValue(simpleEquation(te.networkFunction,ee,{"-parent":ee.varBank,a:te.agents[ie],b:te.agents[se]},re,ne))&&te.agents[ie].connect(te.agents[se])}else if(te.network!=="None")throw new ModelError(`Unknown network type: ${toHTML(te.network)}.`,{primitive:te.node,showEditor:!1,code:1020})}function buildPlacements(te,ee){let re,ne,ie;if(te.placement==="Random")for(let se of te.agents)se.location=new Vector([mult(te.geoWidth,new Material(Rand(ee))),mult(te.geoHeight,new Material(Rand(ee)))],ee,["x","y"]);else if(te.placement==="Custom Function")te.agents.forEach(se=>{let le=getPrimitiveNeighborhood(te,te.dna,ee,[]);le.self=se,se.location=simpleUnitsTest(simpleEquation(te.placementFunction,ee,{"-parent":ee.varBank,self:se},le),te.geoDimUnitsObject,ee,null,null,"Agent placement functions must return a two element vector"),validateAgentLocation(se.location,te.node),se.location.names||(se.location.names=["x","y"],se.location.namesLC=["x","y"])});else if(te.placement==="Grid"){re=trimTree(createTree("{x: x*width(self), y: y*height(self)}"),{},ee);let se=te.agents.length,le=simpleNum(simpleEquation("width(self)/height(self)",ee,{"-parent":ee.varBank,self:te},{}),te.geoDimUnitsObject,ee);ie=Math.sqrt(se/le),ne=Math.floor(ie*le),ie=Math.ceil(ie),ie*ne<se&&(ne=ne+1);let ue=0;te.agents.forEach(ae=>{let oe=(ue%ne+.5)/ne,he=(Math.floor(ue/ne)+.5)/ie;ae.location=simpleUnitsTest(simpleEquation("{x: x*width(self), y: y*height(self)}",ee,{self:ae,x:new Material(oe),y:new Material(he),"-parent":ee.varBank},{},re),te.geoDimUnitsObject,ee),ue++})}else if(te.placement==="Ellipse"){re=trimTree(createTree("{width(self), height(self)}/2+{sin(index(self)/size*2*3.14159), cos(index(self)/size*2*3.14159)}*{width(self), height(self)}/2"),{},ee);let se=new Material(te.agents.length);te.agents.forEach(le=>{le.location=simpleUnitsTest(simpleEquation("{width(self), height(self)}/2+{sin(index(self)/size*2*3.14159), cos(index(self)/size*2*3.14159)}*{width(self), heigh(self)}/2",ee,{self:le,size:se,"-parent":ee.varBank},{},re),te.geoDimUnitsObject,ee)})}else if(te.placement==="Network"){re=trimTree(createTree("{x: x*width(self), y: y*height(self)}"),{},ee);let se=new Graph,le=te.agents.map(ce=>se.newNode({data:ce})),ue=function(ce){for(let pe of le)if(pe.data.data===ce)return pe;return null};te.agents.forEach(ce=>{ce.connected.forEach(pe=>{se.newEdge(ue(ce),ue(pe))})});let ae=new Layout.ForceDirected(se,400,600,.5);ae.getRandom=()=>Rand(ee);for(let ce=0;ce<60;ce++)ae.applyCoulombsLaw(),ae.applyHookesLaw(),ae.attractToCentre(),ae.updateVelocity(.03),ae.updatePosition(.03);let oe=ae.getBoundingBox();oe.width=oe.topright.x-oe.bottomleft.x,oe.height=oe.topright.y-oe.bottomleft.y;let he=function(ce){return{x:(ce.x-oe.bottomleft.x)/oe.width,y:(ce.y-oe.bottomleft.y)/oe.height}};ae.eachNode((ce,pe)=>{let de=he(pe.p);ce.data.data.location=simpleUnitsTest(simpleEquation("{x: x*width(self), y: y*height(self)}",ee,{self:te,x:new Material(de.x),y:new Material(de.y),"-parent":ee.varBank},{},re),te.geoDimUnitsObject,ee)})}else throw new ModelError(`Unknown placement type: ${toHTML(te.placement)}.`,{primitive:te.node,showEditor:!1,code:1021})}function getPrimitiveNeighborhood(te,ee,re,ne){let ie=ee.primitive.neighbors();if(ne)for(let ue of ne)ie.push({item:ue,type:"direct"});let se=re.allPlaceholders[ee.id]?re.allPlaceholders[ee.id]:{},le={self:te};if(te instanceof SPopulation)for(let ue of te.DNAs)se[ue.name.toLowerCase()]=new Placeholder(ue,te,re);for(let ue of ie){let ae=ue.item;if(ae instanceof Population){le[te.simulate.simulationModel.submodels[ae.id].dna.name.toLowerCase()]=te.simulate.simulationModel.submodels[ae.id];for(let oe of te.simulate.simulationModel.submodels[ae.id].DNAs){let he=oe.name.toLowerCase();he in le||(le[he]=new Placeholder(oe,te,re))}}else if(ue.type!=="agent"){let oe=!1,he;if(te.container&&te.container.childrenId[ae.id]&&(he=te.container.childrenId[ae.id].dna.name.toLowerCase(),le[he]=te.container.childrenId[ae.id],oe=!0),oe||te.simulate.simulationModel.submodels.base.agents[0].childrenId[ae.id]&&(he=te.simulate.simulationModel.submodels.base.agents[0].childrenId[ae.id].dna.name.toLowerCase(),le[he]=te.simulate.simulationModel.submodels.base.agents[0].childrenId[ae.id],oe=!0),!oe&&(te instanceof SFlow||te instanceof STransition)&&ae===re.model.getId(ae.id))throw te instanceof SFlow?new ModelError("Flow primitives may not cross agent boundaries.",{primitive:ee.primitive,showEditor:!1,code:1070}):new ModelError("Transition primitives may not cross agent boundaries.",{primitive:ee.primitive,showEditor:!1,code:1071});(te instanceof SFlow||te instanceof STransition)&&le[he]&&(ee.targetId===le[he].id?le["[omega"]=le[he]:ee.sourceId===le[he].id&&(le["[alpha"]=le[he]))}}for(let ue in se)ue in le||(le[ue]=se[ue]);return re.allPlaceholders[ee.id]=se,le}function modelType(te){return te instanceof Stock||te instanceof Flow||te instanceof State||te instanceof Transition||te instanceof Converter||te instanceof Variable||te instanceof Action||te instanceof Population}function updateDisplayed(te,ee){let re=te.displayed;if(ee.displayInformation.store){for(let ne=ee.displayInformation.store.data.length;ne<ee.results.times.length;ne++){let ie=ee.displayInformation.store.data[ne],se={};if(ie||(se.id=ne,se.Time=ee.results.times[ne]),re.length>0&&ee.results.data[ne][re[0].id]!==void 0)for(let le=0;le<re.length;le++){let ue=ee.displayInformation.ids.indexOf(re[le].id);if(ue>-1)if(ee.results.children[ee.displayInformation.ids[ue]].states){let ae=ee.results.children[ee.displayInformation.ids[ue]].states;if(ee.results.data[ne][re[le].id]){let oe=ee.results.data[ne][re[le].id].current,he={};for(let pe of oe)if(pe.state)for(let de of pe.state)he[de.id.toString()]=he[de.id.toString()]+1||1;let ce=0;ae.forEach(pe=>{se[ee.displayInformation.elementIds[ue+ce]]=he[pe]||0,ce++})}}else if(ee.results.children[ee.displayInformation.ids[ue]].indexedNames){let ae=0;for(;ue<ee.displayInformation.ids.length&&ee.displayInformation.ids[ue]===re[le].id;){try{se[ee.displayInformation.elementIds[ue]]=selectFromMatrix(ee.results.data[ne][re[le].id].fullClone(),ee,ee.results.children[ee.displayInformation.ids[ue]].indexedFullNames[ae].slice())}catch{throw new ModelError("Cannot change vector keys during a simulation.",{primitive:re[le].dna.primitive,showEditor:!0,code:1022})}ae++,ue++}}else se[ee.displayInformation.elementIds[ue]]=ee.results.data[ne][re[le].id]}ie?Object.assign(ie,se):ee.displayInformation.store.data.push(se)}ee.resultsWindow||(ee.resultsWindow=ee.config.createResultsWindow(ee))}}function validateAgentLocation(te,ee){let re=()=>{throw new ModelError("Agent placement functions must return a two element vector",{primitive:ee,showEditor:!1,code:1023})};te instanceof Vector||re(),te.length()!==2&&re(),te.items[0]instanceof Material||re(),te.items[1]instanceof Material||re()}function makeClusters(te){let ee={},re=te.model.findFlows(),ne=0;for(;re.length;){ne++;let ie=re[0],se={availableFlows:re,edges:[],stockSet:new Set,flowSet:new Set,simulate:te};clusterAddFlow(se,ie);let le;try{le=toposort(se.edges)}catch{let oe=[...se.flowSet.entries()].map(ce=>ce[0]);oe.sort((ce,pe)=>ce.id-pe.id);let he=0;for(let ce of oe)he++,ee[ce.id]={cluster:ne,flow:he};continue}let ue=0;for(let ae of le)ae instanceof Flow&&(ue++,ee[ae.id]={cluster:ne,flow:ue})}return ee}function clusterAddFlow(te,ee){te.flowSet.add(ee),te.availableFlows.splice(te.availableFlows.indexOf(ee),1);let re=ee.start,ne=ee.end;re&&re.nonNegative&&(te.edges.push([re,ee]),te.stockSet.has(re)||(te.stockSet.add(re),clusterAddStock(te,re))),ne&&ne.nonNegative&&(te.edges.push([ee,ne]),te.stockSet.has(ne)||(te.stockSet.add(ne),clusterAddStock(te,ne)))}function clusterAddStock(te,ee){let re=!0;for(;re;){re=!1;for(let ne of te.availableFlows){let ie=ne.start,se=ne.end;if(ie===ee||se===ee){clusterAddFlow(te,ne),re=!0;break}}}}let macroCounter=0;const MACRO_FNS={_initial:{replacement:te=>{let{input:ee,initialValue:re}=te;return re?re.cloneStructure():ee.cloneStructure()}},smooth:{replacement:(te,ee,re,ne,ie,se)=>{let{input:le,initialValue:ue,period:ae}=te;ae=new TreeNode("LINES","LINES",re.line,[new TreeNode("ASSIGN","ASSIGN",re.line,[new TreeNode("ASSIGNED","ASSIGNED",re.line,[new TreeNode("__tmp_macro_period","IDENT",re.line)]),new TreeNode("INNER","INNER",re.line,[new TreeNode("RemoveUnits","IDENT",re.line),new TreeNode("FUNCALL","FUNCALL",re.line,[ae,new TreeNode('"'+se.timeUnitsString+'"',"STRING",re.line)])])]),new TreeNode("INNER","INNER",re.line,[new TreeNode("Assert","IDENT",re.line),new TreeNode("FUNCALL","FUNCALL",re.line,[new TreeNode(">","GT",re.line,[new TreeNode("__tmp_macro_period","IDENT",re.line),new TreeNode("0","INTEGER",re.line)]),new TreeNode('"Period for Smooth() must be greater than 0."',"STRING",re.line)])]),new TreeNode("__tmp_macro_period","IDENT",re.line)]);let oe=new Model,he="__Smooth Stock "+macroCounter++,ce=oe.Stock({name:he,initial:"(iv) || (i)"});ce._node.id=""+Math.random();let pe=oe.Flow(null,ce,{name:"__Smooth Inflow",rate:"((i) - [Omega]) / (p)",nonNegative:!1});pe._node.id=""+Math.random();let de=getDNA(ce,ne,ie,se),me=getDNA(pe,ne,ie,se);ee.extraLinksPrimitives.push(ce),me.extraLinksPrimitives.push(ce),de.value=ue?ue.cloneStructure():le.cloneStructure();let ve=new TreeNode("DIV","DIV",re.line,[new TreeNode("MINUS","MINUS",re.line,[le.cloneStructure(),new TreeNode("["+he+"]","PRIMITIVE",re.line)]),ae.cloneStructure()]);return me.value=ve,me.noOutput=!0,de.noOutput=!0,me.adoptUnits=!0,de.adoptUnits=!0,me.neighborProxyDNA=ee,de.neighborProxyDNA=ee,ne.DNAs.push(me),ne.DNAs.push(de),new TreeNode("["+he+"]","PRIMITIVE",re.line)}},delay1:{replacement:(te,ee,re,ne,ie,se)=>{let{input:le,initialValue:ue,period:ae}=te,oe=new Model;ae=new TreeNode("LINES","LINES",re.line,[new TreeNode("ASSIGN","ASSIGN",re.line,[new TreeNode("ASSIGNED","ASSIGNED",re.line,[new TreeNode("__tmp_macro_period","IDENT",re.line)]),new TreeNode("INNER","INNER",re.line,[new TreeNode("RemoveUnits","IDENT",re.line),new TreeNode("FUNCALL","FUNCALL",re.line,[ae,new TreeNode('"'+se.timeUnitsString+'"',"STRING",re.line)])])]),new TreeNode("INNER","INNER",re.line,[new TreeNode("Assert","IDENT",re.line),new TreeNode("FUNCALL","FUNCALL",re.line,[new TreeNode(">","GT",re.line,[new TreeNode("__tmp_macro_period","IDENT",re.line),new TreeNode("0","INTEGER",re.line)]),new TreeNode('"Period for Delay1() must be greater than 0."',"STRING",re.line)])]),new TreeNode("__tmp_macro_period","IDENT",re.line)]);let he="__Delay1 Stock "+macroCounter++,ce="__Delay1 Outflow "+macroCounter++,pe=oe.Stock({name:he,initial:"(iv) || (i)"});pe._node.id=""+Math.random();let de=oe.Flow(null,pe,{name:"__Delay1 Inflow",rate:"(i)",nonNegative:!1});de._node.id=""+Math.random();let me=oe.Flow(pe,null,{name:ce,rate:"(alpha) / (p)",nonNegative:!1});me._node.id=""+Math.random();let ve=getDNA(pe,ne,ie,se),we=getDNA(de,ne,ie,se),ge=getDNA(me,ne,ie,se);return ee.extraLinksPrimitives.push(me),ge.extraLinksPrimitives.push(pe),we.value=le.cloneStructure(),ve.value=new TreeNode("MULT","MULT",re.line,[ue?ue.cloneStructure():le.cloneStructure(),ae.cloneStructure()]),ge.value=new TreeNode("DIV","DIV",re.line,[new TreeNode("["+he+"]","PRIMITIVE",re.line),ae.cloneStructure()]),ve.noOutput=!0,we.noOutput=!0,ge.noOutput=!0,ve.adoptUnits=!0,we.adoptUnits=!0,ge.adoptUnits=!0,ve.neighborProxyDNA=ee,we.neighborProxyDNA=ee,ge.neighborProxyDNA=ee,ne.DNAs.push(ve),ne.DNAs.push(we),ne.DNAs.push(ge),new TreeNode("["+ce+"]","PRIMITIVE",re.line)}},delay3:{replacement:(te,ee,re,ne,ie,se)=>{let{input:le,initialValue:ue,period:ae}=te,oe=new Model,he="__Delay3 Outflow "+macroCounter++,ce="__Delay3 Stock "+macroCounter++,pe="__Delay3 Stock "+macroCounter++,de="__Delay3 Stock "+macroCounter++,me=oe.Stock({name:ce,initial:"(iv) || (i)"});me._node.id=""+Math.random();let ve=oe.Stock({name:pe,initial:"(iv) || (i)"});ve._node.id=""+Math.random();let we=oe.Stock({name:de,initial:"(iv) || (i)"});we._node.id=""+Math.random();let ge=oe.Flow(null,me,{name:"Delay3 Inflow",rate:"(i)",nonNegative:!1});ge._node.id=""+Math.random();let _e=oe.Flow(me,ve,{name:"Delay3 Flow 1",rate:"(alpha) / (p/3)",nonNegative:!1});_e._node.id=""+Math.random();let Te=oe.Flow(ve,we,{name:"Delay3 Flow 2",rate:"(alpha) / (p/3)",nonNegative:!1});Te._node.id=""+Math.random();let Ne=oe.Flow(we,null,{name:he,rate:"(alpha) / (p/3)",nonNegative:!1});Ne._node.id=""+Math.random(),ae=new TreeNode("LINES","LINES",re.line,[new TreeNode("ASSIGN","ASSIGN",re.line,[new TreeNode("ASSIGNED","ASSIGNED",re.line,[new TreeNode("__tmp_macro_period","IDENT",re.line)]),new TreeNode("INNER","INNER",re.line,[new TreeNode("RemoveUnits","IDENT",re.line),new TreeNode("FUNCALL","FUNCALL",re.line,[ae,new TreeNode('"'+se.timeUnitsString+'"',"STRING",re.line)])])]),new TreeNode("INNER","INNER",re.line,[new TreeNode("Assert","IDENT",re.line),new TreeNode("FUNCALL","FUNCALL",re.line,[new TreeNode(">","GT",re.line,[new TreeNode("__tmp_macro_period","IDENT",re.line),new TreeNode("0","INTEGER",re.line)]),new TreeNode('"Period for Delay3() must be greater than 0."',"STRING",re.line)])]),new TreeNode("__tmp_macro_period","IDENT",re.line)]);let ye=new TreeNode("DIV","DIV",re.line,[ae,new TreeNode("3","INTEGER",re.line)]),Le=getDNA(me,ne,ie,se),xe=getDNA(ve,ne,ie,se),Oe=getDNA(we,ne,ie,se),Fe=getDNA(ge,ne,ie,se),De=getDNA(_e,ne,ie,se),Me=getDNA(Te,ne,ie,se),We=getDNA(Ne,ne,ie,se);De.extraLinksPrimitives.push(me),Me.extraLinksPrimitives.push(ve),We.extraLinksPrimitives.push(we),ee.extraLinksPrimitives.push(Ne),Fe.value=le.cloneStructure();let Ge=new TreeNode("MULT","MULT",re.line,[ue?ue.cloneStructure():le.cloneStructure(),ye.cloneStructure()]);return Le.value=Ge.cloneStructure(),xe.value=Ge.cloneStructure(),Oe.value=Ge.cloneStructure(),De.value=new TreeNode("DIV","DIV",re.line,[new TreeNode("["+ce+"]","PRIMITIVE",re.line),ye.cloneStructure()]),Me.value=new TreeNode("DIV","DIV",re.line,[new TreeNode("["+pe+"]","PRIMITIVE",re.line),ye.cloneStructure()]),We.value=new TreeNode("DIV","DIV",re.line,[new TreeNode("["+de+"]","PRIMITIVE",re.line),ye.cloneStructure()]),Le.noOutput=!0,xe.noOutput=!0,Oe.noOutput=!0,Fe.noOutput=!0,De.noOutput=!0,Me.noOutput=!0,We.noOutput=!0,Le.adoptUnits=!0,xe.adoptUnits=!0,Oe.adoptUnits=!0,Fe.adoptUnits=!0,De.adoptUnits=!0,Me.adoptUnits=!0,We.adoptUnits=!0,Le.neighborProxyDNA=ee,xe.neighborProxyDNA=ee,Oe.neighborProxyDNA=ee,Fe.neighborProxyDNA=ee,De.neighborProxyDNA=ee,Me.neighborProxyDNA=ee,We.neighborProxyDNA=ee,ne.DNAs.push(Le),ne.DNAs.push(xe),ne.DNAs.push(Oe),ne.DNAs.push(Fe),ne.DNAs.push(De),ne.DNAs.push(Me),ne.DNAs.push(We),new TreeNode("["+he+"]","PRIMITIVE",re.line)}}};function getMacroParameters(te,ee,re){if(te.length>3||te.length<2)throw new ModelError(`Wrong number of parameters for ${ee}().`,{code:10001});function ne(ie){if(ie.typeName==="IDENT"){for(let se of re)if(se.target===ie.text)return se.value.cloneStructure()}return ie.children=ie.children.map(se=>ne(se)),ie}return re.length&&(te=te.map(ie=>ne(ie))),{input:te[0],period:te[1],initialValue:te[2]}}const MACRO_FNS_NAMES=Object.keys(MACRO_FNS).filter(te=>!te.startsWith("_"));function replaceMacros(te,ee,re,ne,ie,se,le,ue=[]){let ae,oe;return re.typeName==="INNER"&&(re.children.length===2?re.children[0].typeName==="IDENT"&&MACRO_FNS_NAMES.includes(re.children[0].text)&&(ae=re.children[0].text,re.children[1].typeName==="FUNCALL"&&(oe=getMacroParameters(re.children[1].children.slice(),ae,ue))):re.children.length===3&&re.children[0].typeName==="PRIMITIVE"&&re.children[1].typeName==="SELECTOR"&&re.children[1].children[0].typeName==="DOTSELECTOR"&&MACRO_FNS_NAMES.includes(re.children[1].children[0].children[0].text)&&re.children[2].typeName==="FUNCALL"&&(ae=re.children[1].children[0].children[0].text,oe=getMacroParameters([re.children[0]].concat(re.children[2].children),ae,ue))),ae?le?MACRO_FNS._initial.replacement(oe,ee,re,ne,ie,se):MACRO_FNS[ae].replacement(oe,ee,re,ne,ie,se):(re.children=re.children.map(he=>replaceMacros(te,ee,he,ne,ie,se,le,ue)),re.typeName==="ASSIGN"&&re.children.length===2&&re.children[0].typeName==="ASSIGNED"&&re.children[0].children.length&&ue.push({target:re.children[0].children[0].text,value:re.children[1]}),re)}const nodeBase=Object.create(null),defaultSolver=JSON.stringify({enabled:!1,algorithm:"RK1",timeStep:1});let DI=typeof window>"u"?new DOMImplementation$1:document.implementation,doc=DI.createDocument("","",null);nodeBase.text=doc.createElement("Text");nodeBase.text.setAttribute("name","Text Area");nodeBase.text.setAttribute("LabelPosition","Middle");nodeBase.folder=doc.createElement("Folder");nodeBase.folder.setAttribute("name","New Folder");nodeBase.folder.setAttribute("Note","");nodeBase.folder.setAttribute("Type","None");nodeBase.folder.setAttribute("Solver",defaultSolver);nodeBase.folder.setAttribute("Image","None");nodeBase.folder.setAttribute("FlipHorizontal","false");nodeBase.folder.setAttribute("FlipVertical","false");nodeBase.folder.setAttribute("LabelPosition","Middle");nodeBase.folder.setAttribute("AgentBase","");nodeBase.ghost=doc.createElement("Ghost");nodeBase.ghost.setAttribute("Source","");nodeBase.picture=doc.createElement("Picture");nodeBase.picture.setAttribute("name","");nodeBase.picture.setAttribute("Note","");nodeBase.picture.setAttribute("Image","Growth");nodeBase.picture.setAttribute("FlipHorizontal","false");nodeBase.picture.setAttribute("FlipVertical","false");nodeBase.picture.setAttribute("LabelPosition","Bottom");nodeBase.display=doc.createElement("Display");nodeBase.display.setAttribute("name","Default Display");nodeBase.display.setAttribute("Note","");nodeBase.display.setAttribute("Type","Time Series");nodeBase.display.setAttribute("xAxis","Time (%u)");nodeBase.display.setAttribute("yAxis","");nodeBase.display.setAttribute("yAxis2","");nodeBase.display.setAttribute("showMarkers","false");nodeBase.display.setAttribute("showLines","true");nodeBase.display.setAttribute("showArea","false");nodeBase.display.setAttribute("Primitives","");nodeBase.display.setAttribute("Primitives2","");nodeBase.display.setAttribute("AutoAddPrimitives","false");nodeBase.display.setAttribute("ScatterplotOrder","X Primitive, Y Primitive");nodeBase.display.setAttribute("Image","Display");nodeBase.display.setAttribute("FlipHorizontal","false");nodeBase.display.setAttribute("FlipVertical","false");nodeBase.display.setAttribute("LabelPosition","Bottom");function setValuedProperties(te){te.setAttribute("Units","Unitless"),te.setAttribute("MaxConstraintUsed","false"),te.setAttribute("MinConstraintUsed","false"),te.setAttribute("MaxConstraint","100"),te.setAttribute("MinConstraint","0"),te.setAttribute("ShowSlider","false"),te.setAttribute("SliderMax",100),te.setAttribute("SliderMin",0),te.setAttribute("SliderStep","")}nodeBase.stock=doc.createElement("Stock");nodeBase.stock.setAttribute("name","New Stock");nodeBase.stock.setAttribute("Note","");nodeBase.stock.setAttribute("InitialValue","0");nodeBase.stock.setAttribute("StockMode","Store");nodeBase.stock.setAttribute("Delay","10");nodeBase.stock.setAttribute("Volume","100");nodeBase.stock.setAttribute("NonNegative","false");setValuedProperties(nodeBase.stock);nodeBase.stock.setAttribute("Image","None");nodeBase.stock.setAttribute("FlipHorizontal","false");nodeBase.stock.setAttribute("FlipVertical","false");nodeBase.stock.setAttribute("LabelPosition","Middle");nodeBase.state=doc.createElement("State");nodeBase.state.setAttribute("name","New State");nodeBase.state.setAttribute("Note","");nodeBase.state.setAttribute("Active","false");nodeBase.state.setAttribute("Residency","0");nodeBase.state.setAttribute("Image","None");nodeBase.state.setAttribute("FlipHorizontal","false");nodeBase.state.setAttribute("FlipVertical","false");nodeBase.state.setAttribute("LabelPosition","Middle");nodeBase.transition=doc.createElement("Transition");nodeBase.transition.setAttribute("name","Transition");nodeBase.transition.setAttribute("Note","");nodeBase.transition.setAttribute("Trigger","Timeout");nodeBase.transition.setAttribute("Value","1");nodeBase.transition.setAttribute("Repeat","false");nodeBase.transition.setAttribute("Recalculate","false");setValuedProperties(nodeBase.transition);nodeBase.action=doc.createElement("Action");nodeBase.action.setAttribute("name","New Action");nodeBase.action.setAttribute("Note","");nodeBase.action.setAttribute("Trigger","Probability");nodeBase.action.setAttribute("Value","0.5");nodeBase.action.setAttribute("Repeat","true");nodeBase.action.setAttribute("Recalculate","false");nodeBase.action.setAttribute("Action","Self.Move({Rand(), Rand()})");nodeBase.agents=doc.createElement("Agents");nodeBase.agents.setAttribute("name","New Agent Population");nodeBase.agents.setAttribute("Note","");nodeBase.agents.setAttribute("Size","100");nodeBase.agents.setAttribute("GeoWrap","false");nodeBase.agents.setAttribute("GeoDimUnits","Unitless");nodeBase.agents.setAttribute("GeoWidth","200");nodeBase.agents.setAttribute("GeoHeight","100");nodeBase.agents.setAttribute("Placement","Random");nodeBase.agents.setAttribute("PlacementFunction","{Rand()*Width(Self), Rand()*Height(Self)}");nodeBase.agents.setAttribute("Network","None");nodeBase.agents.setAttribute("NetworkFunction","RandBoolean(0.02)");nodeBase.agents.setAttribute("Agent","");nodeBase.agents.setAttribute("Image","None");nodeBase.agents.setAttribute("FlipHorizontal","false");nodeBase.agents.setAttribute("FlipVertical","false");nodeBase.agents.setAttribute("LabelPosition","Middle");nodeBase.agents.setAttribute("ShowSlider","false");nodeBase.agents.setAttribute("SliderMax","100");nodeBase.agents.setAttribute("SliderMin","0");nodeBase.agents.setAttribute("SliderStep","1");nodeBase.variable=doc.createElement("Variable");nodeBase.variable.setAttribute("name","New Variable");nodeBase.variable.setAttribute("Note","");nodeBase.variable.setAttribute("Equation","0");setValuedProperties(nodeBase.variable);nodeBase.variable.setAttribute("Image","None");nodeBase.variable.setAttribute("FlipHorizontal","false");nodeBase.variable.setAttribute("FlipVertical","false");nodeBase.variable.setAttribute("LabelPosition","Middle");nodeBase.button=doc.createElement("Button");nodeBase.button.setAttribute("name","New Button");nodeBase.button.setAttribute("Note","");nodeBase.button.setAttribute("Function",'showMessage("Button action triggered!\\n\\nIf you want to edit this Action, click on the button while holding down the Shift key on your keyboard.")');nodeBase.button.setAttribute("Image","None");nodeBase.button.setAttribute("FlipHorizontal","false");nodeBase.button.setAttribute("FlipVertical","false");nodeBase.button.setAttribute("LabelPosition","Middle");nodeBase.converter=doc.createElement("Converter");nodeBase.converter.setAttribute("name","New Converter");nodeBase.converter.setAttribute("Note","");nodeBase.converter.setAttribute("Source","Time");nodeBase.converter.setAttribute("Data","0,0; 1,1; 2,4; 3,9");nodeBase.converter.setAttribute("Interpolation","Linear");setValuedProperties(nodeBase.converter);nodeBase.converter.setAttribute("Image","None");nodeBase.converter.setAttribute("FlipHorizontal","false");nodeBase.converter.setAttribute("FlipVertical","false");nodeBase.converter.setAttribute("LabelPosition","Middle");nodeBase.flow=doc.createElement("Flow");nodeBase.flow.setAttribute("name","Flow");nodeBase.flow.setAttribute("Note","");nodeBase.flow.setAttribute("FlowRate","0");nodeBase.flow.setAttribute("OnlyPositive","true");nodeBase.flow.setAttribute("TimeIndependent","false");setValuedProperties(nodeBase.flow);nodeBase.link=doc.createElement("Link");nodeBase.link.setAttribute("name","Link");nodeBase.link.setAttribute("Note","");nodeBase.link.setAttribute("BiDirectional","false");nodeBase.setting=doc.createElement("Setting");nodeBase.setting.setAttribute("Note","");nodeBase.setting.setAttribute("Version","37");nodeBase.setting.setAttribute("Throttle","1");nodeBase.setting.setAttribute("TimeLength","100");nodeBase.setting.setAttribute("TimeStart","0");nodeBase.setting.setAttribute("TimeStep","1");nodeBase.setting.setAttribute("TimeUnits","Years");nodeBase.setting.setAttribute("Units","");nodeBase.setting.setAttribute("SolutionAlgorithm","RK1");nodeBase.setting.setAttribute("BackgroundColor","white");nodeBase.setting.setAttribute("Macros","");nodeBase.setting.setAttribute("SensitivityPrimitives","");nodeBase.setting.setAttribute("SensitivityRuns","50");nodeBase.setting.setAttribute("SensitivityBounds","50, 80, 95, 100");nodeBase.setting.setAttribute("SensitivityShowRuns","false");nodeBase.setting.setAttribute("StyleSheet","{}");class Results{constructor(ee,re){this._data=ee,this._nameIdMapping=re,this.timeUnits=ee.timeUnits;for(let ne=0;ne<this._data.data.length;ne++){let ie=this._data.data[ne];for(let se in ie)ie[se]=simplifyResults(ie[se])}}times(){return this._data.times.slice()}table(ee){if(ee){let re=ee.map(se=>({primitive:se,series:this.series(se)})),ne=this.times(),ie=[];for(let se=0;se<ne.length;se++){let le={_time:ne[se]};for(let ue of re)le[ue.primitive.name]=ue.series[se];ie.push(le)}return ie}else{let re=[];for(let ne=0;ne<this._data.data.length;ne++){let ie={};ie._time=this._data.times[ne];let se=this._data.data[ne];for(let le in se)ie[this._nameIdMapping[le]]=se[le];re.push(ie)}return re}}series(ee){return this._data.value(ee._node).slice()}value(ee,re=null){let ne=this.series(ee);if(re===null)return ne[ne.length-1];let ie=this.times(),se=ie.indexOf(re);if(se===-1)throw new Error("Could not find time: "+re+". Available options are: "+JSON.stringify(ie));return ne[se]}}function simplifyResults(te){if(te instanceof Vector)if(te.names){let ee={};for(let re=0;re<te.names.length;re++)ee[te.names[re]]=simplifyResults(te.items[re]);return ee}else return te.items.map(simplifyResults);return te}class SimulationError extends Error{constructor(ee,re){super(ee),Error.captureStackTrace&&Error.captureStackTrace(this,SimulationError),this.name="SimulationError",this.primitive=re.primitive,this.code=re.code,Object.defineProperty(this,"code",{enumerable:!1}),Object.defineProperty(this,"primitive",{enumerable:!1})}}class Model{constructor(ee={}){this._graph=new ModelNode,this._graph.id="1",this._graph.addChild(new ModelNode),this._graph.children[0].addChild(new ModelNode),this.settings=this._createNode("setting"),this.p=ee.primitiveFn||primitives;for(let re in excludeKeys(ee,["primitiveFn"]))if(re in this)this[re]=ee[re];else throw new Error("Unknown model property: "+re)}_createNode(ee){let re=this._graph.children[0].children[0],ne=modelNodeClone(nodeBase[ee],re);return re.addChild(ne),ne}_createConnector(ee,re,ne){let ie=this._graph.children[0].children[0];re&&(ie=re._node.parent),ne&&(ie=ne._node.parent);let se=modelNodeClone(nodeBase[ee],ie);return ie.addChild(se),re?se.source=re._node:se.source=null,ne?se.target=ne._node:se.target=null,se}simulate(){let re=runSimulation({silent:!0,model:this});if(re.error){let se={code:re.errorCode};throw re.errorPrimitive&&(se.primitive=this.get(le=>le.id===re.errorPrimitive.id)),new SimulationError(re.error,se)}let ne=this.find(),ie={};for(let se of ne)ie[se.id]=se.name;return new Results(re,ie)}Stock(ee={}){let re=this._createNode("stock").primitive(this,excludeKeys(ee,["name"]));return re.name=ee.name||"New Stock",re.model=this,re}Variable(ee={}){let re=this._createNode("variable").primitive(this,excludeKeys(ee,["name"]));return re.name=ee.name||"New Variable",re.model=this,re}Converter(ee={}){let re=this._createNode("converter").primitive(this,excludeKeys(ee,["name"]));return re.name=ee.name||"New Converter",re.model=this,re}State(ee={}){let re=this._createNode("state").primitive(this,excludeKeys(ee,["name"]));return re.name=ee.name||"New State",re.model=this,re}Action(ee={}){let re=this._createNode("action").primitive(this,excludeKeys(ee,["name"]));return re.name=ee.name||"New Action",re.model=this,re}Population(ee={}){let re=this._createNode("agents").primitive(this,excludeKeys(ee,["name"]));return re.name=ee.name||"New Population",re.model=this,re}Flow(ee,re,ne={}){let ie=this._createConnector("flow",ee||ne.start||null,re||ne.end||null).primitive(this,excludeKeys(ne,["name","start","end"]));return ie.name=ne.name||"New Flow",ie.model=this,ie}Transition(ee,re,ne={}){let ie=this._createConnector("transition",ee||ne.start||null,re||ne.end||null).primitive(this,excludeKeys(ne,["name","start","end"]));return ie.name=ne.name||"New Transition",ie.model=this,ie}Link(ee,re,ne={}){let ie=this._createConnector("link",ee||ne.start||null,re||ne.end||null).primitive(this,excludeKeys(ne,["name","start","end"]));return ie.name=ne.name||"Link",ie.model=this,ie}Agent(ee={}){let re=this._createNode("folder");re.setAttribute("Type","Agent");let ne=re.primitive(this,excludeKeys(ee,["name"]));return ne.name=ee.name||"New Agent",ne.model=this,ne}Folder(ee={}){let re=this._createNode("folder").primitive(this,excludeKeys(ee,["name"]));return re.name=ee.name||"New Folder",re.model=this,re._node.setAttribute("Type","None"),re}getId(ee){return this.get(re=>re.id===ee)}get(ee){let ne=this.p(this._graph).find(ie=>ie.primitive()&&ee(ie.primitive()));return ne?ne.primitive():null}getLink(ee){let ne=this.p(this._graph,"Link").find(ie=>ee(ie.primitive()));return ne?ne.primitive():null}getFlow(ee){let ne=this.p(this._graph,"Flow").find(ie=>ee(ie.primitive()));return ne?ne.primitive():null}getTransition(ee){let ne=this.p(this._graph,"Transition").find(ie=>ee(ie.primitive()));return ne?ne.primitive():null}getStock(ee){let ne=this.p(this._graph,"Stock").find(ie=>ee(ie.primitive()));return ne?ne.primitive():null}getVariable(ee){let ne=this.p(this._graph,"Variable").find(ie=>ee(ie.primitive()));return ne?ne.primitive():null}getConverter(ee){let ne=this.p(this._graph,"Converter").find(ie=>ee(ie.primitive()));return ne?ne.primitive():null}getState(ee){let ne=this.p(this._graph,"State").find(ie=>ee(ie.primitive()));return ne?ne.primitive():null}getAction(ee){let ne=this.p(this._graph,"Action").find(ie=>ee(ie.primitive()));return ne?ne.primitive():null}getPopulation(ee){let ne=this.p(this._graph,"Agents").find(ie=>ee(ie.primitive()));return ne?ne.primitive():null}getFolder(ee){let ne=this.p(this._graph,"Folder").filter(ie=>ie.getAttribute("Type")!=="Agent").find(ie=>ee(ie.primitive()));return ne?ne.primitive():null}getAgent(ee){let ne=this.p(this._graph,"Folder").filter(ie=>ie.getAttribute("Type")==="Agent").find(ie=>ee(ie.primitive()));return ne?ne.primitive():null}find(ee=()=>!0){return this.p(this._graph).filter(ne=>ne.primitive()&&ee(ne.primitive())).map(ne=>ne.primitive())}findLinks(ee=()=>!0){return this.p(this._graph,"Link").filter(ne=>ee(ne.primitive())).map(ne=>ne.primitive())}findFlows(ee=()=>!0){return this.p(this._graph,"Flow").filter(ne=>ee(ne.primitive())).map(ne=>ne.primitive())}findTransitions(ee=()=>!0){return this.p(this._graph,"Transition").filter(ne=>ee(ne.primitive())).map(ne=>ne.primitive())}findStocks(ee=()=>!0){return this.p(this._graph,"Stock").filter(ne=>ee(ne.primitive())).map(ne=>ne.primitive())}findVariables(ee=()=>!0){return this.p(this._graph,"Variable").filter(ne=>ee(ne.primitive())).map(ne=>ne.primitive())}findConverters(ee=()=>!0){return this.p(this._graph,"Converter").filter(ne=>ee(ne.primitive())).map(ne=>ne.primitive())}findStates(ee=()=>!0){return this.p(this._graph,"State").filter(ne=>ee(ne.primitive())).map(ne=>ne.primitive())}findActions(ee=()=>!0){return this.p(this._graph,"Action").filter(ne=>ee(ne.primitive())).map(ne=>ne.primitive())}findPopulations(ee=()=>!0){return this.p(this._graph,"Agents").filter(ne=>ee(ne.primitive())).map(ne=>ne.primitive())}findFolders(ee=()=>!0){return this.p(this._graph,"Folder").filter(ne=>ne.getAttribute("Type")!=="Agent").filter(ne=>ee(ne.primitive())).map(ne=>ne.primitive())}findAgents(ee=()=>!0){return this.p(this._graph,"Folder").filter(ne=>ne.getAttribute("Type")==="Agent").filter(ne=>ee(ne.primitive())).map(ne=>ne.primitive())}get timeStart(){return+this.settings.getAttribute("TimeStart")}set timeStart(ee){this.settings.setAttribute("TimeStart",ee)}get timeLength(){return+this.settings.getAttribute("TimeLength")}set timeLength(ee){this.settings.setAttribute("TimeLength",ee)}get timePause(){return+this.settings.getAttribute("TimePause")}set timePause(ee){this.settings.setAttribute("TimePause",ee)}get timeStep(){return+this.settings.getAttribute("TimeStep")}set timeStep(ee){this.settings.setAttribute("TimeStep",ee)}get timeUnits(){return this.settings.getAttribute("TimeUnits")}set timeUnits(ee){this.settings.setAttribute("TimeUnits",ee)}get algorithm(){let ee=this.settings.getAttribute("SolutionAlgorithm");return ee==="RK1"?"Euler":ee}set algorithm(ee){let re;ee==="Euler"?re="RK1":re=ee,this.settings.setAttribute("SolutionAlgorithm",re)}get globals(){return this.settings.getAttribute("Macros")||""}set globals(ee){this.settings.setAttribute("Macros",ee)}get customUnits(){return(this.settings.getAttribute("Units")||"").split(`
`).filter(ee=>!!ee).map(ee=>{let re=ee.split("<>");return{name:re[0],scale:+re[1],target:re[2]}})}set customUnits(ee){this.settings.setAttribute("Units",ee.map(re=>re.name+"<>"+re.scale+"<>"+re.target).join(`
`))}}function excludeKeys(te,ee){let re={};for(let ne in te)ee.includes(ne)||(re[ne]=te[ne]);return re}export{A$2 as A,createClient as B,Cn as C,D$1 as D,F$1 as F,G$1 as G,Model as M,O,Provider as P,React as R,T$1 as T,_extends$1 as _,an as a,_ as b,y$2 as c,k$5 as d,_objectWithoutPropertiesLoose as e,pn as f,getAugmentedNamespace as g,h$3 as h,_toPropertyKey as i,hoistNonReactStatics$1 as j,k$2 as k,l$4 as l,connect as m,createStore as n,b$3 as o,p$3 as p,q$4 as q,FlexSearch as r,sn as s,fuzzysort as t,commonjsGlobal as u,commonjsRequire as v,getDefaultExportFromCjs as w,x$1 as x,y$1 as y,z$1 as z};
