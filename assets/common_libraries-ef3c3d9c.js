var n$4,l$4,u$4,i$1,o$1,r$4,f$3,e$4,c$3={},s$1=[],a$1=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,h$5=Array.isArray;function v$4(te,ee){for(var re in ee)te[re]=ee[re];return te}function p$5(te){var ee=te.parentNode;ee&&ee.removeChild(te)}function y$2(te,ee,re){var ne,ie,se,le={};for(se in ee)se=="key"?ne=ee[se]:se=="ref"?ie=ee[se]:le[se]=ee[se];if(arguments.length>2&&(le.children=arguments.length>3?n$4.call(arguments,2):re),typeof te=="function"&&te.defaultProps!=null)for(se in te.defaultProps)le[se]===void 0&&(le[se]=te.defaultProps[se]);return d$3(te,le,ne,ie,null)}function d$3(te,ee,re,ne,ie){var se={type:te,props:ee,key:re,ref:ne,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:ie??++u$4};return ie==null&&l$4.vnode!=null&&l$4.vnode(se),se}function _$1(){return{current:null}}function k$5(te){return te.children}function b$3(te,ee){this.props=te,this.context=ee}function g$4(te,ee){if(ee==null)return te.__?g$4(te.__,te.__.__k.indexOf(te)+1):null;for(var re;ee<te.__k.length;ee++)if((re=te.__k[ee])!=null&&re.__e!=null)return re.__e;return typeof te.type=="function"?g$4(te):null}function m$4(te){var ee,re;if((te=te.__)!=null&&te.__c!=null){for(te.__e=te.__c.base=null,ee=0;ee<te.__k.length;ee++)if((re=te.__k[ee])!=null&&re.__e!=null){te.__e=te.__c.base=re.__e;break}return m$4(te)}}function w$4(te){(!te.__d&&(te.__d=!0)&&i$1.push(te)&&!x$3.__r++||o$1!==l$4.debounceRendering)&&((o$1=l$4.debounceRendering)||r$4)(x$3)}function x$3(){var te,ee,re,ne,ie,se,le,ue,ae;for(i$1.sort(f$3);te=i$1.shift();)te.__d&&(ee=i$1.length,ne=void 0,ie=void 0,se=void 0,ue=(le=(re=te).__v).__e,(ae=re.__P)&&(ne=[],ie=[],(se=v$4({},le)).__v=le.__v+1,L$1(ae,le,se,re.__n,ae.ownerSVGElement!==void 0,le.__h!=null?[ue]:null,ne,ue??g$4(le),le.__h,ie),M$1(ne,le,ie),le.__e!=ue&&m$4(le)),i$1.length>ee&&i$1.sort(f$3));x$3.__r=0}function P$3(te,ee,re,ne,ie,se,le,ue,ae,oe,ce){var he,pe,de,me,ge,we,ve,_e,Te,ye,be=0,Fe=ne&&ne.__k||s$1,Le=Fe.length,Oe=Le,Se=ee.length;for(re.__k=[],he=0;he<Se;he++)(me=re.__k[he]=(me=ee[he])==null||typeof me=="boolean"||typeof me=="function"?null:typeof me=="string"||typeof me=="number"||typeof me=="bigint"?d$3(null,me,null,null,me):h$5(me)?d$3(k$5,{children:me},null,null,null):me.__b>0?d$3(me.type,me.props,me.key,me.ref?me.ref:null,me.__v):me)!=null&&(me.__=re,me.__b=re.__b+1,(_e=A$3(me,Fe,ve=he+be,Oe))===-1?de=c$3:(de=Fe[_e]||c$3,Fe[_e]=void 0,Oe--),L$1(te,me,de,ie,se,le,ue,ae,oe,ce),ge=me.__e,(pe=me.ref)&&de.ref!=pe&&(de.ref&&O$1(de.ref,null,me),ce.push(pe,me.__c||ge,me)),ge!=null&&(we==null&&(we=ge),ye=!(Te=de===c$3||de.__v===null)&&_e===ve,Te?_e==-1&&be--:_e!==ve&&(_e===ve+1?(be++,ye=!0):_e>ve?Oe>Se-ve?(be+=_e-ve,ye=!0):be--:be=_e<ve&&_e==ve-1?_e-ve:0),ve=he+be,ye=ye||_e==he&&!Te,typeof me.type!="function"||_e===ve&&de.__k!==me.__k?typeof me.type=="function"||ye?me.__d!==void 0?(ae=me.__d,me.__d=void 0):ae=ge.nextSibling:ae=$$1(te,ge,ae):ae=C$1(me,ae,te),typeof re.type=="function"&&(re.__d=ae)));for(re.__e=we,he=Le;he--;)Fe[he]!=null&&(typeof re.type=="function"&&Fe[he].__e!=null&&Fe[he].__e==re.__d&&(re.__d=Fe[he].__e.nextSibling),q$6(Fe[he],Fe[he]))}function C$1(te,ee,re){for(var ne,ie=te.__k,se=0;ie&&se<ie.length;se++)(ne=ie[se])&&(ne.__=te,ee=typeof ne.type=="function"?C$1(ne,ee,re):$$1(re,ne.__e,ee));return ee}function S(te,ee){return ee=ee||[],te==null||typeof te=="boolean"||(h$5(te)?te.some(function(re){S(re,ee)}):ee.push(te)),ee}function $$1(te,ee,re){return re==null||re.parentNode!==te?te.insertBefore(ee,null):ee==re&&ee.parentNode!=null||te.insertBefore(ee,re),ee.nextSibling}function A$3(te,ee,re,ne){var ie=te.key,se=te.type,le=re-1,ue=re+1,ae=ee[re];if(ae===null||ae&&ie==ae.key&&se===ae.type)return re;if(ne>(ae!=null?1:0))for(;le>=0||ue<ee.length;){if(le>=0){if((ae=ee[le])&&ie==ae.key&&se===ae.type)return le;le--}if(ue<ee.length){if((ae=ee[ue])&&ie==ae.key&&se===ae.type)return ue;ue++}}return-1}function H$1(te,ee,re,ne,ie){var se;for(se in re)se==="children"||se==="key"||se in ee||T$2(te,se,null,re[se],ne);for(se in ee)ie&&typeof ee[se]!="function"||se==="children"||se==="key"||se==="value"||se==="checked"||re[se]===ee[se]||T$2(te,se,ee[se],re[se],ne)}function I$1(te,ee,re){ee[0]==="-"?te.setProperty(ee,re??""):te[ee]=re==null?"":typeof re!="number"||a$1.test(ee)?re:re+"px"}function T$2(te,ee,re,ne,ie){var se;e:if(ee==="style")if(typeof re=="string")te.style.cssText=re;else{if(typeof ne=="string"&&(te.style.cssText=ne=""),ne)for(ee in ne)re&&ee in re||I$1(te.style,ee,"");if(re)for(ee in re)ne&&re[ee]===ne[ee]||I$1(te.style,ee,re[ee])}else if(ee[0]==="o"&&ee[1]==="n")se=ee!==(ee=ee.replace(/Capture$/,"")),ee=ee.toLowerCase()in te?ee.toLowerCase().slice(2):ee.slice(2),te.l||(te.l={}),te.l[ee+se]=re,re?ne||te.addEventListener(ee,se?z$3:j$2,se):te.removeEventListener(ee,se?z$3:j$2,se);else if(ee!=="dangerouslySetInnerHTML"){if(ie)ee=ee.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(ee!=="width"&&ee!=="height"&&ee!=="href"&&ee!=="list"&&ee!=="form"&&ee!=="tabIndex"&&ee!=="download"&&ee!=="rowSpan"&&ee!=="colSpan"&&ee in te)try{te[ee]=re??"";break e}catch{}typeof re=="function"||(re==null||re===!1&&ee[4]!=="-"?te.removeAttribute(ee):te.setAttribute(ee,re))}}function j$2(te){return this.l[te.type+!1](l$4.event?l$4.event(te):te)}function z$3(te){return this.l[te.type+!0](l$4.event?l$4.event(te):te)}function L$1(te,ee,re,ne,ie,se,le,ue,ae,oe){var ce,he,pe,de,me,ge,we,ve,_e,Te,ye,be,Fe,Le,Oe,Se=ee.type;if(ee.constructor!==void 0)return null;re.__h!=null&&(ae=re.__h,ue=ee.__e=re.__e,ee.__h=null,se=[ue]),(ce=l$4.__b)&&ce(ee);try{e:if(typeof Se=="function"){if(ve=ee.props,_e=(ce=Se.contextType)&&ne[ce.__c],Te=ce?_e?_e.props.value:ce.__:ne,re.__c?we=(he=ee.__c=re.__c).__=he.__E:("prototype"in Se&&Se.prototype.render?ee.__c=he=new Se(ve,Te):(ee.__c=he=new b$3(ve,Te),he.constructor=Se,he.render=B$2),_e&&_e.sub(he),he.props=ve,he.state||(he.state={}),he.context=Te,he.__n=ne,pe=he.__d=!0,he.__h=[],he._sb=[]),he.__s==null&&(he.__s=he.state),Se.getDerivedStateFromProps!=null&&(he.__s==he.state&&(he.__s=v$4({},he.__s)),v$4(he.__s,Se.getDerivedStateFromProps(ve,he.__s))),de=he.props,me=he.state,he.__v=ee,pe)Se.getDerivedStateFromProps==null&&he.componentWillMount!=null&&he.componentWillMount(),he.componentDidMount!=null&&he.__h.push(he.componentDidMount);else{if(Se.getDerivedStateFromProps==null&&ve!==de&&he.componentWillReceiveProps!=null&&he.componentWillReceiveProps(ve,Te),!he.__e&&(he.shouldComponentUpdate!=null&&he.shouldComponentUpdate(ve,he.__s,Te)===!1||ee.__v===re.__v)){for(ee.__v!==re.__v&&(he.props=ve,he.state=he.__s,he.__d=!1),ee.__e=re.__e,ee.__k=re.__k,ee.__k.forEach(function(De){De&&(De.__=ee)}),ye=0;ye<he._sb.length;ye++)he.__h.push(he._sb[ye]);he._sb=[],he.__h.length&&le.push(he);break e}he.componentWillUpdate!=null&&he.componentWillUpdate(ve,he.__s,Te),he.componentDidUpdate!=null&&he.__h.push(function(){he.componentDidUpdate(de,me,ge)})}if(he.context=Te,he.props=ve,he.__P=te,he.__e=!1,be=l$4.__r,Fe=0,"prototype"in Se&&Se.prototype.render){for(he.state=he.__s,he.__d=!1,be&&be(ee),ce=he.render(he.props,he.state,he.context),Le=0;Le<he._sb.length;Le++)he.__h.push(he._sb[Le]);he._sb=[]}else do he.__d=!1,be&&be(ee),ce=he.render(he.props,he.state,he.context),he.state=he.__s;while(he.__d&&++Fe<25);he.state=he.__s,he.getChildContext!=null&&(ne=v$4(v$4({},ne),he.getChildContext())),pe||he.getSnapshotBeforeUpdate==null||(ge=he.getSnapshotBeforeUpdate(de,me)),P$3(te,h$5(Oe=ce!=null&&ce.type===k$5&&ce.key==null?ce.props.children:ce)?Oe:[Oe],ee,re,ne,ie,se,le,ue,ae,oe),he.base=ee.__e,ee.__h=null,he.__h.length&&le.push(he),we&&(he.__E=he.__=null)}else se==null&&ee.__v===re.__v?(ee.__k=re.__k,ee.__e=re.__e):ee.__e=N$1(re.__e,ee,re,ne,ie,se,le,ae,oe);(ce=l$4.diffed)&&ce(ee)}catch(De){ee.__v=null,(ae||se!=null)&&(ee.__e=ue,ee.__h=!!ae,se[se.indexOf(ue)]=null),l$4.__e(De,ee,re)}}function M$1(te,ee,re){for(var ne=0;ne<re.length;ne++)O$1(re[ne],re[++ne],re[++ne]);l$4.__c&&l$4.__c(ee,te),te.some(function(ie){try{te=ie.__h,ie.__h=[],te.some(function(se){se.call(ie)})}catch(se){l$4.__e(se,ie.__v)}})}function N$1(te,ee,re,ne,ie,se,le,ue,ae){var oe,ce,he,pe=re.props,de=ee.props,me=ee.type,ge=0;if(me==="svg"&&(ie=!0),se!=null){for(;ge<se.length;ge++)if((oe=se[ge])&&"setAttribute"in oe==!!me&&(me?oe.localName===me:oe.nodeType===3)){te=oe,se[ge]=null;break}}if(te==null){if(me===null)return document.createTextNode(de);te=ie?document.createElementNS("http://www.w3.org/2000/svg",me):document.createElement(me,de.is&&de),se=null,ue=!1}if(me===null)pe===de||ue&&te.data===de||(te.data=de);else{if(se=se&&n$4.call(te.childNodes),ce=(pe=re.props||c$3).dangerouslySetInnerHTML,he=de.dangerouslySetInnerHTML,!ue){if(se!=null)for(pe={},ge=0;ge<te.attributes.length;ge++)pe[te.attributes[ge].name]=te.attributes[ge].value;(he||ce)&&(he&&(ce&&he.__html==ce.__html||he.__html===te.innerHTML)||(te.innerHTML=he&&he.__html||""))}if(H$1(te,de,pe,ie,ue),he)ee.__k=[];else if(P$3(te,h$5(ge=ee.props.children)?ge:[ge],ee,re,ne,ie&&me!=="foreignObject",se,le,se?se[0]:re.__k&&g$4(re,0),ue,ae),se!=null)for(ge=se.length;ge--;)se[ge]!=null&&p$5(se[ge]);ue||("value"in de&&(ge=de.value)!==void 0&&(ge!==te.value||me==="progress"&&!ge||me==="option"&&ge!==pe.value)&&T$2(te,"value",ge,pe.value,!1),"checked"in de&&(ge=de.checked)!==void 0&&ge!==te.checked&&T$2(te,"checked",ge,pe.checked,!1))}return te}function O$1(te,ee,re){try{typeof te=="function"?te(ee):te.current=ee}catch(ne){l$4.__e(ne,re)}}function q$6(te,ee,re){var ne,ie;if(l$4.unmount&&l$4.unmount(te),(ne=te.ref)&&(ne.current&&ne.current!==te.__e||O$1(ne,null,ee)),(ne=te.__c)!=null){if(ne.componentWillUnmount)try{ne.componentWillUnmount()}catch(se){l$4.__e(se,ee)}ne.base=ne.__P=null,te.__c=void 0}if(ne=te.__k)for(ie=0;ie<ne.length;ie++)ne[ie]&&q$6(ne[ie],ee,re||typeof te.type!="function");re||te.__e==null||p$5(te.__e),te.__=te.__e=te.__d=void 0}function B$2(te,ee,re){return this.constructor(te,re)}function D$1(te,ee,re){var ne,ie,se,le;l$4.__&&l$4.__(te,ee),ie=(ne=typeof re=="function")?null:re&&re.__k||ee.__k,se=[],le=[],L$1(ee,te=(!ne&&re||ee).__k=y$2(k$5,null,[te]),ie||c$3,c$3,ee.ownerSVGElement!==void 0,!ne&&re?[re]:ie?null:ee.firstChild?n$4.call(ee.childNodes):null,se,!ne&&re?re:ie?ie.__e:ee.firstChild,ne,le),M$1(se,te,le)}function E$1(te,ee){D$1(te,ee,E$1)}function F$2(te,ee,re){var ne,ie,se,le,ue=v$4({},te.props);for(se in te.type&&te.type.defaultProps&&(le=te.type.defaultProps),ee)se=="key"?ne=ee[se]:se=="ref"?ie=ee[se]:ue[se]=ee[se]===void 0&&le!==void 0?le[se]:ee[se];return arguments.length>2&&(ue.children=arguments.length>3?n$4.call(arguments,2):re),d$3(te.type,ue,ne||te.key,ie||te.ref,null)}function G$1(te,ee){var re={__c:ee="__cC"+e$4++,__:te,Consumer:function(ne,ie){return ne.children(ie)},Provider:function(ne){var ie,se;return this.getChildContext||(ie=[],(se={})[ee]=this,this.getChildContext=function(){return se},this.shouldComponentUpdate=function(le){this.props.value!==le.value&&ie.some(function(ue){ue.__e=!0,w$4(ue)})},this.sub=function(le){ie.push(le);var ue=le.componentWillUnmount;le.componentWillUnmount=function(){ie.splice(ie.indexOf(le),1),ue&&ue.call(le)}}),ne.children}};return re.Provider.__=re.Consumer.contextType=re}n$4=s$1.slice,l$4={__e:function(te,ee,re,ne){for(var ie,se,le;ee=ee.__;)if((ie=ee.__c)&&!ie.__)try{if((se=ie.constructor)&&se.getDerivedStateFromError!=null&&(ie.setState(se.getDerivedStateFromError(te)),le=ie.__d),ie.componentDidCatch!=null&&(ie.componentDidCatch(te,ne||{}),le=ie.__d),le)return ie.__E=ie}catch(ue){te=ue}throw te}},u$4=0,b$3.prototype.setState=function(te,ee){var re;re=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=v$4({},this.state),typeof te=="function"&&(te=te(v$4({},re),this.props)),te&&v$4(re,te),te!=null&&this.__v&&(ee&&this._sb.push(ee),w$4(this))},b$3.prototype.forceUpdate=function(te){this.__v&&(this.__e=!0,te&&this.__h.push(te),w$4(this))},b$3.prototype.render=k$5,i$1=[],r$4=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,f$3=function(te,ee){return te.__v.__b-ee.__v.__b},x$3.__r=0,e$4=0;var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(te){return te&&te.__esModule&&Object.prototype.hasOwnProperty.call(te,"default")?te.default:te}function getAugmentedNamespace(te){if(te.__esModule)return te;var ee=te.default;if(typeof ee=="function"){var re=function ne(){if(this instanceof ne){var ie=[null];ie.push.apply(ie,arguments);var se=Function.bind.apply(ee,ie);return new se}return ee.apply(this,arguments)};re.prototype=ee.prototype}else re={};return Object.defineProperty(re,"__esModule",{value:!0}),Object.keys(te).forEach(function(ne){var ie=Object.getOwnPropertyDescriptor(te,ne);Object.defineProperty(re,ne,ie.get?ie:{enumerable:!0,get:function(){return te[ne]}})}),re}function _extends$1(){return _extends$1=Object.assign?Object.assign.bind():function(te){for(var ee=1;ee<arguments.length;ee++){var re=arguments[ee];for(var ne in re)Object.prototype.hasOwnProperty.call(re,ne)&&(te[ne]=re[ne])}return te},_extends$1.apply(this,arguments)}var reactIs$2={exports:{}},reactIs_production_min$1={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var b$2=Symbol.for("react.element"),c$2=Symbol.for("react.portal"),d$2=Symbol.for("react.fragment"),e$3=Symbol.for("react.strict_mode"),f$2=Symbol.for("react.profiler"),g$3=Symbol.for("react.provider"),h$4=Symbol.for("react.context"),k$4=Symbol.for("react.server_context"),l$3=Symbol.for("react.forward_ref"),m$3=Symbol.for("react.suspense"),n$3=Symbol.for("react.suspense_list"),p$4=Symbol.for("react.memo"),q$5=Symbol.for("react.lazy"),t$5=Symbol.for("react.offscreen"),u$3;u$3=Symbol.for("react.module.reference");function v$3(te){if(typeof te=="object"&&te!==null){var ee=te.$$typeof;switch(ee){case b$2:switch(te=te.type,te){case d$2:case f$2:case e$3:case m$3:case n$3:return te;default:switch(te=te&&te.$$typeof,te){case k$4:case h$4:case l$3:case q$5:case p$4:case g$3:return te;default:return ee}}case c$2:return ee}}}reactIs_production_min$1.ContextConsumer=h$4;reactIs_production_min$1.ContextProvider=g$3;reactIs_production_min$1.Element=b$2;reactIs_production_min$1.ForwardRef=l$3;reactIs_production_min$1.Fragment=d$2;reactIs_production_min$1.Lazy=q$5;reactIs_production_min$1.Memo=p$4;reactIs_production_min$1.Portal=c$2;reactIs_production_min$1.Profiler=f$2;reactIs_production_min$1.StrictMode=e$3;reactIs_production_min$1.Suspense=m$3;reactIs_production_min$1.SuspenseList=n$3;reactIs_production_min$1.isAsyncMode=function(){return!1};reactIs_production_min$1.isConcurrentMode=function(){return!1};reactIs_production_min$1.isContextConsumer=function(te){return v$3(te)===h$4};reactIs_production_min$1.isContextProvider=function(te){return v$3(te)===g$3};reactIs_production_min$1.isElement=function(te){return typeof te=="object"&&te!==null&&te.$$typeof===b$2};reactIs_production_min$1.isForwardRef=function(te){return v$3(te)===l$3};reactIs_production_min$1.isFragment=function(te){return v$3(te)===d$2};reactIs_production_min$1.isLazy=function(te){return v$3(te)===q$5};reactIs_production_min$1.isMemo=function(te){return v$3(te)===p$4};reactIs_production_min$1.isPortal=function(te){return v$3(te)===c$2};reactIs_production_min$1.isProfiler=function(te){return v$3(te)===f$2};reactIs_production_min$1.isStrictMode=function(te){return v$3(te)===e$3};reactIs_production_min$1.isSuspense=function(te){return v$3(te)===m$3};reactIs_production_min$1.isSuspenseList=function(te){return v$3(te)===n$3};reactIs_production_min$1.isValidElementType=function(te){return typeof te=="string"||typeof te=="function"||te===d$2||te===f$2||te===e$3||te===m$3||te===n$3||te===t$5||typeof te=="object"&&te!==null&&(te.$$typeof===q$5||te.$$typeof===p$4||te.$$typeof===g$3||te.$$typeof===h$4||te.$$typeof===l$3||te.$$typeof===u$3||te.getModuleId!==void 0)};reactIs_production_min$1.typeOf=v$3;reactIs$2.exports=reactIs_production_min$1;var reactIsExports$1=reactIs$2.exports,t$4,r$3,u$2,i,o=0,f$1=[],c$1=[],e$2=l$4.__b,a=l$4.__r,v$2=l$4.diffed,l$2=l$4.__c,m$2=l$4.unmount;function d$1(te,ee){l$4.__h&&l$4.__h(r$3,te,o||ee),o=0;var re=r$3.__H||(r$3.__H={__:[],__h:[]});return te>=re.__.length&&re.__.push({__V:c$1}),re.__[te]}function h$3(te){return o=1,s(B$1,te)}function s(te,ee,re){var ne=d$1(t$4++,2);if(ne.t=te,!ne.__c&&(ne.__=[re?re(ee):B$1(void 0,ee),function(ue){var ae=ne.__N?ne.__N[0]:ne.__[0],oe=ne.t(ae,ue);ae!==oe&&(ne.__N=[oe,ne.__[1]],ne.__c.setState({}))}],ne.__c=r$3,!r$3.u)){var ie=function(ue,ae,oe){if(!ne.__c.__H)return!0;var ce=ne.__c.__H.__.filter(function(pe){return pe.__c});if(ce.every(function(pe){return!pe.__N}))return!se||se.call(this,ue,ae,oe);var he=!1;return ce.forEach(function(pe){if(pe.__N){var de=pe.__[0];pe.__=pe.__N,pe.__N=void 0,de!==pe.__[0]&&(he=!0)}}),!(!he&&ne.__c.props===ue)&&(!se||se.call(this,ue,ae,oe))};r$3.u=!0;var se=r$3.shouldComponentUpdate,le=r$3.componentWillUpdate;r$3.componentWillUpdate=function(ue,ae,oe){if(this.__e){var ce=se;se=void 0,ie(ue,ae,oe),se=ce}le&&le.call(this,ue,ae,oe)},r$3.shouldComponentUpdate=ie}return ne.__N||ne.__}function p$3(te,ee){var re=d$1(t$4++,3);!l$4.__s&&z$2(re.__H,ee)&&(re.__=te,re.i=ee,r$3.__H.__h.push(re))}function y$1(te,ee){var re=d$1(t$4++,4);!l$4.__s&&z$2(re.__H,ee)&&(re.__=te,re.i=ee,r$3.__h.push(re))}function _(te){return o=5,F$1(function(){return{current:te}},[])}function A$2(te,ee,re){o=6,y$1(function(){return typeof te=="function"?(te(ee()),function(){return te(null)}):te?(te.current=ee(),function(){return te.current=null}):void 0},re==null?re:re.concat(te))}function F$1(te,ee){var re=d$1(t$4++,7);return z$2(re.__H,ee)?(re.__V=te(),re.i=ee,re.__h=te,re.__V):re.__}function T$1(te,ee){return o=8,F$1(function(){return te},ee)}function q$4(te){var ee=r$3.context[te.__c],re=d$1(t$4++,9);return re.c=te,ee?(re.__==null&&(re.__=!0,ee.sub(r$3)),ee.props.value):te.__}function x$2(te,ee){l$4.useDebugValue&&l$4.useDebugValue(ee?ee(te):te)}function P$2(te){var ee=d$1(t$4++,10),re=h$3();return ee.__=te,r$3.componentDidCatch||(r$3.componentDidCatch=function(ne,ie){ee.__&&ee.__(ne,ie),re[1](ne)}),[re[0],function(){re[1](void 0)}]}function V$1(){var te=d$1(t$4++,11);if(!te.__){for(var ee=r$3.__v;ee!==null&&!ee.__m&&ee.__!==null;)ee=ee.__;var re=ee.__m||(ee.__m=[0,0]);te.__="P"+re[0]+"-"+re[1]++}return te.__}function b$1(){for(var te;te=f$1.shift();)if(te.__P&&te.__H)try{te.__H.__h.forEach(k$3),te.__H.__h.forEach(w$3),te.__H.__h=[]}catch(ee){te.__H.__h=[],l$4.__e(ee,te.__v)}}l$4.__b=function(te){r$3=null,e$2&&e$2(te)},l$4.__r=function(te){a&&a(te),t$4=0;var ee=(r$3=te.__c).__H;ee&&(u$2===r$3?(ee.__h=[],r$3.__h=[],ee.__.forEach(function(re){re.__N&&(re.__=re.__N),re.__V=c$1,re.__N=re.i=void 0})):(ee.__h.forEach(k$3),ee.__h.forEach(w$3),ee.__h=[],t$4=0)),u$2=r$3},l$4.diffed=function(te){v$2&&v$2(te);var ee=te.__c;ee&&ee.__H&&(ee.__H.__h.length&&(f$1.push(ee)!==1&&i===l$4.requestAnimationFrame||((i=l$4.requestAnimationFrame)||j$1)(b$1)),ee.__H.__.forEach(function(re){re.i&&(re.__H=re.i),re.__V!==c$1&&(re.__=re.__V),re.i=void 0,re.__V=c$1})),u$2=r$3=null},l$4.__c=function(te,ee){ee.some(function(re){try{re.__h.forEach(k$3),re.__h=re.__h.filter(function(ne){return!ne.__||w$3(ne)})}catch(ne){ee.some(function(ie){ie.__h&&(ie.__h=[])}),ee=[],l$4.__e(ne,re.__v)}}),l$2&&l$2(te,ee)},l$4.unmount=function(te){m$2&&m$2(te);var ee,re=te.__c;re&&re.__H&&(re.__H.__.forEach(function(ne){try{k$3(ne)}catch(ie){ee=ie}}),re.__H=void 0,ee&&l$4.__e(ee,re.__v))};var g$2=typeof requestAnimationFrame=="function";function j$1(te){var ee,re=function(){clearTimeout(ne),g$2&&cancelAnimationFrame(ee),setTimeout(te)},ne=setTimeout(re,100);g$2&&(ee=requestAnimationFrame(re))}function k$3(te){var ee=r$3,re=te.__c;typeof re=="function"&&(te.__c=void 0,re()),r$3=ee}function w$3(te){var ee=r$3;te.__c=te.__(),r$3=ee}function z$2(te,ee){return!te||te.length!==ee.length||ee.some(function(re,ne){return re!==te[ne]})}function B$1(te,ee){return typeof ee=="function"?ee(te):ee}function g$1(te,ee){for(var re in ee)te[re]=ee[re];return te}function C(te,ee){for(var re in te)if(re!=="__source"&&!(re in ee))return!0;for(var ne in ee)if(ne!=="__source"&&te[ne]!==ee[ne])return!0;return!1}function E(te,ee){return te===ee&&(te!==0||1/te==1/ee)||te!=te&&ee!=ee}function w$2(te){this.props=te}function x$1(te,ee){function re(ie){var se=this.props.ref,le=se==ie.ref;return!le&&se&&(se.call?se(null):se.current=null),ee?!ee(this.props,ie)||!le:C(this.props,ie)}function ne(ie){return this.shouldComponentUpdate=re,y$2(te,ie)}return ne.displayName="Memo("+(te.displayName||te.name)+")",ne.prototype.isReactComponent=!0,ne.__f=!0,ne}(w$2.prototype=new b$3).isPureReactComponent=!0,w$2.prototype.shouldComponentUpdate=function(te,ee){return C(this.props,te)||C(this.state,ee)};var R=l$4.__b;l$4.__b=function(te){te.type&&te.type.__f&&te.ref&&(te.props.ref=te.ref,te.ref=null),R&&R(te)};var N=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function k$2(te){function ee(re){var ne=g$1({},re);return delete ne.ref,te(ne,re.ref||null)}return ee.$$typeof=N,ee.render=ee,ee.prototype.isReactComponent=ee.__f=!0,ee.displayName="ForwardRef("+(te.displayName||te.name)+")",ee}var A$1=function(te,ee){return te==null?null:S(S(te).map(ee))},O={map:A$1,forEach:A$1,count:function(te){return te?S(te).length:0},only:function(te){var ee=S(te);if(ee.length!==1)throw"Children.only";return ee[0]},toArray:S},T=l$4.__e;l$4.__e=function(te,ee,re,ne){if(te.then){for(var ie,se=ee;se=se.__;)if((ie=se.__c)&&ie.__c)return ee.__e==null&&(ee.__e=re.__e,ee.__k=re.__k),ie.__c(te,ee)}T(te,ee,re,ne)};var I=l$4.unmount;function L(te,ee,re){return te&&(te.__c&&te.__c.__H&&(te.__c.__H.__.forEach(function(ne){typeof ne.__c=="function"&&ne.__c()}),te.__c.__H=null),(te=g$1({},te)).__c!=null&&(te.__c.__P===re&&(te.__c.__P=ee),te.__c=null),te.__k=te.__k&&te.__k.map(function(ne){return L(ne,ee,re)})),te}function U(te,ee,re){return te&&(te.__v=null,te.__k=te.__k&&te.__k.map(function(ne){return U(ne,ee,re)}),te.__c&&te.__c.__P===ee&&(te.__e&&re.insertBefore(te.__e,te.__d),te.__c.__e=!0,te.__c.__P=re)),te}function D(){this.__u=0,this.t=null,this.__b=null}function F(te){var ee=te.__.__c;return ee&&ee.__a&&ee.__a(te)}function M(te){var ee,re,ne;function ie(se){if(ee||(ee=te()).then(function(le){re=le.default||le},function(le){ne=le}),ne)throw ne;if(!re)throw ee;return y$2(re,se)}return ie.displayName="Lazy",ie.__f=!0,ie}function V(){this.u=null,this.o=null}l$4.unmount=function(te){var ee=te.__c;ee&&ee.__R&&ee.__R(),ee&&te.__h===!0&&(te.type=null),I&&I(te)},(D.prototype=new b$3).__c=function(te,ee){var re=ee.__c,ne=this;ne.t==null&&(ne.t=[]),ne.t.push(re);var ie=F(ne.__v),se=!1,le=function(){se||(se=!0,re.__R=null,ie?ie(ue):ue())};re.__R=le;var ue=function(){if(!--ne.__u){if(ne.state.__a){var oe=ne.state.__a;ne.__v.__k[0]=U(oe,oe.__c.__P,oe.__c.__O)}var ce;for(ne.setState({__a:ne.__b=null});ce=ne.t.pop();)ce.forceUpdate()}},ae=ee.__h===!0;ne.__u++||ae||ne.setState({__a:ne.__b=ne.__v.__k[0]}),te.then(le,le)},D.prototype.componentWillUnmount=function(){this.t=[]},D.prototype.render=function(te,ee){if(this.__b){if(this.__v.__k){var re=document.createElement("div"),ne=this.__v.__k[0].__c;this.__v.__k[0]=L(this.__b,re,ne.__O=ne.__P)}this.__b=null}var ie=ee.__a&&y$2(k$5,null,te.fallback);return ie&&(ie.__h=null),[y$2(k$5,null,ee.__a?null:te.children),ie]};var W=function(te,ee,re){if(++re[1]===re[0]&&te.o.delete(ee),te.props.revealOrder&&(te.props.revealOrder[0]!=="t"||!te.o.size))for(re=te.u;re;){for(;re.length>3;)re.pop()();if(re[1]<re[0])break;te.u=re=re[2]}};function P$1(te){return this.getChildContext=function(){return te.context},te.children}function j(te){var ee=this,re=te.i;ee.componentWillUnmount=function(){D$1(null,ee.l),ee.l=null,ee.i=null},ee.i&&ee.i!==re&&ee.componentWillUnmount(),te.__v?(ee.l||(ee.i=re,ee.l={nodeType:1,parentNode:re,childNodes:[],appendChild:function(ne){this.childNodes.push(ne),ee.i.appendChild(ne)},insertBefore:function(ne,ie){this.childNodes.push(ne),ee.i.appendChild(ne)},removeChild:function(ne){this.childNodes.splice(this.childNodes.indexOf(ne)>>>1,1),ee.i.removeChild(ne)}}),D$1(y$2(P$1,{context:ee.context},te.__v),ee.l)):ee.l&&ee.componentWillUnmount()}function z$1(te,ee){var re=y$2(j,{__v:te,i:ee});return re.containerInfo=ee,re}(V.prototype=new b$3).__a=function(te){var ee=this,re=F(ee.__v),ne=ee.o.get(te);return ne[0]++,function(ie){var se=function(){ee.props.revealOrder?(ne.push(ie),W(ee,te,ne)):ie()};re?re(se):se()}},V.prototype.render=function(te){this.u=null,this.o=new Map;var ee=S(te.children);te.revealOrder&&te.revealOrder[0]==="b"&&ee.reverse();for(var re=ee.length;re--;)this.o.set(ee[re],this.u=[1,0,this.u]);return te.children},V.prototype.componentDidUpdate=V.prototype.componentDidMount=function(){var te=this;this.o.forEach(function(ee,re){W(te,re,ee)})};var B=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,H=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,Z=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,Y=/[A-Z0-9]/g,$=typeof document<"u",q$3=function(te){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(te)};function G(te,ee,re){return ee.__k==null&&(ee.textContent=""),D$1(te,ee),typeof re=="function"&&re(),te?te.__c:null}function J(te,ee,re){return E$1(te,ee),typeof re=="function"&&re(),te?te.__c:null}b$3.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(te){Object.defineProperty(b$3.prototype,te,{configurable:!0,get:function(){return this["UNSAFE_"+te]},set:function(ee){Object.defineProperty(this,te,{configurable:!0,writable:!0,value:ee})}})});var K=l$4.event;function Q(){}function X(){return this.cancelBubble}function nn(){return this.defaultPrevented}l$4.event=function(te){return K&&(te=K(te)),te.persist=Q,te.isPropagationStopped=X,te.isDefaultPrevented=nn,te.nativeEvent=te};var tn,en={enumerable:!1,configurable:!0,get:function(){return this.class}},rn=l$4.vnode;l$4.vnode=function(te){typeof te.type=="string"&&function(ee){var re=ee.props,ne=ee.type,ie={};for(var se in re){var le=re[se];if(!(se==="value"&&"defaultValue"in re&&le==null||$&&se==="children"&&ne==="noscript"||se==="class"||se==="className")){var ue=se.toLowerCase();se==="defaultValue"&&"value"in re&&re.value==null?se="value":se==="download"&&le===!0?le="":ue==="ondoubleclick"?se="ondblclick":ue!=="onchange"||ne!=="input"&&ne!=="textarea"||q$3(re.type)?ue==="onfocus"?se="onfocusin":ue==="onblur"?se="onfocusout":Z.test(se)?se=ue:ne.indexOf("-")===-1&&H.test(se)?se=se.replace(Y,"-$&").toLowerCase():le===null&&(le=void 0):ue=se="oninput",ue==="oninput"&&ie[se=ue]&&(se="oninputCapture"),ie[se]=le}}ne=="select"&&ie.multiple&&Array.isArray(ie.value)&&(ie.value=S(re.children).forEach(function(ae){ae.props.selected=ie.value.indexOf(ae.props.value)!=-1})),ne=="select"&&ie.defaultValue!=null&&(ie.value=S(re.children).forEach(function(ae){ae.props.selected=ie.multiple?ie.defaultValue.indexOf(ae.props.value)!=-1:ie.defaultValue==ae.props.value})),re.class&&!re.className?(ie.class=re.class,Object.defineProperty(ie,"className",en)):(re.className&&!re.class||re.class&&re.className)&&(ie.class=ie.className=re.className),ee.props=ie}(te),te.$$typeof=B,rn&&rn(te)};var un=l$4.__r;l$4.__r=function(te){un&&un(te),tn=te.__c};var on=l$4.diffed;l$4.diffed=function(te){on&&on(te);var ee=te.props,re=te.__e;re!=null&&te.type==="textarea"&&"value"in ee&&ee.value!==re.value&&(re.value=ee.value==null?"":ee.value),tn=null};var ln={ReactCurrentDispatcher:{current:{readContext:function(te){return tn.__n[te.__c].props.value}}}},cn="17.0.2";function fn$1(te){return y$2.bind(null,te)}function an(te){return!!te&&te.$$typeof===B}function sn(te){return an(te)?F$2.apply(null,arguments):te}function hn(te){return!!te.__k&&(D$1(null,te),!0)}function vn(te){return te&&(te.base||te.nodeType===1&&te)||null}var dn=function(te,ee){return te(ee)},pn=function(te,ee){return te(ee)},mn=k$5;function yn(te){te()}function _n(te){return te}function bn(){return[!1,yn]}var Sn=y$1;function gn(te,ee){var re=ee(),ne=h$3({h:{__:re,v:ee}}),ie=ne[0].h,se=ne[1];return y$1(function(){ie.__=re,ie.v=ee,E(ie.__,ee())||se({h:ie})},[te,re,ee]),p$3(function(){return E(ie.__,ie.v())||se({h:ie}),te(function(){E(ie.__,ie.v())||se({h:ie})})},[te]),re}var Cn={useState:h$3,useId:V$1,useReducer:s,useEffect:p$3,useLayoutEffect:y$1,useInsertionEffect:Sn,useTransition:bn,useDeferredValue:_n,useSyncExternalStore:gn,startTransition:yn,useRef:_,useImperativeHandle:A$2,useMemo:F$1,useCallback:T$1,useContext:q$4,useDebugValue:x$2,version:"17.0.2",Children:O,render:G,hydrate:J,unmountComponentAtNode:hn,createPortal:z$1,createElement:y$2,createContext:G$1,createFactory:fn$1,cloneElement:sn,createRef:_$1,Fragment:k$5,isValidElement:an,findDOMNode:vn,Component:b$3,PureComponent:w$2,memo:x$1,forwardRef:k$2,flushSync:pn,unstable_batchedUpdates:dn,StrictMode:mn,Suspense:D,SuspenseList:V,lazy:M,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:ln};const React=Object.freeze(Object.defineProperty({__proto__:null,Children:O,Component:b$3,Fragment:k$5,PureComponent:w$2,StrictMode:mn,Suspense:D,SuspenseList:V,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:ln,cloneElement:sn,createContext:G$1,createElement:y$2,createFactory:fn$1,createPortal:z$1,createRef:_$1,default:Cn,findDOMNode:vn,flushSync:pn,forwardRef:k$2,hydrate:J,isValidElement:an,lazy:M,memo:x$1,render:G,startTransition:yn,unmountComponentAtNode:hn,unstable_batchedUpdates:dn,useCallback:T$1,useContext:q$4,useDebugValue:x$2,useDeferredValue:_n,useEffect:p$3,useErrorBoundary:P$2,useId:V$1,useImperativeHandle:A$2,useInsertionEffect:Sn,useLayoutEffect:y$1,useMemo:F$1,useReducer:s,useRef:_,useState:h$3,useSyncExternalStore:gn,useTransition:bn,version:cn},Symbol.toStringTag,{value:"Module"}));function _objectWithoutPropertiesLoose(te,ee){if(te==null)return{};var re={},ne=Object.keys(te),ie,se;for(se=0;se<ne.length;se++)ie=ne[se],!(ee.indexOf(ie)>=0)&&(re[ie]=te[ie]);return re}var reactIs$1={exports:{}},reactIs_production_min={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var b=typeof Symbol=="function"&&Symbol.for,c=b?Symbol.for("react.element"):60103,d=b?Symbol.for("react.portal"):60106,e$1=b?Symbol.for("react.fragment"):60107,f=b?Symbol.for("react.strict_mode"):60108,g=b?Symbol.for("react.profiler"):60114,h$2=b?Symbol.for("react.provider"):60109,k$1=b?Symbol.for("react.context"):60110,l$1=b?Symbol.for("react.async_mode"):60111,m$1=b?Symbol.for("react.concurrent_mode"):60111,n$2=b?Symbol.for("react.forward_ref"):60112,p$2=b?Symbol.for("react.suspense"):60113,q$2=b?Symbol.for("react.suspense_list"):60120,r$2=b?Symbol.for("react.memo"):60115,t$3=b?Symbol.for("react.lazy"):60116,v$1=b?Symbol.for("react.block"):60121,w$1=b?Symbol.for("react.fundamental"):60117,x=b?Symbol.for("react.responder"):60118,y=b?Symbol.for("react.scope"):60119;function z(te){if(typeof te=="object"&&te!==null){var ee=te.$$typeof;switch(ee){case c:switch(te=te.type,te){case l$1:case m$1:case e$1:case g:case f:case p$2:return te;default:switch(te=te&&te.$$typeof,te){case k$1:case n$2:case t$3:case r$2:case h$2:return te;default:return ee}}case d:return ee}}}function A(te){return z(te)===m$1}reactIs_production_min.AsyncMode=l$1;reactIs_production_min.ConcurrentMode=m$1;reactIs_production_min.ContextConsumer=k$1;reactIs_production_min.ContextProvider=h$2;reactIs_production_min.Element=c;reactIs_production_min.ForwardRef=n$2;reactIs_production_min.Fragment=e$1;reactIs_production_min.Lazy=t$3;reactIs_production_min.Memo=r$2;reactIs_production_min.Portal=d;reactIs_production_min.Profiler=g;reactIs_production_min.StrictMode=f;reactIs_production_min.Suspense=p$2;reactIs_production_min.isAsyncMode=function(te){return A(te)||z(te)===l$1};reactIs_production_min.isConcurrentMode=A;reactIs_production_min.isContextConsumer=function(te){return z(te)===k$1};reactIs_production_min.isContextProvider=function(te){return z(te)===h$2};reactIs_production_min.isElement=function(te){return typeof te=="object"&&te!==null&&te.$$typeof===c};reactIs_production_min.isForwardRef=function(te){return z(te)===n$2};reactIs_production_min.isFragment=function(te){return z(te)===e$1};reactIs_production_min.isLazy=function(te){return z(te)===t$3};reactIs_production_min.isMemo=function(te){return z(te)===r$2};reactIs_production_min.isPortal=function(te){return z(te)===d};reactIs_production_min.isProfiler=function(te){return z(te)===g};reactIs_production_min.isStrictMode=function(te){return z(te)===f};reactIs_production_min.isSuspense=function(te){return z(te)===p$2};reactIs_production_min.isValidElementType=function(te){return typeof te=="string"||typeof te=="function"||te===e$1||te===m$1||te===g||te===f||te===p$2||te===q$2||typeof te=="object"&&te!==null&&(te.$$typeof===t$3||te.$$typeof===r$2||te.$$typeof===h$2||te.$$typeof===k$1||te.$$typeof===n$2||te.$$typeof===w$1||te.$$typeof===x||te.$$typeof===y||te.$$typeof===v$1)};reactIs_production_min.typeOf=z;reactIs$1.exports=reactIs_production_min;var reactIsExports=reactIs$1.exports,reactIs=reactIsExports,REACT_STATICS={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},KNOWN_STATICS={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},FORWARD_REF_STATICS={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},MEMO_STATICS={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},TYPE_STATICS={};TYPE_STATICS[reactIs.ForwardRef]=FORWARD_REF_STATICS;TYPE_STATICS[reactIs.Memo]=MEMO_STATICS;function getStatics(te){return reactIs.isMemo(te)?MEMO_STATICS:TYPE_STATICS[te.$$typeof]||REACT_STATICS}var defineProperty=Object.defineProperty,getOwnPropertyNames=Object.getOwnPropertyNames,getOwnPropertySymbols=Object.getOwnPropertySymbols,getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor,getPrototypeOf=Object.getPrototypeOf,objectPrototype=Object.prototype;function hoistNonReactStatics(te,ee,re){if(typeof ee!="string"){if(objectPrototype){var ne=getPrototypeOf(ee);ne&&ne!==objectPrototype&&hoistNonReactStatics(te,ne,re)}var ie=getOwnPropertyNames(ee);getOwnPropertySymbols&&(ie=ie.concat(getOwnPropertySymbols(ee)));for(var se=getStatics(te),le=getStatics(ee),ue=0;ue<ie.length;++ue){var ae=ie[ue];if(!KNOWN_STATICS[ae]&&!(re&&re[ae])&&!(le&&le[ae])&&!(se&&se[ae])){var oe=getOwnPropertyDescriptor(ee,ae);try{defineProperty(te,ae,oe)}catch{}}}}return te}var hoistNonReactStatics_cjs=hoistNonReactStatics;const hoistNonReactStatics$1=getDefaultExportFromCjs(hoistNonReactStatics_cjs),require$$0$1=getAugmentedNamespace(React);function _typeof(te){"@babel/helpers - typeof";return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(ee){return typeof ee}:function(ee){return ee&&typeof Symbol=="function"&&ee.constructor===Symbol&&ee!==Symbol.prototype?"symbol":typeof ee},_typeof(te)}function _toPrimitive(te,ee){if(_typeof(te)!=="object"||te===null)return te;var re=te[Symbol.toPrimitive];if(re!==void 0){var ne=re.call(te,ee||"default");if(_typeof(ne)!=="object")return ne;throw new TypeError("@@toPrimitive must return a primitive value.")}return(ee==="string"?String:Number)(te)}function _toPropertyKey(te){var ee=_toPrimitive(te,"string");return _typeof(ee)==="symbol"?ee:String(ee)}const scriptRel="modulepreload",assetsURL=function(te,ee){return new URL(te,ee).href},seen={},__vitePreload=function(ee,re,ne){if(!re||re.length===0)return ee();const ie=document.getElementsByTagName("link");return Promise.all(re.map(se=>{if(se=assetsURL(se,ne),se in seen)return;seen[se]=!0;const le=se.endsWith(".css"),ue=le?'[rel="stylesheet"]':"";if(!!ne)for(let ce=ie.length-1;ce>=0;ce--){const he=ie[ce];if(he.href===se&&(!le||he.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${se}"]${ue}`))return;const oe=document.createElement("link");if(oe.rel=le?"stylesheet":scriptRel,le||(oe.as="script",oe.crossOrigin=""),oe.href=se,document.head.appendChild(oe),le)return new Promise((ce,he)=>{oe.addEventListener("load",ce),oe.addEventListener("error",()=>he(new Error(`Unable to preload CSS for ${se}`)))})})).then(()=>ee())},resolveFetch$3=te=>{let ee;return te?ee=te:typeof fetch>"u"?ee=(...re)=>__vitePreload(()=>Promise.resolve().then(()=>browser),void 0,import.meta.url).then(({default:ne})=>ne(...re)):ee=fetch,(...re)=>ee(...re)};class FunctionsError extends Error{constructor(ee,re="FunctionsError",ne){super(ee),this.name=re,this.context=ne}}class FunctionsFetchError extends FunctionsError{constructor(ee){super("Failed to send a request to the Edge Function","FunctionsFetchError",ee)}}class FunctionsRelayError extends FunctionsError{constructor(ee){super("Relay Error invoking the Edge Function","FunctionsRelayError",ee)}}class FunctionsHttpError extends FunctionsError{constructor(ee){super("Edge Function returned a non-2xx status code","FunctionsHttpError",ee)}}var FunctionRegion;(function(te){te.Any="any",te.ApNortheast1="ap-northeast-1",te.ApNortheast2="ap-northeast-2",te.ApSouth1="ap-south-1",te.ApSoutheast1="ap-southeast-1",te.ApSoutheast2="ap-southeast-2",te.CaCentral1="ca-central-1",te.EuCentral1="eu-central-1",te.EuWest1="eu-west-1",te.EuWest2="eu-west-2",te.EuWest3="eu-west-3",te.SaEast1="sa-east-1",te.UsEast1="us-east-1",te.UsWest1="us-west-1",te.UsWest2="us-west-2"})(FunctionRegion||(FunctionRegion={}));var __awaiter$7=globalThis&&globalThis.__awaiter||function(te,ee,re,ne){function ie(se){return se instanceof re?se:new re(function(le){le(se)})}return new(re||(re=Promise))(function(se,le){function ue(ce){try{oe(ne.next(ce))}catch(he){le(he)}}function ae(ce){try{oe(ne.throw(ce))}catch(he){le(he)}}function oe(ce){ce.done?se(ce.value):ie(ce.value).then(ue,ae)}oe((ne=ne.apply(te,ee||[])).next())})};class FunctionsClient{constructor(ee,{headers:re={},customFetch:ne,region:ie=FunctionRegion.Any}={}){this.url=ee,this.headers=re,this.region=ie,this.fetch=resolveFetch$3(ne)}setAuth(ee){this.headers.Authorization=`Bearer ${ee}`}invoke(ee,re={}){var ne;return __awaiter$7(this,void 0,void 0,function*(){try{const{headers:ie,method:se,body:le}=re;let ue={},{region:ae}=re;ae||(ae=this.region),ae&&ae!=="any"&&(ue["x-region"]=ae);let oe;le&&(ie&&!Object.prototype.hasOwnProperty.call(ie,"Content-Type")||!ie)&&(typeof Blob<"u"&&le instanceof Blob||le instanceof ArrayBuffer?(ue["Content-Type"]="application/octet-stream",oe=le):typeof le=="string"?(ue["Content-Type"]="text/plain",oe=le):typeof FormData<"u"&&le instanceof FormData?oe=le:(ue["Content-Type"]="application/json",oe=JSON.stringify(le)));const ce=yield this.fetch(`${this.url}/${ee}`,{method:se||"POST",headers:Object.assign(Object.assign(Object.assign({},ue),this.headers),ie),body:oe}).catch(me=>{throw new FunctionsFetchError(me)}),he=ce.headers.get("x-relay-error");if(he&&he==="true")throw new FunctionsRelayError(ce);if(!ce.ok)throw new FunctionsHttpError(ce);let pe=((ne=ce.headers.get("Content-Type"))!==null&&ne!==void 0?ne:"text/plain").split(";")[0].trim(),de;return pe==="application/json"?de=yield ce.json():pe==="application/octet-stream"?de=yield ce.blob():pe==="text/event-stream"?de=ce:pe==="multipart/form-data"?de=yield ce.formData():de=yield ce.text(),{data:de,error:null}}catch(ie){return{data:null,error:ie}}})}}var cjs={},PostgrestClient$2={},PostgrestQueryBuilder$2={},PostgrestFilterBuilder$2={},PostgrestTransformBuilder$2={},PostgrestBuilder$2={},getGlobal=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},globalObject=getGlobal();const fetch$1=globalObject.fetch,nodeFetch=globalObject.fetch.bind(globalObject),Headers$1=globalObject.Headers,Request=globalObject.Request,Response$1=globalObject.Response,browser=Object.freeze(Object.defineProperty({__proto__:null,Headers:Headers$1,Request,Response:Response$1,default:nodeFetch,fetch:fetch$1},Symbol.toStringTag,{value:"Module"})),require$$0=getAugmentedNamespace(browser);var PostgrestError$2={};Object.defineProperty(PostgrestError$2,"__esModule",{value:!0});let PostgrestError$1=class extends Error{constructor(ee){super(ee.message),this.name="PostgrestError",this.details=ee.details,this.hint=ee.hint,this.code=ee.code}};PostgrestError$2.default=PostgrestError$1;var __importDefault$5=commonjsGlobal&&commonjsGlobal.__importDefault||function(te){return te&&te.__esModule?te:{default:te}};Object.defineProperty(PostgrestBuilder$2,"__esModule",{value:!0});const node_fetch_1=__importDefault$5(require$$0),PostgrestError_1$1=__importDefault$5(PostgrestError$2);let PostgrestBuilder$1=class{constructor(ee){this.shouldThrowOnError=!1,this.method=ee.method,this.url=ee.url,this.headers=ee.headers,this.schema=ee.schema,this.body=ee.body,this.shouldThrowOnError=ee.shouldThrowOnError,this.signal=ee.signal,this.isMaybeSingle=ee.isMaybeSingle,ee.fetch?this.fetch=ee.fetch:typeof fetch>"u"?this.fetch=node_fetch_1.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(ee,re){return this.headers=Object.assign({},this.headers),this.headers[ee]=re,this}then(ee,re){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const ne=this.fetch;let ie=ne(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async se=>{var le,ue,ae;let oe=null,ce=null,he=null,pe=se.status,de=se.statusText;if(se.ok){if(this.method!=="HEAD"){const ve=await se.text();ve===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?ce=ve:ce=JSON.parse(ve))}const ge=(le=this.headers.Prefer)===null||le===void 0?void 0:le.match(/count=(exact|planned|estimated)/),we=(ue=se.headers.get("content-range"))===null||ue===void 0?void 0:ue.split("/");ge&&we&&we.length>1&&(he=parseInt(we[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(ce)&&(ce.length>1?(oe={code:"PGRST116",details:`Results contain ${ce.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},ce=null,he=null,pe=406,de="Not Acceptable"):ce.length===1?ce=ce[0]:ce=null)}else{const ge=await se.text();try{oe=JSON.parse(ge),Array.isArray(oe)&&se.status===404&&(ce=[],oe=null,pe=200,de="OK")}catch{se.status===404&&ge===""?(pe=204,de="No Content"):oe={message:ge}}if(oe&&this.isMaybeSingle&&(!((ae=oe==null?void 0:oe.details)===null||ae===void 0)&&ae.includes("0 rows"))&&(oe=null,pe=200,de="OK"),oe&&this.shouldThrowOnError)throw new PostgrestError_1$1.default(oe)}return{error:oe,data:ce,count:he,status:pe,statusText:de}});return this.shouldThrowOnError||(ie=ie.catch(se=>{var le,ue,ae;return{error:{message:`${(le=se==null?void 0:se.name)!==null&&le!==void 0?le:"FetchError"}: ${se==null?void 0:se.message}`,details:`${(ue=se==null?void 0:se.stack)!==null&&ue!==void 0?ue:""}`,hint:"",code:`${(ae=se==null?void 0:se.code)!==null&&ae!==void 0?ae:""}`},data:null,count:null,status:0,statusText:""}})),ie.then(ee,re)}returns(){return this}overrideTypes(){return this}};PostgrestBuilder$2.default=PostgrestBuilder$1;var __importDefault$4=commonjsGlobal&&commonjsGlobal.__importDefault||function(te){return te&&te.__esModule?te:{default:te}};Object.defineProperty(PostgrestTransformBuilder$2,"__esModule",{value:!0});const PostgrestBuilder_1$1=__importDefault$4(PostgrestBuilder$2);let PostgrestTransformBuilder$1=class extends PostgrestBuilder_1$1.default{select(ee){let re=!1;const ne=(ee??"*").split("").map(ie=>/\s/.test(ie)&&!re?"":(ie==='"'&&(re=!re),ie)).join("");return this.url.searchParams.set("select",ne),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(ee,{ascending:re=!0,nullsFirst:ne,foreignTable:ie,referencedTable:se=ie}={}){const le=se?`${se}.order`:"order",ue=this.url.searchParams.get(le);return this.url.searchParams.set(le,`${ue?`${ue},`:""}${ee}.${re?"asc":"desc"}${ne===void 0?"":ne?".nullsfirst":".nullslast"}`),this}limit(ee,{foreignTable:re,referencedTable:ne=re}={}){const ie=typeof ne>"u"?"limit":`${ne}.limit`;return this.url.searchParams.set(ie,`${ee}`),this}range(ee,re,{foreignTable:ne,referencedTable:ie=ne}={}){const se=typeof ie>"u"?"offset":`${ie}.offset`,le=typeof ie>"u"?"limit":`${ie}.limit`;return this.url.searchParams.set(se,`${ee}`),this.url.searchParams.set(le,`${re-ee+1}`),this}abortSignal(ee){return this.signal=ee,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:ee=!1,verbose:re=!1,settings:ne=!1,buffers:ie=!1,wal:se=!1,format:le="text"}={}){var ue;const ae=[ee?"analyze":null,re?"verbose":null,ne?"settings":null,ie?"buffers":null,se?"wal":null].filter(Boolean).join("|"),oe=(ue=this.headers.Accept)!==null&&ue!==void 0?ue:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${le}; for="${oe}"; options=${ae};`,le==="json"?this:this}rollback(){var ee;return((ee=this.headers.Prefer)!==null&&ee!==void 0?ee:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};PostgrestTransformBuilder$2.default=PostgrestTransformBuilder$1;var __importDefault$3=commonjsGlobal&&commonjsGlobal.__importDefault||function(te){return te&&te.__esModule?te:{default:te}};Object.defineProperty(PostgrestFilterBuilder$2,"__esModule",{value:!0});const PostgrestTransformBuilder_1$1=__importDefault$3(PostgrestTransformBuilder$2);let PostgrestFilterBuilder$1=class extends PostgrestTransformBuilder_1$1.default{eq(ee,re){return this.url.searchParams.append(ee,`eq.${re}`),this}neq(ee,re){return this.url.searchParams.append(ee,`neq.${re}`),this}gt(ee,re){return this.url.searchParams.append(ee,`gt.${re}`),this}gte(ee,re){return this.url.searchParams.append(ee,`gte.${re}`),this}lt(ee,re){return this.url.searchParams.append(ee,`lt.${re}`),this}lte(ee,re){return this.url.searchParams.append(ee,`lte.${re}`),this}like(ee,re){return this.url.searchParams.append(ee,`like.${re}`),this}likeAllOf(ee,re){return this.url.searchParams.append(ee,`like(all).{${re.join(",")}}`),this}likeAnyOf(ee,re){return this.url.searchParams.append(ee,`like(any).{${re.join(",")}}`),this}ilike(ee,re){return this.url.searchParams.append(ee,`ilike.${re}`),this}ilikeAllOf(ee,re){return this.url.searchParams.append(ee,`ilike(all).{${re.join(",")}}`),this}ilikeAnyOf(ee,re){return this.url.searchParams.append(ee,`ilike(any).{${re.join(",")}}`),this}is(ee,re){return this.url.searchParams.append(ee,`is.${re}`),this}in(ee,re){const ne=Array.from(new Set(re)).map(ie=>typeof ie=="string"&&new RegExp("[,()]").test(ie)?`"${ie}"`:`${ie}`).join(",");return this.url.searchParams.append(ee,`in.(${ne})`),this}contains(ee,re){return typeof re=="string"?this.url.searchParams.append(ee,`cs.${re}`):Array.isArray(re)?this.url.searchParams.append(ee,`cs.{${re.join(",")}}`):this.url.searchParams.append(ee,`cs.${JSON.stringify(re)}`),this}containedBy(ee,re){return typeof re=="string"?this.url.searchParams.append(ee,`cd.${re}`):Array.isArray(re)?this.url.searchParams.append(ee,`cd.{${re.join(",")}}`):this.url.searchParams.append(ee,`cd.${JSON.stringify(re)}`),this}rangeGt(ee,re){return this.url.searchParams.append(ee,`sr.${re}`),this}rangeGte(ee,re){return this.url.searchParams.append(ee,`nxl.${re}`),this}rangeLt(ee,re){return this.url.searchParams.append(ee,`sl.${re}`),this}rangeLte(ee,re){return this.url.searchParams.append(ee,`nxr.${re}`),this}rangeAdjacent(ee,re){return this.url.searchParams.append(ee,`adj.${re}`),this}overlaps(ee,re){return typeof re=="string"?this.url.searchParams.append(ee,`ov.${re}`):this.url.searchParams.append(ee,`ov.{${re.join(",")}}`),this}textSearch(ee,re,{config:ne,type:ie}={}){let se="";ie==="plain"?se="pl":ie==="phrase"?se="ph":ie==="websearch"&&(se="w");const le=ne===void 0?"":`(${ne})`;return this.url.searchParams.append(ee,`${se}fts${le}.${re}`),this}match(ee){return Object.entries(ee).forEach(([re,ne])=>{this.url.searchParams.append(re,`eq.${ne}`)}),this}not(ee,re,ne){return this.url.searchParams.append(ee,`not.${re}.${ne}`),this}or(ee,{foreignTable:re,referencedTable:ne=re}={}){const ie=ne?`${ne}.or`:"or";return this.url.searchParams.append(ie,`(${ee})`),this}filter(ee,re,ne){return this.url.searchParams.append(ee,`${re}.${ne}`),this}};PostgrestFilterBuilder$2.default=PostgrestFilterBuilder$1;var __importDefault$2=commonjsGlobal&&commonjsGlobal.__importDefault||function(te){return te&&te.__esModule?te:{default:te}};Object.defineProperty(PostgrestQueryBuilder$2,"__esModule",{value:!0});const PostgrestFilterBuilder_1$2=__importDefault$2(PostgrestFilterBuilder$2);let PostgrestQueryBuilder$1=class{constructor(ee,{headers:re={},schema:ne,fetch:ie}){this.url=ee,this.headers=re,this.schema=ne,this.fetch=ie}select(ee,{head:re=!1,count:ne}={}){const ie=re?"HEAD":"GET";let se=!1;const le=(ee??"*").split("").map(ue=>/\s/.test(ue)&&!se?"":(ue==='"'&&(se=!se),ue)).join("");return this.url.searchParams.set("select",le),ne&&(this.headers.Prefer=`count=${ne}`),new PostgrestFilterBuilder_1$2.default({method:ie,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(ee,{count:re,defaultToNull:ne=!0}={}){const ie="POST",se=[];if(this.headers.Prefer&&se.push(this.headers.Prefer),re&&se.push(`count=${re}`),ne||se.push("missing=default"),this.headers.Prefer=se.join(","),Array.isArray(ee)){const le=ee.reduce((ue,ae)=>ue.concat(Object.keys(ae)),[]);if(le.length>0){const ue=[...new Set(le)].map(ae=>`"${ae}"`);this.url.searchParams.set("columns",ue.join(","))}}return new PostgrestFilterBuilder_1$2.default({method:ie,url:this.url,headers:this.headers,schema:this.schema,body:ee,fetch:this.fetch,allowEmpty:!1})}upsert(ee,{onConflict:re,ignoreDuplicates:ne=!1,count:ie,defaultToNull:se=!0}={}){const le="POST",ue=[`resolution=${ne?"ignore":"merge"}-duplicates`];if(re!==void 0&&this.url.searchParams.set("on_conflict",re),this.headers.Prefer&&ue.push(this.headers.Prefer),ie&&ue.push(`count=${ie}`),se||ue.push("missing=default"),this.headers.Prefer=ue.join(","),Array.isArray(ee)){const ae=ee.reduce((oe,ce)=>oe.concat(Object.keys(ce)),[]);if(ae.length>0){const oe=[...new Set(ae)].map(ce=>`"${ce}"`);this.url.searchParams.set("columns",oe.join(","))}}return new PostgrestFilterBuilder_1$2.default({method:le,url:this.url,headers:this.headers,schema:this.schema,body:ee,fetch:this.fetch,allowEmpty:!1})}update(ee,{count:re}={}){const ne="PATCH",ie=[];return this.headers.Prefer&&ie.push(this.headers.Prefer),re&&ie.push(`count=${re}`),this.headers.Prefer=ie.join(","),new PostgrestFilterBuilder_1$2.default({method:ne,url:this.url,headers:this.headers,schema:this.schema,body:ee,fetch:this.fetch,allowEmpty:!1})}delete({count:ee}={}){const re="DELETE",ne=[];return ee&&ne.push(`count=${ee}`),this.headers.Prefer&&ne.unshift(this.headers.Prefer),this.headers.Prefer=ne.join(","),new PostgrestFilterBuilder_1$2.default({method:re,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};PostgrestQueryBuilder$2.default=PostgrestQueryBuilder$1;var constants={},version$4={};Object.defineProperty(version$4,"__esModule",{value:!0});version$4.version=void 0;version$4.version="0.0.0-automated";Object.defineProperty(constants,"__esModule",{value:!0});constants.DEFAULT_HEADERS=void 0;const version_1=version$4;constants.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${version_1.version}`};var __importDefault$1=commonjsGlobal&&commonjsGlobal.__importDefault||function(te){return te&&te.__esModule?te:{default:te}};Object.defineProperty(PostgrestClient$2,"__esModule",{value:!0});const PostgrestQueryBuilder_1$1=__importDefault$1(PostgrestQueryBuilder$2),PostgrestFilterBuilder_1$1=__importDefault$1(PostgrestFilterBuilder$2),constants_1=constants;let PostgrestClient$1=class xr{constructor(ee,{headers:re={},schema:ne,fetch:ie}={}){this.url=ee,this.headers=Object.assign(Object.assign({},constants_1.DEFAULT_HEADERS),re),this.schemaName=ne,this.fetch=ie}from(ee){const re=new URL(`${this.url}/${ee}`);return new PostgrestQueryBuilder_1$1.default(re,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(ee){return new xr(this.url,{headers:this.headers,schema:ee,fetch:this.fetch})}rpc(ee,re={},{head:ne=!1,get:ie=!1,count:se}={}){let le;const ue=new URL(`${this.url}/rpc/${ee}`);let ae;ne||ie?(le=ne?"HEAD":"GET",Object.entries(re).filter(([ce,he])=>he!==void 0).map(([ce,he])=>[ce,Array.isArray(he)?`{${he.join(",")}}`:`${he}`]).forEach(([ce,he])=>{ue.searchParams.append(ce,he)})):(le="POST",ae=re);const oe=Object.assign({},this.headers);return se&&(oe.Prefer=`count=${se}`),new PostgrestFilterBuilder_1$1.default({method:le,url:ue,headers:oe,schema:this.schemaName,body:ae,fetch:this.fetch,allowEmpty:!1})}};PostgrestClient$2.default=PostgrestClient$1;var __importDefault=commonjsGlobal&&commonjsGlobal.__importDefault||function(te){return te&&te.__esModule?te:{default:te}};Object.defineProperty(cjs,"__esModule",{value:!0});cjs.PostgrestError=cjs.PostgrestBuilder=cjs.PostgrestTransformBuilder=cjs.PostgrestFilterBuilder=cjs.PostgrestQueryBuilder=cjs.PostgrestClient=void 0;const PostgrestClient_1=__importDefault(PostgrestClient$2);cjs.PostgrestClient=PostgrestClient_1.default;const PostgrestQueryBuilder_1=__importDefault(PostgrestQueryBuilder$2);cjs.PostgrestQueryBuilder=PostgrestQueryBuilder_1.default;const PostgrestFilterBuilder_1=__importDefault(PostgrestFilterBuilder$2);cjs.PostgrestFilterBuilder=PostgrestFilterBuilder_1.default;const PostgrestTransformBuilder_1=__importDefault(PostgrestTransformBuilder$2);cjs.PostgrestTransformBuilder=PostgrestTransformBuilder_1.default;const PostgrestBuilder_1=__importDefault(PostgrestBuilder$2);cjs.PostgrestBuilder=PostgrestBuilder_1.default;const PostgrestError_1=__importDefault(PostgrestError$2);cjs.PostgrestError=PostgrestError_1.default;var _default=cjs.default={PostgrestClient:PostgrestClient_1.default,PostgrestQueryBuilder:PostgrestQueryBuilder_1.default,PostgrestFilterBuilder:PostgrestFilterBuilder_1.default,PostgrestTransformBuilder:PostgrestTransformBuilder_1.default,PostgrestBuilder:PostgrestBuilder_1.default,PostgrestError:PostgrestError_1.default};const{PostgrestClient,PostgrestQueryBuilder,PostgrestFilterBuilder,PostgrestTransformBuilder,PostgrestBuilder,PostgrestError}=_default,version$3="2.11.2",DEFAULT_HEADERS$3={"X-Client-Info":`realtime-js/${version$3}`},VSN="1.0.0",DEFAULT_TIMEOUT=1e4,WS_CLOSE_NORMAL=1e3;var SOCKET_STATES;(function(te){te[te.connecting=0]="connecting",te[te.open=1]="open",te[te.closing=2]="closing",te[te.closed=3]="closed"})(SOCKET_STATES||(SOCKET_STATES={}));var CHANNEL_STATES;(function(te){te.closed="closed",te.errored="errored",te.joined="joined",te.joining="joining",te.leaving="leaving"})(CHANNEL_STATES||(CHANNEL_STATES={}));var CHANNEL_EVENTS;(function(te){te.close="phx_close",te.error="phx_error",te.join="phx_join",te.reply="phx_reply",te.leave="phx_leave",te.access_token="access_token"})(CHANNEL_EVENTS||(CHANNEL_EVENTS={}));var TRANSPORTS;(function(te){te.websocket="websocket"})(TRANSPORTS||(TRANSPORTS={}));var CONNECTION_STATE;(function(te){te.Connecting="connecting",te.Open="open",te.Closing="closing",te.Closed="closed"})(CONNECTION_STATE||(CONNECTION_STATE={}));class Serializer{constructor(){this.HEADER_LENGTH=1}decode(ee,re){return ee.constructor===ArrayBuffer?re(this._binaryDecode(ee)):re(typeof ee=="string"?JSON.parse(ee):{})}_binaryDecode(ee){const re=new DataView(ee),ne=new TextDecoder;return this._decodeBroadcast(ee,re,ne)}_decodeBroadcast(ee,re,ne){const ie=re.getUint8(1),se=re.getUint8(2);let le=this.HEADER_LENGTH+2;const ue=ne.decode(ee.slice(le,le+ie));le=le+ie;const ae=ne.decode(ee.slice(le,le+se));le=le+se;const oe=JSON.parse(ne.decode(ee.slice(le,ee.byteLength)));return{ref:null,topic:ue,event:ae,payload:oe}}}class Timer{constructor(ee,re){this.callback=ee,this.timerCalc=re,this.timer=void 0,this.tries=0,this.callback=ee,this.timerCalc=re}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var PostgresTypes;(function(te){te.abstime="abstime",te.bool="bool",te.date="date",te.daterange="daterange",te.float4="float4",te.float8="float8",te.int2="int2",te.int4="int4",te.int4range="int4range",te.int8="int8",te.int8range="int8range",te.json="json",te.jsonb="jsonb",te.money="money",te.numeric="numeric",te.oid="oid",te.reltime="reltime",te.text="text",te.time="time",te.timestamp="timestamp",te.timestamptz="timestamptz",te.timetz="timetz",te.tsrange="tsrange",te.tstzrange="tstzrange"})(PostgresTypes||(PostgresTypes={}));const convertChangeData=(te,ee,re={})=>{var ne;const ie=(ne=re.skipTypes)!==null&&ne!==void 0?ne:[];return Object.keys(ee).reduce((se,le)=>(se[le]=convertColumn(le,te,ee,ie),se),{})},convertColumn=(te,ee,re,ne)=>{const ie=ee.find(ue=>ue.name===te),se=ie==null?void 0:ie.type,le=re[te];return se&&!ne.includes(se)?convertCell(se,le):noop$1(le)},convertCell=(te,ee)=>{if(te.charAt(0)==="_"){const re=te.slice(1,te.length);return toArray(ee,re)}switch(te){case PostgresTypes.bool:return toBoolean(ee);case PostgresTypes.float4:case PostgresTypes.float8:case PostgresTypes.int2:case PostgresTypes.int4:case PostgresTypes.int8:case PostgresTypes.numeric:case PostgresTypes.oid:return toNumber(ee);case PostgresTypes.json:case PostgresTypes.jsonb:return toJson(ee);case PostgresTypes.timestamp:return toTimestampString(ee);case PostgresTypes.abstime:case PostgresTypes.date:case PostgresTypes.daterange:case PostgresTypes.int4range:case PostgresTypes.int8range:case PostgresTypes.money:case PostgresTypes.reltime:case PostgresTypes.text:case PostgresTypes.time:case PostgresTypes.timestamptz:case PostgresTypes.timetz:case PostgresTypes.tsrange:case PostgresTypes.tstzrange:return noop$1(ee);default:return noop$1(ee)}},noop$1=te=>te,toBoolean=te=>{switch(te){case"t":return!0;case"f":return!1;default:return te}},toNumber=te=>{if(typeof te=="string"){const ee=parseFloat(te);if(!Number.isNaN(ee))return ee}return te},toJson=te=>{if(typeof te=="string")try{return JSON.parse(te)}catch(ee){return console.log(`JSON parse error: ${ee}`),te}return te},toArray=(te,ee)=>{if(typeof te!="string")return te;const re=te.length-1,ne=te[re];if(te[0]==="{"&&ne==="}"){let se;const le=te.slice(1,re);try{se=JSON.parse("["+le+"]")}catch{se=le?le.split(","):[]}return se.map(ue=>convertCell(ee,ue))}return te},toTimestampString=te=>typeof te=="string"?te.replace(" ","T"):te,httpEndpointURL=te=>{let ee=te;return ee=ee.replace(/^ws/i,"http"),ee=ee.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),ee.replace(/\/+$/,"")};class Push{constructor(ee,re,ne={},ie=DEFAULT_TIMEOUT){this.channel=ee,this.event=re,this.payload=ne,this.timeout=ie,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(ee){this.timeout=ee,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(ee){this.payload=Object.assign(Object.assign({},this.payload),ee)}receive(ee,re){var ne;return this._hasReceived(ee)&&re((ne=this.receivedResp)===null||ne===void 0?void 0:ne.response),this.recHooks.push({status:ee,callback:re}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const ee=re=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=re,this._matchReceive(re)};this.channel._on(this.refEvent,{},ee),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(ee,re){this.refEvent&&this.channel._trigger(this.refEvent,{status:ee,response:re})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:ee,response:re}){this.recHooks.filter(ne=>ne.status===ee).forEach(ne=>ne.callback(re))}_hasReceived(ee){return this.receivedResp&&this.receivedResp.status===ee}}var REALTIME_PRESENCE_LISTEN_EVENTS;(function(te){te.SYNC="sync",te.JOIN="join",te.LEAVE="leave"})(REALTIME_PRESENCE_LISTEN_EVENTS||(REALTIME_PRESENCE_LISTEN_EVENTS={}));class RealtimePresence{constructor(ee,re){this.channel=ee,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const ne=(re==null?void 0:re.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(ne.state,{},ie=>{const{onJoin:se,onLeave:le,onSync:ue}=this.caller;this.joinRef=this.channel._joinRef(),this.state=RealtimePresence.syncState(this.state,ie,se,le),this.pendingDiffs.forEach(ae=>{this.state=RealtimePresence.syncDiff(this.state,ae,se,le)}),this.pendingDiffs=[],ue()}),this.channel._on(ne.diff,{},ie=>{const{onJoin:se,onLeave:le,onSync:ue}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(ie):(this.state=RealtimePresence.syncDiff(this.state,ie,se,le),ue())}),this.onJoin((ie,se,le)=>{this.channel._trigger("presence",{event:"join",key:ie,currentPresences:se,newPresences:le})}),this.onLeave((ie,se,le)=>{this.channel._trigger("presence",{event:"leave",key:ie,currentPresences:se,leftPresences:le})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(ee,re,ne,ie){const se=this.cloneDeep(ee),le=this.transformState(re),ue={},ae={};return this.map(se,(oe,ce)=>{le[oe]||(ae[oe]=ce)}),this.map(le,(oe,ce)=>{const he=se[oe];if(he){const pe=ce.map(we=>we.presence_ref),de=he.map(we=>we.presence_ref),me=ce.filter(we=>de.indexOf(we.presence_ref)<0),ge=he.filter(we=>pe.indexOf(we.presence_ref)<0);me.length>0&&(ue[oe]=me),ge.length>0&&(ae[oe]=ge)}else ue[oe]=ce}),this.syncDiff(se,{joins:ue,leaves:ae},ne,ie)}static syncDiff(ee,re,ne,ie){const{joins:se,leaves:le}={joins:this.transformState(re.joins),leaves:this.transformState(re.leaves)};return ne||(ne=()=>{}),ie||(ie=()=>{}),this.map(se,(ue,ae)=>{var oe;const ce=(oe=ee[ue])!==null&&oe!==void 0?oe:[];if(ee[ue]=this.cloneDeep(ae),ce.length>0){const he=ee[ue].map(de=>de.presence_ref),pe=ce.filter(de=>he.indexOf(de.presence_ref)<0);ee[ue].unshift(...pe)}ne(ue,ce,ae)}),this.map(le,(ue,ae)=>{let oe=ee[ue];if(!oe)return;const ce=ae.map(he=>he.presence_ref);oe=oe.filter(he=>ce.indexOf(he.presence_ref)<0),ee[ue]=oe,ie(ue,oe,ae),oe.length===0&&delete ee[ue]}),ee}static map(ee,re){return Object.getOwnPropertyNames(ee).map(ne=>re(ne,ee[ne]))}static transformState(ee){return ee=this.cloneDeep(ee),Object.getOwnPropertyNames(ee).reduce((re,ne)=>{const ie=ee[ne];return"metas"in ie?re[ne]=ie.metas.map(se=>(se.presence_ref=se.phx_ref,delete se.phx_ref,delete se.phx_ref_prev,se)):re[ne]=ie,re},{})}static cloneDeep(ee){return JSON.parse(JSON.stringify(ee))}onJoin(ee){this.caller.onJoin=ee}onLeave(ee){this.caller.onLeave=ee}onSync(ee){this.caller.onSync=ee}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var REALTIME_POSTGRES_CHANGES_LISTEN_EVENT;(function(te){te.ALL="*",te.INSERT="INSERT",te.UPDATE="UPDATE",te.DELETE="DELETE"})(REALTIME_POSTGRES_CHANGES_LISTEN_EVENT||(REALTIME_POSTGRES_CHANGES_LISTEN_EVENT={}));var REALTIME_LISTEN_TYPES;(function(te){te.BROADCAST="broadcast",te.PRESENCE="presence",te.POSTGRES_CHANGES="postgres_changes",te.SYSTEM="system"})(REALTIME_LISTEN_TYPES||(REALTIME_LISTEN_TYPES={}));var REALTIME_SUBSCRIBE_STATES;(function(te){te.SUBSCRIBED="SUBSCRIBED",te.TIMED_OUT="TIMED_OUT",te.CLOSED="CLOSED",te.CHANNEL_ERROR="CHANNEL_ERROR"})(REALTIME_SUBSCRIBE_STATES||(REALTIME_SUBSCRIBE_STATES={}));class RealtimeChannel{constructor(ee,re={config:{}},ne){this.topic=ee,this.params=re,this.socket=ne,this.bindings={},this.state=CHANNEL_STATES.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=ee.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},re.config),this.timeout=this.socket.timeout,this.joinPush=new Push(this,CHANNEL_EVENTS.join,this.params,this.timeout),this.rejoinTimer=new Timer(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=CHANNEL_STATES.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(ie=>ie.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=CHANNEL_STATES.closed,this.socket._remove(this)}),this._onError(ie=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,ie),this.state=CHANNEL_STATES.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=CHANNEL_STATES.errored,this.rejoinTimer.scheduleTimeout())}),this._on(CHANNEL_EVENTS.reply,{},(ie,se)=>{this._trigger(this._replyEventName(se),ie)}),this.presence=new RealtimePresence(this),this.broadcastEndpointURL=httpEndpointURL(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(ee,re=this.timeout){var ne,ie;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:se,presence:le,private:ue}}=this.params;this._onError(ce=>ee==null?void 0:ee(REALTIME_SUBSCRIBE_STATES.CHANNEL_ERROR,ce)),this._onClose(()=>ee==null?void 0:ee(REALTIME_SUBSCRIBE_STATES.CLOSED));const ae={},oe={broadcast:se,presence:le,postgres_changes:(ie=(ne=this.bindings.postgres_changes)===null||ne===void 0?void 0:ne.map(ce=>ce.filter))!==null&&ie!==void 0?ie:[],private:ue};this.socket.accessTokenValue&&(ae.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:oe},ae)),this.joinedOnce=!0,this._rejoin(re),this.joinPush.receive("ok",async({postgres_changes:ce})=>{var he;if(this.socket.setAuth(),ce===void 0){ee==null||ee(REALTIME_SUBSCRIBE_STATES.SUBSCRIBED);return}else{const pe=this.bindings.postgres_changes,de=(he=pe==null?void 0:pe.length)!==null&&he!==void 0?he:0,me=[];for(let ge=0;ge<de;ge++){const we=pe[ge],{filter:{event:ve,schema:_e,table:Te,filter:ye}}=we,be=ce&&ce[ge];if(be&&be.event===ve&&be.schema===_e&&be.table===Te&&be.filter===ye)me.push(Object.assign(Object.assign({},we),{id:be.id}));else{this.unsubscribe(),ee==null||ee(REALTIME_SUBSCRIBE_STATES.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=me,ee&&ee(REALTIME_SUBSCRIBE_STATES.SUBSCRIBED);return}}).receive("error",ce=>{ee==null||ee(REALTIME_SUBSCRIBE_STATES.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(ce).join(", ")||"error")))}).receive("timeout",()=>{ee==null||ee(REALTIME_SUBSCRIBE_STATES.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(ee,re={}){return await this.send({type:"presence",event:"track",payload:ee},re.timeout||this.timeout)}async untrack(ee={}){return await this.send({type:"presence",event:"untrack"},ee)}on(ee,re,ne){return this._on(ee,re,ne)}async send(ee,re={}){var ne,ie;if(!this._canPush()&&ee.type==="broadcast"){const{event:se,payload:le}=ee,ae={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:se,payload:le,private:this.private}]})};try{const oe=await this._fetchWithTimeout(this.broadcastEndpointURL,ae,(ne=re.timeout)!==null&&ne!==void 0?ne:this.timeout);return await((ie=oe.body)===null||ie===void 0?void 0:ie.cancel()),oe.ok?"ok":"error"}catch(oe){return oe.name==="AbortError"?"timed out":"error"}}else return new Promise(se=>{var le,ue,ae;const oe=this._push(ee.type,ee,re.timeout||this.timeout);ee.type==="broadcast"&&!(!((ae=(ue=(le=this.params)===null||le===void 0?void 0:le.config)===null||ue===void 0?void 0:ue.broadcast)===null||ae===void 0)&&ae.ack)&&se("ok"),oe.receive("ok",()=>se("ok")),oe.receive("error",()=>se("error")),oe.receive("timeout",()=>se("timed out"))})}updateJoinPayload(ee){this.joinPush.updatePayload(ee)}unsubscribe(ee=this.timeout){this.state=CHANNEL_STATES.leaving;const re=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(CHANNEL_EVENTS.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(ne=>{const ie=new Push(this,CHANNEL_EVENTS.leave,{},ee);ie.receive("ok",()=>{re(),ne("ok")}).receive("timeout",()=>{re(),ne("timed out")}).receive("error",()=>{ne("error")}),ie.send(),this._canPush()||ie.trigger("ok",{})})}async _fetchWithTimeout(ee,re,ne){const ie=new AbortController,se=setTimeout(()=>ie.abort(),ne),le=await this.socket.fetch(ee,Object.assign(Object.assign({},re),{signal:ie.signal}));return clearTimeout(se),le}_push(ee,re,ne=this.timeout){if(!this.joinedOnce)throw`tried to push '${ee}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let ie=new Push(this,ee,re,ne);return this._canPush()?ie.send():(ie.startTimeout(),this.pushBuffer.push(ie)),ie}_onMessage(ee,re,ne){return re}_isMember(ee){return this.topic===ee}_joinRef(){return this.joinPush.ref}_trigger(ee,re,ne){var ie,se;const le=ee.toLocaleLowerCase(),{close:ue,error:ae,leave:oe,join:ce}=CHANNEL_EVENTS;if(ne&&[ue,ae,oe,ce].indexOf(le)>=0&&ne!==this._joinRef())return;let pe=this._onMessage(le,re,ne);if(re&&!pe)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(le)?(ie=this.bindings.postgres_changes)===null||ie===void 0||ie.filter(de=>{var me,ge,we;return((me=de.filter)===null||me===void 0?void 0:me.event)==="*"||((we=(ge=de.filter)===null||ge===void 0?void 0:ge.event)===null||we===void 0?void 0:we.toLocaleLowerCase())===le}).map(de=>de.callback(pe,ne)):(se=this.bindings[le])===null||se===void 0||se.filter(de=>{var me,ge,we,ve,_e,Te;if(["broadcast","presence","postgres_changes"].includes(le))if("id"in de){const ye=de.id,be=(me=de.filter)===null||me===void 0?void 0:me.event;return ye&&((ge=re.ids)===null||ge===void 0?void 0:ge.includes(ye))&&(be==="*"||(be==null?void 0:be.toLocaleLowerCase())===((we=re.data)===null||we===void 0?void 0:we.type.toLocaleLowerCase()))}else{const ye=(_e=(ve=de==null?void 0:de.filter)===null||ve===void 0?void 0:ve.event)===null||_e===void 0?void 0:_e.toLocaleLowerCase();return ye==="*"||ye===((Te=re==null?void 0:re.event)===null||Te===void 0?void 0:Te.toLocaleLowerCase())}else return de.type.toLocaleLowerCase()===le}).map(de=>{if(typeof pe=="object"&&"ids"in pe){const me=pe.data,{schema:ge,table:we,commit_timestamp:ve,type:_e,errors:Te}=me;pe=Object.assign(Object.assign({},{schema:ge,table:we,commit_timestamp:ve,eventType:_e,new:{},old:{},errors:Te}),this._getPayloadRecords(me))}de.callback(pe,ne)})}_isClosed(){return this.state===CHANNEL_STATES.closed}_isJoined(){return this.state===CHANNEL_STATES.joined}_isJoining(){return this.state===CHANNEL_STATES.joining}_isLeaving(){return this.state===CHANNEL_STATES.leaving}_replyEventName(ee){return`chan_reply_${ee}`}_on(ee,re,ne){const ie=ee.toLocaleLowerCase(),se={type:ie,filter:re,callback:ne};return this.bindings[ie]?this.bindings[ie].push(se):this.bindings[ie]=[se],this}_off(ee,re){const ne=ee.toLocaleLowerCase();return this.bindings[ne]=this.bindings[ne].filter(ie=>{var se;return!(((se=ie.type)===null||se===void 0?void 0:se.toLocaleLowerCase())===ne&&RealtimeChannel.isEqual(ie.filter,re))}),this}static isEqual(ee,re){if(Object.keys(ee).length!==Object.keys(re).length)return!1;for(const ne in ee)if(ee[ne]!==re[ne])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(ee){this._on(CHANNEL_EVENTS.close,{},ee)}_onError(ee){this._on(CHANNEL_EVENTS.error,{},re=>ee(re))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(ee=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=CHANNEL_STATES.joining,this.joinPush.resend(ee))}_getPayloadRecords(ee){const re={new:{},old:{}};return(ee.type==="INSERT"||ee.type==="UPDATE")&&(re.new=convertChangeData(ee.columns,ee.record)),(ee.type==="UPDATE"||ee.type==="DELETE")&&(re.old=convertChangeData(ee.columns,ee.old_record)),re}}const noop=()=>{},NATIVE_WEBSOCKET_AVAILABLE=typeof WebSocket<"u",WORKER_SCRIPT=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class RealtimeClient{constructor(ee,re){var ne;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=DEFAULT_HEADERS$3,this.params={},this.timeout=DEFAULT_TIMEOUT,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=noop,this.conn=null,this.sendBuffer=[],this.serializer=new Serializer,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=se=>{let le;return se?le=se:typeof fetch>"u"?le=(...ue)=>__vitePreload(()=>Promise.resolve().then(()=>browser),void 0,import.meta.url).then(({default:ae})=>ae(...ue)):le=fetch,(...ue)=>le(...ue)},this.endPoint=`${ee}/${TRANSPORTS.websocket}`,this.httpEndpoint=httpEndpointURL(ee),re!=null&&re.transport?this.transport=re.transport:this.transport=null,re!=null&&re.params&&(this.params=re.params),re!=null&&re.headers&&(this.headers=Object.assign(Object.assign({},this.headers),re.headers)),re!=null&&re.timeout&&(this.timeout=re.timeout),re!=null&&re.logger&&(this.logger=re.logger),re!=null&&re.heartbeatIntervalMs&&(this.heartbeatIntervalMs=re.heartbeatIntervalMs);const ie=(ne=re==null?void 0:re.params)===null||ne===void 0?void 0:ne.apikey;if(ie&&(this.accessTokenValue=ie,this.apiKey=ie),this.reconnectAfterMs=re!=null&&re.reconnectAfterMs?re.reconnectAfterMs:se=>[1e3,2e3,5e3,1e4][se-1]||1e4,this.encode=re!=null&&re.encode?re.encode:(se,le)=>le(JSON.stringify(se)),this.decode=re!=null&&re.decode?re.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Timer(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(re==null?void 0:re.fetch),re!=null&&re.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(re==null?void 0:re.worker)||!1,this.workerUrl=re==null?void 0:re.workerUrl}this.accessToken=(re==null?void 0:re.accessToken)||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(NATIVE_WEBSOCKET_AVAILABLE){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new WSWebSocketDummy(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),__vitePreload(()=>import("./browser-bcb242e5.js").then(ee=>ee.b),[],import.meta.url).then(({default:ee})=>{this.conn=new ee(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:VSN}))}disconnect(ee,re){this.conn&&(this.conn.onclose=function(){},ee?this.conn.close(ee,re??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(ee){const re=await ee.unsubscribe();return this.channels.length===0&&this.disconnect(),re}async removeAllChannels(){const ee=await Promise.all(this.channels.map(re=>re.unsubscribe()));return this.disconnect(),ee}log(ee,re,ne){this.logger(ee,re,ne)}connectionState(){switch(this.conn&&this.conn.readyState){case SOCKET_STATES.connecting:return CONNECTION_STATE.Connecting;case SOCKET_STATES.open:return CONNECTION_STATE.Open;case SOCKET_STATES.closing:return CONNECTION_STATE.Closing;default:return CONNECTION_STATE.Closed}}isConnected(){return this.connectionState()===CONNECTION_STATE.Open}channel(ee,re={config:{}}){const ne=new RealtimeChannel(`realtime:${ee}`,re,this);return this.channels.push(ne),ne}push(ee){const{topic:re,event:ne,payload:ie,ref:se}=ee,le=()=>{this.encode(ee,ue=>{var ae;(ae=this.conn)===null||ae===void 0||ae.send(ue)})};this.log("push",`${re} ${ne} (${se})`,ie),this.isConnected()?le():this.sendBuffer.push(le)}async setAuth(ee=null){let re=ee||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(re){let ne=null;try{ne=JSON.parse(atob(re.split(".")[1]))}catch{}if(ne&&ne.exp&&!(Math.floor(Date.now()/1e3)-ne.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${ne.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${ne.exp}`);this.accessTokenValue=re,this.channels.forEach(ie=>{re&&ie.updateJoinPayload({access_token:re}),ie.joinedOnce&&ie._isJoined()&&ie._push(CHANNEL_EVENTS.access_token,{access_token:re})})}}async sendHeartbeat(){var ee;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(ee=this.conn)===null||ee===void 0||ee.close(WS_CLOSE_NORMAL,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(ee=>ee()),this.sendBuffer=[])}_makeRef(){let ee=this.ref+1;return ee===this.ref?this.ref=0:this.ref=ee,this.ref.toString()}_leaveOpenTopic(ee){let re=this.channels.find(ne=>ne.topic===ee&&(ne._isJoined()||ne._isJoining()));re&&(this.log("transport",`leaving duplicate topic "${ee}"`),re.unsubscribe())}_remove(ee){this.channels=this.channels.filter(re=>re._joinRef()!==ee._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=ee=>this._onConnError(ee),this.conn.onmessage=ee=>this._onConnMessage(ee),this.conn.onclose=ee=>this._onConnClose(ee))}_onConnMessage(ee){this.decode(ee.data,re=>{let{topic:ne,event:ie,payload:se,ref:le}=re;le&&le===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${se.status||""} ${ne} ${ie} ${le&&"("+le+")"||""}`,se),this.channels.filter(ue=>ue._isMember(ne)).forEach(ue=>ue._trigger(ie,se,le)),this.stateChangeCallbacks.message.forEach(ue=>ue(re))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const ee=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(ee),this.workerRef.onerror=re=>{this.log("worker","worker error",re.message),this.workerRef.terminate()},this.workerRef.onmessage=re=>{re.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(ee=>ee())}_onConnClose(ee){this.log("transport","close",ee),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(re=>re(ee))}_onConnError(ee){this.log("transport",ee.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(re=>re(ee))}_triggerChanError(){this.channels.forEach(ee=>ee._trigger(CHANNEL_EVENTS.error))}_appendParams(ee,re){if(Object.keys(re).length===0)return ee;const ne=ee.match(/\?/)?"&":"?",ie=new URLSearchParams(re);return`${ee}${ne}${ie}`}_workerObjectUrl(ee){let re;if(ee)re=ee;else{const ne=new Blob([WORKER_SCRIPT],{type:"application/javascript"});re=URL.createObjectURL(ne)}return re}}class WSWebSocketDummy{constructor(ee,re,ne){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=SOCKET_STATES.connecting,this.send=()=>{},this.url=null,this.url=ee,this.close=ne.close}}class StorageError extends Error{constructor(ee){super(ee),this.__isStorageError=!0,this.name="StorageError"}}function isStorageError(te){return typeof te=="object"&&te!==null&&"__isStorageError"in te}class StorageApiError extends StorageError{constructor(ee,re){super(ee),this.name="StorageApiError",this.status=re}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class StorageUnknownError extends StorageError{constructor(ee,re){super(ee),this.name="StorageUnknownError",this.originalError=re}}var __awaiter$6=globalThis&&globalThis.__awaiter||function(te,ee,re,ne){function ie(se){return se instanceof re?se:new re(function(le){le(se)})}return new(re||(re=Promise))(function(se,le){function ue(ce){try{oe(ne.next(ce))}catch(he){le(he)}}function ae(ce){try{oe(ne.throw(ce))}catch(he){le(he)}}function oe(ce){ce.done?se(ce.value):ie(ce.value).then(ue,ae)}oe((ne=ne.apply(te,ee||[])).next())})};const resolveFetch$2=te=>{let ee;return te?ee=te:typeof fetch>"u"?ee=(...re)=>__vitePreload(()=>Promise.resolve().then(()=>browser),void 0,import.meta.url).then(({default:ne})=>ne(...re)):ee=fetch,(...re)=>ee(...re)},resolveResponse=()=>__awaiter$6(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield __vitePreload(()=>Promise.resolve().then(()=>browser),void 0,import.meta.url)).Response:Response}),recursiveToCamel=te=>{if(Array.isArray(te))return te.map(re=>recursiveToCamel(re));if(typeof te=="function"||te!==Object(te))return te;const ee={};return Object.entries(te).forEach(([re,ne])=>{const ie=re.replace(/([-_][a-z])/gi,se=>se.toUpperCase().replace(/[-_]/g,""));ee[ie]=recursiveToCamel(ne)}),ee};var __awaiter$5=globalThis&&globalThis.__awaiter||function(te,ee,re,ne){function ie(se){return se instanceof re?se:new re(function(le){le(se)})}return new(re||(re=Promise))(function(se,le){function ue(ce){try{oe(ne.next(ce))}catch(he){le(he)}}function ae(ce){try{oe(ne.throw(ce))}catch(he){le(he)}}function oe(ce){ce.done?se(ce.value):ie(ce.value).then(ue,ae)}oe((ne=ne.apply(te,ee||[])).next())})};const _getErrorMessage$1=te=>te.msg||te.message||te.error_description||te.error||JSON.stringify(te),handleError$1=(te,ee,re)=>__awaiter$5(void 0,void 0,void 0,function*(){const ne=yield resolveResponse();te instanceof ne&&!(re!=null&&re.noResolveJson)?te.json().then(ie=>{ee(new StorageApiError(_getErrorMessage$1(ie),te.status||500))}).catch(ie=>{ee(new StorageUnknownError(_getErrorMessage$1(ie),ie))}):ee(new StorageUnknownError(_getErrorMessage$1(te),te))}),_getRequestParams$1=(te,ee,re,ne)=>{const ie={method:te,headers:(ee==null?void 0:ee.headers)||{}};return te==="GET"?ie:(ie.headers=Object.assign({"Content-Type":"application/json"},ee==null?void 0:ee.headers),ne&&(ie.body=JSON.stringify(ne)),Object.assign(Object.assign({},ie),re))};function _handleRequest$1(te,ee,re,ne,ie,se){return __awaiter$5(this,void 0,void 0,function*(){return new Promise((le,ue)=>{te(re,_getRequestParams$1(ee,ne,ie,se)).then(ae=>{if(!ae.ok)throw ae;return ne!=null&&ne.noResolveJson?ae:ae.json()}).then(ae=>le(ae)).catch(ae=>handleError$1(ae,ue,ne))})})}function get(te,ee,re,ne){return __awaiter$5(this,void 0,void 0,function*(){return _handleRequest$1(te,"GET",ee,re,ne)})}function post(te,ee,re,ne,ie){return __awaiter$5(this,void 0,void 0,function*(){return _handleRequest$1(te,"POST",ee,ne,ie,re)})}function put(te,ee,re,ne,ie){return __awaiter$5(this,void 0,void 0,function*(){return _handleRequest$1(te,"PUT",ee,ne,ie,re)})}function head(te,ee,re,ne){return __awaiter$5(this,void 0,void 0,function*(){return _handleRequest$1(te,"HEAD",ee,Object.assign(Object.assign({},re),{noResolveJson:!0}),ne)})}function remove(te,ee,re,ne,ie){return __awaiter$5(this,void 0,void 0,function*(){return _handleRequest$1(te,"DELETE",ee,ne,ie,re)})}var __awaiter$4=globalThis&&globalThis.__awaiter||function(te,ee,re,ne){function ie(se){return se instanceof re?se:new re(function(le){le(se)})}return new(re||(re=Promise))(function(se,le){function ue(ce){try{oe(ne.next(ce))}catch(he){le(he)}}function ae(ce){try{oe(ne.throw(ce))}catch(he){le(he)}}function oe(ce){ce.done?se(ce.value):ie(ce.value).then(ue,ae)}oe((ne=ne.apply(te,ee||[])).next())})};const DEFAULT_SEARCH_OPTIONS={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},DEFAULT_FILE_OPTIONS={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class StorageFileApi{constructor(ee,re={},ne,ie){this.url=ee,this.headers=re,this.bucketId=ne,this.fetch=resolveFetch$2(ie)}uploadOrUpdate(ee,re,ne,ie){return __awaiter$4(this,void 0,void 0,function*(){try{let se;const le=Object.assign(Object.assign({},DEFAULT_FILE_OPTIONS),ie);let ue=Object.assign(Object.assign({},this.headers),ee==="POST"&&{"x-upsert":String(le.upsert)});const ae=le.metadata;typeof Blob<"u"&&ne instanceof Blob?(se=new FormData,se.append("cacheControl",le.cacheControl),ae&&se.append("metadata",this.encodeMetadata(ae)),se.append("",ne)):typeof FormData<"u"&&ne instanceof FormData?(se=ne,se.append("cacheControl",le.cacheControl),ae&&se.append("metadata",this.encodeMetadata(ae))):(se=ne,ue["cache-control"]=`max-age=${le.cacheControl}`,ue["content-type"]=le.contentType,ae&&(ue["x-metadata"]=this.toBase64(this.encodeMetadata(ae)))),ie!=null&&ie.headers&&(ue=Object.assign(Object.assign({},ue),ie.headers));const oe=this._removeEmptyFolders(re),ce=this._getFinalPath(oe),he=yield this.fetch(`${this.url}/object/${ce}`,Object.assign({method:ee,body:se,headers:ue},le!=null&&le.duplex?{duplex:le.duplex}:{})),pe=yield he.json();return he.ok?{data:{path:oe,id:pe.Id,fullPath:pe.Key},error:null}:{data:null,error:pe}}catch(se){if(isStorageError(se))return{data:null,error:se};throw se}})}upload(ee,re,ne){return __awaiter$4(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",ee,re,ne)})}uploadToSignedUrl(ee,re,ne,ie){return __awaiter$4(this,void 0,void 0,function*(){const se=this._removeEmptyFolders(ee),le=this._getFinalPath(se),ue=new URL(this.url+`/object/upload/sign/${le}`);ue.searchParams.set("token",re);try{let ae;const oe=Object.assign({upsert:DEFAULT_FILE_OPTIONS.upsert},ie),ce=Object.assign(Object.assign({},this.headers),{"x-upsert":String(oe.upsert)});typeof Blob<"u"&&ne instanceof Blob?(ae=new FormData,ae.append("cacheControl",oe.cacheControl),ae.append("",ne)):typeof FormData<"u"&&ne instanceof FormData?(ae=ne,ae.append("cacheControl",oe.cacheControl)):(ae=ne,ce["cache-control"]=`max-age=${oe.cacheControl}`,ce["content-type"]=oe.contentType);const he=yield this.fetch(ue.toString(),{method:"PUT",body:ae,headers:ce}),pe=yield he.json();return he.ok?{data:{path:se,fullPath:pe.Key},error:null}:{data:null,error:pe}}catch(ae){if(isStorageError(ae))return{data:null,error:ae};throw ae}})}createSignedUploadUrl(ee,re){return __awaiter$4(this,void 0,void 0,function*(){try{let ne=this._getFinalPath(ee);const ie=Object.assign({},this.headers);re!=null&&re.upsert&&(ie["x-upsert"]="true");const se=yield post(this.fetch,`${this.url}/object/upload/sign/${ne}`,{},{headers:ie}),le=new URL(this.url+se.url),ue=le.searchParams.get("token");if(!ue)throw new StorageError("No token returned by API");return{data:{signedUrl:le.toString(),path:ee,token:ue},error:null}}catch(ne){if(isStorageError(ne))return{data:null,error:ne};throw ne}})}update(ee,re,ne){return __awaiter$4(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",ee,re,ne)})}move(ee,re,ne){return __awaiter$4(this,void 0,void 0,function*(){try{return{data:yield post(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:ee,destinationKey:re,destinationBucket:ne==null?void 0:ne.destinationBucket},{headers:this.headers}),error:null}}catch(ie){if(isStorageError(ie))return{data:null,error:ie};throw ie}})}copy(ee,re,ne){return __awaiter$4(this,void 0,void 0,function*(){try{return{data:{path:(yield post(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:ee,destinationKey:re,destinationBucket:ne==null?void 0:ne.destinationBucket},{headers:this.headers})).Key},error:null}}catch(ie){if(isStorageError(ie))return{data:null,error:ie};throw ie}})}createSignedUrl(ee,re,ne){return __awaiter$4(this,void 0,void 0,function*(){try{let ie=this._getFinalPath(ee),se=yield post(this.fetch,`${this.url}/object/sign/${ie}`,Object.assign({expiresIn:re},ne!=null&&ne.transform?{transform:ne.transform}:{}),{headers:this.headers});const le=ne!=null&&ne.download?`&download=${ne.download===!0?"":ne.download}`:"";return se={signedUrl:encodeURI(`${this.url}${se.signedURL}${le}`)},{data:se,error:null}}catch(ie){if(isStorageError(ie))return{data:null,error:ie};throw ie}})}createSignedUrls(ee,re,ne){return __awaiter$4(this,void 0,void 0,function*(){try{const ie=yield post(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:re,paths:ee},{headers:this.headers}),se=ne!=null&&ne.download?`&download=${ne.download===!0?"":ne.download}`:"";return{data:ie.map(le=>Object.assign(Object.assign({},le),{signedUrl:le.signedURL?encodeURI(`${this.url}${le.signedURL}${se}`):null})),error:null}}catch(ie){if(isStorageError(ie))return{data:null,error:ie};throw ie}})}download(ee,re){return __awaiter$4(this,void 0,void 0,function*(){const ie=typeof(re==null?void 0:re.transform)<"u"?"render/image/authenticated":"object",se=this.transformOptsToQueryString((re==null?void 0:re.transform)||{}),le=se?`?${se}`:"";try{const ue=this._getFinalPath(ee);return{data:yield(yield get(this.fetch,`${this.url}/${ie}/${ue}${le}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(ue){if(isStorageError(ue))return{data:null,error:ue};throw ue}})}info(ee){return __awaiter$4(this,void 0,void 0,function*(){const re=this._getFinalPath(ee);try{const ne=yield get(this.fetch,`${this.url}/object/info/${re}`,{headers:this.headers});return{data:recursiveToCamel(ne),error:null}}catch(ne){if(isStorageError(ne))return{data:null,error:ne};throw ne}})}exists(ee){return __awaiter$4(this,void 0,void 0,function*(){const re=this._getFinalPath(ee);try{return yield head(this.fetch,`${this.url}/object/${re}`,{headers:this.headers}),{data:!0,error:null}}catch(ne){if(isStorageError(ne)&&ne instanceof StorageUnknownError){const ie=ne.originalError;if([400,404].includes(ie==null?void 0:ie.status))return{data:!1,error:ne}}throw ne}})}getPublicUrl(ee,re){const ne=this._getFinalPath(ee),ie=[],se=re!=null&&re.download?`download=${re.download===!0?"":re.download}`:"";se!==""&&ie.push(se);const ue=typeof(re==null?void 0:re.transform)<"u"?"render/image":"object",ae=this.transformOptsToQueryString((re==null?void 0:re.transform)||{});ae!==""&&ie.push(ae);let oe=ie.join("&");return oe!==""&&(oe=`?${oe}`),{data:{publicUrl:encodeURI(`${this.url}/${ue}/public/${ne}${oe}`)}}}remove(ee){return __awaiter$4(this,void 0,void 0,function*(){try{return{data:yield remove(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:ee},{headers:this.headers}),error:null}}catch(re){if(isStorageError(re))return{data:null,error:re};throw re}})}list(ee,re,ne){return __awaiter$4(this,void 0,void 0,function*(){try{const ie=Object.assign(Object.assign(Object.assign({},DEFAULT_SEARCH_OPTIONS),re),{prefix:ee||""});return{data:yield post(this.fetch,`${this.url}/object/list/${this.bucketId}`,ie,{headers:this.headers},ne),error:null}}catch(ie){if(isStorageError(ie))return{data:null,error:ie};throw ie}})}encodeMetadata(ee){return JSON.stringify(ee)}toBase64(ee){return typeof Buffer<"u"?Buffer.from(ee).toString("base64"):btoa(ee)}_getFinalPath(ee){return`${this.bucketId}/${ee}`}_removeEmptyFolders(ee){return ee.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(ee){const re=[];return ee.width&&re.push(`width=${ee.width}`),ee.height&&re.push(`height=${ee.height}`),ee.resize&&re.push(`resize=${ee.resize}`),ee.format&&re.push(`format=${ee.format}`),ee.quality&&re.push(`quality=${ee.quality}`),re.join("&")}}const version$2="2.7.1",DEFAULT_HEADERS$2={"X-Client-Info":`storage-js/${version$2}`};var __awaiter$3=globalThis&&globalThis.__awaiter||function(te,ee,re,ne){function ie(se){return se instanceof re?se:new re(function(le){le(se)})}return new(re||(re=Promise))(function(se,le){function ue(ce){try{oe(ne.next(ce))}catch(he){le(he)}}function ae(ce){try{oe(ne.throw(ce))}catch(he){le(he)}}function oe(ce){ce.done?se(ce.value):ie(ce.value).then(ue,ae)}oe((ne=ne.apply(te,ee||[])).next())})};class StorageBucketApi{constructor(ee,re={},ne){this.url=ee,this.headers=Object.assign(Object.assign({},DEFAULT_HEADERS$2),re),this.fetch=resolveFetch$2(ne)}listBuckets(){return __awaiter$3(this,void 0,void 0,function*(){try{return{data:yield get(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(ee){if(isStorageError(ee))return{data:null,error:ee};throw ee}})}getBucket(ee){return __awaiter$3(this,void 0,void 0,function*(){try{return{data:yield get(this.fetch,`${this.url}/bucket/${ee}`,{headers:this.headers}),error:null}}catch(re){if(isStorageError(re))return{data:null,error:re};throw re}})}createBucket(ee,re={public:!1}){return __awaiter$3(this,void 0,void 0,function*(){try{return{data:yield post(this.fetch,`${this.url}/bucket`,{id:ee,name:ee,public:re.public,file_size_limit:re.fileSizeLimit,allowed_mime_types:re.allowedMimeTypes},{headers:this.headers}),error:null}}catch(ne){if(isStorageError(ne))return{data:null,error:ne};throw ne}})}updateBucket(ee,re){return __awaiter$3(this,void 0,void 0,function*(){try{return{data:yield put(this.fetch,`${this.url}/bucket/${ee}`,{id:ee,name:ee,public:re.public,file_size_limit:re.fileSizeLimit,allowed_mime_types:re.allowedMimeTypes},{headers:this.headers}),error:null}}catch(ne){if(isStorageError(ne))return{data:null,error:ne};throw ne}})}emptyBucket(ee){return __awaiter$3(this,void 0,void 0,function*(){try{return{data:yield post(this.fetch,`${this.url}/bucket/${ee}/empty`,{},{headers:this.headers}),error:null}}catch(re){if(isStorageError(re))return{data:null,error:re};throw re}})}deleteBucket(ee){return __awaiter$3(this,void 0,void 0,function*(){try{return{data:yield remove(this.fetch,`${this.url}/bucket/${ee}`,{},{headers:this.headers}),error:null}}catch(re){if(isStorageError(re))return{data:null,error:re};throw re}})}}class StorageClient extends StorageBucketApi{constructor(ee,re={},ne){super(ee,re,ne)}from(ee){return new StorageFileApi(this.url,this.headers,ee,this.fetch)}}const version$1="2.49.4";let JS_ENV="";typeof Deno<"u"?JS_ENV="deno":typeof document<"u"?JS_ENV="web":typeof navigator<"u"&&navigator.product==="ReactNative"?JS_ENV="react-native":JS_ENV="node";const DEFAULT_HEADERS$1={"X-Client-Info":`supabase-js-${JS_ENV}/${version$1}`},DEFAULT_GLOBAL_OPTIONS={headers:DEFAULT_HEADERS$1},DEFAULT_DB_OPTIONS={schema:"public"},DEFAULT_AUTH_OPTIONS={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},DEFAULT_REALTIME_OPTIONS={};var __awaiter$2=globalThis&&globalThis.__awaiter||function(te,ee,re,ne){function ie(se){return se instanceof re?se:new re(function(le){le(se)})}return new(re||(re=Promise))(function(se,le){function ue(ce){try{oe(ne.next(ce))}catch(he){le(he)}}function ae(ce){try{oe(ne.throw(ce))}catch(he){le(he)}}function oe(ce){ce.done?se(ce.value):ie(ce.value).then(ue,ae)}oe((ne=ne.apply(te,ee||[])).next())})};const resolveFetch$1=te=>{let ee;return te?ee=te:typeof fetch>"u"?ee=nodeFetch:ee=fetch,(...re)=>ee(...re)},resolveHeadersConstructor=()=>typeof Headers>"u"?Headers$1:Headers,fetchWithAuth=(te,ee,re)=>{const ne=resolveFetch$1(re),ie=resolveHeadersConstructor();return(se,le)=>__awaiter$2(void 0,void 0,void 0,function*(){var ue;const ae=(ue=yield ee())!==null&&ue!==void 0?ue:te;let oe=new ie(le==null?void 0:le.headers);return oe.has("apikey")||oe.set("apikey",te),oe.has("Authorization")||oe.set("Authorization",`Bearer ${ae}`),ne(se,Object.assign(Object.assign({},le),{headers:oe}))})};var __awaiter$1=globalThis&&globalThis.__awaiter||function(te,ee,re,ne){function ie(se){return se instanceof re?se:new re(function(le){le(se)})}return new(re||(re=Promise))(function(se,le){function ue(ce){try{oe(ne.next(ce))}catch(he){le(he)}}function ae(ce){try{oe(ne.throw(ce))}catch(he){le(he)}}function oe(ce){ce.done?se(ce.value):ie(ce.value).then(ue,ae)}oe((ne=ne.apply(te,ee||[])).next())})};function stripTrailingSlash(te){return te.replace(/\/$/,"")}function applySettingDefaults(te,ee){const{db:re,auth:ne,realtime:ie,global:se}=te,{db:le,auth:ue,realtime:ae,global:oe}=ee,ce={db:Object.assign(Object.assign({},le),re),auth:Object.assign(Object.assign({},ue),ne),realtime:Object.assign(Object.assign({},ae),ie),global:Object.assign(Object.assign({},oe),se),accessToken:()=>__awaiter$1(this,void 0,void 0,function*(){return""})};return te.accessToken?ce.accessToken=te.accessToken:delete ce.accessToken,ce}const version="2.69.1",AUTO_REFRESH_TICK_DURATION_MS=30*1e3,AUTO_REFRESH_TICK_THRESHOLD=3,EXPIRY_MARGIN_MS=AUTO_REFRESH_TICK_THRESHOLD*AUTO_REFRESH_TICK_DURATION_MS,GOTRUE_URL="http://localhost:9999",STORAGE_KEY="supabase.auth.token",DEFAULT_HEADERS={"X-Client-Info":`gotrue-js/${version}`},API_VERSION_HEADER_NAME="X-Supabase-Api-Version",API_VERSIONS={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},BASE64URL_REGEX=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,JWKS_TTL=6e5;class AuthError extends Error{constructor(ee,re,ne){super(ee),this.__isAuthError=!0,this.name="AuthError",this.status=re,this.code=ne}}function isAuthError(te){return typeof te=="object"&&te!==null&&"__isAuthError"in te}class AuthApiError extends AuthError{constructor(ee,re,ne){super(ee,re,ne),this.name="AuthApiError",this.status=re,this.code=ne}}function isAuthApiError(te){return isAuthError(te)&&te.name==="AuthApiError"}class AuthUnknownError extends AuthError{constructor(ee,re){super(ee),this.name="AuthUnknownError",this.originalError=re}}class CustomAuthError extends AuthError{constructor(ee,re,ne,ie){super(ee,ne,ie),this.name=re,this.status=ne}}class AuthSessionMissingError extends CustomAuthError{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function isAuthSessionMissingError(te){return isAuthError(te)&&te.name==="AuthSessionMissingError"}class AuthInvalidTokenResponseError extends CustomAuthError{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class AuthInvalidCredentialsError extends CustomAuthError{constructor(ee){super(ee,"AuthInvalidCredentialsError",400,void 0)}}class AuthImplicitGrantRedirectError extends CustomAuthError{constructor(ee,re=null){super(ee,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=re}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function isAuthImplicitGrantRedirectError(te){return isAuthError(te)&&te.name==="AuthImplicitGrantRedirectError"}class AuthPKCEGrantCodeExchangeError extends CustomAuthError{constructor(ee,re=null){super(ee,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=re}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class AuthRetryableFetchError extends CustomAuthError{constructor(ee,re){super(ee,"AuthRetryableFetchError",re,void 0)}}function isAuthRetryableFetchError(te){return isAuthError(te)&&te.name==="AuthRetryableFetchError"}class AuthWeakPasswordError extends CustomAuthError{constructor(ee,re,ne){super(ee,"AuthWeakPasswordError",re,"weak_password"),this.reasons=ne}}class AuthInvalidJwtError extends CustomAuthError{constructor(ee){super(ee,"AuthInvalidJwtError",400,"invalid_jwt")}}const TO_BASE64URL="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),IGNORE_BASE64URL=` 	
\r=`.split(""),FROM_BASE64URL=(()=>{const te=new Array(128);for(let ee=0;ee<te.length;ee+=1)te[ee]=-1;for(let ee=0;ee<IGNORE_BASE64URL.length;ee+=1)te[IGNORE_BASE64URL[ee].charCodeAt(0)]=-2;for(let ee=0;ee<TO_BASE64URL.length;ee+=1)te[TO_BASE64URL[ee].charCodeAt(0)]=ee;return te})();function byteFromBase64URL(te,ee,re){const ne=FROM_BASE64URL[te];if(ne>-1)for(ee.queue=ee.queue<<6|ne,ee.queuedBits+=6;ee.queuedBits>=8;)re(ee.queue>>ee.queuedBits-8&255),ee.queuedBits-=8;else{if(ne===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(te)}"`)}}function stringFromBase64URL(te){const ee=[],re=le=>{ee.push(String.fromCodePoint(le))},ne={utf8seq:0,codepoint:0},ie={queue:0,queuedBits:0},se=le=>{stringFromUTF8(le,ne,re)};for(let le=0;le<te.length;le+=1)byteFromBase64URL(te.charCodeAt(le),ie,se);return ee.join("")}function codepointToUTF8(te,ee){if(te<=127){ee(te);return}else if(te<=2047){ee(192|te>>6),ee(128|te&63);return}else if(te<=65535){ee(224|te>>12),ee(128|te>>6&63),ee(128|te&63);return}else if(te<=1114111){ee(240|te>>18),ee(128|te>>12&63),ee(128|te>>6&63),ee(128|te&63);return}throw new Error(`Unrecognized Unicode codepoint: ${te.toString(16)}`)}function stringToUTF8(te,ee){for(let re=0;re<te.length;re+=1){let ne=te.charCodeAt(re);if(ne>55295&&ne<=56319){const ie=(ne-55296)*1024&65535;ne=(te.charCodeAt(re+1)-56320&65535|ie)+65536,re+=1}codepointToUTF8(ne,ee)}}function stringFromUTF8(te,ee,re){if(ee.utf8seq===0){if(te<=127){re(te);return}for(let ne=1;ne<6;ne+=1)if(!(te>>7-ne&1)){ee.utf8seq=ne;break}if(ee.utf8seq===2)ee.codepoint=te&31;else if(ee.utf8seq===3)ee.codepoint=te&15;else if(ee.utf8seq===4)ee.codepoint=te&7;else throw new Error("Invalid UTF-8 sequence");ee.utf8seq-=1}else if(ee.utf8seq>0){if(te<=127)throw new Error("Invalid UTF-8 sequence");ee.codepoint=ee.codepoint<<6|te&63,ee.utf8seq-=1,ee.utf8seq===0&&re(ee.codepoint)}}function base64UrlToUint8Array(te){const ee=[],re={queue:0,queuedBits:0},ne=ie=>{ee.push(ie)};for(let ie=0;ie<te.length;ie+=1)byteFromBase64URL(te.charCodeAt(ie),re,ne);return new Uint8Array(ee)}function stringToUint8Array(te){const ee=[];return stringToUTF8(te,re=>ee.push(re)),new Uint8Array(ee)}function expiresAt(te){return Math.round(Date.now()/1e3)+te}function uuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(te){const ee=Math.random()*16|0;return(te=="x"?ee:ee&3|8).toString(16)})}const isBrowser=()=>typeof window<"u"&&typeof document<"u",localStorageWriteTests={tested:!1,writable:!1},supportsLocalStorage=()=>{if(!isBrowser())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(localStorageWriteTests.tested)return localStorageWriteTests.writable;const te=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(te,te),globalThis.localStorage.removeItem(te),localStorageWriteTests.tested=!0,localStorageWriteTests.writable=!0}catch{localStorageWriteTests.tested=!0,localStorageWriteTests.writable=!1}return localStorageWriteTests.writable};function parseParametersFromURL(te){const ee={},re=new URL(te);if(re.hash&&re.hash[0]==="#")try{new URLSearchParams(re.hash.substring(1)).forEach((ie,se)=>{ee[se]=ie})}catch{}return re.searchParams.forEach((ne,ie)=>{ee[ie]=ne}),ee}const resolveFetch=te=>{let ee;return te?ee=te:typeof fetch>"u"?ee=(...re)=>__vitePreload(()=>Promise.resolve().then(()=>browser),void 0,import.meta.url).then(({default:ne})=>ne(...re)):ee=fetch,(...re)=>ee(...re)},looksLikeFetchResponse=te=>typeof te=="object"&&te!==null&&"status"in te&&"ok"in te&&"json"in te&&typeof te.json=="function",setItemAsync=async(te,ee,re)=>{await te.setItem(ee,JSON.stringify(re))},getItemAsync=async(te,ee)=>{const re=await te.getItem(ee);if(!re)return null;try{return JSON.parse(re)}catch{return re}},removeItemAsync=async(te,ee)=>{await te.removeItem(ee)};class Deferred{constructor(){this.promise=new Deferred.promiseConstructor((ee,re)=>{this.resolve=ee,this.reject=re})}}Deferred.promiseConstructor=Promise;function decodeJWT(te){const ee=te.split(".");if(ee.length!==3)throw new AuthInvalidJwtError("Invalid JWT structure");for(let ne=0;ne<ee.length;ne++)if(!BASE64URL_REGEX.test(ee[ne]))throw new AuthInvalidJwtError("JWT not in base64url format");return{header:JSON.parse(stringFromBase64URL(ee[0])),payload:JSON.parse(stringFromBase64URL(ee[1])),signature:base64UrlToUint8Array(ee[2]),raw:{header:ee[0],payload:ee[1]}}}async function sleep(te){return await new Promise(ee=>{setTimeout(()=>ee(null),te)})}function retryable(te,ee){return new Promise((ne,ie)=>{(async()=>{for(let se=0;se<1/0;se++)try{const le=await te(se);if(!ee(se,null,le)){ne(le);return}}catch(le){if(!ee(se,le)){ie(le);return}}})()})}function dec2hex(te){return("0"+te.toString(16)).substr(-2)}function generatePKCEVerifier(){const ee=new Uint32Array(56);if(typeof crypto>"u"){const re="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",ne=re.length;let ie="";for(let se=0;se<56;se++)ie+=re.charAt(Math.floor(Math.random()*ne));return ie}return crypto.getRandomValues(ee),Array.from(ee,dec2hex).join("")}async function sha256(te){const re=new TextEncoder().encode(te),ne=await crypto.subtle.digest("SHA-256",re),ie=new Uint8Array(ne);return Array.from(ie).map(se=>String.fromCharCode(se)).join("")}async function generatePKCEChallenge(te){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),te;const re=await sha256(te);return btoa(re).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function getCodeChallengeAndMethod(te,ee,re=!1){const ne=generatePKCEVerifier();let ie=ne;re&&(ie+="/PASSWORD_RECOVERY"),await setItemAsync(te,`${ee}-code-verifier`,ie);const se=await generatePKCEChallenge(ne);return[se,ne===se?"plain":"s256"]}const API_VERSION_REGEX=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function parseResponseAPIVersion(te){const ee=te.headers.get(API_VERSION_HEADER_NAME);if(!ee||!ee.match(API_VERSION_REGEX))return null;try{return new Date(`${ee}T00:00:00.0Z`)}catch{return null}}function validateExp(te){if(!te)throw new Error("Missing exp claim");const ee=Math.floor(Date.now()/1e3);if(te<=ee)throw new Error("JWT has expired")}function getAlgorithm(te){switch(te){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}var __rest$1=globalThis&&globalThis.__rest||function(te,ee){var re={};for(var ne in te)Object.prototype.hasOwnProperty.call(te,ne)&&ee.indexOf(ne)<0&&(re[ne]=te[ne]);if(te!=null&&typeof Object.getOwnPropertySymbols=="function")for(var ie=0,ne=Object.getOwnPropertySymbols(te);ie<ne.length;ie++)ee.indexOf(ne[ie])<0&&Object.prototype.propertyIsEnumerable.call(te,ne[ie])&&(re[ne[ie]]=te[ne[ie]]);return re};const _getErrorMessage=te=>te.msg||te.message||te.error_description||te.error||JSON.stringify(te),NETWORK_ERROR_CODES=[502,503,504];async function handleError(te){var ee;if(!looksLikeFetchResponse(te))throw new AuthRetryableFetchError(_getErrorMessage(te),0);if(NETWORK_ERROR_CODES.includes(te.status))throw new AuthRetryableFetchError(_getErrorMessage(te),te.status);let re;try{re=await te.json()}catch(se){throw new AuthUnknownError(_getErrorMessage(se),se)}let ne;const ie=parseResponseAPIVersion(te);if(ie&&ie.getTime()>=API_VERSIONS["2024-01-01"].timestamp&&typeof re=="object"&&re&&typeof re.code=="string"?ne=re.code:typeof re=="object"&&re&&typeof re.error_code=="string"&&(ne=re.error_code),ne){if(ne==="weak_password")throw new AuthWeakPasswordError(_getErrorMessage(re),te.status,((ee=re.weak_password)===null||ee===void 0?void 0:ee.reasons)||[]);if(ne==="session_not_found")throw new AuthSessionMissingError}else if(typeof re=="object"&&re&&typeof re.weak_password=="object"&&re.weak_password&&Array.isArray(re.weak_password.reasons)&&re.weak_password.reasons.length&&re.weak_password.reasons.reduce((se,le)=>se&&typeof le=="string",!0))throw new AuthWeakPasswordError(_getErrorMessage(re),te.status,re.weak_password.reasons);throw new AuthApiError(_getErrorMessage(re),te.status||500,ne)}const _getRequestParams=(te,ee,re,ne)=>{const ie={method:te,headers:(ee==null?void 0:ee.headers)||{}};return te==="GET"?ie:(ie.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},ee==null?void 0:ee.headers),ie.body=JSON.stringify(ne),Object.assign(Object.assign({},ie),re))};async function _request(te,ee,re,ne){var ie;const se=Object.assign({},ne==null?void 0:ne.headers);se[API_VERSION_HEADER_NAME]||(se[API_VERSION_HEADER_NAME]=API_VERSIONS["2024-01-01"].name),ne!=null&&ne.jwt&&(se.Authorization=`Bearer ${ne.jwt}`);const le=(ie=ne==null?void 0:ne.query)!==null&&ie!==void 0?ie:{};ne!=null&&ne.redirectTo&&(le.redirect_to=ne.redirectTo);const ue=Object.keys(le).length?"?"+new URLSearchParams(le).toString():"",ae=await _handleRequest(te,ee,re+ue,{headers:se,noResolveJson:ne==null?void 0:ne.noResolveJson},{},ne==null?void 0:ne.body);return ne!=null&&ne.xform?ne==null?void 0:ne.xform(ae):{data:Object.assign({},ae),error:null}}async function _handleRequest(te,ee,re,ne,ie,se){const le=_getRequestParams(ee,ne,ie,se);let ue;try{ue=await te(re,Object.assign({},le))}catch(ae){throw console.error(ae),new AuthRetryableFetchError(_getErrorMessage(ae),0)}if(ue.ok||await handleError(ue),ne!=null&&ne.noResolveJson)return ue;try{return await ue.json()}catch(ae){await handleError(ae)}}function _sessionResponse(te){var ee;let re=null;hasSession(te)&&(re=Object.assign({},te),te.expires_at||(re.expires_at=expiresAt(te.expires_in)));const ne=(ee=te.user)!==null&&ee!==void 0?ee:te;return{data:{session:re,user:ne},error:null}}function _sessionResponsePassword(te){const ee=_sessionResponse(te);return!ee.error&&te.weak_password&&typeof te.weak_password=="object"&&Array.isArray(te.weak_password.reasons)&&te.weak_password.reasons.length&&te.weak_password.message&&typeof te.weak_password.message=="string"&&te.weak_password.reasons.reduce((re,ne)=>re&&typeof ne=="string",!0)&&(ee.data.weak_password=te.weak_password),ee}function _userResponse(te){var ee;return{data:{user:(ee=te.user)!==null&&ee!==void 0?ee:te},error:null}}function _ssoResponse(te){return{data:te,error:null}}function _generateLinkResponse(te){const{action_link:ee,email_otp:re,hashed_token:ne,redirect_to:ie,verification_type:se}=te,le=__rest$1(te,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),ue={action_link:ee,email_otp:re,hashed_token:ne,redirect_to:ie,verification_type:se},ae=Object.assign({},le);return{data:{properties:ue,user:ae},error:null}}function _noResolveJsonResponse(te){return te}function hasSession(te){return te.access_token&&te.refresh_token&&te.expires_in}var __rest=globalThis&&globalThis.__rest||function(te,ee){var re={};for(var ne in te)Object.prototype.hasOwnProperty.call(te,ne)&&ee.indexOf(ne)<0&&(re[ne]=te[ne]);if(te!=null&&typeof Object.getOwnPropertySymbols=="function")for(var ie=0,ne=Object.getOwnPropertySymbols(te);ie<ne.length;ie++)ee.indexOf(ne[ie])<0&&Object.prototype.propertyIsEnumerable.call(te,ne[ie])&&(re[ne[ie]]=te[ne[ie]]);return re};class GoTrueAdminApi{constructor({url:ee="",headers:re={},fetch:ne}){this.url=ee,this.headers=re,this.fetch=resolveFetch(ne),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(ee,re="global"){try{return await _request(this.fetch,"POST",`${this.url}/logout?scope=${re}`,{headers:this.headers,jwt:ee,noResolveJson:!0}),{data:null,error:null}}catch(ne){if(isAuthError(ne))return{data:null,error:ne};throw ne}}async inviteUserByEmail(ee,re={}){try{return await _request(this.fetch,"POST",`${this.url}/invite`,{body:{email:ee,data:re.data},headers:this.headers,redirectTo:re.redirectTo,xform:_userResponse})}catch(ne){if(isAuthError(ne))return{data:{user:null},error:ne};throw ne}}async generateLink(ee){try{const{options:re}=ee,ne=__rest(ee,["options"]),ie=Object.assign(Object.assign({},ne),re);return"newEmail"in ne&&(ie.new_email=ne==null?void 0:ne.newEmail,delete ie.newEmail),await _request(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:ie,headers:this.headers,xform:_generateLinkResponse,redirectTo:re==null?void 0:re.redirectTo})}catch(re){if(isAuthError(re))return{data:{properties:null,user:null},error:re};throw re}}async createUser(ee){try{return await _request(this.fetch,"POST",`${this.url}/admin/users`,{body:ee,headers:this.headers,xform:_userResponse})}catch(re){if(isAuthError(re))return{data:{user:null},error:re};throw re}}async listUsers(ee){var re,ne,ie,se,le,ue,ae;try{const oe={nextPage:null,lastPage:0,total:0},ce=await _request(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(ne=(re=ee==null?void 0:ee.page)===null||re===void 0?void 0:re.toString())!==null&&ne!==void 0?ne:"",per_page:(se=(ie=ee==null?void 0:ee.perPage)===null||ie===void 0?void 0:ie.toString())!==null&&se!==void 0?se:""},xform:_noResolveJsonResponse});if(ce.error)throw ce.error;const he=await ce.json(),pe=(le=ce.headers.get("x-total-count"))!==null&&le!==void 0?le:0,de=(ae=(ue=ce.headers.get("link"))===null||ue===void 0?void 0:ue.split(","))!==null&&ae!==void 0?ae:[];return de.length>0&&(de.forEach(me=>{const ge=parseInt(me.split(";")[0].split("=")[1].substring(0,1)),we=JSON.parse(me.split(";")[1].split("=")[1]);oe[`${we}Page`]=ge}),oe.total=parseInt(pe)),{data:Object.assign(Object.assign({},he),oe),error:null}}catch(oe){if(isAuthError(oe))return{data:{users:[]},error:oe};throw oe}}async getUserById(ee){try{return await _request(this.fetch,"GET",`${this.url}/admin/users/${ee}`,{headers:this.headers,xform:_userResponse})}catch(re){if(isAuthError(re))return{data:{user:null},error:re};throw re}}async updateUserById(ee,re){try{return await _request(this.fetch,"PUT",`${this.url}/admin/users/${ee}`,{body:re,headers:this.headers,xform:_userResponse})}catch(ne){if(isAuthError(ne))return{data:{user:null},error:ne};throw ne}}async deleteUser(ee,re=!1){try{return await _request(this.fetch,"DELETE",`${this.url}/admin/users/${ee}`,{headers:this.headers,body:{should_soft_delete:re},xform:_userResponse})}catch(ne){if(isAuthError(ne))return{data:{user:null},error:ne};throw ne}}async _listFactors(ee){try{const{data:re,error:ne}=await _request(this.fetch,"GET",`${this.url}/admin/users/${ee.userId}/factors`,{headers:this.headers,xform:ie=>({data:{factors:ie},error:null})});return{data:re,error:ne}}catch(re){if(isAuthError(re))return{data:null,error:re};throw re}}async _deleteFactor(ee){try{return{data:await _request(this.fetch,"DELETE",`${this.url}/admin/users/${ee.userId}/factors/${ee.id}`,{headers:this.headers}),error:null}}catch(re){if(isAuthError(re))return{data:null,error:re};throw re}}}const localStorageAdapter={getItem:te=>supportsLocalStorage()?globalThis.localStorage.getItem(te):null,setItem:(te,ee)=>{supportsLocalStorage()&&globalThis.localStorage.setItem(te,ee)},removeItem:te=>{supportsLocalStorage()&&globalThis.localStorage.removeItem(te)}};function memoryLocalStorageAdapter(te={}){return{getItem:ee=>te[ee]||null,setItem:(ee,re)=>{te[ee]=re},removeItem:ee=>{delete te[ee]}}}function polyfillGlobalThis(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const internals={debug:!!(globalThis&&supportsLocalStorage()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class LockAcquireTimeoutError extends Error{constructor(ee){super(ee),this.isAcquireTimeout=!0}}class NavigatorLockAcquireTimeoutError extends LockAcquireTimeoutError{}async function navigatorLock(te,ee,re){internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",te,ee);const ne=new globalThis.AbortController;return ee>0&&setTimeout(()=>{ne.abort(),internals.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",te)},ee),await Promise.resolve().then(()=>globalThis.navigator.locks.request(te,ee===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:ne.signal},async ie=>{if(ie){internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",te,ie.name);try{return await re()}finally{internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",te,ie.name)}}else{if(ee===0)throw internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",te),new NavigatorLockAcquireTimeoutError(`Acquiring an exclusive Navigator LockManager lock "${te}" immediately failed`);if(internals.debug)try{const se=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(se,null,"  "))}catch(se){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",se)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await re()}}))}polyfillGlobalThis();const DEFAULT_OPTIONS={url:GOTRUE_URL,storageKey:STORAGE_KEY,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:DEFAULT_HEADERS,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function lockNoOp(te,ee,re){return await re()}class GoTrueClient{constructor(ee){var re,ne;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=GoTrueClient.nextInstanceID,GoTrueClient.nextInstanceID+=1,this.instanceID>0&&isBrowser()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const ie=Object.assign(Object.assign({},DEFAULT_OPTIONS),ee);if(this.logDebugMessages=!!ie.debug,typeof ie.debug=="function"&&(this.logger=ie.debug),this.persistSession=ie.persistSession,this.storageKey=ie.storageKey,this.autoRefreshToken=ie.autoRefreshToken,this.admin=new GoTrueAdminApi({url:ie.url,headers:ie.headers,fetch:ie.fetch}),this.url=ie.url,this.headers=ie.headers,this.fetch=resolveFetch(ie.fetch),this.lock=ie.lock||lockNoOp,this.detectSessionInUrl=ie.detectSessionInUrl,this.flowType=ie.flowType,this.hasCustomAuthorizationHeader=ie.hasCustomAuthorizationHeader,ie.lock?this.lock=ie.lock:isBrowser()&&(!((re=globalThis==null?void 0:globalThis.navigator)===null||re===void 0)&&re.locks)?this.lock=navigatorLock:this.lock=lockNoOp,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?ie.storage?this.storage=ie.storage:supportsLocalStorage()?this.storage=localStorageAdapter:(this.memoryStorage={},this.storage=memoryLocalStorageAdapter(this.memoryStorage)):(this.memoryStorage={},this.storage=memoryLocalStorageAdapter(this.memoryStorage)),isBrowser()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(se){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",se)}(ne=this.broadcastChannel)===null||ne===void 0||ne.addEventListener("message",async se=>{this._debug("received broadcast notification from other tab or client",se),await this._notifyAllSubscribers(se.data.event,se.data.session,!1)})}this.initialize()}_debug(...ee){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${version}) ${new Date().toISOString()}`,...ee),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var ee;try{const re=parseParametersFromURL(window.location.href);let ne="none";if(this._isImplicitGrantCallback(re)?ne="implicit":await this._isPKCECallback(re)&&(ne="pkce"),isBrowser()&&this.detectSessionInUrl&&ne!=="none"){const{data:ie,error:se}=await this._getSessionFromURL(re,ne);if(se){if(this._debug("#_initialize()","error detecting session from URL",se),isAuthImplicitGrantRedirectError(se)){const ae=(ee=se.details)===null||ee===void 0?void 0:ee.code;if(ae==="identity_already_exists"||ae==="identity_not_found"||ae==="single_identity_not_deletable")return{error:se}}return await this._removeSession(),{error:se}}const{session:le,redirectType:ue}=ie;return this._debug("#_initialize()","detected session in URL",le,"redirect type",ue),await this._saveSession(le),setTimeout(async()=>{ue==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",le):await this._notifyAllSubscribers("SIGNED_IN",le)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(re){return isAuthError(re)?{error:re}:{error:new AuthUnknownError("Unexpected error during initialization",re)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(ee){var re,ne,ie;try{const se=await _request(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(ne=(re=ee==null?void 0:ee.options)===null||re===void 0?void 0:re.data)!==null&&ne!==void 0?ne:{},gotrue_meta_security:{captcha_token:(ie=ee==null?void 0:ee.options)===null||ie===void 0?void 0:ie.captchaToken}},xform:_sessionResponse}),{data:le,error:ue}=se;if(ue||!le)return{data:{user:null,session:null},error:ue};const ae=le.session,oe=le.user;return le.session&&(await this._saveSession(le.session),await this._notifyAllSubscribers("SIGNED_IN",ae)),{data:{user:oe,session:ae},error:null}}catch(se){if(isAuthError(se))return{data:{user:null,session:null},error:se};throw se}}async signUp(ee){var re,ne,ie;try{let se;if("email"in ee){const{email:ce,password:he,options:pe}=ee;let de=null,me=null;this.flowType==="pkce"&&([de,me]=await getCodeChallengeAndMethod(this.storage,this.storageKey)),se=await _request(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:pe==null?void 0:pe.emailRedirectTo,body:{email:ce,password:he,data:(re=pe==null?void 0:pe.data)!==null&&re!==void 0?re:{},gotrue_meta_security:{captcha_token:pe==null?void 0:pe.captchaToken},code_challenge:de,code_challenge_method:me},xform:_sessionResponse})}else if("phone"in ee){const{phone:ce,password:he,options:pe}=ee;se=await _request(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:ce,password:he,data:(ne=pe==null?void 0:pe.data)!==null&&ne!==void 0?ne:{},channel:(ie=pe==null?void 0:pe.channel)!==null&&ie!==void 0?ie:"sms",gotrue_meta_security:{captcha_token:pe==null?void 0:pe.captchaToken}},xform:_sessionResponse})}else throw new AuthInvalidCredentialsError("You must provide either an email or phone number and a password");const{data:le,error:ue}=se;if(ue||!le)return{data:{user:null,session:null},error:ue};const ae=le.session,oe=le.user;return le.session&&(await this._saveSession(le.session),await this._notifyAllSubscribers("SIGNED_IN",ae)),{data:{user:oe,session:ae},error:null}}catch(se){if(isAuthError(se))return{data:{user:null,session:null},error:se};throw se}}async signInWithPassword(ee){try{let re;if("email"in ee){const{email:se,password:le,options:ue}=ee;re=await _request(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:se,password:le,gotrue_meta_security:{captcha_token:ue==null?void 0:ue.captchaToken}},xform:_sessionResponsePassword})}else if("phone"in ee){const{phone:se,password:le,options:ue}=ee;re=await _request(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:se,password:le,gotrue_meta_security:{captcha_token:ue==null?void 0:ue.captchaToken}},xform:_sessionResponsePassword})}else throw new AuthInvalidCredentialsError("You must provide either an email or phone number and a password");const{data:ne,error:ie}=re;return ie?{data:{user:null,session:null},error:ie}:!ne||!ne.session||!ne.user?{data:{user:null,session:null},error:new AuthInvalidTokenResponseError}:(ne.session&&(await this._saveSession(ne.session),await this._notifyAllSubscribers("SIGNED_IN",ne.session)),{data:Object.assign({user:ne.user,session:ne.session},ne.weak_password?{weakPassword:ne.weak_password}:null),error:ie})}catch(re){if(isAuthError(re))return{data:{user:null,session:null},error:re};throw re}}async signInWithOAuth(ee){var re,ne,ie,se;return await this._handleProviderSignIn(ee.provider,{redirectTo:(re=ee.options)===null||re===void 0?void 0:re.redirectTo,scopes:(ne=ee.options)===null||ne===void 0?void 0:ne.scopes,queryParams:(ie=ee.options)===null||ie===void 0?void 0:ie.queryParams,skipBrowserRedirect:(se=ee.options)===null||se===void 0?void 0:se.skipBrowserRedirect})}async exchangeCodeForSession(ee){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(ee))}async _exchangeCodeForSession(ee){const re=await getItemAsync(this.storage,`${this.storageKey}-code-verifier`),[ne,ie]=(re??"").split("/");try{const{data:se,error:le}=await _request(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:ee,code_verifier:ne},xform:_sessionResponse});if(await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`),le)throw le;return!se||!se.session||!se.user?{data:{user:null,session:null,redirectType:null},error:new AuthInvalidTokenResponseError}:(se.session&&(await this._saveSession(se.session),await this._notifyAllSubscribers("SIGNED_IN",se.session)),{data:Object.assign(Object.assign({},se),{redirectType:ie??null}),error:le})}catch(se){if(isAuthError(se))return{data:{user:null,session:null,redirectType:null},error:se};throw se}}async signInWithIdToken(ee){try{const{options:re,provider:ne,token:ie,access_token:se,nonce:le}=ee,ue=await _request(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:ne,id_token:ie,access_token:se,nonce:le,gotrue_meta_security:{captcha_token:re==null?void 0:re.captchaToken}},xform:_sessionResponse}),{data:ae,error:oe}=ue;return oe?{data:{user:null,session:null},error:oe}:!ae||!ae.session||!ae.user?{data:{user:null,session:null},error:new AuthInvalidTokenResponseError}:(ae.session&&(await this._saveSession(ae.session),await this._notifyAllSubscribers("SIGNED_IN",ae.session)),{data:ae,error:oe})}catch(re){if(isAuthError(re))return{data:{user:null,session:null},error:re};throw re}}async signInWithOtp(ee){var re,ne,ie,se,le;try{if("email"in ee){const{email:ue,options:ae}=ee;let oe=null,ce=null;this.flowType==="pkce"&&([oe,ce]=await getCodeChallengeAndMethod(this.storage,this.storageKey));const{error:he}=await _request(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:ue,data:(re=ae==null?void 0:ae.data)!==null&&re!==void 0?re:{},create_user:(ne=ae==null?void 0:ae.shouldCreateUser)!==null&&ne!==void 0?ne:!0,gotrue_meta_security:{captcha_token:ae==null?void 0:ae.captchaToken},code_challenge:oe,code_challenge_method:ce},redirectTo:ae==null?void 0:ae.emailRedirectTo});return{data:{user:null,session:null},error:he}}if("phone"in ee){const{phone:ue,options:ae}=ee,{data:oe,error:ce}=await _request(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:ue,data:(ie=ae==null?void 0:ae.data)!==null&&ie!==void 0?ie:{},create_user:(se=ae==null?void 0:ae.shouldCreateUser)!==null&&se!==void 0?se:!0,gotrue_meta_security:{captcha_token:ae==null?void 0:ae.captchaToken},channel:(le=ae==null?void 0:ae.channel)!==null&&le!==void 0?le:"sms"}});return{data:{user:null,session:null,messageId:oe==null?void 0:oe.message_id},error:ce}}throw new AuthInvalidCredentialsError("You must provide either an email or phone number.")}catch(ue){if(isAuthError(ue))return{data:{user:null,session:null},error:ue};throw ue}}async verifyOtp(ee){var re,ne;try{let ie,se;"options"in ee&&(ie=(re=ee.options)===null||re===void 0?void 0:re.redirectTo,se=(ne=ee.options)===null||ne===void 0?void 0:ne.captchaToken);const{data:le,error:ue}=await _request(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},ee),{gotrue_meta_security:{captcha_token:se}}),redirectTo:ie,xform:_sessionResponse});if(ue)throw ue;if(!le)throw new Error("An error occurred on token verification.");const ae=le.session,oe=le.user;return ae!=null&&ae.access_token&&(await this._saveSession(ae),await this._notifyAllSubscribers(ee.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",ae)),{data:{user:oe,session:ae},error:null}}catch(ie){if(isAuthError(ie))return{data:{user:null,session:null},error:ie};throw ie}}async signInWithSSO(ee){var re,ne,ie;try{let se=null,le=null;return this.flowType==="pkce"&&([se,le]=await getCodeChallengeAndMethod(this.storage,this.storageKey)),await _request(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in ee?{provider_id:ee.providerId}:null),"domain"in ee?{domain:ee.domain}:null),{redirect_to:(ne=(re=ee.options)===null||re===void 0?void 0:re.redirectTo)!==null&&ne!==void 0?ne:void 0}),!((ie=ee==null?void 0:ee.options)===null||ie===void 0)&&ie.captchaToken?{gotrue_meta_security:{captcha_token:ee.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:se,code_challenge_method:le}),headers:this.headers,xform:_ssoResponse})}catch(se){if(isAuthError(se))return{data:null,error:se};throw se}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async ee=>{const{data:{session:re},error:ne}=ee;if(ne)throw ne;if(!re)throw new AuthSessionMissingError;const{error:ie}=await _request(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:re.access_token});return{data:{user:null,session:null},error:ie}})}catch(ee){if(isAuthError(ee))return{data:{user:null,session:null},error:ee};throw ee}}async resend(ee){try{const re=`${this.url}/resend`;if("email"in ee){const{email:ne,type:ie,options:se}=ee,{error:le}=await _request(this.fetch,"POST",re,{headers:this.headers,body:{email:ne,type:ie,gotrue_meta_security:{captcha_token:se==null?void 0:se.captchaToken}},redirectTo:se==null?void 0:se.emailRedirectTo});return{data:{user:null,session:null},error:le}}else if("phone"in ee){const{phone:ne,type:ie,options:se}=ee,{data:le,error:ue}=await _request(this.fetch,"POST",re,{headers:this.headers,body:{phone:ne,type:ie,gotrue_meta_security:{captcha_token:se==null?void 0:se.captchaToken}}});return{data:{user:null,session:null,messageId:le==null?void 0:le.message_id},error:ue}}throw new AuthInvalidCredentialsError("You must provide either an email or phone number and a type")}catch(re){if(isAuthError(re))return{data:{user:null,session:null},error:re};throw re}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async re=>re))}async _acquireLock(ee,re){this._debug("#_acquireLock","begin",ee);try{if(this.lockAcquired){const ne=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),ie=(async()=>(await ne,await re()))();return this.pendingInLock.push((async()=>{try{await ie}catch{}})()),ie}return await this.lock(`lock:${this.storageKey}`,ee,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const ne=re();for(this.pendingInLock.push((async()=>{try{await ne}catch{}})()),await ne;this.pendingInLock.length;){const ie=[...this.pendingInLock];await Promise.all(ie),this.pendingInLock.splice(0,ie.length)}return await ne}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(ee){this._debug("#_useSession","begin");try{const re=await this.__loadSession();return await ee(re)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let ee=null;const re=await getItemAsync(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",re),re!==null&&(this._isValidSession(re)?ee=re:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!ee)return{data:{session:null},error:null};const ne=ee.expires_at?ee.expires_at*1e3-Date.now()<EXPIRY_MARGIN_MS:!1;if(this._debug("#__loadSession()",`session has${ne?"":" not"} expired`,"expires_at",ee.expires_at),!ne){if(this.storage.isServer){let le=this.suppressGetSessionWarning;ee=new Proxy(ee,{get:(ae,oe,ce)=>(!le&&oe==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),le=!0,this.suppressGetSessionWarning=!0),Reflect.get(ae,oe,ce))})}return{data:{session:ee},error:null}}const{session:ie,error:se}=await this._callRefreshToken(ee.refresh_token);return se?{data:{session:null},error:se}:{data:{session:ie},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(ee){return ee?await this._getUser(ee):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(ee){try{return ee?await _request(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:ee,xform:_userResponse}):await this._useSession(async re=>{var ne,ie,se;const{data:le,error:ue}=re;if(ue)throw ue;return!(!((ne=le.session)===null||ne===void 0)&&ne.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new AuthSessionMissingError}:await _request(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(se=(ie=le.session)===null||ie===void 0?void 0:ie.access_token)!==null&&se!==void 0?se:void 0,xform:_userResponse})})}catch(re){if(isAuthError(re))return isAuthSessionMissingError(re)&&(await this._removeSession(),await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:re};throw re}}async updateUser(ee,re={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(ee,re))}async _updateUser(ee,re={}){try{return await this._useSession(async ne=>{const{data:ie,error:se}=ne;if(se)throw se;if(!ie.session)throw new AuthSessionMissingError;const le=ie.session;let ue=null,ae=null;this.flowType==="pkce"&&ee.email!=null&&([ue,ae]=await getCodeChallengeAndMethod(this.storage,this.storageKey));const{data:oe,error:ce}=await _request(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:re==null?void 0:re.emailRedirectTo,body:Object.assign(Object.assign({},ee),{code_challenge:ue,code_challenge_method:ae}),jwt:le.access_token,xform:_userResponse});if(ce)throw ce;return le.user=oe.user,await this._saveSession(le),await this._notifyAllSubscribers("USER_UPDATED",le),{data:{user:le.user},error:null}})}catch(ne){if(isAuthError(ne))return{data:{user:null},error:ne};throw ne}}async setSession(ee){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(ee))}async _setSession(ee){try{if(!ee.access_token||!ee.refresh_token)throw new AuthSessionMissingError;const re=Date.now()/1e3;let ne=re,ie=!0,se=null;const{payload:le}=decodeJWT(ee.access_token);if(le.exp&&(ne=le.exp,ie=ne<=re),ie){const{session:ue,error:ae}=await this._callRefreshToken(ee.refresh_token);if(ae)return{data:{user:null,session:null},error:ae};if(!ue)return{data:{user:null,session:null},error:null};se=ue}else{const{data:ue,error:ae}=await this._getUser(ee.access_token);if(ae)throw ae;se={access_token:ee.access_token,refresh_token:ee.refresh_token,user:ue.user,token_type:"bearer",expires_in:ne-re,expires_at:ne},await this._saveSession(se),await this._notifyAllSubscribers("SIGNED_IN",se)}return{data:{user:se.user,session:se},error:null}}catch(re){if(isAuthError(re))return{data:{session:null,user:null},error:re};throw re}}async refreshSession(ee){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(ee))}async _refreshSession(ee){try{return await this._useSession(async re=>{var ne;if(!ee){const{data:le,error:ue}=re;if(ue)throw ue;ee=(ne=le.session)!==null&&ne!==void 0?ne:void 0}if(!(ee!=null&&ee.refresh_token))throw new AuthSessionMissingError;const{session:ie,error:se}=await this._callRefreshToken(ee.refresh_token);return se?{data:{user:null,session:null},error:se}:ie?{data:{user:ie.user,session:ie},error:null}:{data:{user:null,session:null},error:null}})}catch(re){if(isAuthError(re))return{data:{user:null,session:null},error:re};throw re}}async _getSessionFromURL(ee,re){try{if(!isBrowser())throw new AuthImplicitGrantRedirectError("No browser detected.");if(ee.error||ee.error_description||ee.error_code)throw new AuthImplicitGrantRedirectError(ee.error_description||"Error in URL with unspecified error_description",{error:ee.error||"unspecified_error",code:ee.error_code||"unspecified_code"});switch(re){case"implicit":if(this.flowType==="pkce")throw new AuthPKCEGrantCodeExchangeError("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new AuthImplicitGrantRedirectError("Not a valid implicit grant flow url.");break;default:}if(re==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!ee.code)throw new AuthPKCEGrantCodeExchangeError("No code detected.");const{data:_e,error:Te}=await this._exchangeCodeForSession(ee.code);if(Te)throw Te;const ye=new URL(window.location.href);return ye.searchParams.delete("code"),window.history.replaceState(window.history.state,"",ye.toString()),{data:{session:_e.session,redirectType:null},error:null}}const{provider_token:ne,provider_refresh_token:ie,access_token:se,refresh_token:le,expires_in:ue,expires_at:ae,token_type:oe}=ee;if(!se||!ue||!le||!oe)throw new AuthImplicitGrantRedirectError("No session defined in URL");const ce=Math.round(Date.now()/1e3),he=parseInt(ue);let pe=ce+he;ae&&(pe=parseInt(ae));const de=pe-ce;de*1e3<=AUTO_REFRESH_TICK_DURATION_MS&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${de}s, should have been closer to ${he}s`);const me=pe-he;ce-me>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",me,pe,ce):ce-me<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",me,pe,ce);const{data:ge,error:we}=await this._getUser(se);if(we)throw we;const ve={provider_token:ne,provider_refresh_token:ie,access_token:se,expires_in:he,expires_at:pe,refresh_token:le,token_type:oe,user:ge.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:ve,redirectType:ee.type},error:null}}catch(ne){if(isAuthError(ne))return{data:{session:null,redirectType:null},error:ne};throw ne}}_isImplicitGrantCallback(ee){return!!(ee.access_token||ee.error_description)}async _isPKCECallback(ee){const re=await getItemAsync(this.storage,`${this.storageKey}-code-verifier`);return!!(ee.code&&re)}async signOut(ee={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(ee))}async _signOut({scope:ee}={scope:"global"}){return await this._useSession(async re=>{var ne;const{data:ie,error:se}=re;if(se)return{error:se};const le=(ne=ie.session)===null||ne===void 0?void 0:ne.access_token;if(le){const{error:ue}=await this.admin.signOut(le,ee);if(ue&&!(isAuthApiError(ue)&&(ue.status===404||ue.status===401||ue.status===403)))return{error:ue}}return ee!=="others"&&(await this._removeSession(),await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(ee){const re=uuid(),ne={id:re,callback:ee,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",re),this.stateChangeEmitters.delete(re)}};return this._debug("#onAuthStateChange()","registered callback with id",re),this.stateChangeEmitters.set(re,ne),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(re)})))(),{data:{subscription:ne}}}async _emitInitialSession(ee){return await this._useSession(async re=>{var ne,ie;try{const{data:{session:se},error:le}=re;if(le)throw le;await((ne=this.stateChangeEmitters.get(ee))===null||ne===void 0?void 0:ne.callback("INITIAL_SESSION",se)),this._debug("INITIAL_SESSION","callback id",ee,"session",se)}catch(se){await((ie=this.stateChangeEmitters.get(ee))===null||ie===void 0?void 0:ie.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",ee,"error",se),console.error(se)}})}async resetPasswordForEmail(ee,re={}){let ne=null,ie=null;this.flowType==="pkce"&&([ne,ie]=await getCodeChallengeAndMethod(this.storage,this.storageKey,!0));try{return await _request(this.fetch,"POST",`${this.url}/recover`,{body:{email:ee,code_challenge:ne,code_challenge_method:ie,gotrue_meta_security:{captcha_token:re.captchaToken}},headers:this.headers,redirectTo:re.redirectTo})}catch(se){if(isAuthError(se))return{data:null,error:se};throw se}}async getUserIdentities(){var ee;try{const{data:re,error:ne}=await this.getUser();if(ne)throw ne;return{data:{identities:(ee=re.user.identities)!==null&&ee!==void 0?ee:[]},error:null}}catch(re){if(isAuthError(re))return{data:null,error:re};throw re}}async linkIdentity(ee){var re;try{const{data:ne,error:ie}=await this._useSession(async se=>{var le,ue,ae,oe,ce;const{data:he,error:pe}=se;if(pe)throw pe;const de=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,ee.provider,{redirectTo:(le=ee.options)===null||le===void 0?void 0:le.redirectTo,scopes:(ue=ee.options)===null||ue===void 0?void 0:ue.scopes,queryParams:(ae=ee.options)===null||ae===void 0?void 0:ae.queryParams,skipBrowserRedirect:!0});return await _request(this.fetch,"GET",de,{headers:this.headers,jwt:(ce=(oe=he.session)===null||oe===void 0?void 0:oe.access_token)!==null&&ce!==void 0?ce:void 0})});if(ie)throw ie;return isBrowser()&&!(!((re=ee.options)===null||re===void 0)&&re.skipBrowserRedirect)&&window.location.assign(ne==null?void 0:ne.url),{data:{provider:ee.provider,url:ne==null?void 0:ne.url},error:null}}catch(ne){if(isAuthError(ne))return{data:{provider:ee.provider,url:null},error:ne};throw ne}}async unlinkIdentity(ee){try{return await this._useSession(async re=>{var ne,ie;const{data:se,error:le}=re;if(le)throw le;return await _request(this.fetch,"DELETE",`${this.url}/user/identities/${ee.identity_id}`,{headers:this.headers,jwt:(ie=(ne=se.session)===null||ne===void 0?void 0:ne.access_token)!==null&&ie!==void 0?ie:void 0})})}catch(re){if(isAuthError(re))return{data:null,error:re};throw re}}async _refreshAccessToken(ee){const re=`#_refreshAccessToken(${ee.substring(0,5)}...)`;this._debug(re,"begin");try{const ne=Date.now();return await retryable(async ie=>(ie>0&&await sleep(200*Math.pow(2,ie-1)),this._debug(re,"refreshing attempt",ie),await _request(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:ee},headers:this.headers,xform:_sessionResponse})),(ie,se)=>{const le=200*Math.pow(2,ie);return se&&isAuthRetryableFetchError(se)&&Date.now()+le-ne<AUTO_REFRESH_TICK_DURATION_MS})}catch(ne){if(this._debug(re,"error",ne),isAuthError(ne))return{data:{session:null,user:null},error:ne};throw ne}finally{this._debug(re,"end")}}_isValidSession(ee){return typeof ee=="object"&&ee!==null&&"access_token"in ee&&"refresh_token"in ee&&"expires_at"in ee}async _handleProviderSignIn(ee,re){const ne=await this._getUrlForProvider(`${this.url}/authorize`,ee,{redirectTo:re.redirectTo,scopes:re.scopes,queryParams:re.queryParams});return this._debug("#_handleProviderSignIn()","provider",ee,"options",re,"url",ne),isBrowser()&&!re.skipBrowserRedirect&&window.location.assign(ne),{data:{provider:ee,url:ne},error:null}}async _recoverAndRefresh(){var ee;const re="#_recoverAndRefresh()";this._debug(re,"begin");try{const ne=await getItemAsync(this.storage,this.storageKey);if(this._debug(re,"session from storage",ne),!this._isValidSession(ne)){this._debug(re,"session is not valid"),ne!==null&&await this._removeSession();return}const ie=((ee=ne.expires_at)!==null&&ee!==void 0?ee:1/0)*1e3-Date.now()<EXPIRY_MARGIN_MS;if(this._debug(re,`session has${ie?"":" not"} expired with margin of ${EXPIRY_MARGIN_MS}s`),ie){if(this.autoRefreshToken&&ne.refresh_token){const{error:se}=await this._callRefreshToken(ne.refresh_token);se&&(console.error(se),isAuthRetryableFetchError(se)||(this._debug(re,"refresh failed with a non-retryable error, removing the session",se),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",ne)}catch(ne){this._debug(re,"error",ne),console.error(ne);return}finally{this._debug(re,"end")}}async _callRefreshToken(ee){var re,ne;if(!ee)throw new AuthSessionMissingError;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const ie=`#_callRefreshToken(${ee.substring(0,5)}...)`;this._debug(ie,"begin");try{this.refreshingDeferred=new Deferred;const{data:se,error:le}=await this._refreshAccessToken(ee);if(le)throw le;if(!se.session)throw new AuthSessionMissingError;await this._saveSession(se.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",se.session);const ue={session:se.session,error:null};return this.refreshingDeferred.resolve(ue),ue}catch(se){if(this._debug(ie,"error",se),isAuthError(se)){const le={session:null,error:se};return isAuthRetryableFetchError(se)||await this._removeSession(),(re=this.refreshingDeferred)===null||re===void 0||re.resolve(le),le}throw(ne=this.refreshingDeferred)===null||ne===void 0||ne.reject(se),se}finally{this.refreshingDeferred=null,this._debug(ie,"end")}}async _notifyAllSubscribers(ee,re,ne=!0){const ie=`#_notifyAllSubscribers(${ee})`;this._debug(ie,"begin",re,`broadcast = ${ne}`);try{this.broadcastChannel&&ne&&this.broadcastChannel.postMessage({event:ee,session:re});const se=[],le=Array.from(this.stateChangeEmitters.values()).map(async ue=>{try{await ue.callback(ee,re)}catch(ae){se.push(ae)}});if(await Promise.all(le),se.length>0){for(let ue=0;ue<se.length;ue+=1)console.error(se[ue]);throw se[0]}}finally{this._debug(ie,"end")}}async _saveSession(ee){this._debug("#_saveSession()",ee),this.suppressGetSessionWarning=!0,await setItemAsync(this.storage,this.storageKey,ee)}async _removeSession(){this._debug("#_removeSession()"),await removeItemAsync(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const ee=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{ee&&isBrowser()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",ee)}catch(re){console.error("removing visibilitychange callback failed",re)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const ee=setInterval(()=>this._autoRefreshTokenTick(),AUTO_REFRESH_TICK_DURATION_MS);this.autoRefreshTicker=ee,ee&&typeof ee=="object"&&typeof ee.unref=="function"?ee.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(ee),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const ee=this.autoRefreshTicker;this.autoRefreshTicker=null,ee&&clearInterval(ee)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const ee=Date.now();try{return await this._useSession(async re=>{const{data:{session:ne}}=re;if(!ne||!ne.refresh_token||!ne.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const ie=Math.floor((ne.expires_at*1e3-ee)/AUTO_REFRESH_TICK_DURATION_MS);this._debug("#_autoRefreshTokenTick()",`access token expires in ${ie} ticks, a tick lasts ${AUTO_REFRESH_TICK_DURATION_MS}ms, refresh threshold is ${AUTO_REFRESH_TICK_THRESHOLD} ticks`),ie<=AUTO_REFRESH_TICK_THRESHOLD&&await this._callRefreshToken(ne.refresh_token)})}catch(re){console.error("Auto refresh tick failed with error. This is likely a transient error.",re)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(ee){if(ee.isAcquireTimeout||ee instanceof LockAcquireTimeoutError)this._debug("auto refresh token tick lock not available");else throw ee}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!isBrowser()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(ee){console.error("_handleVisibilityChange",ee)}}async _onVisibilityChanged(ee){const re=`#_onVisibilityChanged(${ee})`;this._debug(re,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),ee||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(re,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(ee,re,ne){const ie=[`provider=${encodeURIComponent(re)}`];if(ne!=null&&ne.redirectTo&&ie.push(`redirect_to=${encodeURIComponent(ne.redirectTo)}`),ne!=null&&ne.scopes&&ie.push(`scopes=${encodeURIComponent(ne.scopes)}`),this.flowType==="pkce"){const[se,le]=await getCodeChallengeAndMethod(this.storage,this.storageKey),ue=new URLSearchParams({code_challenge:`${encodeURIComponent(se)}`,code_challenge_method:`${encodeURIComponent(le)}`});ie.push(ue.toString())}if(ne!=null&&ne.queryParams){const se=new URLSearchParams(ne.queryParams);ie.push(se.toString())}return ne!=null&&ne.skipBrowserRedirect&&ie.push(`skip_http_redirect=${ne.skipBrowserRedirect}`),`${ee}?${ie.join("&")}`}async _unenroll(ee){try{return await this._useSession(async re=>{var ne;const{data:ie,error:se}=re;return se?{data:null,error:se}:await _request(this.fetch,"DELETE",`${this.url}/factors/${ee.factorId}`,{headers:this.headers,jwt:(ne=ie==null?void 0:ie.session)===null||ne===void 0?void 0:ne.access_token})})}catch(re){if(isAuthError(re))return{data:null,error:re};throw re}}async _enroll(ee){try{return await this._useSession(async re=>{var ne,ie;const{data:se,error:le}=re;if(le)return{data:null,error:le};const ue=Object.assign({friendly_name:ee.friendlyName,factor_type:ee.factorType},ee.factorType==="phone"?{phone:ee.phone}:{issuer:ee.issuer}),{data:ae,error:oe}=await _request(this.fetch,"POST",`${this.url}/factors`,{body:ue,headers:this.headers,jwt:(ne=se==null?void 0:se.session)===null||ne===void 0?void 0:ne.access_token});return oe?{data:null,error:oe}:(ee.factorType==="totp"&&(!((ie=ae==null?void 0:ae.totp)===null||ie===void 0)&&ie.qr_code)&&(ae.totp.qr_code=`data:image/svg+xml;utf-8,${ae.totp.qr_code}`),{data:ae,error:null})})}catch(re){if(isAuthError(re))return{data:null,error:re};throw re}}async _verify(ee){return this._acquireLock(-1,async()=>{try{return await this._useSession(async re=>{var ne;const{data:ie,error:se}=re;if(se)return{data:null,error:se};const{data:le,error:ue}=await _request(this.fetch,"POST",`${this.url}/factors/${ee.factorId}/verify`,{body:{code:ee.code,challenge_id:ee.challengeId},headers:this.headers,jwt:(ne=ie==null?void 0:ie.session)===null||ne===void 0?void 0:ne.access_token});return ue?{data:null,error:ue}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+le.expires_in},le)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",le),{data:le,error:ue})})}catch(re){if(isAuthError(re))return{data:null,error:re};throw re}})}async _challenge(ee){return this._acquireLock(-1,async()=>{try{return await this._useSession(async re=>{var ne;const{data:ie,error:se}=re;return se?{data:null,error:se}:await _request(this.fetch,"POST",`${this.url}/factors/${ee.factorId}/challenge`,{body:{channel:ee.channel},headers:this.headers,jwt:(ne=ie==null?void 0:ie.session)===null||ne===void 0?void 0:ne.access_token})})}catch(re){if(isAuthError(re))return{data:null,error:re};throw re}})}async _challengeAndVerify(ee){const{data:re,error:ne}=await this._challenge({factorId:ee.factorId});return ne?{data:null,error:ne}:await this._verify({factorId:ee.factorId,challengeId:re.id,code:ee.code})}async _listFactors(){const{data:{user:ee},error:re}=await this.getUser();if(re)return{data:null,error:re};const ne=(ee==null?void 0:ee.factors)||[],ie=ne.filter(le=>le.factor_type==="totp"&&le.status==="verified"),se=ne.filter(le=>le.factor_type==="phone"&&le.status==="verified");return{data:{all:ne,totp:ie,phone:se},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async ee=>{var re,ne;const{data:{session:ie},error:se}=ee;if(se)return{data:null,error:se};if(!ie)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:le}=decodeJWT(ie.access_token);let ue=null;le.aal&&(ue=le.aal);let ae=ue;((ne=(re=ie.user.factors)===null||re===void 0?void 0:re.filter(he=>he.status==="verified"))!==null&&ne!==void 0?ne:[]).length>0&&(ae="aal2");const ce=le.amr||[];return{data:{currentLevel:ue,nextLevel:ae,currentAuthenticationMethods:ce},error:null}}))}async fetchJwk(ee,re={keys:[]}){let ne=re.keys.find(le=>le.kid===ee);if(ne||(ne=this.jwks.keys.find(le=>le.kid===ee),ne&&this.jwks_cached_at+JWKS_TTL>Date.now()))return ne;const{data:ie,error:se}=await _request(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(se)throw se;if(!ie.keys||ie.keys.length===0)throw new AuthInvalidJwtError("JWKS is empty");if(this.jwks=ie,this.jwks_cached_at=Date.now(),ne=ie.keys.find(le=>le.kid===ee),!ne)throw new AuthInvalidJwtError("No matching signing key found in JWKS");return ne}async getClaims(ee,re={keys:[]}){try{let ne=ee;if(!ne){const{data:de,error:me}=await this.getSession();if(me||!de.session)return{data:null,error:me};ne=de.session.access_token}const{header:ie,payload:se,signature:le,raw:{header:ue,payload:ae}}=decodeJWT(ne);if(validateExp(se.exp),!ie.kid||ie.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:de}=await this.getUser(ne);if(de)throw de;return{data:{claims:se,header:ie,signature:le},error:null}}const oe=getAlgorithm(ie.alg),ce=await this.fetchJwk(ie.kid,re),he=await crypto.subtle.importKey("jwk",ce,oe,!0,["verify"]);if(!await crypto.subtle.verify(oe,he,le,stringToUint8Array(`${ue}.${ae}`)))throw new AuthInvalidJwtError("Invalid JWT signature");return{data:{claims:se,header:ie,signature:le},error:null}}catch(ne){if(isAuthError(ne))return{data:null,error:ne};throw ne}}}GoTrueClient.nextInstanceID=0;const AuthClient=GoTrueClient;class SupabaseAuthClient extends AuthClient{constructor(ee){super(ee)}}var __awaiter=globalThis&&globalThis.__awaiter||function(te,ee,re,ne){function ie(se){return se instanceof re?se:new re(function(le){le(se)})}return new(re||(re=Promise))(function(se,le){function ue(ce){try{oe(ne.next(ce))}catch(he){le(he)}}function ae(ce){try{oe(ne.throw(ce))}catch(he){le(he)}}function oe(ce){ce.done?se(ce.value):ie(ce.value).then(ue,ae)}oe((ne=ne.apply(te,ee||[])).next())})};class SupabaseClient{constructor(ee,re,ne){var ie,se,le;if(this.supabaseUrl=ee,this.supabaseKey=re,!ee)throw new Error("supabaseUrl is required.");if(!re)throw new Error("supabaseKey is required.");const ue=stripTrailingSlash(ee);this.realtimeUrl=`${ue}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${ue}/auth/v1`,this.storageUrl=`${ue}/storage/v1`,this.functionsUrl=`${ue}/functions/v1`;const ae=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,oe={db:DEFAULT_DB_OPTIONS,realtime:DEFAULT_REALTIME_OPTIONS,auth:Object.assign(Object.assign({},DEFAULT_AUTH_OPTIONS),{storageKey:ae}),global:DEFAULT_GLOBAL_OPTIONS},ce=applySettingDefaults(ne??{},oe);this.storageKey=(ie=ce.auth.storageKey)!==null&&ie!==void 0?ie:"",this.headers=(se=ce.global.headers)!==null&&se!==void 0?se:{},ce.accessToken?(this.accessToken=ce.accessToken,this.auth=new Proxy({},{get:(he,pe)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(pe)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((le=ce.auth)!==null&&le!==void 0?le:{},this.headers,ce.global.fetch),this.fetch=fetchWithAuth(re,this._getAccessToken.bind(this),ce.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},ce.realtime)),this.rest=new PostgrestClient(`${ue}/rest/v1`,{headers:this.headers,schema:ce.db.schema,fetch:this.fetch}),ce.accessToken||this._listenForAuthEvents()}get functions(){return new FunctionsClient(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new StorageClient(this.storageUrl,this.headers,this.fetch)}from(ee){return this.rest.from(ee)}schema(ee){return this.rest.schema(ee)}rpc(ee,re={},ne={}){return this.rest.rpc(ee,re,ne)}channel(ee,re={config:{}}){return this.realtime.channel(ee,re)}getChannels(){return this.realtime.getChannels()}removeChannel(ee){return this.realtime.removeChannel(ee)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var ee,re;return __awaiter(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:ne}=yield this.auth.getSession();return(re=(ee=ne.session)===null||ee===void 0?void 0:ee.access_token)!==null&&re!==void 0?re:null})}_initSupabaseAuthClient({autoRefreshToken:ee,persistSession:re,detectSessionInUrl:ne,storage:ie,storageKey:se,flowType:le,lock:ue,debug:ae},oe,ce){const he={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new SupabaseAuthClient({url:this.authUrl,headers:Object.assign(Object.assign({},he),oe),storageKey:se,autoRefreshToken:ee,persistSession:re,detectSessionInUrl:ne,storage:ie,flowType:le,lock:ue,debug:ae,fetch:ce,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(ee){return new RealtimeClient(this.realtimeUrl,Object.assign(Object.assign({},ee),{params:Object.assign({apikey:this.supabaseKey},ee==null?void 0:ee.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((re,ne)=>{this._handleTokenChanged(re,"CLIENT",ne==null?void 0:ne.access_token)})}_handleTokenChanged(ee,re,ne){(ee==="TOKEN_REFRESHED"||ee==="SIGNED_IN")&&this.changedAccessToken!==ne?this.changedAccessToken=ne:ee==="SIGNED_OUT"&&(this.realtime.setAuth(),re=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const createClient=(te,ee,re)=>new SupabaseClient(te,ee,re);var shim={exports:{}},useSyncExternalStoreShim_production_min={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var e=require$$0$1;function h$1(te,ee){return te===ee&&(te!==0||1/te===1/ee)||te!==te&&ee!==ee}var k=typeof Object.is=="function"?Object.is:h$1,l=e.useState,m=e.useEffect,n$1=e.useLayoutEffect,p$1=e.useDebugValue;function q$1(te,ee){var re=ee(),ne=l({inst:{value:re,getSnapshot:ee}}),ie=ne[0].inst,se=ne[1];return n$1(function(){ie.value=re,ie.getSnapshot=ee,r$1(ie)&&se({inst:ie})},[te,re,ee]),m(function(){return r$1(ie)&&se({inst:ie}),te(function(){r$1(ie)&&se({inst:ie})})},[te]),p$1(re),re}function r$1(te){var ee=te.getSnapshot;te=te.value;try{var re=ee();return!k(te,re)}catch{return!0}}function t$2(te,ee){return ee()}var u$1=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?t$2:q$1;useSyncExternalStoreShim_production_min.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:u$1;shim.exports=useSyncExternalStoreShim_production_min;var shimExports=shim.exports,withSelector_production_min={};/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var h=require$$0$1,n=shimExports;function p(te,ee){return te===ee&&(te!==0||1/te===1/ee)||te!==te&&ee!==ee}var q=typeof Object.is=="function"?Object.is:p,r=n.useSyncExternalStore,t$1=h.useRef,u=h.useEffect,v=h.useMemo,w=h.useDebugValue;withSelector_production_min.useSyncExternalStoreWithSelector=function(te,ee,re,ne,ie){var se=t$1(null);if(se.current===null){var le={hasValue:!1,value:null};se.current=le}else le=se.current;se=v(function(){function ae(de){if(!oe){if(oe=!0,ce=de,de=ne(de),ie!==void 0&&le.hasValue){var me=le.value;if(ie(me,de))return he=me}return he=de}if(me=he,q(ce,de))return me;var ge=ne(de);return ie!==void 0&&ie(me,ge)?me:(ce=de,he=ge)}var oe=!1,ce,he,pe=re===void 0?null:re;return[function(){return ae(ee())},pe===null?void 0:function(){return ae(pe())}]},[ee,re,ne,ie]);var ue=r(te,se[0],se[1]);return u(function(){le.hasValue=!0,le.value=ue},[ue]),w(ue),ue};function defaultNoopBatch(te){te()}let batch=defaultNoopBatch;const setBatch=te=>batch=te,getBatch=()=>batch,ContextKey=Symbol.for("react-redux-context"),gT=typeof globalThis<"u"?globalThis:{};function getContext(){var te;if(!G$1)return{};const ee=(te=gT[ContextKey])!=null?te:gT[ContextKey]=new Map;let re=ee.get(G$1);return re||(re=G$1(null),ee.set(G$1,re)),re}const ReactReduxContext=getContext(),notInitialized=()=>{throw new Error("uSES not initialized!")},_excluded$1=["initMapStateToProps","initMapDispatchToProps","initMergeProps"];function pureFinalPropsSelectorFactory(te,ee,re,ne,{areStatesEqual:ie,areOwnPropsEqual:se,areStatePropsEqual:le}){let ue=!1,ae,oe,ce,he,pe;function de(_e,Te){return ae=_e,oe=Te,ce=te(ae,oe),he=ee(ne,oe),pe=re(ce,he,oe),ue=!0,pe}function me(){return ce=te(ae,oe),ee.dependsOnOwnProps&&(he=ee(ne,oe)),pe=re(ce,he,oe),pe}function ge(){return te.dependsOnOwnProps&&(ce=te(ae,oe)),ee.dependsOnOwnProps&&(he=ee(ne,oe)),pe=re(ce,he,oe),pe}function we(){const _e=te(ae,oe),Te=!le(_e,ce);return ce=_e,Te&&(pe=re(ce,he,oe)),pe}function ve(_e,Te){const ye=!se(Te,oe),be=!ie(_e,ae,Te,oe);return ae=_e,oe=Te,ye&&be?me():ye?ge():be?we():pe}return function(Te,ye){return ue?ve(Te,ye):de(Te,ye)}}function finalPropsSelectorFactory(te,ee){let{initMapStateToProps:re,initMapDispatchToProps:ne,initMergeProps:ie}=ee,se=_objectWithoutPropertiesLoose(ee,_excluded$1);const le=re(te,se),ue=ne(te,se),ae=ie(te,se);return pureFinalPropsSelectorFactory(le,ue,ae,te,se)}function bindActionCreators(te,ee){const re={};for(const ne in te){const ie=te[ne];typeof ie=="function"&&(re[ne]=(...se)=>ee(ie(...se)))}return re}function wrapMapToPropsConstant(te){return function(re){const ne=te(re);function ie(){return ne}return ie.dependsOnOwnProps=!1,ie}}function getDependsOnOwnProps(te){return te.dependsOnOwnProps?!!te.dependsOnOwnProps:te.length!==1}function wrapMapToPropsFunc(te,ee){return function(ne,{displayName:ie}){const se=function(ue,ae){return se.dependsOnOwnProps?se.mapToProps(ue,ae):se.mapToProps(ue,void 0)};return se.dependsOnOwnProps=!0,se.mapToProps=function(ue,ae){se.mapToProps=te,se.dependsOnOwnProps=getDependsOnOwnProps(te);let oe=se(ue,ae);return typeof oe=="function"&&(se.mapToProps=oe,se.dependsOnOwnProps=getDependsOnOwnProps(oe),oe=se(ue,ae)),oe},se}}function createInvalidArgFactory(te,ee){return(re,ne)=>{throw new Error(`Invalid value of type ${typeof te} for ${ee} argument when connecting component ${ne.wrappedComponentName}.`)}}function mapDispatchToPropsFactory(te){return te&&typeof te=="object"?wrapMapToPropsConstant(ee=>bindActionCreators(te,ee)):te?typeof te=="function"?wrapMapToPropsFunc(te):createInvalidArgFactory(te,"mapDispatchToProps"):wrapMapToPropsConstant(ee=>({dispatch:ee}))}function mapStateToPropsFactory(te){return te?typeof te=="function"?wrapMapToPropsFunc(te):createInvalidArgFactory(te,"mapStateToProps"):wrapMapToPropsConstant(()=>({}))}function defaultMergeProps(te,ee,re){return _extends$1({},re,te,ee)}function wrapMergePropsFunc(te){return function(re,{displayName:ne,areMergedPropsEqual:ie}){let se=!1,le;return function(ae,oe,ce){const he=te(ae,oe,ce);return se?ie(he,le)||(le=he):(se=!0,le=he),le}}}function mergePropsFactory(te){return te?typeof te=="function"?wrapMergePropsFunc(te):createInvalidArgFactory(te,"mergeProps"):()=>defaultMergeProps}function createListenerCollection(){const te=getBatch();let ee=null,re=null;return{clear(){ee=null,re=null},notify(){te(()=>{let ne=ee;for(;ne;)ne.callback(),ne=ne.next})},get(){let ne=[],ie=ee;for(;ie;)ne.push(ie),ie=ie.next;return ne},subscribe(ne){let ie=!0,se=re={callback:ne,next:null,prev:re};return se.prev?se.prev.next=se:ee=se,function(){!ie||ee===null||(ie=!1,se.next?se.next.prev=se.prev:re=se.prev,se.prev?se.prev.next=se.next:ee=se.next)}}}}const nullListeners={notify(){},get:()=>[]};function createSubscription(te,ee){let re,ne=nullListeners,ie=0,se=!1;function le(ge){ce();const we=ne.subscribe(ge);let ve=!1;return()=>{ve||(ve=!0,we(),he())}}function ue(){ne.notify()}function ae(){me.onStateChange&&me.onStateChange()}function oe(){return se}function ce(){ie++,re||(re=ee?ee.addNestedSub(ae):te.subscribe(ae),ne=createListenerCollection())}function he(){ie--,re&&ie===0&&(re(),re=void 0,ne.clear(),ne=nullListeners)}function pe(){se||(se=!0,ce())}function de(){se&&(se=!1,he())}const me={addNestedSub:le,notifyNestedSubs:ue,handleChangeWrapper:ae,isSubscribed:oe,trySubscribe:pe,tryUnsubscribe:de,getListeners:()=>ne};return me}const canUseDOM=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",useIsomorphicLayoutEffect=canUseDOM?y$1:p$3;function is(te,ee){return te===ee?te!==0||ee!==0||1/te===1/ee:te!==te&&ee!==ee}function shallowEqual(te,ee){if(is(te,ee))return!0;if(typeof te!="object"||te===null||typeof ee!="object"||ee===null)return!1;const re=Object.keys(te),ne=Object.keys(ee);if(re.length!==ne.length)return!1;for(let ie=0;ie<re.length;ie++)if(!Object.prototype.hasOwnProperty.call(ee,re[ie])||!is(te[re[ie]],ee[re[ie]]))return!1;return!0}const _excluded=["reactReduxForwardedRef"];let useSyncExternalStore=notInitialized;const initializeConnect=te=>{useSyncExternalStore=te},NO_SUBSCRIPTION_ARRAY=[null,null];function useIsomorphicLayoutEffectWithArgs(te,ee,re){useIsomorphicLayoutEffect(()=>te(...ee),re)}function captureWrapperProps(te,ee,re,ne,ie,se){te.current=ne,re.current=!1,ie.current&&(ie.current=null,se())}function subscribeUpdates(te,ee,re,ne,ie,se,le,ue,ae,oe,ce){if(!te)return()=>{};let he=!1,pe=null;const de=()=>{if(he||!ue.current)return;const ge=ee.getState();let we,ve;try{we=ne(ge,ie.current)}catch(_e){ve=_e,pe=_e}ve||(pe=null),we===se.current?le.current||oe():(se.current=we,ae.current=we,le.current=!0,ce())};return re.onStateChange=de,re.trySubscribe(),de(),()=>{if(he=!0,re.tryUnsubscribe(),re.onStateChange=null,pe)throw pe}}function strictEqual(te,ee){return te===ee}function connect(te,ee,re,{pure:ne,areStatesEqual:ie=strictEqual,areOwnPropsEqual:se=shallowEqual,areStatePropsEqual:le=shallowEqual,areMergedPropsEqual:ue=shallowEqual,forwardRef:ae=!1,context:oe=ReactReduxContext}={}){const ce=oe,he=mapStateToPropsFactory(te),pe=mapDispatchToPropsFactory(ee),de=mergePropsFactory(re),me=!!te;return we=>{const ve=we.displayName||we.name||"Component",_e=`Connect(${ve})`,Te={shouldHandleStateChanges:me,displayName:_e,wrappedComponentName:ve,WrappedComponent:we,initMapStateToProps:he,initMapDispatchToProps:pe,initMergeProps:de,areStatesEqual:ie,areStatePropsEqual:le,areOwnPropsEqual:se,areMergedPropsEqual:ue};function ye(Le){const[Oe,Se,De]=F$1(()=>{const{reactReduxForwardedRef:Ut}=Le,Zt=_objectWithoutPropertiesLoose(Le,_excluded);return[Le.context,Ut,Zt]},[Le]),Ie=F$1(()=>Oe&&Oe.Consumer&&reactIsExports$1.isContextConsumer(y$2(Oe.Consumer,null))?Oe:ce,[Oe,ce]),Ve=q$4(Ie),Ke=!!Le.store&&!!Le.store.getState&&!!Le.store.dispatch,ht=!!Ve&&!!Ve.store,qe=Ke?Le.store:Ve.store,ot=ht?Ve.getServerState:qe.getState,nt=F$1(()=>finalPropsSelectorFactory(qe.dispatch,Te),[qe]),[Xe,Ge]=F$1(()=>{if(!me)return NO_SUBSCRIPTION_ARRAY;const Ut=createSubscription(qe,Ke?void 0:Ve.subscription),Zt=Ut.notifyNestedSubs.bind(Ut);return[Ut,Zt]},[qe,Ke,Ve]),et=F$1(()=>Ke?Ve:_extends$1({},Ve,{subscription:Xe}),[Ke,Ve,Xe]),tt=_(),je=_(De),at=_(),Bt=_(!1);_(!1);const Et=_(!1),gt=_();useIsomorphicLayoutEffect(()=>(Et.current=!0,()=>{Et.current=!1}),[]);const Xt=F$1(()=>()=>at.current&&De===je.current?at.current:nt(qe.getState(),De),[qe,De]),xt=F$1(()=>Zt=>Xe?subscribeUpdates(me,qe,Xe,nt,je,tt,Bt,Et,at,Ge,Zt):()=>{},[Xe]);useIsomorphicLayoutEffectWithArgs(captureWrapperProps,[je,tt,Bt,De,at,Ge]);let Ye;try{Ye=useSyncExternalStore(xt,Xt,ot?()=>nt(ot(),De):Xt)}catch(Ut){throw gt.current&&(Ut.message+=`
The error may be correlated with this previous error:
${gt.current.stack}

`),Ut}useIsomorphicLayoutEffect(()=>{gt.current=void 0,at.current=void 0,tt.current=Ye});const Rt=F$1(()=>y$2(we,_extends$1({},Ye,{ref:Se})),[Se,we,Ye]);return F$1(()=>me?y$2(Ie.Provider,{value:et},Rt):Rt,[Ie,Rt,et])}const Fe=x$1(ye);if(Fe.WrappedComponent=we,Fe.displayName=ye.displayName=_e,ae){const Oe=k$2(function(De,Ie){return y$2(Fe,_extends$1({},De,{reactReduxForwardedRef:Ie}))});return Oe.displayName=_e,Oe.WrappedComponent=we,hoistNonReactStatics$1(Oe,we)}return hoistNonReactStatics$1(Fe,we)}}function Provider({store:te,context:ee,children:re,serverState:ne,stabilityCheck:ie="once",noopCheck:se="once"}){const le=F$1(()=>{const oe=createSubscription(te);return{store:te,subscription:oe,getServerState:ne?()=>ne:void 0,stabilityCheck:ie,noopCheck:se}},[te,ne,ie,se]),ue=F$1(()=>te.getState(),[te]);return useIsomorphicLayoutEffect(()=>{const{subscription:oe}=le;return oe.onStateChange=oe.notifyNestedSubs,oe.trySubscribe(),ue!==te.getState()&&oe.notifyNestedSubs(),()=>{oe.tryUnsubscribe(),oe.onStateChange=void 0}},[le,ue]),y$2((ee||ReactReduxContext).Provider,{value:le},re)}initializeConnect(shimExports.useSyncExternalStore);setBatch(dn);function freeze(te,ee){return ee===void 0&&(ee=Object),ee&&typeof ee.freeze=="function"?ee.freeze(te):te}let MIME_TYPE=freeze({HTML:"text/html",isHTML:function(te){return te===MIME_TYPE.HTML},XML_APPLICATION:"application/xml",XML_TEXT:"text/xml",XML_XHTML_APPLICATION:"application/xhtml+xml",XML_SVG_IMAGE:"image/svg+xml"}),NAMESPACE$1=freeze({HTML:"http://www.w3.org/1999/xhtml",isHTML:function(te){return te===NAMESPACE$1.HTML},SVG:"http://www.w3.org/2000/svg",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"});freeze({amp:"&",apos:"'",gt:">",lt:"<",quot:'"'});freeze({lt:"<",gt:">",amp:"&",quot:'"',apos:"'",Agrave:"À",Aacute:"Á",Acirc:"Â",Atilde:"Ã",Auml:"Ä",Aring:"Å",AElig:"Æ",Ccedil:"Ç",Egrave:"È",Eacute:"É",Ecirc:"Ê",Euml:"Ë",Igrave:"Ì",Iacute:"Í",Icirc:"Î",Iuml:"Ï",ETH:"Ð",Ntilde:"Ñ",Ograve:"Ò",Oacute:"Ó",Ocirc:"Ô",Otilde:"Õ",Ouml:"Ö",Oslash:"Ø",Ugrave:"Ù",Uacute:"Ú",Ucirc:"Û",Uuml:"Ü",Yacute:"Ý",THORN:"Þ",szlig:"ß",agrave:"à",aacute:"á",acirc:"â",atilde:"ã",auml:"ä",aring:"å",aelig:"æ",ccedil:"ç",egrave:"è",eacute:"é",ecirc:"ê",euml:"ë",igrave:"ì",iacute:"í",icirc:"î",iuml:"ï",eth:"ð",ntilde:"ñ",ograve:"ò",oacute:"ó",ocirc:"ô",otilde:"õ",ouml:"ö",oslash:"ø",ugrave:"ù",uacute:"ú",ucirc:"û",uuml:"ü",yacute:"ý",thorn:"þ",yuml:"ÿ",nbsp:" ",iexcl:"¡",cent:"¢",pound:"£",curren:"¤",yen:"¥",brvbar:"¦",sect:"§",uml:"¨",copy:"©",ordf:"ª",laquo:"«",not:"¬",shy:"­­",reg:"®",macr:"¯",deg:"°",plusmn:"±",sup2:"²",sup3:"³",acute:"´",micro:"µ",para:"¶",middot:"·",cedil:"¸",sup1:"¹",ordm:"º",raquo:"»",frac14:"¼",frac12:"½",frac34:"¾",iquest:"¿",times:"×",divide:"÷",forall:"∀",part:"∂",exist:"∃",empty:"∅",nabla:"∇",isin:"∈",notin:"∉",ni:"∋",prod:"∏",sum:"∑",minus:"−",lowast:"∗",radic:"√",prop:"∝",infin:"∞",ang:"∠",and:"∧",or:"∨",cap:"∩",cup:"∪",int:"∫",there4:"∴",sim:"∼",cong:"≅",asymp:"≈",ne:"≠",equiv:"≡",le:"≤",ge:"≥",sub:"⊂",sup:"⊃",nsub:"⊄",sube:"⊆",supe:"⊇",oplus:"⊕",otimes:"⊗",perp:"⊥",sdot:"⋅",Alpha:"Α",Beta:"Β",Gamma:"Γ",Delta:"Δ",Epsilon:"Ε",Zeta:"Ζ",Eta:"Η",Theta:"Θ",Iota:"Ι",Kappa:"Κ",Lambda:"Λ",Mu:"Μ",Nu:"Ν",Xi:"Ξ",Omicron:"Ο",Pi:"Π",Rho:"Ρ",Sigma:"Σ",Tau:"Τ",Upsilon:"Υ",Phi:"Φ",Chi:"Χ",Psi:"Ψ",Omega:"Ω",alpha:"α",beta:"β",gamma:"γ",delta:"δ",epsilon:"ε",zeta:"ζ",eta:"η",theta:"θ",iota:"ι",kappa:"κ",lambda:"λ",mu:"μ",nu:"ν",xi:"ξ",omicron:"ο",pi:"π",rho:"ρ",sigmaf:"ς",sigma:"σ",tau:"τ",upsilon:"υ",phi:"φ",chi:"χ",psi:"ψ",omega:"ω",thetasym:"ϑ",upsih:"ϒ",piv:"ϖ",OElig:"Œ",oelig:"œ",Scaron:"Š",scaron:"š",Yuml:"Ÿ",fnof:"ƒ",circ:"ˆ",tilde:"˜",ensp:" ",emsp:" ",thinsp:" ",zwnj:"‌",zwj:"‍",lrm:"‎",rlm:"‏",ndash:"–",mdash:"—",lsquo:"‘",rsquo:"’",sbquo:"‚",ldquo:"“",rdquo:"”",bdquo:"„",dagger:"†",Dagger:"‡",bull:"•",hellip:"…",permil:"‰",prime:"′",Prime:"″",lsaquo:"‹",rsaquo:"›",oline:"‾",euro:"€",trade:"™",larr:"←",uarr:"↑",rarr:"→",darr:"↓",harr:"↔",crarr:"↵",lceil:"⌈",rceil:"⌉",lfloor:"⌊",rfloor:"⌋",loz:"◊",spades:"♠",clubs:"♣",hearts:"♥",diams:"♦"});var NAMESPACE=NAMESPACE$1;function copy(te,ee){for(var re in te)ee[re]=te[re]}function _extends(te,ee){var re=te.prototype;if(!(re instanceof ee)){let ne=function(){};ne.prototype=ee.prototype,ne=new ne,copy(re,ne),te.prototype=re=ne}re.constructor!=te&&(typeof te!="function"&&console.error("unknow Class:"+te),re.constructor=te)}var NodeType={},ELEMENT_NODE=NodeType.ELEMENT_NODE=1,ATTRIBUTE_NODE=NodeType.ATTRIBUTE_NODE=2,TEXT_NODE=NodeType.TEXT_NODE=3,CDATA_SECTION_NODE=NodeType.CDATA_SECTION_NODE=4,ENTITY_REFERENCE_NODE=NodeType.ENTITY_REFERENCE_NODE=5,ENTITY_NODE=NodeType.ENTITY_NODE=6,PROCESSING_INSTRUCTION_NODE=NodeType.PROCESSING_INSTRUCTION_NODE=7,COMMENT_NODE=NodeType.COMMENT_NODE=8,DOCUMENT_NODE=NodeType.DOCUMENT_NODE=9,DOCUMENT_TYPE_NODE=NodeType.DOCUMENT_TYPE_NODE=10,DOCUMENT_FRAGMENT_NODE=NodeType.DOCUMENT_FRAGMENT_NODE=11,NOTATION_NODE=NodeType.NOTATION_NODE=12,ExceptionCode={},ExceptionMessage={};ExceptionCode.INDEX_SIZE_ERR=(ExceptionMessage[1]="Index size error",1);ExceptionCode.DOMSTRING_SIZE_ERR=(ExceptionMessage[2]="DOMString size error",2);var HIERARCHY_REQUEST_ERR=ExceptionCode.HIERARCHY_REQUEST_ERR=(ExceptionMessage[3]="Hierarchy request error",3);ExceptionCode.WRONG_DOCUMENT_ERR=(ExceptionMessage[4]="Wrong document",4);ExceptionCode.INVALID_CHARACTER_ERR=(ExceptionMessage[5]="Invalid character",5);ExceptionCode.NO_DATA_ALLOWED_ERR=(ExceptionMessage[6]="No data allowed",6);ExceptionCode.NO_MODIFICATION_ALLOWED_ERR=(ExceptionMessage[7]="No modification allowed",7);var NOT_FOUND_ERR=ExceptionCode.NOT_FOUND_ERR=(ExceptionMessage[8]="Not found",8);ExceptionCode.NOT_SUPPORTED_ERR=(ExceptionMessage[9]="Not supported",9);var INUSE_ATTRIBUTE_ERR=ExceptionCode.INUSE_ATTRIBUTE_ERR=(ExceptionMessage[10]="Attribute in use",10);ExceptionCode.INVALID_STATE_ERR=(ExceptionMessage[11]="Invalid state",11);ExceptionCode.SYNTAX_ERR=(ExceptionMessage[12]="Syntax error",12);ExceptionCode.INVALID_MODIFICATION_ERR=(ExceptionMessage[13]="Invalid modification",13);ExceptionCode.NAMESPACE_ERR=(ExceptionMessage[14]="Invalid namespace",14);ExceptionCode.INVALID_ACCESS_ERR=(ExceptionMessage[15]="Invalid access",15);function DOMException(te,ee){if(ee instanceof Error)var re=ee;else re=this,Error.call(this,ExceptionMessage[te]),this.message=ExceptionMessage[te],Error.captureStackTrace&&Error.captureStackTrace(this,DOMException);return re.code=te,ee&&(this.message=this.message+": "+ee),re}DOMException.prototype=Error.prototype;copy(ExceptionCode,DOMException);function NodeList(){}NodeList.prototype={length:0,item:function(te){return this[te]||null},toString:function(te,ee){for(var re=[],ne=0;ne<this.length;ne++)serializeToString(this[ne],re,te,ee);return re.join("")}};function LiveNodeList(te,ee){this._node=te,this._refresh=ee,_updateLiveList(this)}function _updateLiveList(te){var ee=te._node._inc||te._node.ownerDocument._inc;if(te._inc!=ee){var re=te._refresh(te._node);__set__(te,"length",re.length),copy(re,te),te._inc=ee}}LiveNodeList.prototype.item=function(te){return _updateLiveList(this),this[te]};_extends(LiveNodeList,NodeList);function NamedNodeMap(){}function _findNodeIndex(te,ee){for(var re=te.length;re--;)if(te[re]===ee)return re}function _addNamedNode(te,ee,re,ne){if(ne?ee[_findNodeIndex(ee,ne)]=re:ee[ee.length++]=re,te){re.ownerElement=te;var ie=te.ownerDocument;ie&&(ne&&_onRemoveAttribute(ie,te,ne),_onAddAttribute(ie,te,re))}}function _removeNamedNode(te,ee,re){var ne=_findNodeIndex(ee,re);if(ne>=0){for(var ie=ee.length-1;ne<ie;)ee[ne]=ee[++ne];if(ee.length=ie,te){var se=te.ownerDocument;se&&(_onRemoveAttribute(se,te,re),re.ownerElement=null)}}else throw DOMException(NOT_FOUND_ERR,new Error(te.tagName+"@"+re))}NamedNodeMap.prototype={length:0,item:NodeList.prototype.item,getNamedItem:function(te){for(var ee=this.length;ee--;){var re=this[ee];if(re.nodeName==te)return re}},setNamedItem:function(te){var ee=te.ownerElement;if(ee&&ee!=this._ownerElement)throw new DOMException(INUSE_ATTRIBUTE_ERR);var re=this.getNamedItem(te.nodeName);return _addNamedNode(this._ownerElement,this,te,re),re},setNamedItemNS:function(te){var ee=te.ownerElement,re;if(ee&&ee!=this._ownerElement)throw new DOMException(INUSE_ATTRIBUTE_ERR);return re=this.getNamedItemNS(te.namespaceURI,te.localName),_addNamedNode(this._ownerElement,this,te,re),re},removeNamedItem:function(te){var ee=this.getNamedItem(te);return _removeNamedNode(this._ownerElement,this,ee),ee},removeNamedItemNS:function(te,ee){var re=this.getNamedItemNS(te,ee);return _removeNamedNode(this._ownerElement,this,re),re},getNamedItemNS:function(te,ee){for(var re=this.length;re--;){var ne=this[re];if(ne.localName==ee&&ne.namespaceURI==te)return ne}return null}};function DOMImplementation$1(){}DOMImplementation$1.prototype={hasFeature:function(te,ee){return!0},createDocument:function(te,ee,re){var ne=new Document;if(ne.implementation=this,ne.childNodes=new NodeList,ne.doctype=re||null,re&&ne.appendChild(re),ee){var ie=ne.createElementNS(te,ee);ne.appendChild(ie)}return ne},createDocumentType:function(te,ee,re){var ne=new DocumentType;return ne.name=te,ne.nodeName=te,ne.publicId=ee||"",ne.systemId=re||"",ne}};function Node$1(){}Node$1.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(te,ee){return _insertBefore(this,te,ee)},replaceChild:function(te,ee){this.insertBefore(te,ee),ee&&this.removeChild(ee)},removeChild:function(te){return _removeChild(this,te)},appendChild:function(te){return this.insertBefore(te,null)},hasChildNodes:function(){return this.firstChild!=null},cloneNode:function(te){return cloneNode(this.ownerDocument||this,this,te)},normalize:function(){for(var te=this.firstChild;te;){var ee=te.nextSibling;ee&&ee.nodeType==TEXT_NODE&&te.nodeType==TEXT_NODE?(this.removeChild(ee),te.appendData(ee.data)):(te.normalize(),te=ee)}},isSupported:function(te,ee){return this.ownerDocument.implementation.hasFeature(te,ee)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(te){for(var ee=this;ee;){var re=ee._nsMap;if(re){for(var ne in re)if(re[ne]==te)return ne}ee=ee.nodeType==ATTRIBUTE_NODE?ee.ownerDocument:ee.parentNode}return null},lookupNamespaceURI:function(te){for(var ee=this;ee;){var re=ee._nsMap;if(re&&te in re)return re[te];ee=ee.nodeType==ATTRIBUTE_NODE?ee.ownerDocument:ee.parentNode}return null},isDefaultNamespace:function(te){var ee=this.lookupPrefix(te);return ee==null}};function _xmlEncoder(te){return te=="<"&&"&lt;"||te==">"&&"&gt;"||te=="&"&&"&amp;"||te=='"'&&"&quot;"||"&#"+te.charCodeAt()+";"}copy(NodeType,Node$1);copy(NodeType,Node$1.prototype);function _visitNode(te,ee){if(ee(te))return!0;if(te=te.firstChild)do if(_visitNode(te,ee))return!0;while(te=te.nextSibling)}function Document(){}function _onAddAttribute(te,ee,re){te&&te._inc++;var ne=re.namespaceURI;ne===NAMESPACE.XMLNS&&(ee._nsMap[re.prefix?re.localName:""]=re.value)}function _onRemoveAttribute(te,ee,re,ne){te&&te._inc++;var ie=re.namespaceURI;ie===NAMESPACE.XMLNS&&delete ee._nsMap[re.prefix?re.localName:""]}function _onUpdateChild(te,ee,re){if(te&&te._inc){te._inc++;var ne=ee.childNodes;if(re)ne[ne.length++]=re;else{for(var ie=ee.firstChild,se=0;ie;)ne[se++]=ie,ie=ie.nextSibling;ne.length=se}}}function _removeChild(te,ee){var re=ee.previousSibling,ne=ee.nextSibling;return re?re.nextSibling=ne:te.firstChild=ne,ne?ne.previousSibling=re:te.lastChild=re,_onUpdateChild(te.ownerDocument,te),ee}function _insertBefore(te,ee,re){var ne=ee.parentNode;if(ne&&ne.removeChild(ee),ee.nodeType===DOCUMENT_FRAGMENT_NODE){var ie=ee.firstChild;if(ie==null)return ee;var se=ee.lastChild}else ie=se=ee;var le=re?re.previousSibling:te.lastChild;ie.previousSibling=le,se.nextSibling=re,le?le.nextSibling=ie:te.firstChild=ie,re==null?te.lastChild=se:re.previousSibling=se;do ie.parentNode=te;while(ie!==se&&(ie=ie.nextSibling));return _onUpdateChild(te.ownerDocument||te,te),ee.nodeType==DOCUMENT_FRAGMENT_NODE&&(ee.firstChild=ee.lastChild=null),ee}function _appendSingleChild(te,ee){var re=ee.parentNode;if(re){var ne=te.lastChild;re.removeChild(ee);var ne=te.lastChild}var ne=te.lastChild;return ee.parentNode=te,ee.previousSibling=ne,ee.nextSibling=null,ne?ne.nextSibling=ee:te.firstChild=ee,te.lastChild=ee,_onUpdateChild(te.ownerDocument,te,ee),ee}Document.prototype={nodeName:"#document",nodeType:DOCUMENT_NODE,doctype:null,documentElement:null,_inc:1,insertBefore:function(te,ee){if(te.nodeType==DOCUMENT_FRAGMENT_NODE){for(var re=te.firstChild;re;){var ne=re.nextSibling;this.insertBefore(re,ee),re=ne}return te}return this.documentElement==null&&te.nodeType==ELEMENT_NODE&&(this.documentElement=te),_insertBefore(this,te,ee),te.ownerDocument=this,te},removeChild:function(te){return this.documentElement==te&&(this.documentElement=null),_removeChild(this,te)},importNode:function(te,ee){return importNode(this,te,ee)},getElementById:function(te){var ee=null;return _visitNode(this.documentElement,function(re){if(re.nodeType==ELEMENT_NODE&&re.getAttribute("id")==te)return ee=re,!0}),ee},getElementsByClassName:function(te){var ee=new RegExp("(^|\\s)"+te+"(\\s|$)");return new LiveNodeList(this,function(re){var ne=[];return _visitNode(re.documentElement,function(ie){ie!==re&&ie.nodeType==ELEMENT_NODE&&ee.test(ie.getAttribute("class"))&&ne.push(ie)}),ne})},createElement:function(te){var ee=new Element;ee.ownerDocument=this,ee.nodeName=te,ee.tagName=te,ee.localName=te,ee.childNodes=new NodeList;var re=ee.attributes=new NamedNodeMap;return re._ownerElement=ee,ee},createDocumentFragment:function(){var te=new DocumentFragment;return te.ownerDocument=this,te.childNodes=new NodeList,te},createTextNode:function(te){var ee=new Text;return ee.ownerDocument=this,ee.appendData(te),ee},createComment:function(te){var ee=new Comment;return ee.ownerDocument=this,ee.appendData(te),ee},createCDATASection:function(te){var ee=new CDATASection;return ee.ownerDocument=this,ee.appendData(te),ee},createProcessingInstruction:function(te,ee){var re=new ProcessingInstruction;return re.ownerDocument=this,re.tagName=re.target=te,re.nodeValue=re.data=ee,re},createAttribute:function(te){var ee=new Attr;return ee.ownerDocument=this,ee.name=te,ee.nodeName=te,ee.localName=te,ee.specified=!0,ee},createEntityReference:function(te){var ee=new EntityReference;return ee.ownerDocument=this,ee.nodeName=te,ee},createElementNS:function(te,ee){var re=new Element,ne=ee.split(":"),ie=re.attributes=new NamedNodeMap;return re.childNodes=new NodeList,re.ownerDocument=this,re.nodeName=ee,re.tagName=ee,re.namespaceURI=te,ne.length==2?(re.prefix=ne[0],re.localName=ne[1]):re.localName=ee,ie._ownerElement=re,re},createAttributeNS:function(te,ee){var re=new Attr,ne=ee.split(":");return re.ownerDocument=this,re.nodeName=ee,re.name=ee,re.namespaceURI=te,re.specified=!0,ne.length==2?(re.prefix=ne[0],re.localName=ne[1]):re.localName=ee,re}};_extends(Document,Node$1);function Element(){this._nsMap={}}Element.prototype={nodeType:ELEMENT_NODE,hasAttribute:function(te){return this.getAttributeNode(te)!=null},getAttribute:function(te){var ee=this.getAttributeNode(te);return ee&&ee.value||""},getAttributeNode:function(te){return this.attributes.getNamedItem(te)},setAttribute:function(te,ee){var re=this.ownerDocument.createAttribute(te);re.value=re.nodeValue=""+ee,this.setAttributeNode(re)},removeAttribute:function(te){var ee=this.getAttributeNode(te);ee&&this.removeAttributeNode(ee)},appendChild:function(te){return te.nodeType===DOCUMENT_FRAGMENT_NODE?this.insertBefore(te,null):_appendSingleChild(this,te)},setAttributeNode:function(te){return this.attributes.setNamedItem(te)},setAttributeNodeNS:function(te){return this.attributes.setNamedItemNS(te)},removeAttributeNode:function(te){return this.attributes.removeNamedItem(te.nodeName)},removeAttributeNS:function(te,ee){var re=this.getAttributeNodeNS(te,ee);re&&this.removeAttributeNode(re)},hasAttributeNS:function(te,ee){return this.getAttributeNodeNS(te,ee)!=null},getAttributeNS:function(te,ee){var re=this.getAttributeNodeNS(te,ee);return re&&re.value||""},setAttributeNS:function(te,ee,re){var ne=this.ownerDocument.createAttributeNS(te,ee);ne.value=ne.nodeValue=""+re,this.setAttributeNode(ne)},getAttributeNodeNS:function(te,ee){return this.attributes.getNamedItemNS(te,ee)},getElementsByTagName:function(te){return new LiveNodeList(this,function(ee){var re=[];return _visitNode(ee,function(ne){ne!==ee&&ne.nodeType==ELEMENT_NODE&&(te==="*"||ne.tagName==te)&&re.push(ne)}),re})},getElementsByTagNameNS:function(te,ee){return new LiveNodeList(this,function(re){var ne=[];return _visitNode(re,function(ie){ie!==re&&ie.nodeType===ELEMENT_NODE&&(te==="*"||ie.namespaceURI===te)&&(ee==="*"||ie.localName==ee)&&ne.push(ie)}),ne})}};Document.prototype.getElementsByTagName=Element.prototype.getElementsByTagName;Document.prototype.getElementsByTagNameNS=Element.prototype.getElementsByTagNameNS;_extends(Element,Node$1);function Attr(){}Attr.prototype.nodeType=ATTRIBUTE_NODE;_extends(Attr,Node$1);function CharacterData(){}CharacterData.prototype={data:"",substringData:function(te,ee){return this.data.substring(te,te+ee)},appendData:function(te){te=this.data+te,this.nodeValue=this.data=te,this.length=te.length},insertData:function(te,ee){this.replaceData(te,0,ee)},appendChild:function(te){throw new Error(ExceptionMessage[HIERARCHY_REQUEST_ERR])},deleteData:function(te,ee){this.replaceData(te,ee,"")},replaceData:function(te,ee,re){var ne=this.data.substring(0,te),ie=this.data.substring(te+ee);re=ne+re+ie,this.nodeValue=this.data=re,this.length=re.length}};_extends(CharacterData,Node$1);function Text(){}Text.prototype={nodeName:"#text",nodeType:TEXT_NODE,splitText:function(te){var ee=this.data,re=ee.substring(te);ee=ee.substring(0,te),this.data=this.nodeValue=ee,this.length=ee.length;var ne=this.ownerDocument.createTextNode(re);return this.parentNode&&this.parentNode.insertBefore(ne,this.nextSibling),ne}};_extends(Text,CharacterData);function Comment(){}Comment.prototype={nodeName:"#comment",nodeType:COMMENT_NODE};_extends(Comment,CharacterData);function CDATASection(){}CDATASection.prototype={nodeName:"#cdata-section",nodeType:CDATA_SECTION_NODE};_extends(CDATASection,CharacterData);function DocumentType(){}DocumentType.prototype.nodeType=DOCUMENT_TYPE_NODE;_extends(DocumentType,Node$1);function Notation(){}Notation.prototype.nodeType=NOTATION_NODE;_extends(Notation,Node$1);function Entity(){}Entity.prototype.nodeType=ENTITY_NODE;_extends(Entity,Node$1);function EntityReference(){}EntityReference.prototype.nodeType=ENTITY_REFERENCE_NODE;_extends(EntityReference,Node$1);function DocumentFragment(){}DocumentFragment.prototype.nodeName="#document-fragment";DocumentFragment.prototype.nodeType=DOCUMENT_FRAGMENT_NODE;_extends(DocumentFragment,Node$1);function ProcessingInstruction(){}ProcessingInstruction.prototype.nodeType=PROCESSING_INSTRUCTION_NODE;_extends(ProcessingInstruction,Node$1);Node$1.prototype.toString=nodeSerializeToString;function nodeSerializeToString(te,ee){var re=[],ne=this.nodeType==9&&this.documentElement||this,ie=ne.prefix,se=ne.namespaceURI;if(se&&ie==null){var ie=ne.lookupPrefix(se);if(ie==null)var le=[{namespace:se,prefix:null}]}return serializeToString(this,re,te,ee,le),re.join("")}function needNamespaceDefine(te,ee,re){var ne=te.prefix||"",ie=te.namespaceURI;if(!ie||ne==="xml"&&ie===NAMESPACE.XML||ie===NAMESPACE.XMLNS)return!1;for(var se=re.length;se--;){var le=re[se];if(le.prefix===ne)return le.namespace!==ie}return!0}function serializeToString(te,ee,re,ne,ie){if(ne)if(te=ne(te),te){if(typeof te=="string"){ee.push(te);return}}else return;switch(te.nodeType){case ELEMENT_NODE:ie||(ie=[]),ie.length;var se=te.attributes,le=se.length,de=te.firstChild,ue=te.tagName;re=NAMESPACE.isHTML(te.namespaceURI)||re,ee.push("<",ue);for(var ae=0;ae<le;ae++){var oe=se.item(ae);oe.prefix=="xmlns"?ie.push({prefix:oe.localName,namespace:oe.value}):oe.nodeName=="xmlns"&&ie.push({prefix:"",namespace:oe.value})}for(var ae=0;ae<le;ae++){var oe=se.item(ae);if(needNamespaceDefine(oe,re,ie)){var ce=oe.prefix||"",he=oe.namespaceURI,pe=ce?" xmlns:"+ce:" xmlns";ee.push(pe,'="',he,'"'),ie.push({prefix:ce,namespace:he})}serializeToString(oe,ee,re,ne,ie)}if(needNamespaceDefine(te,re,ie)){var ce=te.prefix||"",he=te.namespaceURI,pe=ce?" xmlns:"+ce:" xmlns";ee.push(pe,'="',he,'"'),ie.push({prefix:ce,namespace:he})}if(de||re&&!/^(?:meta|link|img|br|hr|input)$/i.test(ue)){if(ee.push(">"),re&&/^script$/i.test(ue))for(;de;)de.data?ee.push(de.data):serializeToString(de,ee,re,ne,ie),de=de.nextSibling;else for(;de;)serializeToString(de,ee,re,ne,ie),de=de.nextSibling;ee.push("</",ue,">")}else ee.push("/>");return;case DOCUMENT_NODE:case DOCUMENT_FRAGMENT_NODE:for(var de=te.firstChild;de;)serializeToString(de,ee,re,ne,ie),de=de.nextSibling;return;case ATTRIBUTE_NODE:return ee.push(" ",te.name,'="',te.value.replace(/[<&"]/g,_xmlEncoder),'"');case TEXT_NODE:return ee.push(te.data.replace(/[<&]/g,_xmlEncoder).replace(/]]>/g,"]]&gt;"));case CDATA_SECTION_NODE:return ee.push("<![CDATA[",te.data,"]]>");case COMMENT_NODE:return ee.push("<!--",te.data,"-->");case DOCUMENT_TYPE_NODE:var me=te.publicId,ge=te.systemId;if(ee.push("<!DOCTYPE ",te.name),me)ee.push(" PUBLIC ",me),ge&&ge!="."&&ee.push(" ",ge),ee.push(">");else if(ge&&ge!=".")ee.push(" SYSTEM ",ge,">");else{var we=te.internalSubset;we&&ee.push(" [",we,"]"),ee.push(">")}return;case PROCESSING_INSTRUCTION_NODE:return ee.push("<?",te.target," ",te.data,"?>");case ENTITY_REFERENCE_NODE:return ee.push("&",te.nodeName,";");default:ee.push("??",te.nodeName)}}function importNode(te,ee,re){var ne;switch(ee.nodeType){case ELEMENT_NODE:ne=ee.cloneNode(!1),ne.ownerDocument=te;case DOCUMENT_FRAGMENT_NODE:break;case ATTRIBUTE_NODE:re=!0;break}if(ne||(ne=ee.cloneNode(!1)),ne.ownerDocument=te,ne.parentNode=null,re)for(var ie=ee.firstChild;ie;)ne.appendChild(importNode(te,ie,re)),ie=ie.nextSibling;return ne}function cloneNode(te,ee,re){var ne=new ee.constructor;for(var ie in ee){var se=ee[ie];typeof se!="object"&&se!=ne[ie]&&(ne[ie]=se)}switch(ee.childNodes&&(ne.childNodes=new NodeList),ne.ownerDocument=te,ne.nodeType){case ELEMENT_NODE:var le=ee.attributes,ue=ne.attributes=new NamedNodeMap,ae=le.length;ue._ownerElement=ne;for(var oe=0;oe<ae;oe++)ne.setAttributeNode(cloneNode(te,le.item(oe),!0));break;case ATTRIBUTE_NODE:re=!0}if(re)for(var ce=ee.firstChild;ce;)ne.appendChild(cloneNode(te,ce,re)),ce=ce.nextSibling;return ne}function __set__(te,ee,re){te[ee]=re}try{if(Object.defineProperty){let te=function(ee){switch(ee.nodeType){case ELEMENT_NODE:case DOCUMENT_FRAGMENT_NODE:var re=[];for(ee=ee.firstChild;ee;)ee.nodeType!==7&&ee.nodeType!==8&&re.push(te(ee)),ee=ee.nextSibling;return re.join("");default:return ee.nodeValue}};Object.defineProperty(LiveNodeList.prototype,"length",{get:function(){return _updateLiveList(this),this.$$length}}),Object.defineProperty(Node$1.prototype,"textContent",{get:function(){return te(this)},set:function(ee){switch(this.nodeType){case ELEMENT_NODE:case DOCUMENT_FRAGMENT_NODE:for(;this.firstChild;)this.removeChild(this.firstChild);(ee||String(ee))&&this.appendChild(this.ownerDocument.createTextNode(ee));break;default:this.data=ee,this.value=ee,this.nodeValue=ee}}}),__set__=function(ee,re,ne){ee["$$"+re]=ne}}}catch{}var nameStartChar=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,nameChar=new RegExp("[\\-\\.0-9"+nameStartChar.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]");new RegExp("^"+nameStartChar.source+nameChar.source+"*(?::"+nameStartChar.source+nameChar.source+"*)?$");function ParseError$1(te,ee){this.message=te,this.locator=ee,Error.captureStackTrace&&Error.captureStackTrace(this,ParseError$1)}ParseError$1.prototype=new Error;ParseError$1.prototype.name=ParseError$1.name;let DOMImplementation=DOMImplementation$1;function DOMHandler(){this.cdata=!1}function position(te,ee){ee.lineNumber=te.lineNumber,ee.columnNumber=te.columnNumber}DOMHandler.prototype={startDocument:function(){this.doc=new DOMImplementation().createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(te,ee,re,ne){var ie=this.doc,se=ie.createElementNS(te,re||ee),le=ne.length;appendElement(this,se),this.currentElement=se,this.locator&&position(this.locator,se);for(var ue=0;ue<le;ue++){var te=ne.getURI(ue),ae=ne.getValue(ue),re=ne.getQName(ue),oe=ie.createAttributeNS(te,re);this.locator&&position(ne.getLocator(ue),oe),oe.value=oe.nodeValue=ae,se.setAttributeNode(oe)}},endElement:function(te,ee,re){var ne=this.currentElement;ne.tagName,this.currentElement=ne.parentNode},startPrefixMapping:function(te,ee){},endPrefixMapping:function(te){},processingInstruction:function(te,ee){var re=this.doc.createProcessingInstruction(te,ee);this.locator&&position(this.locator,re),appendElement(this,re)},ignorableWhitespace:function(te,ee,re){},characters:function(te,ee,re){if(te=_toString.apply(this,arguments),te){if(this.cdata)var ne=this.doc.createCDATASection(te);else var ne=this.doc.createTextNode(te);this.currentElement?this.currentElement.appendChild(ne):/^\s*$/.test(te)&&this.doc.appendChild(ne),this.locator&&position(this.locator,ne)}},skippedEntity:function(te){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(te){(this.locator=te)&&(te.lineNumber=0)},comment:function(te,ee,re){te=_toString.apply(this,arguments);var ne=this.doc.createComment(te);this.locator&&position(this.locator,ne),appendElement(this,ne)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(te,ee,re){var ne=this.doc.implementation;if(ne&&ne.createDocumentType){var ie=ne.createDocumentType(te,ee,re);this.locator&&position(this.locator,ie),appendElement(this,ie)}},warning:function(te){console.warn("[xmldom warning]	"+te,_locator(this.locator))},error:function(te){console.error("[xmldom error]	"+te,_locator(this.locator))},fatalError:function(te){throw new ParseError(te,this.locator)}};function _locator(te){if(te)return`
@`+(te.systemId||"")+"#[line:"+te.lineNumber+",col:"+te.columnNumber+"]"}function _toString(te,ee,re){return typeof te=="string"?te.substr(ee,re):te.length>=ee+re||ee?new java.lang.String(te,ee,re)+"":te}"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(te){DOMHandler.prototype[te]=function(){return null}});function appendElement(te,ee){te.currentElement?te.currentElement.appendChild(ee):te.doc.appendChild(ee)}var ParseError=ParseError$1;class ModelError extends Error{constructor(ee,re){super(ee),this.name="ModelError",this.primitive=re.primitive,this.showEditor=re.showEditor,this.line=re.line,this.details=re.details,this.code=re.code}}function isTrue(te){return te===1||te==="true"||te===!0}function toHTML(te){return te.replace(/[&<>'"]/g,ee=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;","`":"&#96;"})[ee])}function commaStr(te){if(typeof te=="string")return escape(te);if(typeof te=="boolean")return te.toString();if(te==null)return"";if(te>=1e9||te<=1e-9&&te!==0)return te.toPrecision(3);{te=round$1(te,9)+"";let ee=te.split("."),re=ee[0],ne=ee.length>1?"."+ee[1]:"",ie=/(\d+)(\d{3})/;for(;ie.test(re);)re=re.replace(ie,"$1,$2");return re+ne}}function round$1(te,ee=15){return+te.toPrecision(ee)}class Primitive{constructor(ee,re){this._node=ee,this.model=null;for(let ne in re)if(ne in this)this[ne]=re[ne];else throw new Error("Unknown property: "+ne)}delete(){let ee=this.model.find(ne=>ne instanceof Flow||ne instanceof Transition||ne instanceof Link),re=this._node;re.parent.children.includes(re)&&re.parent.children.splice(re.parent.children.indexOf(re),1),ee.forEach(ne=>{ne._node.source===re&&(ne._node.source=null,ne._node.target&&ne._node.target.parent!==ne._node.parent&&(ne.parent=ne._node.target.parent.primitive(this.model))),ne._node.target===re&&(ne._node.target=null,ne._node.source&&ne._node.source.parent!==ne._node.parent&&(ne.parent=ne._node.source.parent.primitive(this.model)))})}get parent(){let ee=this._node.parent;return ee.value&&ee.value.nodeName==="root"||ee.id==="1"?null:ee.primitive(this.model)}set parent(ee){let re;ee===null?re=this.model._graph.children[0].children[0]:re=ee._node,this._node.parent.children.includes(this._node)&&this._node.parent.children.splice(this._node.parent.children.indexOf(this._node),1),re.addChild(this._node)}getParent(ee){let re=this.parent;return re?ee(re)?re:re.getParent(ee):null}isInAgent(){return!!this.getParent(ee=>ee instanceof Agent)}neighbors(){let ee=[],re=this.model.findFlows(),ne=this.model.findLinks();if((this instanceof Flow||this instanceof Link||this instanceof Transition)&&(this.start&&ee.push({item:this.start,type:"direct"}),this.end&&ee.push({item:this.end,type:"direct"})),this instanceof Population&&this.agentBase&&(ee=ee.concat(se(this))),this instanceof Stock)for(let le=0;le<re.length;le++)re[le].start===this&&ee.push({item:re[le],type:"direct",linkHidden:!0}),re[le].end===this&&ee.push({item:re[le],type:"direct",linkHidden:!0});for(let le=0;le<ne.length;le++){if(ne[le].start===this&&ne[le].end){let ue=!ne[le].biDirectional;ee.push({item:ne[le].end,type:"direct",linkHidden:ue}),ee=ee.concat(se(ne[le].end,ue))}ne[le].end===this&&ne[le].start&&!(ne[le].start.isInAgent()&&!this.isInAgent())&&(ee.push({item:ne[le].start,type:"direct"}),ee=ee.concat(se(ne[le].start)))}ee=ee.filter(le=>!!le);let ie=[];for(let le=0;le<ee.length;le++){if(ee[le].linkHidden)continue;let ue=!1;for(let ae=0;ae<ie.length;ae++)if(ie[ae].type===ee[le].type&&ie[ae].item.id===ee[le].item.id){ue=!0,ie[ae].linkHidden&&!ee[le].linkHidden&&(ie[ae].linkHidden=!1);break}ue||(ee[le].item instanceof ValuedPrimitive||ee[le].item instanceof Population)&&ie.push(ee[le])}return ie;function se(le,ue){let ae=[];return le instanceof Population&&le.agentBase&&le.agentBase.children().forEach(ce=>{ce instanceof ValuedPrimitive&&ae.push({item:ce,type:"agent",linkHidden:ue,name:ce.name})}),ae.sort((oe,ce)=>oe.name===ce.name?0:oe.name>ce.name?1:-1),ae}}get id(){return this._node.id}get name(){return this._node.getAttribute("name")}set name(ee){this._node.setAttribute("name",ee)}get note(){return this._node.getAttribute("Note")}set note(ee){this._node.setAttribute("Note",ee)}}class ValuedPrimitive extends Primitive{get units(){return this._node.getAttribute("Units")}set units(ee){this._node.setAttribute("Units",ee)}get constraints(){let ee={};return isTrue(this._node.getAttribute("MinConstraintUsed"))&&(ee.min=+this._node.getAttribute("MinConstraint")),isTrue(this._node.getAttribute("MaxConstraintUsed"))&&(ee.max=+this._node.getAttribute("MaxConstraint")),ee}set constraints(ee){this._node.setAttribute("MinConstraint",ee.min),this._node.setAttribute("MinConstraintUsed","min"in ee),this._node.setAttribute("MaxConstraint",ee.max),this._node.setAttribute("MaxConstraintUsed","max"in ee)}get external(){return isTrue(this._node.getAttribute("ShowSlider"))}set external(ee){this._node.setAttribute("ShowSlider",ee)}}class Stock extends ValuedPrimitive{get initial(){return this._node.getAttribute("InitialValue")||""}set initial(ee){this._node.setAttribute("InitialValue",""+ee)}get type(){return this._node.getAttribute("StockMode")}set type(ee){this._node.setAttribute("StockMode",""+ee)}get delay(){return this._node.getAttribute("Delay")}set delay(ee){this._node.setAttribute("Delay",""+ee)}get nonNegative(){return isTrue(this._node.getAttribute("NonNegative"))}set nonNegative(ee){this._node.setAttribute("NonNegative",ee)}}class Variable extends ValuedPrimitive{get value(){return this._node.getAttribute("Equation")||""}set value(ee){this._node.setAttribute("Equation",""+ee)}}class Converter extends ValuedPrimitive{get interpolation(){return this._node.getAttribute("Interpolation")}set interpolation(ee){this._node.setAttribute("Interpolation",ee)}get values(){return this._node.getAttribute("Data").split(";").map(ee=>{let re=ee.split(",");if(re.length!==2)throw new ModelError(`Converter data point should have the form "x, y", got "${ee}"`,{primitive:this,code:2100});let ne={x:+re[0],y:+re[1]};if(isNaN(ne.x)||isNaN(ne.y))throw new ModelError(`Converter has invalid data "${ee}"`,{primitive:this,showEditor:!0,code:2101});return ne})}set values(ee){this._node.setAttribute("Data",ee.map(re=>re.x+","+re.y).join(";"))}get input(){let ee=this._node.getAttribute("Source");return ee==="Time"?ee:this.model.getId(ee)}set input(ee){this._node.setAttribute("Source",ee==="Time"?ee:ee.id)}}class Flow extends ValuedPrimitive{get rate(){return this._node.getAttribute("FlowRate")||""}set rate(ee){this._node.setAttribute("FlowRate",""+ee)}get start(){return this._node.source?this._node.source.primitive(this.model):null}set start(ee){this._node.source=ee._node}get end(){return this._node.target?this._node.target.primitive(this.model):null}set end(ee){this._node.target=ee._node}get nonNegative(){return isTrue(this._node.getAttribute("OnlyPositive"))}set nonNegative(ee){this._node.setAttribute("OnlyPositive",ee)}}class Link extends Primitive{get biDirectional(){return isTrue(this._node.getAttribute("BiDirectional"))}set biDirectional(ee){this._node.setAttribute("BiDirectional",ee)}get start(){return this._node.source?this._node.source.primitive(this.model):null}set start(ee){this._node.source=ee._node}get end(){return this._node.target?this._node.target.primitive(this.model):null}set end(ee){this._node.target=ee._node}}class State extends ValuedPrimitive{get startActive(){return this._node.getAttribute("Active")}set startActive(ee){this._node.setAttribute("Active",ee)}get residency(){return this._node.getAttribute("Residency")}set residency(ee){this._node.setAttribute("Residency",ee)}}class Transition extends ValuedPrimitive{get value(){return this._node.getAttribute("Value")||""}set value(ee){this._node.setAttribute("Value",""+ee)}get start(){return this._node.source?this._node.source.primitive(this.model):null}set start(ee){this._node.source=ee._node}get end(){return this._node.target?this._node.target.primitive(this.model):null}set end(ee){this._node.target=ee._node}get recalculate(){return isTrue(this._node.getAttribute("Recalculate"))}set recalculate(ee){this._node.setAttribute("Recalculate",ee)}get repeat(){return isTrue(this._node.getAttribute("Repeat"))}set repeat(ee){this._node.setAttribute("Repeat",ee)}get trigger(){return this._node.getAttribute("Trigger")}set trigger(ee){this._node.setAttribute("Trigger",ee)}}class Action extends Primitive{get value(){return this._node.getAttribute("Value")||""}set value(ee){this._node.setAttribute("Value",""+ee)}get action(){return this._node.getAttribute("Action")}set action(ee){this._node.setAttribute("Action",""+ee)}get recalculate(){return isTrue(this._node.getAttribute("Recalculate"))}set recalculate(ee){this._node.setAttribute("Recalculate",ee)}get repeat(){return isTrue(this._node.getAttribute("Repeat"))}set repeat(ee){this._node.setAttribute("Repeat",ee)}get trigger(){return this._node.getAttribute("Trigger")}set trigger(ee){this._node.setAttribute("Trigger",ee)}}class Population extends Primitive{get agentBase(){let ee=this._node.getAttribute("Agent");return ee?this.model.getId(ee):null}set agentBase(ee){this._node.setAttribute("Agent",ee.id)}get populationSize(){return+this._node.getAttribute("Size")}set populationSize(ee){this._node.setAttribute("Size",ee)}get geoUnits(){return this._node.getAttribute("GeoDimUnits")}set geoUnits(ee){this._node.setAttribute("GeoDimUnits",ee)}get geoWidth(){return this._node.getAttribute("GeoWidth")}set geoWidth(ee){this._node.setAttribute("GeoWidth",ee)}get geoHeight(){return this._node.getAttribute("GeoHeight")}set geoHeight(ee){this._node.setAttribute("GeoHeight",ee)}get geoWrapAround(){return isTrue(this._node.getAttribute("GeoWrap"))}set geoWrapAround(ee){this._node.setAttribute("GeoWrap",ee)}get geoPlacementType(){return this._node.getAttribute("Placement")}set geoPlacementType(ee){this._node.setAttribute("Placement",ee)}get geoPlacementFunction(){return this._node.getAttribute("PlacementFunction")}set geoPlacementFunction(ee){this._node.setAttribute("PlacementFunction",ee)}get networkType(){return this._node.getAttribute("Network")}set networkType(ee){this._node.setAttribute("Network",ee)}get networkFunction(){return this._node.getAttribute("NetworkFunction")}set networkFunction(ee){this._node.setAttribute("NetworkFunction",ee)}}class Container extends Primitive{children(ee=!0){let re=this._node.children?this._node.children.map(ne=>ne.primitive(this.model)):[];if(ee){let ne=re.length;for(let ie=0;ie<ne;ie++){let se=re[ie];se instanceof Container&&(re=re.concat(se.children(ee)))}}return re}Stock(ee={}){let re=this.model.Stock(ee);return re.parent=this,re}Variable(ee={}){let re=this.model.Variable(ee);return re.parent=this,re}Converter(ee={}){let re=this.model.Converter(ee);return re.parent=this,re}State(ee={}){let re=this.model.State(ee);return re.parent=this,re}Action(ee={}){let re=this.model.Action(ee);return re.parent=this,re}Population(ee={}){let re=this.model.Population(ee);return re.parent=this,re}Flow(ee,re,ne={}){let ie=this.model.Flow(ee,re,ne);return ie.parent=this,ie}Transition(ee,re,ne={}){let ie=this.model.Transition(ee,re,ne);return ie.parent=this,ie}Link(ee,re,ne={}){let ie=this.model.Link(ee,re,ne);return ie.parent=this,ie}get frozen(){return isTrue(this._node.getAttribute("Frozen"))}set frozen(ee){this._node.setAttribute("Frozen",ee)}get customTimeSettings(){let ee=JSON.parse(this._node.getAttribute("Solver")||"{}");return ee.algorithm==="RK1"&&(ee.algorithm="Euler"),ee}set customTimeSettings(ee){let re=Object.assign({},ee);re.algorithm==="Euler"&&(re.algorithm="RK1"),this._node.setAttribute("Solver",JSON.stringify(re))}}class Folder extends Container{}class Agent extends Container{get agentParent(){return this._node.getAttribute("AgentBase")}set agentParent(ee){this._node.setAttribute("AgentBase",ee)}}class ModelNode{constructor(){this.attributes=new Map,this.parent=null,this.children=[],this.id=null,this.value={nodeName:null},this._primitive=void 0,this.source=null,this.target=null}primitive(ee,re={}){return this._primitive===void 0&&(this.value.nodeName==="Stock"?this._primitive=new Stock(this,re):this.value.nodeName==="Variable"?this._primitive=new Variable(this,re):this.value.nodeName==="Converter"?this._primitive=new Converter(this,re):this.value.nodeName==="State"?this._primitive=new State(this,re):this.value.nodeName==="Action"?this._primitive=new Action(this,re):this.value.nodeName==="Agents"?this._primitive=new Population(this,re):this.value.nodeName==="Flow"?this._primitive=new Flow(this,re):this.value.nodeName==="Transition"?this._primitive=new Transition(this,re):this.value.nodeName==="Link"?this._primitive=new Link(this,re):this.value.nodeName==="Folder"?this.getAttribute("Type")==="Agent"?this._primitive=new Agent(this,re):this._primitive=new Folder(this,re):this._primitive=null,this._primitive&&!this._primitive.model&&(this._primitive.model=ee)),this._primitive}addChild(ee){if(ee.parent){let re=ee.parent.children.indexOf(ee);re>-1&&ee.parent.children.splice(re,1)}this.children.push(ee),ee.parent=this}getAttribute(ee){return ee==="id"?this.id:this.attributes.get(ee)}setAttribute(ee,re){if(ee==="id"){this.id=""+re;return}this.attributes.set(ee,""+re)}getValue(){return{removeAttribute:ee=>this.attributes.delete(ee)}}toString(ee=0){let re=" ".repeat(ee)+`<${this.value.nodeName}${this.getAttribute("name")?" ["+this.getAttribute("name")+"]":""}>`,ne=`</${this.value.nodeName}>`;return re+(this.children.length?`
`:"")+this.children.map(ie=>" ".repeat(ee)+ie.toString(ee+2)).join(`
`)+(this.children.length?`
`+" ".repeat(ee):"")+ne}}function findRootParent(te){return te.parent?findRootParent(te.parent):te}function modelNodeClone(te,ee){let re=new ModelNode;re.value=te.cloneNode(!0),re.parent=ee;let ne=["1"].concat(primitives(findRootParent(ee)).map(ie=>ie.id).filter(ie=>!!ie));if(te.attributes.length>0)for(let ie=0;ie<te.attributes.length;ie++){let se=te.attributes.item(ie);re.setAttribute(se.nodeName,se.nodeValue)}return re.setAttribute("id",""+(Math.max.apply(null,ne)+1)),re}function primitives(te,ee){let re=nodeChildren(te.children[0]);if(ee){let ne=[];for(let ie of re)(Array.isArray(ee)?ee.includes(ie.value.nodeName):ie.value.nodeName===ee)&&ne.push(ie);return ne}else return re}function nodeChildren(te){let ee=te.children.slice(),re=ee.length;for(let ne=0;ne<re;ne++){let ie=ee[ne];ee=ee.concat(nodeChildren(ie))}return ee}let fn={"+":function(te,ee){return te+ee},"-":function(te,ee){return ee!==void 0?te-ee:-te},"*":function(te,ee){return te*ee},"/":function(te,ee){return te/ee},"=":function(te,ee){return te===ee},"<":function(te,ee){return te<ee},"<=":function(te,ee){return te<=ee},">":function(te,ee){return te>ee},">=":function(te,ee){return te>=ee},mod:function(te,ee){return te%ee},expt:function(te,ee){return Math.pow(te,ee)},abs:Math.abs,sin:Math.sin,asin:Math.asin,cos:Math.cos,acos:Math.acos,tan:Math.tan,atan:Math.atan,sqrt:Math.sqrt,log:function(te,ee){return ee!==void 0?Math.log(te)/Math.log(ee):Math.log(te)},exp:Math.exp,round:Math.round,floor:Math.floor,ceiling:Math.ceil};function sortAndCollapseUnits(te,ee){if(te.length<=1)te.length===1&&(te[0]=te[0].toLowerCase());else{let re=[];for(let ne=0;ne<te.length;ne++)re.push({name:te[ne].toLowerCase(),exponent:ee[ne]});re.sort((ne,ie)=>ne.name.localeCompare(ie.name)),te=[],ee=[];for(let ne=0;ne<re.length;ne++)te.push(re[ne].name),ee.push(re[ne].exponent);for(let ne=0;ne<te.length;ne++){for(let ie=ne+1;ie<te.length;ie++)te[ne]===te[ie]&&(ee[ne]=ee[ne]+ee[ie],te.splice(ie,1),ee.splice(ie,1),ie--);ee[ne]===0&&(te.splice(ne,1),ee.splice(ne,1),ne--)}}return{names:te,exponents:ee}}function getUnitsId(te,ee){return te.join(",")+ee.join(",")}class UnitStore{constructor(ee,re,ne){this.manager=ee,this.names=re,this.exponents=ne,this.toBase=null,this.baseUnits=null,this.multiples={},this.id=getUnitsId(this.names,this.exponents)}isUnitless(){return!this.exponents.find(ee=>ee!==0)}addBase(){if(this.toBase!==null)return;this.toBase=1;let ee=this.names.slice(),re=this.exponents.slice(),ne=!0;for(;ne;){ne=!1;for(let se=ee.length-1;se>=0;se--){let le=this.manager.findSource(ee[se]);if(le!==null&&!(le.target.names.length===1&&le.target.names[0]===ee[se])){this.toBase=fn["*"](this.toBase,fn.expt(le.scale,re[se])),ee=ee.concat(le.target.names),ee.splice(se,1);let ue=re[se];re=re.concat(le.target.exponents.map(ae=>ae*ue)),re.splice(se,1),ne=!0;break}}}let ie=sortAndCollapseUnits(ee,re);this.baseUnits=this.manager.getUnitStore(ie.names,ie.exponents,!1,!0)}power(ee){let re=this.names.slice(),ne=this.exponents.slice();for(let ie=0;ie<ne.length;ie++)ne[ie]=ne[ie]*ee;return this.manager.getUnitStore(re,ne)}toStringShort(){let ee="";for(let re=0;re<this.names.length;re++)ee!==""&&(ee=ee+","),ee=ee+this.names[re],this.exponents[re]!==1&&(ee=ee+"^"+this.exponents[re]);return ee}multiply(ee,re){let ne=ee.id+";"+re;if(!(ne in this.multiples)){this.toBase===null&&this.addBase(),ee.toBase===null&&ee.addBase();let ie,se;if(this.baseUnits){if(ie=this.baseUnits.names.slice(),se=this.baseUnits.exponents.slice(),ee.baseUnits){for(let le=0;le<ee.baseUnits.names.length;le++){let ue=ie.indexOf(ee.baseUnits.names[le]);if(ue!==-1)se[ue]=se[ue]+ee.baseUnits.exponents[le]*re;else{let ae=!1;for(let oe=0;oe<ie.length;oe++)if(ee.baseUnits.names[le]<ie[oe]){ie.splice(oe,0,ee.baseUnits.names[le]),se.splice(oe,0,ee.baseUnits.exponents[le]*re),ae=!0;break}ae||(ie.push(ee.baseUnits.names[le]),se.push(ee.baseUnits.exponents[le]*re))}}for(let le=se.length-1;le>=0;le--)se[le]===0&&(se.splice(le,1),ie.splice(le,1))}}else ie=ee.baseUnits.names.slice(),se=ee.baseUnits.exponents.slice();this.multiples[ne]=this.manager.getUnitStore(ie,se)}return this.multiples[ne]}toString(){let ee="",re="",ne=0,ie=0;for(let se=0;se<this.names.length;se++)if(this.names[se]!==""){let le='<span class="unit">'+toHTML(toTitleCase(this.names[se]))+"</span>";this.exponents[se]!==1&&this.exponents[se]!==-1&&(le=le+"<span class='markup'>^</span><sup>"+Math.abs(this.exponents[se])+"</sup>"),this.exponents[se]>0?(ne>0&&(ee=ee+"<span class='markup'>*</span>"),ee=ee+le,ne=ne+1):(ie>0&&(re=re+"<span class='markup'>*</span>"),re=re+le,ie=ie+1)}return ee===""&&(ee="Unitless"),re===""?'<div class="units">'+ee+"</div>":(ee==="Unitless"&&(ee="1"),'<span class="units">'+ee+"<hr/><span class='markup'>/(</span>"+re+"<span class='markup'>)</span></span>")}}const titleCaseReg=/\w\S*/g;function titleCaseFunc(te){return te.charAt(0).toUpperCase()+te.substr(1).toLowerCase()}function toTitleCase(te){return te.replace(titleCaseReg,titleCaseFunc)}function convertUnits(te,ee,re=!1){if(te===ee)return 1;let ne=!te||te.isUnitless(),ie=!ee||ee.isUnitless();return ne&&ie?1:!ne&&ie?0:ne&&!ie?re?1:0:(te.toBase===null&&te.addBase(),ee.toBase===null&&ee.addBase(),te.baseUnits!==ee.baseUnits?0:fn["/"](te.toBase,ee.toBase))}const DEFAULT_UNITS=[{source:/^Degree$/i,targetString:"Degrees",scale:1},{source:/^Radians?$/i,targetString:"Degrees",scale:180/Math.PI},{source:/^Ampere$/i,targetString:"Amperes",scale:1},{source:/^Gram$/i,targetString:"Grams",scale:1},{source:/^Second$/i,targetString:"Seconds",scale:1},{source:/^Meter$/i,targetString:"Meters",scale:1},{source:/^(Meters? ?Squared?|Squared? ?Meters?)$/i,targetString:"Meters^2",scale:1},{source:/^(Centimeters? ?Squared?|Squared? ?Centimeters?)$/i,targetString:"Centimeters^2",scale:1},{source:/^(Centimeters? ?Cubed?|Cubic ?Centimeters?)$/i,targetString:"Centimeters^3",scale:1},{source:/^(Meters? Cubed?|Cubic ?Meters?)$/i,targetString:"Meters^3",scale:1},{source:/^(Kilometers? ?Cubed?|Cubic ?Kilometers?)$/i,targetString:"Kilometers^3",scale:1},{source:/^(Inches? Squared?|Squared? ?Inches?)$/i,targetString:"Inches^2",scale:1},{source:/^(Miles? ?Squared?|Squared? ?Miles?)$/i,targetString:"Miles^2",scale:1},{source:/^(Kilometers? Squared?|Squared? ?Kilometers?)$/i,targetString:"Kilometers^2",scale:1},{source:/^Acre? ?(Feet|Foot)$/i,targetString:"Acres,Feet",scale:1},{source:/^Meters? ?per ?Seconds?$/i,targetString:"Meters,Seconds^-1",scale:1},{source:/^Meters? ?per ?Seconds? ?Squared?$/i,targetString:"Meters,Seconds^-2",scale:1},{source:/^(Foot|Feet) ?per ?Seconds?$/i,targetString:"Feet,Seconds^-1",scale:1},{source:/^(Foot|Feet) ?per ?Seconds? ?Squared?$/i,targetString:"Feet,Seconds^-2",scale:1},{source:/^Miles? ?per ?Hours?$/i,targetString:"Miles,Hours^-1",scale:1},{source:/^Miles? ?per ?Hours? ?Squared?$/i,targetString:"Miles,Hours^-2",scale:1},{source:/^Kilometers? ?per ?Hours?$/i,targetString:"Kilometers,Hours^-1",scale:1},{source:/^Kilometers? ?per ?Hours? ?Squared?$/i,targetString:"Kilometers,Hours^-2",scale:1},{source:/^Liters? ?per ?Seconds?$/i,targetString:"Liters,Seconds^-1",scale:1},{source:/^(Cubic ?Meters?|Meters? ?Cubed?) ?per ?Seconds?$/i,targetString:"Meters^3,Seconds^-1",scale:1},{source:/^(Squared? ?Yards?|Yards? ?Squared?)$/i,targetString:"Yards^2",scale:1},{source:/^(Squared? ?(Feet|Foot)|(Feet|Foot) ?Squared?)$/i,targetString:"Feet^2",scale:1},{source:/^(Squared? Millimeters?|Millimeters? ?Squared?)$/i,targetString:"Millimeters^2",scale:1},{source:/^(Millimeters? ?Cubed?|Cubic ?Millimeters?)$/i,targetString:"Millimeters^3",scale:1},{source:/^Gallons? ?per ?Seconds?$/i,targetString:"Gallons,Seconds^-1",scale:1},{source:/^Gallons? ?per ?Minutes?$/i,targetString:"Gallons,Minutes^-1",scale:1},{source:/^Pounds? ?per ?Seconds?$/i,targetString:"Pounds,Seconds^-1",scale:1},{source:/^Kilograms? ?per ?Seconds?$/i,targetString:"Kilograms,Seconds^-1",scale:1},{source:/^Dollars? ?per ?Seconds?$/i,targetString:"Dollars,Seconds^-1",scale:1},{source:/^Dollars? ?per ?Hours?$/i,targetString:"Dollars,Hours^-1",scale:1},{source:/^Dollars? ?per ?Days?$/i,targetString:"Dollars,Days^-1",scale:1},{source:/^Dollars? ?per ?Weeks?$/i,targetString:"Dollars,Weeks^-1",scale:1},{source:/^Dollars? ?per ?Months?$/i,targetString:"Dollars,Months^-1",scale:1},{source:/^Dollars? ?per ?Quarters?$/i,targetString:"Dollars,Quarters^-1",scale:1},{source:/^Dollars? ?per ?Years?$/i,targetString:"Dollars,Years^-1",scale:1},{source:/^Euros? ?per ?Seconds?$/i,targetString:"Euros,Seconds^-1",scale:1},{source:/^Euros? ?per ?Hours?$/i,targetString:"Euros,Hours^-1",scale:1},{source:/^Euros? ?per ?Days?$/i,targetString:"Euros,Days^-1",scale:1},{source:/^Euros? ?per ?Weeks?$/i,targetString:"Euros,Weeks^-1",scale:1},{source:/^Euros? ?per ?Months?$/i,targetString:"Euros,Months^-1",scale:1},{source:/^Euros? ?per ?Quarters?$/i,targetString:"Euros,Quarters^-1",scale:1},{source:/^Euros? ?per ?Years?$/i,targetString:"Euros,Years^-1",scale:1},{source:/^Centimeters?$/i,targetString:"Meters",scale:.01},{source:/^Millimeters?$/i,targetString:"Meters",scale:.001},{source:/^Kilometers?$/i,targetString:"Meters",scale:1e3},{source:/^Inch(es)?$/i,targetString:"Meters",scale:.0254},{source:/^(Foot|Feet)$/i,targetString:"Meters",scale:.3048},{source:/^Yards?$/i,targetString:"Meters",scale:.9144},{source:/^Miles?$/i,targetString:"Meters",scale:1609.344},{source:/^Acres?$/i,targetString:"Meters^2",scale:4046.85642},{source:/^Hectares?$/i,targetString:"Meters^2",scale:1e4},{source:/^Liters?$/i,targetString:"Meters^3",scale:.001},{source:/^Gallons?$/i,targetString:"Meters^3",scale:.003785},{source:/^Quarts?$/i,targetString:"Meters^3",scale:946e-6},{source:/^Fluid ?Ounces?$/i,targetString:"Meters^3",scale:3e-5},{source:/^Years?$/i,targetString:"Seconds",scale:31536e3},{source:/^Quarters?$/i,targetString:"Seconds",scale:7884e3},{source:/^Months?$/i,targetString:"Seconds",scale:2628e3},{source:/^Weeks?$/i,targetString:"Seconds",scale:604800},{source:/^Days?$/i,targetString:"Seconds",scale:86400},{source:/^Hours?$/i,targetString:"Seconds",scale:3600},{source:/^Minutes?$/i,targetString:"Seconds",scale:60},{source:/^Kilograms?$/i,targetString:"Grams",scale:1e3},{source:/^Milligrams?$/i,targetString:"Grams",scale:.001},{source:/^Ounces?$/i,targetString:"Grams",scale:28.349523},{source:/^Pounds?$/i,targetString:"Grams",scale:453.59237},{source:/^Tonnes?$/i,targetString:"Grams",scale:1e6},{source:/^Tons?$/i,targetString:"Grams",scale:907184.74},{source:/^Watts?$/i,targetString:"Joules,Seconds^-1",scale:1},{source:/^Kilowatts?$/i,targetString:"Watts",scale:1e3},{source:/^Megawatts?$/i,targetString:"Watts",scale:1e6},{source:/^Gigawatts?$/i,targetString:"Watts",scale:1e9},{source:/^Calories?$/i,targetString:"Joules",scale:4.184},{source:/^Kilocalories?$/i,targetString:"Joules",scale:4184},{source:/^(BTUs?|British ?Thermal ?units?)$/i,targetString:"Joules",scale:1055.05585},{source:/^Kilojoules?$/i,targetString:"Joules",scale:1e3},{source:/^Joules?$/i,targetString:"Newtons,Meters",scale:1},{source:/^Coulombs?$/i,targetString:"Amperes,Seconds",scale:1},{source:/^Volts?$/i,targetString:"Watts,Amperes^-1",scale:1},{source:/^Millivolts?$/i,targetString:"Volts",scale:.001},{source:/^Kilovolts?$/i,targetString:"Volts",scale:1e3},{source:/^Newtons?$/i,targetString:"Kilograms,Meters,Seconds^-2",scale:1},{source:/^Pounds? ?Force$/i,targetString:"Pounds,Feet per Second Squared",scale:32.17405},{source:/^Atoms?$/i,targetString:"Moles",scale:1/602214076e15},{source:/^Molecules?$/i,targetString:"Moles",scale:1/602214076e15},{source:/^Farads?$/i,targetString:"Joules,Volts^-2",scale:1},{source:/^Pascals?$/i,targetString:"Newton,Meters^-2",scale:1},{source:/^Kilopascals?$/i,targetString:"Pascals",scale:1e3},{source:/^Bars?$/i,targetString:"Pascals",scale:1e5},{source:/^Atmospheres?$/i,targetString:"Pascals",scale:101325},{source:/^Pounds? ?per ?Squared? ?Inch(es)?$/i,targetString:"Pascals",scale:6894}];class UnitManager{constructor(){this.unitDefinitions=[],this.cachedUnits=Object.create(null),this.unitsBank=Object.create(null),this.addUnits(DEFAULT_UNITS)}addUnits(ee){for(let re of ee)re.source||(re.source=new RegExp("^"+re.sourceString+"$","i")),re.target||(re.target=this.unitsFromString(re.targetString.toLowerCase()));this.unitDefinitions=ee.concat(this.unitDefinitions)}findSource(ee){if(!(ee in this.cachedUnits)){this.cachedUnits[ee]=null;for(let re=this.unitDefinitions.length-1;re>=0;re--)if(this.unitDefinitions[re].source.test(ee)){this.cachedUnits[ee]=this.unitDefinitions[re];break}}return this.cachedUnits[ee]}getUnitStore(ee,re,ne=!1,ie=!1){if(ne){let le=sortAndCollapseUnits(ee,re);ee=le.names,re=le.exponents}if(!ie&&!ee.length)return;let se=getUnitsId(ee,re);return this.unitsBank[se]||(this.unitsBank[se]=new UnitStore(this,ee,re)),this.unitsBank[se]}unitsFromString(ee){let re=[],ne=[];if(ee){let ie=ee.split(",");for(let se=0;se<ie.length;se++)re.push(ie[se].split("^")[0]),ie[se].indexOf("^")!==-1?ne.push(parseFloat(ie[se].split("^")[1])):ne.push(1)}return this.getUnitStore(re,ne,!0)}}class Material{constructor(ee,re){this.value=ee,this.units=re}toNum(){return this}toString(){return this.units&&!this.units.isUnitless()?"{"+this.value+" "+this.units.toStringShort()+"}":this.value+""}fullClone(){return new Material(this.value,this.units)}forceUnits(ee){if(!this.units)this.units=ee;else{let re=convertUnits(this.units,ee);re===0?unitAlert(this.units,ee,"conversion of units"):(this.value=fn["*"](this.value,re),this.units=ee)}return this}}function unitAlert(te,ee,re){throw new ModelError("Incompatible units for the "+re+" of "+(te&&!te.isUnitless()?te.toString():"unitless")+" and "+(ee&&!ee.isUnitless()?ee.toString():"unitless")+".",{code:5e3})}let DP=20,RM=1,MAX_DP=1e6,MAX_POWER=1e6,NE=-7,PE=21,STRICT=!1,NAME="[big.js] ",INVALID=NAME+"Invalid ",INVALID_DP=INVALID+"decimal places",INVALID_RM=INVALID+"rounding mode",DIV_BY_ZERO=NAME+"Division by zero",P={},UNDEFINED,NUMERIC=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i;function _Big_(){function te(ee){let re=this;if(!(re instanceof te))return ee===UNDEFINED?_Big_():new te(ee);if(ee instanceof te)re.s=ee.s,re.e=ee.e,re.c=ee.c.slice();else{if(typeof ee!="string"){if(te.strict===!0)throw TypeError(INVALID+"number");ee=ee===0&&1/ee<0?"-0":String(ee)}parse(re,ee)}re.constructor=te}return te.prototype=P,te.DP=DP,te.RM=RM,te.NE=NE,te.PE=PE,te.strict=STRICT,te.roundDown=0,te.roundHalfUp=1,te.roundHalfEven=2,te.roundUp=3,te}function parse(te,ee){let re,ne,ie;if(!NUMERIC.test(ee))throw Error(INVALID+"number");for(te.s=ee.charAt(0)=="-"?(ee=ee.slice(1),-1):1,(re=ee.indexOf("."))>-1&&(ee=ee.replace(".","")),(ne=ee.search(/e/i))>0?(re<0&&(re=ne),re+=+ee.slice(ne+1),ee=ee.substring(0,ne)):re<0&&(re=ee.length),ie=ee.length,ne=0;ne<ie&&ee.charAt(ne)=="0";)++ne;if(ne==ie)te.c=[te.e=0];else{for(;ie>0&&ee.charAt(--ie)=="0";);for(te.e=re-ne-1,te.c=[],re=0;ne<=ie;)te.c[re++]=+ee.charAt(ne++)}return te}function round(te,ee,re,ne){let ie=te.c;if(re===UNDEFINED&&(re=te.constructor.RM),re!==0&&re!==1&&re!==2&&re!==3)throw Error(INVALID_RM);if(ee<1)ne=re===3&&(ne||!!ie[0])||ee===0&&(re===1&&ie[0]>=5||re===2&&(ie[0]>5||ie[0]===5&&(ne||ie[1]!==UNDEFINED))),ie.length=1,ne?(te.e=te.e-ee+1,ie[0]=1):ie[0]=te.e=0;else if(ee<ie.length){if(ne=re===1&&ie[ee]>=5||re===2&&(ie[ee]>5||ie[ee]===5&&(ne||ie[ee+1]!==UNDEFINED||ie[ee-1]&1))||re===3&&(ne||!!ie[0]),ie.length=ee--,ne)for(;++ie[ee]>9;)ie[ee]=0,ee--||(++te.e,ie.unshift(1));for(ee=ie.length;!ie[--ee];)ie.pop()}return te}function stringify$1(te,ee,re){let ne=te.e,ie=te.c.join(""),se=ie.length;if(ee)ie=ie.charAt(0)+(se>1?"."+ie.slice(1):"")+(ne<0?"e":"e+")+ne;else if(ne<0){for(;++ne;)ie="0"+ie;ie="0."+ie}else if(ne>0)if(++ne>se)for(ne-=se;ne--;)ie+="0";else ne<se&&(ie=ie.slice(0,ne)+"."+ie.slice(ne));else se>1&&(ie=ie.charAt(0)+"."+ie.slice(1));return te.s<0&&re?"-"+ie:ie}P.abs=function(){let te=new this.constructor(this);return te.s=1,te};P.cmp=function(te){let ee,re=this,ne=re.c,ie=(te=new re.constructor(te)).c,se=re.s,le=te.s,ue=re.e,ae=te.e;if(!ne[0]||!ie[0])return ne[0]?se:ie[0]?-le:0;if(se!=le)return se;if(ee=se<0,ue!=ae)return ue>ae^ee?1:-1;for(le=(ue=ne.length)<(ae=ie.length)?ue:ae,se=-1;++se<le;)if(ne[se]!=ie[se])return ne[se]>ie[se]^ee?1:-1;return ue==ae?0:ue>ae^ee?1:-1};P.div=function(te){let ee=this,re=ee.constructor,ne=ee.c,ie=(te=new re(te)).c,se=ee.s==te.s?1:-1,le=re.DP;if(le!==~~le||le<0||le>MAX_DP)throw Error(INVALID_DP);if(!ie[0])throw Error(DIV_BY_ZERO);if(!ne[0])return te.s=se,te.c=[te.e=0],te;let ue,ae,oe,ce,he,pe=ie.slice(),de=ue=ie.length,me=ne.length,ge=ne.slice(0,ue),we=ge.length,ve=te,_e=ve.c=[],Te=0,ye=le+(ve.e=ee.e-te.e)+1;for(ve.s=se,se=ye<0?0:ye,pe.unshift(0);we++<ue;)ge.push(0);do{for(oe=0;oe<10;oe++){if(ue!=(we=ge.length))ce=ue>we?1:-1;else for(he=-1,ce=0;++he<ue;)if(ie[he]!=ge[he]){ce=ie[he]>ge[he]?1:-1;break}if(ce<0){for(ae=we==ue?ie:pe;we;){if(ge[--we]<ae[we]){for(he=we;he&&!ge[--he];)ge[he]=9;--ge[he],ge[we]+=10}ge[we]-=ae[we]}for(;!ge[0];)ge.shift()}else break}_e[Te++]=ce?oe:++oe,ge[0]&&ce?ge[we]=ne[de]||0:ge=[ne[de]]}while((de++<me||ge[0]!==UNDEFINED)&&se--);return!_e[0]&&Te!=1&&(_e.shift(),ve.e--,ye--),Te>ye&&round(ve,ye,re.RM,ge[0]!==UNDEFINED),ve};P.eq=function(te){return this.cmp(te)===0};P.gt=function(te){return this.cmp(te)>0};P.gte=function(te){return this.cmp(te)>-1};P.lt=function(te){return this.cmp(te)<0};P.lte=function(te){return this.cmp(te)<1};P.minus=P.sub=function(te){let ee,re,ne,ie,se=this,le=se.constructor,ue=se.s,ae=(te=new le(te)).s;if(ue!=ae)return te.s=-ae,se.plus(te);let oe=se.c.slice(),ce=se.e,he=te.c,pe=te.e;if(!oe[0]||!he[0])return he[0]?te.s=-ae:oe[0]?te=new le(se):te.s=1,te;if(ue=ce-pe){for((ie=ue<0)?(ue=-ue,ne=oe):(pe=ce,ne=he),ne.reverse(),ae=ue;ae--;)ne.push(0);ne.reverse()}else for(re=((ie=oe.length<he.length)?oe:he).length,ue=ae=0;ae<re;ae++)if(oe[ae]!=he[ae]){ie=oe[ae]<he[ae];break}if(ie&&(ne=oe,oe=he,he=ne,te.s=-te.s),(ae=(re=he.length)-(ee=oe.length))>0)for(;ae--;)oe[ee++]=0;for(ae=ee;re>ue;){if(oe[--re]<he[re]){for(ee=re;ee&&!oe[--ee];)oe[ee]=9;--oe[ee],oe[re]+=10}oe[re]-=he[re]}for(;oe[--ae]===0;)oe.pop();for(;oe[0]===0;)oe.shift(),--pe;return oe[0]||(te.s=1,oe=[pe=0]),te.c=oe,te.e=pe,te};P.mod=function(te){let ee,re=this,ne=re.constructor,ie=re.s,se=(te=new ne(te)).s;if(!te.c[0])throw Error(DIV_BY_ZERO);return re.s=te.s=1,ee=te.cmp(re)==1,re.s=ie,te.s=se,ee?new ne(re):(ie=ne.DP,se=ne.RM,ne.DP=ne.RM=0,re=re.div(te),ne.DP=ie,ne.RM=se,this.minus(re.times(te)))};P.plus=P.add=function(te){let ee,re,ne,ie=this,se=ie.constructor;if(te=new se(te),ie.s!=te.s)return te.s=-te.s,ie.minus(te);let le=ie.e,ue=ie.c,ae=te.e,oe=te.c;if(!ue[0]||!oe[0])return oe[0]||(ue[0]?te=new se(ie):te.s=ie.s),te;if(ue=ue.slice(),ee=le-ae){for(ee>0?(ae=le,ne=oe):(ee=-ee,ne=ue),ne.reverse();ee--;)ne.push(0);ne.reverse()}for(ue.length-oe.length<0&&(ne=oe,oe=ue,ue=ne),ee=oe.length,re=0;ee;ue[ee]%=10)re=(ue[--ee]=ue[ee]+oe[ee]+re)/10|0;for(re&&(ue.unshift(re),++ae),ee=ue.length;ue[--ee]===0;)ue.pop();return te.c=ue,te.e=ae,te};P.pow=function(te){let ee=this,re=new ee.constructor("1"),ne=re,ie=te<0;if(te!==~~te||te<-MAX_POWER||te>MAX_POWER)throw Error(INVALID+"exponent");for(ie&&(te=-te);te&1&&(ne=ne.times(ee)),te>>=1,!!te;)ee=ee.times(ee);return ie?re.div(ne):ne};P.prec=function(te,ee){if(te!==~~te||te<1||te>MAX_DP)throw Error(INVALID+"precision");return round(new this.constructor(this),te,ee)};P.round=function(te,ee){if(te===UNDEFINED)te=0;else if(te!==~~te||te<-MAX_DP||te>MAX_DP)throw Error(INVALID_DP);return round(new this.constructor(this),te+this.e+1,ee)};P.sqrt=function(){let te,ee,re,ne=this,ie=ne.constructor,se=ne.s,le=ne.e,ue=new ie("0.5");if(!ne.c[0])return new ie(ne);if(se<0)throw Error(NAME+"No square root");se=Math.sqrt(ne+""),se===0||se===1/0?(ee=ne.c.join(""),ee.length+le&1||(ee+="0"),se=Math.sqrt(ee),le=((le+1)/2|0)-(le<0||le&1),te=new ie((se==1/0?"5e":(se=se.toExponential()).slice(0,se.indexOf("e")+1))+le)):te=new ie(se+""),le=te.e+(ie.DP+=4);do re=te,te=ue.times(re.plus(ne.div(re)));while(re.c.slice(0,le).join("")!==te.c.slice(0,le).join(""));return round(te,(ie.DP-=4)+te.e+1,ie.RM)};P.times=P.mul=function(te){let ee,re=this,ne=re.constructor,ie=re.c,se=(te=new ne(te)).c,le=ie.length,ue=se.length,ae=re.e,oe=te.e;if(te.s=re.s==te.s?1:-1,!ie[0]||!se[0])return te.c=[te.e=0],te;for(te.e=ae+oe,le<ue&&(ee=ie,ie=se,se=ee,oe=le,le=ue,ue=oe),ee=new Array(oe=le+ue);oe--;)ee[oe]=0;for(ae=ue;ae--;){for(ue=0,oe=le+ae;oe>ae;)ue=ee[oe]+se[ae]*ie[oe-ae-1]+ue,ee[oe--]=ue%10,ue=ue/10|0;ee[oe]=ue}for(ue?++te.e:ee.shift(),ae=ee.length;!ee[--ae];)ee.pop();return te.c=ee,te};P.toExponential=function(te,ee){let re=this,ne=re.c[0];if(te!==UNDEFINED){if(te!==~~te||te<0||te>MAX_DP)throw Error(INVALID_DP);for(re=round(new re.constructor(re),++te,ee);re.c.length<te;)re.c.push(0)}return stringify$1(re,!0,!!ne)};P.toFixed=function(te,ee){let re=this,ne=re.c[0];if(te!==UNDEFINED){if(te!==~~te||te<0||te>MAX_DP)throw Error(INVALID_DP);for(re=round(new re.constructor(re),te+re.e+1,ee),te=te+re.e+1;re.c.length<te;)re.c.push(0)}return stringify$1(re,!1,!!ne)};P.toJSON=P.toString=function(){let te=this,ee=te.constructor;return stringify$1(te,te.e<=ee.NE||te.e>=ee.PE,!!te.c[0])};P.toNumber=function(){let te=Number(stringify$1(this,!0,!0));if(this.constructor.strict===!0&&!this.eq(te.toString()))throw Error(NAME+"Imprecise conversion");return te};P.toPrecision=function(te,ee){let re=this,ne=re.constructor,ie=re.c[0];if(te!==UNDEFINED){if(te!==~~te||te<1||te>MAX_DP)throw Error(INVALID+"precision");for(re=round(new ne(re),te,ee);re.c.length<te;)re.c.push(0)}return stringify$1(re,te<=re.e||re.e<=ne.NE||re.e>=ne.PE,!!ie)};P.valueOf=function(){let te=this,ee=te.constructor;if(ee.strict===!0)throw Error(NAME+"valueOf disallowed");return stringify$1(te,te.e<=ee.NE||te.e>=ee.PE,!0)};var Big=_Big_();class AggregateSeries{constructor(ee,re,ne){this.simulate=ee,this.id=re,this.spacing=ne,this.oldValues=[]}match(ee){return this.id===ee}get(ee){let re=0;for(this.spacing<0?re=0:this.spacing===0?re=Math.floor(div(minus(this.simulate.time(),this.simulate.timeStart),this.simulate.userTimeStep).value):this.spacing instanceof Material?re=Math.floor(div(minus(this.simulate.time(),this.simulate.timeStart),this.spacing.forceUnits(this.simulate.timeUnits)).value):console.error("Invalid spacing:",this.spacing);this.oldValues.length-1<re;){let ne=evaluateNode(ee.node,ee.scope,this.simulate);ne instanceof SPrimitive&&(ne=ne.value()),this.oldValues.push(ne)}return this.oldValues[re].fullClone?this.oldValues[re].fullClone():this.oldValues[re]}}class DataBank{constructor(){this.dataSeries={}}series(){return Object.keys(this.dataSeries)}clone(){let ee=new DataBank,re=this.series();for(let ne=0;ne<re.length;ne++)ee.dataSeries[re[ne]]=this.dataSeries[re[ne]];return ee}getSeries(ee){return ee in this.dataSeries||(this.dataSeries[ee]=[]),this.dataSeries[ee]}trimValues(ee){let re=this.series();for(let ne=0;ne<re.length;ne++){let ie=this.getSeries(re[ne]);ie.length-1>ee&&ie.splice(ee+1,ie.length-ee+1)}}}function print$1(te,ee=re=>re.key){let re=[];return row(te,"",!0,ne=>re.push(ne),ee),re.join("")}function row(te,ee,re,ne,ie){if(te){ne(`${ee}${re?"└── ":"├── "}${ie(te)}
`);const se=ee+(re?"    ":"│   ");te.left&&row(te.left,se,!1,ne,ie),te.right&&row(te.right,se,!0,ne,ie)}}function isBalanced(te){if(te===null)return!0;let ee=height(te.left),re=height(te.right);return!!(Math.abs(ee-re)<=1&&isBalanced(te.left)&&isBalanced(te.right))}function height(te){return te?1+Math.max(height(te.left),height(te.right)):0}function loadRecursive(te,ee,re,ne,ie){const se=ie-ne;if(se>0){const le=ne+Math.floor(se/2),ue=ee[le],ae=re[le],oe={key:ue,data:ae,parent:te};return oe.left=loadRecursive(oe,ee,re,ne,le),oe.right=loadRecursive(oe,ee,re,le+1,ie),oe}return null}function markBalance(te){if(te===null)return 0;const ee=markBalance(te.left),re=markBalance(te.right);return te.balanceFactor=ee-re,Math.max(ee,re)+1}function sort(te,ee,re,ne,ie){if(re>=ne)return;const se=te[re+ne>>1];let le=re-1,ue=ne+1;for(;;){do le++;while(ie(te[le],se)<0);do ue--;while(ie(te[ue],se)>0);if(le>=ue)break;let ae=te[le];te[le]=te[ue],te[ue]=ae,ae=ee[le],ee[le]=ee[ue],ee[ue]=ae}sort(te,ee,re,ue,ie),sort(te,ee,ue+1,ne,ie)}function DEFAULT_COMPARE(te,ee){return te>ee?1:te<ee?-1:0}function rotateLeft(te){let ee=te.right;return te.right=ee.left,ee.left&&(ee.left.parent=te),ee.parent=te.parent,ee.parent&&(ee.parent.left===te?ee.parent.left=ee:ee.parent.right=ee),te.parent=ee,ee.left=te,te.balanceFactor+=1,ee.balanceFactor<0&&(te.balanceFactor-=ee.balanceFactor),ee.balanceFactor+=1,te.balanceFactor>0&&(ee.balanceFactor+=te.balanceFactor),ee}function rotateRight(te){let ee=te.left;return te.left=ee.right,te.left&&(te.left.parent=te),ee.parent=te.parent,ee.parent&&(ee.parent.left===te?ee.parent.left=ee:ee.parent.right=ee),te.parent=ee,ee.right=te,te.balanceFactor-=1,ee.balanceFactor>0&&(te.balanceFactor-=ee.balanceFactor),ee.balanceFactor-=1,te.balanceFactor<0&&(ee.balanceFactor+=te.balanceFactor),ee}class AVLTree{constructor(ee,re=!1){this._comparator=ee||DEFAULT_COMPARE,this._root=null,this._size=0,this._noDuplicates=!!re}destroy(){return this.clear()}clear(){return this._root=null,this._size=0,this}get size(){return this._size}contains(ee){if(this._root){let re=this._root,ne=this._comparator;for(;re;){let ie=ne(ee,re.key);if(ie===0)return!0;ie<0?re=re.left:re=re.right}}return!1}next(ee){let re=ee;if(re)if(re.right)for(re=re.right;re.left;)re=re.left;else for(re=ee.parent;re&&re.right===ee;)ee=re,re=re.parent;return re}prev(ee){let re=ee;if(re)if(re.left)for(re=re.left;re.right;)re=re.right;else for(re=ee.parent;re&&re.left===ee;)ee=re,re=re.parent;return re}forEach(ee){let re=this._root,ne=[],ie=!1,se=0;for(;!ie;)re?(ne.push(re),re=re.left):ne.length>0?(re=ne.pop(),ee(re,se++),re=re.right):ie=!0;return this}range(ee,re,ne,ie){const se=[],le=this._comparator;let ue=this._root,ae;for(;se.length!==0||ue;)if(ue)se.push(ue),ue=ue.left;else{if(ue=se.pop(),ae=le(ue.key,re),ae>0)break;if(le(ue.key,ee)>=0&&ne.call(ie,ue))return this;ue=ue.right}return this}keys(){let ee=this._root,re=[],ne=[],ie=!1;for(;!ie;)ee?(re.push(ee),ee=ee.left):re.length>0?(ee=re.pop(),ne.push(ee.key),ee=ee.right):ie=!0;return ne}values(){let ee=this._root,re=[],ne=[],ie=!1;for(;!ie;)ee?(re.push(ee),ee=ee.left):re.length>0?(ee=re.pop(),ne.push(ee.data),ee=ee.right):ie=!0;return ne}at(ee){let re=this._root,ne=[],ie=!1,se=0;for(;!ie;)if(re)ne.push(re),re=re.left;else if(ne.length>0){if(re=ne.pop(),se===ee)return re;se++,re=re.right}else ie=!0;return null}minNode(){let ee=this._root;if(!ee)return null;for(;ee.left;)ee=ee.left;return ee}maxNode(){let ee=this._root;if(!ee)return null;for(;ee.right;)ee=ee.right;return ee}min(){let ee=this._root;if(!ee)return null;for(;ee.left;)ee=ee.left;return ee.key}max(){let ee=this._root;if(!ee)return null;for(;ee.right;)ee=ee.right;return ee.key}isEmpty(){return!this._root}pop(){let ee=this._root,re=null;if(ee){for(;ee.left;)ee=ee.left;re={key:ee.key,data:ee.data},this.remove(ee.key)}return re}popMax(){let ee=this._root,re=null;if(ee){for(;ee.right;)ee=ee.right;re={key:ee.key,data:ee.data},this.remove(ee.key)}return re}find(ee){let ne=this._root,ie,se=this._comparator;for(;ne;){if(ie=se(ee,ne.key),ie===0)return ne;ie<0?ne=ne.left:ne=ne.right}return null}insert(ee,re){if(!this._root)return this._root={parent:null,left:null,right:null,balanceFactor:0,key:ee,data:re},this._size++,this._root;let ne=this._comparator,ie=this._root,se=null,le=0;if(this._noDuplicates)for(;ie;){if(le=ne(ee,ie.key),se=ie,le===0)return null;le<0?ie=ie.left:ie=ie.right}else for(;ie;)le=ne(ee,ie.key),se=ie,le<=0?ie=ie.left:ie=ie.right;let ue={left:null,right:null,balanceFactor:0,parent:se,key:ee,data:re},ae;for(le<=0?se.left=ue:se.right=ue;se&&(le=ne(se.key,ee),le<0?se.balanceFactor-=1:se.balanceFactor+=1,se.balanceFactor!==0);){if(se.balanceFactor<-1){se.right.balanceFactor===1&&rotateRight(se.right),ae=rotateLeft(se),se===this._root&&(this._root=ae);break}else if(se.balanceFactor>1){se.left.balanceFactor===-1&&rotateLeft(se.left),ae=rotateRight(se),se===this._root&&(this._root=ae);break}se=se.parent}return this._size++,ue}remove(ee){if(!this._root)return null;let re=this._root,ne=this._comparator,ie=0;for(;re&&(ie=ne(ee,re.key),ie!==0);)ie<0?re=re.left:re=re.right;if(!re)return null;let se=re.key,le,ue;if(re.left){for(le=re.left;le.left||le.right;){for(;le.right;)le=le.right;re.key=le.key,re.data=le.data,le.left&&(re=le,le=le.left)}re.key=le.key,re.data=le.data,re=le}if(re.right){for(ue=re.right;ue.left||ue.right;){for(;ue.left;)ue=ue.left;re.key=ue.key,re.data=ue.data,ue.right&&(re=ue,ue=ue.right)}re.key=ue.key,re.data=ue.data,re=ue}let ae=re.parent,oe=re,ce;for(;ae&&(ae.left===oe?ae.balanceFactor-=1:ae.balanceFactor+=1,ae.balanceFactor<-1?(ae.right.balanceFactor===1&&rotateRight(ae.right),ce=rotateLeft(ae),ae===this._root&&(this._root=ce),ae=ce):ae.balanceFactor>1&&(ae.left.balanceFactor===-1&&rotateLeft(ae.left),ce=rotateRight(ae),ae===this._root&&(this._root=ce),ae=ce),!(ae.balanceFactor===-1||ae.balanceFactor===1));)oe=ae,ae=ae.parent;return re.parent&&(re.parent.left===re?re.parent.left=null:re.parent.right=null),re===this._root&&(this._root=null),this._size--,se}load(ee=[],re=[],ne=!1){if(this._size!==0)throw new Error("bulk-load: tree is not empty");const ie=ee.length;return ne&&sort(ee,re,0,ie-1,this._comparator),this._root=loadRecursive(null,ee,re,0,ie),markBalance(this._root),this._size=ie,this}isBalanced(){return isBalanced(this._root)}toString(ee){return print$1(this._root,ee)}}AVLTree.default=AVLTree;class TaskQueue{constructor(ee){ee=ee||{},this.tasks=new AVLTree(compare),this.onMoveEvents=[],this.setTime(ee.start),this.debug=!1,this.end=ee.end,this.states={},this.cursor=null}print(){console.log("Current Time: "+this.time.value);let ee=this.tasks.minNode();for(;ee;)console.log(ee.key.name),console.log("    Time: "+ee.key.time.value),console.log("    Priority: "+ee.key.priority),ee.key.expires!==void 0&&console.log("    Expires: "+ee.key.expires),ee.key.skip!==void 0&&console.log("    Skip: "+ee.key.skip),ee=this.tasks.next(ee)}addEvent(ee){this.onMoveEvents.push(ee)}fireEvents(ee,re,ne){this.debug&&console.log("Firing Events");for(let ie=0;ie<this.onMoveEvents.length;ie++)this.onMoveEvents[ie](ee,re,ne)}setTime(ee){if(this.time===void 0||neq(ee,this.time)){let re=this.time;this.time=ee,re!==void 0&&this.fireEvents(minus(ee,re),re,ee)}}moveTo(ee){if(!eq(this.time,ee)){if(this.debug&&console.log("Shifting time to: "+ee.value),this.cursor){let re=this.tasks.max().time,ne=this.tasks.min().time;for(;lessThan(this.time,ee)&&!greaterThan(this.time,re);)this.step();for(;greaterThan(this.time,ee)&&greaterThan(this.time,ne);)this.stepBack()}this.setTime(ee),this.debug&&console.log("Time shift to  "+ee.value+" completed.")}}add(ee){ee.queue=this,this.tasks.insert(ee)}goNext(){this.cursor=this.tasks.next(this.cursor)}goPrev(){this.cursor=this.tasks.prev(this.cursor)}step(){this.time===void 0&&(this.cursor=this.tasks.minNode(),this.setTime(this.cursor.key.time));let ee=this.cursor.key;if(ee){let re=ee.deadAction;if(ee.execute(),!re&&ee.timeShift){ee.timeShift();return}this.goNext()}this.cursor?this.setTime(this.cursor.key.time):(this.goNext(),this.setTime(mult(this.tasks.max().time,new Material(10))))}stepBack(){if(this.time===void 0){this.cursor=this.tasks.minNode(),this.setTime(this.cursor.key.time);return}this.cursor?this.goPrev():this.cursor=this.tasks.maxNode();let ee=this.cursor.key.time;for(;this.cursor&&eq(ee,this.cursor.key.time);)this.cursor.key.rollback(),this.goPrev();this.cursor?this.goNext():this.cursor=this.tasks.minNode(),this.setTime(this.cursor.key.time)}atStart(){return this.time===void 0||this.cursor.key===this.tasks.min()}completed(){return this.time!==void 0&&(greaterThan(this.time,this.end)||!this.cursor)}remove(ee){ee===this.cursor.key&&this.goNext(),this.tasks.remove(ee)}}let taskIdCounter=0;class Task{constructor(ee){if(this.id=taskIdCounter++,this.name=ee.name,this.time=ee.time,!this.time)throw new TypeError("Task time is missing.");if(isNaN(this.time.value))throw new TypeError("Task time is a NaN.");this.action=ee.action,this.reverse=ee.rollback,this.priority=ee.priority||0,this.expires=ee.expires,this.skip=ee.skip,this.timeShift=ee.timeShift,this.data=ee.data,this.blocker=ee.blocker,this.queue=void 0,this.deadAction=!1,this.deadReverse=!1,this.action&&(this.action.task=this),this.reverse&&(this.action.reverse=this)}execute(){this.action&&!this.deadAction&&(!this.blocker||!this.queue.states[this.blocker])&&(this.skip!==void 0&&this.skip>0?(this.skip--,this.queue.debug&&console.log("Skipping: "+this.name)):(this.queue.debug&&console.log("%c Executing: "+this.name+" (Time: "+this.time.value+")","color:blue"),this.expires!==void 0&&(this.expires--,this.queue.debug&&console.log("    Current count before expire: "+this.expires),this.expires<=0&&(this.queue.debug&&console.log("    Task expired."),this.deadAction=!0))),this.action(this))}rollback(){this.reverse&&!this.deadReverse&&(!this.blocker||!this.queue.states[this.blocker])&&(this.queue.debug&&console.log("Rolling back: "+this.name+" (Time: "+this.time.value+")"),this.expires!==void 0&&this.expires<=0&&(this.queue.debug&&console.log("    Rollback expired."),this.deadReverse=!0),this.reverse())}reschedule(ee){this.queue.remove(this),this.time=ee,this.queue.add(this)}remove(){this.queue.remove(this)}kill(){this.deadAction=!0,this.deadReverse=!0}block(ee){ee=ee||this.blocker,this.queue.states[ee]=!0}unblock(ee){ee=ee||this.blocker,this.queue.states[ee]=!1}toString(){return this.name+" - "+this.id}}function compare(te,ee){return eq(ee.time,te.time)?ee.priority===te.priority?ee.id===te.id?0:ee.id<te.id?1:-1:ee.priority<te.priority?1:-1:lessThan(ee.time,te.time)?1:-1}let jStat={};(function(te,ee){Object.assign(jStat,ee())})(globalThis,function(){var te=function(ee,re){var ne=Array.prototype.concat,ie=Array.prototype.slice,se=Object.prototype.toString;function le(we,ve){var _e=we>ve?we:ve;return ee.pow(10,17-~~(ee.log(_e>0?_e:-_e)*ee.LOG10E))}var ue=Array.isArray||function(ve){return se.call(ve)==="[object Array]"};function ae(we){return se.call(we)==="[object Function]"}function oe(we){return typeof we=="number"?we-we===0:!1}function ce(we){return ne.apply([],we)}function he(){return new he._init(arguments)}he.fn=he.prototype,he._init=function(ve){if(ue(ve[0]))if(ue(ve[0][0])){ae(ve[1])&&(ve[0]=he.map(ve[0],ve[1]));for(var _e=0;_e<ve[0].length;_e++)this[_e]=ve[0][_e];this.length=ve[0].length}else this[0]=ae(ve[1])?he.map(ve[0],ve[1]):ve[0],this.length=1;else if(oe(ve[0]))this[0]=he.seq.apply(null,ve),this.length=1;else{if(ve[0]instanceof he)return he(ve[0].toArray());this[0]=[],this.length=1}return this},he._init.prototype=he.prototype,he._init.constructor=he,he.utils={calcRdx:le,isArray:ue,isFunction:ae,isNumber:oe,toVector:ce},he._random_fn=ee.random,he.setRandom=function(ve){if(typeof ve!="function")throw new TypeError("fn is not a function");he._random_fn=ve},he.extend=function(ve){var _e,Te;if(arguments.length===1){for(Te in ve)he[Te]=ve[Te];return this}for(_e=1;_e<arguments.length;_e++)for(Te in arguments[_e])ve[Te]=arguments[_e][Te];return ve},he.rows=function(ve){return ve.length||1},he.cols=function(ve){return ve[0].length||1},he.dimensions=function(ve){return{rows:he.rows(ve),cols:he.cols(ve)}},he.row=function(ve,_e){return ue(_e)?_e.map(function(Te){return he.row(ve,Te)}):ve[_e]},he.rowa=function(ve,_e){return he.row(ve,_e)},he.col=function(ve,_e){if(ue(_e)){var Te=he.arange(ve.length).map(function(){return new Array(_e.length)});return _e.forEach(function(Fe,Le){he.arange(ve.length).forEach(function(Oe){Te[Oe][Le]=ve[Oe][Fe]})}),Te}for(var ye=new Array(ve.length),be=0;be<ve.length;be++)ye[be]=[ve[be][_e]];return ye},he.cola=function(ve,_e){return he.col(ve,_e).map(function(Te){return Te[0]})},he.diag=function(ve){for(var _e=he.rows(ve),Te=new Array(_e),ye=0;ye<_e;ye++)Te[ye]=[ve[ye][ye]];return Te},he.antidiag=function(ve){for(var _e=he.rows(ve)-1,Te=new Array(_e),ye=0;_e>=0;_e--,ye++)Te[ye]=[ve[ye][_e]];return Te},he.transpose=function(ve){var _e=[],Te,ye,be,Fe,Le;for(ue(ve[0])||(ve=[ve]),ye=ve.length,be=ve[0].length,Le=0;Le<be;Le++){for(Te=new Array(ye),Fe=0;Fe<ye;Fe++)Te[Fe]=ve[Fe][Le];_e.push(Te)}return _e.length===1?_e[0]:_e},he.map=function(ve,_e,Te){var ye,be,Fe,Le,Oe;for(ue(ve[0])||(ve=[ve]),be=ve.length,Fe=ve[0].length,Le=Te?ve:new Array(be),ye=0;ye<be;ye++)for(Le[ye]||(Le[ye]=new Array(Fe)),Oe=0;Oe<Fe;Oe++)Le[ye][Oe]=_e(ve[ye][Oe],ye,Oe);return Le.length===1?Le[0]:Le},he.cumreduce=function(ve,_e,Te){var ye,be,Fe,Le,Oe;for(ue(ve[0])||(ve=[ve]),be=ve.length,Fe=ve[0].length,Le=Te?ve:new Array(be),ye=0;ye<be;ye++)for(Le[ye]||(Le[ye]=new Array(Fe)),Fe>0&&(Le[ye][0]=ve[ye][0]),Oe=1;Oe<Fe;Oe++)Le[ye][Oe]=_e(Le[ye][Oe-1],ve[ye][Oe]);return Le.length===1?Le[0]:Le},he.alter=function(ve,_e){return he.map(ve,_e,!0)},he.create=function(ve,_e,Te){var ye=new Array(ve),be,Fe;for(ae(_e)&&(Te=_e,_e=ve),be=0;be<ve;be++)for(ye[be]=new Array(_e),Fe=0;Fe<_e;Fe++)ye[be][Fe]=Te(be,Fe);return ye};function pe(){return 0}he.zeros=function(ve,_e){return oe(_e)||(_e=ve),he.create(ve,_e,pe)};function de(){return 1}he.ones=function(ve,_e){return oe(_e)||(_e=ve),he.create(ve,_e,de)},he.rand=function(ve,_e){return oe(_e)||(_e=ve),he.create(ve,_e,he._random_fn)};function me(we,ve){return we===ve?1:0}he.identity=function(ve,_e){return oe(_e)||(_e=ve),he.create(ve,_e,me)},he.symmetric=function(ve){var _e=ve.length,Te,ye;if(ve.length!==ve[0].length)return!1;for(Te=0;Te<_e;Te++)for(ye=0;ye<_e;ye++)if(ve[ye][Te]!==ve[Te][ye])return!1;return!0},he.clear=function(ve){return he.alter(ve,pe)},he.seq=function(ve,_e,Te,ye){ae(ye)||(ye=!1);var be=[],Fe=le(ve,_e),Le=(_e*Fe-ve*Fe)/((Te-1)*Fe),Oe=ve,Se;for(Se=0;Oe<=_e&&Se<Te;Se++,Oe=(ve*Fe+Le*Fe*Se)/Fe)be.push(ye?ye(Oe,Se):Oe);return be},he.arange=function(ve,_e,Te){var ye=[],be;if(Te=Te||1,_e===re&&(_e=ve,ve=0),ve===_e||Te===0)return[];if(ve<_e&&Te<0)return[];if(ve>_e&&Te>0)return[];if(Te>0)for(be=ve;be<_e;be+=Te)ye.push(be);else for(be=ve;be>_e;be+=Te)ye.push(be);return ye},he.slice=function(){function we(_e,Te,ye,be){var Fe,Le=[],Oe=_e.length;if(Te===re&&ye===re&&be===re)return he.copy(_e);if(Te=Te||0,ye=ye||_e.length,Te=Te>=0?Te:Oe+Te,ye=ye>=0?ye:Oe+ye,be=be||1,Te===ye||be===0)return[];if(Te<ye&&be<0)return[];if(Te>ye&&be>0)return[];if(be>0)for(Fe=Te;Fe<ye;Fe+=be)Le.push(_e[Fe]);else for(Fe=Te;Fe>ye;Fe+=be)Le.push(_e[Fe]);return Le}function ve(_e,Te){var ye,be;if(Te=Te||{},oe(Te.row)){if(oe(Te.col))return _e[Te.row][Te.col];var Fe=he.rowa(_e,Te.row);return ye=Te.col||{},we(Fe,ye.start,ye.end,ye.step)}if(oe(Te.col)){var Le=he.cola(_e,Te.col);return be=Te.row||{},we(Le,be.start,be.end,be.step)}be=Te.row||{},ye=Te.col||{};var Oe=we(_e,be.start,be.end,be.step);return Oe.map(function(Se){return we(Se,ye.start,ye.end,ye.step)})}return ve}(),he.sliceAssign=function(ve,_e,Te){var ye,be;if(oe(_e.row)){if(oe(_e.col))return ve[_e.row][_e.col]=Te;_e.col=_e.col||{},_e.col.start=_e.col.start||0,_e.col.end=_e.col.end||ve[0].length,_e.col.step=_e.col.step||1,ye=he.arange(_e.col.start,ee.min(ve.length,_e.col.end),_e.col.step);var Fe=_e.row;return ye.forEach(function(Oe,Se){ve[Fe][Oe]=Te[Se]}),ve}if(oe(_e.col)){_e.row=_e.row||{},_e.row.start=_e.row.start||0,_e.row.end=_e.row.end||ve.length,_e.row.step=_e.row.step||1,be=he.arange(_e.row.start,ee.min(ve[0].length,_e.row.end),_e.row.step);var Le=_e.col;return be.forEach(function(Oe,Se){ve[Oe][Le]=Te[Se]}),ve}return Te[0].length===re&&(Te=[Te]),_e.row.start=_e.row.start||0,_e.row.end=_e.row.end||ve.length,_e.row.step=_e.row.step||1,_e.col.start=_e.col.start||0,_e.col.end=_e.col.end||ve[0].length,_e.col.step=_e.col.step||1,be=he.arange(_e.row.start,ee.min(ve.length,_e.row.end),_e.row.step),ye=he.arange(_e.col.start,ee.min(ve[0].length,_e.col.end),_e.col.step),be.forEach(function(Oe,Se){ye.forEach(function(De,Ie){ve[Oe][De]=Te[Se][Ie]})}),ve},he.diagonal=function(ve){var _e=he.zeros(ve.length,ve.length);return ve.forEach(function(Te,ye){_e[ye][ye]=Te}),_e},he.copy=function(ve){return ve.map(function(_e){return oe(_e)?_e:_e.map(function(Te){return Te})})};var ge=he.prototype;return ge.length=0,ge.push=Array.prototype.push,ge.sort=Array.prototype.sort,ge.splice=Array.prototype.splice,ge.slice=Array.prototype.slice,ge.toArray=function(){return this.length>1?ie.call(this):ie.call(this)[0]},ge.map=function(ve,_e){return he(he.map(this,ve,_e))},ge.cumreduce=function(ve,_e){return he(he.cumreduce(this,ve,_e))},ge.alter=function(ve){return he.alter(this,ve),this},function(we){for(var ve=0;ve<we.length;ve++)(function(_e){ge[_e]=function(Te){var ye=this,be;return Te?(setTimeout(function(){Te.call(ye,ge[_e].call(ye))}),this):(be=he[_e](this),ue(be)?he(be):be)}})(we[ve])}("transpose clear symmetric rows cols dimensions diag antidiag".split(" ")),function(we){for(var ve=0;ve<we.length;ve++)(function(_e){ge[_e]=function(Te,ye){var be=this;return ye?(setTimeout(function(){ye.call(be,ge[_e].call(be,Te))}),this):he(he[_e](this,Te))}})(we[ve])}("row col".split(" ")),function(we){for(var ve=0;ve<we.length;ve++)(function(_e){ge[_e]=function(){return he(he[_e].apply(null,arguments))}})(we[ve])}("create zeros ones rand identity".split(" ")),he}(Math);return function(ee,re){var ne=ee.utils.isFunction;function ie(ue,ae){return ue-ae}function se(ue,ae,oe){return re.max(ae,re.min(ue,oe))}ee.sum=function(ae){for(var oe=0,ce=ae.length;--ce>=0;)oe+=ae[ce];return oe},ee.sumsqrd=function(ae){for(var oe=0,ce=ae.length;--ce>=0;)oe+=ae[ce]*ae[ce];return oe},ee.sumsqerr=function(ae){for(var oe=ee.mean(ae),ce=0,he=ae.length,pe;--he>=0;)pe=ae[he]-oe,ce+=pe*pe;return ce},ee.sumrow=function(ae){for(var oe=0,ce=ae.length;--ce>=0;)oe+=ae[ce];return oe},ee.product=function(ae){for(var oe=1,ce=ae.length;--ce>=0;)oe*=ae[ce];return oe},ee.min=function(ae){for(var oe=ae[0],ce=0;++ce<ae.length;)ae[ce]<oe&&(oe=ae[ce]);return oe},ee.max=function(ae){for(var oe=ae[0],ce=0;++ce<ae.length;)ae[ce]>oe&&(oe=ae[ce]);return oe},ee.unique=function(ae){for(var oe={},ce=[],he=0;he<ae.length;he++)oe[ae[he]]||(oe[ae[he]]=!0,ce.push(ae[he]));return ce},ee.mean=function(ae){return ee.sum(ae)/ae.length},ee.meansqerr=function(ae){return ee.sumsqerr(ae)/ae.length},ee.geomean=function(ae){return re.pow(ee.product(ae),1/ae.length)},ee.median=function(ae){var oe=ae.length,ce=ae.slice().sort(ie);return oe&1?ce[oe/2|0]:(ce[oe/2-1]+ce[oe/2])/2},ee.cumsum=function(ae){return ee.cumreduce(ae,function(oe,ce){return oe+ce})},ee.cumprod=function(ae){return ee.cumreduce(ae,function(oe,ce){return oe*ce})},ee.diff=function(ae){var oe=[],ce=ae.length,he;for(he=1;he<ce;he++)oe.push(ae[he]-ae[he-1]);return oe},ee.rank=function(ue){var ae,oe=[],ce={};for(ae=0;ae<ue.length;ae++){var he=ue[ae];ce[he]?ce[he]++:(ce[he]=1,oe.push(he))}var pe=oe.sort(ie),de={},me=1;for(ae=0;ae<pe.length;ae++){var he=pe[ae],ge=ce[he],we=me,ve=me+ge-1,_e=(we+ve)/2;de[he]=_e,me+=ge}return ue.map(function(Te){return de[Te]})},ee.mode=function(ae){var oe=ae.length,ce=ae.slice().sort(ie),he=1,pe=0,de=0,me=[],ge;for(ge=0;ge<oe;ge++)ce[ge]===ce[ge+1]?he++:(he>pe?(me=[ce[ge]],pe=he,de=0):he===pe&&(me.push(ce[ge]),de++),he=1);return de===0?me[0]:me},ee.range=function(ae){return ee.max(ae)-ee.min(ae)},ee.variance=function(ae,oe){return ee.sumsqerr(ae)/(ae.length-(oe?1:0))},ee.pooledvariance=function(ae){var oe=ae.reduce(function(he,pe){return he+ee.sumsqerr(pe)},0),ce=ae.reduce(function(he,pe){return he+pe.length},0);return oe/(ce-ae.length)},ee.deviation=function(ue){for(var ae=ee.mean(ue),oe=ue.length,ce=new Array(oe),he=0;he<oe;he++)ce[he]=ue[he]-ae;return ce},ee.stdev=function(ae,oe){return re.sqrt(ee.variance(ae,oe))},ee.pooledstdev=function(ae){return re.sqrt(ee.pooledvariance(ae))},ee.meandev=function(ae){for(var oe=ee.mean(ae),ce=[],he=ae.length-1;he>=0;he--)ce.push(re.abs(ae[he]-oe));return ee.mean(ce)},ee.meddev=function(ae){for(var oe=ee.median(ae),ce=[],he=ae.length-1;he>=0;he--)ce.push(re.abs(ae[he]-oe));return ee.median(ce)},ee.coeffvar=function(ae){return ee.stdev(ae)/ee.mean(ae)},ee.quartiles=function(ae){var oe=ae.length,ce=ae.slice().sort(ie);return[ce[re.round(oe/4)-1],ce[re.round(oe/2)-1],ce[re.round(oe*3/4)-1]]},ee.quantiles=function(ae,oe,ce,he){var pe=ae.slice().sort(ie),de=[oe.length],me=ae.length,ge,we,ve,_e,Te,ye;for(typeof ce>"u"&&(ce=3/8),typeof he>"u"&&(he=3/8),ge=0;ge<oe.length;ge++)we=oe[ge],ve=ce+we*(1-ce-he),_e=me*we+ve,Te=re.floor(se(_e,1,me-1)),ye=se(_e-Te,0,1),de[ge]=(1-ye)*pe[Te-1]+ye*pe[Te];return de},ee.percentile=function(ae,oe,ce){var he=ae.slice().sort(ie),pe=oe*(he.length+(ce?1:-1))+(ce?0:1),de=parseInt(pe),me=pe-de;return de+1<he.length?he[de-1]+me*(he[de]-he[de-1]):he[de-1]},ee.percentileOfScore=function(ae,oe,ce){var he=0,pe=ae.length,de=!1,me,ge;for(ce==="strict"&&(de=!0),ge=0;ge<pe;ge++)me=ae[ge],(de&&me<oe||!de&&me<=oe)&&he++;return he/pe},ee.histogram=function(ae,oe){oe=oe||4;var ce=ee.min(ae),he=(ee.max(ae)-ce)/oe,pe=ae.length,de=[],me;for(me=0;me<oe;me++)de[me]=0;for(me=0;me<pe;me++)de[re.min(re.floor((ae[me]-ce)/he),oe-1)]+=1;return de},ee.covariance=function(ae,oe){var ce=ee.mean(ae),he=ee.mean(oe),pe=ae.length,de=new Array(pe),me;for(me=0;me<pe;me++)de[me]=(ae[me]-ce)*(oe[me]-he);return ee.sum(de)/(pe-1)},ee.corrcoeff=function(ae,oe){return ee.covariance(ae,oe)/ee.stdev(ae,1)/ee.stdev(oe,1)},ee.spearmancoeff=function(ue,ae){return ue=ee.rank(ue),ae=ee.rank(ae),ee.corrcoeff(ue,ae)},ee.stanMoment=function(ae,oe){for(var ce=ee.mean(ae),he=ee.stdev(ae),pe=ae.length,de=0,me=0;me<pe;me++)de+=re.pow((ae[me]-ce)/he,oe);return de/ae.length},ee.skewness=function(ae){return ee.stanMoment(ae,3)},ee.kurtosis=function(ae){return ee.stanMoment(ae,4)-3};var le=ee.prototype;(function(ue){for(var ae=0;ae<ue.length;ae++)(function(oe){le[oe]=function(ce,he){var pe=[],de=0,me=this;if(ne(ce)&&(he=ce,ce=!1),he)return setTimeout(function(){he.call(me,le[oe].call(me,ce))}),this;if(this.length>1){for(me=ce===!0?this:this.transpose();de<me.length;de++)pe[de]=ee[oe](me[de]);return pe}return ee[oe](this[0],ce)}})(ue[ae])})("cumsum cumprod".split(" ")),function(ue){for(var ae=0;ae<ue.length;ae++)(function(oe){le[oe]=function(ce,he){var pe=[],de=0,me=this;if(ne(ce)&&(he=ce,ce=!1),he)return setTimeout(function(){he.call(me,le[oe].call(me,ce))}),this;if(this.length>1){for(oe!=="sumrow"&&(me=ce===!0?this:this.transpose());de<me.length;de++)pe[de]=ee[oe](me[de]);return ce===!0?ee[oe](ee.utils.toVector(pe)):pe}return ee[oe](this[0],ce)}})(ue[ae])}("sum sumsqrd sumsqerr sumrow product min max unique mean meansqerr geomean median diff rank mode range variance deviation stdev meandev meddev coeffvar quartiles histogram skewness kurtosis".split(" ")),function(ue){for(var ae=0;ae<ue.length;ae++)(function(oe){le[oe]=function(){var ce=[],he=0,pe=this,de=Array.prototype.slice.call(arguments),me;if(ne(de[de.length-1])){me=de[de.length-1];var ge=de.slice(0,de.length-1);return setTimeout(function(){me.call(pe,le[oe].apply(pe,ge))}),this}else{me=void 0;var we=function(_e){return ee[oe].apply(pe,[_e].concat(de))}}if(this.length>1){for(pe=pe.transpose();he<pe.length;he++)ce[he]=we(pe[he]);return ce}return we(this[0])}})(ue[ae])}("quantiles percentileOfScore".split(" "))}(te,Math),function(ee,re){ee.gammaln=function(ie){var se=0,le=[76.18009172947146,-86.50532032941678,24.01409824083091,-1.231739572450155,.001208650973866179,-5395239384953e-18],ue=1.000000000190015,ae,oe,ce;for(ce=(oe=ae=ie)+5.5,ce-=(ae+.5)*re.log(ce);se<6;se++)ue+=le[se]/++oe;return re.log(2.5066282746310007*ue/ae)-ce},ee.loggam=function(ie){var se,le,ue,ae,oe,ce,he,pe=[.08333333333333333,-.002777777777777778,.0007936507936507937,-.0005952380952380952,.0008417508417508418,-.001917526917526918,.00641025641025641,-.02955065359477124,.1796443723688307,-1.3924322169059];if(se=ie,he=0,ie==1||ie==2)return 0;for(ie<=7&&(he=re.floor(7-ie),se=ie+he),le=1/(se*se),ue=2*re.PI,oe=pe[9],ce=8;ce>=0;ce--)oe*=le,oe+=pe[ce];if(ae=oe/se+.5*re.log(ue)+(se-.5)*re.log(se)-se,ie<=7)for(ce=1;ce<=he;ce++)ae-=re.log(se-1),se-=1;return ae},ee.gammafn=function(ie){var se=[-1.716185138865495,24.76565080557592,-379.80425647094563,629.3311553128184,866.9662027904133,-31451.272968848367,-36144.413418691176,66456.14382024054],le=[-30.8402300119739,315.35062697960416,-1015.1563674902192,-3107.771671572311,22538.11842098015,4755.846277527881,-134659.9598649693,-115132.2596755535],ue=!1,ae=0,oe=0,ce=0,he=ie,pe,de,me,ge;if(ie>171.6243769536076)return 1/0;if(he<=0)if(ge=he%1+36e-17,ge)ue=(he&1?-1:1)*re.PI/re.sin(re.PI*ge),he=1-he;else return 1/0;for(me=he,he<1?de=he++:de=(he-=ae=(he|0)-1)-1,pe=0;pe<8;++pe)ce=(ce+se[pe])*de,oe=oe*de+le[pe];if(ge=ce/oe+1,me<he)ge/=me;else if(me>he)for(pe=0;pe<ae;++pe)ge*=he,he++;return ue&&(ge=ue/ge),ge},ee.gammap=function(ie,se){return ee.lowRegGamma(ie,se)*ee.gammafn(ie)},ee.lowRegGamma=function(ie,se){var le=ee.gammaln(ie),ue=ie,ae=1/ie,oe=ae,ce=se+1-ie,he=1/1e-30,pe=1/ce,de=pe,me=1,ge=-~(re.log(ie>=1?ie:1/ie)*8.5+ie*.4+17),we;if(se<0||ie<=0)return NaN;if(se<ie+1){for(;me<=ge;me++)ae+=oe*=se/++ue;return ae*re.exp(-se+ie*re.log(se)-le)}for(;me<=ge;me++)we=-me*(me-ie),ce+=2,pe=we*pe+ce,he=ce+we/he,pe=1/pe,de*=pe*he;return 1-de*re.exp(-se+ie*re.log(se)-le)},ee.factorialln=function(ie){return ie<0?NaN:ee.gammaln(ie+1)},ee.factorial=function(ie){return ie<0?NaN:ee.gammafn(ie+1)},ee.combination=function(ie,se){return ie>170||se>170?re.exp(ee.combinationln(ie,se)):ee.factorial(ie)/ee.factorial(se)/ee.factorial(ie-se)},ee.combinationln=function(ie,se){return ee.factorialln(ie)-ee.factorialln(se)-ee.factorialln(ie-se)},ee.permutation=function(ie,se){return ee.factorial(ie)/ee.factorial(ie-se)},ee.betafn=function(ie,se){if(!(ie<=0||se<=0))return ie+se>170?re.exp(ee.betaln(ie,se)):ee.gammafn(ie)*ee.gammafn(se)/ee.gammafn(ie+se)},ee.betaln=function(ie,se){return ee.gammaln(ie)+ee.gammaln(se)-ee.gammaln(ie+se)},ee.betacf=function(ie,se,le){var ue=1e-30,ae=1,oe=se+le,ce=se+1,he=se-1,pe=1,de=1-oe*ie/ce,me,ge,we,ve;for(re.abs(de)<ue&&(de=ue),de=1/de,ve=de;ae<=100&&(me=2*ae,ge=ae*(le-ae)*ie/((he+me)*(se+me)),de=1+ge*de,re.abs(de)<ue&&(de=ue),pe=1+ge/pe,re.abs(pe)<ue&&(pe=ue),de=1/de,ve*=de*pe,ge=-(se+ae)*(oe+ae)*ie/((se+me)*(ce+me)),de=1+ge*de,re.abs(de)<ue&&(de=ue),pe=1+ge/pe,re.abs(pe)<ue&&(pe=ue),de=1/de,we=de*pe,ve*=we,!(re.abs(we-1)<3e-7));ae++);return ve},ee.gammapinv=function(ie,se){var le=0,ue=se-1,ae=1e-8,oe=ee.gammaln(se),ce,he,pe,de,me,ge,we;if(ie>=1)return re.max(100,se+100*re.sqrt(se));if(ie<=0)return 0;for(se>1?(ge=re.log(ue),we=re.exp(ue*(ge-1)-oe),me=ie<.5?ie:1-ie,pe=re.sqrt(-2*re.log(me)),ce=(2.30753+pe*.27061)/(1+pe*(.99229+pe*.04481))-pe,ie<.5&&(ce=-ce),ce=re.max(.001,se*re.pow(1-1/(9*se)-ce/(3*re.sqrt(se)),3))):(pe=1-se*(.253+se*.12),ie<pe?ce=re.pow(ie/pe,1/se):ce=1-re.log(1-(ie-pe)/(1-pe)));le<12;le++){if(ce<=0)return 0;if(he=ee.lowRegGamma(se,ce)-ie,se>1?pe=we*re.exp(-(ce-ue)+ue*(re.log(ce)-ge)):pe=re.exp(-ce+ue*re.log(ce)-oe),de=he/pe,ce-=pe=de/(1-.5*re.min(1,de*((se-1)/ce-1))),ce<=0&&(ce=.5*(ce+pe)),re.abs(pe)<ae*ce)break}return ce},ee.erf=function(ie){var se=[-1.3026537197817094,.6419697923564902,.019476473204185836,-.00956151478680863,-.000946595344482036,.000366839497852761,42523324806907e-18,-20278578112534e-18,-1624290004647e-18,130365583558e-17,15626441722e-18,-85238095915e-18,6529054439e-18,5059343495e-18,-991364156e-18,-227365122e-18,96467911e-18,2394038e-18,-6886027e-18,894487e-18,313092e-18,-112708e-18,381e-18,7106e-18,-1523e-18,-94e-18,121e-18,-28e-18],le=se.length-1,ue=!1,ae=0,oe=0,ce,he,pe,de;for(ie<0&&(ie=-ie,ue=!0),ce=2/(2+ie),he=4*ce-2;le>0;le--)pe=ae,ae=he*ae-oe+se[le],oe=pe;return de=ce*re.exp(-ie*ie+.5*(se[0]+he*ae)-oe),ue?de-1:1-de},ee.erfc=function(ie){return 1-ee.erf(ie)},ee.erfcinv=function(ie){var se=0,le,ue,ae,oe;if(ie>=2)return-100;if(ie<=0)return 100;for(oe=ie<1?ie:2-ie,ae=re.sqrt(-2*re.log(oe/2)),le=-.70711*((2.30753+ae*.27061)/(1+ae*(.99229+ae*.04481))-ae);se<2;se++)ue=ee.erfc(le)-oe,le+=ue/(1.1283791670955126*re.exp(-le*le)-le*ue);return ie<1?le:-le},ee.ibetainv=function(ie,se,le){var ue=1e-8,ae=se-1,oe=le-1,ce=0,he,pe,de,me,ge,we,ve,_e,Te,ye,be;if(ie<=0)return 0;if(ie>=1)return 1;for(se>=1&&le>=1?(de=ie<.5?ie:1-ie,me=re.sqrt(-2*re.log(de)),ve=(2.30753+me*.27061)/(1+me*(.99229+me*.04481))-me,ie<.5&&(ve=-ve),_e=(ve*ve-3)/6,Te=2/(1/(2*se-1)+1/(2*le-1)),ye=ve*re.sqrt(_e+Te)/Te-(1/(2*le-1)-1/(2*se-1))*(_e+5/6-2/(3*Te)),ve=se/(se+le*re.exp(2*ye))):(he=re.log(se/(se+le)),pe=re.log(le/(se+le)),me=re.exp(se*he)/se,ge=re.exp(le*pe)/le,ye=me+ge,ie<me/ye?ve=re.pow(se*ye*ie,1/se):ve=1-re.pow(le*ye*(1-ie),1/le)),be=-ee.gammaln(se)-ee.gammaln(le)+ee.gammaln(se+le);ce<10;ce++){if(ve===0||ve===1)return ve;if(we=ee.ibeta(ve,se,le)-ie,me=re.exp(ae*re.log(ve)+oe*re.log(1-ve)+be),ge=we/me,ve-=me=ge/(1-.5*re.min(1,ge*(ae/ve-oe/(1-ve)))),ve<=0&&(ve=.5*(ve+me)),ve>=1&&(ve=.5*(ve+me+1)),re.abs(me)<ue*ve&&ce>0)break}return ve},ee.ibeta=function(ie,se,le){var ue=ie===0||ie===1?0:re.exp(ee.gammaln(se+le)-ee.gammaln(se)-ee.gammaln(le)+se*re.log(ie)+le*re.log(1-ie));return ie<0||ie>1?!1:ie<(se+1)/(se+le+2)?ue*ee.betacf(ie,se,le)/se:1-ue*ee.betacf(1-ie,le,se)/le},ee.randn=function(ie,se){var le,ue,ae,oe,ce;if(se||(se=ie),ie)return ee.create(ie,se,function(){return ee.randn()});do le=ee._random_fn(),ue=1.7156*(ee._random_fn()-.5),ae=le-.449871,oe=re.abs(ue)+.386595,ce=ae*ae+oe*(.196*oe-.25472*ae);while(ce>.27597&&(ce>.27846||ue*ue>-4*re.log(le)*le*le));return ue/le},ee.randg=function(ie,se,le){var ue=ie,ae,oe,ce,he,pe,de;if(le||(le=se),ie||(ie=1),se)return de=ee.zeros(se,le),de.alter(function(){return ee.randg(ie)}),de;ie<1&&(ie+=1),ae=ie-1/3,oe=1/re.sqrt(9*ae);do{do pe=ee.randn(),he=1+oe*pe;while(he<=0);he=he*he*he,ce=ee._random_fn()}while(ce>1-.331*re.pow(pe,4)&&re.log(ce)>.5*pe*pe+ae*(1-he+re.log(he)));if(ie==ue)return ae*he;do ce=ee._random_fn();while(ce===0);return re.pow(ce,1/ue)*ae*he},function(ne){for(var ie=0;ie<ne.length;ie++)(function(se){ee.fn[se]=function(){return ee(ee.map(this,function(le){return ee[se](le)}))}})(ne[ie])}("gammaln gammafn factorial factorialln".split(" ")),function(ne){for(var ie=0;ie<ne.length;ie++)(function(se){ee.fn[se]=function(){return ee(ee[se].apply(null,arguments))}})(ne[ie])}("randn".split(" "))}(te,Math),function(ee,re){(function(ue){for(var ae=0;ae<ue.length;ae++)(function(oe){ee[oe]=function ce(he,pe,de){return this instanceof ce?(this._a=he,this._b=pe,this._c=de,this):new ce(he,pe,de)},ee.fn[oe]=function(ce,he,pe){var de=ee[oe](ce,he,pe);return de.data=this,de},ee[oe].prototype.sample=function(ce){var he=this._a,pe=this._b,de=this._c;return ce?ee.alter(ce,function(){return ee[oe].sample(he,pe,de)}):ee[oe].sample(he,pe,de)},function(ce){for(var he=0;he<ce.length;he++)(function(pe){ee[oe].prototype[pe]=function(de){var me=this._a,ge=this._b,we=this._c;return!de&&de!==0&&(de=this.data),typeof de!="number"?ee.fn.map.call(de,function(ve){return ee[oe][pe](ve,me,ge,we)}):ee[oe][pe](de,me,ge,we)}})(ce[he])}("pdf cdf inv".split(" ")),function(ce){for(var he=0;he<ce.length;he++)(function(pe){ee[oe].prototype[pe]=function(){return ee[oe][pe](this._a,this._b,this._c)}})(ce[he])}("mean median mode variance".split(" "))})(ue[ae])})("beta centralF cauchy chisquare exponential gamma invgamma kumaraswamy laplace lognormal noncentralt normal pareto studentt weibull uniform binomial negbin hypgeom poisson triangular tukey arcsine".split(" ")),ee.extend(ee.beta,{pdf:function(ae,oe,ce){return ae>1||ae<0?0:oe==1&&ce==1?1:oe<512&&ce<512?re.pow(ae,oe-1)*re.pow(1-ae,ce-1)/ee.betafn(oe,ce):re.exp((oe-1)*re.log(ae)+(ce-1)*re.log(1-ae)-ee.betaln(oe,ce))},cdf:function(ae,oe,ce){return ae>1||ae<0?(ae>1)*1:ee.ibeta(ae,oe,ce)},inv:function(ae,oe,ce){return ee.ibetainv(ae,oe,ce)},mean:function(ae,oe){return ae/(ae+oe)},median:function(ae,oe){return ee.ibetainv(.5,ae,oe)},mode:function(ae,oe){return(ae-1)/(ae+oe-2)},sample:function(ae,oe){var ce=ee.randg(ae);return ce/(ce+ee.randg(oe))},variance:function(ae,oe){return ae*oe/(re.pow(ae+oe,2)*(ae+oe+1))}}),ee.extend(ee.centralF,{pdf:function(ae,oe,ce){var he,pe,de;return ae<0?0:oe<=2?ae===0&&oe<2?1/0:ae===0&&oe===2?1:1/ee.betafn(oe/2,ce/2)*re.pow(oe/ce,oe/2)*re.pow(ae,oe/2-1)*re.pow(1+oe/ce*ae,-(oe+ce)/2):(he=oe*ae/(ce+ae*oe),pe=ce/(ce+ae*oe),de=oe*pe/2,de*ee.binomial.pdf((oe-2)/2,(oe+ce-2)/2,he))},cdf:function(ae,oe,ce){return ae<0?0:ee.ibeta(oe*ae/(oe*ae+ce),oe/2,ce/2)},inv:function(ae,oe,ce){return ce/(oe*(1/ee.ibetainv(ae,oe/2,ce/2)-1))},mean:function(ae,oe){return oe>2?oe/(oe-2):void 0},mode:function(ae,oe){return ae>2?oe*(ae-2)/(ae*(oe+2)):void 0},sample:function(ae,oe){var ce=ee.randg(ae/2)*2,he=ee.randg(oe/2)*2;return ce/ae/(he/oe)},variance:function(ae,oe){if(!(oe<=4))return 2*oe*oe*(ae+oe-2)/(ae*(oe-2)*(oe-2)*(oe-4))}}),ee.extend(ee.cauchy,{pdf:function(ae,oe,ce){return ce<0?0:ce/(re.pow(ae-oe,2)+re.pow(ce,2))/re.PI},cdf:function(ae,oe,ce){return re.atan((ae-oe)/ce)/re.PI+.5},inv:function(ue,ae,oe){return ae+oe*re.tan(re.PI*(ue-.5))},median:function(ae){return ae},mode:function(ae){return ae},sample:function(ae,oe){return ee.randn()*re.sqrt(1/(2*ee.randg(.5)))*oe+ae}}),ee.extend(ee.chisquare,{pdf:function(ae,oe){return ae<0?0:ae===0&&oe===2?.5:re.exp((oe/2-1)*re.log(ae)-ae/2-oe/2*re.log(2)-ee.gammaln(oe/2))},cdf:function(ae,oe){return ae<0?0:ee.lowRegGamma(oe/2,ae/2)},inv:function(ue,ae){return 2*ee.gammapinv(ue,.5*ae)},mean:function(ue){return ue},median:function(ae){return ae*re.pow(1-2/(9*ae),3)},mode:function(ae){return ae-2>0?ae-2:0},sample:function(ae){return ee.randg(ae/2)*2},variance:function(ae){return 2*ae}}),ee.extend(ee.exponential,{pdf:function(ae,oe){return ae<0?0:oe*re.exp(-oe*ae)},cdf:function(ae,oe){return ae<0?0:1-re.exp(-oe*ae)},inv:function(ue,ae){return-re.log(1-ue)/ae},mean:function(ue){return 1/ue},median:function(ue){return 1/ue*re.log(2)},mode:function(){return 0},sample:function(ae){return-1/ae*re.log(ee._random_fn())},variance:function(ue){return re.pow(ue,-2)}}),ee.extend(ee.gamma,{pdf:function(ae,oe,ce){return ae<0?0:ae===0&&oe===1?1/ce:re.exp((oe-1)*re.log(ae)-ae/ce-ee.gammaln(oe)-oe*re.log(ce))},cdf:function(ae,oe,ce){return ae<0?0:ee.lowRegGamma(oe,ae/ce)},inv:function(ue,ae,oe){return ee.gammapinv(ue,ae)*oe},mean:function(ue,ae){return ue*ae},mode:function(ae,oe){if(ae>1)return(ae-1)*oe},sample:function(ae,oe){return ee.randg(ae)*oe},variance:function(ae,oe){return ae*oe*oe}}),ee.extend(ee.invgamma,{pdf:function(ae,oe,ce){return ae<=0?0:re.exp(-(oe+1)*re.log(ae)-ce/ae-ee.gammaln(oe)+oe*re.log(ce))},cdf:function(ae,oe,ce){return ae<=0?0:1-ee.lowRegGamma(oe,ce/ae)},inv:function(ue,ae,oe){return oe/ee.gammapinv(1-ue,ae)},mean:function(ue,ae){return ue>1?ae/(ue-1):void 0},mode:function(ae,oe){return oe/(ae+1)},sample:function(ae,oe){return oe/ee.randg(ae)},variance:function(ae,oe){if(!(ae<=2))return oe*oe/((ae-1)*(ae-1)*(ae-2))}}),ee.extend(ee.kumaraswamy,{pdf:function(ae,oe,ce){return ae===0&&oe===1?ce:ae===1&&ce===1?oe:re.exp(re.log(oe)+re.log(ce)+(oe-1)*re.log(ae)+(ce-1)*re.log(1-re.pow(ae,oe)))},cdf:function(ae,oe,ce){return ae<0?0:ae>1?1:1-re.pow(1-re.pow(ae,oe),ce)},inv:function(ae,oe,ce){return re.pow(1-re.pow(1-ae,1/ce),1/oe)},mean:function(ue,ae){return ae*ee.gammafn(1+1/ue)*ee.gammafn(ae)/ee.gammafn(1+1/ue+ae)},median:function(ae,oe){return re.pow(1-re.pow(2,-1/oe),1/ae)},mode:function(ae,oe){if(ae>=1&&oe>=1&&ae!==1&&oe!==1)return re.pow((ae-1)/(ae*oe-1),1/ae)},variance:function(){throw new Error("variance not yet implemented")}}),ee.extend(ee.lognormal,{pdf:function(ae,oe,ce){return ae<=0?0:re.exp(-re.log(ae)-.5*re.log(2*re.PI)-re.log(ce)-re.pow(re.log(ae)-oe,2)/(2*ce*ce))},cdf:function(ae,oe,ce){return ae<0?0:.5+.5*ee.erf((re.log(ae)-oe)/re.sqrt(2*ce*ce))},inv:function(ue,ae,oe){return re.exp(-1.4142135623730951*oe*ee.erfcinv(2*ue)+ae)},mean:function(ae,oe){return re.exp(ae+oe*oe/2)},median:function(ae){return re.exp(ae)},mode:function(ae,oe){return re.exp(ae-oe*oe)},sample:function(ae,oe){return re.exp(ee.randn()*oe+ae)},variance:function(ae,oe){return(re.exp(oe*oe)-1)*re.exp(2*ae+oe*oe)}}),ee.extend(ee.noncentralt,{pdf:function(ae,oe,ce){var he=1e-14;return re.abs(ce)<he?ee.studentt.pdf(ae,oe):re.abs(ae)<he?re.exp(ee.gammaln((oe+1)/2)-ce*ce/2-.5*re.log(re.PI*oe)-ee.gammaln(oe/2)):oe/ae*(ee.noncentralt.cdf(ae*re.sqrt(1+2/oe),oe+2,ce)-ee.noncentralt.cdf(ae,oe,ce))},cdf:function(ae,oe,ce){var he=1e-14,pe=200;if(re.abs(ce)<he)return ee.studentt.cdf(ae,oe);var de=!1;ae<0&&(de=!0,ce=-ce);for(var me=ee.normal.cdf(-ce,0,1),ge=he+1,we=ge,ve=ae*ae/(ae*ae+oe),_e=0,Te=re.exp(-ce*ce/2),ye=re.exp(-ce*ce/2-.5*re.log(2)-ee.gammaln(3/2))*ce;_e<pe||we>he||ge>he;)we=ge,_e>0&&(Te*=ce*ce/(2*_e),ye*=ce*ce/(2*(_e+1/2))),ge=Te*ee.beta.cdf(ve,_e+.5,oe/2)+ye*ee.beta.cdf(ve,_e+1,oe/2),me+=.5*ge,_e++;return de?1-me:me}}),ee.extend(ee.normal,{pdf:function(ae,oe,ce){return re.exp(-.5*re.log(2*re.PI)-re.log(ce)-re.pow(ae-oe,2)/(2*ce*ce))},cdf:function(ae,oe,ce){return .5*(1+ee.erf((ae-oe)/re.sqrt(2*ce*ce)))},inv:function(ue,ae,oe){return-1.4142135623730951*oe*ee.erfcinv(2*ue)+ae},mean:function(ue){return ue},median:function(ae){return ae},mode:function(ue){return ue},sample:function(ae,oe){return ee.randn()*oe+ae},variance:function(ue,ae){return ae*ae}}),ee.extend(ee.pareto,{pdf:function(ae,oe,ce){return ae<oe?0:ce*re.pow(oe,ce)/re.pow(ae,ce+1)},cdf:function(ae,oe,ce){return ae<oe?0:1-re.pow(oe/ae,ce)},inv:function(ae,oe,ce){return oe/re.pow(1-ae,1/ce)},mean:function(ae,oe){if(!(oe<=1))return oe*re.pow(ae,oe)/(oe-1)},median:function(ae,oe){return ae*(oe*re.SQRT2)},mode:function(ae){return ae},variance:function(ue,ae){if(!(ae<=2))return ue*ue*ae/(re.pow(ae-1,2)*(ae-2))}}),ee.extend(ee.studentt,{pdf:function(ae,oe){return oe=oe>1e100?1e100:oe,1/(re.sqrt(oe)*ee.betafn(.5,oe/2))*re.pow(1+ae*ae/oe,-((oe+1)/2))},cdf:function(ae,oe){var ce=oe/2;return ee.ibeta((ae+re.sqrt(ae*ae+oe))/(2*re.sqrt(ae*ae+oe)),ce,ce)},inv:function(ue,ae){var oe=ee.ibetainv(2*re.min(ue,1-ue),.5*ae,.5);return oe=re.sqrt(ae*(1-oe)/oe),ue>.5?oe:-oe},mean:function(ae){return ae>1?0:void 0},median:function(){return 0},mode:function(){return 0},sample:function(ae){return ee.randn()*re.sqrt(ae/(2*ee.randg(ae/2)))},variance:function(ae){return ae>2?ae/(ae-2):ae>1?1/0:void 0}}),ee.extend(ee.weibull,{pdf:function(ae,oe,ce){return ae<0||oe<0||ce<0?0:ce/oe*re.pow(ae/oe,ce-1)*re.exp(-re.pow(ae/oe,ce))},cdf:function(ae,oe,ce){return ae<0?0:1-re.exp(-re.pow(ae/oe,ce))},inv:function(ue,ae,oe){return ae*re.pow(-re.log(1-ue),1/oe)},mean:function(ue,ae){return ue*ee.gammafn(1+1/ae)},median:function(ae,oe){return ae*re.pow(re.log(2),1/oe)},mode:function(ae,oe){return oe<=1?0:ae*re.pow((oe-1)/oe,1/oe)},sample:function(ae,oe){return ae*re.pow(-re.log(ee._random_fn()),1/oe)},variance:function(ae,oe){return ae*ae*ee.gammafn(1+2/oe)-re.pow(ee.weibull.mean(ae,oe),2)}}),ee.extend(ee.uniform,{pdf:function(ae,oe,ce){return ae<oe||ae>ce?0:1/(ce-oe)},cdf:function(ae,oe,ce){return ae<oe?0:ae<ce?(ae-oe)/(ce-oe):1},inv:function(ue,ae,oe){return ae+ue*(oe-ae)},mean:function(ae,oe){return .5*(ae+oe)},median:function(ae,oe){return ee.mean(ae,oe)},mode:function(){throw new Error("mode is not yet implemented")},sample:function(ae,oe){return ae/2+oe/2+(oe/2-ae/2)*(2*ee._random_fn()-1)},variance:function(ae,oe){return re.pow(oe-ae,2)/12}});function ne(ue,ae,oe,ce){for(var he=0,pe=1,de=1,me=1,ge=0,we=0,ve;re.abs((de-we)/de)>ce;)we=de,ve=-(ae+ge)*(ae+oe+ge)*ue/(ae+2*ge)/(ae+2*ge+1),he=de+ve*he,pe=me+ve*pe,ge=ge+1,ve=ge*(oe-ge)*ue/(ae+2*ge-1)/(ae+2*ge),de=he+ve*de,me=pe+ve*me,he=he/me,pe=pe/me,de=de/me,me=1;return de/ae}ee.extend(ee.binomial,{pdf:function(ae,oe,ce){return ce===0||ce===1?oe*ce===ae?1:0:ee.combination(oe,ae)*re.pow(ce,ae)*re.pow(1-ce,oe-ae)},cdf:function(ae,oe,ce){var he,pe=1e-10;if(ae<0)return 0;if(ae>=oe)return 1;if(ce<0||ce>1||oe<=0)return NaN;ae=re.floor(ae);var de=ce,me=ae+1,ge=oe-ae,we=me+ge,ve=re.exp(ee.gammaln(we)-ee.gammaln(ge)-ee.gammaln(me)+me*re.log(de)+ge*re.log(1-de));return de<(me+1)/(we+2)?he=ve*ne(de,me,ge,pe):he=1-ve*ne(1-de,ge,me,pe),re.round((1-he)*(1/pe))/(1/pe)}}),ee.extend(ee.negbin,{pdf:function(ae,oe,ce){return ae!==ae>>>0?!1:ae<0?0:ee.combination(ae+oe-1,oe-1)*re.pow(1-ce,ae)*re.pow(ce,oe)},cdf:function(ae,oe,ce){var he=0,pe=0;if(ae<0)return 0;for(;pe<=ae;pe++)he+=ee.negbin.pdf(pe,oe,ce);return he}}),ee.extend(ee.hypgeom,{pdf:function(ae,oe,ce,he){if(ae!==ae|0)return!1;if(ae<0||ae<ce-(oe-he))return 0;if(ae>he||ae>ce)return 0;if(ce*2>oe)return he*2>oe?ee.hypgeom.pdf(oe-ce-he+ae,oe,oe-ce,oe-he):ee.hypgeom.pdf(he-ae,oe,oe-ce,he);if(he*2>oe)return ee.hypgeom.pdf(ce-ae,oe,ce,oe-he);if(ce<he)return ee.hypgeom.pdf(ae,oe,he,ce);for(var pe=1,de=0,me=0;me<ae;me++){for(;pe>1&&de<he;)pe*=1-ce/(oe-de),de++;pe*=(he-me)*(ce-me)/((me+1)*(oe-ce-he+me+1))}for(;de<he;de++)pe*=1-ce/(oe-de);return re.min(1,re.max(0,pe))},cdf:function(ae,oe,ce,he){if(ae<0||ae<ce-(oe-he))return 0;if(ae>=he||ae>=ce)return 1;if(ce*2>oe)return he*2>oe?ee.hypgeom.cdf(oe-ce-he+ae,oe,oe-ce,oe-he):1-ee.hypgeom.cdf(he-ae-1,oe,oe-ce,he);if(he*2>oe)return 1-ee.hypgeom.cdf(ce-ae-1,oe,ce,oe-he);if(ce<he)return ee.hypgeom.cdf(ae,oe,he,ce);for(var pe=1,de=1,me=0,ge=0;ge<ae;ge++){for(;pe>1&&me<he;){var we=1-ce/(oe-me);de*=we,pe*=we,me++}de*=(he-ge)*(ce-ge)/((ge+1)*(oe-ce-he+ge+1)),pe+=de}for(;me<he;me++)pe*=1-ce/(oe-me);return re.min(1,re.max(0,pe))}}),ee.extend(ee.poisson,{pdf:function(ae,oe){return oe<0||ae%1!==0||ae<0?0:re.pow(oe,ae)*re.exp(-oe)/ee.factorial(ae)},cdf:function(ae,oe){var ce=[],he=0;if(ae<0)return 0;for(;he<=ae;he++)ce.push(ee.poisson.pdf(he,oe));return ee.sum(ce)},mean:function(ue){return ue},variance:function(ue){return ue},sampleSmall:function(ae){var oe=1,ce=0,he=re.exp(-ae);do ce++,oe*=ee._random_fn();while(oe>he);return ce-1},sampleLarge:function(ae){var oe=ae,ce,he,pe,de,me,ge,we,ve,_e,Te;for(de=re.sqrt(oe),me=re.log(oe),we=.931+2.53*de,ge=-.059+.02483*we,ve=1.1239+1.1328/(we-3.4),_e=.9277-3.6224/(we-2);;){if(he=re.random()-.5,pe=re.random(),Te=.5-re.abs(he),ce=re.floor((2*ge/Te+we)*he+oe+.43),Te>=.07&&pe<=_e)return ce;if(!(ce<0||Te<.013&&pe>Te)&&re.log(pe)+re.log(ve)-re.log(ge/(Te*Te)+we)<=-oe+ce*me-ee.loggam(ce+1))return ce}},sample:function(ae){return ae<10?this.sampleSmall(ae):this.sampleLarge(ae)}}),ee.extend(ee.triangular,{pdf:function(ae,oe,ce,he){return ce<=oe||he<oe||he>ce?NaN:ae<oe||ae>ce?0:ae<he?2*(ae-oe)/((ce-oe)*(he-oe)):ae===he?2/(ce-oe):2*(ce-ae)/((ce-oe)*(ce-he))},cdf:function(ae,oe,ce,he){return ce<=oe||he<oe||he>ce?NaN:ae<=oe?0:ae>=ce?1:ae<=he?re.pow(ae-oe,2)/((ce-oe)*(he-oe)):1-re.pow(ce-ae,2)/((ce-oe)*(ce-he))},inv:function(ae,oe,ce,he){return ce<=oe||he<oe||he>ce?NaN:ae<=(he-oe)/(ce-oe)?oe+(ce-oe)*re.sqrt(ae*((he-oe)/(ce-oe))):oe+(ce-oe)*(1-re.sqrt((1-ae)*(1-(he-oe)/(ce-oe))))},mean:function(ae,oe,ce){return(ae+oe+ce)/3},median:function(ae,oe,ce){if(ce<=(ae+oe)/2)return oe-re.sqrt((oe-ae)*(oe-ce))/re.sqrt(2);if(ce>(ae+oe)/2)return ae+re.sqrt((oe-ae)*(ce-ae))/re.sqrt(2)},mode:function(ae,oe,ce){return ce},sample:function(ae,oe,ce){var he=ee._random_fn();return he<(ce-ae)/(oe-ae)?ae+re.sqrt(he*(oe-ae)*(ce-ae)):oe-re.sqrt((1-he)*(oe-ae)*(oe-ce))},variance:function(ae,oe,ce){return(ae*ae+oe*oe+ce*ce-ae*oe-ae*ce-oe*ce)/18}}),ee.extend(ee.arcsine,{pdf:function(ae,oe,ce){return ce<=oe?NaN:ae<=oe||ae>=ce?0:2/re.PI*re.pow(re.pow(ce-oe,2)-re.pow(2*ae-oe-ce,2),-.5)},cdf:function(ae,oe,ce){return ae<oe?0:ae<ce?2/re.PI*re.asin(re.sqrt((ae-oe)/(ce-oe))):1},inv:function(ue,ae,oe){return ae+(.5-.5*re.cos(re.PI*ue))*(oe-ae)},mean:function(ae,oe){return oe<=ae?NaN:(ae+oe)/2},median:function(ae,oe){return oe<=ae?NaN:(ae+oe)/2},mode:function(){throw new Error("mode is not yet implemented")},sample:function(ae,oe){return(ae+oe)/2+(oe-ae)/2*re.sin(2*re.PI*ee.uniform.sample(0,1))},variance:function(ae,oe){return oe<=ae?NaN:re.pow(oe-ae,2)/8}});function ie(ue){return ue/re.abs(ue)}ee.extend(ee.laplace,{pdf:function(ae,oe,ce){return ce<=0?0:re.exp(-re.abs(ae-oe)/ce)/(2*ce)},cdf:function(ae,oe,ce){return ce<=0?0:ae<oe?.5*re.exp((ae-oe)/ce):1-.5*re.exp(-(ae-oe)/ce)},mean:function(ue){return ue},median:function(ue){return ue},mode:function(ue){return ue},variance:function(ue,ae){return 2*ae*ae},sample:function(ae,oe){var ce=ee._random_fn()-.5;return ae-oe*ie(ce)*re.log(1-2*re.abs(ce))}});function se(ue,ae,oe){var ce=12,he=6,pe=-30,de=-50,me=60,ge=8,we=3,ve=2,_e=3,Te=[.9815606342467192,.9041172563704749,.7699026741943047,.5873179542866175,.3678314989981802,.1252334085114689],ye=[.04717533638651183,.10693932599531843,.16007832854334622,.20316742672306592,.2334925365383548,.24914704581340277],be=ue*.5;if(be>=ge)return 1;var Fe=2*ee.normal.cdf(be,0,1,1,0)-1;Fe>=re.exp(de/oe)?Fe=re.pow(Fe,oe):Fe=0;var Le;ue>we?Le=ve:Le=_e;for(var Oe=be,Se=(ge-be)/Le,De=Oe+Se,Ie=0,Ve=oe-1,Ke=1;Ke<=Le;Ke++){for(var ht=0,qe=.5*(De+Oe),ot=.5*(De-Oe),nt=1;nt<=ce;nt++){var Xe,Ge;he<nt?(Xe=ce-nt+1,Ge=Te[Xe-1]):(Xe=nt,Ge=-Te[Xe-1]);var et=ot*Ge,tt=qe+et,je=tt*tt;if(je>me)break;var at=2*ee.normal.cdf(tt,0,1,1,0),Bt=2*ee.normal.cdf(tt,ue,1,1,0),Et=at*.5-Bt*.5;Et>=re.exp(pe/Ve)&&(Et=ye[Xe-1]*re.exp(-(.5*je))*re.pow(Et,Ve),ht+=Et)}ht*=2*ot*oe/re.sqrt(2*re.PI),Ie+=ht,Oe=De,De+=Se}return Fe+=Ie,Fe<=re.exp(pe/ae)?0:(Fe=re.pow(Fe,ae),Fe>=1?1:Fe)}function le(ue,ae,oe){var ce=.322232421088,he=.099348462606,pe=-1,de=.588581570495,me=-.342242088547,ge=.531103462366,we=-.204231210125,ve=.10353775285,_e=-453642210148e-16,Te=.0038560700634,ye=.8832,be=.2368,Fe=1.214,Le=1.208,Oe=1.4142,Se=120,De=.5-.5*ue,Ie=re.sqrt(re.log(1/(De*De))),Ve=Ie+((((Ie*_e+we)*Ie+me)*Ie+pe)*Ie+ce)/((((Ie*Te+ve)*Ie+ge)*Ie+de)*Ie+he);oe<Se&&(Ve+=(Ve*Ve*Ve+Ve)/oe/4);var Ke=ye-be*Ve;return oe<Se&&(Ke+=-Fe/oe+Le*Ve/oe),Ve*(Ke*re.log(ae-1)+Oe)}ee.extend(ee.tukey,{cdf:function(ae,oe,ce){var he=1,pe=oe,de=16,me=8,ge=-30,we=1e-14,ve=100,_e=800,Te=5e3,ye=25e3,be=1,Fe=.5,Le=.25,Oe=.125,Se=[.9894009349916499,.9445750230732326,.8656312023878318,.755404408355003,.6178762444026438,.45801677765722737,.2816035507792589,.09501250983763744],De=[.027152459411754096,.062253523938647894,.09515851168249279,.12462897125553388,.14959598881657674,.16915651939500254,.18260341504492358,.1894506104550685];if(ae<=0)return 0;if(ce<2||he<1||pe<2)return NaN;if(!Number.isFinite(ae))return 1;if(ce>ye)return se(ae,he,pe);var Ie=ce*.5,Ve=Ie*re.log(ce)-ce*re.log(2)-ee.gammaln(Ie),Ke=Ie-1,ht=ce*.25,qe;ce<=ve?qe=be:ce<=_e?qe=Fe:ce<=Te?qe=Le:qe=Oe,Ve+=re.log(qe);for(var ot=0,nt=1;nt<=50;nt++){for(var Xe=0,Ge=(2*nt-1)*qe,et=1;et<=de;et++){var tt,je;me<et?(tt=et-me-1,je=Ve+Ke*re.log(Ge+Se[tt]*qe)-(Se[tt]*qe+Ge)*ht):(tt=et-1,je=Ve+Ke*re.log(Ge-Se[tt]*qe)+(Se[tt]*qe-Ge)*ht);var at;if(je>=ge){me<et?at=ae*re.sqrt((Se[tt]*qe+Ge)*.5):at=ae*re.sqrt((-(Se[tt]*qe)+Ge)*.5);var Bt=se(at,he,pe),Et=Bt*De[tt]*re.exp(je);Xe+=Et}}if(nt*qe>=1&&Xe<=we)break;ot+=Xe}if(Xe>we)throw new Error("tukey.cdf failed to converge");return ot>1&&(ot=1),ot},inv:function(ue,ae,oe){var ce=1,he=ae,pe=1e-4,de=50;if(oe<2||ce<1||he<2)return NaN;if(ue<0||ue>1)return NaN;if(ue===0)return 0;if(ue===1)return 1/0;var me=le(ue,he,oe),ge=ee.tukey.cdf(me,ae,oe)-ue,we;ge>0?we=re.max(0,me-1):we=me+1;for(var ve=ee.tukey.cdf(we,ae,oe)-ue,_e,Te=1;Te<de;Te++){_e=we-ve*(we-me)/(ve-ge),ge=ve,me=we,_e<0&&(_e=0,ve=-ue),ve=ee.tukey.cdf(_e,ae,oe)-ue,we=_e;var ye=re.abs(we-me);if(ye<pe)return _e}throw new Error("tukey.inv failed to converge")}})}(te,Math),function(ee,re){var ne=Array.prototype.push,ie=ee.utils.isArray;function se(le){return ie(le)||le instanceof ee}ee.extend({add:function(ue,ae){return se(ae)?(se(ae[0])||(ae=[ae]),ee.map(ue,function(oe,ce,he){return oe+ae[ce][he]})):ee.map(ue,function(oe){return oe+ae})},subtract:function(ue,ae){return se(ae)?(se(ae[0])||(ae=[ae]),ee.map(ue,function(oe,ce,he){return oe-ae[ce][he]||0})):ee.map(ue,function(oe){return oe-ae})},divide:function(ue,ae){return se(ae)?(se(ae[0])||(ae=[ae]),ee.multiply(ue,ee.inv(ae))):ee.map(ue,function(oe){return oe/ae})},multiply:function(ue,ae){var oe,ce,he,pe,de,me,ge,we;if(ue.length===void 0&&ae.length===void 0)return ue*ae;if(de=ue.length,me=ue[0].length,ge=ee.zeros(de,he=se(ae)?ae[0].length:me),we=0,se(ae)){for(;we<he;we++)for(oe=0;oe<de;oe++){for(pe=0,ce=0;ce<me;ce++)pe+=ue[oe][ce]*ae[ce][we];ge[oe][we]=pe}return de===1&&we===1?ge[0][0]:ge}return ee.map(ue,function(ve){return ve*ae})},outer:function(ue,ae){return ee.multiply(ue.map(function(oe){return[oe]}),[ae])},dot:function(ue,ae){se(ue[0])||(ue=[ue]),se(ae[0])||(ae=[ae]);for(var oe=ue[0].length===1&&ue.length!==1?ee.transpose(ue):ue,ce=ae[0].length===1&&ae.length!==1?ee.transpose(ae):ae,he=[],pe=0,de=oe.length,me=oe[0].length,ge,we;pe<de;pe++){for(he[pe]=[],ge=0,we=0;we<me;we++)ge+=oe[pe][we]*ce[pe][we];he[pe]=ge}return he.length===1?he[0]:he},pow:function(ue,ae){return ee.map(ue,function(oe){return re.pow(oe,ae)})},exp:function(ue){return ee.map(ue,function(ae){return re.exp(ae)})},log:function(ue){return ee.map(ue,function(ae){return re.log(ae)})},abs:function(ue){return ee.map(ue,function(ae){return re.abs(ae)})},norm:function(ue,ae){var oe=0,ce=0;for(isNaN(ae)&&(ae=2),se(ue[0])&&(ue=ue[0]);ce<ue.length;ce++)oe+=re.pow(re.abs(ue[ce]),ae);return re.pow(oe,1/ae)},angle:function(ue,ae){return re.acos(ee.dot(ue,ae)/(ee.norm(ue)*ee.norm(ae)))},aug:function(ue,ae){var oe=[],ce;for(ce=0;ce<ue.length;ce++)oe.push(ue[ce].slice());for(ce=0;ce<oe.length;ce++)ne.apply(oe[ce],ae[ce]);return oe},inv:function(ue){for(var ae=ue.length,oe=ue[0].length,ce=ee.identity(ae,oe),he=ee.gauss_jordan(ue,ce),pe=[],de=0,me;de<ae;de++)for(pe[de]=[],me=oe;me<he[0].length;me++)pe[de][me-oe]=he[de][me];return pe},det:function(ue){var ae=ue.length,oe=ae*2,ce=new Array(oe),he=ae-1,pe=oe-1,de=he-ae+1,me=pe,ge=0,we=0,ve;if(ae===2)return ue[0][0]*ue[1][1]-ue[0][1]*ue[1][0];for(;ge<oe;ge++)ce[ge]=1;for(ge=0;ge<ae;ge++){for(ve=0;ve<ae;ve++)ce[de<0?de+ae:de]*=ue[ge][ve],ce[me<ae?me+ae:me]*=ue[ge][ve],de++,me--;de=--he-ae+1,me=--pe}for(ge=0;ge<ae;ge++)we+=ce[ge];for(;ge<oe;ge++)we-=ce[ge];return we},gauss_elimination:function(ue,ae){var oe=0,ce=0,he=ue.length,pe=ue[0].length,de=1,me=0,ge=[],we,ve,_e,Te;for(ue=ee.aug(ue,ae),we=ue[0].length,oe=0;oe<he;oe++){for(ve=ue[oe][oe],ce=oe,Te=oe+1;Te<pe;Te++)ve<re.abs(ue[Te][oe])&&(ve=ue[Te][oe],ce=Te);if(ce!=oe)for(Te=0;Te<we;Te++)_e=ue[oe][Te],ue[oe][Te]=ue[ce][Te],ue[ce][Te]=_e;for(ce=oe+1;ce<he;ce++)for(de=ue[ce][oe]/ue[oe][oe],Te=oe;Te<we;Te++)ue[ce][Te]=ue[ce][Te]-de*ue[oe][Te]}for(oe=he-1;oe>=0;oe--){for(me=0,ce=oe+1;ce<=he-1;ce++)me=me+ge[ce]*ue[oe][ce];ge[oe]=(ue[oe][we-1]-me)/ue[oe][oe]}return ge},gauss_jordan:function(ue,ae){var oe=ee.aug(ue,ae),ce=oe.length,he=oe[0].length,pe=0,de,me,ge;for(me=0;me<ce;me++){var we=me;for(ge=me+1;ge<ce;ge++)re.abs(oe[ge][me])>re.abs(oe[we][me])&&(we=ge);var ve=oe[me];for(oe[me]=oe[we],oe[we]=ve,ge=me+1;ge<ce;ge++)for(pe=oe[ge][me]/oe[me][me],de=me;de<he;de++)oe[ge][de]-=oe[me][de]*pe}for(me=ce-1;me>=0;me--){for(pe=oe[me][me],ge=0;ge<me;ge++)for(de=he-1;de>me-1;de--)oe[ge][de]-=oe[me][de]*oe[ge][me]/pe;for(oe[me][me]/=pe,de=ce;de<he;de++)oe[me][de]/=pe}return oe},triaUpSolve:function(ue,ae){var oe=ue[0].length,ce=ee.zeros(1,oe)[0],he,pe=!1;return ae[0].length!=null&&(ae=ae.map(function(de){return de[0]}),pe=!0),ee.arange(oe-1,-1,-1).forEach(function(de){he=ee.arange(de+1,oe).map(function(me){return ce[me]*ue[de][me]}),ce[de]=(ae[de]-ee.sum(he))/ue[de][de]}),pe?ce.map(function(de){return[de]}):ce},triaLowSolve:function(ue,ae){var oe=ue[0].length,ce=ee.zeros(1,oe)[0],he,pe=!1;return ae[0].length!=null&&(ae=ae.map(function(de){return de[0]}),pe=!0),ee.arange(oe).forEach(function(de){he=ee.arange(de).map(function(me){return ue[de][me]*ce[me]}),ce[de]=(ae[de]-ee.sum(he))/ue[de][de]}),pe?ce.map(function(de){return[de]}):ce},lu:function(ue){var ae=ue.length,oe=ee.identity(ae),ce=ee.zeros(ue.length,ue[0].length),he;return ee.arange(ae).forEach(function(pe){ce[0][pe]=ue[0][pe]}),ee.arange(1,ae).forEach(function(pe){ee.arange(pe).forEach(function(de){he=ee.arange(de).map(function(me){return oe[pe][me]*ce[me][de]}),oe[pe][de]=(ue[pe][de]-ee.sum(he))/ce[de][de]}),ee.arange(pe,ae).forEach(function(de){he=ee.arange(pe).map(function(me){return oe[pe][me]*ce[me][de]}),ce[pe][de]=ue[he.length][de]-ee.sum(he)})}),[oe,ce]},cholesky:function(ue){var ae=ue.length,oe=ee.zeros(ue.length,ue[0].length),ce;return ee.arange(ae).forEach(function(he){ce=ee.arange(he).map(function(pe){return re.pow(oe[he][pe],2)}),oe[he][he]=re.sqrt(ue[he][he]-ee.sum(ce)),ee.arange(he+1,ae).forEach(function(pe){ce=ee.arange(he).map(function(de){return oe[he][de]*oe[pe][de]}),oe[pe][he]=(ue[he][pe]-ee.sum(ce))/oe[he][he]})}),oe},gauss_jacobi:function(ue,ae,oe,ce){for(var he=0,pe=0,de=ue.length,me=[],ge=[],we=[],ve,_e,Te,ye;he<de;he++)for(me[he]=[],ge[he]=[],we[he]=[],pe=0;pe<de;pe++)he>pe?(me[he][pe]=ue[he][pe],ge[he][pe]=we[he][pe]=0):he<pe?(ge[he][pe]=ue[he][pe],me[he][pe]=we[he][pe]=0):(we[he][pe]=ue[he][pe],me[he][pe]=ge[he][pe]=0);for(Te=ee.multiply(ee.multiply(ee.inv(we),ee.add(me,ge)),-1),_e=ee.multiply(ee.inv(we),ae),ve=oe,ye=ee.add(ee.multiply(Te,oe),_e),he=2;re.abs(ee.norm(ee.subtract(ye,ve)))>ce;)ve=ye,ye=ee.add(ee.multiply(Te,ve),_e),he++;return ye},gauss_seidel:function(ue,ae,oe,ce){for(var he=0,pe=ue.length,de=[],me=[],ge=[],we,ve,_e,Te,ye;he<pe;he++)for(de[he]=[],me[he]=[],ge[he]=[],we=0;we<pe;we++)he>we?(de[he][we]=ue[he][we],me[he][we]=ge[he][we]=0):he<we?(me[he][we]=ue[he][we],de[he][we]=ge[he][we]=0):(ge[he][we]=ue[he][we],de[he][we]=me[he][we]=0);for(Te=ee.multiply(ee.multiply(ee.inv(ee.add(ge,de)),me),-1),_e=ee.multiply(ee.inv(ee.add(ge,de)),ae),ve=oe,ye=ee.add(ee.multiply(Te,oe),_e),he=2;re.abs(ee.norm(ee.subtract(ye,ve)))>ce;)ve=ye,ye=ee.add(ee.multiply(Te,ve),_e),he=he+1;return ye},SOR:function(ue,ae,oe,ce,he){for(var pe=0,de=ue.length,me=[],ge=[],we=[],ve,_e,Te,ye,be;pe<de;pe++)for(me[pe]=[],ge[pe]=[],we[pe]=[],ve=0;ve<de;ve++)pe>ve?(me[pe][ve]=ue[pe][ve],ge[pe][ve]=we[pe][ve]=0):pe<ve?(ge[pe][ve]=ue[pe][ve],me[pe][ve]=we[pe][ve]=0):(we[pe][ve]=ue[pe][ve],me[pe][ve]=ge[pe][ve]=0);for(ye=ee.multiply(ee.inv(ee.add(we,ee.multiply(me,he))),ee.subtract(ee.multiply(we,1-he),ee.multiply(ge,he))),Te=ee.multiply(ee.multiply(ee.inv(ee.add(we,ee.multiply(me,he))),ae),he),_e=oe,be=ee.add(ee.multiply(ye,oe),Te),pe=2;re.abs(ee.norm(ee.subtract(be,_e)))>ce;)_e=be,be=ee.add(ee.multiply(ye,_e),Te),pe++;return be},householder:function(ue){for(var ae=ue.length,oe=ue[0].length,ce=0,he=[],pe=[],de,me,ge,we,ve;ce<ae-1;ce++){for(de=0,we=ce+1;we<oe;we++)de+=ue[we][ce]*ue[we][ce];for(ve=ue[ce+1][ce]>0?-1:1,de=ve*re.sqrt(de),me=re.sqrt((de*de-ue[ce+1][ce]*de)/2),he=ee.zeros(ae,1),he[ce+1][0]=(ue[ce+1][ce]-de)/(2*me),ge=ce+2;ge<ae;ge++)he[ge][0]=ue[ge][ce]/(2*me);pe=ee.subtract(ee.identity(ae,oe),ee.multiply(ee.multiply(he,ee.transpose(he)),2)),ue=ee.multiply(pe,ee.multiply(ue,pe))}return ue},QR:function(){var le=ee.sum,ue=ee.arange;function ae(oe){var ce=oe.length,he=oe[0].length,pe=ee.zeros(he,he);oe=ee.copy(oe);var de,me,ge;for(me=0;me<he;me++){for(pe[me][me]=re.sqrt(le(ue(ce).map(function(we){return oe[we][me]*oe[we][me]}))),de=0;de<ce;de++)oe[de][me]=oe[de][me]/pe[me][me];for(ge=me+1;ge<he;ge++)for(pe[me][ge]=le(ue(ce).map(function(we){return oe[we][me]*oe[we][ge]})),de=0;de<ce;de++)oe[de][ge]=oe[de][ge]-oe[de][me]*pe[me][ge]}return[oe,pe]}return ae}(),lstsq:function(){function le(ae){ae=ee.copy(ae);var oe=ae.length,ce=ee.identity(oe);return ee.arange(oe-1,-1,-1).forEach(function(he){ee.sliceAssign(ce,{row:he},ee.divide(ee.slice(ce,{row:he}),ae[he][he])),ee.sliceAssign(ae,{row:he},ee.divide(ee.slice(ae,{row:he}),ae[he][he])),ee.arange(he).forEach(function(pe){var de=ee.multiply(ae[pe][he],-1),me=ee.slice(ae,{row:pe}),ge=ee.multiply(ee.slice(ae,{row:he}),de);ee.sliceAssign(ae,{row:pe},ee.add(me,ge));var we=ee.slice(ce,{row:pe}),ve=ee.multiply(ee.slice(ce,{row:he}),de);ee.sliceAssign(ce,{row:pe},ee.add(we,ve))})}),ce}function ue(ae,oe){var ce=!1;oe[0].length===void 0&&(oe=oe.map(function(ye){return[ye]}),ce=!0);var he=ee.QR(ae),pe=he[0],de=he[1],me=ae[0].length,ge=ee.slice(pe,{col:{end:me}}),we=ee.slice(de,{row:{end:me}}),ve=le(we),_e=ee.transpose(ge);_e[0].length===void 0&&(_e=[_e]);var Te=ee.multiply(ee.multiply(ve,_e),oe);return Te.length===void 0&&(Te=[[Te]]),ce?Te.map(function(ye){return ye[0]}):Te}return ue}(),jacobi:function(ue){for(var ae=1,oe=ue.length,ce=ee.identity(oe,oe),he=[],pe,de,me,ge,we,ve,_e,Te;ae===1;){for(ve=ue[0][1],ge=0,we=1,de=0;de<oe;de++)for(me=0;me<oe;me++)de!=me&&ve<re.abs(ue[de][me])&&(ve=re.abs(ue[de][me]),ge=de,we=me);for(ue[ge][ge]===ue[we][we]?_e=ue[ge][we]>0?re.PI/4:-re.PI/4:_e=re.atan(2*ue[ge][we]/(ue[ge][ge]-ue[we][we]))/2,Te=ee.identity(oe,oe),Te[ge][ge]=re.cos(_e),Te[ge][we]=-re.sin(_e),Te[we][ge]=re.sin(_e),Te[we][we]=re.cos(_e),ce=ee.multiply(ce,Te),pe=ee.multiply(ee.multiply(ee.inv(Te),ue),Te),ue=pe,ae=0,de=1;de<oe;de++)for(me=1;me<oe;me++)de!=me&&re.abs(ue[de][me])>.001&&(ae=1)}for(de=0;de<oe;de++)he.push(ue[de][de]);return[ce,he]},rungekutta:function(ue,ae,oe,ce,he,pe){var de,me,ge,we,ve;if(pe===2)for(;ce<=oe;)de=ae*ue(ce,he),me=ae*ue(ce+ae,he+de),ge=he+(de+me)/2,he=ge,ce=ce+ae;if(pe===4)for(;ce<=oe;)de=ae*ue(ce,he),me=ae*ue(ce+ae/2,he+de/2),we=ae*ue(ce+ae/2,he+me/2),ve=ae*ue(ce+ae,he+we),ge=he+(de+2*me+2*we+ve)/6,he=ge,ce=ce+ae;return he},romberg:function(ue,ae,oe,ce){for(var he=0,pe=(oe-ae)/2,de=[],me=[],ge=[],we,ve,_e,Te,ye;he<ce/2;){for(ye=ue(ae),_e=ae,Te=0;_e<=oe;_e=_e+pe,Te++)de[Te]=_e;for(we=de.length,_e=1;_e<we-1;_e++)ye+=(_e%2!==0?4:2)*ue(de[_e]);ye=pe/3*(ye+ue(oe)),ge[he]=ye,pe/=2,he++}for(ve=ge.length,we=1;ve!==1;){for(_e=0;_e<ve-1;_e++)me[_e]=(re.pow(4,we)*ge[_e+1]-ge[_e])/(re.pow(4,we)-1);ve=me.length,ge=me,me=[],we++}return ge},richardson:function(ue,ae,oe,ce){function he(be,Fe){for(var Le=0,Oe=be.length,Se;Le<Oe;Le++)be[Le]===Fe&&(Se=Le);return Se}for(var pe=re.abs(oe-ue[he(ue,oe)+1]),de=0,me=[],ge=[],we,ve,_e,Te,ye;ce>=pe;)we=he(ue,oe+ce),ve=he(ue,oe),me[de]=(ae[we]-2*ae[ve]+ae[2*ve-we])/(ce*ce),ce/=2,de++;for(Te=me.length,_e=1;Te!=1;){for(ye=0;ye<Te-1;ye++)ge[ye]=(re.pow(4,_e)*me[ye+1]-me[ye])/(re.pow(4,_e)-1);Te=ge.length,me=ge,ge=[],_e++}return me},simpson:function(ue,ae,oe,ce){for(var he=(oe-ae)/ce,pe=ue(ae),de=[],me=ae,ge=0,we=1,ve;me<=oe;me=me+he,ge++)de[ge]=me;for(ve=de.length;we<ve-1;we++)pe+=(we%2!==0?4:2)*ue(de[we]);return he/3*(pe+ue(oe))},hermite:function(ue,ae,oe,ce){for(var he=ue.length,pe=0,de=0,me=[],ge=[],we=[],ve=[],_e;de<he;de++){for(me[de]=1,_e=0;_e<he;_e++)de!=_e&&(me[de]*=(ce-ue[_e])/(ue[de]-ue[_e]));for(ge[de]=0,_e=0;_e<he;_e++)de!=_e&&(ge[de]+=1/(ue[de]-ue[_e]));we[de]=(1-2*(ce-ue[de])*ge[de])*(me[de]*me[de]),ve[de]=(ce-ue[de])*(me[de]*me[de]),pe+=we[de]*ae[de]+ve[de]*oe[de]}return pe},lagrange:function(ue,ae,oe){for(var ce=0,he=0,pe,de,me=ue.length;he<me;he++){for(de=ae[he],pe=0;pe<me;pe++)he!=pe&&(de*=(oe-ue[pe])/(ue[he]-ue[pe]));ce+=de}return ce},cubic_spline:function(ue,ae,oe){for(var ce=ue.length,he=0,pe,de=[],me=[],ge=[],we=[],ve=[],_e=[],Te=[];he<ce-1;he++)ve[he]=ue[he+1]-ue[he];for(ge[0]=0,he=1;he<ce-1;he++)ge[he]=3/ve[he]*(ae[he+1]-ae[he])-3/ve[he-1]*(ae[he]-ae[he-1]);for(he=1;he<ce-1;he++)de[he]=[],me[he]=[],de[he][he-1]=ve[he-1],de[he][he]=2*(ve[he-1]+ve[he]),de[he][he+1]=ve[he],me[he][0]=ge[he];for(we=ee.multiply(ee.inv(de),me),pe=0;pe<ce-1;pe++)_e[pe]=(ae[pe+1]-ae[pe])/ve[pe]-ve[pe]*(we[pe+1][0]+2*we[pe][0])/3,Te[pe]=(we[pe+1][0]-we[pe][0])/(3*ve[pe]);for(pe=0;pe<ce&&!(ue[pe]>oe);pe++);return pe-=1,ae[pe]+(oe-ue[pe])*_e[pe]+ee.sq(oe-ue[pe])*we[pe]+(oe-ue[pe])*ee.sq(oe-ue[pe])*Te[pe]},gauss_quadrature:function(){throw new Error("gauss_quadrature not yet implemented")},PCA:function(ue){var ae=ue.length,oe=ue[0].length,ce=0,he,pe,de=[],me=[],ge=[],we=[],ve=[],_e=[],Te=[],ye=[],be=[],Fe=[];for(ce=0;ce<ae;ce++)de[ce]=ee.sum(ue[ce])/oe;for(ce=0;ce<oe;ce++)for(Te[ce]=[],he=0;he<ae;he++)Te[ce][he]=ue[he][ce]-de[he];for(Te=ee.transpose(Te),ce=0;ce<ae;ce++)for(ye[ce]=[],he=0;he<ae;he++)ye[ce][he]=ee.dot([Te[ce]],[Te[he]])/(oe-1);for(ge=ee.jacobi(ye),be=ge[0],me=ge[1],Fe=ee.transpose(be),ce=0;ce<me.length;ce++)for(he=ce;he<me.length;he++)me[ce]<me[he]&&(pe=me[ce],me[ce]=me[he],me[he]=pe,we=Fe[ce],Fe[ce]=Fe[he],Fe[he]=we);for(_e=ee.transpose(Te),ce=0;ce<ae;ce++)for(ve[ce]=[],he=0;he<_e.length;he++)ve[ce][he]=ee.dot([Fe[ce]],[_e[he]]);return[ue,me,Fe,ve]}}),function(le){for(var ue=0;ue<le.length;ue++)(function(ae){ee.fn[ae]=function(oe,ce){var he=this;return ce?(setTimeout(function(){ce.call(he,ee.fn[ae].call(he,oe))},15),this):typeof ee[ae](this,oe)=="number"?ee[ae](this,oe):ee(ee[ae](this,oe))}})(le[ue])}("add divide multiply subtract dot pow exp log abs norm angle".split(" "))}(te,Math),function(ee,re){var ne=[].slice,ie=ee.utils.isNumber,se=ee.utils.isArray;ee.extend({zscore:function(){var ae=ne.call(arguments);return ie(ae[1])?(ae[0]-ae[1])/ae[2]:(ae[0]-ee.mean(ae[1]))/ee.stdev(ae[1],ae[2])},ztest:function(){var ae=ne.call(arguments),oe;return se(ae[1])?(oe=ee.zscore(ae[0],ae[1],ae[3]),ae[2]===1?ee.normal.cdf(-re.abs(oe),0,1):ee.normal.cdf(-re.abs(oe),0,1)*2):ae.length>2?(oe=ee.zscore(ae[0],ae[1],ae[2]),ae[3]===1?ee.normal.cdf(-re.abs(oe),0,1):ee.normal.cdf(-re.abs(oe),0,1)*2):(oe=ae[0],ae[1]===1?ee.normal.cdf(-re.abs(oe),0,1):ee.normal.cdf(-re.abs(oe),0,1)*2)}}),ee.extend(ee.fn,{zscore:function(ae,oe){return(ae-this.mean())/this.stdev(oe)},ztest:function(ae,oe,ce){var he=re.abs(this.zscore(ae,ce));return oe===1?ee.normal.cdf(-he,0,1):ee.normal.cdf(-he,0,1)*2}}),ee.extend({tscore:function(){var ae=ne.call(arguments);return ae.length===4?(ae[0]-ae[1])/(ae[2]/re.sqrt(ae[3])):(ae[0]-ee.mean(ae[1]))/(ee.stdev(ae[1],!0)/re.sqrt(ae[1].length))},ttest:function(){var ae=ne.call(arguments),oe;return ae.length===5?(oe=re.abs(ee.tscore(ae[0],ae[1],ae[2],ae[3])),ae[4]===1?ee.studentt.cdf(-oe,ae[3]-1):ee.studentt.cdf(-oe,ae[3]-1)*2):ie(ae[1])?(oe=re.abs(ae[0]),ae[2]==1?ee.studentt.cdf(-oe,ae[1]-1):ee.studentt.cdf(-oe,ae[1]-1)*2):(oe=re.abs(ee.tscore(ae[0],ae[1])),ae[2]==1?ee.studentt.cdf(-oe,ae[1].length-1):ee.studentt.cdf(-oe,ae[1].length-1)*2)}}),ee.extend(ee.fn,{tscore:function(ae){return(ae-this.mean())/(this.stdev(!0)/re.sqrt(this.cols()))},ttest:function(ae,oe){return oe===1?1-ee.studentt.cdf(re.abs(this.tscore(ae)),this.cols()-1):ee.studentt.cdf(-re.abs(this.tscore(ae)),this.cols()-1)*2}}),ee.extend({anovafscore:function(){var ae=ne.call(arguments),oe,ce,he,pe,de,me,ge,we;if(ae.length===1){for(de=new Array(ae[0].length),ge=0;ge<ae[0].length;ge++)de[ge]=ae[0][ge];ae=de}for(ce=new Array,ge=0;ge<ae.length;ge++)ce=ce.concat(ae[ge]);for(he=ee.mean(ce),oe=0,ge=0;ge<ae.length;ge++)oe=oe+ae[ge].length*re.pow(ee.mean(ae[ge])-he,2);for(oe/=ae.length-1,me=0,ge=0;ge<ae.length;ge++)for(pe=ee.mean(ae[ge]),we=0;we<ae[ge].length;we++)me+=re.pow(ae[ge][we]-pe,2);return me/=ce.length-ae.length,oe/me},anovaftest:function(){var ae=ne.call(arguments),oe,ce,he,pe;if(ie(ae[0]))return 1-ee.centralF.cdf(ae[0],ae[1],ae[2]);var de=ee.anovafscore(ae);for(oe=ae.length-1,he=0,pe=0;pe<ae.length;pe++)he=he+ae[pe].length;return ce=he-oe-1,1-ee.centralF.cdf(de,oe,ce)},ftest:function(ae,oe,ce){return 1-ee.centralF.cdf(ae,oe,ce)}}),ee.extend(ee.fn,{anovafscore:function(){return ee.anovafscore(this.toArray())},anovaftes:function(){var ae=0,oe;for(oe=0;oe<this.length;oe++)ae=ae+this[oe].length;return ee.ftest(this.anovafscore(),this.length-1,ae-this.length)}}),ee.extend({qscore:function(){var ae=ne.call(arguments),oe,ce,he,pe,de;return ie(ae[0])?(oe=ae[0],ce=ae[1],he=ae[2],pe=ae[3],de=ae[4]):(oe=ee.mean(ae[0]),ce=ee.mean(ae[1]),he=ae[0].length,pe=ae[1].length,de=ae[2]),re.abs(oe-ce)/(de*re.sqrt((1/he+1/pe)/2))},qtest:function(){var ae=ne.call(arguments),oe;ae.length===3?(oe=ae[0],ae=ae.slice(1)):ae.length===7?(oe=ee.qscore(ae[0],ae[1],ae[2],ae[3],ae[4]),ae=ae.slice(5)):(oe=ee.qscore(ae[0],ae[1],ae[2]),ae=ae.slice(3));var ce=ae[0],he=ae[1];return 1-ee.tukey.cdf(oe,he,ce-he)},tukeyhsd:function(ae){for(var oe=ee.pooledstdev(ae),ce=ae.map(function(we){return ee.mean(we)}),he=ae.reduce(function(we,ve){return we+ve.length},0),pe=[],de=0;de<ae.length;++de)for(var me=de+1;me<ae.length;++me){var ge=ee.qtest(ce[de],ce[me],ae[de].length,ae[me].length,oe,he,ae.length);pe.push([[de,me],ge])}return pe}}),ee.extend({normalci:function(){var ae=ne.call(arguments),oe=new Array(2),ce;return ae.length===4?ce=re.abs(ee.normal.inv(ae[1]/2,0,1)*ae[2]/re.sqrt(ae[3])):ce=re.abs(ee.normal.inv(ae[1]/2,0,1)*ee.stdev(ae[2])/re.sqrt(ae[2].length)),oe[0]=ae[0]-ce,oe[1]=ae[0]+ce,oe},tci:function(){var ae=ne.call(arguments),oe=new Array(2),ce;return ae.length===4?ce=re.abs(ee.studentt.inv(ae[1]/2,ae[3]-1)*ae[2]/re.sqrt(ae[3])):ce=re.abs(ee.studentt.inv(ae[1]/2,ae[2].length-1)*ee.stdev(ae[2],!0)/re.sqrt(ae[2].length)),oe[0]=ae[0]-ce,oe[1]=ae[0]+ce,oe},significant:function(ae,oe){return ae<oe}}),ee.extend(ee.fn,{normalci:function(ae,oe){return ee.normalci(ae,oe,this.toArray())},tci:function(ae,oe){return ee.tci(ae,oe,this.toArray())}});function le(ue,ae,oe,ce){if(ue>1||oe>1||ue<=0||oe<=0)throw new Error("Proportions should be greater than 0 and less than 1");var he=(ue*ae+oe*ce)/(ae+ce),pe=re.sqrt(he*(1-he)*(1/ae+1/ce));return(ue-oe)/pe}ee.extend(ee.fn,{oneSidedDifferenceOfProportions:function(ae,oe,ce,he){var pe=le(ae,oe,ce,he);return ee.ztest(pe,1)},twoSidedDifferenceOfProportions:function(ae,oe,ce,he){var pe=le(ae,oe,ce,he);return ee.ztest(pe,2)}})}(te,Math),te.models=function(){function ee(le){var ue=le[0].length,ae=te.arange(ue).map(function(oe){var ce=te.arange(ue).filter(function(he){return he!==oe});return re(te.col(le,oe).map(function(he){return he[0]}),te.col(le,ce))});return ae}function re(le,ue){var ae=le.length,oe=ue[0].length-1,ce=ae-oe-1,he=te.lstsq(ue,le),pe=te.multiply(ue,he.map(function(Te){return[Te]})).map(function(Te){return Te[0]}),de=te.subtract(le,pe),me=te.mean(le),ge=te.sum(pe.map(function(Te){return Math.pow(Te-me,2)})),we=te.sum(le.map(function(Te,ye){return Math.pow(Te-pe[ye],2)})),ve=ge+we,_e=ge/ve;return{exog:ue,endog:le,nobs:ae,df_model:oe,df_resid:ce,coef:he,predict:pe,resid:de,ybar:me,SST:ve,SSE:ge,SSR:we,R2:_e}}function ne(le){var ue=ee(le.exog),ae=Math.sqrt(le.SSR/le.df_resid),oe=ue.map(function(me){var ge=me.SST,we=me.R2;return ae/Math.sqrt(ge*(1-we))}),ce=le.coef.map(function(me,ge){return(me-0)/oe[ge]}),he=ce.map(function(me){var ge=te.studentt.cdf(me,le.df_resid);return(ge>.5?1-ge:ge)*2}),pe=te.studentt.inv(.975,le.df_resid),de=le.coef.map(function(me,ge){var we=pe*oe[ge];return[me-we,me+we]});return{se:oe,t:ce,p:he,sigmaHat:ae,interval95:de}}function ie(le){var ue=le.R2/le.df_model/((1-le.R2)/le.df_resid),ae=function(ce,he,pe){return te.beta.cdf(ce/(pe/he+ce),he/2,pe/2)},oe=1-ae(ue,le.df_model,le.df_resid);return{F_statistic:ue,pvalue:oe}}function se(le,ue){var ae=re(le,ue),oe=ne(ae),ce=ie(ae),he=1-(1-ae.R2)*((ae.nobs-1)/ae.df_resid);return ae.t=oe,ae.f=ce,ae.adjust_R2=he,ae}return{ols:se}}(),te.extend({buildxmatrix:function(){for(var re=new Array(arguments.length),ne=0;ne<arguments.length;ne++){var ie=[1];re[ne]=ie.concat(arguments[ne])}return te(re)},builddxmatrix:function(){for(var re=new Array(arguments[0].length),ne=0;ne<arguments[0].length;ne++){var ie=[1];re[ne]=ie.concat(arguments[0][ne])}return te(re)},buildjxmatrix:function(re){for(var ne=new Array(re.length),ie=0;ie<re.length;ie++)ne[ie]=re[ie];return te.builddxmatrix(ne)},buildymatrix:function(re){return te(re).transpose()},buildjymatrix:function(re){return re.transpose()},matrixmult:function(re,ne){var ie,se,le,ue,ae;if(re.cols()==ne.rows()){if(ne.rows()>1){for(ue=[],ie=0;ie<re.rows();ie++)for(ue[ie]=[],se=0;se<ne.cols();se++){for(ae=0,le=0;le<re.cols();le++)ae+=re.toArray()[ie][le]*ne.toArray()[le][se];ue[ie][se]=ae}return te(ue)}for(ue=[],ie=0;ie<re.rows();ie++)for(ue[ie]=[],se=0;se<ne.cols();se++){for(ae=0,le=0;le<re.cols();le++)ae+=re.toArray()[ie][le]*ne.toArray()[se];ue[ie][se]=ae}return te(ue)}},regress:function(re,ne){var ie=te.xtranspxinv(re),se=re.transpose(),le=te.matrixmult(te(ie),se);return te.matrixmult(le,ne)},regresst:function(re,ne,ie){var se=te.regress(re,ne),le={};le.anova={};var ue=te.jMatYBar(re,se);le.yBar=ue;var ae=ne.mean();le.anova.residuals=te.residuals(ne,ue),le.anova.ssr=te.ssr(ue,ae),le.anova.msr=le.anova.ssr/(re[0].length-1),le.anova.sse=te.sse(ne,ue),le.anova.mse=le.anova.sse/(ne.length-(re[0].length-1)-1),le.anova.sst=te.sst(ne,ae),le.anova.mst=le.anova.sst/(ne.length-1),le.anova.r2=1-le.anova.sse/le.anova.sst,le.anova.r2<0&&(le.anova.r2=0),le.anova.fratio=le.anova.msr/le.anova.mse,le.anova.pvalue=te.anovaftest(le.anova.fratio,re[0].length-1,ne.length-(re[0].length-1)-1),le.anova.rmse=Math.sqrt(le.anova.mse),le.anova.r2adj=1-le.anova.mse/le.anova.mst,le.anova.r2adj<0&&(le.anova.r2adj=0),le.stats=new Array(re[0].length);for(var oe=te.xtranspxinv(re),ce,he,pe,de=0;de<se.length;de++)ce=Math.sqrt(le.anova.mse*Math.abs(oe[de][de])),he=Math.abs(se[de]/ce),pe=te.ttest(he,ne.length-re[0].length-1,ie),le.stats[de]=[se[de],ce,he,pe];return le.regress=se,le},xtranspx:function(re){return te.matrixmult(re.transpose(),re)},xtranspxinv:function(re){var ne=te.matrixmult(re.transpose(),re),ie=te.inv(ne);return ie},jMatYBar:function(re,ne){var ie=te.matrixmult(re,ne);return new te(ie)},residuals:function(re,ne){return te.matrixsubtract(re,ne)},ssr:function(re,ne){for(var ie=0,se=0;se<re.length;se++)ie+=Math.pow(re[se]-ne,2);return ie},sse:function(re,ne){for(var ie=0,se=0;se<re.length;se++)ie+=Math.pow(re[se]-ne[se],2);return ie},sst:function(re,ne){for(var ie=0,se=0;se<re.length;se++)ie+=Math.pow(re[se]-ne,2);return ie},matrixsubtract:function(re,ne){for(var ie=new Array(re.length),se=0;se<re.length;se++){ie[se]=new Array(re[se].length);for(var le=0;le<re[se].length;le++)ie[se][le]=re[se][le]-ne[se][le]}return te(ie)}}),te.jStat=te,te});class RandList{constructor(ee){this.simulate=ee,this.vals=[]}get(ee){if(ee>this.vals.length-1)for(let re=this.vals.length;re<=ee;re++)this.simulate.random?this.vals.push(this.simulate.random()):this.vals.push(Math.random());return this.vals[ee]}}function getRandPos(te){return Math.floor((te.time().value-te.timeStart.value)/te.timeStep.value)}function Rand(te,ee=null,re=null){if(te.stochastic=!0,ee!=null)return isNormalNumber(ee,"Rand","Minimum"),isNormalNumber(re,"Rand","Maximum"),Rand(te)*(re-ee)+(0+ee);if(te.RKOrder===1)return te.random?te.random():Math.random();let ne=getRandPos(te);for(ne!==te.lastRandPos&&(te.randLoc=-1,te.lastRandPos=ne);te.previousRandLists.length<=ne;)te.previousRandLists.push(new RandList(te));return te.randLoc=te.randLoc+1,te.previousRandLists[ne].get(te.randLoc)}function RandNormal(te,ee=null,re=null){isNormalNumber(ee,"RandNormal","mu"),isNormalNumber(re,"RandNormal","sigma"),ee===null&&(ee=0),re===null&&(re=1);let ne;return ne=Math.sqrt(-2*Math.log(1-Rand(te)))*Math.cos(Rand(te)*2*3.141593),ne*re+(0+ee)}function RandExp(te,ee=null){if(ee===null&&(ee=1),ee<0)throw new ModelError(`Lambda for RandExp must be greater than or equal to 0; got ${ee}.`,{code:4e3});return isNormalNumber(ee,"RandExp","lambda"),-(1/ee)*Math.log(Rand(te))}function RandLognormal(te,ee,re){if(isNormalNumber(ee,"RandLognormal","mu"),isNormalNumber(re,"RandLognormal","sigma"),ee<=0)throw new ModelError(`<i>Mu</i> for RandLognormal() must be greater than 0; got ${ee}.`,{code:4001});if(re<=0)throw new ModelError(`<i>Sigma</i> for RandLognormal() must be greater than 0; got ${re}.`,{code:4002});let ne=Math.log(ee)-.5*Math.log(1+Math.pow(re/ee,2)),ie=Math.sqrt(Math.log(1+Math.pow(re/ee,2)));return Math.exp(RandNormal(te,ne,ie))}function RandBinomial(te,ee,re){if(isNormalNumber(ee,"RandBinomial","count"),isNormalNumber(re,"RandBinomial","probability"),ee<0)throw new ModelError(`<i>Count</i> for RandBinomial() must be greater than or equal to 0; got ${ee}.`,{code:4003});if(re<0||re>1)throw new ModelError(`<i>Probability</i> for RandBinomial() must be between 0 and 1 (inclusive); got ${re}.`,{code:4004});if(ee===0||re===0)return 0;if(re<=.5)return re*ee<=30?randomBinomialInversion(te,ee,re):randomBinomialBtpe(te,ee,re);{let ne=1-re;return ne*ee<=30?ee-randomBinomialInversion(te,ee,ne):ee-randomBinomialBtpe(te,ee,ne)}}function randomBinomialBtpe(te,ee,re){let ne,ie,se,le,ue,ae,oe,ce,he,pe,de,me,ge,we,ve,_e,Te,ye,be,Fe,Le,Oe,Se,De,Ie,Ve,Ke,ht,qe,ot,nt,Xe,Ge,et,tt;for(ne=Math.min(re,1-re),ie=1-ne,se=ee*ne+ne,Xe=Math.floor(se),le=Math.floor(2.195*Math.sqrt(ee*ne*ie)-4.6*ie)+.5,ue=Xe+.5,ae=ue-le,oe=ue+le,ce=.134+20.5/(15.3+Xe),we=(se-ae)/(se-ae*ne),he=we*(1+we/2),we=(oe-se)/(oe*ie),pe=we*(1+we/2),de=le*(1+2*ce),me=de+ce/he,ge=me+ce/pe;;){if(Oe=ee*ne*ie,ve=Rand(te)*ge,_e=Rand(te),!(ve>le)){Ge=Math.floor(ue-le*_e+ve);break}if(ve>de)if(ve>me){if(Ge=Math.floor(oe-Math.log(_e)/pe),Ge>ee||_e===0)continue;_e=_e*(ve-me)*pe}else{if(Ge=Math.floor(ae+Math.log(_e)/he),Ge<0||_e===0)continue;_e=_e*(ve-de)*he}else{if(nt=ae+(ve-le)/ce,_e=_e*ce+1-Math.abs(Xe-nt+.5)/le,_e>1)continue;Ge=Math.floor(nt)}if(et=Math.abs(Ge-Xe),et>20&&et<Oe/2-1){if(be=et/Oe*((et*(et/3+.625)+.16666666666666666)/Oe+.5),Fe=-et*et/(2*Oe),Le=Math.log(_e),Le<Fe-be)break;if(Le>Fe+be||(Se=Ge+1,Ie=Xe+1,Ke=ee+1-Xe,qe=ee-Ge+1,De=Se*Se,Ve=Ie*Ie,ht=Ke*Ke,ot=qe*qe,Le>ue*Math.log(Ie/Se)+(ee-Xe+.5)*Math.log(Ke/qe)+(Ge-Xe)*Math.log(qe*ne/(Se*ie))+(13680-(462-(132-(99-140/Ve)/Ve)/Ve)/Ve)/Ie/166320+(13680-(462-(132-(99-140/ht)/ht)/ht)/ht)/Ke/166320+(13680-(462-(132-(99-140/De)/De)/De)/De)/Se/166320+(13680-(462-(132-(99-140/ot)/ot)/ot)/ot)/qe/166320))continue}else{if(Te=ne/ie,we=Te*(ee+1),ye=1,Xe<Ge)for(tt=Xe+1;tt<=Ge;tt++)ye*=we/tt-Te;else if(Xe>Ge)for(tt=Ge+1;tt<=Xe;tt++)ye/=we/tt-Te;if(_e>ye)continue;break}}return re>.5&&(Ge=ee-Ge),Ge}function randomBinomialInversion(te,ee,re){let ne,ie,se,le,ue,ae,oe;for(ne=1-re,ie=Math.exp(ee*Math.log(ne)),se=ee*re,oe=Math.min(ee,se+10*Math.sqrt(se*ne+1)),ae=0,le=ie,ue=Rand(te);ue>le;)ae++,ae>oe?(ae=0,le=ie,ue=Rand(te)):(ue-=le,le=(ee-ae+1)*re*le/(ae*ne));return ae}function RandNegativeBinomial(te,ee,re){if(isNormalNumber(ee,"RandNegativeBinomial","successes"),isNormalNumber(re,"RandNegativeBinomial","probability"),ee<0)throw new ModelError(`<i>Successes</i> for RandNegativeBinomial() must be greater than or equal to 0; got ${ee}.`,{code:4005});if(re<0||re>1)throw new ModelError(`<i>Probability</i> for RandNegativeBinomial() must be between 0 and 1 (inclusive); got ${re}.`,{code:4006});let ne=0,ie=0;for(;ie<ee;)Rand(te)<=re&&(ie=ie+1),ne=ne+1;return ne}function RandPoisson(te,ee){if(isNormalNumber(ee,"RandPoisson","lambda"),ee<0)throw new ModelError(`<i>Lambda</i> for RandPoisson() must be greater than or equal to 0; got ${ee}.`,{code:4007});if(ee<50){let re=Math.exp(-ee),ne=0,ie=1;for(;ne=ne+1,ie=ie*Rand(te),ie>re;);return ne-1}else{let re=.767-3.36/ee,ne=Math.PI/Math.sqrt(3*ee),ie=ne*ee,se=Math.log(re)-ee-Math.log(ne);for(;;){let le=Rand(te),ue=(ie-Math.log((1-le)/le))/ne,ae=Math.floor(ue+.5);if(ae<0)continue;let oe=Rand(te),ce=ie-ne*ue,he=ce+Math.log(oe/Math.pow(1+Math.exp(ce),2)),pe=se+ae*Math.log(ee)-jStat.gammaln(ae+1);if(he<=pe)return ae}}}function RandGamma(te,ee,re){if(isNormalNumber(ee,"RandGamma","alpha"),isNormalNumber(re,"RandGamma","beta"),ee<=0)throw new ModelError(`<i>Alpha</i> (shape parameter) for RandGamma() must be greater than 0; got ${ee}.`,{code:4008});if(re<=0)throw new ModelError(`<i>Beta</i> (rate parameter) for RandGamma() must be greater than 0; got ${re}.`,{code:4009});let ne=1;for(let ie=1;ie<=ee;ie++)ne=ne*Rand(te);return-re*Math.log(ne)}function RandBeta(te,ee,re){if(isNormalNumber(ee,"RandBeta","alpha"),isNormalNumber(re,"RandBeta","beta"),ee<=0)throw new ModelError(`<i>Alpha</i> for RandBeta() must be greater than 0; got ${ee}.`,{code:4010});if(re<=0)throw new ModelError(`<i>Beta</i> for RandBeta() must be greater than 0; got ${re}.`,{code:4011});let ne=RandGamma(te,ee,1),ie=RandGamma(te,re,1);return ne/(ne+ie)}function RandTriangular(te,ee,re,ne){isNormalNumber(ee,"RandTriangular","minimum"),isNormalNumber(re,"RandTriangular","maximum"),isNormalNumber(ne,"RandTriangular","peak");let ie=0+ee,se=0+re,le=0+ne;if(ie===se)throw new ModelError("Maximum can't equal the minimum for the triangular distribution.",{code:4012});if(le<ie||le>se)throw new ModelError("The peak must be within the maximum and minimum for the triangular distribution.",{code:4013});let ue=(le-ie)/(se-ie),ae=Rand(te);return ae<ue?ie+Math.sqrt(ae*(se-ie)*(le-ie)):se-Math.sqrt((1-ae)*(se-ie)*(se-le))}function RandDist(te,ee,re){if(ee.length!==re.length)throw new ModelError("The lengths of the 'x' and 'y' vectors must be the same.",{code:4014});if(ee.length<2)throw new ModelError("There must be at least 2 points in a distribution to generate a random number.",{code:4015});for(let se=0;se<ee.length;se++)if(isNormalNumber(ee[se],"RandDist","x"),isNormalNumber(re[se],"RandDist","y"),re[se]<0)throw new ModelError("The y values of RandDist cannot be negative.",{code:4016});let ne=0;for(let se=0;se<ee.length-1;se++)ne+=(ee[se+1]-ee[se])*(re[se+1]+re[se])/2;if(ne===0)throw new ModelError("The area of the distribution in RandDist cannot be 0.",{code:4017});let ie=ne*Rand(te);ne=0;for(let se=0;se<ee.length-1;se++){let le=(ee[se+1]-ee[se])*(re[se+1]+re[se])/2;if(ie>ne&&ie<ne+le){let ue=ie-ne,ae=(re[se+1]-re[se])/(ee[se+1]-ee[se]),oe;return ae===0?oe=ue/re[se]:oe=(-re[se]+Math.sqrt(Math.pow(re[se],2)+2*ae*ue))/ae,ee[se]+oe}ne+=le}}function isNormalNumber(te,ee,re){if(isNaN(te))throw new ModelError(`The <i>${re}</i> passed to ${ee}() was not a number.`,{code:4018});if(!isFinite(te))throw new ModelError(`The <i>${re}</i> passed to ${ee}() must not be infinite.`,{code:4019});if(te>1e15)throw new ModelError(`The <i>${re}</i> passed to ${ee}() must not be not be greater than 1e15 (got ${te}).`,{code:4020})}function keysMatch(te,ee){if(!ee.includes("*")){for(let re=0;re<te.length;re++)if(te[re]!=="*"&&(te[re]===void 0||!ee.includes(te[re])))return!1}if(!te.includes("*")){for(let re=0;re<ee.length;re++)if(ee[re]!=="*"&&(ee[re]===void 0||!te.includes(ee[re])))return!1}return!0}class Vector{constructor(ee,re,ne,ie){if(this.simulate=re,this.parent=ie||re.varBank.vectorbase,this.items=ee,this.names=ne,this.namesLC=void 0,this.isNum=void 0,this.terminateApply=void 0,ne){this.namesLC=[];for(let se of ne)se?this.namesLC.push(se.toLowerCase()):this.namesLC.push(void 0)}}toNum(){if(this.isNum)return this;let ee=this.fullClone();for(let re=0;re<ee.items.length;re++)ee.items[re]=toNum(ee.items[re]);return ee.isNum=!0,ee}toString(){let ee=[];for(let re=0;re<this.items.length;re++)try{let ne=toNum(this.items[re]).toString();this.names&&this.names[re]&&(ne=this.names[re]+": "+ne),ee.push(ne)}catch{ee.push("{Cannot convert value to string}")}return"{"+ee.join(", ")+"}"}length(){return this.items.length}cloneCombine(ee,re,ne,ie){return this.fullClone().combine(ee,re,ne,ie)}combine(ee,re,ne,ie){if(ee instanceof Vector&&this.length()!==ee.length()&&!this.names&&!ee.names)throw new ModelError("Vectors must have equal length when combined.",{code:2001});if(ee instanceof Vector&&this.names&&ee.names){if(!ie&&ee.depth()>this.depth())return ee.combine(this,re,!ne);if(!this.keysMatch(ee.namesLC))if(this.items[0]instanceof Vector){for(let se=0;se<this.items.length;se++)this.items[se].combine(ee,re,ne,!0);return this}else throw new ModelError("Keys do not match for vector operation.",{code:2e3})}for(let se=0;se<this.length();se++){let le;if(ee instanceof Vector)if(this.names&&ee.names){let ue=ee.namesLC.indexOf(this.namesLC[se]);if(this.names.length===1&&this.names[0]==="*"&&(ue=-2),ue===-1&&(ue=ee.names.indexOf("*")),ue===-1)throw new ModelError("Mismatched keys for vector operation.",{code:2002});ue===-2?le=void 0:le=ee.items[ue]}else le=ee.items[se];else le=ee;le!==void 0&&(ne?this.items[se]=re(le,this.items[se]):this.items[se]=re(this.items[se],le))}if(this.names&&this.names.includes("*")&&ee instanceof Vector&&ee.names){let se=this.items[this.names.indexOf("*")];for(let le=0;le<ee.names.length;le++)ee.names[le]&&!this.namesLC.includes(ee.namesLC[le])&&(ne?this.items.push(re(ee.items[le],se)):this.items.push(re(se,ee.items[le])),this.names.push(ee.names[le]),this.namesLC.push(ee.namesLC[le]))}return this}collapseDimensions(ee){if(ee instanceof Vector){if(this.depth()===ee.depth())return this;{let re=[],ne=this,ie=ee;for(let se=0;se<this.depth();se++)ie instanceof Vector?ne.namesLC===void 0&&ie.namesLC===void 0||ne.namesLC!==void 0&&ie.namesLC!==void 0&&keysMatch(ne.namesLC,ie.namesLC)?(re.push("*"),ne=ne.items[0],ie=ie.items[0]):(re.push(le=>this.simulate.varBank.sum(le[0].items)),ne=ne.items[0]):(re.push(le=>this.simulate.varBank.sum(le[0].items)),ne=ne.items[0]);if(ie.items)throw new ModelError("Keys do not match for vector collapsing.",{code:2003});return selectFromMatrix(this,this.simulate,re)}}else return this.simulate.varBank.sum([this.simulate.varBank.flatten([this])])}depth(){if(!this.items.length)return 1;let ee=this.items[0];return ee instanceof Vector?ee.depth()+1:1}keysMatch(ee){return this.names?keysMatch(this.namesLC,ee):!1}cloneApply(ee){return this.fullClone().apply(ee)}apply(ee){for(let re=0;re<this.items.length;re++)this.items[re]=ee(this.items[re],this.names?this.names[re]:void 0);return this}stackApply(ee){return this.depth()===1?ee(this):this.stack().recurseApply(ee)}stack(ee){let re=[];ee=ee||[0];let ne=this.select(ee);for(let ie=1;ie<this.items.length;ie++){ee[0]=ie;let se=this.select(ee);if(ne instanceof Vector&&se instanceof Vector){if(ne.names&&!se.names||se.names&&!ne.names)throw new ModelError("Mismatched keys for vector collapsing.",{code:2004});if(ne.items.length!==se.items.length)throw new ModelError("Vectors of unequal size.",{code:2005})}else if(!(ne instanceof Vector||se instanceof Vector))throw new ModelError("Mismatched keys for vector collapsing.",{code:2006})}ee[0]=0,ee.push(0);for(let ie=0;ie<ne.items.length;ie++)if(ee[ee.length-1]=ne.names?ne.namesLC[ie]:ie,ne.items[ie]instanceof Vector)re.push(this.stack(ee.slice()));else{let se=[];for(let ue=0;ue<this.items.length;ue++){let ae=ee.slice();ae[0]=ue;let oe=this.select(ae);if(oe instanceof Vector)throw new ModelError("Number where vector expected in vector collapsing.",{code:2007});se.push(oe)}let le=new Vector(se,this.simulate);le.terminateApply=!0,re.push(le)}return new Vector(re,this.simulate,ne.names?ne.names.slice():void 0)}select(ee){let re=this;for(let ne=0;ne<ee.length;ne++){if(!(re instanceof Vector))throw new ModelError("Number where vector expected in vector collapsing.",{code:2008});if(ee[ne]instanceof String||typeof ee[ne]=="string"){let ie=re.namesLC.indexOf(ee[ne].valueOf());if(ie===-1)throw new ModelError("Mismatched keys for vector collapsing.",{code:2009});re=re.items[ie]}else re=re.items[ee[ne]]}return re}recurseApply(ee){for(let re=0;re<this.items.length;re++){let ne=this.items[re];ne instanceof Vector&&!ne.terminateApply?this.items[re]=ne.recurseApply(ee):this.items[re]=ee(this.items[re])}return this}fullNames(){let ee=this.items[0];if(ee instanceof Vector&&ee.names){let re=ee.fullNames(),ne=[];for(let ie=0;ie<this.names.length;ie++)for(let se=0;se<re.length;se++)ne.push([this.names[ie]].concat(re[se]));return ne}else return this.names.map(re=>[re])}clone(){let ee=[];for(let re of this.items)re instanceof Vector?ee.push(re.clone()):ee.push(re);return new Vector(ee,this.simulate,this.names?this.names.slice():void 0,this.parent)}fullClone(){let ee=[];for(let re of this.items)re instanceof Vector||re instanceof Material?ee.push(re.fullClone()):ee.push(re);return new Vector(ee,this.simulate,this.names?this.names.slice():void 0,this.parent)}equals(ee){if(this.length()!==ee.length())return!1;for(let re=0;re<this.items.length;re++)if(!strictEquals(this.items[re],ee.items[re]))return!1;return!0}}function stringify(te,ee){if(te instanceof Vector)return te.recurseApply(ne=>stringify(ne,ee));let re=new String(te);return re.parent=ee.varBank.stringbase,re}function selectFromMatrix(te,ee,re,ne){let ie=re.length;function se(oe){if(!(oe instanceof Vector)){if(re[0]==="*")throw oe instanceof Material?new ModelError("Can't use * selector on a number.",{code:3e3}):oe instanceof Boolean||typeof oe=="boolean"?new ModelError("Can't use * selector on an boolean.",{code:3001}):oe instanceof String||typeof oe=="string"?new ModelError("Can't use * selector on an string.",{code:3002}):new ModelError("Can't use * selector on an object.",{code:3003});oe.vector?oe=oe.vector:oe.parent&&(oe=new Vector([],ee,[],oe.parent))}return ne===void 0&&oe.fullClone&&(oe=oe.fullClone()),oe}let le=se(te),ue=selectFromVector(le,ee,re.shift(),re.length?void 0:ne,ne!==void 0),ae=[];if(ue.collapsed)ae=[ue.data];else{if(!ue.data.items)throw new ModelError(`No element available for selector ${ie-re.length+1}`,{code:3004});ae=ue.data.items}for(;re.length;){let oe=[],ce=re.shift();for(let he=0;he<ae.length;he++){if(!(ae[he]instanceof Vector))throw new ModelError(`No element available for selector ${ie-re.length}`,{code:3005});let pe=selectFromVector(ae[he],ee,ce,re.length?void 0:ne);pe.collapsed?(ne||(ae[he].items=[pe.data],ae[he].names=["!!BREAKOUT DATA"]),oe=oe.concat(pe.data)):(oe=oe.concat(pe.data.items),ne||(ae[he].items=pe.data.items,ae[he].names=pe.data.names))}ae=oe}return doBreakouts(ue.data)}function doBreakouts(te){if(!(te instanceof Vector))return te;if(te.items.length===1&&te.names&&te.names[0]==="!!BREAKOUT DATA")return doBreakouts(te.items[0]);for(let ee=0;ee<te.items.length;ee++)te.items[ee]=doBreakouts(te.items[ee]);return te}function selectFromVector(te,ee,re,ne,ie){if(re==="*")return{data:te};if(typeof re=="function")return{data:re([te]),collapsed:!0};if(re==="parent"){if(te.parent)return{data:ie?te.parent:te.parent.fullClone(),collapsed:!0};throw new ModelError("Vector does not have a parent.",{code:3006})}if(re instanceof Vector){let se=[],le=te.names?[]:void 0;for(let ue=0;ue<re.items.length;ue++){let ae=re.items[ue],oe=!0;if(typeof ae=="boolean"&&(ae?ae=new Material(ue+1):oe=!1),oe){let ce=selectElementFromVector(te,ae,ne);se.push(ce.value),le&&le.push(ce.name)}}return{collapsed:!1,parent:te,data:new Vector(se,ee,le,te.parent)}}else return{collapsed:!0,parent:te,data:selectElementFromVector(te,re,ne).value}}function selectElementFromVector(te,ee,re){let ne,ie,se;if(typeof ee=="string"||ee instanceof String)try{if(re===void 0&&!te.names){if(te.parent)return selectElementFromVector(te.parent,ee,re);throw new ModelError(`Key '${ee}' not in vector.`,{code:3007})}if(te.names){se=-1;let le=ee.toLowerCase();for(let ue=0;ue<te.names.length;ue++)if(te.names[ue]&&te.names[ue].toLowerCase()===le){se=ue;break}se<0&&(se=te.names.indexOf("*"))}if(se<0||se===void 0)if(re===void 0){if(te.parent)return selectElementFromVector(te.parent,ee,re);throw new ModelError(`Key '${ee}' not in vector.`,{code:3008})}else se=ee}catch(le){if(te.parent)return selectElementFromVector(te.parent,ee,re);throw le}else se=parseFloat(toNum(ee))-1;if(se instanceof String||typeof se=="string"){if(!te.names){te.names=[];for(let le=0;le<te.items.length;le++)te.names.push(void 0)}te.items.push(re),te.names.push(se.valueOf()),ie=re,ne=se}else{if(se<0||!te.items||se>=te.items.length||se%1!==0)throw new ModelError("Index "+(1+se)+" is not in the vector.",{code:3009});re!==void 0&&(te.items[se]=re),ie=te.items[se],te.names&&(ne=te.names[se])}return{name:ne,value:ie}}function strictEquals(te,ee){if(te instanceof SAgent||ee instanceof SAgent){if(te instanceof SAgent&&ee instanceof SAgent&&te.instanceId===ee.instanceId)return!0}else if(te instanceof Vector||ee instanceof Vector){if(te instanceof Vector&&ee instanceof Vector&&te.equals(ee))return!0}else if(eq(te,ee))return!0;return!1}class SPrimitive{constructor(ee){this.id=null,this.agentId=null,this.index=null,this.instanceId=null,this.container=null,this.constructorFunction=null,this.dna=null,this.DNAs=null,this.equation=null,this.cachedValue=void 0,this.pastValues=[],this.pastData=new DataBank,this.frozen=!1,this.simulate=ee,this.neighborProxyPrimitive=null,this.parent=ee.varBank.primitivebase}orig(){return this.neighborProxyPrimitive||this}clone(){let ee=new this.constructorFunction(this.simulate);return ee.dna=this.dna,ee.container=this.container,ee.agentId=this.agentId,ee.index=this.index,ee.id=this.id,ee.createIds(),ee.pastValues=this.pastValues.slice(),ee.neighborProxyPrimitive=this.neighborProxyPrimitive,this.dna.slider&&(this.simulate.sliders[this.dna.id]?this.simulate.sliders[this.dna.id].push(ee):this.simulate.sliders[this.dna.id]=[ee]),ee.cachedValue=this.cachedValue?this.cachedValue.fullClone():this.cachedValue,this.innerClone(ee),ee}innerClone(ee){}clearCached(){this.cachedValue=void 0}storeValue(){this.cachedValue===void 0&&this.value(),this.pastValues.push(this.cachedValue)}toNum(){let ee=this.value();return typeof ee=="string"?stringify(ee,this.simulate):ee}calculateValue(){throw new ModelError(`<i>[${toHTML(this.dna.name)}]</i> does not have a value and can not be used as a value in an equation.`,{code:1080})}createIds(){this.instanceId=this.simulate.getID(this.agentId+"-"+this.index)}getPastValues(ee){let re=this.pastValues.slice(),ne=Math.ceil(div(this.simulate.time(),this.dna.solver.userTimeStep).value)+1;re.length<ne&&re.push(this.value());let ie;if(ee===void 0)ie=re.map(se=>se.fullClone());else{let se=Math.ceil(div(ee.forceUnits(this.simulate.timeUnits),this.dna.solver.userTimeStep).value);ie=[];for(let le=Math.max(0,re.length-1-se);le<re.length;le++)ie.push(re[le].fullClone())}return ie}pastValue(ee,re=null){let ne;if(this.pastValues.length-1<Math.round((this.simulate.time().value-this.simulate.timeStart.value)/this.dna.solver.userTimeStep.value)?ne=div(ee.forceUnits(this.simulate.timeUnits),this.dna.solver.userTimeStep).value:ne=div(ee.forceUnits(this.simulate.timeUnits),this.dna.solver.userTimeStep).value+1,ne===0)return this.value();if(Math.ceil(ne)>this.pastValues.length)return re===null?this.pastValues.length>0?this.pastValues[0].fullClone():this.value():re;if(ne===Math.round(ne))return this.pastValues[this.pastValues.length-ne].fullClone();let ie=ne-Math.floor(ne),se=Math.floor(ne),le,ue;return se===0?le=this.value():le=this.pastValues[this.pastValues.length-se],ue=this.pastValues[this.pastValues.length-1-se],plus(mult(le,new Material(1-ie)),mult(ue,new Material(ie)))}testUnits(ee,re){if(ee instanceof Vector){ee.recurseApply(ne=>(this.testUnits(ne,re),ne));return}if(this.dna.adoptUnits&&(ee.units||(ee.units=this.simulate.unitManager.getUnitStore([],[],!1,!0)),this.dna.units=ee.units,this.dna.flowUnitless=!1),!this.dna.units&&ee.units&&!ee.units.isUnitless())throw new ModelError(`Wrong units generated for <i>[${toHTML(this.dna.name)}]</i>. Expected no units and got <i>${ee.units.toString()}</i>. Either specify units for the primitive or adjust the equation.`,{primitive:this.orig(),showEditor:!0,code:1081});if(this.dna.units!==ee.units){if(typeof ee=="boolean"||typeof ee=="string"||ee instanceof String||ee instanceof Boolean){if(!this.dna.units)return;throw new ModelError(`Cannot add units to a String or Boolean in <i>[${toHTML(this.dna.name)}]</i>.`,{primitive:this.orig(),showEditor:!0,code:1082})}let ne=convertUnits(ee.units,this.dna.units,!0);if(ne===0)throw new ModelError(`Wrong units generated for <i>[${toHTML(this.dna.name)}]</i>. Expected <i>${this.dna.units?this.dna.units.toString():"unitless"}</i>, and got <i>${ee.units?ee.units.toString():"unitless"}</i>.`,{primitive:this.orig(),showEditor:!0,code:1083});ee.value=ee.value*ne,ee.units=this.dna.units}if(this instanceof SFlow&&re!==!0&&this.dna.flowUnitless){let ne=mult(ee,new Material(1,this.simulate.timeUnits));ee.value=ne.value,ee.units=ne.units}}setValue(ee){throw new ModelError("You cannot set the value for that primitive.",{code:1084})}value(){if(this.cachedValue===void 0&&this.frozen&&this.pastValues.length>0){let ee=this.pastValues[this.pastValues.length-1];ee.fullClone?this.cachedValue=ee.fullClone():this.cachedValue=ee}if(this.cachedValue===void 0){if(this.simulate.valuedPrimitives.includes(this))throw new ModelError(`Circular equation loop identified including the primitives: ${toHTML(this.simulate.valuedPrimitives.slice(this.simulate.valuedPrimitives.indexOf(this)).map(re=>re.dna.name).join(", "))}`,{primitive:this.orig(),showEditor:!0,code:1085});this.simulate.valuedPrimitives.push(this);let ee;try{if(ee=toNum(this.calculateValue()),ee instanceof Material&&!isFinite(ee.value))throw this instanceof SStock?new ModelError("The stock has become infinite in size. Check the flows into it for rapid growth.",{primitive:this.orig(),showEditor:!0,code:1086}):new ModelError("The result of this calculation is not finite (are you dividing by 0?).",{primitive:this.orig(),showEditor:!0,code:1087})}catch(re){throw re instanceof ModelError?re.primitive&&re.showEditor?re:new ModelError(re.message,{primitive:this.orig(),showEditor:!0,code:1088}):re}this instanceof SState||(this.testUnits(ee),this.testConstraints(ee)),this.cachedValue=ee}return this.cachedValue.fullClone?this.cachedValue.fullClone():this.cachedValue}testConstraints(ee){let re=ne=>(this.dna.useMaxConstraint&&ne.value>this.dna.maxConstraint&&constraintAlert(this,"max",ne,this.simulate),this.dna.useMinConstraint&&ne.value<this.dna.minConstraint&&constraintAlert(this,"min",ne,this.simulate),ne);ee instanceof Vector?ee.recurseApply(re):re(ee)}setEquation(ee,re){(this instanceof SFlow||this instanceof STransition)&&(this.omega!==null&&(re.omega=this.omega),this.alpha!==null&&(re.alpha=this.alpha));try{this.equation=trimTree(ee,re,this.simulate)}catch(ne){throw ne instanceof ModelError?ne.primitive&&ne.showEditor?ne:new ModelError(ne.message,{primitive:this.orig(),showEditor:!0,code:1089}):ne}}}class Placeholder extends SPrimitive{constructor(ee,re,ne){super(ne),this.dna=ee,this.id=ee.id,this.primitive=re}calculateValue(){throw new ModelError(`<i>[${toHTML(this.dna.name)}]</i> is a placeholder and cannot be used as a direct value in equations.`,{primitive:this.primitive.dna.primitive,showEditor:!0,code:1091})}}class SState extends SPrimitive{constructor(ee){super(ee),this.active=null,this.downStreamTransitions=[],this.constructorFunction=SState}innerClone(ee){ee.setValue(this.active)}setValue(ee){this.setActive(trueValue(ee)),this.cachedValue=void 0,this.simulate.valuedPrimitives=[],this.value(),this.agentId&&this.container.updateStates()}calculateValue(){return this.active===null&&this.setInitialActive(!0),this.active?new Material(1):new Material(0)}setInitialActive(ee){let re;try{re=toNum(evaluateTree(this.equation,globalVars(this,this.simulate),this.simulate))}catch(ne){throw ne instanceof ModelError?ne.primitive&&ne.showEditor?ne:new ModelError(ne.message,{primitive:this.orig(),showEditor:!0,code:1092}):ne}this.setActive(trueValue(re),ee),this.agentId&&this.container.updateStates()}setActive(ee,re){if(this.active=ee,!ee||this.dna.residency===null){if(!re){if(ee){if(this.simulate.transitionPrimitives||(this.simulate.transitionPrimitives=[]),this.simulate.transitionPrimitives.length>1200&&this.simulate.transitionPrimitives.includes(this))throw new ModelError(`Circular fully active transition loop identified including the states: ${toHTML(this.simulate.transitionPrimitives.slice(0,5).map(ne=>"["+ne.dna.name+"]").join(", "))}`,{code:1105});this.simulate.transitionPrimitives.push(this)}for(let ne of this.downStreamTransitions)scheduleTrigger.call(ne);ee&&(this.simulate.transitionPrimitives=[])}}else this.simulate.tasks.add(new Task({name:"State Residency",time:plus(this.simulate.time(),this.dna.residency),priority:5,expires:1,action:ne=>{for(let ie of this.downStreamTransitions)scheduleTrigger.call(ie)}}))}getActive(){return this.active===null&&this.setInitialActive(!0),this.active}}class STransition extends SPrimitive{constructor(ee){super(ee),this.alpha=null,this.omega=null,this.scheduledTrigger=null,this.initialized=!1,this.constructorFunction=STransition}innerClone(){}setEnds(ee,re){this.alpha=ee,this.omega=re,ee&&ee.downStreamTransitions.push(this)}canTrigger(){return!this.alpha||this.alpha&&this.alpha.getActive()||this.dna.repeat&&this.dna.trigger!=="Condition"}trigger(){this.scheduledTrigger=null,!this.frozen&&(this.alpha&&this.alpha.setActive(!1),this.omega&&this.omega.setActive(!0),this.agentId&&this.container.updateStates(),this.dna.repeat&&this.dna.trigger!=="Condition"&&scheduleTrigger.call(this))}}function scheduleTrigger(){updateTrigger.call(this,!0)}function clearTrigger(te){this.scheduledTrigger&&(te||!this.dna.repeat)&&(this.scheduledTrigger.kill(),this.scheduledTrigger=null)}function updateTrigger(te){if(this.initialized=!0,te&&clearTrigger.call(this),this.canTrigger()){let ee;try{ee=toNum(evaluateTree(this.equation,globalVars(this,this.simulate),this.simulate))}catch(re){throw re instanceof ModelError?re.primitive&&re.showEditor?re:new ModelError(re.message,{primitive:this.orig(),showEditor:!1,code:1090}):re}try{if(this.dna.trigger==="Condition")trueValue(ee)&&this.trigger();else{if(!(ee instanceof Material))throw new ModelError(`The value of this trigger must evaluate to a number. Got <i>${toHTML(""+ee)}</i>.`,{primitive:this.orig(),showEditor:!0,code:1112});let re;if(this.dna.trigger==="Timeout"){if(!ee.units)verifyValuedType(ee,this),ee.units=this.simulate.timeUnits;else{ee.units.addBase();let ie=ee.units.baseUnits;if(ie.names.length!==1||ie.names[0]!=="seconds"||ie.exponents[0]!==1)throw new ModelError(`A trigger Timeout must have units of time, got <i>${ee.units.toString()}</i>.`,{primitive:this.orig(),showEditor:!0,code:1113})}if(this.scheduledTrigger&&eq(ee,this.scheduledTrigger.data.value))return;if(ee.value===0){if(this.dna.repeat)throw new ModelError("A trigger Timeout of 0 with 'Repeat' set to true results in an infinite loop.",{primitive:this.orig(),showEditor:!0,code:1114});this.trigger();return}if(ee.value<0)throw new ModelError("The timeout for a transition cannot be less than 0.",{primitive:this.orig(),showEditor:!0,code:1115});if(isNaN(ee.value))throw new ModelError("The timeout for the transition is not a valid number.",{primitive:this.orig(),showEditor:!0,code:1116});re=ee}else if(this.dna.trigger==="Probability"){if(ee.units&&!ee.units.isUnitless())throw new ModelError(`The probability for the trigger had units of <i>${ee.units.toString()}</i>. Probabilities must be unitless.`,{primitive:this.orig(),showEditor:!0,code:1121});if(isNaN(ee.value))throw new ModelError("The probability for the transition is not a valid number.",{primitive:this.orig(),showEditor:!0,code:1117});if(ee=ee.value,this.scheduledTrigger&&eq(ee,this.scheduledTrigger.data.value))return;if(ee===1){if(this.dna.repeat)throw new ModelError("A trigger probability of 1 with 'Repeat' as true results in an infinite loop.",{primitive:this.orig(),showEditor:!0,code:1118});this.trigger();return}else{if(ee>1)throw new ModelError("The probability for the trigger must be less than or equal to 1.",{primitive:this.orig(),showEditor:!0,code:1119});if(ee<0)throw new ModelError("The probability for the trigger must be greater than or equal to 0.",{primitive:this.orig(),showEditor:!0,code:1120});if(ee===0){if(!this.scheduledTrigger)return}else{let ie=-Math.log(1-ee);re=new Material(RandExp(this.simulate,ie),this.simulate.timeUnits)}}}let ne=this.simulate.time();if(this.scheduledTrigger){if(this.scheduledTrigger.kill(),this.dna.trigger==="Timeout")if(lessThanEq(re,minus(this.simulate.time(),this.scheduledTrigger.data.start))){this.scheduledTrigger=null,this.trigger();return}else ne=this.scheduledTrigger.data.start,re=minus(re,minus(this.simulate.time(),ne)),this.scheduledTrigger=null;else if(this.dna.trigger==="Probability"){if(ee===0){this.scheduledTrigger=null;return}re=minus(this.scheduledTrigger.time,this.simulate.time());let ie=this.scheduledTrigger.data.value;if(ie!==ee){let se=-Math.log(1-ie),le=-Math.log(1-ee);re=mult(re,new Material(se/le))}ne=this.scheduledTrigger.data.start,this.scheduledTrigger=null}}re=plus(re,this.simulate.time()),this.scheduledTrigger=new Task({name:"Trigger",time:re,priority:5,expires:1,action:ie=>{this.trigger()},data:{start:ne,value:ee}}),this.simulate.tasks.add(this.scheduledTrigger)}}catch(re){throw re instanceof ModelError?re.primitive&&re.showEditor?re:new ModelError(re.message,{primitive:this.orig(),showEditor:!0,code:1094}):re}}}class SAction extends SPrimitive{constructor(ee){super(ee),this.action=null,this.scheduledTrigger=null,this.block=!1,this.initialized=!1,this.constructorFunction=SAction}innerClone(){}canTrigger(){return!this.block}resetTimer(){scheduleTrigger.call(this)}trigger(){if(this.scheduledTrigger=null,!this.frozen)try{evaluateTree(this.action,globalVars(this,this.simulate),this.simulate),this.dna.repeat?this.dna.trigger!=="Condition"&&scheduleTrigger.call(this):this.block=!0}catch(ee){throw ee instanceof ModelError?ee.primitive&&ee.showEditor?ee:new ModelError(ee.message,{primitive:this.orig(),showEditor:!0,code:1096}):ee}}}class SPopulation extends SPrimitive{constructor(ee){super(ee),this.size=null,this.agents=null,this.geoWidth=null,this.geoHeight=null,this.halfWidth=null,this.halfHeight=null,this.geoDimUnits=null,this.geoDimUnitsObject=null,this.geoWrap=null,this.DNAs=null,this.stateIds=new Set,this.placement=void 0,this.placementFunction=void 0,this.network=void 0,this.networkFunction=void 0,this.agentBase=void 0,this.constructorFunction=SPopulation,this.vector=new Vector([],ee,[],ee.varBank.primitivebase)}collectData(){let ee=[];for(let re of this.agents)ee.push({instanceId:re.instanceId,connected:re.connected.map(ne=>ne.instanceId),location:simpleNum(re.location.clone(),this.geoDimUnitsObject,this.simulate),state:re.states.length>0?re.states.slice():null});return ee}states(){return this.stateIds}toNum(){throw new ModelError(`<i>[${toHTML(this.dna.name)}]</i> is a population of agents and cannot be used as a direct value in equations.`,{code:1107})}add(ee){this.size=1+this.size;let re;if(ee){re=ee.agentClone(),re.agentId=this.agentId,re.setIndex(this.size-1),re.createAgentIds();for(let ne=0;ne<this.DNAs.length;ne++){let ie=re.children[ne],se=this.DNAs[ne];ie.container=re,linkPrimitive(ie,se,this.simulate)}re.updateStates()}else{re=new SAgent(this.simulate),re.container=this,re.children=[],re.childrenId={},re.agentId=this.agentId;for(let ie of this.DNAs)decodeDNA(ie,re,this.simulate);re.setIndex(this.size-1),re.createAgentIds();for(let ie=0;ie<this.DNAs.length;ie++)linkPrimitive(re.children[ie],this.DNAs[ie],this.simulate);setAgentInitialValues(re);let ne=getPrimitiveNeighborhood(this,this.dna,this.simulate,[]);if(this.placement==="Custom Function"?(ne.self=re,re.location=simpleUnitsTest(simpleEquation(this.placementFunction,this.simulate,{"-parent":this.simulate.varBank,self:re},ne),this.geoDimUnitsObject,this.simulate,null,null,"Agent placement functions must return a two element vector"),validateAgentLocation(re.location,this),re.location.names||(re.location.names=["x","y"],re.location.namesLC=["x","y"])):re.location=new Vector([mult(this.geoWidth,new Material(Rand(this.simulate))),mult(this.geoHeight,new Material(Rand(this.simulate)))],this.simulate,["x","y"]),this.network==="Custom Function"){let ie=trimTree(createTree(this.networkFunction),ne,this.simulate);for(let se of this.agents)re!==se&&trueValue(simpleEquation(this.networkFunction,this.simulate,{"-parent":this.simulate.varBank,a:re,b:se},ne,ie))&&re.connect(se)}}return this.simulate.tasks.add(new Task({priority:10,expires:1,name:"Add Agent",time:this.simulate.time(),action:ne=>{this.agents.push(re);for(let ie=0;ie<re.children.length;ie++){let se=re.children[ie],le=this.DNAs[ie];(se instanceof SAction||se instanceof STransition)&&le.trigger!=="Condition"&&scheduleTrigger.call(se),ee&&(se instanceof SAction?le.solver.actions.push(se):se instanceof STransition?le.solver.transitions.push(se):se instanceof SPopulation||(le.solver.valued.push(se),se instanceof SFlow?le.solver.flows.push(se):se instanceof SStock?le.solver.stocks.push(se):se instanceof SState&&le.solver.states.push(se)))}}})),re}}class SAgent{constructor(ee){this.agentId=null,this.instanceId=null,this.index=null,this.children=null,this.location=null,this.connected=[],this.connectedWeights=[],this.dead=!1,this.constructorFunction=SAgent,this.stateIDs=new Set,this.states=[],this.container=void 0,this.dna=void 0,this.childrenId=void 0,this.simulate=ee,this.vector=new Vector([],ee,[],ee.varBank.agentbase)}createIds(){this.instanceId=this.simulate.getID(this.agentId+"-"+this.index)}toString(){return"Agent "+(this.index+1)}toNum(){return this}updateStates(){this.states=[],this.stateIDs=new Set;for(let ee of this.children)ee instanceof SState&&ee.active&&(this.states.push(ee),this.stateIDs.add(ee.dna.id))}agentClone(){let ee=new SAgent(this.simulate);ee.dna=this.dna,ee.children=[],ee.childrenId={};for(let re of this.children)ee.children.push(re.clone()),ee.childrenId[re.dna.id]=re;return ee.location=this.location.clone(),ee.connected=this.connected.slice(),ee.connectedWeights=this.connectedWeights.slice(),ee.container=this.container,ee}setIndex(ee){this.index=ee;for(let re of this.children)re.index=ee}createAgentIds(){this.createIds();for(let ee of this.children)ee.createIds()}die(){for(;this.connected.length>0;)this.unconnect(this.connected[0]);for(let ee=0;ee<this.container.agents.length;ee++)if(this.container.agents[ee]===this){this.container.agents.splice(ee,1);break}for(let ee of this.children){let re=ee.dna.solver;ee instanceof SAction?(re.actions.splice(re.actions.indexOf(ee),1),clearTrigger.call(ee,!0)):ee instanceof STransition?(re.transitions.splice(re.transitions.indexOf(ee),1),clearTrigger.call(ee,!0)):ee instanceof SPopulation||(re.valued.splice(re.valued.indexOf(ee),1),ee instanceof SFlow?re.flows.splice(re.flows.indexOf(ee),1):ee instanceof SStock?re.stocks.splice(re.stocks.indexOf(ee),1):ee instanceof SState&&re.states.splice(re.states.indexOf(ee),1))}this.dead=!0}connect(ee,re){let ne=re===void 0?new Material(1):re;if(ee!==this)if(this.connected.includes(ee))re!==void 0&&(this.connectedWeights[this.connected.indexOf(ee)]=re,ee.connectedWeights[ee.connected.indexOf(ee)]=re);else if(ee instanceof SAgent)this.connected.push(ee),this.connectedWeights.push(ne),ee.connected.push(this),ee.connectedWeights.push(ne);else throw new ModelError("Only agents may be connected.",{code:1106})}unconnect(ee){if(ee!==this){let re=this.connected.indexOf(ee);re!==-1&&(this.connected.splice(re,1),this.connectedWeights.splice(re,1),re=ee.connected.indexOf(this),ee.connected.splice(re,1),ee.connectedWeights.splice(re,1))}}connectionWeight(ee){if(ee!==this){let re=this.connected.indexOf(ee);if(re!==-1)return this.connectedWeights[re].fullClone()}throw new ModelError("Agents are not connected and so do not have a connection weight.",{code:1108})}setConnectionWeight(ee,re){if(ee!==this){let ne=this.connected.indexOf(ee);if(ne!==-1){this.connectedWeights[ne]=re.fullClone();return}}throw new ModelError("Agents are not connected and so do not have a connection weight.",{code:1109})}}function verifyValuedType(te,ee){if(!(te instanceof Vector||te instanceof Material))throw new ModelError(`This value may only be numbers or vectors, found a ${typeof te}.`,{primitive:ee,showEditor:!1,code:1110})}class SStock extends SPrimitive{constructor(ee){super(ee),this.level=null,this.constructorFunction=SStock,this.delay=void 0,this.tasks=[],this.initRate=null,this.oldLevel=null}innerClone(ee){ee.level=this.level,ee.oldLevel=this.oldLevel,ee.tasks=this.tasks,ee.delay=this.delay}setValue(ee){this.level=ee,this.cachedValue=void 0,this.simulate.valuedPrimitives=[],this.value()}preserveLevel(){for(let ee=this.tasks.length-1;ee>=0;ee--)this.tasks[ee].data.tentative=!1;this.oldLevel=this.level}restoreLevel(){for(let ee=this.tasks.length-1;ee>=0;ee--)this.tasks[ee].data.tentative&&(this.tasks[ee].remove(),this.tasks.splice(ee,1));this.level=this.oldLevel}setDelay(ee){var re;ee=ee||this.dna.delay,this.delay=ee,((re=this.delay)==null?void 0:re.value)===0&&(this.delay=void 0)}setInitialValue(){let ee;try{ee=toNum(evaluateTree(this.equation,globalVars(this,this.simulate),this.simulate))}catch(re){throw re instanceof ModelError?re.primitive&&re.showEditor?re:new ModelError(re.message,{primitive:this.orig(),showEditor:!0,code:1098}):re}if(typeof ee=="boolean"&&(ee?ee=new Material(1):ee=new Material(0)),ee instanceof Vector){let re=this.dna;ee.recurseApply(ne=>(verifyValuedType(ne),re.nonNegative&&ne.value<0&&(ne=new Material(0,re.units)),ne.units||(ne.units=re.units),ne))}else verifyValuedType(ee),this.dna.nonNegative&&ee.value<0&&(ee=new Material(0,this.dna.units)),ee.units||(ee.units=this.dna.units);if(this.delay===void 0||lessThanEq(this.delay,this.simulate.timeStep.fullClone()))this.level=ee;else{this.initRate=div(ee,this.delay.forceUnits(this.simulate.timeUnits));let re=mult(this.initRate,this.simulate.userTimeStep.fullClone());this.level=re,this.simulate.tasks.addEvent((ne,ie,se)=>{if(ne.value>0){let le=minus(this.delay,this.simulate.userTimeStep),ue=[minus(ie,this.simulate.timeStart),minus(se,this.simulate.timeStart)];if(lessThan(le,ue[0]))return;let ae=minus(this.simulate.varBank.min([le,ue[1]]),ue[0]);this.level=plus(this.level,mult(ae,this.initRate))}})}}subtract(ee){if(this.level=minus(this.level,ee),this.dna.nonNegative)if(this.level instanceof Vector){let re=this.dna;this.level.recurseApply(ne=>ne.value<0?new Material(0,re.units):ne)}else this.level.value<0&&(this.level=new Material(0,this.dna.units))}add(ee,re){let ne;if(this.delay!==void 0&&(ne=new Material(Big(re.value).plus(this.delay.forceUnits(re.units).value).toNumber(),re.units)),this.delay===void 0||lessThanEq(ne,this.simulate.time())){if(this.level=plus(this.level,ee),this.dna.nonNegative)if(this.level instanceof Vector){let ie=this.dna;this.level.recurseApply(se=>se.value<0?new Material(0,ie.units):se)}else this.level.value<0&&(this.level=new Material(0,this.dna.units))}else this.scheduleAdd(ee,ne)}scheduleAdd(ee,re){let ne,ie=new Task({time:re,data:{amnt:ee,tentative:!0},priority:-100,name:"Conveyor Add ("+this.dna.name+")",action:se=>{if(ne=this.level,this.level=plus(this.level,ee),this.dna.nonNegative)if(this.level instanceof Vector){let le=this.dna;this.level.recurseApply(ue=>ue.value<0?new Material(0,le.units):ue)}else this.level.value<0&&(this.level=new Material(0,this.dna.units))},rollback:()=>{this.level=ne}});this.tasks.push(ie),this.simulate.tasks.add(ie)}totalContents(){if(this.level===null&&this.setInitialValue(),this.delay!==void 0){let ee=this.level,re=this.simulate.time();for(let ie=this.tasks.length-1;ie>=0&&greaterThan(this.tasks[ie].time,re);ie--)ee=plus(ee,this.tasks[ie].data.amnt);let ne=plus(this.simulate.timeProgressed(),this.simulate.userTimeStep);if(greaterThan(this.delay,ne)){let ie=minus(this.delay,ne);ee=plus(ee,mult(this.initRate,ie))}return ee}else return this.level}calculateValue(){if(this.level===null&&this.setInitialValue(),this.delay!==void 0&&this.dna.solver.RKOrder===4){let ee=this.level;for(let re=0;re<this.tasks.length;re++)greaterThan(this.tasks[re].time,this.simulate.time())&&lessThanEq(this.tasks[re].time,plus(this.simulate.time(),this.dna.solver.timeStep))&&(ee=plus(ee,this.tasks[re].data.amnt));return ee}else return this.level}}class SConverter extends SPrimitive{constructor(ee){super(ee),this.source=null,this.constructorFunction=SConverter}innerClone(){}setSource(ee){this.source=ee}getInputValue(){if(this.source==="*time")return this.simulate.time();if(this.source instanceof SPrimitive){let ee=toNum(this.source.value());if(!ee)throw new ModelError("Undefined input value.",{primitive:this.orig(),showEditor:!1,code:1199});if(ee instanceof Vector)throw new ModelError("Converters do not accept vectors as input values.",{primitive:this.orig(),showEditor:!1,code:1200});return ee}else throw console.error("Invalid source",this.source),new Error("Invalid source")}calculateValue(){return new Material(this.getOutputValue().value,this.dna.units)}getOutputValue(){let ee=this.getInputValue();if(!this.dna.inputs.length)return new Material(0);for(let re=0;re<this.dna.inputs.length;re++)if(this.dna.interpolation==="discrete"){if(greaterThan(this.dna.inputs[re],ee))return re===0?this.dna.outputs[0]:this.dna.outputs[re-1]}else if(this.dna.interpolation==="linear"){if(eq(this.dna.inputs[re],ee))return this.dna.outputs[re];if(greaterThan(this.dna.inputs[re],ee))return re===0?this.dna.outputs[0]:div(plus(mult(minus(ee,this.dna.inputs[re-1]),this.dna.outputs[re]),mult(minus(this.dna.inputs[re],ee),this.dna.outputs[re-1])),minus(this.dna.inputs[re],this.dna.inputs[re-1]))}return this.dna.outputs[this.dna.outputs.length-1]}}class SVariable extends SPrimitive{constructor(ee){super(ee),this.constructorFunction=SVariable}innerClone(){}calculateValue(){let ee=evaluateTree(this.equation,globalVars(this,this.simulate),this.simulate);if(typeof ee=="boolean")ee?ee=new Material(1):ee=new Material(0);else{if(ee instanceof Vector)return ee;if(typeof ee=="string")return ee}return ee.units||(ee.units=this.dna.units),ee}}class SFlow extends SPrimitive{constructor(ee){super(ee),this.alpha=null,this.omega=null,this.rate=null,this.blendedRate=null,this.RKPrimary=[],this.constructorFunction=SFlow}innerClone(){}setEnds(ee,re){this.alpha=ee,this.omega=re}calculateValue(){return this.predict(),this.rate.fullClone()}clean(){this.rate=null,this.blendedRate=null,this.RKPrimary=[]}doRK4Aggregation(){this.blendedRate=div(plus(plus(plus(this.RKPrimary[0],mult(new Material(2),this.RKPrimary[1])),mult(new Material(2),this.RKPrimary[2])),this.RKPrimary[3]),new Material(6)),this.blendedRate=this.checkRate(this.blendedRate)}checkRate(ee){let re=div(ee,this.dna.adoptUnits?new Material(this.dna.solver.timeStep.value):this.dna.solver.timeStep.fullClone());return this.dna.nonNegative&&(re instanceof Vector?re.recurseApply(ne=>ne.value>=0?ne:new Material(0,ne.units)):re.value<=0&&(re=new Material(0,re.units))),re}predict(ee){if(this.rate===null||ee){let re;try{if(re=toNum(evaluateTree(this.equation,globalVars(this,this.simulate),this.simulate)),!(re instanceof Vector||isFinite(re.value)))throw verifyValuedType(re,this),new ModelError("The result of this calculation is not finite. Flows must have finite values. Are you dividing by 0?",{primitive:this.orig(),showEditor:!0,code:1111})}catch(ne){throw ne instanceof ModelError?ne.primitive&&ne.showEditor?ne:new ModelError(ne.message,{primitive:this.orig(),showEditor:!0,code:1100}):ne}if(typeof re=="boolean"&&(re?re=new Material(1):re=new Material(0)),this.rate=re.fullClone(),!this.dna.adoptUnits)if(this.rate instanceof Vector){let ne=this.dna;this.rate.recurseApply(ie=>(verifyValuedType(ie,this),ie.units||(ie.units=ne.units),ie))}else this.rate.units||(verifyValuedType(this.rate,this),this.rate.units=this.dna.units);this.testUnits(this.rate,!0),this.rate=mult(this.rate,this.dna.adoptUnits?new Material(this.dna.solver.timeStep.value):this.dna.solver.timeStep.fullClone()),ee?this.RKPrimary.length>0?this.RKPrimary[this.RKPrimary.length-1]=this.rate:this.RKPrimary.push(this.rate):this.RKPrimary.push(this.rate),this.rate=this.checkRate(this.rate)}}apply(ee,re){try{if(this.rate===null&&this.blendedRate===null)return;let ne=this.blendedRate?this.blendedRate.fullClone():this.rate.fullClone();ne=mult(ne,this.dna.adoptUnits?new Material(ee.forceUnits(this.simulate.timeUnits).value):ee);let ie=ne,se=ne,le=!1;if(this.alpha!==null){let ae=this.alpha.level;if(ne instanceof Vector&&(!(ae instanceof Vector)||ae.depth()<ne.depth()))ie=ne.fullClone().collapseDimensions(ae),le=!0;else if(ae instanceof Vector&&(!(ne instanceof Vector)||ae.depth()>ne.depth()))throw new ModelError("The start of the flow is a vector with a higher order than the flow rate. There has to be at least one element in the flow rate for each element in the start.",{primitive:this.orig(),showEditor:!0,code:1201})}if(this.omega!==null){let ae=this.omega.level;if(ne instanceof Vector&&(!(ae instanceof Vector)||ae.depth()<ne.depth()))se=ne.fullClone().collapseDimensions(ae),le=!0;else if(ae instanceof Vector&&(!(ne instanceof Vector)||ae.depth()>ne.depth()))throw new ModelError("The end of the flow is a vector with a higher order than the flow rate. There has to be at least one element in the flow rate for each element in the end.",{primitive:this.orig(),showEditor:!0,code:1202})}if(le){if(this.alpha&&this.alpha.dna.nonNegative)throw new ModelError("Cannot use non-negative stocks when the flow rate is a vector that needs to be collapsed.",{primitive:this.alpha.dna.primitive,showEditor:!1,code:1207});if(this.omega&&this.omega.dna.nonNegative)throw new ModelError("Cannot use non-negative stocks when the flow rate is a vector that needs to be collapsed.",{primitive:this.omega.dna.primitive,showEditor:!1,code:1208})}else{if(this.omega!==null&&this.omega.dna.nonNegative){let ae;try{ae=plus(toNum(this.omega.level),ne)}catch{throw new ModelError(`Incompatible units for flow <i>[${toHTML(this.dna.name)}]</i> and connected stock <i>[${toHTML(this.omega.dna.name)}]</i>. Stock has units of <i>${this.omega.dna.units?this.omega.dna.units.toString():"unitless"}</i>. The flow should have the equivalent units divided by some time unit such as Years.`,{primitive:this.orig(),showEditor:!1,code:1203})}ae instanceof Vector?(ae.recurseApply(oe=>oe.value<0?oe:new Material(0,oe.units)),ne=minus(ne,ae)):ae.value<0&&(ne=negate(toNum(this.omega.level)))}if(this.alpha!==null&&this.alpha.dna.nonNegative){let ae;try{ae=minus(toNum(this.alpha.level),ne)}catch{throw new ModelError(`Incompatible units for flow <i>[${toHTML(this.dna.name)}]</i> and connected stock <i>[${toHTML(this.alpha.dna.name)}]</i>. Stock has units of <i>${this.alpha.dna.units?this.alpha.dna.units.toString():"unitless"}</i>. The flow should have the equivalent units divided by some time unit such as Years.`,{primitive:this.orig(),showEditor:!1,code:1204})}ae instanceof Vector?(ae.recurseApply(oe=>oe.value<0?oe:new Material(0,oe.units)),ne=minus(ne,ae),ne=minus(ne,ae)):ae.value<0&&(ne=toNum(this.alpha.level))}if(this.omega&&this.omega.dna.nonNegative)if(ne instanceof Vector){let ae=this.simulate.varBank.flatten([plus(toNum(this.omega.level),ne)]);for(let oe of ae.items)if(oe instanceof Material&&oe.value<0)throw new ModelError("Inconsistent non-negative constraints for flow.",{primitive:this.orig(),showEditor:!1,code:1205})}else{let ae=plus(toNum(this.omega.level),ne);if(ae instanceof Material&&ae.value<0)throw new ModelError("Inconsistent non-negative constraints for flow.",{primitive:this.orig(),showEditor:!1,code:1206})}}let ue=0;try{this.omega!==null&&(ue=1,le?this.omega.add(se,re):this.omega.add(ne,re)),this.alpha!==null&&(ue=2,le?this.alpha.subtract(ie):this.alpha.subtract(ne))}catch(ae){let oe;throw ue===1?oe=this.omega:ue===2&&(oe=this.alpha),ae.code===2e3?new ModelError(`Incompatible vector keys for flow <i>[${toHTML(this.dna.name)}]</i> and connected stock <i>[${toHTML(oe.dna.name)}]</i>.`,{primitive:this.orig(),showEditor:!1,code:1209}):new ModelError(`Incompatible units for flow <i>[${toHTML(this.dna.name)}]</i> and connected stock <i>[${toHTML(oe.dna.name)}]</i>. Stock has units of <i>${oe.dna.units?oe.dna.units.toString():"unitless"}</i>. The flow should have the equivalent units divided by some time unit such as Years.`,{primitive:this.orig(),showEditor:!1,code:1210})}}catch(ne){throw ne instanceof ModelError?ne.primitive&&ne.showEditor?ne:new ModelError(ne.message,{primitive:this.orig(),showEditor:!0,code:1102}):ne}}}function globalVars(te,ee){return te instanceof SAgent?{"-parent":ee.varBank,self:te}:te.container?{"-parent":ee.varBank,self:te.container}:ee.varBank}function constraintAlert(te,ee,re,ne){let ie="The "+(ee==="max"?"maximum":"minimum")+" constraint on the primitive [<i>"+toHTML(ne.model.getId(te.id).name)+"</i>] has been violated. The primitive's value attempted to become "+toHTML(""+re.value)+" when the "+(ee==="max"?"maximum":"minimum")+" allowed value is "+(ee==="max"?te.dna.maxConstraint:te.dna.minConstraint)+".";throw new ModelError(ie,{primitive:te.dna.primitive,showEditor:!1,code:1150})}function createFunctions$1(te){let ee={},re={};defineFunction(te,"Stop",{params:[]},()=>{throw te.config.showNotification&&te.config.showNotification("Simulation ended early by a call to stop()."),{simulationCommand:"STOP"}}),defineFunction(te,"Pause",{params:[]},()=>(te.sleep(!0),new Material(0))),defineFunction(te,"Time",{params:[]},()=>te.time().fullClone()),defineFunction(te,"TimeStep",{params:[]},()=>te.timeStep.fullClone()),defineFunction(te,"TimeLength",{params:[]},()=>te.timeLength.fullClone()),defineFunction(te,"TimeStart",{params:[]},()=>te.timeStart.fullClone()),defineFunction(te,"TimeEnd",{params:[]},()=>te.timeEnd.fullClone()),defineFunction(te,"Seconds",{params:[{name:"Value",defaultVal:"time",vectorize:!0}]},ie=>{let se;return ie.length?se=toNum(ie[0]):se=te.time().fullClone(),mult(se,new Material(1,te.unitManager.getUnitStore(["seconds"],[-1])))}),defineFunction(te,"Minutes",{params:[{name:"Value",defaultVal:"time",vectorize:!0}]},ie=>{let se;return ie.length?se=toNum(ie[0]):se=te.time().fullClone(),mult(se,new Material(1,te.unitManager.getUnitStore(["minutes"],[-1])))}),defineFunction(te,"Hours",{params:[{name:"Value",defaultVal:"time",vectorize:!0}]},ie=>{let se;return ie.length?se=toNum(ie[0]):se=te.time().fullClone(),mult(se,new Material(1,te.unitManager.getUnitStore(["hours"],[-1])))}),defineFunction(te,"Days",{params:[{name:"Value",defaultVal:"time",vectorize:!0}]},ie=>{let se;return ie.length?se=toNum(ie[0]):se=te.time().fullClone(),mult(se,new Material(1,te.unitManager.getUnitStore(["days"],[-1])))}),defineFunction(te,"Weeks",{params:[{name:"Value",defaultVal:"time",vectorize:!0}]},ie=>{let se;return ie.length?se=toNum(ie[0]):se=te.time().fullClone(),mult(se,new Material(1,te.unitManager.getUnitStore(["weeks"],[-1])))}),defineFunction(te,"Months",{params:[{name:"Value",defaultVal:"time",vectorize:!0}]},ie=>{let se;return ie.length?se=toNum(ie[0]):se=te.time().fullClone(),mult(se,new Material(1,te.unitManager.getUnitStore(["months"],[-1])))}),defineFunction(te,"Years",{params:[{name:"Value",defaultVal:"time",vectorize:!0}]},ie=>{let se;return ie.length?se=toNum(ie[0]):se=te.time().fullClone(),mult(se,new Material(1,te.unitManager.getUnitStore(["years"],[-1])))}),defineFunction(te,"Seasonal",{params:[{name:"Peak",defaultVal:"0",vectorize:!0}]},ie=>{let se;ie.length?(se=toNum(ie[0]).fullClone(),se.units||(se.units=te.timeUnits)):se=new Material(0,te.timeUnits);let ue=minus(te.varBank.time([]),se).forceUnits(createUnitStore("years",te)).value*2*3.14159265359;return new Material(Math.cos(ue))}),defineFunction(te,"Unitless",{params:[{name:"Value",noVector:!0}]},ie=>new Material(toNum(ie[0]).value)),defineFunction(te,"RemoveUnits",{params:[{name:"Value",noVector:!0},{name:"ExpectedUnits",needString:!0}]},ie=>{let se=toNum(ie[0]);return new Material(se.forceUnits(createUnitStore(ie[1],te)).value)}),defineFunction(te,"PastMean",{object:[te.varBank,re],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",vectorize:!0}]},ie=>ie.length===1?te.varBank.mean(ie[0].getPastValues()):te.varBank.mean(ie[0].getPastValues(toNum(ie[1])))),defineFunction(te,"PastMedian",{object:[te.varBank,re],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",vectorize:!0}]},ie=>ie.length===1?te.varBank.median(ie[0].getPastValues()):te.varBank.median(ie[0].getPastValues(toNum(ie[1])))),defineFunction(te,"PastValues",{object:[te.varBank,re],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",vectorize:!0}]},ie=>{let se;return ie.length===1?se=ie[0].getPastValues():se=ie[0].getPastValues(toNum(ie[1])),new Vector(se,te)}),defineFunction(te,"PastStdDev",{object:[te.varBank,re],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",vectorize:!0}]},ie=>{let se;return ie.length===1?se=ie[0].getPastValues():se=ie[0].getPastValues(toNum(ie[1])),se.length>1?te.varBank.stddev(se):new Material(0)}),defineFunction(te,"PastCorrelation",{params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"[Primitive]",noVector:!0,needPrimitive:!0,object:[te.varBank,re]},{name:"Past Range",vectorize:!0,defaultVal:"All Time"}]},ie=>{let se,le;return ie[2]!=="All Time"?(se=ie[0].getPastValues(),le=ie[1].getPastValues()):(se=ie[0].getPastValues(toNum(ie[2])),le=ie[1].getPastValues(toNum(ie[2]))),se.length>1?te.varBank.correlation([new Vector(se,te),new Vector(le,te)]):new Material(0)}),defineFunction(te,"PastMax",{object:[te.varBank,re],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",vectorize:!0}]},ie=>ie.length===1?te.varBank.max(ie[0].getPastValues()):te.varBank.max(ie[0].getPastValues(toNum(ie[1])))),defineFunction(te,"PastMin",{object:[te.varBank,re],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",vectorize:!0}]},ie=>ie.length===1?te.varBank.min(ie[0].getPastValues()):te.varBank.min(ie[0].getPastValues(toNum(ie[1])))),defineFunction(te,"Pulse",{params:[{name:"Start Time",vectorize:!0},{name:"Height",vectorize:!0,defaultVal:1},{name:"Width",vectorize:!0,defaultVal:0},{name:"Repeat Period",vectorize:!0,defaultVal:0}]},ie=>{let se=toNum(ie[0]),le=new Material(1),ue=new Material(0),ae=new Material(0);if(ie.length>1&&(le=toNum(ie[1]),ie.length>2&&(ue=toNum(ie[2]),ie.length>3&&(ae=toNum(ie[3])))),se.units||(se.units=te.timeUnits),ue.units||(ue.units=te.timeUnits),ae.units||(ae.units=te.timeUnits),ae.value<=0){if(eq(te.time(),se)||greaterThanEq(te.time(),se)&&lessThanEq(te.time(),plus(se,ue)))return le}else if(greaterThanEq(te.time(),se)){let oe=minus(te.time(),mult(te.varBank.floor([div(minus(te.time(),se),ae)]),ae)),ce=minus(te.time(),se);if(minus(te.varBank.round([div(ce,ae)]),div(ce,ae)).value===0||greaterThanEq(oe,se)&&lessThanEq(oe,plus(se,ue)))return le}return new Material(0,le.units)}),defineFunction(te,"Ramp",{params:[{name:"Start Time",vectorize:!0},{name:"Finish Time",vectorize:!0},{name:"Height",vectorize:!0,defaultVal:1}]},ie=>{let se=toNum(ie[0]),le=toNum(ie[1]),ue=new Material(1);return ie.length===3&&(ue=toNum(ie[2])),se.units||(se.units=te.timeUnits),le.units||(le.units=te.timeUnits),greaterThanEq(te.time(),se)?div(mult(te.varBank.min([minus(le,se),minus(te.time(),se)]),ue),minus(le,se)):new Material(0,ue.units)}),defineFunction(te,"Step",{params:[{name:"Start Time",vectorize:!0},{name:"Height",vectorize:!0,defaultVal:1}]},ie=>{let se=toNum(ie[0]),le=new Material(1);return ie.length===2&&(le=toNum(ie[1])),se.units||(se.units=te.timeUnits),greaterThanEq(te.time(),se)?le:new Material(0,le.units)}),te.varBank.staircase=te.varBank.step,defineFunction(te,"Delay",{object:[te.varBank,re],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Delay",vectorize:!0},{name:"Initial Value",defaultVal:"None",vectorize:!0}]},ie=>{if(toNum(ie[1]).value<0)throw new ModelError("The delay must be greater than or equal to 0.",{code:1026});return ie.length===2?ie[0].pastValue(toNum(ie[1])):ie[0].pastValue(toNum(ie[1]),toNum(ie[2]))}),defineFunction(te,"Smooth",{object:[te.varBank,re],params:[{name:"Expression",noVector:!0},{name:"Period",vectorize:!0},{name:"Initial Value",vectorize:!0,defaultVal:"None"}]},ie=>{throw new ModelError("Smooth() may only be called in a top level primitive equation",{code:1052})}),defineFunction(te,"Delay1",{object:[te.varBank,re],params:[{name:"Expression",noVector:!0},{name:"Delay",vectorize:!0},{name:"Initial Value",vectorize:!0,defaultVal:"None"}]},ie=>{throw new ModelError("Delay1() may only be called in a top level primitive equation",{code:1053})}),defineFunction(te,"Delay3",{object:[te.varBank,re],params:[{name:"Expression",noVector:!0},{name:"Delay",vectorize:!0},{name:"Initial Value",vectorize:!0,defaultVal:"None"}]},ie=>{throw new ModelError("Delay3() may only be called in a top level primitive equation",{code:1054})}),te.varBank.fix=function(ie,se){testArgumentsSize(ie,"Fix",1,2);let le=-1;ie.length===2&&(le=toNum(evaluateNode(ie[1].node,ie[1].scope,te)));let ue=null;for(let ae=0;ae<te.oldAggregateSeries.length;ae++)if(te.oldAggregateSeries[ae].match(se)){ue=te.oldAggregateSeries[ae];break}return ue===null&&(ue=new AggregateSeries(te,se,le),te.oldAggregateSeries.push(ue)),ue.get(ie[0])},te.varBank.fix.delayEvalParams=!0,te.varBank.populationsize=function(ie){if(testArgumentsSize(ie,"PopulationSize",1,1),ie[0]instanceof SPopulation)return new Material(ie[0].agents.length);throw new ModelError("PopulationSize must be passed an agent population as an argument.",{code:1327})},re.populationsize=te.varBank.populationsize,defineFunction(te,"Remove",{object:[te.varBank,ee],params:[{needAgent:!0,name:"[Agent]"}]},ie=>{if(ie[0].dead)throw new ModelError("Cannot remove an already removed agent.",{code:1328});return te.tasks.add(new Task({time:te.time(),priority:10,expires:1,name:"Remove Agent",action:se=>{ie[0].die()}})),new Material(1)}),defineFunction(te,"Add",{object:[te.varBank,re],params:[{name:"[Agent Population]"},{needAgent:!0,name:"[Base]",defaultVal:"Agent Base"}]},ie=>{for(;!(ie[0]instanceof SPopulation)&&ie[0].container!==null;)ie[0]=ie[0].container;if(!(ie[0]instanceof SPopulation))throw new ModelError("You must pass an agent population as the first argument to Add().",{code:1029});return ie.length===2?ie[0].add(ie[1]):ie[0].add()}),defineFunction(te,"FindAll",{object:[te.varBank,VectorObject,re],params:[{needPopulation:!0,name:"[Agent Population]"}]},ie=>ie[0]),defineFunction(te,"ResetTimer",{object:[te.varBank,re],params:[{needPrimitive:!0,name:"[Action]"}]},ie=>{if(!(ie[0]instanceof SAction))throw new ModelError("ResetTimer requires an Action primitive.",{code:1030});return ie[0].resetTimer(),new Material(0)}),defineFunction(te,"Transition",{object:[te.varBank,re],params:[{needPrimitive:!0,name:"[Transition]"}]},ie=>{if(!(ie[0]instanceof STransition))throw new ModelError("Transition requires an Transition primitive.",{code:1031});return ie[0].trigger(),new Material(0)}),defineFunction(te,"Value",{object:[te.varBank,VectorObject,ee],params:[{name:"[Population]"},{needPrimitive:!0,name:"[Primitive]"}]},ie=>{let se=ie[1].id,le=null;if(ie[0]instanceof SPopulation||ie[0]instanceof SAgent||ie[0]instanceof Vector||!ie[0]||(ie[0]=toNum(ie[0])),ie[0]instanceof SPopulation&&(le=getPopulation(ie[0],te)),ie[0]instanceof Vector&&(le=ie[0]),le!==null){let ue=[],ae=-1;for(let oe of le.items){if(!(oe instanceof SAgent))throw new ModelError('Cannot take "Value()" of vector that does not contain agents.',{code:1172});if(ae!==-1)ue.push(oe.children[ae]);else for(let ce=0;ce<oe.children.length;ce++)if(oe.children[ce].id===se){ue.push(oe.children[ce]),ae=ce;break}}return new Vector(ue,te)}else if(ie[0]instanceof SAgent){for(let ue of ie[0].children)if(ue.id===se)return ue;throw new ModelError('Could not find referenced primitive for "Value()".',{code:1032})}throw new ModelError('Invalid type for the first argument of "Value()".',{code:1033})}),defineFunction(te,"SetValue",{object:[te.varBank,VectorObject,re,ee],params:[{name:"[Population]"},{needPrimitive:!0,name:"[Primitive]"},{name:"Value",noVector:!0,allowBoolean:!0}]},ie=>{let se=ie[1].id,le=null;if(ie[0]instanceof SPopulation&&(le=getPopulation(ie[0],te)),ie[0]instanceof Vector&&(le=ie[0]),le!==null){for(let ue=0;ue<le.length();ue++)for(let ae of le.items[ue].children)ae.id===se&&ae.setValue(ie[2]);return new Material(1)}else if(ie[0]instanceof SAgent){for(let ue of ie[0].children)if(ue.id===se)return ue.setValue(ie[2]),new Material(1);throw new ModelError('Could not find referenced primitive for "SetValue()".',{code:1034})}throw new ModelError('Invalid type for the first argument of "SetValue()".',{code:1035})}),defineFunction(te,"FindIndex",{object:[te.varBank,VectorObject,re],params:[{needPopulation:!0,name:"[Agent Population]"},{name:"Index",noVector:!0,needNum:!0,noUnits:!0}]},ie=>{let se=ie[0];for(let le of se.items)if(le.index+1===ie[1].value)return le;throw new ModelError("Index not found in population.",{code:1036})}),defineFunction(te,"FindState",{object:[te.varBank,VectorObject,re],params:[{needPopulation:!0,name:"[Agent Population]"},{needPrimitive:!0,name:"[State]"}]},ie=>{let se=ie[0];if(!(ie[1]instanceof SState||ie[1].dna.primitive instanceof State))throw new ModelError("FindState() requires a State primitive as its argument.",{code:1037});let le=ie[1].id,ue=[];for(let ae=0;ae<se.items.length;ae++)se.items[ae].stateIDs.has(le)&&ue.push(se.items[ae]);return new Vector(ue,te)}),defineFunction(te,"FindNotState",{object:[te.varBank,VectorObject,re],params:[{needPopulation:!0,name:"[Agent Population]"},{needPrimitive:!0,name:"[State]"}]},ie=>{let se=ie[0];if(!(ie[1]instanceof SState||ie[1].dna.primitive instanceof State))throw new ModelError("FindNotState() requires a State primitive as its argument.",{code:1038});let le=ie[1].id,ue=[];for(let ae of se.items)ae.stateIDs.has(le)||ue.push(ae);return new Vector(ue,te)}),defineFunction(te,"FindNearby",{object:[te.varBank,VectorObject,re],params:[{needPopulation:!0,name:"[Agent Population]"},{name:"Target"},{name:"Distance Limit",needNum:!0,noVector:!0}]},ie=>{let se=ie[0],le=ne(ie[1]),ue;try{ue=agent(ie[1],te)}catch{}let ae=[];for(let oe=0;oe<se.length();oe++){let ce=agent(se.items[oe]);ce!==ue&&lessThanEq(distance(le,ne(ce),te),ie[2])&&ae.push(ce)}return new Vector(ae,te)}),defineFunction(te,"FindNearest",{object:[te.varBank,VectorObject,re],params:[{needPopulation:!0,name:"[Agent Population]"},{name:"Target"},{noUnits:!0,noVector:!0,needNum:!0,defaultVal:1,name:"Count"}]},ie=>{let se=ie[0],le=1;if(ie.length===3){if(le=ie[2].value,le<1)throw new ModelError("You must select at least one agent in FindNearest().",{code:1039});if(le!==Math.floor(le))throw new ModelError("Count must be an integer.",{code:1040})}let ue=ne(ie[1]),ae;try{ae=agent(ie[1],te)}catch{}let oe=[];for(let he of se.items)he=agent(he),he!==ae&&oe.push({distance:distance(ue,ne(he),te),item:he});if(oe.length<le)throw new ModelError(`Can't find nearest ${le} agents of a population of size ${oe.length}.`,{code:1041});let ce=[oe[0]];for(let he=1;he<oe.length;he++){let pe=!1;for(let de=0;de<ce.length;de++)if(lessThan(oe[he].distance,ce[de].distance)){ce.splice(de,0,oe[he]),pe=!0;break}!pe&&ce.length<le?ce.push(oe[he]):ce.length>le&&(ce.length=le)}return ce.length===1?ce[0].item:new Vector(ce.map(he=>he.item),te)}),defineFunction(te,"FindFurthest",{object:[te.varBank,VectorObject,re],params:[{needPopulation:!0,name:"[Agent Population]"},{name:"Target"},{noUnits:!0,noVector:!0,needNum:!0,defaultVal:1,name:"Count"}]},ie=>{let se=ie[0],le=1;if(ie.length===3){if(le=ie[2].value,le<1)throw new ModelError("You must select at least one agent in FindFurthest().",{code:1042});if(le!==Math.floor(le))throw new ModelError("Count must be an integer.",{code:1043})}let ue=ne(ie[1]),ae;try{ae=agent(ie[1],te)}catch{}let oe=[];for(let he of se.items){let pe=agent(he);pe!==ae&&oe.push({distance:distance(ue,ne(pe),te),item:pe})}if(oe.length<le)throw new ModelError(`Can't find furthest ${le} agents of a population of size ${oe.length}.`,{code:1044});let ce=[oe[0]];for(let he=1;he<oe.length;he++){let pe=!1;for(let de=0;de<ce.length;de++)if(greaterThan(oe[he].distance,ce[de].distance)){ce.splice(de,0,oe[he]),pe=!0;break}!pe&&ce.length<le?ce.push(oe[he]):ce.length>le&&(ce.length=le)}return ce.length===1?ce[0].item:new Vector(ce.map(he=>he.item),te)}),defineFunction(te,"Index",{object:[te.varBank,ee],params:[{noVector:!0,needAgent:!0,name:"[Agent]"}]},ie=>new Material(ie[0].index+1)),defineFunction(te,"Connect",{object:[te.varBank,ee],params:[{needAgent:!0,name:"[Agent 1]"},{name:"[Agent 2]"},{name:"Weight",defaultVal:"missing",needNum:!0}]},ie=>{let se;return ie[2]!=="missing"&&(se=ie[2]),ie[1]instanceof Vector?ie[1].items.forEach(le=>{ie[0].connect(le,se)}):ie[0].connect(ie[1],se),new Material(1)}),defineFunction(te,"Unconnect",{object:[te.varBank,ee],params:[{needAgent:!0,name:"[Agent 1]"},{name:"[Agent 2]"}]},ie=>(ie[1]instanceof Vector?ie[1].items.forEach(se=>{ie[0].unconnect(se)}):ie[0].unconnect(ie[1]),new Material(1))),defineFunction(te,"Connected",{object:[te.varBank,ee],params:[{needAgent:!0,name:"[Agent]"}]},ie=>new Vector(ie[0].connected.slice(),te)),defineFunction(te,"ConnectionWeight",{object:[te.varBank,ee],params:[{needAgent:!0,name:"[Agent 1]"},{name:"[Agent 2]"}]},ie=>ie[1]instanceof Vector?new Vector(ie[1].items.map(se=>ie[0].connectionWeight(se)),te):ie[0].connectionWeight(ie[1])),defineFunction(te,"SetConnectionWeight",{object:[te.varBank,ee],params:[{needAgent:!0,name:"[Agent 1]"},{name:"[Agent 2]"},{name:"Weight",needNum:!0}]},ie=>(ie[1]instanceof Vector?ie[1].items.forEach(se=>{ie[0].setConnectionWeight(se,ie[2])}):ie[0].setConnectionWeight(ie[1],ie[2]),new Material(1))),te.varBank.print=function(ie){function se(le){return le instanceof String&&(le=""+le),le}return ie.length===2?(console.log(se(ie[0].value.toString())),console.log(se(ie[1])),ie[1]):(console.log(se(ie[0])),ie[0])},defineFunction(te,"Width",{params:[{needAgents:!0,name:"[Agent Population]"}]},ie=>ie[0].geoWidth),defineFunction(te,"Height",{params:[{needAgents:!0,name:"[Agent Population]"}]},ie=>ie[0].geoHeight),defineFunction(te,"Distance",{object:[te.varBank,ee],params:[{name:"Location 1"},{name:"Location 2"}]},ie=>{let se=ne(ie[0]),le=ne(ie[1]);return distance(se,le,te)}),defineFunction(te,"Location",{object:[te.varBank,ee],params:[{needAgent:!0,name:"[Agent]"}]},ie=>{if(ie[0].location)return ie[0].location.fullClone();throw new ModelError("The location is not defined.",{code:1046})}),defineFunction(te,"SetLocation",{object:[te.varBank,ee],params:[{needAgent:!0,name:"[Agent]"},{needVector:!0,name:"Direction"}]},ie=>{let se=toNum(ie[1]),le=ie[0];return le.location=se.fullClone(),le.location.names||(le.location.names=["x","y"],le.location.namesLC=["x","y"]),new Material(0)}),defineFunction(te,"Move",{object:[te.varBank,ee],params:[{needAgent:!0,name:"[Mover]"},{needVector:!0,name:"Direction"}]},ie=>{let se=toNum(ie[1]);return shiftLocation(ie[0],plus(ie[0].location,se)),new Material(0)});function ne(ie){const se="Location not initialized yet for agents. Location initialization happens after agent primitive value initialization.";if(ie instanceof Vector){if(ie.items.length!==2||!(ie.items[0]instanceof Material)||!(ie.items[1]instanceof Material))throw new ModelError("Location vector does not contain exactly two numbers.",{code:1047});return{location:ie,agent:null}}else try{let le=agent(ie,te),ue=le.location;if(ue===null)throw new ModelError(se,{code:1048});return{location:ue,agent:le}}catch(le){throw le.message===se?le:new ModelError("Location must be a vector or an agent.",{code:1049})}}defineFunction(te,"MoveTowards",{object:[te.varBank,ee],params:[{needAgent:!0,name:"[Mover]"},{name:"[Target]"},{name:"Distance",noVector:!0,needNum:!0}]},ie=>{let se=ne(ie[0]),le=ne(ie[1]),ue=se.location,ae=le.location,oe=minus(ae.items[0],ue.items[0]),ce=minus(ae.items[1],ue.items[1]);if(oe.value===0&&ce.value===0)return new Material(1);let he=se.agent;he.container.geoWrap&&(greaterThan(oe,he.container.halfWidth)?oe=minus(oe,he.container.geoWidth):lessThan(oe,negate(he.container.halfWidth))&&(oe=plus(oe,he.container.geoWidth)),greaterThan(ce,he.container.halfHeight)?ce=minus(ce,he.container.geoHeight):lessThan(ce,negate(he.container.halfHeight))&&(ce=plus(ce,he.container.geoHeight)));let pe=new Vector([oe,ce],te,["x","y"]);return shiftLocation(he,plus(he.location,mult(pe,div(ie[2],distance(se,le,te))))),new Material(1)}),te.varBank.primitivebase=makeObjectBase(re,te),te.varBank.agentbase=makeObjectBase(ee,te),te.varBank.primitivebase.parent=te.varBank.agentbase,te.varBank.vectorbase=makeObjectBase(VectorObject,te)}const MAX_DISTANCE_CACHES=1e6;function distance(te,ee,re){let ne=te.location,ie=ee.location;re.distanceCacheCount++;let se=te.agent?te.agent.container:ee.agent?ee.agent.container:null,le;if(re.distanceCacheCount<MAX_DISTANCE_CACHES){let de=ne.items[0].toString()+","+ne.items[1].toString(),me=ie.items[0].toString()+","+ie.items[1].toString();if(me<de&&([de,me]=[me,de]),le=de+":"+me,se&&(le+="/"+se.id),le in re.distanceCache)return re.distanceCache[le]}let ue=minus(ne.items[0],ie.items[0]),ae=minus(ne.items[1],ie.items[1]);se&&se.geoWrap&&(greaterThan(ue,se.halfWidth)?ue=minus(se.geoWidth,ue):lessThan(ue,negate(se.halfWidth))&&(ue=minus(ue,negate(se.geoWidth))),greaterThan(ae,se.halfHeight)?ae=minus(se.geoHeight,ae):lessThan(ae,negate(se.halfHeight))&&(ae=minus(ae,negate(se.geoHeight))));let oe=ue.value,ce=ae.value;ue.units!==ae.units&&(ce=fn["*"](ce,convertUnits(ue.units,ae.units)));let he=fn.sqrt(fn["+"](fn["*"](oe,oe),fn["*"](ce,ce))),pe=new Material(he,ue.units);return re.distanceCacheCount<MAX_DISTANCE_CACHES&&(re.distanceCache[le]=pe),pe}function agent(te,ee){if((te instanceof SVariable||te instanceof SStock)&&(te=toNum(te)),te instanceof SAgent)return te;if(te instanceof SPrimitive)return agent(te.container);throw new ModelError("An agent is required here.",{code:1050})}function agents(te){if(te instanceof SPopulation)return te;if(te instanceof SPrimitive||te instanceof SAgent)return agents(te.container);throw new ModelError("An agent population is required here.",{code:1051})}function getPopulation(te,ee){return te.items?te:te instanceof SPopulation?new Vector(te.agents.slice(),ee):toNum(te)instanceof Vector?toNum(te):new Vector([agent(te)],ee)}function shiftLocation(te,ee){if(te.container.geoWrap){for(;lessThan(ee.items[0],new Material(0));)ee.items[0]=plus(ee.items[0],te.container.geoWidth);for(;greaterThan(ee.items[0],te.container.geoWidth);)ee.items[0]=minus(ee.items[0],te.container.geoWidth);for(;lessThan(ee.items[1],new Material(0));)ee.items[1]=plus(ee.items[1],te.container.geoHeight);for(;greaterThan(ee.items[1],te.container.geoHeight);)ee.items[1]=minus(ee.items[1],te.container.geoHeight)}te.location=ee,te.location.names||(te.location.names=["x","y"],te.location.namesLC=["x","y"])}let SeedRandom={};(function(te,ee,re){var ne=256,ie=6,se=52,le="random",ue=re.pow(ne,ie),ae=re.pow(2,se),oe=ae*2,ce=ne-1,he;function pe(Te,ye,be){var Fe=[];ye=ye==!0?{entropy:!0}:ye||{};var Le=we(ge(ye.entropy?[Te,_e(ee)]:Te??ve(),3),Fe),Oe=new de(Fe),Se=function(){for(var De=Oe.g(ie),Ie=ue,Ve=0;De<ae;)De=(De+Ve)*ne,Ie*=ne,Ve=Oe.g(1);for(;De>=oe;)De/=2,Ie/=2,Ve>>>=1;return(De+Ve)/Ie};return Se.int32=function(){return Oe.g(4)|0},Se.quick=function(){return Oe.g(4)/4294967296},Se.double=Se,we(_e(Oe.S),ee),(ye.pass||be||function(De,Ie,Ve,Ke){return Ke&&(Ke.S&&me(Ke,Oe),De.state=function(){return me(Oe,{})}),Ve?(re[le]=De,Ie):De})(Se,Le,"global"in ye?ye.global:this==re,ye.state)}function de(Te){var ye,be=Te.length,Fe=this,Le=0,Oe=Fe.i=Fe.j=0,Se=Fe.S=[];for(be||(Te=[be++]);Le<ne;)Se[Le]=Le++;for(Le=0;Le<ne;Le++)Se[Le]=Se[Oe=ce&Oe+Te[Le%be]+(ye=Se[Le])],Se[Oe]=ye;(Fe.g=function(De){for(var Ie,Ve=0,Ke=Fe.i,ht=Fe.j,qe=Fe.S;De--;)Ie=qe[Ke=ce&Ke+1],Ve=Ve*ne+qe[ce&(qe[Ke]=qe[ht=ce&ht+Ie])+(qe[ht]=Ie)];return Fe.i=Ke,Fe.j=ht,Ve})(ne)}function me(Te,ye){return ye.i=Te.i,ye.j=Te.j,ye.S=Te.S.slice(),ye}function ge(Te,ye){var be=[],Fe=typeof Te,Le;if(ye&&Fe=="object")for(Le in Te)try{be.push(ge(Te[Le],ye-1))}catch{}return be.length?be:Fe=="string"?Te:Te+"\0"}function we(Te,ye){for(var be=Te+"",Fe,Le=0;Le<be.length;)ye[ce&Le]=ce&(Fe^=ye[ce&Le]*19)+be.charCodeAt(Le++);return _e(ye)}function ve(){try{var Te;return he&&(Te=he.randomBytes)||(Te=new Uint8Array(ne),(te.crypto||te.msCrypto).getRandomValues(Te)),_e(Te)}catch{var ye=te.navigator,be=ye&&ye.plugins;return[+new Date,te,be,te.screen,_e(ee)]}}function _e(Te){return String.fromCharCode.apply(0,Te)}we(re.random(),ee),SeedRandom.seedrandom=pe})(typeof self<"u"?self:globalThis,[],Math);function createFunctions(te){defineFunction(te,"RandBeta",{params:[{name:"Alpha",noUnits:!0,noVector:!0},{name:"Beta",noUnits:!0,noVector:!0}]},ae=>new Material(RandBeta(te,ae[0].value,ae[1].value))),defineFunction(te,"RandDist",{params:[{name:"Distribution",noUnits:!0,needVector:!0},{name:"Y (in which case Distribution is X)",noUnits:!0,needVector:!0,defaultVal:!1}]},ae=>{let oe,ce;if(ae.length===1||ae[1]===!1){let he=ae[0];oe=[],ce=[];for(let pe=0;pe<he.items.length;pe++){if(!(he.items[pe]instanceof Vector))throw new ModelError("Invalid vector provided to RandDist.",{code:6e3});oe.push(toNum(he.items[pe].items[0]).value),ce.push(toNum(he.items[pe].items[1]).value)}}else oe=toNum(ae[0]).items.map(he=>he.value),ce=toNum(ae[1]).items.map(he=>he.value);return new Material(RandDist(te,oe,ce))}),defineFunction(te,"RandBoolean",{params:[{name:"Probability",defaultVal:.5,noUnits:!0,noVector:!0}]},ae=>{let oe;return ae.length!==0?oe=toNum(ae[0]).value:oe=.5,Rand(te)<oe}),defineFunction(te,"Rand",{params:[{name:"Lower Bound",defaultVal:0,noUnits:!0,noVector:!0},{name:"Upper Bound",defaultVal:1,noUnits:!0,noVector:!0}]},ae=>{if(ae.length===0)return new Material(Rand(te));if(ae.length===2)return new Material(Rand(te,toNum(ae[0]).value,toNum(ae[1]).value));throw new ModelError("Rand() must either have no parameters or a two: Min and Max bounds.",{code:6001})}),defineFunction(te,"RandNormal",{params:[{name:"Mean",defaultVal:0,noUnits:!0,noVector:!0},{name:"Standard Deviation",defaultVal:1,noUnits:!0,noVector:!0}]},ae=>{if(ae.length===0)return new Material(RandNormal(te));if(ae.length===2)return new Material(RandNormal(te,toNum(ae[0]).value,toNum(ae[1]).value));throw new ModelError("RandNormal() must either have no parameters or a two: Mean and Standard Deviation.",{code:6002})}),defineFunction(te,"RandExp",{params:[{name:"Rate",defaultVal:1,noUnits:!0,noVector:!0}]},ae=>ae.length!==0?new Material(RandExp(te,toNum(ae[0]).value)):new Material(RandExp(te))),defineFunction(te,"RandLognormal",{params:[{name:"Mean",noUnits:!0,noVector:!0},{name:"Standard Deviation",noUnits:!0,noVector:!0}]},ae=>new Material(RandLognormal(te,toNum(ae[0]).value,toNum(ae[1]).value))),defineFunction(te,"RandBinomial",{params:[{name:"Count",noUnits:!0,noVector:!0},{name:"Probability",noUnits:!0,noVector:!0}]},ae=>new Material(RandBinomial(te,toNum(ae[0]).value,toNum(ae[1]).value))),defineFunction(te,"RandNegativeBinomial",{params:[{name:"Successes",noUnits:!0,noVector:!0},{name:"Probability",noUnits:!0,noVector:!0}]},ae=>new Material(RandNegativeBinomial(te,toNum(ae[0]).value,toNum(ae[1]).value))),defineFunction(te,"RandGamma",{params:[{name:"Alpha",noUnits:!0,noVector:!0},{name:"Beta",noUnits:!0,noVector:!0}]},ae=>new Material(RandGamma(te,toNum(ae[0]).value,toNum(ae[1]).value))),defineFunction(te,"RandPoisson",{params:[{name:"Rate",noUnits:!0,noVector:!0}]},ae=>new Material(RandPoisson(te,toNum(ae[0]).value))),defineFunction(te,"RandTriangular",{params:[{name:"Minimum",noUnits:!0,noVector:!0},{name:"Maximum",noUnits:!0,noVector:!0},{name:"Peak",noUnits:!0,noVector:!0}]},ae=>new Material(RandTriangular(te,toNum(ae[0]).value,toNum(ae[1]).value,toNum(ae[2]).value))),defineFunction(te,"Magnitude",{params:[{name:"Number"}]},ae=>{if(toNum(ae[0])instanceof Vector)return te.varBank.sqrt([te.varBank.sum([mult(ae[0],ae[0])])]);let oe=toNum(ae[0]);return oe.value=fn.magnitude(oe.value),oe}),defineFunction(te,"Abs",{params:[{name:"Number"}],recurse:!0,leafNeedNum:!0},ae=>{let oe=toNum(ae[0]);return oe.value=fn.abs(oe.value),oe}),defineFunction(te,"sin",{params:[{name:"Number"}],recurse:!0,leafNeedNum:!0},ae=>{let oe=toNum(ae[0]);if(oe.units&&!oe.units.isUnitless()&&(oe=mult(oe,new Material(1,te.unitManager.getUnitStore(["radians"],[-1])))),oe.units)throw new ModelError("Non-angular units cannot be used in Sin().",{code:6003});return new Material(fn.sin(oe.value))}),defineFunction(te,"cos",{params:[{name:"Number"}],recurse:!0,leafNeedNum:!0},ae=>{let oe=toNum(ae[0]);if(oe.units&&!oe.units.isUnitless()&&(oe=mult(oe,new Material(1,te.unitManager.getUnitStore(["radians"],[-1])))),oe.units)throw new ModelError("Non-angular units cannot be used in Cos().",{code:6004});return new Material(fn.cos(oe.value))}),defineFunction(te,"tan",{params:[{name:"Number"}],recurse:!0,leafNeedNum:!0},ae=>{let oe=toNum(ae[0]);if(oe.units&&!oe.units.isUnitless()&&(oe=mult(oe,new Material(1,te.unitManager.getUnitStore(["radians"],[-1])))),oe.units)throw new ModelError("Non-angular units cannot be used in Tan().",{code:6005});return new Material(fn.tan(oe.value))}),defineFunction(te,"asin",{params:[{name:"Number",noUnits:!0}],recurse:!0,leafNeedNum:!0},ae=>new Material(fn.asin(toNum(ae[0]).value))),defineFunction(te,"acos",{params:[{name:"Number",noUnits:!0}],recurse:!0,leafNeedNum:!0},ae=>new Material(fn.acos(toNum(ae[0]).value))),defineFunction(te,"atan",{params:[{name:"Number",noUnits:!0}],recurse:!0,leafNeedNum:!0},ae=>new Material(fn.atan(toNum(ae[0]).value))),defineFunction(te,"arcsin",{params:[{name:"Number",noUnits:!0}],recurse:!0,leafNeedNum:!0},ae=>new Material(fn.asin(toNum(ae[0]).value),te.unitManager.getUnitStore(["radians"],[1]))),defineFunction(te,"arccos",{params:[{name:"Number",noUnits:!0,leafNeedNum:!0}],recurse:!0},ae=>new Material(fn.acos(toNum(ae[0]).value),te.unitManager.getUnitStore(["radians"],[1]))),defineFunction(te,"arctan",{params:[{name:"Number",noUnits:!0,leafNeedNum:!0}],recurse:!0},ae=>new Material(fn.atan(toNum(ae[0]).value),te.unitManager.getUnitStore(["radians"],[1]))),defineFunction(te,"Sign",{params:[{name:"Number",leafNeedNum:!0}],recurse:!0},ae=>{let oe=toNum(ae[0]);if(oe.value<0)return div(new Material(-1),new Material(1));if(oe.value>0)return div(new Material(1),new Material(1));if(oe.value===0)return new Material(0);throw new ModelError("Invalid value for <i>Sign</i>.",{code:6006})}),defineFunction(te,"Sqrt",{params:[{name:"Number",leafNeedNum:!0}],recurse:!0},ae=>{let oe=toNum(ae[0]).fullClone();if(oe.value<0)throw new ModelError("Sqrt() requires a number greater than or equal to 0.",{code:6007});return oe.value=fn.sqrt(oe.value),oe.units&&!oe.units.isUnitless()&&(oe.units=oe.units.power(.5)),oe}),defineFunction(te,"Ln",{params:[{name:"Number",noUnits:!0,leafNeedNum:!0}],recurse:!0},ae=>{let oe=toNum(ae[0]).value;if(oe<0)throw new ModelError("Ln() requires a number greater than or equal to 0.",{code:6008});return new Material(fn.log(oe))}),defineFunction(te,"Log",{params:[{name:"Number",noUnits:!0,leafNeedNum:!0}],recurse:!0},ae=>{let oe=toNum(ae[0]).value;if(oe<0)throw new ModelError("Log() requires a number greater than or equal to 0.",{code:6009});return new Material(fn.log(oe,10))}),defineFunction(te,"Logit",{params:[{name:"Number",noUnits:!0,leafNeedNum:!0}],recurse:!0},ae=>{let oe=toNum(ae[0]);return oe.value=fn["-"](fn.log(oe.value),fn.log(fn["-"](1,oe.value))),oe}),defineFunction(te,"Expit",{params:[{name:"Number",noUnits:!0,leafNeedNum:!0}],recurse:!0},ae=>{let oe=toNum(ae[0]);return oe.value=fn["/"](1,fn["+"](1,fn.exp(fn["-"](oe.value)))),oe}),defineFunction(te,"Round",{params:[{name:"Number",noUnits:!1,leafNeedNum:!0}],recurse:!0},ae=>{let oe=toNum(ae[0]);return oe.value=fn.round(oe.value),oe}),defineFunction(te,"Ceiling",{params:[{name:"Number",noUnits:!1,leafNeedNum:!0}],recurse:!0},ae=>{let oe=toNum(ae[0]);return oe.value=fn.ceiling(oe.value),oe}),defineFunction(te,"Floor",{params:[{name:"Number",noUnits:!1,leafNeedNum:!0}],recurse:!0},ae=>{let oe=toNum(ae[0]);return oe.value=fn.floor(oe.value),oe}),defineFunction(te,"Exp",{params:[{name:"Number",noUnits:!0,leafNeedNum:!0}],recurse:!0},ae=>new Material(fn.exp(toNum(ae[0]).value))),te.varBank.ifthenelse=function(ae){testArgumentsSize(ae,"IfThenElse",3,3);let oe=toNum(evaluateNode(ae[0].node,ae[0].scope,te));return oe instanceof Vector?ee(oe,evaluateNode(ae[1].node,ae[1].scope,te),evaluateNode(ae[2].node,ae[2].scope,te)):trueValue(oe)?evaluateNode(ae[1].node,ae[1].scope,te):evaluateNode(ae[2].node,ae[2].scope,te)},te.varBank.ifthenelse.delayEvalParams=!0,te.varBank.assert=function(ae){testArgumentsSize(ae,"Assert",1,2);let oe=evaluateNode(ae[0].node,ae[0].scope,te);if(trueValue(oe))return new Material(1);throw new ModelError(ae[1]?evaluateNode(ae[1].node,ae[1].scope,te):"Assert() failed",{code:2e4})},te.varBank.assert.delayEvalParams=!0;function ee(ae,oe,ce){let he=function(me,ge){return me instanceof Vector?me.combine(ge,he):[me,ge]};oe=toNum(oe),ce=toNum(ce);let pe;oe instanceof Vector?pe=oe.cloneCombine(ce,he):ce instanceof Vector?pe=ce.cloneCombine(oe,(me,ge)=>he(ge,me)):pe=he(oe,ce);let de=function(me,ge){return me instanceof Vector?me.combine(ge,de):trueValue(me)?ge[0]:ge[1]};return ae.cloneCombine(pe,de)}te.varBank.map=function(ae){testArgumentsSize(ae,"Map",2,2);let oe;if(ae[0].node instanceof Vector?oe=ae[0].node:ae[0]instanceof Vector?oe=ae[0]:oe=evaluateNode(ae[0].node,ae[1].scope,te),oe instanceof SPrimitive&&(oe=toNum(oe)),!(oe instanceof Vector))throw new ModelError("Map() requires a vector as its first argument.",{code:6010});oe=oe.fullClone();let ce,he={x:null,"-parent":ae[1].scope},pe=ae[1].node;try{ce=evaluateNode(pe,he,te)}catch{}let de;return ce instanceof Function||ce instanceof UserFunction?(ce.fn&&(ce=ce.fn),de=function(me){return ce([me])}):de=function(me,ge){return he.x=me,he.key=ge||"",evaluateNode(pe,he,te)},oe.apply(de)},te.varBank.map.delayEvalParams=!0,VectorObject.map=te.varBank.map,defineFunction(te,"Sample",{object:[te.varBank,VectorObject],params:[{name:"Vector",needVector:!0},{name:"Sample Size"},{name:"Repeat",noVector:!0,allowBoolean:!0,defaultVal:!1}]},ae=>{let oe=toNum(ae[0]),ce=toNum(ae[1]).value;if(ce===0)return new Vector([],te);let he=oe.length(),pe=ae[2]&&trueValue(toNum(ae[2]));if(he===0)throw new ModelError("Sample() requires a non-empty vector.",{code:6011});let de=[];if(pe)for(let me=0;me<ce;me++)de.push(oe.items[Math.floor(Rand(te)*he)]);else{if(he<ce)throw new ModelError("Vector for Sample() is too small for the given sample size.",{code:6012});let me=oe.items.slice();for(let ge=0;ge<ce;ge++)de.push(me.splice(Math.floor(Rand(te)*me.length),1)[0])}return new Vector(de,te)}),defineFunction(te,"IndexOf",{object:[te.varBank,VectorObject],params:[{name:"Haystack",needVector:!0,noUnits:!0},{name:"Needle",allowBoolean:!0,allowString:!0}]},ae=>{let oe=ae[1];if(oe instanceof Vector){let ce=[];for(let he=0;he<oe.items.length;he++)ce.push(re(oe.items[he],ae[0]));return new Vector(ce,te)}else return re(oe,ae[0])}),defineFunction(te,"Contains",{object:[te.varBank,VectorObject],params:[{name:"Haystack",needVector:!0,noUnits:!0},{name:"Needle",allowBoolean:!0,noVector:!0,allowString:!0}]},ae=>!eq(new Material(0),te.varBank.indexof(ae))),defineFunction(te,"Collapse",{params:[{name:"Source",needVector:!0,noUnits:!1},{name:"Target",noVector:!1}]},ae=>toNum(ae[0]).collapseDimensions(toNum(ae[1])));function re(ae,oe){for(let ce=0;ce<oe.length();ce++)if(eq(ae,oe.items[ce]))return new Material(ce+1);return new Material(0)}te.varBank.filter=function(ae){testArgumentsSize(ae,"Filter",2,2);let oe;if(ae[0].node instanceof Vector?oe=ae[0].node:ae[0]instanceof Vector?oe=ae[0]:oe=evaluateNode(ae[0].node,ae[0].scope,te),oe instanceof SPrimitive&&(oe=toNum(oe)),!(oe instanceof Vector))throw new ModelError("Filter() requires a vector as its first argument.",{code:6013});oe=oe.fullClone();let ce=te.varBank.map(ae);return te.varBank.select([oe,ce])},te.varBank.filter.delayEvalParams=!0,VectorObject.filter=te.varBank.filter,te.varBank.join=function(ae){let oe=[],ce=[],he=!1;for(let pe=0;pe<ae.length;pe++){let de=ae[pe];if(de instanceof SPrimitive&&(de=toNum(de)),de instanceof Vector)if(oe=oe.concat(de.items),de.names)ce=ce.concat(de.names),he=!0;else for(let me=0;me<de.items.length;me++)ce.push(void 0);else oe.push(de),ce.push(void 0)}return new Vector(oe,te,he?ce:void 0)},te.varBank.repeat=function(ae){testArgumentsSize(ae,"Repeat",2,2);let oe=toNum(evaluateNode(ae[1].node,ae[1].scope,te)),ce=oe;if(oe instanceof Vector){if(oe.names&&oe.names.length)throw new ModelError(`If a repeat count is a vector, it can't have names. Got, <i>${oe}</i>.`,{code:6070});let de=oe.items;if(de.find(me=>!(typeof me=="string"||me instanceof String)))throw new ModelError(`If a repeat count is a vector, it must consist of all strings. Got, <i>${oe}</i>.`,{code:6071});if(new Set(de).size!==de.length)throw new ModelError(`If a repeat count is a vector, it must contain unique strings. Got, <i>${oe}</i>.`,{code:6072});ce=oe.items.length}else if(oe instanceof Material){if(oe.units&&!oe.units.isUnitless())throw new ModelError(`Repeat count must be unitless. Got, <i>${oe}</i>.`,{code:6073})}else throw new ModelError(`Repeat count must be a Number or Vector. Got, <i>${oe}</i>.`,{code:6074});let he=[],pe={x:null,"-parent":ae[1].scope,key:null};for(let de=0;de<ce;de++)oe instanceof Vector&&(pe.key=oe.items[de]),pe.x=new Material(de+1),he.push(evaluateNode(ae[0].node,pe,te));return new Vector(he,te,oe instanceof Vector?oe.items.slice():void 0)},te.varBank.repeat.delayEvalParams=!0,defineFunction(te,"Select",{params:[{name:"Haystack",needVector:!0,noUnits:!0},{name:"Indexes",noUnits:!0}]},ae=>{if(ae[1]instanceof Vector){let oe=toNum(ae[1]),ce=!0;for(let he=0;he<oe.length();he++)if(oe.items[he]instanceof Material){ce=!1;break}if(ce===!0){let he=[],pe=ae[0].names?[]:void 0;if(oe.length()!==ae[0].length())throw new ModelError("Length of vector must be equal for boolean selection.",{code:6014});for(let de=0;de<oe.length();de++)trueValue(oe.items[de])&&(he.push(ae[0].items[de]),ae[0].names&&pe.push(ae[0].names[de]));return new Vector(he,te,pe)}else{let he=[],pe=ae[0].names?[]:void 0;for(let de=0;de<oe.length();de++){let me=oe.items[de].value;if(me<=0||me>ae[0].length())throw new ModelError("Selected element out of range.",{code:6015});he.push(ae[0].items[me-1]),ae[0].names&&pe.push(ae[0].names[me-1])}return new Vector(he,te,pe)}}else{if(ae[1].value>0&&ae[1].value<=ae[0].length())return ae[0].items[ae[1].value-1];throw new ModelError("Selected element out of range.",{code:6016})}}),defineFunction(te,"Reverse",{allowEmpty:!0,params:{name:"Items..."},prep:function(ae){return te.varBank.join(ae)}},ae=>new Vector(ae.items.slice().reverse(),te,ae.names?ae.names.slice().reverse():void 0)),defineFunction(te,"Reverse",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},ae=>te.varBank.reverse(ae)),defineFunction(te,"Sort",{allowEmpty:!0,params:{name:"Items..."},prep:function(ae){return toNum(te.varBank.join(ae))}},ae=>ae.stackApply(ce=>{let he=[];for(let me=0;me<ce.items.length;me++)he.push({item:ce.items[me],name:ce.names?ce.names[me]:void 0});let pe=he.sort((me,ge)=>lessThan(me.item,ge.item)?-1:greaterThan(me.item,ge.item)?1:0),de=ce.names?[]:void 0;he=[];for(let me=0;me<pe.length;me++)he.push(pe[me].item),de&&de.push(pe[me].name);return new Vector(he,te,de)})),defineFunction(te,"Sort",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},ae=>te.varBank.sort(ae)),defineFunction(te,"Unique",{allowEmpty:!0,params:{name:"Items....",allowBoolean:!0},prep:function(ae){return toNum(te.varBank.join(ae))}},ae=>{if(!ae.items.length)return new Vector([],te);let oe=[],ce=ae.names?[]:void 0;for(let he=0;he<ae.items.length;he++){let pe=!1;for(let de=0;de<oe.length;de++)if(strictEquals(ae.items[he],oe[de])){pe=!0;break}pe||(oe.push(ae.items[he]),ce&&ce.push(ae.names[he]))}return new Vector(oe,te,ce)}),defineFunction(te,"Unique",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},ae=>te.varBank.unique(ae)),defineFunction(te,"Union",{object:[te.varBank,VectorObject],params:[{name:"Vector 1",needVector:!0},{name:"Vector 2",needVector:!0}]},ae=>te.varBank.unique(te.varBank.join(ae).items)),defineFunction(te,"Intersection",{object:[te.varBank,VectorObject],params:[{name:"Vector 1",needVector:!0},{name:"Vector 2",needVector:!0}]},ae=>{let oe=ae[0],ce=ae[1],he=[];for(let pe=0;pe<oe.items.length;pe++)for(let de=0;de<ce.items.length;de++)if(strictEquals(oe.items[pe],ce.items[de])){he.push(oe.items[pe]);break}return te.varBank.unique(he)}),defineFunction(te,"Difference",{object:[te.varBank,VectorObject],params:[{name:"Vector 1",needVector:!0},{name:"Vector 2",needVector:!0}]},ae=>{let oe=ae[0],ce=ae[1],he=[];for(let pe=0;pe<oe.items.length;pe++){let de=!1;for(let me=0;me<ce.items.length;me++)if(strictEquals(oe.items[pe],ce.items[me])){de=!0;break}de||he.push(oe.items[pe])}for(let pe=0;pe<ce.items.length;pe++){let de=!1;for(let me=0;me<oe.items.length;me++)if(strictEquals(ce.items[pe],oe.items[me])){de=!0;break}de||he.push(ce.items[pe])}return te.varBank.unique(he)}),defineFunction(te,"Factorial",{params:[{name:"Number",noUnits:!0,leafNeedNum:!0}],recurse:!0},ae=>new Material(factorial(toNum(ae[0]).value))),defineFunction(te,"Max",{params:{name:"Items..."},prep:ne},ae=>ae.stackApply(ce=>{let he=ce.items;if(he.length>0){let pe=he[0];for(let de=1;de<he.length;de++)greaterThan(he[de],pe)&&(pe=he[de]);return pe}else throw new ModelError("You must have at least one element to calculate a max.",{code:6017})})),defineFunction(te,"Max",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},ae=>te.varBank.max(ae));function ne(ae,oe,ce){if(!oe)for(let he=0;he<ae.length;he++)ae[he]=toNum(ae[he]);return ae.length===1&&ae[0]instanceof Vector?ce?ae[0]:te.varBank.flatten([ae[0]]):new Vector(se(ae),te)}function ie(ae){for(let oe=0;oe<ae.length;oe++)ae[oe].toNum&&(ae[oe]=toNum(ae[oe]));return ae.length===1&&ae[0]instanceof Vector?te.varBank.flatten([toNum(ae[0])]).items:ne(ae,void 0,!0).items}function se(ae){let oe=!1,ce;for(let he=0;he<ae.length;he++)if(ae[he]instanceof Vector){ce=ae[he],oe=!0;break}if(oe)for(let he=0;he<ae.length;he++)ae[he]instanceof Vector||(ae[he]=le(ce,ae[he]));return ae}function le(ae,oe){let ce=ae.fullClone();for(let he=0;he<ce.items.length;he++)ce.items[he]instanceof Vector?ce.items[he]=le(ce.items[he],oe):ce.items[he]=oe;return ce}defineFunction(te,"Lookup",{params:[{name:"Value",noVector:!0},{name:"Value Vector",needVector:!0},{name:"Results Vector",needVector:!0}]},ae=>{let oe=toNum(ae[0]),ce=toNum(ae[1]),he=toNum(ae[2]);if(ce.items.length!==he.items.length)throw new ModelError("The <i>value</i> and <i>results</i> vectors must be the same length",{code:6018});if(ce.items.length<1)throw new ModelError("You must have at least one element in your vectors",{code:6019});let pe=[];for(let de=0;de<ce.items.length;de++)pe.push({x:ce.items[de],y:he.items[de]});pe.sort((de,me)=>greaterThan(de.x,me.x)?1:lessThan(de.x,me.x)?-1:0);for(let de=0;de<pe.length;de++){if(eq(pe[de].x,oe))return pe[de].y.fullClone();if(greaterThan(pe[de].x,oe)){if(de===0)return pe[de].y.fullClone();let me=minus(pe[de].x,pe[de-1].x),ge=minus(oe,pe[de-1].x),we=minus(pe[de].x,oe),ve=div(we,me),_e=div(ge,me);return plus(mult(pe[de-1].y,ve),mult(pe[de].y,_e))}}return pe[pe.length-1].y.fullClone()}),defineFunction(te,"Fill",{object:[te.varBank,VectorObject],params:[{name:"Vector",needVector:!0},{name:"Value",allowBoolean:!0}]},ae=>le(ae[0],ae[1])),defineFunction(te,"Min",{params:{name:"Items..."},prep:ne},ae=>ae.stackApply(ce=>{let he=ce.items;if(he.length>0){let pe=he[0];for(let de=1;de<he.length;de++)lessThan(he[de],pe)&&(pe=he[de]);return pe}else throw new ModelError("You must have at least one element to calculate a min.",{code:6020})})),defineFunction(te,"Min",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},ae=>te.varBank.min(ae)),defineFunction(te,"Mean",{params:{name:"Items..."},prep:ie},ae=>{let oe=ae[0];for(let ce=1;ce<ae.length;ce++)oe=plus(oe,ae[ce]);return div(oe,new Material(ae.length))}),defineFunction(te,"Mean",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},ae=>te.varBank.mean(ae)),defineFunction(te,"Sum",{params:{name:"Items..."},prep:ie},ae=>{let oe=ae[0];for(let ce=1;ce<ae.length;ce++)oe=plus(oe,ae[ce]);return oe}),defineFunction(te,"Sum",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},ae=>te.varBank.sum(ae)),defineFunction(te,"Product",{params:{name:"Items..."},prep:ie},ae=>{let oe=ae[0];for(let ce=1;ce<ae.length;ce++)oe=mult(oe,ae[ce]);return oe}),defineFunction(te,"Product",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},ae=>te.varBank.product(ae)),defineFunction(te,"Median",{params:{name:"Items..."},prep:ne},ae=>ae.stackApply(ce=>{let he=te.varBank.sort([ce]).items;if(he.length>0)return Math.floor((he.length-1)/2)===(he.length-1)/2?he[(he.length-1)/2]:div(plus(he[Math.floor((he.length-1)/2)],he[Math.ceil((he.length-1)/2)]),new Material(2));throw new ModelError("You must have at least one element to calculate a median.",{code:6021})})),defineFunction(te,"Median",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},ae=>te.varBank.median(ae)),defineFunction(te,"StdDev",{params:{name:"Items..."},prep:ne},ae=>ae.stackApply(ce=>{let he=ce.items;if(he.length>1){let pe=te.varBank.mean(he),de=power(minus(he[0],pe),new Material(2));for(let ge=1;ge<he.length;ge++)de=plus(de,power(minus(he[ge],pe),new Material(2)));return power(div(de,new Material(he.length-1)),new Material(.5))}else throw new ModelError("You must have at least two elements to calculate the standard deviation.",{code:6022})})),defineFunction(te,"StdDev",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},ae=>te.varBank.stddev(ae)),defineFunction(te,"Correlation",{params:[{name:"Vector 1",needVector:!0},{name:"Vector 2",needVector:!0}]},ae=>{let oe=toNum(ae[0]),ce=toNum(ae[1]);if(oe.length()<=1)throw new ModelError("You must have at least two elements in your vectors to calculate their correlation.",{code:6023});if(oe.length()!==ce.length())throw new ModelError("The vectors for Correlation() must be of the same size.",{code:6024});let he=te.varBank.mean([oe]),pe=te.varBank.mean([ce]),de=te.varBank.stddev([oe]),me=te.varBank.stddev([ce]);return de.value===0||me.value===0?new Material(0):div(te.varBank.sum([mult(minus(oe.clone(),he),minus(ce.clone(),pe))]),mult(minus(te.varBank.count([oe]),new Material(1)),mult(de,me)))}),te.varBank.count=function(ae){return ae=te.varBank.join(ae).items,new Material(ae.length)},te.varBank.flatten=function(ae){let oe=ue(te.varBank.join(ae));return new Vector(oe.items,te,oe.hasName?oe.names:void 0)},defineFunction(te,"Keys",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},ae=>ae[0].names?new Vector(ae[0].names.filter(oe=>oe!==void 0).map(oe=>stringify(oe,te)),te):new Vector([],te)),defineFunction(te,"Values",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},ae=>new Vector(ae[0].items,te)),defineFunction(te,"Length",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},ae=>new Material(ae[0].items.length)),defineFunction(te,"Count",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},ae=>new Material(ae[0].items.length)),defineFunction(te,"Flatten",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},ae=>te.varBank.flatten(ae));function ue(ae){let oe=[],ce=[],he;for(let pe=0;pe<ae.length();pe++)if(ae.items[pe]instanceof Vector){let de=ue(ae.items[pe]);oe=oe.concat(de.items),ce=ce.concat(de.names),he=he||de.hasName}else oe.push(ae.items[pe]),ae.names?(ce.push(ae.names[pe]),he=!0):ce.push(void 0);return{items:oe,names:ce,hasName:he}}defineFunction(te,"CDFNormal",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Mean",defaultVal:0,noUnits:!0,noVector:!0},{name:"Standard Deviation",defaultVal:1,noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value,ce=ae[1]?toNum(ae[1]).value:0,he=ae[2]?toNum(ae[2]).value:1;return new Material(jStat.normal.cdf(oe,ce,he))}),defineFunction(te,"PDFNormal",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Mean",defaultVal:0,noUnits:!0,noVector:!0},{name:"Standard Deviation",defaultVal:1,noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value,ce=ae[1]?toNum(ae[1]).value:0,he=ae[2]?toNum(ae[2]).value:1;return new Material(jStat.normal.pdf(oe,ce,he))}),defineFunction(te,"InvNormal",{params:[{name:"p",noUnits:!0,noVector:!0},{name:"Mean",defaultVal:0,noUnits:!0,noVector:!0},{name:"Standard Deviation",defaultVal:1,noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value;if(oe<0||oe>1)throw new ModelError("<i>p</i> is a probability and must be between 0 and 1 inclusive.",{code:6025});let ce=ae[1]?toNum(ae[1]).value:0,he=ae[2]?toNum(ae[2]).value:1;return new Material(jStat.normal.inv(oe,ce,he))}),defineFunction(te,"CDFLogNormal",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Mean",defaultVal:0,noUnits:!0,noVector:!0},{name:"Standard Deviation",defaultVal:1,noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value,ce=ae[1]?toNum(ae[1]).value:0,he=ae[2]?toNum(ae[2]).value:1;return new Material(jStat.lognormal.cdf(oe,ce,he))}),defineFunction(te,"PDFLogNormal",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Mean",defaultVal:0,noUnits:!0,noVector:!0},{name:"Standard Deviation",defaultVal:1,noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value,ce=ae[1]?toNum(ae[1]).value:0,he=ae[2]?toNum(ae[2]).value:1;return new Material(jStat.lognormal.pdf(oe,ce,he))}),defineFunction(te,"InvLogNormal",{params:[{name:"p",noUnits:!0,noVector:!0},{name:"Mean",defaultVal:0,noUnits:!0,noVector:!0},{name:"Standard Deviation",defaultVal:1,noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value;if(oe<0||oe>1)throw new ModelError("<i>p</i> is a probability and must be between 0 and 1 inclusive.",{code:6026});let ce=ae[1]?toNum(ae[1]).value:0,he=ae[2]?toNum(ae[2]).value:1;return new Material(jStat.lognormal.inv(oe,ce,he))}),defineFunction(te,"CDFt",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Degrees of Freedom",noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value,ce=toNum(ae[1]).value;if(ce<=0)throw new ModelError("<i>Degrees of Freedom</i> must be greater than 0.",{code:6027});return new Material(jStat.studentt.cdf(oe,ce))}),defineFunction(te,"PDFt",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Degrees of Freedom",noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value,ce=toNum(ae[1]).value;if(ce<=0)throw new ModelError("<i>Degrees of Freedom</i> must be greater than 0.",{code:6028});return new Material(jStat.studentt.pdf(oe,ce))}),defineFunction(te,"Invt",{params:[{name:"p",noUnits:!0,noVector:!0},{name:"Degrees of Freedom",noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value;if(oe<0||oe>1)throw new ModelError("<i>p</i> is a probability and must be between 0 and 1 inclusive.",{code:6029});let ce=toNum(ae[1]).value;if(ce<=0)throw new ModelError("<i>Degrees of Freedom</i> must be greater than 0.",{code:6030});return new Material(jStat.studentt.inv(oe,ce))}),defineFunction(te,"CDFF",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Degrees of Freedom 1",noUnits:!0,noVector:!0},{name:"Degrees of Freedom 2",noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value,ce=toNum(ae[1]).value;if(ce<=0)throw new ModelError("<i>Degrees of Freedom</i> must be greater than 0.",{code:6031});let he=toNum(ae[2]).value;if(he<=0)throw new ModelError("<i>Degrees of Freedom</i> must be greater than 0.",{code:6032});return new Material(jStat.centralF.cdf(oe,ce,he))}),defineFunction(te,"PDFF",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Degrees of Freedom 1",noUnits:!0,noVector:!0},{name:"Degrees of Freedom 2",noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value,ce=toNum(ae[1]).value;if(ce<=0)throw new ModelError("<i>Degrees of Freedom 1</i> must be greater than 0.",{code:6033});let he=toNum(ae[2]).value;if(he<=0)throw new ModelError("<i>Degrees of Freedom 2</i> must be greater than 0.",{code:6034});return new Material(jStat.centralF.pdf(oe,ce,he))}),defineFunction(te,"InvF",{params:[{name:"p",noUnits:!0,noVector:!0},{name:"Degrees of Freedom 1",noUnits:!0,noVector:!0},{name:"Degrees of Freedom 2",noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value;if(oe<0||oe>1)throw new ModelError("<i>p</i> is a probability and must be between 0 and 1 inclusive.",{code:6035});let ce=toNum(ae[1]).value;if(ce<=0)throw new ModelError("<i>Degrees of Freedom 1</i> must be greater than 0.",{code:6036});let he=toNum(ae[2]).value;if(he<=0)throw new ModelError("<i>Degrees of Freedom</i> must be greater than 0.",{code:6037});return new Material(jStat.centralF.inv(oe,ce,he))}),defineFunction(te,"CDFChiSquared",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Degrees of Freedom",noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value,ce=toNum(ae[1]).value;if(ce<=0)throw new ModelError("<i>Degrees of Freedom</i> must be greater than 0.",{code:6038});return new Material(jStat.chisquare.cdf(oe,ce))}),defineFunction(te,"PDFChiSquared",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Degrees of Freedom",noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value,ce=toNum(ae[1]).value;if(ce<=0)throw new ModelError("<i>Degrees of Freedom</i> must be greater than 0.",{code:6039});return new Material(jStat.chisquare.pdf(oe,ce))}),defineFunction(te,"InvChiSquared",{params:[{name:"p",noUnits:!0,noVector:!0},{name:"Degrees of Freedom",noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value;if(oe<0||oe>1)throw new ModelError("<i>p</i> is a probability and must be between 0 and 1 inclusive.",{code:6040});let ce=toNum(ae[1]).value;if(ce<=0)throw new ModelError("<i>Degrees of Freedom</i> must be greater than 0.",{code:6041});return new Material(jStat.chisquare.inv(oe,ce))}),defineFunction(te,"CDFExponential",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Rate",noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value,ce=toNum(ae[1]).value;if(ce<=0)throw new ModelError("<i>Rate</i> must be greater than 0.",{code:6042});return new Material(jStat.exponential.cdf(oe,ce))}),defineFunction(te,"PDFExponential",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Rate",noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value,ce=toNum(ae[1]).value;if(ce<=0)throw new ModelError("<i>Rate</i> must be greater than 0.",{code:6043});return new Material(jStat.exponential.pdf(oe,ce))}),defineFunction(te,"InvExponential",{params:[{name:"p",noUnits:!0,noVector:!0},{name:"DRate",noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value;if(oe<0||oe>1)throw new ModelError("<i>p</i> is a probability and must be between 0 and 1 inclusive.",{code:6044});let ce=toNum(ae[1]).value;if(ce<=0)throw new ModelError("<i>Rate</i> must be greater than 0.",{code:6045});return new Material(jStat.exponential.inv(oe,ce))}),defineFunction(te,"CDFPoisson",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Lambda",noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value,ce=toNum(ae[1]).value;if(ce<=0)throw new ModelError("<i>Lambda</i> must be greater than 0.",{code:6046});return new Material(jStat.poisson.cdf(oe,ce))}),defineFunction(te,"PMFPoisson",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Lambda",noUnits:!0,noVector:!0}]},ae=>{let oe=toNum(ae[0]).value,ce=toNum(ae[1]).value;if(ce<=0)throw new ModelError("<i>Rate</i> must be greater than 0.",{code:6047});return new Material(jStat.poisson.pdf(oe,ce))}),defineFunction(te,"SetRandSeed",{params:[{name:"Seed Number",noUnits:!0,noVector:!0}]},ae=>(te.random=new SeedRandom.seedrandom(toNum(ae[0]).value),stringify("Random Seed Set",te))),defineFunction(te,"Alert",{params:[{name:"Message",allowString:!0,allowBoolean:!0}]},ae=>{if(typeof alert>"u")throw new ModelError("Alert() is not implemented on this platform.",{code:6048});return alert(ae[0]),new Material(1)}),defineFunction(te,"Console",{params:[{name:"Message",allowString:!0,allowBoolean:!0}]},ae=>(console.log(ae[0]),new Material(1))),defineFunction(te,"Prompt",{params:[{name:"Message",allowString:!0,allowBoolean:!0},{name:"Default",defaultVal:"",allowString:!0,allowBoolean:!0}]},ae=>{if(typeof prompt>"u")throw new ModelError("Prompt() is not implemented on this platform.",{code:6049});let oe=ae[1];return oe instanceof Material&&!oe.units&&(oe=oe.value),ae=prompt(ae[0],oe),parseFloat(ae).toString()===ae?new Material(parseFloat(ae)):ae===null?new Material(0):stringify(ae,te)}),defineFunction(te,"Confirm",{params:[{name:"Message",allowString:!0,allowBoolean:!0}]},ae=>{if(typeof window>"u"||typeof window.confirm>"u")throw new ModelError("Confirm() is not implemented on this platform.",{code:6050});return window.confirm(ae[0])}),defineFunction(te,"Parse",{object:StringObject,params:[{name:"String",allowString:!0}]},ae=>new Material(parseFloat(ae[0]))),defineFunction(te,"Split",{object:StringObject,params:[{name:"String",needString:!0},{name:"Splitter",needString:!0}]},ae=>stringify(new Vector(ae[0].split(ae[1]),te),te)),defineFunction(te,"Join",{object:VectorObject,params:[{name:"String",needVector:!0},{name:"Joiner",needString:!0}]},ae=>stringify(ae[0].items.join(ae[1]),te)),defineFunction(te,"Trim",{object:StringObject,params:[{name:"String",needString:!0}],recurse:!0},ae=>stringify(ae[0].trim(),te)),defineFunction(te,"Range",{object:StringObject,params:[{name:"String",needString:!0},{name:"Indexes",noUnits:!0,allowVector:!0}]},ae=>{if(ae[1]instanceof Vector){let oe="";for(let ce=0;ce<ae[1].items.length;ce++)oe+=ae[0].charAt(toNum(ae[1].items[ce]).value-1);return stringify(oe,te)}else return stringify(ae[0].charAt(toNum(ae[1]).value-1),te)}),defineFunction(te,"Length",{object:StringObject,params:[{name:"String",needString:!0}]},ae=>new Material(ae[0].length)),defineFunction(te,"IndexOf",{object:StringObject,params:[{name:"Haystack",needString:!0},{name:"Needle",needString:!0}]},ae=>new Material(ae[0].indexOf(ae[1])+1)),defineFunction(te,"Contains",{object:StringObject,params:[{name:"Haystack",needString:!0},{name:"Needle",needString:!0}]},ae=>!eq(StringObject.indexof(ae),new Material(0))),defineFunction(te,"Lowercase",{object:StringObject,params:[{name:"String",needString:!0}]},ae=>stringify(ae[0].toLowerCase(),te)),defineFunction(te,"Uppercase",{object:StringObject,params:[{name:"String",needString:!0}]},ae=>stringify(ae[0].toUpperCase(),te)),te.varBank.stringbase=makeObjectBase(StringObject,te),te.varBank.vectorbase=makeObjectBase(VectorObject,te)}function makeObjectBase(te,ee){let re=Object.keys(te),ne=[];for(let se of re)ne.push(objectizeFunction(te[se]));let ie=new Vector(ne,ee,re);return ie.parent=void 0,ie}function defineFunction(te,ee,re,ne){let ie=re.params,se=Array.isArray(ie),le=[],ue=ie.length;for(let he=0;he<ie.length;he++)if("defaultVal"in ie[he]){ue=he;break}for(let he=0;he<ie.length;he++)if(ie[he].vectorize&&(le.push(he),ie[he].noVector))throw new ModelError(`Cannot have a non-vector vectorized parameter. Function '${ee}', parameter '${ie[he].name}'.`,{code:6051});let ae,oe;se?(ae=ee+"("+ie.map(he=>he.name+("defaultVal"in he?"="+he.defaultVal.toString():"")).join(", ")+")",oe=ee+"("+ie.slice(1).map(he=>he.name+("defaultVal"in he?"="+he.defaultVal.toString():"")).join(", ")+")"):(ae=ee+"(items...)",oe=ee+"(items...)");let ce=function(he,pe,de,me={}){let ge;if(me.isObjectCaller?ge=oe:ge=ae,re.prep&&(he=re.prep(he)),se&&(he.length>ie.length||he.length<ue))throw new ModelError(`Wrong number of parameters for ${ge}.`,{code:6052});if(!se&&!he.length&&!re.allowEmpty)throw new ModelError(`At least one parameter required for ${ee}().`,{code:6053});for(let ve=0;ve<he.length;ve++){let _e=se?ie[ve]:ie;if(_e.noUnits&&toNum(he[ve])instanceof Material&&toNum(he[ve]).units&&!toNum(he[ve]).units.isUnitless())throw new ModelError(`${ge} does not accept units for the parameter '${_e.name}'.`,{code:6054});if(_e.noVector&&he[ve]instanceof Vector)throw new ModelError(`${ge} does not accept vectors for the parameter '${_e.name}'.`,{code:6055});if(_e.vectorize&&he[ve]instanceof Vector&&!he[ve].names)throw new ModelError(`${ge} does not accepted non-named vectors for the parameter '${_e.name}'.`,{code:6056});if(_e.needVector&&(he[ve]instanceof SPrimitive&&(he[ve]=toNum(he[ve])),!(he[ve]instanceof Vector)))throw new ModelError(`${ge} requires a vector for the parameter '${_e.name}'.`,{code:6057});if(_e.needNum&&(he[ve]instanceof SPrimitive&&(he[ve]=toNum(he[ve])),!(he[ve]instanceof Material)))throw new ModelError(`${ge} requires a number for the parameter '${_e.name}'.`,{code:6058});if(_e.needPrimitive&&!(he[ve]instanceof SPrimitive))throw new ModelError(`${ge} requires a primitive for the parameter '${_e.name}'.`,{code:6059});if(!_e.allowBoolean&&typeof he[ve]=="boolean")throw new ModelError(`${ge} does not accept boolean values for the parameter '${_e.name}'.`,{code:6060});if(_e.needAgent&&!(he[ve]instanceof SAgent)&&(he[ve]=agent(he[ve])),_e.needString&&!(typeof he[ve]=="string"||he[ve]instanceof String))throw new ModelError(`${ge} requires a string for the parameter '${_e.name}'.`,{code:6061});if(!_e.allowString&&!_e.needString&&(typeof he[ve]=="string"||he[ve]instanceof String))throw new ModelError(`${ge} does not accept string values for the parameter '${_e.name}'.`,{code:6062});if(_e.needAgents&&!(he[ve]instanceof SPopulation)&&(he[ve]=agents(he[ve])),_e.needPopulation&&!(he[ve]instanceof Vector)&&(he[ve]=getPopulation(he[ve],te)),_e.needFunction&&!(he[ve]instanceof Function||he[ve]instanceof UserFunction))throw new ModelError(`${ge} requires a function for the parameter '${_e.name}'.`,{code:6063})}let we;if(re.recurse&&(we=toNum(he[0]),ie[0]&&ie[0].leafNeedNum&&!(we instanceof Vector)&&!(we instanceof Material)))throw new ModelError(`${ge} requires a number for the parameter '${ie[0].name}'.`,{code:6058});if(re.recurse&&we instanceof Vector)return we.cloneApply(ve=>{if(!(ve instanceof Vector)&&ie[0]&&ie[0].leafNeedNum&&!(ve instanceof Material))throw new ModelError(`${ge} requires a number for the parameter '${ie[0].name}'.`,{code:6058});return ce([ve].concat(he.slice(1)),pe)});if(le.length>0){let ve,_e=-1;for(let Te=0;Te<le.length;Te++)if(he[le[Te]]){let ye=toNum(he[le[Te]]);if(ye instanceof Vector&&ye.namesLC){if(!ve)ve=ye,_e=le[Te];else if(!ve.keysMatch(ye.namesLC))throw new ModelError(`Vector keys do not match between parameters '${ie[_e].name}' and '${ie[le[Te]].name}' in ${ge}.`,{code:6064})}}if(ve){let Te=ve.namesLC,ye=[];for(let be=0;be<Te.length;be++){let Fe=[];for(let Oe=0;Oe<he.length;Oe++)if(le.indexOf(Oe)===-1)Fe.push(he[Oe]);else{let Se=toNum(he[Oe]);Se instanceof Vector&&Se.namesLC?Fe.push(Se.select([Te[be]])):Fe.push(Se)}let Le=ne(Fe,pe);if(Le instanceof Vector){if(!ve.keysMatch(Le.namesLC))throw new ModelError(`Vector keys do not match between parameter '${ie[_e].name}' and calculation result.`,{code:6065});ye.push(Le.select([Te[be]]))}else ye.push(Le)}return new Vector(ye,te,Te)}else return ne(he,pe)}else return ne(he,pe)};if(!re.object)te.varBank[ee.toLowerCase()]=ce;else if(re.object instanceof Array)for(let he=0;he<re.object.length;he++)re.object[he][ee.toLowerCase()]=ce;else re.object[ee.toLowerCase()]=ce;re.recurse&&(VectorObject[ee.toLowerCase()]=ce)}function objectizeFunction(te){let ee=function(re,ne,ie){if(!ie)throw new ModelError("Object function not used on object",{code:6066});return te([ie].concat(re),ne,ie,{isObjectCaller:!0})};return ee.delayEvalParams=te.delayEvalParams,ee}function factorial(te){if(Math.round(te)!==te)throw new ModelError("The factorial() function only accepts integers.",{code:6067});if(te<0)throw new ModelError("The factorial() function is only defined for integers 0 or larger.",{code:6068});return te>1?te*factorial(te-1):1}function testArgumentsSize(te,ee,re,ne){if(te.length<re||te.length>ne)throw new ModelError(`Wrong number of parameters for ${ee}().`,{code:6069})}let org={};(typeof org.antlr>"u"||!org.antlr)&&(org.antlr={});org.antlr.global={org};org.antlr.namespace=function(){var te=arguments,ee=null,re,ne,ie;for(re=0;re<te.length;re=re+1)for(ie=te[re].split("."),ee=org.antlr.global,ne=0;ne<ie.length;ne=ne+1)ee[ie[ne]]=ee[ie[ne]]||{},ee=ee[ie[ne]];return ee};org.antlr.env=org.antlr.env||{};org.antlr.env.ua=function(){var te={ie:0,opera:0,gecko:0,webkit:0,mobile:null,air:0,rhino:!1},ee,re;try{ee=navigator.userAgent,/KHTML/.test(ee)&&(te.webkit=1),re=ee.match(/AppleWebKit\/([^\s]*)/),re&&re[1]&&(te.webkit=parseFloat(re[1]),/ Mobile\//.test(ee)?te.mobile="Apple":(re=ee.match(/NokiaN[^\/]*/),re&&(te.mobile=re[0])),re=ee.match(/AdobeAIR\/([^\s]*)/),re&&(te.air=re[0])),te.webkit||(re=ee.match(/Opera[\s\/]([^\s]*)/),re&&re[1]?(te.opera=parseFloat(re[1]),re=ee.match(/Opera Mini[^;]*/),re&&(te.mobile=re[0])):(re=ee.match(/MSIE\s([^;]*)/),re&&re[1]?te.ie=parseFloat(re[1]):(re=ee.match(/Gecko\/([^\s]*)/),re&&(te.gecko=1,re=ee.match(/rv:([^\s\)]*)/),re&&re[1]&&(te.gecko=parseFloat(re[1]))))))}catch{}try{typeof window>"u"&&loadClass&&(te.rhino=!0)}catch{}return te}();org.antlr.namespace("org.antlr.runtime.tree");org.antlr.lang=org.antlr.lang||{isArray:function(te){if(te){var ee=org.antlr.lang;return ee.isNumber(te.length)&&ee.isFunction(te.splice)}return!1},isBoolean:function(te){return typeof te=="boolean"},isFunction:function(te){return typeof te=="function"},isNull:function(te){return te===null},isNumber:function(te){return typeof te=="number"&&isFinite(te)},isObject:function(te){return te&&(typeof te=="object"||org.antlr.lang.isFunction(te))||!1},isString:function(te){return typeof te=="string"},isUndefined:function(te){return typeof te>"u"},_IEEnumFix:function(te,ee){if(org.antlr.env.ua.ie){var re=["toString","valueOf"],ne;for(ne=0;ne<re.length;ne=ne+1){var ie=re[ne],se=ee[ie];org.antlr.lang.isFunction(se)&&se!=Object.prototype[ie]&&(te[ie]=se)}}},extend:function(te,ee,re){if(!ee||!te)throw new Error("org.antlr.lang.extend failed, please check that all dependencies are included.");var ne=function(){};if(ne.prototype=ee.prototype,te.prototype=new ne,te.prototype.constructor=te,te.superclass=ee.prototype,ee.prototype.constructor==Object.prototype.constructor&&(ee.prototype.constructor=ee),re){for(var ie in re)te.prototype[ie]=re[ie];org.antlr.lang._IEEnumFix(te.prototype,re)}},augmentObject:function(te,ee){if(!ee||!te)throw new Error("Absorb failed, verify dependencies.");var re=arguments,ne,ie,se=re[2];if(se&&se!==!0)for(ne=2;ne<re.length;ne=ne+1)te[re[ne]]=ee[re[ne]];else{for(ie in ee)(se||!te[ie])&&(te[ie]=ee[ie]);org.antlr.lang._IEEnumFix(te,ee)}},augmentProto:function(te,ee){if(!ee||!te)throw new Error("Augment failed, verify dependencies.");for(var re=[te.prototype,ee.prototype],ne=2;ne<arguments.length;ne=ne+1)re.push(arguments[ne]);org.antlr.lang.augmentObject.apply(this,re)},merge:function(){for(var te={},ee=arguments,re=0,ne=ee.length;re<ne;re=re+1)org.antlr.lang.augmentObject(te,ee[re],!0);return te},isValue:function(te){var ee=org.antlr.lang;return ee.isObject(te)||ee.isString(te)||ee.isNumber(te)||ee.isBoolean(te)},array:{peek:function(te){if(!org.antlr.lang.isArray(te))throw new Error("org.antlr.lang.array.peek: a is not an array.");var ee=te.length;if(ee<=0)throw new Error("org.antlr.lang.array.peek: a is empty.");return te[ee-1]}}};org.antlr.runtime.RecognizerSharedState=function(){this.following=[],this._fsp=-1,this.errorRecovery=!1,this.lastErrorIndex=-1,this.failed=!1,this.syntaxErrors=0,this.backtracking=0,this.ruleMemo=null,this.token=null,this.tokenStartCharIndex=-1,this.text=null};org.antlr.runtime.IndexOutOfBoundsException=function(te){org.antlr.runtime.IndexOutOfBoundsException.superclass.constructor.call(this,te)};org.antlr.lang.extend(org.antlr.runtime.IndexOutOfBoundsException,Error,{name:"org.antlr.runtime.IndexOutOfBoundsException"});org.antlr.runtime.RecognitionException=function(te){org.antlr.runtime.RecognitionException.superclass.constructor.call(this),this.input=te,this.index=te.index(),te instanceof org.antlr.runtime.CommonTokenStream&&(this.token=te.LT(1),this.line=this.token.getLine(),this.charPositionInLine=this.token.getCharPositionInLine()),te instanceof org.antlr.runtime.tree.TreeNodeStream?this.extractInformationFromTreeNodeStream(te):te instanceof org.antlr.runtime.ANTLRStringStream?(this.c=te.LA(1),this.line=te.getLine(),this.charPositionInLine=te.getCharPositionInLine()):this.c=te.LA(1),this.message=this.toString()};org.antlr.lang.extend(org.antlr.runtime.RecognitionException,Error,{input:null,index:null,token:null,node:null,c:null,line:null,name:"org.antlr.runtime.RecognitionException",charPositionInLine:null,approximateLineInfo:null,extractInformationFromTreeNodeStream:function(te){var ee=te,re,ne,ie,se;this.node=ee.LT(1);var le=ee.getTreeAdaptor(),ue=le.getToken(this.node);if(ue)if(this.token=ue,ue.getLine()<=0)for(se=-1,re=ee.LT(se);re;){if(priorPayload=le.getToken(re),priorPayload&&priorPayload.getLine()>0){this.line=priorPayload.getLine(),this.charPositionInLine=priorPayload.getCharPositionInLine(),this.approximateLineInfo=!0;break}--se,re=ee.LT(se)}else this.line=ue.getLine(),this.charPositionInLine=ue.getCharPositionInLine();else this.node instanceof org.antlr.runtime.tree.CommonTree?(this.line=this.node.getLine(),this.charPositionInLine=this.node.getCharPositionInLine(),this.node instanceof org.antlr.runtime.tree.CommonTree&&(this.token=this.node.token)):(ne=le.getType(this.node),ie=le.getText(this.node),this.token=new org.antlr.runtime.CommonToken(ne,ie))},getUnexpectedType:function(){if(this.input instanceof org.antlr.runtime.CommonTokenStream)return this.token.getType();if(this.input instanceof org.antlr.runtime.tree.TreeNodeStream){var te=this.input,ee=te.getTreeAdaptor();return ee.getType(this.node)}else return this.c}});org.antlr.runtime.MismatchedTokenException=function(te,ee){arguments.length===0?this.expecting=org.antlr.runtime.Token.INVALID_TOKEN_TYPE:(org.antlr.runtime.MismatchedTokenException.superclass.constructor.call(this,ee),this.expecting=te)};org.antlr.lang.extend(org.antlr.runtime.MismatchedTokenException,org.antlr.runtime.RecognitionException,{toString:function(){return"MismatchedTokenException("+this.getUnexpectedType()+"!="+this.expecting+")"},name:"org.antlr.runtime.MismatchedTokenException"});org.antlr.runtime.UnwantedTokenException=function(te,ee){arguments.length>0&&org.antlr.runtime.UnwantedTokenException.superclass.constructor.call(this,te,ee)};org.antlr.lang.extend(org.antlr.runtime.UnwantedTokenException,org.antlr.runtime.MismatchedTokenException,{getUnexpectedToken:function(){return this.token},toString:function(){var te=", expected "+this.expecting;return this.expecting===org.antlr.runtime.Token.INVALID_TOKEN_TYPE&&(te=""),org.antlr.lang.isValue(this.token)?"UnwantedTokenException(found="+this.token.getText()+te+")":"UnwantedTokenException(found="+te+")"},name:"org.antlr.runtime.UnwantedTokenException"});org.antlr.runtime.MissingTokenException=function(te,ee,re){arguments.length>0&&(org.antlr.runtime.MissingTokenException.superclass.constructor.call(this,te,ee),this.inserted=re)};org.antlr.lang.extend(org.antlr.runtime.MissingTokenException,org.antlr.runtime.MismatchedTokenException,{getMissingType:function(){return this.expecting},toString:function(){return org.antlr.lang.isValue(this.inserted)&&org.antlr.lang.isValue(this.token)?"MissingTokenException(inserted "+this.inserted+" at "+this.token.getText()+")":org.antlr.lang.isValue(this.token)?"MissingTokenException(at "+this.token.getText()+")":"MissingTokenException"},name:"org.antlr.runtime.MissingTokenException"});org.antlr.runtime.NoViableAltException=function(te,ee,re,ne){org.antlr.runtime.NoViableAltException.superclass.constructor.call(this,ne),this.grammarDecisionDescription=te,this.decisionNumber=ee,this.stateNumber=re};org.antlr.lang.extend(org.antlr.runtime.NoViableAltException,org.antlr.runtime.RecognitionException,{toString:function(){return this.input instanceof org.antlr.runtime.ANTLRStringStream?"NoViableAltException('"+this.getUnexpectedType()+"'@["+this.grammarDecisionDescription+"])":"NoViableAltException("+this.getUnexpectedType()+"@["+this.grammarDecisionDescription+"])"},name:"org.antlr.runtime.NoViableAltException"});org.antlr.runtime.EarlyExitException=function(te,ee){org.antlr.runtime.EarlyExitException.superclass.constructor.call(this,ee),this.decisionNumber=te};org.antlr.lang.extend(org.antlr.runtime.EarlyExitException,org.antlr.runtime.RecognitionException,{name:"org.antlr.runtime.EarlyExitException"});org.antlr.runtime.MismatchedSetException=function(te,ee){org.antlr.runtime.MismatchedSetException.superclass.constructor.call(this,ee),this.expecting=te};org.antlr.lang.extend(org.antlr.runtime.MismatchedSetException,org.antlr.runtime.RecognitionException,{toString:function(){return"MismatchedSetException("+this.getUnexpectedType()+"!="+this.expecting+")"},name:"org.antlr.runtime.MismatchedSetException"});org.antlr.runtime.MismatchedNotSetException=function(te,ee){org.antlr.runtime.MismatchedNotSetException.superclass.constructor.call(this,te,ee)};org.antlr.lang.extend(org.antlr.runtime.MismatchedNotSetException,org.antlr.runtime.MismatchedSetException,{toString:function(){return"MismatchedNotSetException("+this.getUnexpectedType()+"!="+this.expecting+")"},name:"org.antlr.runtime.MismatchedNotSetException"});org.antlr.runtime.MismatchedRangeException=function(te,ee,re){if(arguments.length===0)return this;org.antlr.runtime.MismatchedRangeException.superclass.constructor.call(this,re),this.a=te,this.b=ee};org.antlr.lang.extend(org.antlr.runtime.MismatchedRangeException,org.antlr.runtime.RecognitionException,{toString:function(){return"MismatchedRangeException("+this.getUnexpectedType()+" not in ["+this.a+","+this.b+"])"},name:"org.antlr.runtime.MismatchedRangeException"});org.antlr.runtime.FailedPredicateException=function(te,ee,re){org.antlr.runtime.FailedPredicateException.superclass.constructor.call(this,te),this.ruleName=ee,this.predicateText=re};org.antlr.lang.extend(org.antlr.runtime.FailedPredicateException,org.antlr.runtime.RecognitionException,{toString:function(){return"FailedPredicateException("+this.ruleName+",{"+this.predicateText+"}?)"},name:"org.antlr.runtime.FailedPredicateException"});org.antlr.runtime.BitSet=function(te){te||(te=org.antlr.runtime.BitSet.BITS),org.antlr.lang.isArray(te)?this.bits=te:org.antlr.lang.isNumber(te)&&(this.bits=[])};org.antlr.lang.augmentObject(org.antlr.runtime.BitSet,{BITS:32,LOG_BITS:5,MOD_MASK:31,bitMask:function(te){var ee=te&org.antlr.runtime.BitSet.MOD_MASK;return 1<<ee},numWordsToHold:function(te){return(te>>org.antlr.runtime.BitSet.LOG_BITS)+1},wordNumber:function(te){return te>>org.antlr.runtime.BitSet.LOG_BITS},of:function(te,ee){var re,ne,ie,se;if(org.antlr.lang.isNumber(te))if(org.antlr.lang.isNumber(ee)){for(ie=new org.antlr.runtime.BitSet(ee+1),re=te;re<=ee;re++)ne=org.antlr.runtime.BitSet.wordNumber(re),ie.bits[ne]|=org.antlr.runtime.BitSet.bitMask(re);return ie}else return ie=new org.antlr.runtime.BitSet(te+1),ie.add(te),ie;else if(org.antlr.lang.isArray(te)){for(ie=new org.antlr.runtime.BitSet,re=te.length-1;re>=0;re--)ie.add(te[re]);return ie}else{if(te instanceof org.antlr.runtime.BitSet)return te||null;if(te instanceof org.antlr.runtime.IntervalSet)return te?(ie=new org.antlr.runtime.BitSet,ie.addAll(te),ie):null;if(org.antlr.lang.isObject(te)){se=[];for(re in te)org.antlr.lang.isNumber(re)&&se.push(re);return org.antlr.runtime.BitSet.of(se)}}}});org.antlr.runtime.BitSet.prototype={add:function(te){var ee=org.antlr.runtime.BitSet.wordNumber(te);ee>=this.bits.length&&this.growToInclude(te),this.bits[ee]|=org.antlr.runtime.BitSet.bitMask(te)},addAll:function(te){var ee,re;if(te instanceof org.antlr.runtime.BitSet)this.orInPlace(te);else if(!(te instanceof org.antlr.runtime.IntervalSet))if(org.antlr.lang.isArray(te))for(ee=0;ee<te.length;ee++)re=te[ee],this.add(re);else return},and:function(te){var ee=this.clone();return ee.andInPlace(te),ee},andInPlace:function(te){var ee=Math.min(this.bits.length,te.bits.length),re;for(re=ee-1;re>=0;re--)this.bits[re]&=te.bits[re];for(re=ee;re<this.bits.length;re++)this.bits[re]=0},clear:function(te){if(arguments.length===0){var ee;for(ee=this.bits.length-1;ee>=0;ee--)this.bits[ee]=0;return}var re=org.antlr.runtime.BitSet.wordNumber(te);re>=this.bits.length&&this.growToInclude(te),this.bits[re]&=~org.antlr.runtime.BitSet.bitMask(te)},clone:function(){var te,ee,re=[];for(te=0,ee=this.bits.length;te<ee;te++)re[te]=this.bits[te];return new org.antlr.runtime.BitSet(re)},size:function(){var te=0,ee,re,ne;for(ee=this.bits.length-1;ee>=0;ee--)if(re=this.bits[ee],re!==0)for(ne=org.antlr.runtime.BitSet.BITS-1;ne>=0;ne--)re&1<<ne&&te++;return te},equals:function(te){if(!te||!(te instanceof org.antlr.runtime.BitSet))return!1;var ee=te,re,ne=Math.min(this.bits.length,ee.bits.length);for(re=0;re<ne;re++)if(this.bits[re]!=ee.bits[re])return!1;if(this.bits.length>ne){for(re=ne+1;re<this.bits.length;re++)if(this.bits[re]!==0)return!1}else if(ee.bits.length>ne){for(re=ne+1;re<ee.bits.length;re++)if(ee.bits[re]!==0)return!1}return!0},growToInclude:function(te){Math.max(this.bits.length<<1,org.antlr.runtime.BitSet.numWordsToHold(te));var ee=[],re;for(re=0,len=this.bits.length;re<len;re++)ee[re]=this.bits[re];this.bits=ee},member:function(te){var ee=org.antlr.runtime.BitSet.wordNumber(te);return ee>=this.bits.length?!1:(this.bits[ee]&org.antlr.runtime.BitSet.bitMask(te))!==0},getSingleElement:function(){var te;for(te=0;te<this.bits.length<<org.antlr.runtime.BitSet.LOG_BITS;te++)if(this.member(te))return te;return-1},isNil:function(){var te;for(te=this.bits.length-1;te>=0;te--)if(this.bits[te]!==0)return!1;return!0},complement:function(te){if(te)return te.subtract(this);var ee=this.clone();return ee.notInPlace(),ee},notInPlace:function(){var te,ee,re,ne;if(arguments.length===0)for(re=this.bits.length-1;re>=0;re--)this.bits[re]=~this.bits[re];else for(arguments.length===1?(te=0,ee=arguments[0]):(te=arguments[0],ee=arguments[1]),this.growToInclude(ee),re=te;re<=ee;re++)ne=org.antlr.runtime.BitSet.wordNumber(re),this.bits[ne]^=org.antlr.runtime.BitSet.bitMask(re)},or:function(te){if(!te)return this;var ee=this.clone();return ee.orInPlace(te),ee},orInPlace:function(te){if(te){te.bits.length>this.bits.length&&this.setSize(te.bits.length);var ee=Math.min(this.bits.length,te.bits.length),re;for(re=ee-1;re>=0;re--)this.bits[re]|=te.bits[re]}},remove:function(te){var ee=org.antlr.runtime.BitSet.wordNumber(te);ee>=this.bits.length&&this.growToInclude(te),this.bits[ee]&=~org.antlr.runtime.BitSet.bitMask(te)},setSize:function(te){for(var ee=te-this.bits.length;ee>=0;)this.bits.push(0),ee--},numBits:function(){return this.bits.length<<org.antlr.runtime.BitSet.LOG_BITS},lengthInLongWords:function(){return this.bits.length},subset:function(te){return te?this.and(te).equals(this):!1},subtractInPlace:function(te){if(te){var ee;for(ee=0;ee<this.bits.length&&ee<te.bits.length;ee++)this.bits[ee]&=~te.bits[ee]}},subtract:function(te){if(!te||!(te instanceof org.antlr.runtime.BitSet))return null;var ee=this.clone();return ee.subtractInPlace(te),ee},toArray:function(){var te=[],ee,re=0;for(ee=0;ee<this.bits.length<<org.antlr.runtime.BitSet.LOG_BITS;ee++)this.member(ee)&&(te[re++]=ee);return te},toPackedArray:function(){return this.bits},toString:function(){return arguments.length===0?this.toString1(null):org.antlr.lang.isString(arguments[0])?org.antlr.lang.isValue(arguments[1])?this.toString2(arguments[0],arguments[1]):this.toString1(null):this.toString1(arguments[0])},toString1:function(te){var ee="{",re=",",ne,ie=!1;for(ne=0;ne<this.bits.length<<org.antlr.runtime.BitSet.LOG_BITS;ne++)this.member(ne)&&(ne>0&&ie&&(ee+=re),te?ee+=te.getTokenDisplayName(ne):ee+=ne.toString(),ie=!0);return ee+"}"},toString2:function(te,ee){var re="",ne;for(ne=0;ne<this.bits.length<<org.antlr.runtime.BitSet.LOG_BITS;ne++)this.member(ne)&&(re.length>0&&(re+=te),ne>=ee.size()?re+="'"+ne+"'":org.antlr.lang.isValue(ee.get(ne))?re+=ee.get(ne):re+="'"+ne+"'");return re}};org.antlr.runtime.CharStream={EOF:-1};org.antlr.runtime.CommonToken=function(){var te;this.charPositionInLine=-1,this.channel=0,this.index=-1,arguments.length==1?org.antlr.lang.isNumber(arguments[0])?this.type=arguments[0]:(te=arguments[0],this.text=te.getText(),this.type=te.getType(),this.line=te.getLine(),this.index=te.getTokenIndex(),this.charPositionInLine=te.getCharPositionInLine(),this.channel=te.getChannel(),te instanceof org.antlr.runtime.CommonToken&&(this.start=te.start,this.stop=te.stop)):arguments.length==2?(this.type=arguments[0],this.text=arguments[1],this.channel=0):arguments.length==5&&(this.input=arguments[0],this.type=arguments[1],this.channel=arguments[2],this.start=arguments[3],this.stop=arguments[4])};org.antlr.runtime.CommonToken.prototype={getType:function(){return this.type},setLine:function(te){this.line=te},getText:function(){return org.antlr.lang.isString(this.text)?this.text:this.input?(this.text=this.input.substring(this.start,this.stop),this.text):null},setText:function(te){this.text=te},getLine:function(){return this.line},getCharPositionInLine:function(){return this.charPositionInLine},setCharPositionInLine:function(te){this.charPositionInLine=te},getChannel:function(){return this.channel},setChannel:function(te){this.channel=te},setType:function(te){this.type=te},getStartIndex:function(){return this.start},setStartIndex:function(te){this.start=te},getStopIndex:function(){return this.stop},setStopIndex:function(te){this.stop=te},getTokenIndex:function(){return this.index},setTokenIndex:function(te){this.index=te},getInputStream:function(){return this.input},setInputStream:function(te){this.input=te},toString:function(){var te="";this.channel>0&&(te=",channel="+this.channel);var ee=this.getText();return org.antlr.lang.isNull(ee)?ee="<no text>":(ee=ee.replace(/\n/g,"\\\\n"),ee=ee.replace(/\r/g,"\\\\r"),ee=ee.replace(/\t/g,"\\\\t")),"[@"+this.getTokenIndex()+","+this.start+":"+this.stop+"='"+ee+"',<"+this.type+">"+te+","+this.line+":"+this.getCharPositionInLine()+"]"}};org.antlr.runtime.Token=function(){};org.antlr.lang.augmentObject(org.antlr.runtime.Token,{EOR_TOKEN_TYPE:1,DOWN:2,UP:3,MIN_TOKEN_TYPE:4,EOF:org.antlr.runtime.CharStream.EOF,EOF_TOKEN:new org.antlr.runtime.CommonToken(org.antlr.runtime.CharStream.EOF),INVALID_TOKEN_TYPE:0,INVALID_TOKEN:new org.antlr.runtime.CommonToken(0),SKIP_TOKEN:new org.antlr.runtime.CommonToken(0),DEFAULT_CHANNEL:0,HIDDEN_CHANNEL:99});org.antlr.lang.augmentObject(org.antlr.runtime.CommonToken,org.antlr.runtime.Token);org.antlr.runtime.tree.RewriteCardinalityException=function(te){this.elementDescription=te};org.antlr.lang.extend(org.antlr.runtime.tree.RewriteCardinalityException,Error,{getMessage:function(){return org.antlr.lang.isString(this.elementDescription)?this.elementDescription:null},name:function(){return"org.antlr.runtime.tree.RewriteCardinalityException"}});org.antlr.runtime.tree.RewriteEmptyStreamException=function(te){var ee=org.antlr.runtime.tree.RewriteEmptyStreamException.superclass;ee.constructor.call(this,te)};org.antlr.lang.extend(org.antlr.runtime.tree.RewriteEmptyStreamException,org.antlr.runtime.tree.RewriteCardinalityException,{name:function(){return"org.antlr.runtime.tree.RewriteEmptyStreamException"}});org.antlr.runtime.tree.RewriteEarlyExitException=function(te){var ee=org.antlr.runtime.tree.RewriteEarlyExitException.superclass;org.antlr.lang.isUndefined(te)&&(te=null),ee.constructor.call(this,te)};org.antlr.lang.extend(org.antlr.runtime.tree.RewriteEarlyExitException,org.antlr.runtime.tree.RewriteCardinalityException,{name:function(){return"org.antlr.runtime.tree.RewriteEarlyExitException"}});org.antlr.runtime.MismatchedTreeNodeException=function(te,ee){te&&ee&&(org.antlr.runtime.MismatchedTreeNodeException.superclass.constructor.call(this,ee),this.expecting=te)};org.antlr.lang.extend(org.antlr.runtime.MismatchedTreeNodeException,org.antlr.runtime.RecognitionException,{toString:function(){return"MismatchedTreeNodeException("+this.getUnexpectedType()+"!="+this.expecting+")"},name:"org.antlr.runtime.MismatchedTreeNodeException"});org.antlr.runtime.tree.BaseTree=function(){};org.antlr.runtime.tree.BaseTree.prototype={getChild:function(te){return!this.children||te>=this.children.length?null:this.children[te]},getChildren:function(){return this.children},getFirstChildWithType:function(te){var ee,re;for(ee=0;this.children&&ee<this.children.length;ee++)if(re=this.children[ee],re.getType()===te)return re;return null},getChildCount:function(){return this.children?this.children.length:0},addChild:function(te){if(org.antlr.lang.isValue(te)){var ee=te,re,ne,ie;if(ee.isNil()){if(this.children&&this.children==ee.children)throw new Error("attempt to add child list to itself");if(ee.children)if(this.children)for(re=ee.children.length,ne=0;ne<re;ne++)ie=ee.children[ne],this.children.push(ie),ie.setParent(this),ie.setChildIndex(this.children.length-1);else this.children=ee.children,this.freshenParentAndChildIndexes()}else this.children||(this.children=this.createChildrenList()),this.children.push(te),ee.setParent(this),ee.setChildIndex(this.children.length-1)}},addChildren:function(te){var ee,re;for(ee=0;ee<te.length;ee++)re=te[ee],this.addChild(re)},setChild:function(te,ee){if(ee){if(ee.isNil())throw new Error("Can't set single child to a list");this.children||(this.children=this.createChildrenList()),this.children[te]=ee,ee.setParent(this),ee.setChildIndex(te)}},deleteChild:function(te){if(!this.children)return null;if(te<0||te>=this.children.length)throw new Error("Index out of bounds.");var ee=this.children.splice(te,1)[0];return this.freshenParentAndChildIndexes(te),ee},replaceChildren:function(te,ee,re){if(!this.children)throw new Error("indexes invalid; no children in list");var ne=ee-te+1,ie,se=re,le=null;se.isNil()?le=se.children:(le=[],le.push(se)),ie=le.length;var ue=le.length,ae=ne-ie,oe,ce,he,pe,de;if(ae===0)for(oe=0,ce=te;ce<=ee;ce++)he=le[oe],this.children[ce]=he,he.setParent(this),he.setChildIndex(ce),oe++;else if(ae>0){for(oe=0;oe<ue;oe++)this.children[te+oe]=le[oe];for(pe=te+ue,de=pe;de<=ee;de++)this.children.splice(pe,1)[0];this.freshenParentAndChildIndexes(te)}else{for(oe=0;oe<ne;oe++)this.children[te+oe]=le[oe];for(oe=ne;oe<ie;oe++)this.children.splice(te+oe,0,le[oe]);this.freshenParentAndChildIndexes(te)}},createChildrenList:function(){return[]},isNil:function(){return!1},freshenParentAndChildIndexes:function(te){org.antlr.lang.isNumber(te)||(te=0);var ee=this.getChildCount(),re,ne;for(re=te;re<ee;re++)ne=this.getChild(re),ne.setChildIndex(re),ne.setParent(this)},sanityCheckParentAndChildIndexes:function(te,ee){if(arguments.length===0&&(te=null,ee=-1),te!==this.getParent())throw new Error("parents don't match; expected "+te+" found "+this.getParent());if(ee!==this.getChildIndex())throw new Error("child indexes don't match; expected "+ee+" found "+this.getChildIndex());var re=this.getChildCount(),ne,ie;for(ne=0;ne<re;ne++)ie=this.getChild(ne),ie.sanityCheckParentAndChildIndexes(this,ne)},getChildIndex:function(){return 0},setChildIndex:function(te){},getParent:function(){return null},setParent:function(te){},getTree:function(){return this},toStringTree:function(){if(!this.children||this.children.length===0)return this.toString();var te="",ee,re;for(this.isNil()||(te+="(",te+=this.toString(),te+=" "),ee=0;this.children&&ee<this.children.length;ee++)re=this.children[ee],ee>0&&(te+=" "),te+=re.toStringTree();return this.isNil()||(te+=")"),te},getLine:function(){return 0},getCharPositionInLine:function(){return 0}};org.antlr.runtime.tree.CommonTree=function(te){this.startIndex=-1,this.stopIndex=-1,this.childIndex=-1,this.parent=null,this.token=null,te instanceof org.antlr.runtime.tree.CommonTree?(org.antlr.runtime.tree.CommonTree.superclass.constructor.call(this,te),this.token=te.token,this.startIndex=te.startIndex,this.stopIndex=te.stopIndex):te instanceof org.antlr.runtime.CommonToken&&(this.token=te)};org.antlr.lang.extend(org.antlr.runtime.tree.CommonTree,org.antlr.runtime.tree.BaseTree,{getToken:function(){return this.token},dupNode:function(){return new org.antlr.runtime.tree.CommonTree(this)},isNil:function(){return!this.token},getType:function(){return this.token?this.token.getType():org.antlr.runtime.Token.INVALID_TOKEN_TYPE},getText:function(){return this.token?this.token.getText():null},getLine:function(){return!this.token||this.token.getLine()===0?this.getChildCount()>0?this.getChild(0).getLine():0:this.token.getLine()},getCharPositionInLine:function(){return!this.token||this.token.getCharPositionInLine()===-1?this.getChildCount()>0?this.getChild(0).getCharPositionInLine():0:this.token.getCharPositionInLine()},getTokenStartIndex:function(){return this.token?this.token.getTokenIndex():this.startIndex},setTokenStartIndex:function(te){this.startIndex=te},getTokenStopIndex:function(){return this.token?this.token.getTokenIndex():this.stopIndex},setTokenStopIndex:function(te){this.stopIndex=te},getChildIndex:function(){return this.childIndex},getParent:function(){return this.parent},setParent:function(te){this.parent=te},setChildIndex:function(te){this.childIndex=te},toString:function(){return this.isNil()?"nil":this.getType()===org.antlr.runtime.Token.INVALID_TOKEN_TYPE?"<errornode>":this.token?this.token.getText():null}});org.antlr.runtime.tree.Tree={INVALID_NODE:new org.antlr.runtime.tree.CommonTree(org.antlr.runtime.Token.INVALID_TOKEN)};org.antlr.runtime.tree.CommonErrorNode=function(te,ee,re,ne){(!re||re.getTokenIndex()<ee.getTokenIndex()&&re.getType()!=org.antlr.runtime.Token.EOF)&&(re=ee),this.input=te,this.start=ee,this.stop=re,this.trappedException=ne};org.antlr.lang.extend(org.antlr.runtime.tree.CommonErrorNode,org.antlr.runtime.tree.CommonTree,{isNil:function(){return!1},getType:function(){return org.antlr.runtime.Token.INVALID_TOKEN_TYPE},getText:function(){var te=null;if(this.start instanceof org.antlr.runtime.CommonToken){var ee=this.start.getTokenIndex(),re=this.stop.getTokenIndex();this.stop.getType()===org.antlr.runtime.Token.EOF&&(re=this.input.size()),te=this.input.toString(ee,re)}else this.start instanceof org.antlr.runtime.tree.CommonTree?te=this.input.toString(this.start,this.stop):te="<unknown>";return te},toString:function(){return this.trappedException instanceof org.antlr.runtime.MissingTokenException?"<missing type: "+this.trappedException.getMissingType()+">":this.trappedException instanceof org.antlr.runtime.UnwantedTokenException?"<extraneous: "+this.trappedException.getUnexpectedToken()+", resync="+this.getText()+">":this.trappedException instanceof org.antlr.runtime.MismatchedTokenException?"<mismatched token: "+this.trappedException.token+", resync="+this.getText()+">":this.trappedException instanceof org.antlr.runtime.NoViableAltException?"<unexpected: "+this.trappedException.token+", resync="+this.getText()+">":"<error: "+this.getText()+">"}});org.antlr.runtime.tree.BaseTreeAdaptor=function(){this.uniqueNodeID=1};org.antlr.runtime.tree.BaseTreeAdaptor.prototype={nil:function(){return this.create(null)},errorNode:function(te,ee,re,ne){var ie=new org.antlr.runtime.tree.CommonErrorNode(te,ee,re,ne);return ie},isNil:function(te){return te.isNil()},dupTree:function(te,ee){if(arguments.length===1&&(ee=null),!te)return null;var re=this.dupNode(te);this.setChildIndex(re,this.getChildIndex(te)),this.setParent(re,ee);var ne=this.getChildCount(te),ie,se,le;for(ie=0;ie<ne;ie++)se=this.getChild(te,ie),le=this.dupTree(se,te),this.addChild(re,le);return re},addChild:function(te,ee){te&&org.antlr.lang.isValue(ee)&&te.addChild(ee)},becomeRoot:function(te,ee){(te instanceof org.antlr.runtime.CommonToken||!te)&&(te=this.create(te));var re=te,ne=ee;if(!ee)return te;if(re.isNil()){if(re.getChildCount()>1)throw new Error("more than one node as root (TODO: make exception hierarchy)");re=re.getChild(0)}return re.addChild(ne),re},rulePostProcessing:function(te){var ee=te;return ee&&ee.isNil()&&(ee.getChildCount()===0?ee=null:ee.getChildCount()===1&&(ee=ee.getChild(0),ee.setParent(null),ee.setChildIndex(-1))),ee},create:function(te,ee){var re,ne;if(arguments.length===2)return org.antlr.lang.isString(arguments[1])?(re=arguments[1],ee=this.createToken(te,re),ne=this.create(ee),ne):(ee=this.createToken(ee),ee.setType(te),ne=this.create(ee),ne);if(arguments.length===3)return re=arguments[2],ee=this.createToken(ee),ee.setType(te),ee.setText(re),ne=this.create(ee),ne},getType:function(te){return te.getType(),0},setType:function(te,ee){throw new Error("don't know enough about Tree node")},getText:function(te){return te.getText()},setText:function(te,ee){throw new Error("don't know enough about Tree node")},getChild:function(te,ee){return te.getChild(ee)},setChild:function(te,ee,re){te.setChild(ee,re)},deleteChild:function(te,ee){return te.deleteChild(ee)},getChildCount:function(te){return te.getChildCount()},getUniqueID:function(te){this.treeToUniqueIDMap||(this.treeToUniqueIDMap={});var ee=this.treeToUniqueIDMap[te];if(org.antlr.lang.isValue(ee))return ee;var re=this.uniqueNodeID;return this.treeToUniqueIDMap[te]=re,this.uniqueNodeID++,re}};org.antlr.runtime.tree.CommonTreeAdaptor=function(){};org.antlr.lang.extend(org.antlr.runtime.tree.CommonTreeAdaptor,org.antlr.runtime.tree.BaseTreeAdaptor,{dupNode:function(te){return org.antlr.lang.isValue(te)?te.dupNode():null},create:function(te){return arguments.length>1?org.antlr.runtime.tree.CommonTreeAdaptor.superclass.create.apply(this,arguments):new org.antlr.runtime.tree.CommonTree(te)},createToken:function(te){return arguments.length===2?new org.antlr.runtime.CommonToken(arguments[0],arguments[1]):new org.antlr.runtime.CommonToken(arguments[0])},setTokenBoundaries:function(te,ee,re){if(org.antlr.lang.isValue(te)){var ne=0,ie=0;org.antlr.lang.isValue(ee)&&(ee.getTokenIndex?ne=ee.getTokenIndex():ee.getStartIndex?ne=ee.getStartIndex():ne=ee.getTokenStartIndex()),org.antlr.lang.isValue(re)&&(ie.getTokenIndex?ie=re.getTokenIndex():re.getStopIndex?ie=re.getStopIndex():ie=re.getTokenStopIndex()),te.setTokenStartIndex(ne),te.setTokenStopIndex(ie)}},getTokenStartIndex:function(te){return te?te.getTokenStartIndex():-1},getTokenStopIndex:function(te){return te?te.getTokenStopIndex():-1},getText:function(te){return te?te.getText():null},getType:function(te){return te?te.getType():org.antlr.runtime.Token.INVALID_TOKEN_TYPE},getToken:function(te){return te instanceof org.antlr.runtime.tree.CommonTree?te.getToken():null},getChild:function(te,ee){return te?te.getChild(ee):null},getChildCount:function(te){return te?te.getChildCount():0},getParent:function(te){return te.getParent()},setParent:function(te,ee){te.setParent(ee)},getChildIndex:function(te){return te.getChildIndex()},setChildIndex:function(te,ee){te.setChildIndex(ee)},replaceChildren:function(te,ee,re,ne){te&&te.replaceChildren(ee,re,ne)}});org.antlr.runtime.ANTLRStringStream=function(te){this.p=0,this.line=1,this.charPositionInLine=0,this.markDepth=0,this.markers=null,this.lastMarker=null,this.data=te,this.n=te.length};org.antlr.runtime.ANTLRStringStream.prototype={reset:function(){this.p=0,this.line=1,this.charPositionInLine=0,this.markDepth=0},consume:function(){this.p<this.n&&(this.charPositionInLine++,this.data.charAt(this.p)===`
`&&(this.line++,this.charPositionInLine=0),this.p++)},LA:function(te){te<0&&te++;var ee=this.p+te-1;return ee>=this.n||ee<0?org.antlr.runtime.CharStream.EOF:this.data.charAt(ee)},index:function(){return this.p},size:function(){return this.n},mark:function(){this.markers||(this.markers=[],this.markers.push(null)),this.markDepth++;var te=null;return this.markDepth>=this.markers.length?(te={},this.markers.push(te)):te=this.markers[this.markDepth],te.p=this.p,te.line=this.line,te.charPositionInLine=this.charPositionInLine,this.lastMarker=this.markDepth,this.markDepth},rewind:function(te){org.antlr.lang.isNumber(te)||(te=this.lastMarker);var ee=this.markers[te];this.seek(ee.p),this.line=ee.line,this.charPositionInLine=ee.charPositionInLine,this.release(te)},release:function(te){this.markDepth=te,this.markDepth--},seek:function(te){if(te<=this.p){this.p=te;return}for(;this.p<te;)this.consume()},substring:function(te,ee){return this.data.substr(te,ee-te+1)},getLine:function(){return this.line},getCharPositionInLine:function(){return this.charPositionInLine},setLine:function(te){this.line=te},setCharPositionInLine:function(te){this.charPositionInLine=te},getSourceName:function(){return null}};org.antlr.runtime.ANTLRStringStream.LT=org.antlr.runtime.ANTLRStringStream.LA;org.antlr.runtime.CommonTokenStream=function(te,ee){this.p=-1,this.channel=org.antlr.runtime.Token.DEFAULT_CHANNEL,this.v_discardOffChannelTokens=!1,this.tokens=[],arguments.length>=2?this.channel=ee:arguments.length===1&&(this.tokenSource=te)};org.antlr.runtime.CommonTokenStream.prototype={setTokenSource:function(te){this.tokenSource=te,this.tokens=[],this.p=-1,this.channel=org.antlr.runtime.Token.DEFAULT_CHANNEL},fillBuffer:function(){for(var te=0,ee=this.tokenSource.nextToken(),re,ne;org.antlr.lang.isValue(ee)&&ee.getType()!=org.antlr.runtime.CharStream.EOF;)re=!1,this.channelOverrideMap&&(ne=this.channelOverrideMap[ee.getType()],org.antlr.lang.isValue(ne)&&ee.setChannel(ne)),(this.discardSet&&this.discardSet[ee.getType()]||this.v_discardOffChannelTokens&&ee.getChannel()!=this.channel)&&(re=!0),re||(ee.setTokenIndex(te),this.tokens.push(ee),te++),ee=this.tokenSource.nextToken();this.p=0,this.p=this.skipOffTokenChannels(this.p)},consume:function(){this.p<this.tokens.length&&(this.p++,this.p=this.skipOffTokenChannels(this.p))},skipOffTokenChannels:function(te){for(var ee=this.tokens.length;te<ee&&this.tokens[te].getChannel()!=this.channel;)te++;return te},skipOffTokenChannelsReverse:function(te){for(;te>=0&&this.tokens[te].getChannel()!=this.channel;)te--;return te},setTokenTypeChannel:function(te,ee){this.channelOverrideMap||(this.channelOverrideMap={}),this.channelOverrideMap[te]=ee},discardTokenType:function(te){this.discardSet||(this.discardSet={}),this.discardSet[te]=!0},discardOffChannelTokens:function(te){this.v_discardOffChannelTokens=te},getTokens:function(te,ee,re){if(this.p===-1&&this.fillBuffer(),arguments.length===0)return this.tokens;if(org.antlr.lang.isArray(re)?re=new org.antlr.runtime.BitSet(re):org.antlr.lang.isNumber(re)&&(re=org.antlr.runtime.BitSet.of(re)),ee>=this.tokens.length&&(ee=this.tokens.length-1),te<0&&(te=0),te>ee)return null;var ne=[],ie,se;for(ie=te;ie<=ee;ie++)se=this.tokens[ie],(!this.types||re.member(se.getType()))&&ne.push(se);return ne.length===0&&(ne=null),ne},LT:function(te){if(this.p===-1&&this.fillBuffer(),te===0)return null;if(te<0)return this.LB(-1*te);if(this.p+te-1>=this.tokens.length)return org.antlr.runtime.Token.EOF_TOKEN;for(var ee=this.p,re=1;re<te;)ee=this.skipOffTokenChannels(ee+1),re++;return ee>=this.tokens.length?org.antlr.runtime.Token.EOF_TOKEN:this.tokens[ee]},LB:function(te){if(this.p===-1&&this.fillBuffer(),te===0||this.p-te<0)return null;for(var ee=this.p,re=1;re<=te;)ee=this.skipOffTokenChannelsReverse(ee-1),re++;return ee<0?null:this.tokens[ee]},get:function(te){return this.tokens[te]},LA:function(te){return this.LT(te).getType()},mark:function(){return this.p===-1&&this.fillBuffer(),this.lastMarker=this.index(),this.lastMarker},release:function(te){},size:function(){return this.tokens.length},index:function(){return this.p},rewind:function(te){org.antlr.lang.isNumber(te)||(te=this.lastMarker),this.seek(te)},reset:function(){this.p=-1,this.lastMarker=0},seek:function(te){this.p=te},getTokenSource:function(){return this.tokenSource},getSourceName:function(){return this.getTokenSource().getSourceName()},toString:function(te,ee){if(arguments.length===0&&(this.p===-1&&this.fillBuffer(),te=0,ee=this.tokens.length-1),!org.antlr.lang.isNumber(te)&&!org.antlr.lang.isNumber(ee))if(org.antlr.lang.isValue(te)&&org.antlr.lang.isValue(ee))te=te.getTokenIndex(),ee=ee.getTokenIndex();else return null;var re="",ne;if(te<0||ee<0)return null;for(this.p==-1&&this.fillBuffer(),ee>=this.tokens.length&&(ee=this.tokens.length-1),ne=te;ne<=ee;ne++)t=this.tokens[ne],re=re+this.tokens[ne].getText();return re}};org.antlr.runtime.TokenRewriteStream=function(){var te=org.antlr.runtime.TokenRewriteStream.superclass;this.programs=null,this.lastRewriteTokenIndexes=null,arguments.length===0?this.init():(te.constructor.apply(this,arguments),this.init())};(function(){var te=org.antlr.runtime.TokenRewriteStream;org.antlr.lang.augmentObject(te,{DEFAULT_PROGRAM_NAME:"default",PROGRAM_INIT_SIZE:100,MIN_TOKEN_INDEX:0}),te.RewriteOperation=function(ee,re){this.index=ee,this.text=re},te.RewriteOperation.prototype={execute:function(ee){return this.index},toString:function(){return this.text}},te.InsertBeforeOp=function(ee,re){te.InsertBeforeOp.superclass.constructor.call(this,ee,re)},org.antlr.lang.extend(te.InsertBeforeOp,te.RewriteOperation,{execute:function(ee){return ee.push(this.text),this.index}}),te.ReplaceOp=function(ee,re,ne){te.ReplaceOp.superclass.constructor.call(this,ee,ne),this.lastIndex=re},org.antlr.lang.extend(te.ReplaceOp,te.RewriteOperation,{execute:function(ee){return org.antlr.lang.isValue(this.text)&&ee.push(this.text),this.lastIndex+1}}),te.DeleteOp=function(ee,re){te.DeleteOp.superclass.constructor.call(this,ee,re)},org.antlr.lang.extend(te.DeleteOp,te.ReplaceOp),org.antlr.lang.extend(te,org.antlr.runtime.CommonTokenStream,{init:function(){this.programs={},this.programs[te.DEFAULT_PROGRAM_NAME]=[],this.lastRewriteTokenIndexes={}},rollback:function(){var ee;arguments.length===1?ee=te.DEFAULT_PROGRAM_NAME:arguments.length===2&&(ee=arguments[0]);var re=this.programs[ee];re&&(programs[ee]=re.slice(te.MIN_TOKEN_INDEX,this.instructionIndex))},deleteProgram:function(ee){ee=ee||te.DEFAULT_PROGRAM_NAME,this.rollback(ee,te.MIN_TOKEN_INDEX)},addToSortedRewriteList:function(){var ee,re;arguments.length===1?(ee=te.DEFAULT_PROGRAM_NAME,re=arguments[0]):arguments.length===2&&(ee=arguments[0],re=arguments[1]);var ne=this.getProgram(ee),ie,se,le,ue,ae,oe;for(se=0,ie=ne.length;se<ie;se++)if(le=ne[se],le.index===re.index){if(re instanceof te.ReplaceOp){for(ue=!1,oe=se;oe<ne.length&&(ae=ne[se],ae.index===re.index);oe++)if(ae instanceof te.ReplaceOp){ne[se]=re,ue=!0;break}ue||ne.splice(oe,0,re)}else ne.splice(se,0,re);break}else if(le.index>re.index){ne.splice(se,0,re);break}se===ie&&ne.push(re)},insertAfter:function(){var ee,re,ne;arguments.length===2?(re=te.DEFAULT_PROGRAM_NAME,ee=arguments[0],ne=arguments[1]):arguments.length===3&&(re=arguments[0],ee=arguments[1],ne=arguments[2]),ee instanceof org.antlr.runtime.CommonToken&&(ee=ee.index),this.insertBefore(re,ee+1,ne)},insertBefore:function(){var ee,re,ne;arguments.length===2?(re=te.DEFAULT_PROGRAM_NAME,ee=arguments[0],ne=arguments[1]):arguments.length===3&&(re=arguments[0],ee=arguments[1],ne=arguments[2]),ee instanceof org.antlr.runtime.CommonToken&&(ee=ee.index),this.addToSortedRewriteList(re,new te.InsertBeforeOp(ee,ne))},replace:function(){var ee,re,ne,ie;arguments.length===2?(ee=te.DEFAULT_PROGRAM_NAME,re=arguments[0],ne=arguments[0],ie=arguments[1]):arguments.length===3&&(ee=te.DEFAULT_PROGRAM_NAME,re=arguments[0],ne=arguments[1],ie=arguments[2]),arguments.length===4&&(ee=arguments[0],re=arguments[1],ne=arguments[2],ie=arguments[3]),re instanceof org.antlr.runtime.CommonToken&&(re=re.index),ne instanceof org.antlr.runtime.CommonToken&&(ne=ne.index),!(re>ne||ne<0||re<0)&&this.addToSortedRewriteList(ee,new te.ReplaceOp(re,ne,ie))},remove:function(){for(var ee=[],re=arguments.length-1;re>=0;)ee[re]=arguments[re],re--;ee.push(""),this.replace.apply(this,ee)},getLastRewriteTokenIndex:function(ee){return ee=ee||te.DEFAULT_PROGRAM_NAME,this.lastRewriteTokenIndexes[ee]||-1},setLastRewriteTokenIndex:function(ee,re){this.lastRewriteTokenIndexes[ee]=re},getProgram:function(ee){var re=this.programs[ee];return re||(re=this.initializeProgram(ee)),re},initializeProgram:function(ee){var re=[];return this.programs[ee]=re,re},toOriginalString:function(ee,re){org.antlr.lang.isNumber(ee)||(ee=te.MIN_TOKEN_INDEX),org.antlr.lang.isNumber(re)||(re=this.size()-1);var ne=[],ie;for(ie=ee;ie>=te.MIN_TOKEN_INDEX&&ie<=re&&ie<this.tokens.length;ie++)ne.push(this.get(ie).getText());return ne.join("")},toString:function(){var ee,re,ne;arguments.length===0?(ee=te.DEFAULT_PROGRAM_NAME,re=te.MIN_TOKEN_INDEX,ne=this.size()-1):arguments.length===1?(ee=arguments[0],re=te.MIN_TOKEN_INDEX,ne=this.size()-1):arguments.length===2&&(ee=te.DEFAULT_PROGRAM_NAME,re=arguments[0],ne=arguments[1]);var ie=this.programs[ee];if(!ie||ie.length===0)return this.toOriginalString(re,ne);for(var se=0,le=re,ue=[],ae;le>=te.MIN_TOKEN_INDEX&&le<=ne&&le<this.tokens.length;){if(se<ie.length){for(ae=ie[se];ae.index<le&&se<ie.length;)se++,se<ie.length&&(ae=ie[se]);for(;le===ae.index&&se<ie.length;)le=ae.execute(ue),se++,se<ie.length&&(ae=ie[se])}le<=ne&&(ue.push(this.get(le).getText()),le++)}var oe;for(oe=se;oe<ie.length;oe++)ae=ie[oe],ae.index>=this.size()&&ae.execute(ue);return ue.join("")},toDebugString:function(ee,re){org.antlr.lang.isNumber(ee)||(ee=te.MIN_TOKEN_INDEX),org.antlr.lang.isNumber(re)||(re=this.size()-1);var ne=[],ie;for(ie=ee;ie>=te.MIN_TOKEN_INDEX&&ie<=re&&ie<this.tokens.length;ie++)ne.push(this.get(ie));return ne.join("")}})})();org.antlr.runtime.tree.TreeNodeStream=function(){};org.antlr.runtime.tree.CommonTreeNodeStream=function(te,ee,re){arguments.length===1&&(ee=te,te=new org.antlr.runtime.tree.CommonTreeAdaptor),arguments.length<=2&&(re=org.antlr.runtime.tree.CommonTreeNodeStream.DEFAULT_INITIAL_BUFFER_SIZE),this.uniqueNavigationNodes=!1,this.p=-1;var ne=org.antlr.runtime.Token;this.root=ee,this.adaptor=te,this.nodes=[],this.down=this.adaptor.create(ne.DOWN,"DOWN"),this.up=this.adaptor.create(ne.UP,"UP"),this.eof=this.adaptor.create(ne.EOF,"EOF")};org.antlr.lang.augmentObject(org.antlr.runtime.tree.CommonTreeNodeStream,{DEFAULT_INITIAL_BUFFER_SIZE:100,INITIAL_CALL_STACK_SIZE:10});org.antlr.lang.extend(org.antlr.runtime.tree.CommonTreeNodeStream,org.antlr.runtime.tree.TreeNodeStream,{StreamIterator:function(){var te=0,ee=this.nodes,re=this.eof;return{hasNext:function(){return te<ee.length},next:function(){var ne=te;return te++,ne<ee.length?ee[ne]:re},remove:function(){throw new Error("cannot remove nodes from stream")}}},fillBuffer:function(te){var ee=!1;org.antlr.lang.isUndefined(te)&&(te=this.root,ee=!0);var re=this.adaptor.isNil(te);re||this.nodes.push(te);var ne=this.adaptor.getChildCount(te);!re&&ne>0&&this.addNavigationNode(org.antlr.runtime.Token.DOWN);var ie,se;for(ie=0;ie<ne;ie++)se=this.adaptor.getChild(te,ie),this.fillBuffer(se);!re&&ne>0&&this.addNavigationNode(org.antlr.runtime.Token.UP),ee&&(this.p=0)},getNodeIndex:function(te){this.p==-1&&this.fillBuffer();var ee,re;for(ee=0;ee<this.nodes.length;ee++)if(re=this.nodes[ee],re===te)return ee;return-1},addNavigationNode:function(te){var ee=null;te===org.antlr.runtime.Token.DOWN?this.hasUniqueNavigationNodes()?ee=this.adaptor.create(org.antlr.runtime.Token.DOWN,"DOWN"):ee=this.down:this.hasUniqueNavigationNodes()?ee=this.adaptor.create(org.antlr.runtime.Token.UP,"UP"):ee=this.up,this.nodes.push(ee)},get:function(te){return this.p===-1&&this.fillBuffer(),this.nodes[te]},LT:function(te){return this.p===-1&&this.fillBuffer(),te===0?null:te<0?this.LB(-1*te):this.p+te-1>=this.nodes.length?this.eof:this.nodes[this.p+te-1]},getCurrentSymbol:function(){return this.LT(1)},LB:function(te){return te===0||this.p-te<0?null:this.nodes[this.p-te]},getTreeSource:function(){return this.root},getSourceName:function(){return this.getTokenStream().getSourceName()},getTokenStream:function(){return this.tokens},setTokenStream:function(te){this.tokens=te},getTreeAdaptor:function(){return this.adaptor},setTreeAdaptor:function(te){this.adaptor=te},hasUniqueNavigationNodes:function(){return this.uniqueNavigationNodes},setUniqueNavigationNodes:function(te){this.uniqueNavigationNodes=te},consume:function(){this.p===-1&&this.fillBuffer(),this.p++},LA:function(te){return this.adaptor.getType(this.LT(te))},mark:function(){return this.p===-1&&this.fillBuffer(),this.lastMarker=this.index(),this.lastMarker},release:function(te){},index:function(){return this.p},rewind:function(te){org.antlr.lang.isNumber(te)||(te=this.lastMarker),this.seek(te)},seek:function(te){this.p===-1&&this.fillBuffer(),this.p=te},push:function(te){this.calls||(this.calls=[]),this.calls.push(this.p),this.seek(te)},pop:function(){var te=this.calls.pop();return this.seek(te),te},reset:function(){this.p=-1,this.lastMarker=0,this.calls&&(this.calls=[])},size:function(){return this.p===-1&&this.fillBuffer(),this.nodes.length},iterator:function(){return this.p===-1&&this.fillBuffer(),this.StreamIterator()},replaceChildren:function(te,ee,re,ne){te&&this.adaptor.replaceChildren(te,ee,re,ne)},toTokenString:function(te,ee){this.p===-1&&this.fillBuffer();var re="",ne,ie;for(ne=te;ne<this.nodes.length&&ne<=ee;ne++)ie=this.nodes[ne],re+=" "+this.adaptor.getToken(ie);return re},toString:function(te,ee){var re="",ne,ie,se;if(arguments.length===0){for(this.p===-1&&this.fillBuffer(),se=0;se<this.nodes.length;se++)ie=this.nodes[se],re+=" ",re+=this.adaptor.getType(ie);return re}else{if(!org.antlr.lang.isNumber(te)||!org.antlr.lang.isNumber(ee))return null;this.p===-1&&this.fillBuffer(),te instanceof org.antlr.runtime.tree.CommonTree,ee instanceof org.antlr.runtime.tree.CommonTree;var le,ue;if(this.tokens)return le=this.adaptor.getTokenStartIndex(te),ue=this.adaptor.getTokenStopIndex(ee),this.adaptor.getType(ee)===org.antlr.runtime.Token.UP?ue=this.adaptor.getTokenStopIndex(te):this.adaptor.getType(ee)==org.antlr.runtime.Token.EOF&&(ue=this.size()-2),this.tokens.toString(le,ue);for(ie=null,se=0;se<this.nodes.length&&(ie=this.nodes[se],ie!==te);se++);for(re=ne="",ie=this.nodes[se];ie!==ee;)ne=this.adaptor.getText(ie),org.antlr.lang.isString(ne)||(ne=" "+this.adaptor.getType(ie).toString()),re+=ne,se++,ie=nodes[se];return ne=this.adaptor.getText(ee),org.antlr.lang.isString(ne)||(ne=" "+this.adaptor.getType(ee).toString()),re+=ne,re}}});org.antlr.runtime.tree.RewriteRuleElementStream=function(te,ee,re){this.cursor=0,this.dirty=!1,this.elementDescription=ee,this.adaptor=te,re&&(org.antlr.lang.isArray(re)?(this.singleElement=null,this.elements=re):this.add(re))};org.antlr.runtime.tree.RewriteRuleElementStream.prototype={reset:function(){this.cursor=0,this.dirty=!0},add:function(te){if(org.antlr.lang.isValue(te)){if(this.elements){this.elements.push(te);return}if(!org.antlr.lang.isValue(this.singleElement)){this.singleElement=te;return}this.elements=[],this.elements.push(this.singleElement),this.singleElement=null,this.elements.push(te)}},nextTree:function(){var te=this.size(),ee;return this.dirty||this.cursor>=te&&te==1?(ee=this._next(),this.dup(ee)):(ee=this._next(),ee)},_next:function(){var te=this.size();if(te===0)throw new org.antlr.runtime.tree.RewriteEmptyStreamException(this.elementDescription);if(this.cursor>=te){if(te===1)return this.toTree(this.singleElement);throw new org.antlr.runtime.tree.RewriteCardinalityException(this.elementDescription)}if(org.antlr.lang.isValue(this.singleElement))return this.cursor++,this.toTree(this.singleElement);var ee=this.toTree(this.elements[this.cursor]);return this.cursor++,ee},toTree:function(te){return te&&te.getTree?te.getTree():te},hasNext:function(){return org.antlr.lang.isValue(this.singleElement)&&this.cursor<1||this.elements&&this.cursor<this.elements.length},size:function(){var te=0;return org.antlr.lang.isValue(this.singleElement)&&(te=1),this.elements?this.elements.length:te},getDescription:function(){return this.elementDescription}};org.antlr.runtime.tree.RewriteRuleNodeStream=function(te,ee,re){org.antlr.runtime.tree.RewriteRuleNodeStream.superclass.constructor.apply(this,arguments)};org.antlr.lang.extend(org.antlr.runtime.tree.RewriteRuleNodeStream,org.antlr.runtime.tree.RewriteRuleElementStream,{nextNode:function(){return this._next()},toTree:function(te){return this.adaptor.dupNode(te)},dup:function(){throw new Error("dup can't be called for a node stream.")}});org.antlr.runtime.tree.RewriteRuleTokenStream=function(te,ee,re){var ne=org.antlr.runtime.tree.RewriteRuleTokenStream.superclass;ne.constructor.apply(this,arguments)};org.antlr.lang.extend(org.antlr.runtime.tree.RewriteRuleTokenStream,org.antlr.runtime.tree.RewriteRuleElementStream,{nextNode:function(){var te=this._next();return this.adaptor.create(te)},nextToken:function(){return this._next()},toTree:function(te){return te},dup:function(te){throw new Error("dup can't be called for a token stream.")}});org.antlr.runtime.tree.RewriteRuleSubtreeStream=function(){var te=org.antlr.runtime.tree.RewriteRuleSubtreeStream.superclass;te.constructor.apply(this,arguments)};org.antlr.lang.extend(org.antlr.runtime.tree.RewriteRuleSubtreeStream,org.antlr.runtime.tree.RewriteRuleElementStream,{nextNode:function(){var te=this.size(),ee;return this.dirty||this.cursor>=te&&te===1?(ee=this._next(),this.adaptor.dupNode(ee)):(ee=this._next(),ee)},dup:function(te){return this.adaptor.dupTree(te)}});org.antlr.runtime.BaseRecognizer=function(te){this.state=te||new org.antlr.runtime.RecognizerSharedState};org.antlr.lang.augmentObject(org.antlr.runtime.BaseRecognizer,{MEMO_RULE_FAILED:-2,MEMO_RULE_UNKNOWN:-1,INITIAL_FOLLOW_STACK_SIZE:100,MEMO_RULE_FAILED_I:-2,DEFAULT_TOKEN_CHANNEL:org.antlr.runtime.Token.DEFAULT_CHANNEL,HIDDEN:org.antlr.runtime.Token.HIDDEN_CHANNEL,NEXT_TOKEN_RULE_NAME:"nextToken"});org.antlr.runtime.BaseRecognizer.prototype={reset:function(){var te,ee;if(this.state&&(this.state._fsp=-1,this.state.errorRecovery=!1,this.state.lastErrorIndex=-1,this.state.failed=!1,this.state.syntaxErrors=0,this.state.backtracking=0,this.state.ruleMemo))for(te=0,ee=this.state.ruleMemo.length;te<ee;te++)this.state.ruleMemo[te]=null},match:function(te,ee,re){var ne=this.getCurrentInputSymbol(te);return te.LA(1)===ee?(te.consume(),this.state.errorRecovery=!1,this.state.failed=!1,ne):this.state.backtracking>0?(this.state.failed=!0,ne):(ne=this.recoverFromMismatchedToken(te,ee,re),ne)},matchAny:function(te){this.state.errorRecovery=!1,this.state.failed=!1,te.consume()},mismatchIsUnwantedToken:function(te,ee){return te.LA(2)===ee},mismatchIsMissingToken:function(te,ee){return ee?(ee.member(org.antlr.runtime.Token.EOR_TOKEN_TYPE)&&(this.state._fsp>=0&&ee.remove(org.antlr.runtime.Token.EOR_TOKEN_TYPE),this.computeContextSensitiveRuleFOLLOW(),ee=ee.or(this.viableTokensFollowingThisRule)),!!(ee.member(te.LA(1))||ee.member(org.antlr.runtime.Token.EOR_TOKEN_TYPE))):!1},mismatch:function(te,ee,re){throw this.mismatchIsUnwantedToken(te,ee)?new org.antlr.runtime.UnwantedTokenException(ee,te):this.mismatchIsMissingToken(te,re)?new org.antlr.runtime.MissingTokenException(ee,te,null):new org.antlr.runtime.MismatchedTokenException(ee,te)},reportError:function(te){this.state.errorRecovery||(this.state.syntaxErrors++,this.state.errorRecovery=!0,this.displayRecognitionError(this.getTokenNames(),te))},displayRecognitionError:function(te,ee){var re=this.getErrorHeader(ee),ne=this.getErrorMessage(ee,te);this.emitErrorMessage(re+" "+ne)},getErrorHeader:function(te){return org.antlr.lang.isNumber(te.line)||(te.line=0),"line "+te.line+":"+te.charPositionInLine},emitErrorMessage:function(te){typeof window<"u"&&window.alert?alert(te):print(te)},getErrorMessage:function(te,ee){var re=te&&te.getMessage?te.getMessage():null,ne,ie;if(te instanceof org.antlr.runtime.UnwantedTokenException){var se=te;ie="<unknown>",se.expecting==org.antlr.runtime.Token.EOF?ie="EOF":ie=ee[se.expecting],re="extraneous input "+this.getTokenErrorDisplay(se.getUnexpectedToken())+" expecting "+ie}else te instanceof org.antlr.runtime.MissingTokenException?(ne=te,ie="<unknown>",ne.expecting==org.antlr.runtime.Token.EOF?ie="EOF":ie=ee[ne.expecting],re="missing "+ie+" at "+this.getTokenErrorDisplay(te.token)):te instanceof org.antlr.runtime.MismatchedTokenException?(ne=te,ie="<unknown>",ne.expecting==org.antlr.runtime.Token.EOF?ie="EOF":ie=ee[ne.expecting],re="mismatched input "+this.getTokenErrorDisplay(te.token)+" expecting "+ie):te instanceof org.antlr.runtime.NoViableAltException?re="no viable alternative at input "+this.getTokenErrorDisplay(te.token):te instanceof org.antlr.runtime.EarlyExitException?re="required (...)+ loop did not match anything at input "+this.getTokenErrorDisplay(te.token):te instanceof org.antlr.runtime.MismatchedSetException?re="mismatched input "+this.getTokenErrorDisplay(te.token)+" expecting set "+te.expecting:te instanceof org.antlr.runtime.MismatchedNotSetException?re="mismatched input "+this.getTokenErrorDisplay(te.token)+" expecting set "+te.expecting:te instanceof org.antlr.runtime.FailedPredicateException&&(re="rule "+te.ruleName+" failed predicate: {"+te.predicateText+"}?");return re},getNumberOfSyntaxErrors:function(){return this.state.syntaxErrors},getTokenErrorDisplay:function(te){var ee=te.getText();return org.antlr.lang.isValue(ee)||(te.getType()==org.antlr.runtime.Token.EOF?ee="<EOF>":ee="<"+te.getType()+">"),ee=ee.replace(/\n/g,"\\n"),ee=ee.replace(/\r/g,"\\r"),ee=ee.replace(/\t/g,"\\t"),"'"+ee+"'"},recover:function(te,ee){this.state.lastErrorIndex==te.index()&&te.consume(),this.state.lastErrorIndex=te.index();var re=this.computeErrorRecoverySet();this.beginResync(),this.consumeUntil(te,re),this.endResync()},beginResync:function(){},endResync:function(){},computeErrorRecoverySet:function(){return this.combineFollows(!1)},computeContextSensitiveRuleFOLLOW:function(){return this.combineFollows(!0)},combineFollows:function(te){var ee=this.state._fsp,re,ne,ie=new org.antlr.runtime.BitSet;for(re=ee;re>=0;re--)if(ne=this.state.following[re],ie.orInPlace(ne),te)if(ne.member(org.antlr.runtime.Token.EOR_TOKEN_TYPE))re>0&&ie.remove(org.antlr.runtime.Token.EOR_TOKEN_TYPE);else break;return ie},recoverFromMismatchedToken:function(te,ee,re){var ne=null;if(this.mismatchIsUnwantedToken(te,ee)){ne=new org.antlr.runtime.UnwantedTokenException(ee,te),this.beginResync(),te.consume(),this.endResync(),this.reportError(ne);var ie=this.getCurrentInputSymbol(te);return te.consume(),ie}if(this.mismatchIsMissingToken(te,re)){var se=this.getMissingSymbol(te,ne,ee,re);return ne=new org.antlr.runtime.MissingTokenException(ee,te,se),this.reportError(ne),se}throw ne=new org.antlr.runtime.MismatchedTokenException(ee,te),ne},recoverFromMismatchedSet:function(te,ee,re){if(this.mismatchIsMissingToken(te,re))return this.reportError(ee),this.getMissingSymbol(te,ee,org.antlr.runtime.Token.INVALID_TOKEN_TYPE,re);throw ee},getCurrentInputSymbol:function(te){return null},getMissingSymbol:function(te,ee,re,ne){return null},consumeUntil:function(te,ee){for(var re=te.LA(1);re!=org.antlr.runtime.Token.EOF&&!ee.member(re);)te.consume(),re=te.LA(1)},pushFollow:function(te){if(this.state._fsp+1>=this.state.following.length){var ee=[],re;for(re=this.state.following.length-1;re>=0;re--)ee[re]=this.state.following[re];this.state.following=ee}this.state._fsp++,this.state.following[this.state._fsp]=te},getRuleInvocationStack:function(te,ee){throw new Error("Not implemented.")},getBacktrackingLevel:function(){return this.state.backtracking},getTokenNames:function(){return null},getGrammarFileName:function(){return null},toStrings:function(te){if(!te)return null;var ee=[],re;for(re=0;re<te.length;re++)ee.push(te[re].getText());return ee},getRuleMemoization:function(te,ee){this.state.ruleMemo[te]||(this.state.ruleMemo[te]={});var re=this.state.ruleMemo[te][ee];return org.antlr.lang.isNumber(re)?re:org.antlr.runtime.BaseRecognizer.MEMO_RULE_UNKNOWN},alreadyParsedRule:function(te,ee){var re=this.getRuleMemoization(ee,te.index());return re==org.antlr.runtime.BaseRecognizer.MEMO_RULE_UNKNOWN?!1:(re==org.antlr.runtime.BaseRecognizer.MEMO_RULE_FAILED?this.state.failed=!0:te.seek(re+1),!0)},memoize:function(te,ee,re){var ne=this.state.failed?org.antlr.runtime.BaseRecognizer.MEMO_RULE_FAILED:te.index()-1;if(!org.antlr.lang.isValue(this.state.ruleMemo))throw new Error("!!!!!!!!! memo array is null for "+this.getGrammarFileName());if(ee>=this.state.ruleMemo.length)throw new Error("!!!!!!!!! memo size is "+this.state.ruleMemo.length+", but rule index is "+ee);org.antlr.lang.isValue(this.state.ruleMemo[ee])&&(this.state.ruleMemo[ee][re]=ne)},getRuleMemoizationCacheSize:function(){var te=0,ee;for(ee=0;this.state.ruleMemo&&ee<this.state.ruleMemo.length;ee++){var re=this.state.ruleMemo[ee];re&&(te+=re.length)}return te},traceIn:function(te,ee,re){this.emitErrorMessage("enter "+te+" "+re),this.state.failed&&this.emitErrorMessage(" failed="+this.failed),this.state.backtracking>0&&this.emitErrorMessage(" backtracking="+this.state.backtracking)},traceOut:function(te,ee,re){this.emitErrorMessage("exit "+te+" "+re),this.state.failed&&this.emitErrorMessage(" failed="+this.state.failed),this.state.backtracking>0&&this.emitErrorMessage(" backtracking="+this.state.backtracking)}};org.antlr.runtime.Lexer=function(te,ee){ee&&org.antlr.runtime.Lexer.superclass.constructor.call(this,ee),te&&(this.input=te)};org.antlr.lang.extend(org.antlr.runtime.Lexer,org.antlr.runtime.BaseRecognizer,{reset:function(){org.antlr.runtime.Lexer.superclass.reset.call(this),org.antlr.lang.isValue(this.input)&&this.input.seek(0),org.antlr.lang.isValue(this.state)&&(this.state.token=null,this.state.type=org.antlr.runtime.Token.INVALID_TOKEN_TYPE,this.state.channel=org.antlr.runtime.Token.DEFAULT_CHANNEL,this.state.tokenStartCharIndex=-1,this.state.tokenStartCharPositionInLine=-1,this.state.tokenStartLine=-1,this.state.text=null)},nextToken:function(){for(;;){if(this.state.token=null,this.state.channel=org.antlr.runtime.Token.DEFAULT_CHANNEL,this.state.tokenStartCharIndex=this.input.index(),this.state.tokenStartCharPositionInLine=this.input.getCharPositionInLine(),this.state.tokenStartLine=this.input.getLine(),this.state.text=null,this.input.LA(1)===org.antlr.runtime.CharStream.EOF)return org.antlr.runtime.Token.EOF_TOKEN;try{if(this.mTokens(),!org.antlr.lang.isValue(this.state.token))this.emit();else if(this.state.token==org.antlr.runtime.Token.SKIP_TOKEN)continue;return this.state.token}catch(te){if(te instanceof org.antlr.runtime.RecognitionException)this.reportError(te);else if(te instanceof org.antlr.runtime.NoViableAltException)this.reportError(te),this.recover(te);else throw te}}},skip:function(){this.state.token=org.antlr.runtime.Token.SKIP_TOKEN},setCharStream:function(te){this.input=null,this.reset(),this.input=te},getCharStream:function(){return this.input},getSourceName:function(){return this.input.getSourceName()},emit:function(){if(arguments.length===0){var te=new org.antlr.runtime.CommonToken(this.input,this.state.type,this.state.channel,this.state.tokenStartCharIndex,this.getCharIndex()-1);return te.setLine(this.state.tokenStartLine),te.setText(this.state.text),te.setCharPositionInLine(this.state.tokenStartCharPositionInLine),this.state.token=te,te}else this.state.token=arguments[0]},match:function(te){var ee=0,re;if(org.antlr.lang.isString(te))for(;ee<te.length;){if(this.input.LA(1)!=te.charAt(ee)){if(this.state.backtracking>0){this.state.failed=!0;return}throw re=new org.antlr.runtime.MismatchedTokenException(te.charAt(ee),this.input),this.recover(re),re}ee++,this.input.consume(),this.state.failed=!1}else if(org.antlr.lang.isNumber(te)){if(this.input.LA(1)!=te){if(this.state.backtracking>0){this.state.failed=!0;return}throw re=new org.antlr.runtime.MismatchedTokenException(te,this.input),this.recover(re),re}this.input.consume(),this.state.failed=!1}},matchAny:function(){this.input.consume()},matchRange:function(te,ee){if(this.input.LA(1)<te||this.input.LA(1)>ee){if(this.state.backtracking>0){this.state.failed=!0;return}throw mre=new org.antlr.runtime.MismatchedRangeException(te,ee,this.input),this.recover(mre),mre}this.input.consume(),this.state.failed=!1},getLine:function(){return this.input.getLine()},getCharPositionInLine:function(){return this.input.getCharPositionInLine()},getCharIndex:function(){return this.input.index()},getText:function(){return org.antlr.lang.isString(this.state.text)?this.state.text:this.input.substring(this.state.tokenStartCharIndex,this.getCharIndex()-1)},setText:function(te){this.state.text=te},reportError:function(te){this.displayRecognitionError(this.getTokenNames(),te)},getErrorMessage:function(te,ee){var re=null;return te instanceof org.antlr.runtime.MismatchedTokenException?re="mismatched character "+this.getCharErrorDisplay(te.c)+" expecting "+this.getCharErrorDisplay(te.expecting):te instanceof org.antlr.runtime.NoViableAltException?re="no viable alternative at character "+this.getCharErrorDisplay(te.c):te instanceof org.antlr.runtime.EarlyExitException?re="required (...)+ loop did not match anything at character "+this.getCharErrorDisplay(te.c):te instanceof org.antlr.runtime.MismatchedNotSetException?re="mismatched character "+this.getCharErrorDisplay(te.c)+" expecting set "+te.expecting:te instanceof org.antlr.runtime.MismatchedSetException?re="mismatched character "+this.getCharErrorDisplay(te.c)+" expecting set "+te.expecting:te instanceof org.antlr.runtime.MismatchedRangeException?re="mismatched character "+this.getCharErrorDisplay(te.c)+" expecting set "+this.getCharErrorDisplay(te.a)+".."+this.getCharErrorDisplay(te.b):re=org.antlr.runtime.Lexer.superclass.getErrorMessage.call(this,te,ee),re},getCharErrorDisplay:function(te){var ee=te;switch(ee){case org.antlr.runtime.Token.EOF:ee="<EOF>";break;case`
`:ee="\\n";break;case"	":ee="\\t";break;case"\r":ee="\\r";break}return"'"+ee+"'"},recover:function(te){this.input.consume()},traceIn:function(te,ee){var re=String.fromCharCode(this.input.LT(1))+" line="+this.getLine()+":"+this.getCharPositionInLine();org.antlr.runtime.Lexer.superclass.traceIn.call(this,te,ee,re)},traceOut:function(te,ee){var re=String.fromCharCode(this.input.LT(1))+" line="+this.getLine()+":"+this.getCharPositionInLine();org.antlr.runtime.Lexer.superclass.traceOut.call(this,te,ee,re)}});org.antlr.runtime.ParserRuleReturnScope=function(){};org.antlr.runtime.ParserRuleReturnScope.prototype={getStart:function(){return this.start},getStop:function(){return this.stop}};org.antlr.runtime.tree.TreeRuleReturnScope=function(){};org.antlr.runtime.tree.TreeRuleReturnScope.prototype={getStart:function(){return this.start}};org.antlr.runtime.Parser=function(te,ee){org.antlr.runtime.Parser.superclass.constructor.call(this,ee),this.setTokenStream(te)};org.antlr.lang.extend(org.antlr.runtime.Parser,org.antlr.runtime.BaseRecognizer,{reset:function(){org.antlr.runtime.Parser.superclass.reset.call(this),org.antlr.lang.isValue(this.input)&&this.input.seek(0)},getCurrentInputSymbol:function(te){return te.LT(1)},getMissingSymbol:function(te,ee,re,ne){var ie="<missing "+this.getTokenNames()[re]+">",se=new org.antlr.runtime.CommonToken(re,ie),le=te.LT(1),ue;return le.getType()===org.antlr.runtime.Token.EOF&&(ue=le,le=te.LT(-1),le||(le=ue)),se.line=le.getLine(),se.charPositionInLine=le.getCharPositionInLine(),se.channel=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,se},setTokenStream:function(te){this.input=null,this.reset(),this.input=te},getTokenStream:function(){return this.input},getSourceName:function(){return this.input.getSourceName()},traceIn:function(te,ee){org.antlr.runtime.Parser.superclass.traceIn.call(this,te,ee,this.input.LT(1))},traceOut:function(te,ee){org.antlr.runtime.Parser.superclass.traceOut.call(this,te,ee,this.input.LT(1))}});org.antlr.runtime.DFA=function(){};org.antlr.runtime.DFA.prototype={predict:function(te){var ee=te.mark(),re=0,ne,ie,se;try{for(;;){if(ne=this.special[re],ne>=0){if(re=this.specialStateTransition(ne,te),re===-1)return this.noViableAlt(re,te),0;te.consume();continue}if(this.accept[re]>=1)return this.accept[re];if(ie=te.LA(1),ie===org.antlr.runtime.Token.EOF?ie=-1:org.antlr.lang.isString(ie)&&(ie=ie.charCodeAt(0)),ie>=this.min[re]&&ie<=this.max[re]){if(se=this.transition[re][ie-this.min[re]],se<0){if(this.eot[re]>=0){re=this.eot[re],te.consume();continue}return this.noViableAlt(re,te),0}re=se,te.consume();continue}if(this.eot[re]>=0){re=this.eot[re],te.consume();continue}return ie==org.antlr.runtime.Token.EOF&&this.eof[re]>=0?this.accept[this.eof[re]]:(this.noViableAlt(re,te),0)}}finally{te.rewind(ee)}},noViableAlt:function(te,ee){if(this.recognizer.state.backtracking>0){this.recognizer.state.failed=!0;return}var re=new org.antlr.runtime.NoViableAltException(this.getDescription(),this.decisionNumber,te,ee);throw this.error(re),re},error:function(te){throw new ModelError("Invalid equation syntax",{code:9e3})},specialStateTransition:function(te,ee){return-1},getDescription:function(){return"n/a"}};org.antlr.lang.augmentObject(org.antlr.runtime.DFA,{unpackEncodedString:function(te){var ee,re=[],ne=0,ie,se,le;for(ee=0;ee<te.length;ee+=2)for(ie=te.charCodeAt(ee),se=te.charCodeAt(ee+1),se===65535&&(se=-1),le=1;le<=ie;le++)re[ne++]=se;return re},unpackEncodedStringToUnsignedChars:function(te){return org.antlr.runtime.DFA.unpackEncodedString(te)}});org.antlr.runtime.tree.TreeParser=function(te){org.antlr.runtime.tree.TreeParser.superclass.constructor.call(this,arguments[1]),this.setTreeNodeStream(te)};(function(){var te=org.antlr.runtime.tree.TreeParser;org.antlr.lang.augmentObject(te,{DOWN:org.antlr.runtime.Token.DOWN,UP:org.antlr.runtime.Token.UP}),org.antlr.lang.extend(te,org.antlr.runtime.BaseRecognizer,{reset:function(){te.superclass.reset.call(this),this.input&&this.input.seek(0)},setTreeNodeStream:function(ee){this.input=ee},getTreeNodeStream:function(){return this.input},getSourceName:function(){return this.input.getSourceName()},getCurrentInputSymbol:function(ee){return ee.LT(1)},getMissingSymbol:function(ee,re,ne,ie){var se="<missing "+this.getTokenNames()[ne]+">";return new org.antlr.runtime.tree.CommonTree(new org.antlr.runtime.CommonToken(ne,se))},matchAny:function(ee){this.state.errorRecovery=!1,this.state.failed=!1;var re=this.input.LT(1);if(this.input.getTreeAdaptor().getChildCount(re)===0){this.input.consume();return}for(var ne=0,ie=this.input.getTreeAdaptor().getType(re);ie!==org.antlr.runtime.Token.EOF&&!(ie===te.UP&&ne===0);)this.input.consume(),re=this.input.LT(1),ie=this.input.getTreeAdaptor().getType(re),ie===te.DOWN?ne++:ie===te.UP&&ne--;this.input.consume()},mismatch:function(ee,re,ne){throw new org.antlr.runtime.MismatchedTreeNodeException(re,ee)},getErrorHeader:function(ee){return this.getGrammarFileName()+": node from "+(ee.approximateLineInfo?"after ":"")+"line "+ee.line+":"+ee.charPositionInLine},getErrorMessage:function(ee,re){var ne;return this instanceof te&&(ne=ee.input.getTreeAdaptor(),ee.token=ne.getToken(ee.node),org.antlr.lang.isValue(ee.token)||(ee.token=new org.antlr.runtime.CommonToken(ne.getType(ee.node),ne.getText(ee.node)))),te.superclass.getErrorMessage.call(this,ee,re)},traceIn:function(ee,re){te.superclass.traceIn.call(this,ee,re,this.input.LT(1))},traceOut:function(ee,re){te.superclass.traceOut.call(this,ee,re,this.input.LT(1))}})})();function FormulaLexer(te,ee){ee||(ee=new org.antlr.runtime.RecognizerSharedState),function(){}.call(this),this.dfa30=new FormulaLexer.DFA30(this),FormulaLexer.superclass.constructor.call(this,te,ee)}org.antlr.lang.augmentObject(FormulaLexer,{EOF:-1,T__113:113,T__114:114,T__115:115,T__116:116,NEGATE:4,ASSIGN:5,FUNCALL:6,MATERIAL:7,UNIT:8,POWER:9,DEFAULTS:10,PARAMS:11,UNITCLUMP:12,ARRAY:13,LINES:14,WHILE:15,IFTHENELSE:16,ELSE:17,FOR:18,FORIN:19,FUNCTION:20,ANONFUNCTION:21,NUMBER:22,LABEL:23,RANGE:24,INNER:25,ASSIGNED:26,SELECTOR:27,DOTSELECTOR:28,NEW:29,TRYCATCH:30,THROW:31,NEWLINE:32,W:33,H:34,I:35,L:36,E:37,WHILESTATEMENT:38,F:39,O:40,R:41,FORSTATEMENT:42,M:43,FROMSTATEMENT:44,N:45,INSTATEMENT:46,T:47,TOSTATEMENT:48,B:49,Y:50,BYSTATEMENT:51,P:52,LOOPSTATEMENT:53,IFSTATEMENT:54,THENSTATEMENT:55,S:56,ELSESTATEMENT:57,U:58,C:59,FUNCTIONSTATEMENT:60,D:61,ENDBLOCK:62,RETURNSTATEMENT:63,NEWSTATEMENT:64,TRYSTATEMENT:65,A:66,CATCHSTATEMENT:67,THROWSTATEMENT:68,IDENT:69,EQUALS:70,PRIMITIVE:71,OR:72,XOR:73,X:74,AND:75,NOTEQUALS:76,LT:77,LTEQ:78,GT:79,GTEQ:80,PLUS:81,MINUS:82,MULT:83,DIV:84,MOD:85,COLON:86,POW:87,NOT:88,LARR:89,RARR:90,LCURL:91,RCURL:92,COMMA:93,STRING:94,INTEGER:95,FLOAT:96,TRUE:97,FALSE:98,PER:99,CUBED:100,SQUARED:101,Q:102,LBRACKET:103,RBRACKET:104,COMMENT:105,LINE_COMMENT:106,WS:107,G:108,J:109,K:110,V:111,Z:112});(function(){var te=org.antlr.runtime.Token.HIDDEN_CHANNEL;org.antlr.runtime.Token.EOF,org.antlr.lang.extend(FormulaLexer,org.antlr.runtime.Lexer,{EOF:-1,T__113:113,T__114:114,T__115:115,T__116:116,NEGATE:4,ASSIGN:5,FUNCALL:6,MATERIAL:7,UNIT:8,POWER:9,DEFAULTS:10,PARAMS:11,UNITCLUMP:12,ARRAY:13,LINES:14,WHILE:15,IFTHENELSE:16,ELSE:17,FOR:18,FORIN:19,FUNCTION:20,ANONFUNCTION:21,NUMBER:22,LABEL:23,RANGE:24,INNER:25,ASSIGNED:26,SELECTOR:27,DOTSELECTOR:28,NEW:29,TRYCATCH:30,THROW:31,NEWLINE:32,W:33,H:34,I:35,L:36,E:37,WHILESTATEMENT:38,F:39,O:40,R:41,FORSTATEMENT:42,M:43,FROMSTATEMENT:44,N:45,INSTATEMENT:46,T:47,TOSTATEMENT:48,B:49,Y:50,BYSTATEMENT:51,P:52,LOOPSTATEMENT:53,IFSTATEMENT:54,THENSTATEMENT:55,S:56,ELSESTATEMENT:57,U:58,C:59,FUNCTIONSTATEMENT:60,D:61,ENDBLOCK:62,RETURNSTATEMENT:63,NEWSTATEMENT:64,TRYSTATEMENT:65,A:66,CATCHSTATEMENT:67,THROWSTATEMENT:68,IDENT:69,EQUALS:70,PRIMITIVE:71,OR:72,XOR:73,X:74,AND:75,NOTEQUALS:76,LT:77,LTEQ:78,GT:79,GTEQ:80,PLUS:81,MINUS:82,MULT:83,DIV:84,MOD:85,COLON:86,POW:87,NOT:88,LARR:89,RARR:90,LCURL:91,RCURL:92,COMMA:93,STRING:94,INTEGER:95,FLOAT:96,TRUE:97,FALSE:98,PER:99,CUBED:100,SQUARED:101,Q:102,LBRACKET:103,RBRACKET:104,COMMENT:105,LINE_COMMENT:106,WS:107,G:108,J:109,K:110,V:111,Z:112,getGrammarFileName:function(){return"/Library/WebServer/Documents/calc/Formula.g"}}),org.antlr.lang.augmentObject(FormulaLexer.prototype,{mT__113:function(){try{var ee=this.T__113,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("("),this.state.type=ee,this.state.channel=re}finally{}},mT__114:function(){try{var ee=this.T__114,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match(")"),this.state.type=ee,this.state.channel=re}finally{}},mT__115:function(){try{var ee=this.T__115,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("<-"),this.state.type=ee,this.state.channel=re}finally{}},mT__116:function(){try{var ee=this.T__116,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("."),this.state.type=ee,this.state.channel=re}finally{}},mNEWLINE:function(){try{var ee=this.NEWLINE,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,ne=2,ie=this.input.LA(1);switch(ie=="\r"&&(ne=1),ne){case 1:this.match("\r");break}this.match(`
`),this.state.type=ee,this.state.channel=re}finally{}},mWHILESTATEMENT:function(){try{var ee=this.WHILESTATEMENT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mW(),this.mH(),this.mI(),this.mL(),this.mE(),this.state.type=ee,this.state.channel=re}finally{}},mFORSTATEMENT:function(){try{var ee=this.FORSTATEMENT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mF(),this.mO(),this.mR(),this.state.type=ee,this.state.channel=re}finally{}},mFROMSTATEMENT:function(){try{var ee=this.FROMSTATEMENT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mF(),this.mR(),this.mO(),this.mM(),this.state.type=ee,this.state.channel=re}finally{}},mINSTATEMENT:function(){try{var ee=this.INSTATEMENT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mI(),this.mN(),this.state.type=ee,this.state.channel=re}finally{}},mTOSTATEMENT:function(){try{var ee=this.TOSTATEMENT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mT(),this.mO(),this.state.type=ee,this.state.channel=re}finally{}},mBYSTATEMENT:function(){try{var ee=this.BYSTATEMENT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mB(),this.mY(),this.state.type=ee,this.state.channel=re}finally{}},mLOOPSTATEMENT:function(){try{var ee=this.LOOPSTATEMENT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mL(),this.mO(),this.mO(),this.mP(),this.state.type=ee,this.state.channel=re}finally{}},mIFSTATEMENT:function(){try{var ee=this.IFSTATEMENT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mI(),this.mF(),this.state.type=ee,this.state.channel=re}finally{}},mTHENSTATEMENT:function(){try{var ee=this.THENSTATEMENT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mT(),this.mH(),this.mE(),this.mN(),this.state.type=ee,this.state.channel=re}finally{}},mELSESTATEMENT:function(){try{var ee=this.ELSESTATEMENT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mE(),this.mL(),this.mS(),this.mE(),this.state.type=ee,this.state.channel=re}finally{}},mFUNCTIONSTATEMENT:function(){try{var ee=this.FUNCTIONSTATEMENT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mF(),this.mU(),this.mN(),this.mC(),this.mT(),this.mI(),this.mO(),this.mN(),this.state.type=ee,this.state.channel=re}finally{}},mENDBLOCK:function(){try{var ee=this.ENDBLOCK,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mE(),this.mN(),this.mD(),this.state.type=ee,this.state.channel=re}finally{}},mRETURNSTATEMENT:function(){try{var ee=this.RETURNSTATEMENT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mR(),this.mE(),this.mT(),this.mU(),this.mR(),this.mN(),this.state.type=ee,this.state.channel=re}finally{}},mNEWSTATEMENT:function(){try{var ee=this.NEWSTATEMENT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mN(),this.mE(),this.mW(),this.state.type=ee,this.state.channel=re}finally{}},mTRYSTATEMENT:function(){try{var ee=this.TRYSTATEMENT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mT(),this.mR(),this.mY(),this.state.type=ee,this.state.channel=re}finally{}},mCATCHSTATEMENT:function(){try{var ee=this.CATCHSTATEMENT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mC(),this.mA(),this.mT(),this.mC(),this.mH(),this.state.type=ee,this.state.channel=re}finally{}},mTHROWSTATEMENT:function(){try{var ee=this.THROWSTATEMENT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mT(),this.mH(),this.mR(),this.mO(),this.mW(),this.state.type=ee,this.state.channel=re}finally{}},mOR:function(){try{var ee=this.OR,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,ne=2,ie=this.input.LA(1);if(ie=="|")ne=1;else if(ie=="O"||ie=="o")ne=2;else{var se=new org.antlr.runtime.NoViableAltException("",2,0,this.input);throw se}switch(ne){case 1:this.match("||");break;case 2:this.mO(),this.mR();break}this.state.type=ee,this.state.channel=re}finally{}},mXOR:function(){try{var ee=this.XOR,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mX(),this.mO(),this.mR(),this.state.type=ee,this.state.channel=re}finally{}},mAND:function(){try{var ee=this.AND,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,ne=2,ie=this.input.LA(1);if(ie=="&")ne=1;else if(ie=="A"||ie=="a")ne=2;else{var se=new org.antlr.runtime.NoViableAltException("",3,0,this.input);throw se}switch(ne){case 1:this.match("&&");break;case 2:this.mA(),this.mN(),this.mD();break}this.state.type=ee,this.state.channel=re}finally{}},mEQUALS:function(){try{var ee=this.EQUALS,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,ne=2,ie=this.input.LA(1);if(ie=="="){var se=this.input.LA(2);se=="="?ne=2:ne=1}else{var le=new org.antlr.runtime.NoViableAltException("",4,0,this.input);throw le}switch(ne){case 1:this.match("=");break;case 2:this.match("==");break}this.state.type=ee,this.state.channel=re}finally{}},mNOTEQUALS:function(){try{var ee=this.NOTEQUALS,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,ne=2,ie=this.input.LA(1);if(ie=="!")ne=1;else if(ie=="<")ne=2;else{var se=new org.antlr.runtime.NoViableAltException("",5,0,this.input);throw se}switch(ne){case 1:this.match("!=");break;case 2:this.match("<>");break}this.state.type=ee,this.state.channel=re}finally{}},mLT:function(){try{var ee=this.LT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("<"),this.state.type=ee,this.state.channel=re}finally{}},mLTEQ:function(){try{var ee=this.LTEQ,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("<="),this.state.type=ee,this.state.channel=re}finally{}},mGT:function(){try{var ee=this.GT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match(">"),this.state.type=ee,this.state.channel=re}finally{}},mGTEQ:function(){try{var ee=this.GTEQ,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match(">="),this.state.type=ee,this.state.channel=re}finally{}},mPLUS:function(){try{var ee=this.PLUS,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("+"),this.state.type=ee,this.state.channel=re}finally{}},mMINUS:function(){try{var ee=this.MINUS,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("-"),this.state.type=ee,this.state.channel=re}finally{}},mMULT:function(){try{var ee=this.MULT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("*"),this.state.type=ee,this.state.channel=re}finally{}},mDIV:function(){try{var ee=this.DIV,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("/"),this.state.type=ee,this.state.channel=re}finally{}},mMOD:function(){try{var ee=this.MOD,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,ne=2,ie=this.input.LA(1);if(ie=="%")ne=1;else if(ie=="M"||ie=="m")ne=2;else{var se=new org.antlr.runtime.NoViableAltException("",6,0,this.input);throw se}switch(ne){case 1:this.match("%");break;case 2:this.mM(),this.mO(),this.mD();break}this.state.type=ee,this.state.channel=re}finally{}},mPOW:function(){try{var ee=this.POW,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("^"),this.state.type=ee,this.state.channel=re}finally{}},mNOT:function(){try{var ee=this.NOT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,ne=2,ie=this.input.LA(1);if(ie=="!")ne=1;else if(ie=="N"||ie=="n")ne=2;else{var se=new org.antlr.runtime.NoViableAltException("",7,0,this.input);throw se}switch(ne){case 1:this.match("!");break;case 2:this.mN(),this.mO(),this.mT();break}this.state.type=ee,this.state.channel=re}finally{}},mLARR:function(){try{var ee=this.LARR,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,ne=2,ie=this.input.LA(1);if(ie=="«")ne=1;else if(ie=="<")ne=2;else{var se=new org.antlr.runtime.NoViableAltException("",8,0,this.input);throw se}switch(ne){case 1:this.match("«");break;case 2:this.match("<<");break}this.state.type=ee,this.state.channel=re}finally{}},mRARR:function(){try{var ee=this.RARR,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,ne=2,ie=this.input.LA(1);if(ie=="»")ne=1;else if(ie==">")ne=2;else{var se=new org.antlr.runtime.NoViableAltException("",9,0,this.input);throw se}switch(ne){case 1:this.match("»");break;case 2:this.match(">>");break}this.state.type=ee,this.state.channel=re}finally{}},mLCURL:function(){try{var ee=this.LCURL,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("{"),this.state.type=ee,this.state.channel=re}finally{}},mRCURL:function(){try{var ee=this.RCURL,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("}"),this.state.type=ee,this.state.channel=re}finally{}},mINTEGER:function(){try{var ee=this.INTEGER,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,ne=0;e:do{var ie=2,se=this.input.LA(1);switch(se>="0"&&se<="9"&&(ie=1),ie){case 1:this.matchRange("0","9");break;default:if(ne>=1)break e;var le=new org.antlr.runtime.EarlyExitException(10,this.input);throw le}ne++}while(!0);var ue=2,ae=this.input.LA(1);switch(ae=="e"&&(ue=1),ue){case 1:this.match("e");var oe=2,ce=this.input.LA(1);switch((ce=="+"||ce=="-")&&(oe=1),oe){case 1:if(this.input.LA(1)=="+"||this.input.LA(1)=="-")this.input.consume();else{var he=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(he),he}break}e:do{var pe=2,de=this.input.LA(1);switch(de>="0"&&de<="9"&&(pe=1),pe){case 1:this.matchRange("0","9");break;default:break e}}while(!0);break}this.state.type=ee,this.state.channel=re}finally{}},mFLOAT:function(){try{var ee=this.FLOAT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;e:do{var ne=2,ie=this.input.LA(1);switch(ie>="0"&&ie<="9"&&(ne=1),ne){case 1:this.matchRange("0","9");break;default:break e}}while(!0);this.match(".");var se=0;e:do{var le=2,ue=this.input.LA(1);switch(ue>="0"&&ue<="9"&&(le=1),le){case 1:this.matchRange("0","9");break;default:if(se>=1)break e;var ae=new org.antlr.runtime.EarlyExitException(15,this.input);throw ae}se++}while(!0);var oe=2,ce=this.input.LA(1);switch(ce=="e"&&(oe=1),oe){case 1:this.match("e");var he=2,pe=this.input.LA(1);switch((pe=="+"||pe=="-")&&(he=1),he){case 1:if(this.input.LA(1)=="+"||this.input.LA(1)=="-")this.input.consume();else{var de=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(de),de}break}e:do{var me=2,ge=this.input.LA(1);switch(ge>="0"&&ge<="9"&&(me=1),me){case 1:this.matchRange("0","9");break;default:break e}}while(!0);break}this.state.type=ee,this.state.channel=re}finally{}},mTRUE:function(){try{var ee=this.TRUE,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mT(),this.mR(),this.mU(),this.mE(),this.state.type=ee,this.state.channel=re}finally{}},mFALSE:function(){try{var ee=this.FALSE,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mF(),this.mA(),this.mL(),this.mS(),this.mE(),this.state.type=ee,this.state.channel=re}finally{}},mPER:function(){try{var ee=this.PER,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mP(),this.mE(),this.mR(),this.state.type=ee,this.state.channel=re}finally{}},mSQUARED:function(){try{var ee=this.SQUARED,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mS(),this.mQ(),this.mU(),this.mA(),this.mR(),this.mE(),this.mD(),this.state.type=ee,this.state.channel=re}finally{}},mCUBED:function(){try{var ee=this.CUBED,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mC(),this.mU(),this.mB(),this.mE(),this.mD(),this.state.type=ee,this.state.channel=re}finally{}},mIDENT:function(){try{var ee=this.IDENT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;if(this.input.LA(1)>="A"&&this.input.LA(1)<="Z"||this.input.LA(1)>="a"&&this.input.LA(1)<="z")this.input.consume();else{var ne=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ne),ne}e:do{var ie=2,se=this.input.LA(1);switch((se>="0"&&se<="9"||se>="A"&&se<="Z"||se=="_"||se>="a"&&se<="z")&&(ie=1),ie){case 1:if(this.input.LA(1)>="0"&&this.input.LA(1)<="9"||this.input.LA(1)>="A"&&this.input.LA(1)<="Z"||this.input.LA(1)=="_"||this.input.LA(1)>="a"&&this.input.LA(1)<="z")this.input.consume();else{var ne=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ne),ne}break;default:break e}}while(!0);this.state.type=ee,this.state.channel=re}finally{}},mPRIMITIVE:function(){try{var ee=this.PRIMITIVE,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,ne=2,ie=this.input.LA(1);if(ie=="["){var se=this.input.LA(2);if(se>="\0"&&se<="Z"||se>="\\"&&se<="￿")ne=1;else if(se=="[")ne=2;else{var le=new org.antlr.runtime.NoViableAltException("",22,1,this.input);throw le}}else{var le=new org.antlr.runtime.NoViableAltException("",22,0,this.input);throw le}switch(ne){case 1:if(this.mLBRACKET(),this.input.LA(1)>="\0"&&this.input.LA(1)<="Z"||this.input.LA(1)>="\\"&&this.input.LA(1)<="￿")this.input.consume();else{var ue=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ue),ue}e:do{var ae=2,oe=this.input.LA(1);switch(oe=="]"?ae=2:(oe>="\0"&&oe<="\\"||oe>="^"&&oe<="￿")&&(ae=1),ae){case 1:this.matchAny();break;default:break e}}while(!0);this.mRBRACKET();break;case 2:this.mLBRACKET(),this.mLBRACKET();e:do{var ce=2,he=this.input.LA(1);switch(he=="]"?ce=2:(he>="\0"&&he<="\\"||he>="^"&&he<="￿")&&(ce=1),ce){case 1:this.matchAny();break;default:break e}}while(!0);this.mRBRACKET(),this.mRBRACKET();break}this.state.type=ee,this.state.channel=re}finally{}},mLBRACKET:function(){try{var ee=this.LBRACKET,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("["),this.state.type=ee,this.state.channel=re}finally{}},mRBRACKET:function(){try{var ee=this.RBRACKET,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("]"),this.state.type=ee,this.state.channel=re}finally{}},mCOMMENT:function(){try{var ee=this.COMMENT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("/*");e:do{var ne=2,ie=this.input.LA(1);if(ie=="*"){var se=this.input.LA(2);se=="/"?ne=2:(se>="\0"&&se<="."||se>="0"&&se<="￿")&&(ne=1)}else(ie>="\0"&&ie<=")"||ie>="+"&&ie<="￿")&&(ne=1);switch(ne){case 1:this.matchAny();break;default:break e}}while(!0);this.match("*/"),re=te,this.state.type=ee,this.state.channel=re}finally{}},mLINE_COMMENT:function(){try{var ee=this.LINE_COMMENT,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,ne=2,ie=this.input.LA(1);if(ie=="/")ne=1;else if(ie=="#")ne=2;else{var se=new org.antlr.runtime.NoViableAltException("",24,0,this.input);throw se}switch(ne){case 1:this.match("//");break;case 2:this.match("#");break}e:do{var le=2,ue=this.input.LA(1);switch((ue>="\0"&&ue<="	"||ue>="\v"&&ue<="\f"||ue>=""&&ue<="￿")&&(le=1),le){case 1:if(this.input.LA(1)>="\0"&&this.input.LA(1)<="	"||this.input.LA(1)>="\v"&&this.input.LA(1)<="\f"||this.input.LA(1)>=""&&this.input.LA(1)<="￿")this.input.consume();else{var ae=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ae),ae}break;default:break e}}while(!0);re=te,this.state.type=ee,this.state.channel=re}finally{}},mCOLON:function(){try{var ee=this.COLON,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match(":"),this.state.type=ee,this.state.channel=re}finally{}},mWS:function(){try{var ee=this.WS,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,ne=0;e:do{var ie=2,se=this.input.LA(1);switch((se=="	"||se=="\f"||se==" ")&&(ie=1),ie){case 1:if(this.input.LA(1)=="	"||this.input.LA(1)=="\f"||this.input.LA(1)==" ")this.input.consume();else{var le=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(le),le}break;default:if(ne>=1)break e;var ue=new org.antlr.runtime.EarlyExitException(26,this.input);throw ue}ne++}while(!0);re=te,this.state.type=ee,this.state.channel=re}finally{}},mA:function(){try{if(this.input.LA(1)=="A"||this.input.LA(1)=="a")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mB:function(){try{if(this.input.LA(1)=="B"||this.input.LA(1)=="b")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mC:function(){try{if(this.input.LA(1)=="C"||this.input.LA(1)=="c")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mD:function(){try{if(this.input.LA(1)=="D"||this.input.LA(1)=="d")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mE:function(){try{if(this.input.LA(1)=="E"||this.input.LA(1)=="e")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mF:function(){try{if(this.input.LA(1)=="F"||this.input.LA(1)=="f")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mG:function(){try{if(this.input.LA(1)=="G"||this.input.LA(1)=="g")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mH:function(){try{if(this.input.LA(1)=="H"||this.input.LA(1)=="h")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mI:function(){try{if(this.input.LA(1)=="I"||this.input.LA(1)=="i")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mJ:function(){try{if(this.input.LA(1)=="J"||this.input.LA(1)=="j")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mK:function(){try{if(this.input.LA(1)=="K"||this.input.LA(1)=="k")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mL:function(){try{if(this.input.LA(1)=="L"||this.input.LA(1)=="l")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mM:function(){try{if(this.input.LA(1)=="M"||this.input.LA(1)=="m")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mN:function(){try{if(this.input.LA(1)=="N"||this.input.LA(1)=="n")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mO:function(){try{if(this.input.LA(1)=="O"||this.input.LA(1)=="o")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mP:function(){try{if(this.input.LA(1)=="P"||this.input.LA(1)=="p")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mQ:function(){try{if(this.input.LA(1)=="Q"||this.input.LA(1)=="q")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mR:function(){try{if(this.input.LA(1)=="R"||this.input.LA(1)=="r")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mS:function(){try{if(this.input.LA(1)=="S"||this.input.LA(1)=="s")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mT:function(){try{if(this.input.LA(1)=="T"||this.input.LA(1)=="t")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mU:function(){try{if(this.input.LA(1)=="U"||this.input.LA(1)=="u")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mV:function(){try{if(this.input.LA(1)=="V"||this.input.LA(1)=="v")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mW:function(){try{if(this.input.LA(1)=="W"||this.input.LA(1)=="w")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mX:function(){try{if(this.input.LA(1)=="X"||this.input.LA(1)=="x")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mY:function(){try{if(this.input.LA(1)=="Y"||this.input.LA(1)=="y")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mZ:function(){try{if(this.input.LA(1)=="Z"||this.input.LA(1)=="z")this.input.consume();else{var ee=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(ee),ee}}finally{}},mCOMMA:function(){try{var ee=this.COMMA,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match(","),this.state.type=ee,this.state.channel=re}finally{}},mSTRING:function(){try{var ee=this.STRING,re=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,ne=2,ie=this.input.LA(1);if(ie=="'")ne=1;else if(ie=='"')ne=2;else{var se=new org.antlr.runtime.NoViableAltException("",29,0,this.input);throw se}switch(ne){case 1:this.match("'");e:do{var le=2,ue=this.input.LA(1);switch(ue=="'"?le=2:(ue>="\0"&&ue<="&"||ue>="("&&ue<="￿")&&(le=1),le){case 1:this.matchAny();break;default:break e}}while(!0);this.match("'");break;case 2:this.match('"');e:do{var ae=3,oe=this.input.LA(1);if(oe=="\\"){var ce=this.input.LA(2);if(ce=='"'){var he=this.input.LA(3);he>="\0"&&he<="￿"?ae=1:ae=2}else(ce>="\0"&&ce<="!"||ce>="#"&&ce<="￿")&&(ae=2)}else(oe>="\0"&&oe<="!"||oe>="#"&&oe<="["||oe>="]"&&oe<="￿")&&(ae=2);switch(ae){case 1:this.match('\\"');break;case 2:if(this.input.LA(1)>="\0"&&this.input.LA(1)<="!"||this.input.LA(1)>="#"&&this.input.LA(1)<="￿")this.input.consume();else{var pe=new org.antlr.runtime.MismatchedSetException(null,this.input);throw this.recover(pe),pe}break;default:break e}}while(!0);this.match('"');break}this.state.type=ee,this.state.channel=re}finally{}},mTokens:function(){var ee=59;switch(ee=this.dfa30.predict(this.input),ee){case 1:this.mT__113();break;case 2:this.mT__114();break;case 3:this.mT__115();break;case 4:this.mT__116();break;case 5:this.mNEWLINE();break;case 6:this.mWHILESTATEMENT();break;case 7:this.mFORSTATEMENT();break;case 8:this.mFROMSTATEMENT();break;case 9:this.mINSTATEMENT();break;case 10:this.mTOSTATEMENT();break;case 11:this.mBYSTATEMENT();break;case 12:this.mLOOPSTATEMENT();break;case 13:this.mIFSTATEMENT();break;case 14:this.mTHENSTATEMENT();break;case 15:this.mELSESTATEMENT();break;case 16:this.mFUNCTIONSTATEMENT();break;case 17:this.mENDBLOCK();break;case 18:this.mRETURNSTATEMENT();break;case 19:this.mNEWSTATEMENT();break;case 20:this.mTRYSTATEMENT();break;case 21:this.mCATCHSTATEMENT();break;case 22:this.mTHROWSTATEMENT();break;case 23:this.mOR();break;case 24:this.mXOR();break;case 25:this.mAND();break;case 26:this.mEQUALS();break;case 27:this.mNOTEQUALS();break;case 28:this.mLT();break;case 29:this.mLTEQ();break;case 30:this.mGT();break;case 31:this.mGTEQ();break;case 32:this.mPLUS();break;case 33:this.mMINUS();break;case 34:this.mMULT();break;case 35:this.mDIV();break;case 36:this.mMOD();break;case 37:this.mPOW();break;case 38:this.mNOT();break;case 39:this.mLARR();break;case 40:this.mRARR();break;case 41:this.mLCURL();break;case 42:this.mRCURL();break;case 43:this.mINTEGER();break;case 44:this.mFLOAT();break;case 45:this.mTRUE();break;case 46:this.mFALSE();break;case 47:this.mPER();break;case 48:this.mSQUARED();break;case 49:this.mCUBED();break;case 50:this.mIDENT();break;case 51:this.mPRIMITIVE();break;case 52:this.mLBRACKET();break;case 53:this.mRBRACKET();break;case 54:this.mCOMMENT();break;case 55:this.mLINE_COMMENT();break;case 56:this.mCOLON();break;case 57:this.mWS();break;case 58:this.mCOMMA();break;case 59:this.mSTRING();break}}},!0),org.antlr.lang.augmentObject(FormulaLexer,{DFA30_eotS:`￿12￿
&￿&￿&￿JL￿N￿&￿P&￿S\f￿&Z[\\&a\b&&￿&￿&￿&p&￿&v&￿&z&|J&&￿&&￿￿&￿&￿&￿&￿￿&&￿&￿￿&￿￿`,DFA30_eofS:"￿",DFA30_minS:"	￿-0￿HAFHYOLEA￿RO￿N￿=￿*￿O￿.EQ￿\0\f￿IRONL0EU0OSDTWTB0RD￿D￿RU￿L0MCS￿NO0E￿PE0U0CE0AE￿0TE0W￿0￿R￿HD￿R0￿I0￿0￿N0E￿O￿0￿DN￿0￿",DFA30_maxS:"»￿>9￿hunryoneou￿ro￿n￿=>￿/￿o￿9eq￿￿\f￿ironlzryzosdtwtbzrd￿d￿ru￿lzmcs￿noze￿pezuzcezae￿ztezw￿z￿r￿hd￿rz￿iz￿z￿nze￿o￿z￿dn￿z￿",DFA30_acceptS:`￿￿
￿￿￿￿ !"￿$￿%'()*￿2￿5789:;\x1B,￿&6#￿+￿43￿	\r
￿\v￿\x07￿￿￿￿/￿\b￿￿-\f￿￿.￿1￿￿0`,DFA30_specialS:"'￿\0u￿}>",DFA30_transitionS:[`+￿+￿+-)￿-,\x1B
#*￿￿
&\f\x07&\b&\v$&\r%	&&'￿(￿
&\f\x07&\b&\v$&\r%	&&!"-￿￿ `,"","",".￿0/",`
3`,"","4￿4","8\r￿5￿6￿7\v￿8\r￿5￿6￿7",":\x07￿9￿:\x07￿9","<￿;￿=￿<￿;￿=",">￿>","?￿?","@￿A￿@￿A","B￿B","C	￿D￿C	￿D","E￿F\v￿E￿F","","G￿G","H￿H","","I￿I","","/","K ","","","","M￿)","","O￿O","","","","","",`3￿
#`,"Q￿Q","R￿R","","\0T","","","","","","","","","","","","","U￿U","V￿V","W￿W","X￿X","Y￿Y",`
&\x07￿&￿&￿&`,`
&\x07￿&￿&￿&`,`
&\x07￿&￿&￿&`,"]\f￿^￿]\f￿^","`￿_\x1B￿`￿_",`
&\x07￿&￿&￿&`,"b￿b","c￿c","d￿d","e￿e","f￿f","g￿g","h￿h","i￿i",`
&\x07￿&￿&￿&`,"j￿j","k￿k","","","","","","l￿l","","m￿m","n￿n","","","o￿o",`
&\x07￿&￿&￿&`,"q￿q","r￿r","s￿s","","","","t￿t","u￿u",`
&\x07￿&￿&￿&`,"w￿w","","x￿x","y￿y",`
&\x07￿&￿&￿&`,"{￿{",`
&\x07￿&￿&￿&`,`
&\x07￿&￿&￿&`,"}￿}","~￿~",`
&\x07￿&￿&￿&`,`
&\x07￿&￿&￿&`,`
&\x07￿&￿&￿&`,`
&\x07￿&￿&￿&`,"￿","￿","",`
&\x07￿&￿&￿&`,"￿","￿",`
&\x07￿&￿&￿&`,"￿","",`
&\x07￿&￿&￿&`,`
&\x07￿&￿&￿&`,`
&\x07￿&￿&￿&`,"","￿","","￿","￿","","","￿",`
&\x07￿&￿&￿&`,"","￿",`
&\x07￿&￿&￿&`,"",`
&\x07￿&￿&￿&`,"","","","￿",`
&\x07￿&￿&￿&`,`
&\x07￿&￿&￿&`,"￿","","￿","","",`
&\x07￿&￿&￿&`,"","","￿","￿","",`
&\x07￿&￿&￿&`,`
&\x07￿&￿&￿&`,"",""]}),org.antlr.lang.augmentObject(FormulaLexer,{DFA30_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaLexer.DFA30_eotS),DFA30_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaLexer.DFA30_eofS),DFA30_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaLexer.DFA30_minS),DFA30_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaLexer.DFA30_maxS),DFA30_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaLexer.DFA30_acceptS),DFA30_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaLexer.DFA30_specialS),DFA30_transition:function(){var ee=[],re,ne=FormulaLexer.DFA30_transitionS.length;for(re=0;re<ne;re++)ee.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaLexer.DFA30_transitionS[re]));return ee}()}),FormulaLexer.DFA30=function(ee){this.recognizer=ee,this.decisionNumber=30,this.eot=FormulaLexer.DFA30_eot,this.eof=FormulaLexer.DFA30_eof,this.min=FormulaLexer.DFA30_min,this.max=FormulaLexer.DFA30_max,this.accept=FormulaLexer.DFA30_accept,this.special=FormulaLexer.DFA30_special,this.transition=FormulaLexer.DFA30_transition},org.antlr.lang.extend(FormulaLexer.DFA30,org.antlr.runtime.DFA,{getDescription:function(){return"1:1: Tokens : ( T__113 | T__114 | T__115 | T__116 | NEWLINE | WHILESTATEMENT | FORSTATEMENT | FROMSTATEMENT | INSTATEMENT | TOSTATEMENT | BYSTATEMENT | LOOPSTATEMENT | IFSTATEMENT | THENSTATEMENT | ELSESTATEMENT | FUNCTIONSTATEMENT | ENDBLOCK | RETURNSTATEMENT | NEWSTATEMENT | TRYSTATEMENT | CATCHSTATEMENT | THROWSTATEMENT | OR | XOR | AND | EQUALS | NOTEQUALS | LT | LTEQ | GT | GTEQ | PLUS | MINUS | MULT | DIV | MOD | POW | NOT | LARR | RARR | LCURL | RCURL | INTEGER | FLOAT | TRUE | FALSE | PER | SQUARED | CUBED | IDENT | PRIMITIVE | LBRACKET | RBRACKET | COMMENT | LINE_COMMENT | COLON | WS | COMMA | STRING );"},specialStateTransition:function(ee,re){var ne=ee,ie=function(le,ue){switch(le){case 0:var ae=ue.LA(1);if(le=-1,ae>="\0"&&ae<="￿"?le=84:le=83,le>=0)return le;break}}.call(this.recognizer,ee,re);if(!org.antlr.lang.isUndefined(ie))return ie;var se=new org.antlr.runtime.NoViableAltException(this.getDescription(),30,ne,re);throw this.error(se),se},dummy:null})})();function FormulaParser(te,ee){ee||(ee=new org.antlr.runtime.RecognizerSharedState),function(){}.call(this),FormulaParser.superclass.constructor.call(this,te,ee),this.dfa5=new FormulaParser.DFA5(this),this.dfa57=new FormulaParser.DFA57(this),this.dfa58=new FormulaParser.DFA58(this),this.dfa65=new FormulaParser.DFA65(this),this.dfa72=new FormulaParser.DFA72(this),this.dfa85=new FormulaParser.DFA85(this),this.adaptor=new org.antlr.runtime.tree.CommonTreeAdaptor}org.antlr.lang.augmentObject(FormulaParser,{EOF:-1,T__113:113,T__114:114,T__115:115,T__116:116,NEGATE:4,ASSIGN:5,FUNCALL:6,MATERIAL:7,UNIT:8,POWER:9,DEFAULTS:10,PARAMS:11,UNITCLUMP:12,ARRAY:13,LINES:14,WHILE:15,IFTHENELSE:16,ELSE:17,FOR:18,FORIN:19,FUNCTION:20,ANONFUNCTION:21,NUMBER:22,LABEL:23,RANGE:24,INNER:25,ASSIGNED:26,SELECTOR:27,DOTSELECTOR:28,NEW:29,TRYCATCH:30,THROW:31,NEWLINE:32,W:33,H:34,I:35,L:36,E:37,WHILESTATEMENT:38,F:39,O:40,R:41,FORSTATEMENT:42,M:43,FROMSTATEMENT:44,N:45,INSTATEMENT:46,T:47,TOSTATEMENT:48,B:49,Y:50,BYSTATEMENT:51,P:52,LOOPSTATEMENT:53,IFSTATEMENT:54,THENSTATEMENT:55,S:56,ELSESTATEMENT:57,U:58,C:59,FUNCTIONSTATEMENT:60,D:61,ENDBLOCK:62,RETURNSTATEMENT:63,NEWSTATEMENT:64,TRYSTATEMENT:65,A:66,CATCHSTATEMENT:67,THROWSTATEMENT:68,IDENT:69,EQUALS:70,PRIMITIVE:71,OR:72,XOR:73,X:74,AND:75,NOTEQUALS:76,LT:77,LTEQ:78,GT:79,GTEQ:80,PLUS:81,MINUS:82,MULT:83,DIV:84,MOD:85,COLON:86,POW:87,NOT:88,LARR:89,RARR:90,LCURL:91,RCURL:92,COMMA:93,STRING:94,INTEGER:95,FLOAT:96,TRUE:97,FALSE:98,PER:99,CUBED:100,SQUARED:101,Q:102,LBRACKET:103,RBRACKET:104,COMMENT:105,LINE_COMMENT:106,WS:107,G:108,J:109,K:110,V:111,Z:112});(function(){var te=-1,ee=4,re=5,ne=6,ie=7,se=8,le=9,ue=10,ae=11,oe=12,ce=13,he=14,pe=15,de=16,me=18,ge=19,we=20,ve=21,_e=23,Te=24,ye=25,be=26,Fe=27,Le=28,Oe=29,Se=30,De=31,Ie=32,Ve=38,Ke=42,ht=44,qe=46,ot=48,nt=51,Xe=53,Ge=54,et=55,tt=57,je=60,at=62,Bt=63,Et=64,gt=65,Xt=67,xt=68,Ye=69,Rt=70,Pt=71,Ut=72,Zt=73,fr=75,dr=76,pr=77,mr=80,gr=81,Ct=82,Vt=83,vr=84,_r=85,tr=86,ir=87,Gt=88,Lt=89,Tr=90,kt=91,Er=92,pt=93,$t=94,ar=95,wr=96,yr=97,Wt=98,br=99,lr=100,cr=101;org.antlr.lang.extend(FormulaParser,org.antlr.runtime.Parser,{setTreeAdaptor:function(fe){this.adaptor=fe},getTreeAdaptor:function(){return this.adaptor},getTokenNames:function(){return FormulaParser.tokenNames},getGrammarFileName:function(){return"/Library/WebServer/Documents/calc/Formula.g"}}),org.antlr.lang.augmentObject(FormulaParser.prototype,{lines_return:function(){FormulaParser.lines_return=function(){},org.antlr.lang.extend(FormulaParser.lines_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),lines:function(){var fe=new FormulaParser.lines_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=null,ke=null,Ae=null,Re=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),Ce=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token EOF"),Me=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule expression");try{e:do{var We=2,$e=this.input.LA(1);switch($e==Ie&&(We=1),We){case 1:if(Ne=this.match(this.input,Ie,FormulaParser.FOLLOW_NEWLINE_in_lines160),this.state.failed)return fe;this.state.backtracking===0&&Re.add(Ne);break;default:break e}}while(!0);e:do{var Ue=2,Be=this.input.LA(1);switch((Be==Ve||Be==Ke||Be==Ge||Be==je||Be>=Bt&&Be<=gt||Be>=xt&&Be<=Ye||Be==Pt||Be==Ct||Be>=Gt&&Be<=Lt||Be==kt||Be>=$t&&Be<=Wt||Be==113)&&(Ue=1),Ue){case 1:if(this.pushFollow(FormulaParser.FOLLOW_expression_in_lines164),Ae=this.expression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&Me.add(Ae.getTree());var Je=2,st=this.input.LA(1);if(st==Ie)Je=1;else if(st==te)Je=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Ze=new org.antlr.runtime.NoViableAltException("",3,0,this.input);throw Ze}switch(Je){case 1:var ze=0;t:do{var it=2,ct=this.input.LA(1);switch(ct==Ie&&(it=1),it){case 1:if(Pe=this.match(this.input,Ie,FormulaParser.FOLLOW_NEWLINE_in_lines168),this.state.failed)return fe;this.state.backtracking===0&&Re.add(Pe);break;default:if(ze>=1)break t;if(this.state.backtracking>0)return this.state.failed=!0,fe;var ft=new org.antlr.runtime.EarlyExitException(2,this.input);throw ft}ze++}while(!0);break;case 2:if(xe=this.match(this.input,te,FormulaParser.FOLLOW_EOF_in_lines171),this.state.failed)return fe;this.state.backtracking===0&&Ce.add(xe);break}break;default:break e}}while(!0);if(ke=this.match(this.input,te,FormulaParser.FOLLOW_EOF_in_lines176),this.state.failed)return fe;if(this.state.backtracking===0&&Ce.add(ke),this.state.backtracking===0){fe.tree=Ee;var lt=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var ut=this.adaptor.nil();for(ut=this.adaptor.becomeRoot(this.adaptor.create(he,"LINES"),ut);Me.hasNext();)this.adaptor.addChild(ut,Me.nextTree());Me.reset(),this.adaptor.addChild(Ee,ut)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(He){if(He instanceof org.antlr.runtime.RecognitionException)this.reportError(He),this.recover(this.input,He),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),He);else throw He}finally{}return fe},expression_return:function(){FormulaParser.expression_return=function(){},org.antlr.lang.extend(FormulaParser.expression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),expression:function(){var fe=new FormulaParser.expression_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=null,ke=null,Ae=null,Re=null,Ce=null,Me=null,We=null,$e=null;try{var Ue=10;switch(Ue=this.dfa5.predict(this.input),Ue){case 1:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_assignment_in_expression508),Ne=this.assignment(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Ne.getTree());break;case 2:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_expression514),Pe=this.logicalExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Pe.getTree());break;case 3:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_whileLoop_in_expression520),xe=this.whileLoop(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,xe.getTree());break;case 4:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_forLoop_in_expression526),ke=this.forLoop(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,ke.getTree());break;case 5:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_forInLoop_in_expression532),Ae=this.forInLoop(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Ae.getTree());break;case 6:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_ifThenElse_in_expression538),Re=this.ifThenElse(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Re.getTree());break;case 7:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_functionDef_in_expression544),Ce=this.functionDef(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Ce.getTree());break;case 8:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_returnExp_in_expression550),Me=this.returnExp(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Me.getTree());break;case 9:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_tryCatch_in_expression556),We=this.tryCatch(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,We.getTree());break;case 10:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_throwExp_in_expression562),$e=this.throwExp(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,$e.getTree());break}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Be){if(Be instanceof org.antlr.runtime.RecognitionException)this.reportError(Be),this.recover(this.input,Be),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Be);else throw Be}finally{}return fe},returnExp_return:function(){FormulaParser.returnExp_return=function(){},org.antlr.lang.extend(FormulaParser.returnExp_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),returnExp:function(){var fe=new FormulaParser.returnExp_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=null;try{if(Ee=this.adaptor.nil(),Ne=this.match(this.input,Bt,FormulaParser.FOLLOW_RETURNSTATEMENT_in_returnExp574),this.state.failed||(this.state.backtracking===0&&(xe=this.adaptor.create(Ne),Ee=this.adaptor.becomeRoot(xe,Ee)),this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_returnExp577),Pe=this.logicalExpression(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Pe.getTree()),fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(ke){if(ke instanceof org.antlr.runtime.RecognitionException)this.reportError(ke),this.recover(this.input,ke),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),ke);else throw ke}finally{}return fe},innerBlock_return:function(){FormulaParser.innerBlock_return=function(){},org.antlr.lang.extend(FormulaParser.innerBlock_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),innerBlock:function(){var fe=new FormulaParser.innerBlock_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),ke=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule expression");try{e:do{var Ae=2,Re=this.input.LA(1);switch((Re==Ve||Re==Ke||Re==Ge||Re==je||Re>=Bt&&Re<=gt||Re>=xt&&Re<=Ye||Re==Pt||Re==Ct||Re>=Gt&&Re<=Lt||Re==kt||Re>=$t&&Re<=Wt||Re==113)&&(Ae=1),Ae){case 1:if(this.pushFollow(FormulaParser.FOLLOW_expression_in_innerBlock590),Pe=this.expression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&ke.add(Pe.getTree());var Ce=0;t:do{var Me=2,We=this.input.LA(1);switch(We==Ie&&(Me=1),Me){case 1:if(Ne=this.match(this.input,Ie,FormulaParser.FOLLOW_NEWLINE_in_innerBlock594),this.state.failed)return fe;this.state.backtracking===0&&xe.add(Ne);break;default:if(Ce>=1)break t;if(this.state.backtracking>0)return this.state.failed=!0,fe;var $e=new org.antlr.runtime.EarlyExitException(6,this.input);throw $e}Ce++}while(!0);break;default:break e}}while(!0);if(this.state.backtracking===0){fe.tree=Ee;var Ue=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var Be=this.adaptor.nil();if(Be=this.adaptor.becomeRoot(this.adaptor.create(he,"LINES"),Be),!ke.hasNext())throw new org.antlr.runtime.tree.RewriteEarlyExitException;for(;ke.hasNext();)this.adaptor.addChild(Be,ke.nextTree());ke.reset(),this.adaptor.addChild(Ee,Be)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Je){if(Je instanceof org.antlr.runtime.RecognitionException)this.reportError(Je),this.recover(this.input,Je),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Je);else throw Je}finally{}return fe},whileLoop_return:function(){FormulaParser.whileLoop_return=function(){},org.antlr.lang.extend(FormulaParser.whileLoop_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),whileLoop:function(){var fe=new FormulaParser.whileLoop_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=null,ke=null,Ae=null,Re=null,Ce=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),Me=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),We=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token LOOPSTATEMENT"),$e=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token WHILESTATEMENT"),Ue=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),Be=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{if(Ne=this.match(this.input,Ve,FormulaParser.FOLLOW_WHILESTATEMENT_in_whileLoop619),this.state.failed||(this.state.backtracking===0&&$e.add(Ne),this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_whileLoop621),Ae=this.logicalExpression(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&Be.add(Ae.getTree());var Je=0;e:do{var st=2,Ze=this.input.LA(1);switch(Ze==Ie&&(st=1),st){case 1:if(Pe=this.match(this.input,Ie,FormulaParser.FOLLOW_NEWLINE_in_whileLoop623),this.state.failed)return fe;this.state.backtracking===0&&Ce.add(Pe);break;default:if(Je>=1)break e;if(this.state.backtracking>0)return this.state.failed=!0,fe;var ze=new org.antlr.runtime.EarlyExitException(8,this.input);throw ze}Je++}while(!0);if(this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_whileLoop626),Re=this.innerBlock(),this.state._fsp--,this.state.failed||(this.state.backtracking===0&&Ue.add(Re.getTree()),xe=this.match(this.input,at,FormulaParser.FOLLOW_ENDBLOCK_in_whileLoop629),this.state.failed)||(this.state.backtracking===0&&Me.add(xe),ke=this.match(this.input,Xe,FormulaParser.FOLLOW_LOOPSTATEMENT_in_whileLoop631),this.state.failed))return fe;if(this.state.backtracking===0&&We.add(ke),this.state.backtracking===0){fe.tree=Ee;var it=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var ct=this.adaptor.nil();ct=this.adaptor.becomeRoot(this.adaptor.create(pe,"WHILE"),ct),this.adaptor.addChild(ct,Be.nextTree()),this.adaptor.addChild(ct,Ue.nextTree()),this.adaptor.addChild(Ee,ct)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(ft){if(ft instanceof org.antlr.runtime.RecognitionException)this.reportError(ft),this.recover(this.input,ft),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),ft);else throw ft}finally{}return fe},forLoop_return:function(){FormulaParser.forLoop_return=function(){},org.antlr.lang.extend(FormulaParser.forLoop_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),forLoop:function(){var fe=new FormulaParser.forLoop_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=null,ke=null,Ae=null,Re=null,Ce=null,Me=null,We=null,$e=null,Ue=null,Be=null,Je=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token FORSTATEMENT"),st=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),Ze=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token FROMSTATEMENT"),ze=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),it=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token TOSTATEMENT"),ct=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),ft=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token LOOPSTATEMENT"),lt=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token BYSTATEMENT"),ut=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),He=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{if(Ne=this.match(this.input,Ke,FormulaParser.FOLLOW_FORSTATEMENT_in_forLoop652),this.state.failed||(this.state.backtracking===0&&Je.add(Ne),Pe=this.match(this.input,Ye,FormulaParser.FOLLOW_IDENT_in_forLoop654),this.state.failed)||(this.state.backtracking===0&&st.add(Pe),xe=this.match(this.input,ht,FormulaParser.FOLLOW_FROMSTATEMENT_in_forLoop656),this.state.failed)||(this.state.backtracking===0&&Ze.add(xe),this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_forLoop658),We=this.logicalExpression(),this.state._fsp--,this.state.failed)||(this.state.backtracking===0&&He.add(We.getTree()),ke=this.match(this.input,ot,FormulaParser.FOLLOW_TOSTATEMENT_in_forLoop660),this.state.failed)||(this.state.backtracking===0&&it.add(ke),this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_forLoop662),$e=this.logicalExpression(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&He.add($e.getTree());var rt=2,vt=this.input.LA(1);switch(vt==nt&&(rt=1),rt){case 1:if(Ae=this.match(this.input,nt,FormulaParser.FOLLOW_BYSTATEMENT_in_forLoop665),this.state.failed||(this.state.backtracking===0&&lt.add(Ae),this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_forLoop667),Ue=this.logicalExpression(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&He.add(Ue.getTree());break}var wt=0;e:do{var Ot=2,Qe=this.input.LA(1);switch(Qe==Ie&&(Ot=1),Ot){case 1:if(Re=this.match(this.input,Ie,FormulaParser.FOLLOW_NEWLINE_in_forLoop671),this.state.failed)return fe;this.state.backtracking===0&&ze.add(Re);break;default:if(wt>=1)break e;if(this.state.backtracking>0)return this.state.failed=!0,fe;var _t=new org.antlr.runtime.EarlyExitException(10,this.input);throw _t}wt++}while(!0);if(this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_forLoop674),Be=this.innerBlock(),this.state._fsp--,this.state.failed||(this.state.backtracking===0&&ut.add(Be.getTree()),Ce=this.match(this.input,at,FormulaParser.FOLLOW_ENDBLOCK_in_forLoop677),this.state.failed)||(this.state.backtracking===0&&ct.add(Ce),Me=this.match(this.input,Xe,FormulaParser.FOLLOW_LOOPSTATEMENT_in_forLoop679),this.state.failed))return fe;if(this.state.backtracking===0&&ft.add(Me),this.state.backtracking===0){fe.tree=Ee;var mt=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var Tt=this.adaptor.nil();Tt=this.adaptor.becomeRoot(this.adaptor.create(me,"FOR"),Tt),this.adaptor.addChild(Tt,st.nextNode());{var yt=this.adaptor.nil();for(yt=this.adaptor.becomeRoot(this.adaptor.create(ae,"PARAMS"),yt);He.hasNext();)this.adaptor.addChild(yt,He.nextTree());He.reset(),this.adaptor.addChild(Tt,yt)}this.adaptor.addChild(Tt,ut.nextTree()),this.adaptor.addChild(Ee,Tt)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(bt){if(bt instanceof org.antlr.runtime.RecognitionException)this.reportError(bt),this.recover(this.input,bt),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),bt);else throw bt}finally{}return fe},forInLoop_return:function(){FormulaParser.forInLoop_return=function(){},org.antlr.lang.extend(FormulaParser.forInLoop_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),forInLoop:function(){var fe=new FormulaParser.forInLoop_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=null,ke=null,Ae=null,Re=null,Ce=null,Me=null,We=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token FORSTATEMENT"),$e=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),Ue=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),Be=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),Je=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token LOOPSTATEMENT"),st=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token INSTATEMENT"),Ze=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),ze=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{if(Ne=this.match(this.input,Ke,FormulaParser.FOLLOW_FORSTATEMENT_in_forInLoop707),this.state.failed||(this.state.backtracking===0&&We.add(Ne),Pe=this.match(this.input,Ye,FormulaParser.FOLLOW_IDENT_in_forInLoop709),this.state.failed)||(this.state.backtracking===0&&$e.add(Pe),xe=this.match(this.input,qe,FormulaParser.FOLLOW_INSTATEMENT_in_forInLoop711),this.state.failed)||(this.state.backtracking===0&&st.add(xe),this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_forInLoop713),Ce=this.logicalExpression(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&ze.add(Ce.getTree());var it=0;e:do{var ct=2,ft=this.input.LA(1);switch(ft==Ie&&(ct=1),ct){case 1:if(ke=this.match(this.input,Ie,FormulaParser.FOLLOW_NEWLINE_in_forInLoop715),this.state.failed)return fe;this.state.backtracking===0&&Ue.add(ke);break;default:if(it>=1)break e;if(this.state.backtracking>0)return this.state.failed=!0,fe;var lt=new org.antlr.runtime.EarlyExitException(11,this.input);throw lt}it++}while(!0);if(this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_forInLoop718),Me=this.innerBlock(),this.state._fsp--,this.state.failed||(this.state.backtracking===0&&Ze.add(Me.getTree()),Ae=this.match(this.input,at,FormulaParser.FOLLOW_ENDBLOCK_in_forInLoop721),this.state.failed)||(this.state.backtracking===0&&Be.add(Ae),Re=this.match(this.input,Xe,FormulaParser.FOLLOW_LOOPSTATEMENT_in_forInLoop723),this.state.failed))return fe;if(this.state.backtracking===0&&Je.add(Re),this.state.backtracking===0){fe.tree=Ee;var ut=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var He=this.adaptor.nil();He=this.adaptor.becomeRoot(this.adaptor.create(ge,"FORIN"),He),this.adaptor.addChild(He,$e.nextNode()),this.adaptor.addChild(He,ze.nextTree()),this.adaptor.addChild(He,Ze.nextTree()),this.adaptor.addChild(Ee,He)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(rt){if(rt instanceof org.antlr.runtime.RecognitionException)this.reportError(rt),this.recover(this.input,rt),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),rt);else throw rt}finally{}return fe},ifThenElse_return:function(){FormulaParser.ifThenElse_return=function(){},org.antlr.lang.extend(FormulaParser.ifThenElse_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),ifThenElse:function(){var fe=new FormulaParser.ifThenElse_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=null,ke=null,Ae=null,Re=null,Ce=null,Me=null,We=null,$e=null,Ue=null,Be=null,Je=null,st=null,Ze=null,ze=null,it=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IFSTATEMENT"),ct=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),ft=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),lt=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ELSESTATEMENT"),ut=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token THENSTATEMENT"),He=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),rt=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{if(Ne=this.match(this.input,Ge,FormulaParser.FOLLOW_IFSTATEMENT_in_ifThenElse748),this.state.failed||(this.state.backtracking===0&&it.add(Ne),this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_ifThenElse750),Be=this.logicalExpression(),this.state._fsp--,this.state.failed)||(this.state.backtracking===0&&rt.add(Be.getTree()),Pe=this.match(this.input,et,FormulaParser.FOLLOW_THENSTATEMENT_in_ifThenElse752),this.state.failed))return fe;this.state.backtracking===0&&ut.add(Pe);var vt=0;e:do{var wt=2,Ot=this.input.LA(1);switch(Ot==Ie&&(wt=1),wt){case 1:if(xe=this.match(this.input,Ie,FormulaParser.FOLLOW_NEWLINE_in_ifThenElse755),this.state.failed)return fe;this.state.backtracking===0&&ct.add(xe);break;default:if(vt>=1)break e;if(this.state.backtracking>0)return this.state.failed=!0,fe;var Qe=new org.antlr.runtime.EarlyExitException(12,this.input);throw Qe}vt++}while(!0);if(this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_ifThenElse758),Je=this.innerBlock(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&He.add(Je.getTree());e:do{var _t=2,mt=this.input.LA(1);if(mt==tt){var Tt=this.input.LA(2);Tt==Ge&&(_t=1)}switch(_t){case 1:if(ke=this.match(this.input,tt,FormulaParser.FOLLOW_ELSESTATEMENT_in_ifThenElse762),this.state.failed||(this.state.backtracking===0&&lt.add(ke),Ae=this.match(this.input,Ge,FormulaParser.FOLLOW_IFSTATEMENT_in_ifThenElse764),this.state.failed)||(this.state.backtracking===0&&it.add(Ae),this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_ifThenElse766),st=this.logicalExpression(),this.state._fsp--,this.state.failed)||(this.state.backtracking===0&&rt.add(st.getTree()),Re=this.match(this.input,et,FormulaParser.FOLLOW_THENSTATEMENT_in_ifThenElse768),this.state.failed))return fe;this.state.backtracking===0&&ut.add(Re);var yt=0;t:do{var bt=2,Nt=this.input.LA(1);switch(Nt==Ie&&(bt=1),bt){case 1:if(Ce=this.match(this.input,Ie,FormulaParser.FOLLOW_NEWLINE_in_ifThenElse770),this.state.failed)return fe;this.state.backtracking===0&&ct.add(Ce);break;default:if(yt>=1)break t;if(this.state.backtracking>0)return this.state.failed=!0,fe;var Qe=new org.antlr.runtime.EarlyExitException(13,this.input);throw Qe}yt++}while(!0);if(this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_ifThenElse773),Ze=this.innerBlock(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&He.add(Ze.getTree());break;default:break e}}while(!0);var St=2,Mt=this.input.LA(1);switch(Mt==tt&&(St=1),St){case 1:if(Me=this.match(this.input,tt,FormulaParser.FOLLOW_ELSESTATEMENT_in_ifThenElse778),this.state.failed)return fe;this.state.backtracking===0&&lt.add(Me);var jt=0;e:do{var Yt=2,Ht=this.input.LA(1);switch(Ht==Ie&&(Yt=1),Yt){case 1:if(We=this.match(this.input,Ie,FormulaParser.FOLLOW_NEWLINE_in_ifThenElse780),this.state.failed)return fe;this.state.backtracking===0&&ct.add(We);break;default:if(jt>=1)break e;if(this.state.backtracking>0)return this.state.failed=!0,fe;var Qe=new org.antlr.runtime.EarlyExitException(15,this.input);throw Qe}jt++}while(!0);if(this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_ifThenElse783),ze=this.innerBlock(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&He.add(ze.getTree());break}if($e=this.match(this.input,at,FormulaParser.FOLLOW_ENDBLOCK_in_ifThenElse787),this.state.failed||(this.state.backtracking===0&&ft.add($e),Ue=this.match(this.input,Ge,FormulaParser.FOLLOW_IFSTATEMENT_in_ifThenElse789),this.state.failed))return fe;if(this.state.backtracking===0&&it.add(Ue),this.state.backtracking===0){fe.tree=Ee;var Qt=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var Dt=this.adaptor.nil();Dt=this.adaptor.becomeRoot(this.adaptor.create(de,"IFTHENELSE"),Dt);{var dt=this.adaptor.nil();if(dt=this.adaptor.becomeRoot(this.adaptor.create(ae,"PARAMS"),dt),!rt.hasNext())throw new org.antlr.runtime.tree.RewriteEarlyExitException;for(;rt.hasNext();)this.adaptor.addChild(dt,rt.nextTree());rt.reset(),this.adaptor.addChild(Dt,dt)}{var dt=this.adaptor.nil();if(dt=this.adaptor.becomeRoot(this.adaptor.create(ae,"PARAMS"),dt),!He.hasNext())throw new org.antlr.runtime.tree.RewriteEarlyExitException;for(;He.hasNext();)this.adaptor.addChild(dt,He.nextTree());He.reset(),this.adaptor.addChild(Dt,dt)}this.adaptor.addChild(Ee,Dt)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(zt){if(zt instanceof org.antlr.runtime.RecognitionException)this.reportError(zt),this.recover(this.input,zt),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),zt);else throw zt}finally{}return fe},functionDef_return:function(){FormulaParser.functionDef_return=function(){},org.antlr.lang.extend(FormulaParser.functionDef_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),functionDef:function(){var fe=new FormulaParser.functionDef_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=null,ke=null,Ae=null,Re=null,Ce=null,Me=null,We=null,$e=null,Ue=null,Be=null,Je=null,st=null,Ze=null,ze=null,it=null,ct=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token FUNCTIONSTATEMENT"),ft=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 114"),lt=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),ut=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token EQUALS"),He=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 113"),rt=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),vt=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COMMA"),wt=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),Ot=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),Qe=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule defaultValue");try{if(Ne=this.match(this.input,je,FormulaParser.FOLLOW_FUNCTIONSTATEMENT_in_functionDef820),this.state.failed||(this.state.backtracking===0&&ct.add(Ne),Pe=this.match(this.input,Ye,FormulaParser.FOLLOW_IDENT_in_functionDef822),this.state.failed)||(this.state.backtracking===0&&lt.add(Pe),xe=this.match(this.input,113,FormulaParser.FOLLOW_113_in_functionDef824),this.state.failed))return fe;this.state.backtracking===0&&He.add(xe);var _t=2,mt=this.input.LA(1);switch(mt==Ye&&(_t=1),_t){case 1:if(ke=this.match(this.input,Ye,FormulaParser.FOLLOW_IDENT_in_functionDef827),this.state.failed)return fe;this.state.backtracking===0&&lt.add(ke);var Tt=2,yt=this.input.LA(1);if(yt==Rt)Tt=1;else if(yt==pt||yt==114)Tt=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var bt=new org.antlr.runtime.NoViableAltException("",18,0,this.input);throw bt}switch(Tt){case 1:if(Ae=this.match(this.input,Rt,FormulaParser.FOLLOW_EQUALS_in_functionDef831),this.state.failed||(this.state.backtracking===0&&ut.add(Ae),this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_functionDef834),Ze=this.defaultValue(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&Qe.add(Ze.getTree());break;case 2:e:do{var Nt=2,St=this.input.LA(1);if(St==pt){var Mt=this.input.LA(2);if(Mt==Ye){var jt=this.input.LA(3);(jt==pt||jt==114)&&(Nt=1)}}switch(Nt){case 1:if(Re=this.match(this.input,pt,FormulaParser.FOLLOW_COMMA_in_functionDef839),this.state.failed||(this.state.backtracking===0&&vt.add(Re),Ce=this.match(this.input,Ye,FormulaParser.FOLLOW_IDENT_in_functionDef841),this.state.failed))return fe;this.state.backtracking===0&&lt.add(Ce);break;default:break e}}while(!0);break}e:do{var Yt=2,Ht=this.input.LA(1);switch(Ht==pt&&(Yt=1),Yt){case 1:if(Me=this.match(this.input,pt,FormulaParser.FOLLOW_COMMA_in_functionDef848),this.state.failed||(this.state.backtracking===0&&vt.add(Me),We=this.match(this.input,Ye,FormulaParser.FOLLOW_IDENT_in_functionDef850),this.state.failed)||(this.state.backtracking===0&&lt.add(We),$e=this.match(this.input,Rt,FormulaParser.FOLLOW_EQUALS_in_functionDef852),this.state.failed)||(this.state.backtracking===0&&ut.add($e),this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_functionDef854),ze=this.defaultValue(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&Qe.add(ze.getTree());break;default:break e}}while(!0);break}if(Ue=this.match(this.input,114,FormulaParser.FOLLOW_114_in_functionDef861),this.state.failed)return fe;this.state.backtracking===0&&ft.add(Ue);var Qt=0;e:do{var Dt=2,dt=this.input.LA(1);switch(dt==Ie&&(Dt=1),Dt){case 1:if(Be=this.match(this.input,Ie,FormulaParser.FOLLOW_NEWLINE_in_functionDef863),this.state.failed)return fe;this.state.backtracking===0&&rt.add(Be);break;default:if(Qt>=1)break e;if(this.state.backtracking>0)return this.state.failed=!0,fe;var zt=new org.antlr.runtime.EarlyExitException(21,this.input);throw zt}Qt++}while(!0);if(this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_functionDef866),it=this.innerBlock(),this.state._fsp--,this.state.failed||(this.state.backtracking===0&&Ot.add(it.getTree()),Je=this.match(this.input,at,FormulaParser.FOLLOW_ENDBLOCK_in_functionDef869),this.state.failed)||(this.state.backtracking===0&&wt.add(Je),st=this.match(this.input,je,FormulaParser.FOLLOW_FUNCTIONSTATEMENT_in_functionDef871),this.state.failed))return fe;if(this.state.backtracking===0&&ct.add(st),this.state.backtracking===0){fe.tree=Ee;var er=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var Kt=this.adaptor.nil();Kt=this.adaptor.becomeRoot(this.adaptor.create(we,"FUNCTION"),Kt);{var qt=this.adaptor.nil();for(qt=this.adaptor.becomeRoot(this.adaptor.create(ae,"PARAMS"),qt);lt.hasNext();)this.adaptor.addChild(qt,lt.nextNode());lt.reset(),this.adaptor.addChild(Kt,qt)}{var qt=this.adaptor.nil();for(qt=this.adaptor.becomeRoot(this.adaptor.create(ue,"DEFAULTS"),qt);Qe.hasNext();)this.adaptor.addChild(qt,Qe.nextTree());Qe.reset(),this.adaptor.addChild(Kt,qt)}this.adaptor.addChild(Kt,Ot.nextTree()),this.adaptor.addChild(Ee,Kt)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Jt){if(Jt instanceof org.antlr.runtime.RecognitionException)this.reportError(Jt),this.recover(this.input,Jt),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Jt);else throw Jt}finally{}return fe},tryCatch_return:function(){FormulaParser.tryCatch_return=function(){},org.antlr.lang.extend(FormulaParser.tryCatch_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),tryCatch:function(){var fe=new FormulaParser.tryCatch_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=null,ke=null,Ae=null,Re=null,Ce=null,Me=null,We=null,$e=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),Ue=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token TRYSTATEMENT"),Be=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),Je=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token CATCHSTATEMENT"),st=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),Ze=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock");try{if(Ne=this.match(this.input,gt,FormulaParser.FOLLOW_TRYSTATEMENT_in_tryCatch904),this.state.failed)return fe;this.state.backtracking===0&&Ue.add(Ne);var ze=0;e:do{var it=2,ct=this.input.LA(1);switch(ct==Ie&&(it=1),it){case 1:if(Pe=this.match(this.input,Ie,FormulaParser.FOLLOW_NEWLINE_in_tryCatch906),this.state.failed)return fe;this.state.backtracking===0&&Be.add(Pe);break;default:if(ze>=1)break e;if(this.state.backtracking>0)return this.state.failed=!0,fe;var ft=new org.antlr.runtime.EarlyExitException(22,this.input);throw ft}ze++}while(!0);if(this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_tryCatch909),Me=this.innerBlock(),this.state._fsp--,this.state.failed||(this.state.backtracking===0&&Ze.add(Me.getTree()),xe=this.match(this.input,Xt,FormulaParser.FOLLOW_CATCHSTATEMENT_in_tryCatch911),this.state.failed)||(this.state.backtracking===0&&Je.add(xe),ke=this.match(this.input,Ye,FormulaParser.FOLLOW_IDENT_in_tryCatch913),this.state.failed))return fe;this.state.backtracking===0&&$e.add(ke);var lt=0;e:do{var ut=2,He=this.input.LA(1);switch(He==Ie&&(ut=1),ut){case 1:if(Ae=this.match(this.input,Ie,FormulaParser.FOLLOW_NEWLINE_in_tryCatch915),this.state.failed)return fe;this.state.backtracking===0&&Be.add(Ae);break;default:if(lt>=1)break e;if(this.state.backtracking>0)return this.state.failed=!0,fe;var ft=new org.antlr.runtime.EarlyExitException(23,this.input);throw ft}lt++}while(!0);if(this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_tryCatch919),We=this.innerBlock(),this.state._fsp--,this.state.failed||(this.state.backtracking===0&&Ze.add(We.getTree()),Re=this.match(this.input,at,FormulaParser.FOLLOW_ENDBLOCK_in_tryCatch921),this.state.failed)||(this.state.backtracking===0&&st.add(Re),Ce=this.match(this.input,gt,FormulaParser.FOLLOW_TRYSTATEMENT_in_tryCatch923),this.state.failed))return fe;if(this.state.backtracking===0&&Ue.add(Ce),this.state.backtracking===0){fe.tree=Ee;var rt=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var vt=this.adaptor.nil();for(vt=this.adaptor.becomeRoot(this.adaptor.create(Se,"TRYCATCH"),vt);Ze.hasNext();)this.adaptor.addChild(vt,Ze.nextTree());Ze.reset(),this.adaptor.addChild(vt,$e.nextNode()),this.adaptor.addChild(Ee,vt)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(wt){if(wt instanceof org.antlr.runtime.RecognitionException)this.reportError(wt),this.recover(this.input,wt),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),wt);else throw wt}finally{}return fe},throwExp_return:function(){FormulaParser.throwExp_return=function(){},org.antlr.lang.extend(FormulaParser.throwExp_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),throwExp:function(){var fe=new FormulaParser.throwExp_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token THROWSTATEMENT"),ke=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule primaryExpression");try{if(Ne=this.match(this.input,xt,FormulaParser.FOLLOW_THROWSTATEMENT_in_throwExp945),this.state.failed||(this.state.backtracking===0&&xe.add(Ne),this.pushFollow(FormulaParser.FOLLOW_primaryExpression_in_throwExp947),Pe=this.primaryExpression(),this.state._fsp--,this.state.failed))return fe;if(this.state.backtracking===0&&ke.add(Pe.getTree()),this.state.backtracking===0){fe.tree=Ee;var Ae=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var Re=this.adaptor.nil();Re=this.adaptor.becomeRoot(this.adaptor.create(De,"THROW"),Re),this.adaptor.addChild(Re,ke.nextTree()),this.adaptor.addChild(Ee,Re)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Ce){if(Ce instanceof org.antlr.runtime.RecognitionException)this.reportError(Ce),this.recover(this.input,Ce),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Ce);else throw Ce}finally{}return fe},anonFunctionDef_return:function(){FormulaParser.anonFunctionDef_return=function(){},org.antlr.lang.extend(FormulaParser.anonFunctionDef_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),anonFunctionDef:function(){var fe=new FormulaParser.anonFunctionDef_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=null,ke=null,Ae=null,Re=null,Ce=null,Me=null,We=null,$e=null,Ue=null,Be=null,Je=null,st=null,Ze=null,ze=null,it=null,ct=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token FUNCTIONSTATEMENT"),ft=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 114"),lt=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),ut=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token EQUALS"),He=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 113"),rt=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),vt=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COMMA"),wt=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),Ot=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule expression"),Qe=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),_t=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule defaultValue");try{if(Ne=this.match(this.input,je,FormulaParser.FOLLOW_FUNCTIONSTATEMENT_in_anonFunctionDef967),this.state.failed||(this.state.backtracking===0&&ct.add(Ne),Pe=this.match(this.input,113,FormulaParser.FOLLOW_113_in_anonFunctionDef970),this.state.failed))return fe;this.state.backtracking===0&&He.add(Pe);var mt=2,Tt=this.input.LA(1);switch(Tt==Ye&&(mt=1),mt){case 1:if(xe=this.match(this.input,Ye,FormulaParser.FOLLOW_IDENT_in_anonFunctionDef973),this.state.failed)return fe;this.state.backtracking===0&&lt.add(xe);var yt=2,bt=this.input.LA(1);if(bt==Rt)yt=1;else if(bt==pt||bt==114)yt=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Nt=new org.antlr.runtime.NoViableAltException("",25,0,this.input);throw Nt}switch(yt){case 1:if(ke=this.match(this.input,Rt,FormulaParser.FOLLOW_EQUALS_in_anonFunctionDef977),this.state.failed||(this.state.backtracking===0&&ut.add(ke),this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_anonFunctionDef980),st=this.defaultValue(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&_t.add(st.getTree());break;case 2:e:do{var St=2,Mt=this.input.LA(1);if(Mt==pt){var jt=this.input.LA(2);if(jt==Ye){var Yt=this.input.LA(3);(Yt==pt||Yt==114)&&(St=1)}}switch(St){case 1:if(Ae=this.match(this.input,pt,FormulaParser.FOLLOW_COMMA_in_anonFunctionDef985),this.state.failed||(this.state.backtracking===0&&vt.add(Ae),Re=this.match(this.input,Ye,FormulaParser.FOLLOW_IDENT_in_anonFunctionDef987),this.state.failed))return fe;this.state.backtracking===0&&lt.add(Re);break;default:break e}}while(!0);break}e:do{var Ht=2,Qt=this.input.LA(1);switch(Qt==pt&&(Ht=1),Ht){case 1:if(Ce=this.match(this.input,pt,FormulaParser.FOLLOW_COMMA_in_anonFunctionDef994),this.state.failed||(this.state.backtracking===0&&vt.add(Ce),Me=this.match(this.input,Ye,FormulaParser.FOLLOW_IDENT_in_anonFunctionDef996),this.state.failed)||(this.state.backtracking===0&&lt.add(Me),We=this.match(this.input,Rt,FormulaParser.FOLLOW_EQUALS_in_anonFunctionDef998),this.state.failed)||(this.state.backtracking===0&&ut.add(We),this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_anonFunctionDef1000),Ze=this.defaultValue(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&_t.add(Ze.getTree());break;default:break e}}while(!0);break}if($e=this.match(this.input,114,FormulaParser.FOLLOW_114_in_anonFunctionDef1007),this.state.failed)return fe;this.state.backtracking===0&&ft.add($e);var Dt=2,dt=this.input.LA(1);if(dt==Ie)Dt=1;else if(dt==Ve||dt==Ke||dt==Ge||dt==je||dt>=Bt&&dt<=gt||dt>=xt&&dt<=Ye||dt==Pt||dt==Ct||dt>=Gt&&dt<=Lt||dt==kt||dt>=$t&&dt<=Wt||dt==113)Dt=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Nt=new org.antlr.runtime.NoViableAltException("",29,0,this.input);throw Nt}switch(Dt){case 1:var zt=0;e:do{var er=2,Kt=this.input.LA(1);switch(Kt==Ie&&(er=1),er){case 1:if(Ue=this.match(this.input,Ie,FormulaParser.FOLLOW_NEWLINE_in_anonFunctionDef1012),this.state.failed)return fe;this.state.backtracking===0&&rt.add(Ue);break;default:if(zt>=1)break e;if(this.state.backtracking>0)return this.state.failed=!0,fe;var qt=new org.antlr.runtime.EarlyExitException(28,this.input);throw qt}zt++}while(!0);if(this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_anonFunctionDef1015),ze=this.innerBlock(),this.state._fsp--,this.state.failed||(this.state.backtracking===0&&Qe.add(ze.getTree()),Be=this.match(this.input,at,FormulaParser.FOLLOW_ENDBLOCK_in_anonFunctionDef1018),this.state.failed)||(this.state.backtracking===0&&wt.add(Be),Je=this.match(this.input,je,FormulaParser.FOLLOW_FUNCTIONSTATEMENT_in_anonFunctionDef1020),this.state.failed))return fe;this.state.backtracking===0&&ct.add(Je);break;case 2:if(this.pushFollow(FormulaParser.FOLLOW_expression_in_anonFunctionDef1025),it=this.expression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&Ot.add(it.getTree());break}if(this.state.backtracking===0){fe.tree=Ee;var Jt=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var Ft=this.adaptor.nil();Ft=this.adaptor.becomeRoot(this.adaptor.create(ve,"ANONFUNCTION"),Ft);{var At=this.adaptor.nil();for(At=this.adaptor.becomeRoot(this.adaptor.create(ae,"PARAMS"),At);lt.hasNext();)this.adaptor.addChild(At,lt.nextNode());lt.reset(),this.adaptor.addChild(Ft,At)}{var At=this.adaptor.nil();for(At=this.adaptor.becomeRoot(this.adaptor.create(ue,"DEFAULTS"),At);_t.hasNext();)this.adaptor.addChild(At,_t.nextTree());_t.reset(),this.adaptor.addChild(Ft,At)}Qe.hasNext()&&this.adaptor.addChild(Ft,Qe.nextTree()),Qe.reset(),Ot.hasNext()&&this.adaptor.addChild(Ft,Ot.nextTree()),Ot.reset(),this.adaptor.addChild(Ee,Ft)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(It){if(It instanceof org.antlr.runtime.RecognitionException)this.reportError(It),this.recover(this.input,It),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),It);else throw It}finally{}return fe},assignment_return:function(){FormulaParser.assignment_return=function(){},org.antlr.lang.extend(FormulaParser.assignment_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),assignment:function(){var fe=new FormulaParser.assignment_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=null,ke=null,Ae=null,Re=null,Ce=null,Me=null,We=null,$e=null,Ue=null,Be=null,Je=null,st=null,Ze=null,ze=null,it=null,ct=null,ft=null,lt=null,ut=null,He=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 114"),rt=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),vt=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 115"),wt=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token EQUALS"),Ot=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 113"),Qe=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COMMA"),_t=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token PRIMITIVE"),mt=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule assigned"),Tt=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule defaultValue"),yt=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{var bt=2,Nt=this.input.LA(1);if(Nt==Ye){var St=this.input.LA(2);if(St==113)bt=1;else if(St==Lt||St==kt||St==pt||St>=115&&St<=116)bt=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Mt=new org.antlr.runtime.NoViableAltException("",37,1,this.input);throw Mt}}else if(Nt==Pt)bt=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Mt=new org.antlr.runtime.NoViableAltException("",37,0,this.input);throw Mt}switch(bt){case 1:if(Ne=this.match(this.input,Ye,FormulaParser.FOLLOW_IDENT_in_assignment1067),this.state.failed||(this.state.backtracking===0&&rt.add(Ne),Pe=this.match(this.input,113,FormulaParser.FOLLOW_113_in_assignment1069),this.state.failed))return fe;this.state.backtracking===0&&Ot.add(Pe);var jt=2,Yt=this.input.LA(1);switch(Yt==Ye&&(jt=1),jt){case 1:if(xe=this.match(this.input,Ye,FormulaParser.FOLLOW_IDENT_in_assignment1072),this.state.failed)return fe;this.state.backtracking===0&&rt.add(xe);var Ht=2,Qt=this.input.LA(1);if(Qt==Rt)Ht=1;else if(Qt==pt||Qt==114)Ht=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Mt=new org.antlr.runtime.NoViableAltException("",31,0,this.input);throw Mt}switch(Ht){case 1:if(ke=this.match(this.input,Rt,FormulaParser.FOLLOW_EQUALS_in_assignment1076),this.state.failed||(this.state.backtracking===0&&wt.add(ke),this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_assignment1078),ze=this.defaultValue(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&Tt.add(ze.getTree());break;case 2:e:do{var Dt=2,dt=this.input.LA(1);if(dt==pt){var zt=this.input.LA(2);if(zt==Ye){var er=this.input.LA(3);(er==pt||er==114)&&(Dt=1)}}switch(Dt){case 1:if(Ae=this.match(this.input,pt,FormulaParser.FOLLOW_COMMA_in_assignment1083),this.state.failed||(this.state.backtracking===0&&Qe.add(Ae),Re=this.match(this.input,Ye,FormulaParser.FOLLOW_IDENT_in_assignment1085),this.state.failed))return fe;this.state.backtracking===0&&rt.add(Re);break;default:break e}}while(!0);break}e:do{var Kt=2,qt=this.input.LA(1);switch(qt==pt&&(Kt=1),Kt){case 1:if(Ce=this.match(this.input,pt,FormulaParser.FOLLOW_COMMA_in_assignment1092),this.state.failed||(this.state.backtracking===0&&Qe.add(Ce),Me=this.match(this.input,Ye,FormulaParser.FOLLOW_IDENT_in_assignment1094),this.state.failed)||(this.state.backtracking===0&&rt.add(Me),We=this.match(this.input,Rt,FormulaParser.FOLLOW_EQUALS_in_assignment1096),this.state.failed)||(this.state.backtracking===0&&wt.add(We),this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_assignment1098),it=this.defaultValue(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&Tt.add(it.getTree());break;default:break e}}while(!0);break}if($e=this.match(this.input,114,FormulaParser.FOLLOW_114_in_assignment1105),this.state.failed||(this.state.backtracking===0&&He.add($e),Ue=this.match(this.input,115,FormulaParser.FOLLOW_115_in_assignment1107),this.state.failed)||(this.state.backtracking===0&&vt.add(Ue),this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_assignment1109),ct=this.logicalExpression(),this.state._fsp--,this.state.failed))return fe;if(this.state.backtracking===0&&yt.add(ct.getTree()),this.state.backtracking===0){fe.tree=Ee;var Jt=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var Ft=this.adaptor.nil();Ft=this.adaptor.becomeRoot(this.adaptor.create(we,"FUNCTION"),Ft);{var At=this.adaptor.nil();for(At=this.adaptor.becomeRoot(this.adaptor.create(ae,"PARAMS"),At);rt.hasNext();)this.adaptor.addChild(At,rt.nextNode());rt.reset(),this.adaptor.addChild(Ft,At)}{var At=this.adaptor.nil();for(At=this.adaptor.becomeRoot(this.adaptor.create(ue,"DEFAULTS"),At);Tt.hasNext();)this.adaptor.addChild(At,Tt.nextTree());Tt.reset(),this.adaptor.addChild(Ft,At)}this.adaptor.addChild(Ft,yt.nextTree()),this.adaptor.addChild(Ee,Ft)}fe.tree=Ee}break;case 2:var It=2,sr=this.input.LA(1);if(sr==Pt)It=1;else if(sr==Ye)It=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Mt=new org.antlr.runtime.NoViableAltException("",34,0,this.input);throw Mt}switch(It){case 1:if(Be=this.match(this.input,Pt,FormulaParser.FOLLOW_PRIMITIVE_in_assignment1137),this.state.failed)return fe;this.state.backtracking===0&&_t.add(Be);break;case 2:if(this.pushFollow(FormulaParser.FOLLOW_assigned_in_assignment1141),ft=this.assigned(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&mt.add(ft.getTree());break}e:do{var hr=2,Nr=this.input.LA(1);switch(Nr==pt&&(hr=1),hr){case 1:if(Je=this.match(this.input,pt,FormulaParser.FOLLOW_COMMA_in_assignment1145),this.state.failed)return fe;this.state.backtracking===0&&Qe.add(Je);var nr=2,or=this.input.LA(1);if(or==Pt)nr=1;else if(or==Ye)nr=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Mt=new org.antlr.runtime.NoViableAltException("",35,0,this.input);throw Mt}switch(nr){case 1:if(st=this.match(this.input,Pt,FormulaParser.FOLLOW_PRIMITIVE_in_assignment1148),this.state.failed)return fe;this.state.backtracking===0&&_t.add(st);break;case 2:if(this.pushFollow(FormulaParser.FOLLOW_assigned_in_assignment1152),lt=this.assigned(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&mt.add(lt.getTree());break}break;default:break e}}while(!0);if(Ze=this.match(this.input,115,FormulaParser.FOLLOW_115_in_assignment1158),this.state.failed||(this.state.backtracking===0&&vt.add(Ze),this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_assignment1160),ut=this.logicalExpression(),this.state._fsp--,this.state.failed))return fe;if(this.state.backtracking===0&&yt.add(ut.getTree()),this.state.backtracking===0){fe.tree=Ee;var Jt=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var Ft=this.adaptor.nil();for(Ft=this.adaptor.becomeRoot(this.adaptor.create(re,"ASSIGN"),Ft);_t.hasNext();)this.adaptor.addChild(Ft,_t.nextNode());for(_t.reset();mt.hasNext();)this.adaptor.addChild(Ft,mt.nextTree());mt.reset(),this.adaptor.addChild(Ft,yt.nextTree()),this.adaptor.addChild(Ee,Ft)}fe.tree=Ee}break}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(rr){if(rr instanceof org.antlr.runtime.RecognitionException)this.reportError(rr),this.recover(this.input,rr),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),rr);else throw rr}finally{}return fe},assigned_return:function(){FormulaParser.assigned_return=function(){},org.antlr.lang.extend(FormulaParser.assigned_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),assigned:function(){var fe=new FormulaParser.assigned_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),ke=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule selector");try{if(Ne=this.match(this.input,Ye,FormulaParser.FOLLOW_IDENT_in_assigned1186),this.state.failed)return fe;this.state.backtracking===0&&xe.add(Ne);var Ae=2,Re=this.input.LA(1);switch((Re==Lt||Re==kt||Re==116)&&(Ae=1),Ae){case 1:if(this.pushFollow(FormulaParser.FOLLOW_selector_in_assigned1188),Pe=this.selector(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&ke.add(Pe.getTree());break}if(this.state.backtracking===0){fe.tree=Ee;var Ce=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var Me=this.adaptor.nil();Me=this.adaptor.becomeRoot(this.adaptor.create(be,"ASSIGNED"),Me),this.adaptor.addChild(Me,xe.nextNode()),ke.hasNext()&&this.adaptor.addChild(Me,ke.nextTree()),ke.reset(),this.adaptor.addChild(Ee,Me)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(We){if(We instanceof org.antlr.runtime.RecognitionException)this.reportError(We),this.recover(this.input,We),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),We);else throw We}finally{}return fe},logicalExpression_return:function(){FormulaParser.logicalExpression_return=function(){},org.antlr.lang.extend(FormulaParser.logicalExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),logicalExpression:function(){var fe=new FormulaParser.logicalExpression_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=null,ke=null;try{if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_booleanXORExpression_in_logicalExpression1214),Pe=this.booleanXORExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Pe.getTree());e:do{var Ae=2,Re=this.input.LA(1);if(Re==Ut){var Ce=this.input.LA(2);this.synpred47_Formula()&&(Ae=1)}switch(Ae){case 1:if(Ne=this.match(this.input,Ut,FormulaParser.FOLLOW_OR_in_logicalExpression1217),this.state.failed||(this.state.backtracking===0&&(ke=this.adaptor.create(Ne),Ee=this.adaptor.becomeRoot(ke,Ee)),this.pushFollow(FormulaParser.FOLLOW_booleanXORExpression_in_logicalExpression1220),xe=this.booleanXORExpression(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,xe.getTree());break;default:break e}}while(!0);fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Me){if(Me instanceof org.antlr.runtime.RecognitionException)this.reportError(Me),this.recover(this.input,Me),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Me);else throw Me}finally{}return fe},booleanXORExpression_return:function(){FormulaParser.booleanXORExpression_return=function(){},org.antlr.lang.extend(FormulaParser.booleanXORExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),booleanXORExpression:function(){var fe=new FormulaParser.booleanXORExpression_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=null,ke=null;try{if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_booleanAndExpression_in_booleanXORExpression1250),Pe=this.booleanAndExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Pe.getTree());e:do{var Ae=2,Re=this.input.LA(1);if(Re==Zt){var Ce=this.input.LA(2);this.synpred48_Formula()&&(Ae=1)}switch(Ae){case 1:if(Ne=this.match(this.input,Zt,FormulaParser.FOLLOW_XOR_in_booleanXORExpression1253),this.state.failed||(this.state.backtracking===0&&(ke=this.adaptor.create(Ne),Ee=this.adaptor.becomeRoot(ke,Ee)),this.pushFollow(FormulaParser.FOLLOW_booleanAndExpression_in_booleanXORExpression1256),xe=this.booleanAndExpression(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,xe.getTree());break;default:break e}}while(!0);fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Me){if(Me instanceof org.antlr.runtime.RecognitionException)this.reportError(Me),this.recover(this.input,Me),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Me);else throw Me}finally{}return fe},booleanAndExpression_return:function(){FormulaParser.booleanAndExpression_return=function(){},org.antlr.lang.extend(FormulaParser.booleanAndExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),booleanAndExpression:function(){var fe=new FormulaParser.booleanAndExpression_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=null,ke=null;try{if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_equalityExpression_in_booleanAndExpression1285),Pe=this.equalityExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Pe.getTree());e:do{var Ae=2,Re=this.input.LA(1);if(Re==fr){var Ce=this.input.LA(2);this.synpred49_Formula()&&(Ae=1)}switch(Ae){case 1:if(Ne=this.match(this.input,fr,FormulaParser.FOLLOW_AND_in_booleanAndExpression1288),this.state.failed||(this.state.backtracking===0&&(ke=this.adaptor.create(Ne),Ee=this.adaptor.becomeRoot(ke,Ee)),this.pushFollow(FormulaParser.FOLLOW_equalityExpression_in_booleanAndExpression1291),xe=this.equalityExpression(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,xe.getTree());break;default:break e}}while(!0);fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Me){if(Me instanceof org.antlr.runtime.RecognitionException)this.reportError(Me),this.recover(this.input,Me),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Me);else throw Me}finally{}return fe},equalityExpression_return:function(){FormulaParser.equalityExpression_return=function(){},org.antlr.lang.extend(FormulaParser.equalityExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),equalityExpression:function(){var fe=new FormulaParser.equalityExpression_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=null;try{if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_relationalExpression_in_equalityExpression1322),Pe=this.relationalExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Pe.getTree());e:do{var ke=2,Ae=this.input.LA(1);if(Ae==Rt||Ae==dr){var Re=this.input.LA(2);this.synpred51_Formula()&&(ke=1)}switch(ke){case 1:if(Ne=this.input.LT(1),this.input.LA(1)==Rt||this.input.LA(1)==dr)this.input.consume(),this.state.backtracking===0&&(Ee=this.adaptor.becomeRoot(this.adaptor.create(Ne),Ee)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Ce=new org.antlr.runtime.MismatchedSetException(null,this.input);throw Ce}if(this.pushFollow(FormulaParser.FOLLOW_relationalExpression_in_equalityExpression1332),xe=this.relationalExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,xe.getTree());break;default:break e}}while(!0);fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Me){if(Me instanceof org.antlr.runtime.RecognitionException)this.reportError(Me),this.recover(this.input,Me),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Me);else throw Me}finally{}return fe},relationalExpression_return:function(){FormulaParser.relationalExpression_return=function(){},org.antlr.lang.extend(FormulaParser.relationalExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),relationalExpression:function(){var fe=new FormulaParser.relationalExpression_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=null;try{if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_additiveExpression_in_relationalExpression1374),Pe=this.additiveExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Pe.getTree());e:do{var ke=2,Ae=this.input.LA(1);if(Ae>=pr&&Ae<=mr){var Re=this.input.LA(2);this.synpred55_Formula()&&(ke=1)}switch(ke){case 1:if(Ne=this.input.LT(1),this.input.LA(1)>=pr&&this.input.LA(1)<=mr)this.input.consume(),this.state.backtracking===0&&(Ee=this.adaptor.becomeRoot(this.adaptor.create(Ne),Ee)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Ce=new org.antlr.runtime.MismatchedSetException(null,this.input);throw Ce}if(this.pushFollow(FormulaParser.FOLLOW_additiveExpression_in_relationalExpression1389),xe=this.additiveExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,xe.getTree());break;default:break e}}while(!0);fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Me){if(Me instanceof org.antlr.runtime.RecognitionException)this.reportError(Me),this.recover(this.input,Me),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Me);else throw Me}finally{}return fe},additiveExpression_return:function(){FormulaParser.additiveExpression_return=function(){},org.antlr.lang.extend(FormulaParser.additiveExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),additiveExpression:function(){var fe=new FormulaParser.additiveExpression_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=null;try{if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_multiplicativeExpression_in_additiveExpression1432),Pe=this.multiplicativeExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Pe.getTree());e:do{var ke=2,Ae=this.input.LA(1);if(Ae>=gr&&Ae<=Ct){var Re=this.input.LA(2);this.synpred57_Formula()&&(ke=1)}switch(ke){case 1:if(Ne=this.input.LT(1),this.input.LA(1)>=gr&&this.input.LA(1)<=Ct)this.input.consume(),this.state.backtracking===0&&(Ee=this.adaptor.becomeRoot(this.adaptor.create(Ne),Ee)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Ce=new org.antlr.runtime.MismatchedSetException(null,this.input);throw Ce}if(this.pushFollow(FormulaParser.FOLLOW_multiplicativeExpression_in_additiveExpression1443),xe=this.multiplicativeExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,xe.getTree());break;default:break e}}while(!0);fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Me){if(Me instanceof org.antlr.runtime.RecognitionException)this.reportError(Me),this.recover(this.input,Me),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Me);else throw Me}finally{}return fe},multiplicativeExpression_return:function(){FormulaParser.multiplicativeExpression_return=function(){},org.antlr.lang.extend(FormulaParser.multiplicativeExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),multiplicativeExpression:function(){var fe=new FormulaParser.multiplicativeExpression_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=null;try{if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_arrayExpression_in_multiplicativeExpression1473),Pe=this.arrayExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Pe.getTree());e:do{var ke=2,Ae=this.input.LA(1);if(Ae>=Vt&&Ae<=_r){var Re=this.input.LA(2);this.synpred60_Formula()&&(ke=1)}switch(ke){case 1:if(Ne=this.input.LT(1),this.input.LA(1)>=Vt&&this.input.LA(1)<=_r)this.input.consume(),this.state.backtracking===0&&(Ee=this.adaptor.becomeRoot(this.adaptor.create(Ne),Ee)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Ce=new org.antlr.runtime.MismatchedSetException(null,this.input);throw Ce}if(this.pushFollow(FormulaParser.FOLLOW_arrayExpression_in_multiplicativeExpression1486),xe=this.arrayExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,xe.getTree());break;default:break e}}while(!0);fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Me){if(Me instanceof org.antlr.runtime.RecognitionException)this.reportError(Me),this.recover(this.input,Me),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Me);else throw Me}finally{}return fe},arrayExpression_return:function(){FormulaParser.arrayExpression_return=function(){},org.antlr.lang.extend(FormulaParser.arrayExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),arrayExpression:function(){var fe=new FormulaParser.arrayExpression_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=null,ke=null,Ae=null,Re=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COLON"),Ce=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule negationExpression");try{if(this.pushFollow(FormulaParser.FOLLOW_negationExpression_in_arrayExpression1532),xe=this.negationExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&Ce.add(xe.getTree());var Me=2,We=this.input.LA(1);if(We==tr){var $e=this.input.LA(2);this.synpred61_Formula()&&this.input.get(this.input.index()-1).getText()!=" "&&(Me=1)}switch(Me){case 1:if(this.input.get(this.input.index()-1).getText()==" "){if(this.state.backtracking>0)return this.state.failed=!0,fe;throw new org.antlr.runtime.FailedPredicateException(this.input,"arrayExpression",' this.input.get(this.input.index()-1).getText()!=" "')}if(Ne=this.match(this.input,tr,FormulaParser.FOLLOW_COLON_in_arrayExpression1538),this.state.failed)return fe;if(this.state.backtracking===0&&Re.add(Ne),this.input.get(this.input.index()-1).getText()==" "){if(this.state.backtracking>0)return this.state.failed=!0,fe;throw new org.antlr.runtime.FailedPredicateException(this.input,"arrayExpression",' this.input.get(this.input.index()-1).getText()!=" "')}if(this.pushFollow(FormulaParser.FOLLOW_negationExpression_in_arrayExpression1542),ke=this.negationExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&Ce.add(ke.getTree());break}var Ue=2,Be=this.input.LA(1);if(Be==tr){var Je=this.input.LA(2);this.synpred62_Formula()&&this.input.get(this.input.index()-1).getText()!=" "&&(Ue=1)}switch(Ue){case 1:if(this.input.get(this.input.index()-1).getText()==" "){if(this.state.backtracking>0)return this.state.failed=!0,fe;throw new org.antlr.runtime.FailedPredicateException(this.input,"arrayExpression",' this.input.get(this.input.index()-1).getText()!=" "')}if(Pe=this.match(this.input,tr,FormulaParser.FOLLOW_COLON_in_arrayExpression1551),this.state.failed)return fe;if(this.state.backtracking===0&&Re.add(Pe),this.input.get(this.input.index()-1).getText()==" "){if(this.state.backtracking>0)return this.state.failed=!0,fe;throw new org.antlr.runtime.FailedPredicateException(this.input,"arrayExpression",' this.input.get(this.input.index()-1).getText()!=" "')}if(this.pushFollow(FormulaParser.FOLLOW_negationExpression_in_arrayExpression1555),Ae=this.negationExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&Ce.add(Ae.getTree());break}if(this.state.backtracking===0){fe.tree=Ee;var st=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var Ze=this.adaptor.nil();for(Ze=this.adaptor.becomeRoot(this.adaptor.create(Te,"RANGE"),Ze);Ce.hasNext();)this.adaptor.addChild(Ze,Ce.nextTree());Ce.reset(),this.adaptor.addChild(Ee,Ze)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(ze){if(ze instanceof org.antlr.runtime.RecognitionException)this.reportError(ze),this.recover(this.input,ze),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),ze);else throw ze}finally{}return fe},negationExpression_return:function(){FormulaParser.negationExpression_return=function(){},org.antlr.lang.extend(FormulaParser.negationExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),negationExpression:function(){var fe=new FormulaParser.negationExpression_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=null,ke=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token MINUS"),Ae=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule powerExpression");try{var Re=2,Ce=this.input.LA(1);if(Ce==Ct)Re=1;else if(Ce==je||Ce==Et||Ce==Ye||Ce==Pt||Ce>=Gt&&Ce<=Lt||Ce==kt||Ce>=$t&&Ce<=Wt||Ce==113)Re=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Me=new org.antlr.runtime.NoViableAltException("",48,0,this.input);throw Me}switch(Re){case 1:if(Ne=this.match(this.input,Ct,FormulaParser.FOLLOW_MINUS_in_negationExpression1580),this.state.failed||(this.state.backtracking===0&&ke.add(Ne),this.pushFollow(FormulaParser.FOLLOW_powerExpression_in_negationExpression1582),Pe=this.powerExpression(),this.state._fsp--,this.state.failed))return fe;if(this.state.backtracking===0&&Ae.add(Pe.getTree()),this.state.backtracking===0){fe.tree=Ee;var We=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var $e=this.adaptor.nil();$e=this.adaptor.becomeRoot(this.adaptor.create(ee,"NEGATE"),$e),this.adaptor.addChild($e,Ae.nextTree()),this.adaptor.addChild(Ee,$e)}fe.tree=Ee}break;case 2:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_powerExpression_in_negationExpression1596),xe=this.powerExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,xe.getTree());break}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Ue){if(Ue instanceof org.antlr.runtime.RecognitionException)this.reportError(Ue),this.recover(this.input,Ue),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Ue);else throw Ue}finally{}return fe},powerExpression_return:function(){FormulaParser.powerExpression_return=function(){},org.antlr.lang.extend(FormulaParser.powerExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),powerExpression:function(){var fe=new FormulaParser.powerExpression_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=null,ke=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token POW"),Ae=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unaryOrNegate"),Re=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unaryExpression");try{if(this.pushFollow(FormulaParser.FOLLOW_unaryExpression_in_powerExpression1607),Pe=this.unaryExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&Re.add(Pe.getTree());e:do{var Ce=2,Me=this.input.LA(1);if(Me==ir){var We=this.input.LA(2);this.synpred64_Formula()&&(Ce=1)}switch(Ce){case 1:if(Ne=this.match(this.input,ir,FormulaParser.FOLLOW_POW_in_powerExpression1610),this.state.failed||(this.state.backtracking===0&&ke.add(Ne),this.pushFollow(FormulaParser.FOLLOW_unaryOrNegate_in_powerExpression1612),xe=this.unaryOrNegate(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&Ae.add(xe.getTree());break;default:break e}}while(!0);if(this.state.backtracking===0){fe.tree=Ee;var $e=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var Ue=this.adaptor.nil();for(Ue=this.adaptor.becomeRoot(this.adaptor.create(le,"POWER"),Ue),this.adaptor.addChild(Ue,Re.nextTree());Ae.hasNext();)this.adaptor.addChild(Ue,Ae.nextTree());Ae.reset(),this.adaptor.addChild(Ee,Ue)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Be){if(Be instanceof org.antlr.runtime.RecognitionException)this.reportError(Be),this.recover(this.input,Be),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Be);else throw Be}finally{}return fe},unaryOrNegate_return:function(){FormulaParser.unaryOrNegate_return=function(){},org.antlr.lang.extend(FormulaParser.unaryOrNegate_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unaryOrNegate:function(){var fe=new FormulaParser.unaryOrNegate_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=null,ke=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token MINUS"),Ae=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unaryExpression");try{var Re=2,Ce=this.input.LA(1);if(Ce==je||Ce==Et||Ce==Ye||Ce==Pt||Ce>=Gt&&Ce<=Lt||Ce==kt||Ce>=$t&&Ce<=Wt||Ce==113)Re=1;else if(Ce==Ct)Re=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Me=new org.antlr.runtime.NoViableAltException("",50,0,this.input);throw Me}switch(Re){case 1:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_unaryExpression_in_unaryOrNegate1639),Pe=this.unaryExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Pe.getTree());break;case 2:if(Ne=this.match(this.input,Ct,FormulaParser.FOLLOW_MINUS_in_unaryOrNegate1645),this.state.failed||(this.state.backtracking===0&&ke.add(Ne),this.pushFollow(FormulaParser.FOLLOW_unaryExpression_in_unaryOrNegate1647),xe=this.unaryExpression(),this.state._fsp--,this.state.failed))return fe;if(this.state.backtracking===0&&Ae.add(xe.getTree()),this.state.backtracking===0){fe.tree=Ee;var We=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var $e=this.adaptor.nil();$e=this.adaptor.becomeRoot(this.adaptor.create(ee,"NEGATE"),$e),this.adaptor.addChild($e,Ae.nextTree()),this.adaptor.addChild(Ee,$e)}fe.tree=Ee}break}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Ue){if(Ue instanceof org.antlr.runtime.RecognitionException)this.reportError(Ue),this.recover(this.input,Ue),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Ue);else throw Ue}finally{}return fe},unaryExpression_return:function(){FormulaParser.unaryExpression_return=function(){},org.antlr.lang.extend(FormulaParser.unaryExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unaryExpression:function(){var fe=new FormulaParser.unaryExpression_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=null,ke=null;try{var Ae=2,Re=this.input.LA(1);if(Re==Gt)Ae=1;else if(Re==je||Re==Et||Re==Ye||Re==Pt||Re==Lt||Re==kt||Re>=$t&&Re<=Wt||Re==113)Ae=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Ce=new org.antlr.runtime.NoViableAltException("",51,0,this.input);throw Ce}switch(Ae){case 1:if(Ee=this.adaptor.nil(),Ne=this.match(this.input,Gt,FormulaParser.FOLLOW_NOT_in_unaryExpression1675),this.state.failed||(this.state.backtracking===0&&(ke=this.adaptor.create(Ne),Ee=this.adaptor.becomeRoot(ke,Ee)),this.pushFollow(FormulaParser.FOLLOW_innerPrimaryExpression_in_unaryExpression1678),Pe=this.innerPrimaryExpression(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Pe.getTree());break;case 2:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_innerPrimaryExpression_in_unaryExpression1687),xe=this.innerPrimaryExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,xe.getTree());break}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Me){if(Me instanceof org.antlr.runtime.RecognitionException)this.reportError(Me),this.recover(this.input,Me),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Me);else throw Me}finally{}return fe},innerPrimaryExpression_return:function(){FormulaParser.innerPrimaryExpression_return=function(){},org.antlr.lang.extend(FormulaParser.innerPrimaryExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),innerPrimaryExpression:function(){var fe=new FormulaParser.innerPrimaryExpression_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule selectionExpression");try{if(this.pushFollow(FormulaParser.FOLLOW_selectionExpression_in_innerPrimaryExpression1718),Ne=this.selectionExpression(),this.state._fsp--,this.state.failed)return fe;if(this.state.backtracking===0&&Pe.add(Ne.getTree()),this.state.backtracking===0){fe.tree=Ee;var xe=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var ke=this.adaptor.nil();ke=this.adaptor.becomeRoot(this.adaptor.create(ye,"INNER"),ke),this.adaptor.addChild(ke,Pe.nextTree()),this.adaptor.addChild(Ee,ke)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Ae){if(Ae instanceof org.antlr.runtime.RecognitionException)this.reportError(Ae),this.recover(this.input,Ae),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Ae);else throw Ae}finally{}return fe},selectionExpression_return:function(){FormulaParser.selectionExpression_return=function(){},org.antlr.lang.extend(FormulaParser.selectionExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),selectionExpression:function(){var fe=new FormulaParser.selectionExpression_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=null;try{if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_primaryExpression_in_selectionExpression1738),Ne=this.primaryExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Ne.getTree());e:do{var ke=2;switch(this.input.LA(1)){case Lt:var Ae=this.input.LA(2);this.synpred68_Formula()&&this.input.get(this.input.index()-1).getText()!=" "&&(ke=1);break;case kt:var Re=this.input.LA(2);this.synpred68_Formula()&&this.input.get(this.input.index()-1).getText()!=" "&&(ke=1);break;case 116:var Ce=this.input.LA(2);this.synpred68_Formula()&&this.input.get(this.input.index()-1).getText()!=" "&&(ke=1);break;case 113:var Me=this.input.LA(2);this.synpred68_Formula()&&this.input.get(this.input.index()-1).getText()!=" "&&(ke=1);break}switch(ke){case 1:if(this.input.get(this.input.index()-1).getText()==" "){if(this.state.backtracking>0)return this.state.failed=!0,fe;throw new org.antlr.runtime.FailedPredicateException(this.input,"selectionExpression",' this.input.get(this.input.index()-1).getText()!=" "')}var We=2,$e=this.input.LA(1);if($e==Lt||$e==kt||$e==116)We=1;else if($e==113)We=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Ue=new org.antlr.runtime.NoViableAltException("",52,0,this.input);throw Ue}switch(We){case 1:if(this.pushFollow(FormulaParser.FOLLOW_selector_in_selectionExpression1744),Pe=this.selector(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Pe.getTree());break;case 2:if(this.pushFollow(FormulaParser.FOLLOW_funCall_in_selectionExpression1746),xe=this.funCall(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,xe.getTree());break}break;default:break e}}while(!0);fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Be){if(Be instanceof org.antlr.runtime.RecognitionException)this.reportError(Be),this.recover(this.input,Be),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Be);else throw Be}finally{}return fe},funCall_return:function(){FormulaParser.funCall_return=function(){},org.antlr.lang.extend(FormulaParser.funCall_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),funCall:function(){var fe=new FormulaParser.funCall_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=null,ke=null,Ae=null,Re=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 114"),Ce=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 113"),Me=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COMMA"),We=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{if(Ne=this.match(this.input,113,FormulaParser.FOLLOW_113_in_funCall1761),this.state.failed)return fe;this.state.backtracking===0&&Ce.add(Ne);var $e=2,Ue=this.input.LA(1);switch((Ue==je||Ue==Et||Ue==Ye||Ue==Pt||Ue==Ct||Ue>=Gt&&Ue<=Lt||Ue==kt||Ue>=$t&&Ue<=Wt||Ue==113)&&($e=1),$e){case 1:if(this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_funCall1765),ke=this.logicalExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&We.add(ke.getTree());e:do{var Be=2,Je=this.input.LA(1);switch(Je==pt&&(Be=1),Be){case 1:if(Pe=this.match(this.input,pt,FormulaParser.FOLLOW_COMMA_in_funCall1768),this.state.failed||(this.state.backtracking===0&&Me.add(Pe),this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_funCall1770),Ae=this.logicalExpression(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&We.add(Ae.getTree());break;default:break e}}while(!0);break}if(xe=this.match(this.input,114,FormulaParser.FOLLOW_114_in_funCall1777),this.state.failed)return fe;if(this.state.backtracking===0&&Re.add(xe),this.state.backtracking===0){fe.tree=Ee;var st=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var Ze=this.adaptor.nil();for(Ze=this.adaptor.becomeRoot(this.adaptor.create(ne,"FUNCALL"),Ze);We.hasNext();)this.adaptor.addChild(Ze,We.nextTree());We.reset(),this.adaptor.addChild(Ee,Ze)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(ze){if(ze instanceof org.antlr.runtime.RecognitionException)this.reportError(ze),this.recover(this.input,ze),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),ze);else throw ze}finally{}return fe},primaryExpression_return:function(){FormulaParser.primaryExpression_return=function(){},org.antlr.lang.extend(FormulaParser.primaryExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),primaryExpression:function(){var fe=new FormulaParser.primaryExpression_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=null,ke=null;try{var Ae=2,Re=this.input.LA(1);if(Re==113)Ae=1;else if(Re==je||Re==Et||Re==Ye||Re==Pt||Re==Lt||Re==kt||Re>=$t&&Re<=Wt)Ae=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Ce=new org.antlr.runtime.NoViableAltException("",56,0,this.input);throw Ce}switch(Ae){case 1:if(Ee=this.adaptor.nil(),Ne=this.match(this.input,113,FormulaParser.FOLLOW_113_in_primaryExpression1798),this.state.failed||(this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_primaryExpression1801),xe=this.logicalExpression(),this.state._fsp--,this.state.failed)||(this.state.backtracking===0&&this.adaptor.addChild(Ee,xe.getTree()),Pe=this.match(this.input,114,FormulaParser.FOLLOW_114_in_primaryExpression1803),this.state.failed))return fe;break;case 2:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_value_in_primaryExpression1809),ke=this.value(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,ke.getTree());break}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Me){if(Me instanceof org.antlr.runtime.RecognitionException)this.reportError(Me),this.recover(this.input,Me),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Me);else throw Me}finally{}return fe},value_return:function(){FormulaParser.value_return=function(){},org.antlr.lang.extend(FormulaParser.value_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),value:function(){var fe=new FormulaParser.value_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=null,ke=null,Ae=null,Re=null,Ce=null,Me=null,We=null,$e=null;try{var Ue=9;switch(Ue=this.dfa57.predict(this.input),Ue){case 1:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_number_in_value1823),Pe=this.number(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Pe.getTree());break;case 2:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_bool_in_value1829),xe=this.bool(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,xe.getTree());break;case 3:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_string_in_value1835),ke=this.string(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,ke.getTree());break;case 4:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_material_in_value1841),Ae=this.material(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Ae.getTree());break;case 5:if(Ee=this.adaptor.nil(),Ne=this.match(this.input,Ye,FormulaParser.FOLLOW_IDENT_in_value1846),this.state.failed)return fe;this.state.backtracking===0&&($e=this.adaptor.create(Ne),this.adaptor.addChild(Ee,$e));break;case 6:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_primitive_in_value1851),Re=this.primitive(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Re.getTree());break;case 7:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_array_in_value1856),Ce=this.array(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Ce.getTree());break;case 8:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_anonFunctionDef_in_value1861),Me=this.anonFunctionDef(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Me.getTree());break;case 9:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_newObject_in_value1866),We=this.newObject(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,We.getTree());break}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Be){if(Be instanceof org.antlr.runtime.RecognitionException)this.reportError(Be),this.recover(this.input,Be),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Be);else throw Be}finally{}return fe},newObject_return:function(){FormulaParser.newObject_return=function(){},org.antlr.lang.extend(FormulaParser.newObject_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),newObject:function(){var fe=new FormulaParser.newObject_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=null,ke=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),Ae=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWSTATEMENT"),Re=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule funCall");try{if(Ne=this.match(this.input,Et,FormulaParser.FOLLOW_NEWSTATEMENT_in_newObject1876),this.state.failed||(this.state.backtracking===0&&Ae.add(Ne),Pe=this.match(this.input,Ye,FormulaParser.FOLLOW_IDENT_in_newObject1878),this.state.failed))return fe;this.state.backtracking===0&&ke.add(Pe);var Ce=2;switch(Ce=this.dfa58.predict(this.input),Ce){case 1:if(this.pushFollow(FormulaParser.FOLLOW_funCall_in_newObject1880),xe=this.funCall(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&Re.add(xe.getTree());break}if(this.state.backtracking===0){fe.tree=Ee;var Me=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var We=this.adaptor.nil();We=this.adaptor.becomeRoot(this.adaptor.create(Oe,"NEW"),We),this.adaptor.addChild(We,ke.nextNode()),Re.hasNext()&&this.adaptor.addChild(We,Re.nextTree()),Re.reset(),this.adaptor.addChild(Ee,We)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch($e){if($e instanceof org.antlr.runtime.RecognitionException)this.reportError($e),this.recover(this.input,$e),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),$e);else throw $e}finally{}return fe},defaultValue_return:function(){FormulaParser.defaultValue_return=function(){},org.antlr.lang.extend(FormulaParser.defaultValue_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),defaultValue:function(){var fe=new FormulaParser.defaultValue_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=null,ke=null,Ae=null;try{var Re=5;switch(this.input.LA(1)){case Ct:Re=1;break;case ar:case wr:Re=2;break;case yr:case Wt:Re=3;break;case $t:Re=4;break;case Lt:case kt:Re=5;break;default:if(this.state.backtracking>0)return this.state.failed=!0,fe;var Ce=new org.antlr.runtime.NoViableAltException("",59,0,this.input);throw Ce}switch(Re){case 1:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_negnumber_in_defaultValue1906),Ne=this.negnumber(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Ne.getTree());break;case 2:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_number_in_defaultValue1912),Pe=this.number(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Pe.getTree());break;case 3:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_bool_in_defaultValue1918),xe=this.bool(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,xe.getTree());break;case 4:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_string_in_defaultValue1924),ke=this.string(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,ke.getTree());break;case 5:if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_array_in_defaultValue1930),Ae=this.array(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Ae.getTree());break}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Me){if(Me instanceof org.antlr.runtime.RecognitionException)this.reportError(Me),this.recover(this.input,Me),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Me);else throw Me}finally{}return fe},array_return:function(){FormulaParser.array_return=function(){},org.antlr.lang.extend(FormulaParser.array_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),array:function(){var fe=new FormulaParser.array_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=null,ke=null,Ae=null,Re=null,Ce=null,Me=null,We=null,$e=null,Ue=null,Be=null,Je=null,st=null,Ze=null,ze=null,it=null,ct=null,ft=null,lt=null,ut=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token LCURL"),He=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),rt=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token RARR"),vt=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COMMA"),wt=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token LARR"),Ot=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token RCURL"),Qe=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule label");try{var _t=2,mt=this.input.LA(1);if(mt==Lt)_t=1;else if(mt==kt)_t=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Tt=new org.antlr.runtime.NoViableAltException("",74,0,this.input);throw Tt}switch(_t){case 1:if(Ne=this.match(this.input,Lt,FormulaParser.FOLLOW_LARR_in_array1944),this.state.failed)return fe;this.state.backtracking===0&&wt.add(Ne);e:do{var yt=2,bt=this.input.LA(1);if(bt==Ie){var Nt=this.input.LA(2);this.synpred85_Formula()&&(yt=1)}switch(yt){case 1:if(Pe=this.match(this.input,Ie,FormulaParser.FOLLOW_NEWLINE_in_array1946),this.state.failed)return fe;this.state.backtracking===0&&He.add(Pe);break;default:break e}}while(!0);var St=2;switch(St=this.dfa65.predict(this.input),St){case 1:if(this.pushFollow(FormulaParser.FOLLOW_label_in_array1950),it=this.label(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&Qe.add(it.getTree());e:do{var Mt=2,jt=this.input.LA(1);if(jt==Ie){var Yt=this.input.LA(2);this.synpred86_Formula()&&(Mt=1)}switch(Mt){case 1:if(xe=this.match(this.input,Ie,FormulaParser.FOLLOW_NEWLINE_in_array1952),this.state.failed)return fe;this.state.backtracking===0&&He.add(xe);break;default:break e}}while(!0);e:do{var Ht=2,Qt=this.input.LA(1);switch(Qt==pt&&(Ht=1),Ht){case 1:if(ke=this.match(this.input,pt,FormulaParser.FOLLOW_COMMA_in_array1956),this.state.failed)return fe;this.state.backtracking===0&&vt.add(ke);t:do{var Dt=2,dt=this.input.LA(1);if(dt==Ie){var zt=this.input.LA(2);this.synpred87_Formula()&&(Dt=1)}switch(Dt){case 1:if(Ae=this.match(this.input,Ie,FormulaParser.FOLLOW_NEWLINE_in_array1958),this.state.failed)return fe;this.state.backtracking===0&&He.add(Ae);break;default:break t}}while(!0);if(this.pushFollow(FormulaParser.FOLLOW_label_in_array1961),ct=this.label(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&Qe.add(ct.getTree());t:do{var er=2,Kt=this.input.LA(1);if(Kt==Ie){var qt=this.input.LA(2);this.synpred88_Formula()&&(er=1)}switch(er){case 1:if(Re=this.match(this.input,Ie,FormulaParser.FOLLOW_NEWLINE_in_array1963),this.state.failed)return fe;this.state.backtracking===0&&He.add(Re);break;default:break t}}while(!0);break;default:break e}}while(!0);break}e:do{var Jt=2,Ft=this.input.LA(1);switch(Ft==Ie&&(Jt=1),Jt){case 1:if(Ce=this.match(this.input,Ie,FormulaParser.FOLLOW_NEWLINE_in_array1970),this.state.failed)return fe;this.state.backtracking===0&&He.add(Ce);break;default:break e}}while(!0);if(Me=this.match(this.input,Tr,FormulaParser.FOLLOW_RARR_in_array1973),this.state.failed)return fe;if(this.state.backtracking===0&&rt.add(Me),this.state.backtracking===0){fe.tree=Ee;var At=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var It=this.adaptor.nil();for(It=this.adaptor.becomeRoot(this.adaptor.create(ce,"ARRAY"),It);Qe.hasNext();)this.adaptor.addChild(It,Qe.nextTree());Qe.reset(),this.adaptor.addChild(Ee,It)}fe.tree=Ee}break;case 2:if(We=this.match(this.input,kt,FormulaParser.FOLLOW_LCURL_in_array1987),this.state.failed)return fe;this.state.backtracking===0&&ut.add(We);e:do{var sr=2,hr=this.input.LA(1);if(hr==Ie){var Nr=this.input.LA(2);this.synpred93_Formula()&&(sr=1)}switch(sr){case 1:if($e=this.match(this.input,Ie,FormulaParser.FOLLOW_NEWLINE_in_array1989),this.state.failed)return fe;this.state.backtracking===0&&He.add($e);break;default:break e}}while(!0);var nr=2;switch(nr=this.dfa72.predict(this.input),nr){case 1:if(this.pushFollow(FormulaParser.FOLLOW_label_in_array1993),ft=this.label(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&Qe.add(ft.getTree());e:do{var or=2,rr=this.input.LA(1);if(rr==Ie){var Cr=this.input.LA(2);this.synpred94_Formula()&&(or=1)}switch(or){case 1:if(Ue=this.match(this.input,Ie,FormulaParser.FOLLOW_NEWLINE_in_array1995),this.state.failed)return fe;this.state.backtracking===0&&He.add(Ue);break;default:break e}}while(!0);e:do{var kr=2,Or=this.input.LA(1);switch(Or==pt&&(kr=1),kr){case 1:if(Be=this.match(this.input,pt,FormulaParser.FOLLOW_COMMA_in_array1998),this.state.failed)return fe;this.state.backtracking===0&&vt.add(Be);t:do{var Lr=2,Ar=this.input.LA(1);if(Ar==Ie){var Ir=this.input.LA(2);this.synpred95_Formula()&&(Lr=1)}switch(Lr){case 1:if(Je=this.match(this.input,Ie,FormulaParser.FOLLOW_NEWLINE_in_array2000),this.state.failed)return fe;this.state.backtracking===0&&He.add(Je);break;default:break t}}while(!0);if(this.pushFollow(FormulaParser.FOLLOW_label_in_array2003),lt=this.label(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&Qe.add(lt.getTree());t:do{var Sr=2,Rr=this.input.LA(1);if(Rr==Ie){var Mr=this.input.LA(2);this.synpred96_Formula()&&(Sr=1)}switch(Sr){case 1:if(st=this.match(this.input,Ie,FormulaParser.FOLLOW_NEWLINE_in_array2005),this.state.failed)return fe;this.state.backtracking===0&&He.add(st);break;default:break t}}while(!0);break;default:break e}}while(!0);break}e:do{var Fr=2,Pr=this.input.LA(1);switch(Pr==Ie&&(Fr=1),Fr){case 1:if(Ze=this.match(this.input,Ie,FormulaParser.FOLLOW_NEWLINE_in_array2012),this.state.failed)return fe;this.state.backtracking===0&&He.add(Ze);break;default:break e}}while(!0);if(ze=this.match(this.input,Er,FormulaParser.FOLLOW_RCURL_in_array2015),this.state.failed)return fe;if(this.state.backtracking===0&&Ot.add(ze),this.state.backtracking===0){fe.tree=Ee;var At=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var It=this.adaptor.nil();for(It=this.adaptor.becomeRoot(this.adaptor.create(ce,"ARRAY"),It);Qe.hasNext();)this.adaptor.addChild(It,Qe.nextTree());Qe.reset(),this.adaptor.addChild(Ee,It)}fe.tree=Ee}break}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(ur){if(ur instanceof org.antlr.runtime.RecognitionException)this.reportError(ur),this.recover(this.input,ur),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),ur);else throw ur}finally{}return fe},selector_return:function(){FormulaParser.selector_return=function(){},org.antlr.lang.extend(FormulaParser.selector_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),selector:function(){var fe=new FormulaParser.selector_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule dotselector"),ke=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule minarray");try{var Ae=2,Re=this.input.LA(1);if(Re==Lt||Re==kt)Ae=1;else if(Re==116)Ae=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Ce=new org.antlr.runtime.NoViableAltException("",75,0,this.input);throw Ce}switch(Ae){case 1:if(this.pushFollow(FormulaParser.FOLLOW_minarray_in_selector2036),Ne=this.minarray(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&ke.add(Ne.getTree());break;case 2:if(this.pushFollow(FormulaParser.FOLLOW_dotselector_in_selector2040),Pe=this.dotselector(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&xe.add(Pe.getTree());break}if(this.state.backtracking===0){fe.tree=Ee;var Me=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var We=this.adaptor.nil();We=this.adaptor.becomeRoot(this.adaptor.create(Fe,"SELECTOR"),We),ke.hasNext()&&this.adaptor.addChild(We,ke.nextTree()),ke.reset(),xe.hasNext()&&this.adaptor.addChild(We,xe.nextTree()),xe.reset(),this.adaptor.addChild(Ee,We)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch($e){if($e instanceof org.antlr.runtime.RecognitionException)this.reportError($e),this.recover(this.input,$e),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),$e);else throw $e}finally{}return fe},minarray_return:function(){FormulaParser.minarray_return=function(){},org.antlr.lang.extend(FormulaParser.minarray_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),minarray:function(){var fe=new FormulaParser.minarray_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=null,ke=null,Ae=null,Re=null,Ce=null,Me=null,We=null,$e=null,Ue=null,Be=null,Je=null,st=null,Ze=null,ze=null,it=null,ct=null;try{var ft=2,lt=this.input.LA(1);if(lt==Lt)ft=1;else if(lt==kt)ft=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var ut=new org.antlr.runtime.NoViableAltException("",82,0,this.input);throw ut}switch(ft){case 1:if(Ee=this.adaptor.nil(),Ne=this.match(this.input,Lt,FormulaParser.FOLLOW_LARR_in_minarray2067),this.state.failed)return fe;var He=2,rt=this.input.LA(1);if(rt==je||rt==Et||rt==Ye||rt==Pt||rt==Ct||rt>=Gt&&rt<=Lt||rt==kt||rt>=$t&&rt<=Wt||rt==113)He=1;else if(rt==Vt)He=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var ut=new org.antlr.runtime.NoViableAltException("",76,0,this.input);throw ut}switch(He){case 1:if(this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_minarray2072),Ue=this.logicalExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Ue.getTree());break;case 2:if(Pe=this.match(this.input,Vt,FormulaParser.FOLLOW_MULT_in_minarray2074),this.state.failed)return fe;this.state.backtracking===0&&(Ze=this.adaptor.create(Pe),this.adaptor.addChild(Ee,Ze));break}e:do{var vt=2,wt=this.input.LA(1);switch(wt==pt&&(vt=1),vt){case 1:if(xe=this.match(this.input,pt,FormulaParser.FOLLOW_COMMA_in_minarray2078),this.state.failed)return fe;var Ot=2,Qe=this.input.LA(1);if(Qe==je||Qe==Et||Qe==Ye||Qe==Pt||Qe==Ct||Qe>=Gt&&Qe<=Lt||Qe==kt||Qe>=$t&&Qe<=Wt||Qe==113)Ot=1;else if(Qe==Vt)Ot=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var ut=new org.antlr.runtime.NoViableAltException("",77,0,this.input);throw ut}switch(Ot){case 1:if(this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_minarray2082),Be=this.logicalExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Be.getTree());break;case 2:if(ke=this.match(this.input,Vt,FormulaParser.FOLLOW_MULT_in_minarray2084),this.state.failed)return fe;this.state.backtracking===0&&(ze=this.adaptor.create(ke),this.adaptor.addChild(Ee,ze));break}break;default:break e}}while(!0);if(Ae=this.match(this.input,Tr,FormulaParser.FOLLOW_RARR_in_minarray2091),this.state.failed)return fe;break;case 2:if(Ee=this.adaptor.nil(),Re=this.match(this.input,kt,FormulaParser.FOLLOW_LCURL_in_minarray2097),this.state.failed)return fe;var _t=2,mt=this.input.LA(1);if(mt==je||mt==Et||mt==Ye||mt==Pt||mt==Ct||mt>=Gt&&mt<=Lt||mt==kt||mt>=$t&&mt<=Wt||mt==113)_t=1;else if(mt==Vt)_t=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var ut=new org.antlr.runtime.NoViableAltException("",79,0,this.input);throw ut}switch(_t){case 1:if(this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_minarray2102),Je=this.logicalExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Je.getTree());break;case 2:if(Ce=this.match(this.input,Vt,FormulaParser.FOLLOW_MULT_in_minarray2104),this.state.failed)return fe;this.state.backtracking===0&&(it=this.adaptor.create(Ce),this.adaptor.addChild(Ee,it));break}e:do{var Tt=2,yt=this.input.LA(1);switch(yt==pt&&(Tt=1),Tt){case 1:if(Me=this.match(this.input,pt,FormulaParser.FOLLOW_COMMA_in_minarray2108),this.state.failed)return fe;var bt=2,Nt=this.input.LA(1);if(Nt==je||Nt==Et||Nt==Ye||Nt==Pt||Nt==Ct||Nt>=Gt&&Nt<=Lt||Nt==kt||Nt>=$t&&Nt<=Wt||Nt==113)bt=1;else if(Nt==Vt)bt=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var ut=new org.antlr.runtime.NoViableAltException("",80,0,this.input);throw ut}switch(bt){case 1:if(this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_minarray2112),st=this.logicalExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,st.getTree());break;case 2:if(We=this.match(this.input,Vt,FormulaParser.FOLLOW_MULT_in_minarray2114),this.state.failed)return fe;this.state.backtracking===0&&(ct=this.adaptor.create(We),this.adaptor.addChild(Ee,ct));break}break;default:break e}}while(!0);if($e=this.match(this.input,Er,FormulaParser.FOLLOW_RCURL_in_minarray2121),this.state.failed)return fe;break}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(St){if(St instanceof org.antlr.runtime.RecognitionException)this.reportError(St),this.recover(this.input,St),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),St);else throw St}finally{}return fe},dotselector_return:function(){FormulaParser.dotselector_return=function(){},org.antlr.lang.extend(FormulaParser.dotselector_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),dotselector:function(){var fe=new FormulaParser.dotselector_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 116"),ke=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule arrayName");try{var Ae=0;e:do{var Re=2,Ce=this.input.LA(1);if(Ce==116){var Me=this.input.LA(2);this.synpred108_Formula()&&(Re=1)}switch(Re){case 1:if(Ne=this.match(this.input,116,FormulaParser.FOLLOW_116_in_dotselector2133),this.state.failed||(this.state.backtracking===0&&xe.add(Ne),this.pushFollow(FormulaParser.FOLLOW_arrayName_in_dotselector2135),Pe=this.arrayName(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&ke.add(Pe.getTree());break;default:if(Ae>=1)break e;if(this.state.backtracking>0)return this.state.failed=!0,fe;var We=new org.antlr.runtime.EarlyExitException(83,this.input);throw We}Ae++}while(!0);if(this.state.backtracking===0){fe.tree=Ee;var $e=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var Ue=this.adaptor.nil();if(Ue=this.adaptor.becomeRoot(this.adaptor.create(Le,"DOTSELECTOR"),Ue),!ke.hasNext())throw new org.antlr.runtime.tree.RewriteEarlyExitException;for(;ke.hasNext();)this.adaptor.addChild(Ue,ke.nextTree());ke.reset(),this.adaptor.addChild(Ee,Ue)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Be){if(Be instanceof org.antlr.runtime.RecognitionException)this.reportError(Be),this.recover(this.input,Be),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Be);else throw Be}finally{}return fe},arrayName_return:function(){FormulaParser.arrayName_return=function(){},org.antlr.lang.extend(FormulaParser.arrayName_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),arrayName:function(){var fe=new FormulaParser.arrayName_return;fe.start=this.input.LT(1);var Ee=null,Ne=null;try{if(Ee=this.adaptor.nil(),Ne=this.input.LT(1),this.input.LA(1)==Ye||this.input.LA(1)==Vt||this.input.LA(1)==$t)this.input.consume(),this.state.backtracking===0&&this.adaptor.addChild(Ee,this.adaptor.create(Ne)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Pe=new org.antlr.runtime.MismatchedSetException(null,this.input);throw Pe}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(xe){if(xe instanceof org.antlr.runtime.RecognitionException)this.reportError(xe),this.recover(this.input,xe),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),xe);else throw xe}finally{}return fe},label_return:function(){FormulaParser.label_return=function(){},org.antlr.lang.extend(FormulaParser.label_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),label:function(){var fe=new FormulaParser.label_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=null,ke=null,Ae=null,Re=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COLON"),Ce=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),Me=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule arrayName"),We=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{var $e=2;switch($e=this.dfa85.predict(this.input),$e){case 1:if(this.pushFollow(FormulaParser.FOLLOW_arrayName_in_label2173),ke=this.arrayName(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&Me.add(ke.getTree());e:do{var Ue=2,Be=this.input.LA(1);switch(Be==Ie&&(Ue=1),Ue){case 1:if(Ne=this.match(this.input,Ie,FormulaParser.FOLLOW_NEWLINE_in_label2175),this.state.failed)return fe;this.state.backtracking===0&&Ce.add(Ne);break;default:break e}}while(!0);if(Pe=this.match(this.input,tr,FormulaParser.FOLLOW_COLON_in_label2178),this.state.failed)return fe;this.state.backtracking===0&&Re.add(Pe);break}e:do{var Je=2,st=this.input.LA(1);switch(st==Ie&&(Je=1),Je){case 1:if(xe=this.match(this.input,Ie,FormulaParser.FOLLOW_NEWLINE_in_label2182),this.state.failed)return fe;this.state.backtracking===0&&Ce.add(xe);break;default:break e}}while(!0);if(this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_label2185),Ae=this.logicalExpression(),this.state._fsp--,this.state.failed)return fe;if(this.state.backtracking===0&&We.add(Ae.getTree()),this.state.backtracking===0){fe.tree=Ee;var Ze=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var ze=this.adaptor.nil();ze=this.adaptor.becomeRoot(this.adaptor.create(_e,"LABEL"),ze),this.adaptor.addChild(ze,We.nextTree()),Me.hasNext()&&this.adaptor.addChild(ze,Me.nextTree()),Me.reset(),this.adaptor.addChild(Ee,ze)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(it){if(it instanceof org.antlr.runtime.RecognitionException)this.reportError(it),this.recover(this.input,it),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),it);else throw it}finally{}return fe},number_return:function(){FormulaParser.number_return=function(){},org.antlr.lang.extend(FormulaParser.number_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),number:function(){var fe=new FormulaParser.number_return;fe.start=this.input.LT(1);var Ee=null,Ne=null;try{if(Ee=this.adaptor.nil(),Ne=this.input.LT(1),this.input.LA(1)>=ar&&this.input.LA(1)<=wr)this.input.consume(),this.state.backtracking===0&&this.adaptor.addChild(Ee,this.adaptor.create(Ne)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Pe=new org.antlr.runtime.MismatchedSetException(null,this.input);throw Pe}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(xe){if(xe instanceof org.antlr.runtime.RecognitionException)this.reportError(xe),this.recover(this.input,xe),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),xe);else throw xe}finally{}return fe},negnumber_return:function(){FormulaParser.negnumber_return=function(){},org.antlr.lang.extend(FormulaParser.negnumber_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),negnumber:function(){var fe=new FormulaParser.negnumber_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token MINUS"),ke=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule number");try{if(Ne=this.match(this.input,Ct,FormulaParser.FOLLOW_MINUS_in_negnumber2261),this.state.failed||(this.state.backtracking===0&&xe.add(Ne),this.pushFollow(FormulaParser.FOLLOW_number_in_negnumber2263),Pe=this.number(),this.state._fsp--,this.state.failed))return fe;if(this.state.backtracking===0&&ke.add(Pe.getTree()),this.state.backtracking===0){fe.tree=Ee;var Ae=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var Re=this.adaptor.nil();Re=this.adaptor.becomeRoot(this.adaptor.create(ee,"NEGATE"),Re),this.adaptor.addChild(Re,ke.nextTree()),this.adaptor.addChild(Ee,Re)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Ce){if(Ce instanceof org.antlr.runtime.RecognitionException)this.reportError(Ce),this.recover(this.input,Ce),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Ce);else throw Ce}finally{}return fe},bool_return:function(){FormulaParser.bool_return=function(){},org.antlr.lang.extend(FormulaParser.bool_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),bool:function(){var fe=new FormulaParser.bool_return;fe.start=this.input.LT(1);var Ee=null,Ne=null;try{if(Ee=this.adaptor.nil(),Ne=this.input.LT(1),this.input.LA(1)>=yr&&this.input.LA(1)<=Wt)this.input.consume(),this.state.backtracking===0&&this.adaptor.addChild(Ee,this.adaptor.create(Ne)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Pe=new org.antlr.runtime.MismatchedSetException(null,this.input);throw Pe}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(xe){if(xe instanceof org.antlr.runtime.RecognitionException)this.reportError(xe),this.recover(this.input,xe),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),xe);else throw xe}finally{}return fe},material_return:function(){FormulaParser.material_return=function(){},org.antlr.lang.extend(FormulaParser.material_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),material:function(){var fe=new FormulaParser.material_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=null,ke=null,Ae=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token LCURL"),Re=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token RCURL"),Ce=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unitMultiplicativeExpression"),Me=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule additiveExpression");try{if(Ne=this.match(this.input,kt,FormulaParser.FOLLOW_LCURL_in_material2415),this.state.failed||(this.state.backtracking===0&&Ae.add(Ne),this.pushFollow(FormulaParser.FOLLOW_additiveExpression_in_material2417),xe=this.additiveExpression(),this.state._fsp--,this.state.failed))return fe;if(this.state.backtracking===0&&Me.add(xe.getTree()),this.input.get(this.input.index()-1).getText()!=" "){if(this.state.backtracking>0)return this.state.failed=!0,fe;throw new org.antlr.runtime.FailedPredicateException(this.input,"material",' this.input.get(this.input.index()-1).getText()==" "')}if(this.pushFollow(FormulaParser.FOLLOW_unitMultiplicativeExpression_in_material2421),ke=this.unitMultiplicativeExpression(),this.state._fsp--,this.state.failed||(this.state.backtracking===0&&Ce.add(ke.getTree()),Pe=this.match(this.input,Er,FormulaParser.FOLLOW_RCURL_in_material2423),this.state.failed))return fe;if(this.state.backtracking===0&&Re.add(Pe),this.state.backtracking===0){fe.tree=Ee;var We=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var $e=this.adaptor.nil();$e=this.adaptor.becomeRoot(this.adaptor.create(ie,"MATERIAL"),$e),this.adaptor.addChild($e,Ce.nextTree()),this.adaptor.addChild($e,Me.nextTree()),this.adaptor.addChild(Ee,$e)}fe.tree=Ee}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Ue){if(Ue instanceof org.antlr.runtime.RecognitionException)this.reportError(Ue),this.recover(this.input,Ue),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Ue);else throw Ue}finally{}return fe},unitMultiplicativeExpression_return:function(){FormulaParser.unitMultiplicativeExpression_return=function(){},org.antlr.lang.extend(FormulaParser.unitMultiplicativeExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unitMultiplicativeExpression:function(){var fe=new FormulaParser.unitMultiplicativeExpression_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=null,ke=null;try{if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_unitInnerMultiplicativeExpression_in_unitMultiplicativeExpression2460),Pe=this.unitInnerMultiplicativeExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Pe.getTree());e:do{var Ae=2,Re=this.input.LA(1);switch(Re==br&&(Ae=1),Ae){case 1:if(Ne=this.match(this.input,br,FormulaParser.FOLLOW_PER_in_unitMultiplicativeExpression2464),this.state.failed||(this.state.backtracking===0&&(ke=this.adaptor.create(Ne),Ee=this.adaptor.becomeRoot(ke,Ee)),this.pushFollow(FormulaParser.FOLLOW_unitInnerMultiplicativeExpression_in_unitMultiplicativeExpression2467),xe=this.unitInnerMultiplicativeExpression(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,xe.getTree());break;default:break e}}while(!0);fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Ce){if(Ce instanceof org.antlr.runtime.RecognitionException)this.reportError(Ce),this.recover(this.input,Ce),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Ce);else throw Ce}finally{}return fe},unitInnerMultiplicativeExpression_return:function(){FormulaParser.unitInnerMultiplicativeExpression_return=function(){},org.antlr.lang.extend(FormulaParser.unitInnerMultiplicativeExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unitInnerMultiplicativeExpression:function(){var fe=new FormulaParser.unitInnerMultiplicativeExpression_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=null;try{if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_unitClump_in_unitInnerMultiplicativeExpression2483),Pe=this.unitClump(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,Pe.getTree());e:do{var ke=2,Ae=this.input.LA(1);switch(Ae>=Vt&&Ae<=vr&&(ke=1),ke){case 1:if(Ne=this.input.LT(1),this.input.LA(1)>=Vt&&this.input.LA(1)<=vr)this.input.consume(),this.state.backtracking===0&&(Ee=this.adaptor.becomeRoot(this.adaptor.create(Ne),Ee)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Re=new org.antlr.runtime.MismatchedSetException(null,this.input);throw Re}if(this.pushFollow(FormulaParser.FOLLOW_unitClump_in_unitInnerMultiplicativeExpression2494),xe=this.unitClump(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,xe.getTree());break;default:break e}}while(!0);fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Ce){if(Ce instanceof org.antlr.runtime.RecognitionException)this.reportError(Ce),this.recover(this.input,Ce),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Ce);else throw Ce}finally{}return fe},unitClump_return:function(){FormulaParser.unitClump_return=function(){},org.antlr.lang.extend(FormulaParser.unitClump_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unitClump:function(){var fe=new FormulaParser.unitClump_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=null,ke=null,Ae=null,Re=null,Ce=null,Me=null,We=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token INTEGER"),$e=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token SQUARED"),Ue=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token DIV"),Be=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token CUBED"),Je=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unitPowerExpression");try{var st=2,Ze=this.input.LA(1);if(Ze==ar)st=1;else if(Ze==Ye||Ze==113)st=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var ze=new org.antlr.runtime.NoViableAltException("",93,0,this.input);throw ze}switch(st){case 1:if(Ne=this.match(this.input,ar,FormulaParser.FOLLOW_INTEGER_in_unitClump2510),this.state.failed||(this.state.backtracking===0&&We.add(Ne),Pe=this.match(this.input,vr,FormulaParser.FOLLOW_DIV_in_unitClump2512),this.state.failed)||(this.state.backtracking===0&&Ue.add(Pe),this.pushFollow(FormulaParser.FOLLOW_unitPowerExpression_in_unitClump2515),Ce=this.unitPowerExpression(),this.state._fsp--,this.state.failed))return fe;this.state.backtracking===0&&Je.add(Ce.getTree());var it=2,ct=this.input.LA(1);switch(ct==lr&&(it=1),it){case 1:if(xe=this.match(this.input,lr,FormulaParser.FOLLOW_CUBED_in_unitClump2517),this.state.failed)return fe;this.state.backtracking===0&&Be.add(xe);break}var ft=2,lt=this.input.LA(1);switch(lt==cr&&(ft=1),ft){case 1:if(ke=this.match(this.input,cr,FormulaParser.FOLLOW_SQUARED_in_unitClump2520),this.state.failed)return fe;this.state.backtracking===0&&$e.add(ke);break}if(this.state.backtracking===0){fe.tree=Ee;var ut=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var He=this.adaptor.nil();for(He=this.adaptor.becomeRoot(this.adaptor.create(oe,"UNITCLUMP"),He),this.adaptor.addChild(He,Je.nextTree()),this.adaptor.addChild(He,this.adaptor.create(ee,"NEGATE"));Be.hasNext();)this.adaptor.addChild(He,Be.nextNode());for(Be.reset();$e.hasNext();)this.adaptor.addChild(He,$e.nextNode());$e.reset(),this.adaptor.addChild(Ee,He)}fe.tree=Ee}break;case 2:if(this.pushFollow(FormulaParser.FOLLOW_unitPowerExpression_in_unitClump2543),Me=this.unitPowerExpression(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&Je.add(Me.getTree());var rt=2,vt=this.input.LA(1);switch(vt==lr&&(rt=1),rt){case 1:if(Ae=this.match(this.input,lr,FormulaParser.FOLLOW_CUBED_in_unitClump2545),this.state.failed)return fe;this.state.backtracking===0&&Be.add(Ae);break}var wt=2,Ot=this.input.LA(1);switch(Ot==cr&&(wt=1),wt){case 1:if(Re=this.match(this.input,cr,FormulaParser.FOLLOW_SQUARED_in_unitClump2548),this.state.failed)return fe;this.state.backtracking===0&&$e.add(Re);break}if(this.state.backtracking===0){fe.tree=Ee;var ut=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var He=this.adaptor.nil();for(He=this.adaptor.becomeRoot(this.adaptor.create(oe,"UNITCLUMP"),He),this.adaptor.addChild(He,Je.nextTree());Be.hasNext();)this.adaptor.addChild(He,Be.nextNode());for(Be.reset();$e.hasNext();)this.adaptor.addChild(He,$e.nextNode());$e.reset(),this.adaptor.addChild(Ee,He)}fe.tree=Ee}break}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Qe){if(Qe instanceof org.antlr.runtime.RecognitionException)this.reportError(Qe),this.recover(this.input,Qe),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Qe);else throw Qe}finally{}return fe},unitPowerExpression_return:function(){FormulaParser.unitPowerExpression_return=function(){},org.antlr.lang.extend(FormulaParser.unitPowerExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unitPowerExpression:function(){var fe=new FormulaParser.unitPowerExpression_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=null,ke=null,Ae=null,Re=null;try{if(Ee=this.adaptor.nil(),this.pushFollow(FormulaParser.FOLLOW_unit_in_unitPowerExpression2610),ke=this.unit(),this.state._fsp--,this.state.failed)return fe;this.state.backtracking===0&&this.adaptor.addChild(Ee,ke.getTree());e:do{var Ce=2,Me=this.input.LA(1);switch(Me==ir&&(Ce=1),Ce){case 1:if(Ne=this.match(this.input,ir,FormulaParser.FOLLOW_POW_in_unitPowerExpression2614),this.state.failed)return fe;this.state.backtracking===0&&(Ae=this.adaptor.create(Ne),Ee=this.adaptor.becomeRoot(Ae,Ee));var We=2,$e=this.input.LA(1);switch($e==Ct&&(We=1),We){case 1:if(Pe=this.match(this.input,Ct,FormulaParser.FOLLOW_MINUS_in_unitPowerExpression2617),this.state.failed)return fe;this.state.backtracking===0&&(Re=this.adaptor.create(Pe),this.adaptor.addChild(Ee,Re));break}if(xe=this.input.LT(1),this.input.LA(1)>=ar&&this.input.LA(1)<=wr)this.input.consume(),this.state.backtracking===0&&this.adaptor.addChild(Ee,this.adaptor.create(xe)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Ue=new org.antlr.runtime.MismatchedSetException(null,this.input);throw Ue}break;default:break e}}while(!0);fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(Be){if(Be instanceof org.antlr.runtime.RecognitionException)this.reportError(Be),this.recover(this.input,Be),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),Be);else throw Be}finally{}return fe},unit_return:function(){FormulaParser.unit_return=function(){},org.antlr.lang.extend(FormulaParser.unit_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unit:function(){var fe=new FormulaParser.unit_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null,xe=null,ke=null,Ae=null,Re=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 114"),Ce=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),Me=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 113"),We=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unitMultiplicativeExpression");try{var $e=2,Ue=this.input.LA(1);if(Ue==Ye)$e=1;else if(Ue==113)$e=2;else{if(this.state.backtracking>0)return this.state.failed=!0,fe;var Be=new org.antlr.runtime.NoViableAltException("",97,0,this.input);throw Be}switch($e){case 1:if(Ne=this.match(this.input,Ye,FormulaParser.FOLLOW_IDENT_in_unit2638),this.state.failed)return fe;this.state.backtracking===0&&Ce.add(Ne);e:do{var Je=2,st=this.input.LA(1);switch(st==Ye&&(Je=1),Je){case 1:if(Pe=this.match(this.input,Ye,FormulaParser.FOLLOW_IDENT_in_unit2641),this.state.failed)return fe;this.state.backtracking===0&&Ce.add(Pe);break;default:break e}}while(!0);if(this.state.backtracking===0){fe.tree=Ee;var Ze=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var ze=this.adaptor.nil();if(ze=this.adaptor.becomeRoot(this.adaptor.create(se,"UNIT"),ze),!Ce.hasNext())throw new org.antlr.runtime.tree.RewriteEarlyExitException;for(;Ce.hasNext();)this.adaptor.addChild(ze,Ce.nextNode());Ce.reset(),this.adaptor.addChild(Ee,ze)}fe.tree=Ee}break;case 2:if(xe=this.match(this.input,113,FormulaParser.FOLLOW_113_in_unit2658),this.state.failed||(this.state.backtracking===0&&Me.add(xe),this.pushFollow(FormulaParser.FOLLOW_unitMultiplicativeExpression_in_unit2660),Ae=this.unitMultiplicativeExpression(),this.state._fsp--,this.state.failed)||(this.state.backtracking===0&&We.add(Ae.getTree()),ke=this.match(this.input,114,FormulaParser.FOLLOW_114_in_unit2662),this.state.failed))return fe;if(this.state.backtracking===0&&Re.add(ke),this.state.backtracking===0){fe.tree=Ee;var Ze=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",fe!=null?fe.tree:null);Ee=this.adaptor.nil();{var ze=this.adaptor.nil();ze=this.adaptor.becomeRoot(this.adaptor.create(oe,"UNITCLUMP"),ze),this.adaptor.addChild(ze,We.nextTree()),this.adaptor.addChild(Ee,ze)}fe.tree=Ee}break}fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(it){if(it instanceof org.antlr.runtime.RecognitionException)this.reportError(it),this.recover(this.input,it),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),it);else throw it}finally{}return fe},primitive_return:function(){FormulaParser.primitive_return=function(){},org.antlr.lang.extend(FormulaParser.primitive_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),primitive:function(){var fe=new FormulaParser.primitive_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null;try{if(Ee=this.adaptor.nil(),Ne=this.match(this.input,Pt,FormulaParser.FOLLOW_PRIMITIVE_in_primitive2731),this.state.failed)return fe;this.state.backtracking===0&&(Pe=this.adaptor.create(Ne),this.adaptor.addChild(Ee,Pe)),fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(xe){if(xe instanceof org.antlr.runtime.RecognitionException)this.reportError(xe),this.recover(this.input,xe),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),xe);else throw xe}finally{}return fe},string_return:function(){FormulaParser.string_return=function(){},org.antlr.lang.extend(FormulaParser.string_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),string:function(){var fe=new FormulaParser.string_return;fe.start=this.input.LT(1);var Ee=null,Ne=null,Pe=null;try{if(Ee=this.adaptor.nil(),Ne=this.match(this.input,$t,FormulaParser.FOLLOW_STRING_in_string3200),this.state.failed)return fe;this.state.backtracking===0&&(Pe=this.adaptor.create(Ne),Ee=this.adaptor.becomeRoot(Pe,Ee)),fe.stop=this.input.LT(-1),this.state.backtracking===0&&(fe.tree=this.adaptor.rulePostProcessing(Ee),this.adaptor.setTokenBoundaries(fe.tree,fe.start,fe.stop))}catch(xe){if(xe instanceof org.antlr.runtime.RecognitionException)this.reportError(xe),this.recover(this.input,xe),fe.tree=this.adaptor.errorNode(this.input,fe.start,this.input.LT(-1),xe);else throw xe}finally{}return fe},synpred5_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_assignment_in_synpred5_Formula508),this.assignment(),this.state._fsp--,this.state.failed},synpred6_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_synpred6_Formula514),this.logicalExpression(),this.state._fsp--,this.state.failed},synpred8_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_forLoop_in_synpred8_Formula526),this.forLoop(),this.state._fsp--,this.state.failed},synpred9_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_forInLoop_in_synpred9_Formula532),this.forInLoop(),this.state._fsp--,this.state.failed},synpred11_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_functionDef_in_synpred11_Formula544),this.functionDef(),this.state._fsp--,this.state.failed},synpred47_Formula_fragment:function(){this.match(this.input,Ut,FormulaParser.FOLLOW_OR_in_synpred47_Formula1217),!this.state.failed&&(this.pushFollow(FormulaParser.FOLLOW_booleanXORExpression_in_synpred47_Formula1220),this.booleanXORExpression(),this.state._fsp--,this.state.failed)},synpred48_Formula_fragment:function(){this.match(this.input,Zt,FormulaParser.FOLLOW_XOR_in_synpred48_Formula1253),!this.state.failed&&(this.pushFollow(FormulaParser.FOLLOW_booleanAndExpression_in_synpred48_Formula1256),this.booleanAndExpression(),this.state._fsp--,this.state.failed)},synpred49_Formula_fragment:function(){this.match(this.input,fr,FormulaParser.FOLLOW_AND_in_synpred49_Formula1288),!this.state.failed&&(this.pushFollow(FormulaParser.FOLLOW_equalityExpression_in_synpred49_Formula1291),this.equalityExpression(),this.state._fsp--,this.state.failed)},synpred51_Formula_fragment:function(){if(this.input.LA(1)==Rt||this.input.LA(1)==dr)this.input.consume(),this.state.errorRecovery=!1,this.state.failed=!1;else{if(this.state.backtracking>0){this.state.failed=!0;return}var fe=new org.antlr.runtime.MismatchedSetException(null,this.input);throw fe}this.pushFollow(FormulaParser.FOLLOW_relationalExpression_in_synpred51_Formula1332),this.relationalExpression(),this.state._fsp--,this.state.failed},synpred55_Formula_fragment:function(){if(this.input.LA(1)>=pr&&this.input.LA(1)<=mr)this.input.consume(),this.state.errorRecovery=!1,this.state.failed=!1;else{if(this.state.backtracking>0){this.state.failed=!0;return}var fe=new org.antlr.runtime.MismatchedSetException(null,this.input);throw fe}this.pushFollow(FormulaParser.FOLLOW_additiveExpression_in_synpred55_Formula1389),this.additiveExpression(),this.state._fsp--,this.state.failed},synpred57_Formula_fragment:function(){if(this.input.LA(1)>=gr&&this.input.LA(1)<=Ct)this.input.consume(),this.state.errorRecovery=!1,this.state.failed=!1;else{if(this.state.backtracking>0){this.state.failed=!0;return}var fe=new org.antlr.runtime.MismatchedSetException(null,this.input);throw fe}this.pushFollow(FormulaParser.FOLLOW_multiplicativeExpression_in_synpred57_Formula1443),this.multiplicativeExpression(),this.state._fsp--,this.state.failed},synpred60_Formula_fragment:function(){if(this.input.LA(1)>=Vt&&this.input.LA(1)<=_r)this.input.consume(),this.state.errorRecovery=!1,this.state.failed=!1;else{if(this.state.backtracking>0){this.state.failed=!0;return}var fe=new org.antlr.runtime.MismatchedSetException(null,this.input);throw fe}this.pushFollow(FormulaParser.FOLLOW_arrayExpression_in_synpred60_Formula1486),this.arrayExpression(),this.state._fsp--,this.state.failed},synpred61_Formula_fragment:function(){if(this.input.get(this.input.index()-1).getText()==" "){if(this.state.backtracking>0){this.state.failed=!0;return}throw new org.antlr.runtime.FailedPredicateException(this.input,"synpred61_Formula",' this.input.get(this.input.index()-1).getText()!=" "')}if(this.match(this.input,tr,FormulaParser.FOLLOW_COLON_in_synpred61_Formula1538),!this.state.failed){if(this.input.get(this.input.index()-1).getText()==" "){if(this.state.backtracking>0){this.state.failed=!0;return}throw new org.antlr.runtime.FailedPredicateException(this.input,"synpred61_Formula",' this.input.get(this.input.index()-1).getText()!=" "')}this.pushFollow(FormulaParser.FOLLOW_negationExpression_in_synpred61_Formula1542),this.negationExpression(),this.state._fsp--,this.state.failed}},synpred62_Formula_fragment:function(){if(this.input.get(this.input.index()-1).getText()==" "){if(this.state.backtracking>0){this.state.failed=!0;return}throw new org.antlr.runtime.FailedPredicateException(this.input,"synpred62_Formula",' this.input.get(this.input.index()-1).getText()!=" "')}if(this.match(this.input,tr,FormulaParser.FOLLOW_COLON_in_synpred62_Formula1551),!this.state.failed){if(this.input.get(this.input.index()-1).getText()==" "){if(this.state.backtracking>0){this.state.failed=!0;return}throw new org.antlr.runtime.FailedPredicateException(this.input,"synpred62_Formula",' this.input.get(this.input.index()-1).getText()!=" "')}this.pushFollow(FormulaParser.FOLLOW_negationExpression_in_synpred62_Formula1555),this.negationExpression(),this.state._fsp--,this.state.failed}},synpred64_Formula_fragment:function(){this.match(this.input,ir,FormulaParser.FOLLOW_POW_in_synpred64_Formula1610),!this.state.failed&&(this.pushFollow(FormulaParser.FOLLOW_unaryOrNegate_in_synpred64_Formula1612),this.unaryOrNegate(),this.state._fsp--,this.state.failed)},synpred68_Formula_fragment:function(){if(this.input.get(this.input.index()-1).getText()==" "){if(this.state.backtracking>0){this.state.failed=!0;return}throw new org.antlr.runtime.FailedPredicateException(this.input,"synpred68_Formula",' this.input.get(this.input.index()-1).getText()!=" "')}var fe=2,Ee=this.input.LA(1);if(Ee==Lt||Ee==kt||Ee==116)fe=1;else if(Ee==113)fe=2;else{if(this.state.backtracking>0){this.state.failed=!0;return}var Ne=new org.antlr.runtime.NoViableAltException("",119,0,this.input);throw Ne}switch(fe){case 1:if(this.pushFollow(FormulaParser.FOLLOW_selector_in_synpred68_Formula1744),this.selector(),this.state._fsp--,this.state.failed)return;break;case 2:if(this.pushFollow(FormulaParser.FOLLOW_funCall_in_synpred68_Formula1746),this.funCall(),this.state._fsp--,this.state.failed)return;break}},synpred75_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_material_in_synpred75_Formula1841),this.material(),this.state._fsp--,this.state.failed},synpred78_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_array_in_synpred78_Formula1856),this.array(),this.state._fsp--,this.state.failed},synpred80_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_funCall_in_synpred80_Formula1880),this.funCall(),this.state._fsp--,this.state.failed},synpred85_Formula_fragment:function(){this.match(this.input,Ie,FormulaParser.FOLLOW_NEWLINE_in_synpred85_Formula1946),this.state.failed},synpred86_Formula_fragment:function(){this.match(this.input,Ie,FormulaParser.FOLLOW_NEWLINE_in_synpred86_Formula1952),this.state.failed},synpred87_Formula_fragment:function(){this.match(this.input,Ie,FormulaParser.FOLLOW_NEWLINE_in_synpred87_Formula1958),this.state.failed},synpred88_Formula_fragment:function(){this.match(this.input,Ie,FormulaParser.FOLLOW_NEWLINE_in_synpred88_Formula1963),this.state.failed},synpred93_Formula_fragment:function(){this.match(this.input,Ie,FormulaParser.FOLLOW_NEWLINE_in_synpred93_Formula1989),this.state.failed},synpred94_Formula_fragment:function(){this.match(this.input,Ie,FormulaParser.FOLLOW_NEWLINE_in_synpred94_Formula1995),this.state.failed},synpred95_Formula_fragment:function(){this.match(this.input,Ie,FormulaParser.FOLLOW_NEWLINE_in_synpred95_Formula2000),this.state.failed},synpred96_Formula_fragment:function(){this.match(this.input,Ie,FormulaParser.FOLLOW_NEWLINE_in_synpred96_Formula2005),this.state.failed},synpred108_Formula_fragment:function(){this.match(this.input,116,FormulaParser.FOLLOW_116_in_synpred108_Formula2133),!this.state.failed&&(this.pushFollow(FormulaParser.FOLLOW_arrayName_in_synpred108_Formula2135),this.arrayName(),this.state._fsp--,this.state.failed)},synpred112_Formula_fragment:function(){if(this.pushFollow(FormulaParser.FOLLOW_arrayName_in_synpred112_Formula2173),this.arrayName(),this.state._fsp--,!this.state.failed){e:do{var fe=2,Ee=this.input.LA(1);switch(Ee==Ie&&(fe=1),fe){case 1:if(this.match(this.input,Ie,FormulaParser.FOLLOW_NEWLINE_in_synpred112_Formula2175),this.state.failed)return;break;default:break e}}while(!0);this.match(this.input,tr,FormulaParser.FOLLOW_COLON_in_synpred112_Formula2178),this.state.failed}},synpred95_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred95_Formula_fragment()}catch(Ne){throw Ne}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred94_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred94_Formula_fragment()}catch(Ne){throw Ne}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred80_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred80_Formula_fragment()}catch(Ne){throw Ne}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred49_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred49_Formula_fragment()}catch(Ne){throw Ne}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred57_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred57_Formula_fragment()}catch(Ne){throw Ne}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred68_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred68_Formula_fragment()}catch(Ne){throw Ne}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred51_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred51_Formula_fragment()}catch(Ne){throw Ne}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred62_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred62_Formula_fragment()}catch(Ne){throw Ne}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred64_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred64_Formula_fragment()}catch(Ne){throw Ne}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred93_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred93_Formula_fragment()}catch(Ne){throw Ne}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred55_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred55_Formula_fragment()}catch(Ne){throw Ne}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred85_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred85_Formula_fragment()}catch(Ne){throw Ne}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred87_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred87_Formula_fragment()}catch(Ne){throw Ne}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred48_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred48_Formula_fragment()}catch(Ne){throw Ne}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred86_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred86_Formula_fragment()}catch(Ne){throw Ne}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred9_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred9_Formula_fragment()}catch(Ne){throw Ne}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred75_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred75_Formula_fragment()}catch(Ne){throw Ne}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred96_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred96_Formula_fragment()}catch(Ne){throw Ne}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred47_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred47_Formula_fragment()}catch(Ne){throw Ne}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred8_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred8_Formula_fragment()}catch(Ne){throw Ne}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred112_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred112_Formula_fragment()}catch(Ne){throw Ne}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred6_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred6_Formula_fragment()}catch(Ne){throw Ne}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred5_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred5_Formula_fragment()}catch(Ne){throw Ne}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred60_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred60_Formula_fragment()}catch(Ne){throw Ne}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred61_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred61_Formula_fragment()}catch(Ne){throw Ne}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred108_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred108_Formula_fragment()}catch(Ne){throw Ne}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred11_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred11_Formula_fragment()}catch(Ne){throw Ne}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred78_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred78_Formula_fragment()}catch(Ne){throw Ne}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee},synpred88_Formula:function(){this.state.backtracking++;var fe=this.input.mark();try{this.synpred88_Formula_fragment()}catch(Ne){throw Ne}var Ee=!this.state.failed;return this.input.rewind(fe),this.state.backtracking--,this.state.failed=!1,Ee}},!0),org.antlr.lang.augmentObject(FormulaParser,{DFA5_eotS:"￿",DFA5_eofS:"￿",DFA5_minS:"&\0\b￿\0￿\0\b￿",DFA5_maxS:"q\0\b￿\0￿\0\b￿",DFA5_acceptS:`￿	￿￿\b	
\x07`,DFA5_specialS:"￿\0\b￿￿\b￿}>",DFA5_transitionS:[`\r￿\v￿￿\v￿￿￿
￿￿￿￿￿`,"￿","￿","","","","","","","","","￿","","","￿","","","","","","","",""]}),org.antlr.lang.augmentObject(FormulaParser,{DFA5_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA5_eotS),DFA5_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA5_eofS),DFA5_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA5_minS),DFA5_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA5_maxS),DFA5_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA5_acceptS),DFA5_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA5_specialS),DFA5_transition:function(){var fe=[],Ee,Ne=FormulaParser.DFA5_transitionS.length;for(Ee=0;Ee<Ne;Ee++)fe.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA5_transitionS[Ee]));return fe}()}),FormulaParser.DFA5=function(fe){this.recognizer=fe,this.decisionNumber=5,this.eot=FormulaParser.DFA5_eot,this.eof=FormulaParser.DFA5_eof,this.min=FormulaParser.DFA5_min,this.max=FormulaParser.DFA5_max,this.accept=FormulaParser.DFA5_accept,this.special=FormulaParser.DFA5_special,this.transition=FormulaParser.DFA5_transition},org.antlr.lang.extend(FormulaParser.DFA5,org.antlr.runtime.DFA,{getDescription:function(){return"120:1: expression : ( assignment | logicalExpression | whileLoop | forLoop | forInLoop | ifThenElse | functionDef | returnExp | tryCatch | throwExp );"},specialStateTransition:function(fe,Ee){var Ne=fe,Pe=function(ke,Ae){switch(ke){case 0:Ae.LA(1);var Re=Ae.index();if(Ae.rewind(),ke=-1,this.synpred5_Formula()?ke=19:this.synpred6_Formula()&&(ke=3),Ae.seek(Re),ke>=0)return ke;break;case 1:Ae.LA(1);var Ce=Ae.index();if(Ae.rewind(),ke=-1,this.synpred5_Formula()?ke=19:this.synpred6_Formula()&&(ke=3),Ae.seek(Ce),ke>=0)return ke;break;case 2:Ae.LA(1);var Me=Ae.index();if(Ae.rewind(),ke=-1,this.synpred6_Formula()?ke=3:this.synpred11_Formula()&&(ke=20),Ae.seek(Me),ke>=0)return ke;break;case 3:Ae.LA(1);var We=Ae.index();if(Ae.rewind(),ke=-1,this.synpred8_Formula()?ke=21:this.synpred9_Formula()&&(ke=22),Ae.seek(We),ke>=0)return ke;break}}.call(this.recognizer,fe,Ee);if(!org.antlr.lang.isUndefined(Pe))return Pe;if(this.recognizer.state.backtracking>0)return this.recognizer.state.failed=!0,-1;var xe=new org.antlr.runtime.NoViableAltException(this.getDescription(),5,Ne,Ee);throw this.error(xe),xe},dummy:null}),org.antlr.lang.augmentObject(FormulaParser,{DFA57_eotS:"\v￿",DFA57_eofS:"\v￿",DFA57_minS:"<￿\0￿",DFA57_maxS:"b￿\0￿",DFA57_acceptS:"￿￿\x07\b	",DFA57_specialS:"￿\0￿}>",DFA57_transitionS:["\b￿	￿￿￿\x07￿￿","","","","￿","","","","","",""]}),org.antlr.lang.augmentObject(FormulaParser,{DFA57_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA57_eotS),DFA57_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA57_eofS),DFA57_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA57_minS),DFA57_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA57_maxS),DFA57_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA57_acceptS),DFA57_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA57_specialS),DFA57_transition:function(){var fe=[],Ee,Ne=FormulaParser.DFA57_transitionS.length;for(Ee=0;Ee<Ne;Ee++)fe.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA57_transitionS[Ee]));return fe}()}),FormulaParser.DFA57=function(fe){this.recognizer=fe,this.decisionNumber=57,this.eot=FormulaParser.DFA57_eot,this.eof=FormulaParser.DFA57_eof,this.min=FormulaParser.DFA57_min,this.max=FormulaParser.DFA57_max,this.accept=FormulaParser.DFA57_accept,this.special=FormulaParser.DFA57_special,this.transition=FormulaParser.DFA57_transition},org.antlr.lang.extend(FormulaParser.DFA57,org.antlr.runtime.DFA,{getDescription:function(){return"283:1: value : ( number | bool | string | material | IDENT | primitive | array | anonFunctionDef | newObject );"},specialStateTransition:function(fe,Ee){var Ne=fe,Pe=function(ke,Ae){switch(ke){case 0:Ae.LA(1);var Re=Ae.index();if(Ae.rewind(),ke=-1,this.synpred75_Formula()?ke=10:this.synpred78_Formula()&&(ke=7),Ae.seek(Re),ke>=0)return ke;break}}.call(this.recognizer,fe,Ee);if(!org.antlr.lang.isUndefined(Pe))return Pe;if(this.recognizer.state.backtracking>0)return this.recognizer.state.failed=!0,-1;var xe=new org.antlr.runtime.NoViableAltException(this.getDescription(),57,Ne,Ee);throw this.error(xe),xe},dummy:null}),org.antlr.lang.augmentObject(FormulaParser,{DFA58_eotS:"￿",DFA58_eofS:"￿",DFA58_minS:" \0￿",DFA58_maxS:"t\0￿",DFA58_acceptS:"￿￿",DFA58_specialS:"￿\0￿}>",DFA58_transitionS:["￿￿￿\r￿￿￿\r￿￿￿￿","￿","","","","","","","","","","","","","","","","","","","","","","","",""]}),org.antlr.lang.augmentObject(FormulaParser,{DFA58_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA58_eotS),DFA58_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA58_eofS),DFA58_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA58_minS),DFA58_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA58_maxS),DFA58_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA58_acceptS),DFA58_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA58_specialS),DFA58_transition:function(){var fe=[],Ee,Ne=FormulaParser.DFA58_transitionS.length;for(Ee=0;Ee<Ne;Ee++)fe.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA58_transitionS[Ee]));return fe}()}),FormulaParser.DFA58=function(fe){this.recognizer=fe,this.decisionNumber=58,this.eot=FormulaParser.DFA58_eot,this.eof=FormulaParser.DFA58_eof,this.min=FormulaParser.DFA58_min,this.max=FormulaParser.DFA58_max,this.accept=FormulaParser.DFA58_accept,this.special=FormulaParser.DFA58_special,this.transition=FormulaParser.DFA58_transition},org.antlr.lang.extend(FormulaParser.DFA58,org.antlr.runtime.DFA,{getDescription:function(){return"296:22: ( funCall )?"},specialStateTransition:function(fe,Ee){var Ne=fe,Pe=function(ke,Ae){switch(ke){case 0:Ae.LA(1);var Re=Ae.index();if(Ae.rewind(),ke=-1,this.synpred80_Formula()?ke=25:(this.input.get(this.input.index()-1).getText()==" "||this.input.get(this.input.index()-1).getText()!=" ")&&(ke=2),Ae.seek(Re),ke>=0)return ke;break}}.call(this.recognizer,fe,Ee);if(!org.antlr.lang.isUndefined(Pe))return Pe;if(this.recognizer.state.backtracking>0)return this.recognizer.state.failed=!0,-1;var xe=new org.antlr.runtime.NoViableAltException(this.getDescription(),58,Ne,Ee);throw this.error(xe),xe},dummy:null}),org.antlr.lang.augmentObject(FormulaParser,{DFA65_eotS:"￿",DFA65_eofS:"￿",DFA65_minS:" ￿ ￿",DFA65_maxS:"q￿q￿",DFA65_acceptS:"￿￿",DFA65_specialS:"￿}>",DFA65_transitionS:[`\x1B￿￿￿￿
￿￿￿￿`,"",`\x1B￿￿￿￿
￿￿￿￿`,""]}),org.antlr.lang.augmentObject(FormulaParser,{DFA65_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA65_eotS),DFA65_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA65_eofS),DFA65_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA65_minS),DFA65_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA65_maxS),DFA65_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA65_acceptS),DFA65_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA65_specialS),DFA65_transition:function(){var fe=[],Ee,Ne=FormulaParser.DFA65_transitionS.length;for(Ee=0;Ee<Ne;Ee++)fe.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA65_transitionS[Ee]));return fe}()}),FormulaParser.DFA65=function(fe){this.recognizer=fe,this.decisionNumber=65,this.eot=FormulaParser.DFA65_eot,this.eof=FormulaParser.DFA65_eof,this.min=FormulaParser.DFA65_min,this.max=FormulaParser.DFA65_max,this.accept=FormulaParser.DFA65_accept,this.special=FormulaParser.DFA65_special,this.transition=FormulaParser.DFA65_transition},org.antlr.lang.extend(FormulaParser.DFA65,org.antlr.runtime.DFA,{getDescription:function(){return"309:16: ( label ( NEWLINE )* ( ',' ( NEWLINE )* label ( NEWLINE )* )* )?"},dummy:null}),org.antlr.lang.augmentObject(FormulaParser,{DFA72_eotS:"￿",DFA72_eofS:"￿",DFA72_minS:" ￿ ￿",DFA72_maxS:"q￿q￿",DFA72_acceptS:"￿￿",DFA72_specialS:"￿}>",DFA72_transitionS:[`\x1B￿￿￿￿
￿￿￿￿￿`,"",`\x1B￿￿￿￿
￿￿￿￿￿`,""]}),org.antlr.lang.augmentObject(FormulaParser,{DFA72_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA72_eotS),DFA72_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA72_eofS),DFA72_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA72_minS),DFA72_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA72_maxS),DFA72_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA72_acceptS),DFA72_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA72_specialS),DFA72_transition:function(){var fe=[],Ee,Ne=FormulaParser.DFA72_transitionS.length;for(Ee=0;Ee<Ne;Ee++)fe.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA72_transitionS[Ee]));return fe}()}),FormulaParser.DFA72=function(fe){this.recognizer=fe,this.decisionNumber=72,this.eot=FormulaParser.DFA72_eot,this.eof=FormulaParser.DFA72_eof,this.min=FormulaParser.DFA72_min,this.max=FormulaParser.DFA72_max,this.accept=FormulaParser.DFA72_accept,this.special=FormulaParser.DFA72_special,this.transition=FormulaParser.DFA72_transition},org.antlr.lang.extend(FormulaParser.DFA72,org.antlr.runtime.DFA,{getDescription:function(){return"310:19: ( label ( NEWLINE )* ( ',' ( NEWLINE )* label ( NEWLINE )* )* )?"},dummy:null}),org.antlr.lang.augmentObject(FormulaParser,{DFA85_eotS:"￿",DFA85_eofS:"￿",DFA85_minS:" \0￿\0￿",DFA85_maxS:"q\0￿\0￿",DFA85_acceptS:"￿\x07￿￿",DFA85_specialS:"￿\0￿￿}>",DFA85_transitionS:[`\x1B￿￿￿\b￿
￿
￿￿￿￿`,"￿","","","","","","","￿","","","","","",""]}),org.antlr.lang.augmentObject(FormulaParser,{DFA85_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA85_eotS),DFA85_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA85_eofS),DFA85_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA85_minS),DFA85_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA85_maxS),DFA85_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA85_acceptS),DFA85_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA85_specialS),DFA85_transition:function(){var fe=[],Ee,Ne=FormulaParser.DFA85_transitionS.length;for(Ee=0;Ee<Ne;Ee++)fe.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA85_transitionS[Ee]));return fe}()}),FormulaParser.DFA85=function(fe){this.recognizer=fe,this.decisionNumber=85,this.eot=FormulaParser.DFA85_eot,this.eof=FormulaParser.DFA85_eof,this.min=FormulaParser.DFA85_min,this.max=FormulaParser.DFA85_max,this.accept=FormulaParser.DFA85_accept,this.special=FormulaParser.DFA85_special,this.transition=FormulaParser.DFA85_transition},org.antlr.lang.extend(FormulaParser.DFA85,org.antlr.runtime.DFA,{getDescription:function(){return"331:2: ( arrayName ( NEWLINE )* COLON )?"},specialStateTransition:function(fe,Ee){var Ne=fe,Pe=function(ke,Ae){switch(ke){case 0:Ae.LA(1);var Re=Ae.index();if(Ae.rewind(),ke=-1,this.synpred112_Formula()?ke=10:ke=2,Ae.seek(Re),ke>=0)return ke;break;case 1:Ae.LA(1);var Ce=Ae.index();if(Ae.rewind(),ke=-1,this.synpred112_Formula()?ke=10:ke=2,Ae.seek(Ce),ke>=0)return ke;break}}.call(this.recognizer,fe,Ee);if(!org.antlr.lang.isUndefined(Pe))return Pe;if(this.recognizer.state.backtracking>0)return this.recognizer.state.failed=!0,-1;var xe=new org.antlr.runtime.NoViableAltException(this.getDescription(),85,Ne,Ee);throw this.error(xe),xe},dummy:null}),org.antlr.lang.augmentObject(FormulaParser,{tokenNames:["<invalid>","<EOR>","<DOWN>","<UP>","NEGATE","ASSIGN","FUNCALL","MATERIAL","UNIT","POWER","DEFAULTS","PARAMS","UNITCLUMP","ARRAY","LINES","WHILE","IFTHENELSE","ELSE","FOR","FORIN","FUNCTION","ANONFUNCTION","NUMBER","LABEL","RANGE","INNER","ASSIGNED","SELECTOR","DOTSELECTOR","NEW","TRYCATCH","THROW","NEWLINE","W","H","I","L","E","WHILESTATEMENT","F","O","R","FORSTATEMENT","M","FROMSTATEMENT","N","INSTATEMENT","T","TOSTATEMENT","B","Y","BYSTATEMENT","P","LOOPSTATEMENT","IFSTATEMENT","THENSTATEMENT","S","ELSESTATEMENT","U","C","FUNCTIONSTATEMENT","D","ENDBLOCK","RETURNSTATEMENT","NEWSTATEMENT","TRYSTATEMENT","A","CATCHSTATEMENT","THROWSTATEMENT","IDENT","EQUALS","PRIMITIVE","OR","XOR","X","AND","NOTEQUALS","LT","LTEQ","GT","GTEQ","PLUS","MINUS","MULT","DIV","MOD","COLON","POW","NOT","LARR","RARR","LCURL","RCURL","COMMA","STRING","INTEGER","FLOAT","TRUE","FALSE","PER","CUBED","SQUARED","Q","LBRACKET","RBRACKET","COMMENT","LINE_COMMENT","WS","G","J","K","V","Z","'('","')'","'<-'","'.'"],FOLLOW_NEWLINE_in_lines160:new org.antlr.runtime.BitSet([0,2420114497,3406037171,131079]),FOLLOW_expression_in_lines164:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_lines168:new org.antlr.runtime.BitSet([0,2420114497,3406037171,131079]),FOLLOW_EOF_in_lines171:new org.antlr.runtime.BitSet([0,2420114496,3406037171,131079]),FOLLOW_EOF_in_lines176:new org.antlr.runtime.BitSet([2,0]),FOLLOW_assignment_in_expression508:new org.antlr.runtime.BitSet([2,0]),FOLLOW_logicalExpression_in_expression514:new org.antlr.runtime.BitSet([2,0]),FOLLOW_whileLoop_in_expression520:new org.antlr.runtime.BitSet([2,0]),FOLLOW_forLoop_in_expression526:new org.antlr.runtime.BitSet([2,0]),FOLLOW_forInLoop_in_expression532:new org.antlr.runtime.BitSet([2,0]),FOLLOW_ifThenElse_in_expression538:new org.antlr.runtime.BitSet([2,0]),FOLLOW_functionDef_in_expression544:new org.antlr.runtime.BitSet([2,0]),FOLLOW_returnExp_in_expression550:new org.antlr.runtime.BitSet([2,0]),FOLLOW_tryCatch_in_expression556:new org.antlr.runtime.BitSet([2,0]),FOLLOW_throwExp_in_expression562:new org.antlr.runtime.BitSet([2,0]),FOLLOW_RETURNSTATEMENT_in_returnExp574:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_returnExp577:new org.antlr.runtime.BitSet([2,0]),FOLLOW_expression_in_innerBlock590:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_innerBlock594:new org.antlr.runtime.BitSet([2,2420114497,3406037171,131079]),FOLLOW_WHILESTATEMENT_in_whileLoop619:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_whileLoop621:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_whileLoop623:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_whileLoop626:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_whileLoop629:new org.antlr.runtime.BitSet([0,2097152]),FOLLOW_LOOPSTATEMENT_in_whileLoop631:new org.antlr.runtime.BitSet([2,0]),FOLLOW_FORSTATEMENT_in_forLoop652:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_forLoop654:new org.antlr.runtime.BitSet([0,4096]),FOLLOW_FROMSTATEMENT_in_forLoop656:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_forLoop658:new org.antlr.runtime.BitSet([0,65536]),FOLLOW_TOSTATEMENT_in_forLoop660:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_forLoop662:new org.antlr.runtime.BitSet([0,524289]),FOLLOW_BYSTATEMENT_in_forLoop665:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_forLoop667:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_forLoop671:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_forLoop674:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_forLoop677:new org.antlr.runtime.BitSet([0,2097152]),FOLLOW_LOOPSTATEMENT_in_forLoop679:new org.antlr.runtime.BitSet([2,0]),FOLLOW_FORSTATEMENT_in_forInLoop707:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_forInLoop709:new org.antlr.runtime.BitSet([0,16384]),FOLLOW_INSTATEMENT_in_forInLoop711:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_forInLoop713:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_forInLoop715:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_forInLoop718:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_forInLoop721:new org.antlr.runtime.BitSet([0,2097152]),FOLLOW_LOOPSTATEMENT_in_forInLoop723:new org.antlr.runtime.BitSet([2,0]),FOLLOW_IFSTATEMENT_in_ifThenElse748:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_ifThenElse750:new org.antlr.runtime.BitSet([0,8388608]),FOLLOW_THENSTATEMENT_in_ifThenElse752:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_ifThenElse755:new org.antlr.runtime.BitSet([0,3527410753,3406037171,131079]),FOLLOW_innerBlock_in_ifThenElse758:new org.antlr.runtime.BitSet([0,1107296256]),FOLLOW_ELSESTATEMENT_in_ifThenElse762:new org.antlr.runtime.BitSet([0,4194304]),FOLLOW_IFSTATEMENT_in_ifThenElse764:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_ifThenElse766:new org.antlr.runtime.BitSet([0,8388608]),FOLLOW_THENSTATEMENT_in_ifThenElse768:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_ifThenElse770:new org.antlr.runtime.BitSet([0,3527410753,3406037171,131079]),FOLLOW_innerBlock_in_ifThenElse773:new org.antlr.runtime.BitSet([0,1107296256]),FOLLOW_ELSESTATEMENT_in_ifThenElse778:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_ifThenElse780:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_ifThenElse783:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_ifThenElse787:new org.antlr.runtime.BitSet([0,4194304]),FOLLOW_IFSTATEMENT_in_ifThenElse789:new org.antlr.runtime.BitSet([2,0]),FOLLOW_FUNCTIONSTATEMENT_in_functionDef820:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_functionDef822:new org.antlr.runtime.BitSet([0,0,0,131072]),FOLLOW_113_in_functionDef824:new org.antlr.runtime.BitSet([0,0,32,262144]),FOLLOW_IDENT_in_functionDef827:new org.antlr.runtime.BitSet([0,0,536870976,262144]),FOLLOW_EQUALS_in_functionDef831:new org.antlr.runtime.BitSet([0,0,3389259776,7]),FOLLOW_defaultValue_in_functionDef834:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_functionDef839:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_functionDef841:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_functionDef848:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_functionDef850:new org.antlr.runtime.BitSet([0,0,64,0]),FOLLOW_EQUALS_in_functionDef852:new org.antlr.runtime.BitSet([0,0,3389259776,7]),FOLLOW_defaultValue_in_functionDef854:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_114_in_functionDef861:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_functionDef863:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_functionDef866:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_functionDef869:new org.antlr.runtime.BitSet([0,268435456]),FOLLOW_FUNCTIONSTATEMENT_in_functionDef871:new org.antlr.runtime.BitSet([2,0]),FOLLOW_TRYSTATEMENT_in_tryCatch904:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_tryCatch906:new org.antlr.runtime.BitSet([0,2420114497,3406037179,131079]),FOLLOW_innerBlock_in_tryCatch909:new org.antlr.runtime.BitSet([0,0,8,0]),FOLLOW_CATCHSTATEMENT_in_tryCatch911:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_tryCatch913:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_tryCatch915:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_tryCatch919:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_tryCatch921:new org.antlr.runtime.BitSet([0,0,2,0]),FOLLOW_TRYSTATEMENT_in_tryCatch923:new org.antlr.runtime.BitSet([2,0]),FOLLOW_THROWSTATEMENT_in_throwExp945:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_primaryExpression_in_throwExp947:new org.antlr.runtime.BitSet([2,0]),FOLLOW_FUNCTIONSTATEMENT_in_anonFunctionDef967:new org.antlr.runtime.BitSet([0,0,0,131072]),FOLLOW_113_in_anonFunctionDef970:new org.antlr.runtime.BitSet([0,0,32,262144]),FOLLOW_IDENT_in_anonFunctionDef973:new org.antlr.runtime.BitSet([0,0,536870976,262144]),FOLLOW_EQUALS_in_anonFunctionDef977:new org.antlr.runtime.BitSet([0,0,3389259776,7]),FOLLOW_defaultValue_in_anonFunctionDef980:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_anonFunctionDef985:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_anonFunctionDef987:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_anonFunctionDef994:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_anonFunctionDef996:new org.antlr.runtime.BitSet([0,0,64,0]),FOLLOW_EQUALS_in_anonFunctionDef998:new org.antlr.runtime.BitSet([0,0,3389259776,7]),FOLLOW_defaultValue_in_anonFunctionDef1000:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_114_in_anonFunctionDef1007:new org.antlr.runtime.BitSet([0,2420114497,3406037171,131079]),FOLLOW_NEWLINE_in_anonFunctionDef1012:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_anonFunctionDef1015:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_anonFunctionDef1018:new org.antlr.runtime.BitSet([0,268435456]),FOLLOW_FUNCTIONSTATEMENT_in_anonFunctionDef1020:new org.antlr.runtime.BitSet([2,0]),FOLLOW_expression_in_anonFunctionDef1025:new org.antlr.runtime.BitSet([2,0]),FOLLOW_IDENT_in_assignment1067:new org.antlr.runtime.BitSet([0,0,0,131072]),FOLLOW_113_in_assignment1069:new org.antlr.runtime.BitSet([0,0,32,262144]),FOLLOW_IDENT_in_assignment1072:new org.antlr.runtime.BitSet([0,0,536870976,262144]),FOLLOW_EQUALS_in_assignment1076:new org.antlr.runtime.BitSet([0,0,3389259776,7]),FOLLOW_defaultValue_in_assignment1078:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_assignment1083:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_assignment1085:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_assignment1092:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_assignment1094:new org.antlr.runtime.BitSet([0,0,64,0]),FOLLOW_EQUALS_in_assignment1096:new org.antlr.runtime.BitSet([0,0,3389259776,7]),FOLLOW_defaultValue_in_assignment1098:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_114_in_assignment1105:new org.antlr.runtime.BitSet([0,0,0,524288]),FOLLOW_115_in_assignment1107:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_assignment1109:new org.antlr.runtime.BitSet([2,0]),FOLLOW_PRIMITIVE_in_assignment1137:new org.antlr.runtime.BitSet([0,0,536870912,524288]),FOLLOW_assigned_in_assignment1141:new org.antlr.runtime.BitSet([0,0,536870912,524288]),FOLLOW_COMMA_in_assignment1145:new org.antlr.runtime.BitSet([0,0,160,0]),FOLLOW_PRIMITIVE_in_assignment1148:new org.antlr.runtime.BitSet([0,0,536870912,524288]),FOLLOW_assigned_in_assignment1152:new org.antlr.runtime.BitSet([0,0,536870912,524288]),FOLLOW_115_in_assignment1158:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_assignment1160:new org.antlr.runtime.BitSet([2,0]),FOLLOW_IDENT_in_assigned1186:new org.antlr.runtime.BitSet([2,0,167772160,1048576]),FOLLOW_selector_in_assigned1188:new org.antlr.runtime.BitSet([2,0]),FOLLOW_booleanXORExpression_in_logicalExpression1214:new org.antlr.runtime.BitSet([2,0,256,0]),FOLLOW_OR_in_logicalExpression1217:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_booleanXORExpression_in_logicalExpression1220:new org.antlr.runtime.BitSet([2,0,256,0]),FOLLOW_booleanAndExpression_in_booleanXORExpression1250:new org.antlr.runtime.BitSet([2,0,512,0]),FOLLOW_XOR_in_booleanXORExpression1253:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_booleanAndExpression_in_booleanXORExpression1256:new org.antlr.runtime.BitSet([2,0,512,0]),FOLLOW_equalityExpression_in_booleanAndExpression1285:new org.antlr.runtime.BitSet([2,0,2048,0]),FOLLOW_AND_in_booleanAndExpression1288:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_equalityExpression_in_booleanAndExpression1291:new org.antlr.runtime.BitSet([2,0,2048,0]),FOLLOW_relationalExpression_in_equalityExpression1322:new org.antlr.runtime.BitSet([2,0,4160,0]),FOLLOW_set_in_equalityExpression1325:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_relationalExpression_in_equalityExpression1332:new org.antlr.runtime.BitSet([2,0,4160,0]),FOLLOW_additiveExpression_in_relationalExpression1374:new org.antlr.runtime.BitSet([2,0,122880,0]),FOLLOW_set_in_relationalExpression1378:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_additiveExpression_in_relationalExpression1389:new org.antlr.runtime.BitSet([2,0,122880,0]),FOLLOW_multiplicativeExpression_in_additiveExpression1432:new org.antlr.runtime.BitSet([2,0,393216,0]),FOLLOW_set_in_additiveExpression1436:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_multiplicativeExpression_in_additiveExpression1443:new org.antlr.runtime.BitSet([2,0,393216,0]),FOLLOW_arrayExpression_in_multiplicativeExpression1473:new org.antlr.runtime.BitSet([2,0,3670016,0]),FOLLOW_set_in_multiplicativeExpression1477:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_arrayExpression_in_multiplicativeExpression1486:new org.antlr.runtime.BitSet([2,0,3670016,0]),FOLLOW_negationExpression_in_arrayExpression1532:new org.antlr.runtime.BitSet([2,0,4194304,0]),FOLLOW_COLON_in_arrayExpression1538:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_negationExpression_in_arrayExpression1542:new org.antlr.runtime.BitSet([2,0,4194304,0]),FOLLOW_COLON_in_arrayExpression1551:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_negationExpression_in_arrayExpression1555:new org.antlr.runtime.BitSet([2,0]),FOLLOW_MINUS_in_negationExpression1580:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_powerExpression_in_negationExpression1582:new org.antlr.runtime.BitSet([2,0]),FOLLOW_powerExpression_in_negationExpression1596:new org.antlr.runtime.BitSet([2,0]),FOLLOW_unaryExpression_in_powerExpression1607:new org.antlr.runtime.BitSet([2,0,8388608,0]),FOLLOW_POW_in_powerExpression1610:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_unaryOrNegate_in_powerExpression1612:new org.antlr.runtime.BitSet([2,0,8388608,0]),FOLLOW_unaryExpression_in_unaryOrNegate1639:new org.antlr.runtime.BitSet([2,0]),FOLLOW_MINUS_in_unaryOrNegate1645:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_unaryExpression_in_unaryOrNegate1647:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NOT_in_unaryExpression1675:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_innerPrimaryExpression_in_unaryExpression1678:new org.antlr.runtime.BitSet([2,0]),FOLLOW_innerPrimaryExpression_in_unaryExpression1687:new org.antlr.runtime.BitSet([2,0]),FOLLOW_selectionExpression_in_innerPrimaryExpression1718:new org.antlr.runtime.BitSet([2,0]),FOLLOW_primaryExpression_in_selectionExpression1738:new org.antlr.runtime.BitSet([2,0,167772160,1179648]),FOLLOW_selector_in_selectionExpression1744:new org.antlr.runtime.BitSet([2,0,167772160,1179648]),FOLLOW_funCall_in_selectionExpression1746:new org.antlr.runtime.BitSet([2,0,167772160,1179648]),FOLLOW_113_in_funCall1761:new org.antlr.runtime.BitSet([0,268435456,3406037153,393223]),FOLLOW_logicalExpression_in_funCall1765:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_funCall1768:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_funCall1770:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_114_in_funCall1777:new org.antlr.runtime.BitSet([2,0]),FOLLOW_113_in_primaryExpression1798:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_primaryExpression1801:new org.antlr.runtime.BitSet([0,0,0,262144]),FOLLOW_114_in_primaryExpression1803:new org.antlr.runtime.BitSet([2,0]),FOLLOW_value_in_primaryExpression1809:new org.antlr.runtime.BitSet([2,0]),FOLLOW_number_in_value1823:new org.antlr.runtime.BitSet([2,0]),FOLLOW_bool_in_value1829:new org.antlr.runtime.BitSet([2,0]),FOLLOW_string_in_value1835:new org.antlr.runtime.BitSet([2,0]),FOLLOW_material_in_value1841:new org.antlr.runtime.BitSet([2,0]),FOLLOW_IDENT_in_value1846:new org.antlr.runtime.BitSet([2,0]),FOLLOW_primitive_in_value1851:new org.antlr.runtime.BitSet([2,0]),FOLLOW_array_in_value1856:new org.antlr.runtime.BitSet([2,0]),FOLLOW_anonFunctionDef_in_value1861:new org.antlr.runtime.BitSet([2,0]),FOLLOW_newObject_in_value1866:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWSTATEMENT_in_newObject1876:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_newObject1878:new org.antlr.runtime.BitSet([2,0,167772160,1179648]),FOLLOW_funCall_in_newObject1880:new org.antlr.runtime.BitSet([2,0]),FOLLOW_negnumber_in_defaultValue1906:new org.antlr.runtime.BitSet([2,0]),FOLLOW_number_in_defaultValue1912:new org.antlr.runtime.BitSet([2,0]),FOLLOW_bool_in_defaultValue1918:new org.antlr.runtime.BitSet([2,0]),FOLLOW_string_in_defaultValue1924:new org.antlr.runtime.BitSet([2,0]),FOLLOW_array_in_defaultValue1930:new org.antlr.runtime.BitSet([2,0]),FOLLOW_LARR_in_array1944:new org.antlr.runtime.BitSet([0,268435457,3473670305,131079]),FOLLOW_NEWLINE_in_array1946:new org.antlr.runtime.BitSet([0,268435457,3473670305,131079]),FOLLOW_label_in_array1950:new org.antlr.runtime.BitSet([0,1,603979776,0]),FOLLOW_NEWLINE_in_array1952:new org.antlr.runtime.BitSet([0,1,603979776,0]),FOLLOW_COMMA_in_array1956:new org.antlr.runtime.BitSet([0,268435457,3406561441,131079]),FOLLOW_NEWLINE_in_array1958:new org.antlr.runtime.BitSet([0,268435457,3406561441,131079]),FOLLOW_label_in_array1961:new org.antlr.runtime.BitSet([0,1,603979776,0]),FOLLOW_NEWLINE_in_array1963:new org.antlr.runtime.BitSet([0,1,603979776,0]),FOLLOW_NEWLINE_in_array1970:new org.antlr.runtime.BitSet([0,1,67108864,0]),FOLLOW_RARR_in_array1973:new org.antlr.runtime.BitSet([2,0]),FOLLOW_LCURL_in_array1987:new org.antlr.runtime.BitSet([0,268435457,3674996897,131079]),FOLLOW_NEWLINE_in_array1989:new org.antlr.runtime.BitSet([0,268435457,3674996897,131079]),FOLLOW_label_in_array1993:new org.antlr.runtime.BitSet([0,1,805306368,0]),FOLLOW_NEWLINE_in_array1995:new org.antlr.runtime.BitSet([0,1,805306368,0]),FOLLOW_COMMA_in_array1998:new org.antlr.runtime.BitSet([0,268435457,3406561441,131079]),FOLLOW_NEWLINE_in_array2000:new org.antlr.runtime.BitSet([0,268435457,3406561441,131079]),FOLLOW_label_in_array2003:new org.antlr.runtime.BitSet([0,1,805306368,0]),FOLLOW_NEWLINE_in_array2005:new org.antlr.runtime.BitSet([0,1,805306368,0]),FOLLOW_NEWLINE_in_array2012:new org.antlr.runtime.BitSet([0,1,268435456,0]),FOLLOW_RCURL_in_array2015:new org.antlr.runtime.BitSet([2,0]),FOLLOW_minarray_in_selector2036:new org.antlr.runtime.BitSet([2,0]),FOLLOW_dotselector_in_selector2040:new org.antlr.runtime.BitSet([2,0]),FOLLOW_LARR_in_minarray2067:new org.antlr.runtime.BitSet([0,268435456,3406561441,131079]),FOLLOW_logicalExpression_in_minarray2072:new org.antlr.runtime.BitSet([0,0,603979776,0]),FOLLOW_MULT_in_minarray2074:new org.antlr.runtime.BitSet([0,0,603979776,0]),FOLLOW_COMMA_in_minarray2078:new org.antlr.runtime.BitSet([0,268435456,3406561441,131079]),FOLLOW_logicalExpression_in_minarray2082:new org.antlr.runtime.BitSet([0,0,603979776,0]),FOLLOW_MULT_in_minarray2084:new org.antlr.runtime.BitSet([0,0,603979776,0]),FOLLOW_RARR_in_minarray2091:new org.antlr.runtime.BitSet([2,0]),FOLLOW_LCURL_in_minarray2097:new org.antlr.runtime.BitSet([0,268435456,3406561441,131079]),FOLLOW_logicalExpression_in_minarray2102:new org.antlr.runtime.BitSet([0,0,805306368,0]),FOLLOW_MULT_in_minarray2104:new org.antlr.runtime.BitSet([0,0,805306368,0]),FOLLOW_COMMA_in_minarray2108:new org.antlr.runtime.BitSet([0,268435456,3406561441,131079]),FOLLOW_logicalExpression_in_minarray2112:new org.antlr.runtime.BitSet([0,0,805306368,0]),FOLLOW_MULT_in_minarray2114:new org.antlr.runtime.BitSet([0,0,805306368,0]),FOLLOW_RCURL_in_minarray2121:new org.antlr.runtime.BitSet([2,0]),FOLLOW_116_in_dotselector2133:new org.antlr.runtime.BitSet([0,0,1074266144,0]),FOLLOW_arrayName_in_dotselector2135:new org.antlr.runtime.BitSet([2,0,0,1048576]),FOLLOW_set_in_arrayName0:new org.antlr.runtime.BitSet([2,0]),FOLLOW_arrayName_in_label2173:new org.antlr.runtime.BitSet([0,1,4194304,0]),FOLLOW_NEWLINE_in_label2175:new org.antlr.runtime.BitSet([0,1,4194304,0]),FOLLOW_COLON_in_label2178:new org.antlr.runtime.BitSet([0,268435457,3406037153,131079]),FOLLOW_NEWLINE_in_label2182:new org.antlr.runtime.BitSet([0,268435457,3406037153,131079]),FOLLOW_logicalExpression_in_label2185:new org.antlr.runtime.BitSet([2,0]),FOLLOW_set_in_number0:new org.antlr.runtime.BitSet([2,0]),FOLLOW_MINUS_in_negnumber2261:new org.antlr.runtime.BitSet([0,0,2147483648,1]),FOLLOW_number_in_negnumber2263:new org.antlr.runtime.BitSet([2,0]),FOLLOW_set_in_bool0:new org.antlr.runtime.BitSet([2,0]),FOLLOW_LCURL_in_material2415:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_additiveExpression_in_material2417:new org.antlr.runtime.BitSet([0,0,2147483680,131072]),FOLLOW_unitMultiplicativeExpression_in_material2421:new org.antlr.runtime.BitSet([0,0,268435456,0]),FOLLOW_RCURL_in_material2423:new org.antlr.runtime.BitSet([2,0]),FOLLOW_unitInnerMultiplicativeExpression_in_unitMultiplicativeExpression2460:new org.antlr.runtime.BitSet([2,0,0,8]),FOLLOW_PER_in_unitMultiplicativeExpression2464:new org.antlr.runtime.BitSet([0,0,2147483680,131072]),FOLLOW_unitInnerMultiplicativeExpression_in_unitMultiplicativeExpression2467:new org.antlr.runtime.BitSet([2,0,0,8]),FOLLOW_unitClump_in_unitInnerMultiplicativeExpression2483:new org.antlr.runtime.BitSet([2,0,1572864,0]),FOLLOW_set_in_unitInnerMultiplicativeExpression2487:new org.antlr.runtime.BitSet([0,0,2147483680,131072]),FOLLOW_unitClump_in_unitInnerMultiplicativeExpression2494:new org.antlr.runtime.BitSet([2,0,1572864,0]),FOLLOW_INTEGER_in_unitClump2510:new org.antlr.runtime.BitSet([0,0,1048576,0]),FOLLOW_DIV_in_unitClump2512:new org.antlr.runtime.BitSet([0,0,2147483680,131072]),FOLLOW_unitPowerExpression_in_unitClump2515:new org.antlr.runtime.BitSet([2,0,0,48]),FOLLOW_CUBED_in_unitClump2517:new org.antlr.runtime.BitSet([2,0,0,32]),FOLLOW_SQUARED_in_unitClump2520:new org.antlr.runtime.BitSet([2,0]),FOLLOW_unitPowerExpression_in_unitClump2543:new org.antlr.runtime.BitSet([2,0,0,48]),FOLLOW_CUBED_in_unitClump2545:new org.antlr.runtime.BitSet([2,0,0,32]),FOLLOW_SQUARED_in_unitClump2548:new org.antlr.runtime.BitSet([2,0]),FOLLOW_unit_in_unitPowerExpression2610:new org.antlr.runtime.BitSet([2,0,8388608,0]),FOLLOW_POW_in_unitPowerExpression2614:new org.antlr.runtime.BitSet([0,0,2147745792,1]),FOLLOW_MINUS_in_unitPowerExpression2617:new org.antlr.runtime.BitSet([0,0,2147483648,1]),FOLLOW_set_in_unitPowerExpression2620:new org.antlr.runtime.BitSet([2,0,8388608,0]),FOLLOW_IDENT_in_unit2638:new org.antlr.runtime.BitSet([2,0,32,0]),FOLLOW_IDENT_in_unit2641:new org.antlr.runtime.BitSet([2,0,32,0]),FOLLOW_113_in_unit2658:new org.antlr.runtime.BitSet([0,0,2147483680,131072]),FOLLOW_unitMultiplicativeExpression_in_unit2660:new org.antlr.runtime.BitSet([0,0,0,262144]),FOLLOW_114_in_unit2662:new org.antlr.runtime.BitSet([2,0]),FOLLOW_PRIMITIVE_in_primitive2731:new org.antlr.runtime.BitSet([2,0]),FOLLOW_STRING_in_string3200:new org.antlr.runtime.BitSet([2,0]),FOLLOW_assignment_in_synpred5_Formula508:new org.antlr.runtime.BitSet([2,0]),FOLLOW_logicalExpression_in_synpred6_Formula514:new org.antlr.runtime.BitSet([2,0]),FOLLOW_forLoop_in_synpred8_Formula526:new org.antlr.runtime.BitSet([2,0]),FOLLOW_forInLoop_in_synpred9_Formula532:new org.antlr.runtime.BitSet([2,0]),FOLLOW_functionDef_in_synpred11_Formula544:new org.antlr.runtime.BitSet([2,0]),FOLLOW_OR_in_synpred47_Formula1217:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_booleanXORExpression_in_synpred47_Formula1220:new org.antlr.runtime.BitSet([2,0]),FOLLOW_XOR_in_synpred48_Formula1253:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_booleanAndExpression_in_synpred48_Formula1256:new org.antlr.runtime.BitSet([2,0]),FOLLOW_AND_in_synpred49_Formula1288:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_equalityExpression_in_synpred49_Formula1291:new org.antlr.runtime.BitSet([2,0]),FOLLOW_set_in_synpred51_Formula1325:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_relationalExpression_in_synpred51_Formula1332:new org.antlr.runtime.BitSet([2,0]),FOLLOW_set_in_synpred55_Formula1378:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_additiveExpression_in_synpred55_Formula1389:new org.antlr.runtime.BitSet([2,0]),FOLLOW_set_in_synpred57_Formula1436:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_multiplicativeExpression_in_synpred57_Formula1443:new org.antlr.runtime.BitSet([2,0]),FOLLOW_set_in_synpred60_Formula1477:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_arrayExpression_in_synpred60_Formula1486:new org.antlr.runtime.BitSet([2,0]),FOLLOW_COLON_in_synpred61_Formula1538:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_negationExpression_in_synpred61_Formula1542:new org.antlr.runtime.BitSet([2,0]),FOLLOW_COLON_in_synpred62_Formula1551:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_negationExpression_in_synpred62_Formula1555:new org.antlr.runtime.BitSet([2,0]),FOLLOW_POW_in_synpred64_Formula1610:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_unaryOrNegate_in_synpred64_Formula1612:new org.antlr.runtime.BitSet([2,0]),FOLLOW_selector_in_synpred68_Formula1744:new org.antlr.runtime.BitSet([2,0]),FOLLOW_funCall_in_synpred68_Formula1746:new org.antlr.runtime.BitSet([2,0]),FOLLOW_material_in_synpred75_Formula1841:new org.antlr.runtime.BitSet([2,0]),FOLLOW_array_in_synpred78_Formula1856:new org.antlr.runtime.BitSet([2,0]),FOLLOW_funCall_in_synpred80_Formula1880:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred85_Formula1946:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred86_Formula1952:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred87_Formula1958:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred88_Formula1963:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred93_Formula1989:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred94_Formula1995:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred95_Formula2000:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred96_Formula2005:new org.antlr.runtime.BitSet([2,0]),FOLLOW_116_in_synpred108_Formula2133:new org.antlr.runtime.BitSet([0,0,1074266144,0]),FOLLOW_arrayName_in_synpred108_Formula2135:new org.antlr.runtime.BitSet([2,0]),FOLLOW_arrayName_in_synpred112_Formula2173:new org.antlr.runtime.BitSet([0,1,4194304,0]),FOLLOW_NEWLINE_in_synpred112_Formula2175:new org.antlr.runtime.BitSet([0,1,4194304,0]),FOLLOW_COLON_in_synpred112_Formula2178:new org.antlr.runtime.BitSet([2,0])})})();org.antlr.runtime.BaseRecognizer.prototype.emitErrorMessage=()=>{};function bootCalc(te){te.varBank=Object.create(null),te.varBank["-parent"]=null,te.varBank.e=new Material(2.718281828459045),te.varBank.pi=new Material(3.141592653589793),te.varBank.phi=new Material(1.61803399),createFunctions(te),createFunctions$1(te)}class PrimitiveStore{constructor(ee,re){this.primitive=ee,this.type=re}}function toNum(te){return te instanceof Material||te instanceof SPrimitive||te instanceof Vector||te instanceof UserFunction||te instanceof SPopulation?te.toNum():te instanceof Function?te([]):te.valueOf()}class UserFunction{constructor(){this.localScope=void 0,this.defaults=void 0,this.fn=void 0}toNum(){return this.fn([])}}let StringObject={},VectorObject={};function createTree(te){let ee=new org.antlr.runtime.ANTLRStringStream(te.replace(/\\n/g,`
`)),re=new FormulaLexer(ee),ne=new org.antlr.runtime.CommonTokenStream(re),ie=new FormulaParser(ne),se=ie.lines();return convertToObject(se.tree,ie)}function trimTree(te,ee,re){return trimNode(te,ee,re)}function evaluateTree(te,ee,re){re.evaluatingLine=void 0;try{return evaluateNode(te,ee,re)}catch(ne){if(ne.returnVal)return ne.data;throw ne}}class TreeNode{constructor(ee,re,ne,ie=[]){this.origText=ee,this.text=ee.toLowerCase(),this.typeName=re,this.line=ne,this.children=ie,this.functionFingerprint=null,this.delayEvalParams=null}cloneStructure(){let ee=new TreeNode(this.origText,this.typeName,this.line);return ee.children=this.children.map(re=>{if(re instanceof TreeNode)return re.cloneStructure();throw console.error(this,re),new TypeError("Unknown structure clone type")}),ee}}function convertToObject(te,ee){let re=te.getToken();if(!re)throw new ModelError("Invalid syntax.",{code:7e3});let ne=new TreeNode(re.getText(),ee.getTokenNames()[re.getType()],re.line);if(te.getChildCount()>0){let ie=te.getChildren();for(let se=0;se<ie.length;se++)ne.children.push(convertToObject(ie[se],ee)),!ne.line&&ne.children[ne.children.length-1].line&&(ne.line=ne.children[ne.children.length-1].line)}return ne}let funcEvalMap=Object.create(null);funcEvalMap.LINES=function(te,ee,re){if(!te.children.length)return new Material(0);let ne;for(let ie of te.children){if(ie.text==="return")throw{returnVal:!0,data:evaluateNode(ie.children[0],ee,re)};ne=evaluateNode(ie,ee,re)}return ne};funcEvalMap.NEGATE=function(te,ee,re){return negate(toNum(evaluateNode(te.children[0],ee,re)))};function negate(te){if(te instanceof Vector)return te.cloneApply(negate);if(te instanceof Material)return new Material(fn["-"](te.value),te.units);throw typeof te=="boolean"?new ModelError("Cannot convert Booleans to Numbers.",{code:7001}):te instanceof String||typeof te=="string"?new ModelError("Cannot convert Strings to Numbers.",{code:7002}):te instanceof SAgent?new ModelError("Cannot convert Agents to Numbers.",{code:7003}):new ModelError("Invalid type - negate",{code:7004})}funcEvalMap.AND=function(te,ee,re){return funAnd(toNum(evaluateNode(te.children[0],ee,re)),toNum(evaluateNode(te.children[1],ee,re)))};function funAnd(te,ee){return te instanceof Vector?te.cloneCombine(ee,funAnd,!1):ee instanceof Vector?ee.cloneCombine(te,funAnd,!0):trueValue(te)&&trueValue(ee)}funcEvalMap.OR=function(te,ee,re){return funOr(toNum(evaluateNode(te.children[0],ee,re)),toNum(evaluateNode(te.children[1],ee,re)))};function funOr(te,ee){return te instanceof Vector?te.cloneCombine(ee,funOr,!1):ee instanceof Vector?ee.cloneCombine(te,funOr,!0):trueValue(te)||trueValue(ee)}funcEvalMap.XOR=function(te,ee,re){return funXor(toNum(evaluateNode(te.children[0],ee,re)),toNum(evaluateNode(te.children[1],ee,re)))};function funXor(te,ee){return te instanceof Vector?te.cloneCombine(ee,funXor,!1):ee instanceof Vector?ee.cloneCombine(te,funXor,!0):(trueValue(te)||trueValue(ee))&&!(trueValue(te)&&trueValue(ee))}funcEvalMap.NOT=function(te,ee,re){return fNot(toNum(evaluateNode(te.children[0],ee,re)))};function fNot(te){return te instanceof Vector?te.cloneApply(fNot):!trueValue(te)}funcEvalMap.NOTEQUALS=function(te,ee,re){return neq(toNum(evaluateNode(te.children[0],ee,re)),toNum(evaluateNode(te.children[1],ee,re)))};function neq(te,ee){if(typeof te=="boolean"&&!(ee instanceof Vector)||typeof ee=="boolean"&&!(te instanceof Vector))return trueValue(te)!==trueValue(ee);if((te instanceof String||typeof te=="string")&&!(ee instanceof Vector)||(ee instanceof String||typeof ee=="string")&&!(te instanceof Vector))return(""+te).toLowerCase()!==(""+ee).toLowerCase();if(te instanceof Vector)return te.cloneCombine(ee,neq,!1);if(ee instanceof Vector)return ee.cloneCombine(te,neq,!0);if(!(te instanceof Material)||!(ee instanceof Material))return te!==ee;if(te.units!==ee.units){let re=convertUnits(ee.units,te.units);if(re===0)return!0;ee.value=fn["*"](ee.value,re),ee.units=te.units}return!fn["="](te.value,ee.value)}funcEvalMap.EQUALS=function(te,ee,re){return eq(toNum(evaluateNode(te.children[0],ee,re)),toNum(evaluateNode(te.children[1],ee,re)))};function eq(te,ee){if(typeof te=="boolean"&&!(ee instanceof Vector)||typeof ee=="boolean"&&!(te instanceof Vector))return trueValue(te)===trueValue(ee);if((typeof te=="string"||te instanceof String)&&!(ee instanceof Vector)||(typeof ee=="string"||ee instanceof String)&&!(te instanceof Vector))return(""+te).toLowerCase()===(""+ee).toLowerCase();if(te instanceof Vector)return te.cloneCombine(ee,eq,!1);if(ee instanceof Vector)return ee.cloneCombine(te,eq,!0);if(!(te instanceof Material)||!(ee instanceof Material))return te===ee;if(te.units!==ee.units){let re=convertUnits(ee.units,te.units);if(re===0)return!1;ee.value=fn["*"](ee.value,re),ee.units=te.units}return fn["="](te.value,ee.value)}function comparisonValid(te,ee){if(te instanceof String||typeof te=="string"||ee instanceof String||typeof ee=="string")throw new ModelError("Cannot use Strings in logical inequality comparisons.",{code:7005});if(te instanceof Boolean||typeof te=="boolean"||ee instanceof Boolean||typeof ee=="boolean")throw new ModelError("Cannot use Booleans in logical inequality comparisons.",{code:7006});if(te instanceof SAgent||ee instanceof SAgent)throw new ModelError("Cannot use Agents in logical inequality comparisons.",{code:7007})}funcEvalMap.LT=function(te,ee,re){return lessThan(toNum(evaluateNode(te.children[0],ee,re)),toNum(evaluateNode(te.children[1],ee,re)))};function lessThan(te,ee){if(comparisonValid(te,ee),te instanceof Vector)return te.cloneCombine(ee,lessThan,!1);if(ee instanceof Vector)return ee.cloneCombine(te,lessThan,!0);if(te instanceof Material&&ee instanceof Material){if(te.units!==ee.units){let re=convertUnits(ee.units,te.units);re===0?unitAlert(te.units,ee.units,"comparison"):(ee.value=fn["*"](ee.value,re),ee.units=te.units)}return fn["<"](te.value,ee.value)}throw new ModelError("Invalid type - lessThan",{code:7008})}funcEvalMap.LTEQ=function(te,ee,re){return lessThanEq(toNum(evaluateNode(te.children[0],ee,re)),toNum(evaluateNode(te.children[1],ee,re)))};function lessThanEq(te,ee){if(comparisonValid(te,ee),te instanceof Vector)return te.cloneCombine(ee,lessThanEq,!1);if(ee instanceof Vector)return ee.cloneCombine(te,lessThanEq,!0);if(te instanceof Material&&ee instanceof Material){if(te.units!==ee.units){let re=convertUnits(ee.units,te.units);re===0?unitAlert(te.units,ee.units,"comparison"):(ee.value=fn["*"](ee.value,re),ee.units=te.units)}return fn["<="](te.value,ee.value)}throw new ModelError("Invalid type - lessThanEq",{code:7009})}funcEvalMap.GT=function(te,ee,re){return greaterThan(toNum(evaluateNode(te.children[0],ee,re)),toNum(evaluateNode(te.children[1],ee,re)))};function greaterThan(te,ee){if(comparisonValid(te,ee),te instanceof Vector)return te.cloneCombine(ee,greaterThan,!1);if(ee instanceof Vector)return ee.cloneCombine(te,greaterThan,!0);if(te instanceof Material&&ee instanceof Material){if(te.units!==ee.units){let re=convertUnits(ee.units,te.units);re===0?unitAlert(te.units,ee.units,"comparison"):(ee.value=fn["*"](ee.value,re),ee.units=te.units)}return fn[">"](te.value,ee.value)}throw new ModelError("Invalid type - greaterThan",{code:7010})}funcEvalMap.GTEQ=function(te,ee,re){return greaterThanEq(toNum(evaluateNode(te.children[0],ee,re)),toNum(evaluateNode(te.children[1],ee,re)))};function greaterThanEq(te,ee){if(comparisonValid(te,ee),te instanceof Vector)return te.cloneCombine(ee,greaterThanEq,!1);if(ee instanceof Vector)return ee.cloneCombine(te,greaterThanEq,!0);if(te instanceof Material&&ee instanceof Material){if(te.units!==ee.units){let re=convertUnits(ee.units,te.units);re===0?unitAlert(te.units,ee.units,"comparison"):(ee.value=fn["*"](ee.value,re),ee.units=te.units)}return fn[">="](te.value,ee.value)}throw new ModelError("Invalid type - greaterThanEq",{code:7011})}funcEvalMap.PLUS=function(te,ee,re){return plus(toNum(evaluateNode(te.children[0],ee,re)),toNum(evaluateNode(te.children[1],ee,re)))};function plus(te,ee){if(te instanceof Vector)return te.cloneCombine(ee,plus,!1);if(ee instanceof Vector)return ee.cloneCombine(te,plus,!0);if(te instanceof Material&&ee instanceof Material){if(te.units!==ee.units){let re=convertUnits(ee.units,te.units);re===0?unitAlert(te.units,ee.units,"addition"):(ee.value=fn["*"](ee.value,re),ee.units=te.units)}return new Material(fn["+"](te.value,ee.value),ee.units)}if(typeof te=="boolean"||typeof ee=="boolean")throw new ModelError("Cannot convert Booleans to Numbers.",{code:7012});if(te instanceof SAgent||ee instanceof SAgent)throw new ModelError("Cannot convert Agents to Numbers.",{code:7013});if(typeof te=="string"||te instanceof String||typeof ee=="string"||ee instanceof String)return te.toString()+ee.toString();throw new ModelError("Invalid type - plus",{code:7014})}funcEvalMap.MINUS=function(te,ee,re){return minus(toNum(evaluateNode(te.children[0],ee,re)),toNum(evaluateNode(te.children[1],ee,re)))};function minus(te,ee){if(te instanceof Vector)return te.cloneCombine(ee,minus,!1);if(ee instanceof Vector)return ee.cloneCombine(te,minus,!0);if(te instanceof Material&&ee instanceof Material){if(te.units!==ee.units){let re=convertUnits(ee.units,te.units);re===0?unitAlert(te.units,ee.units,"subtraction"):(ee.value=fn["*"](ee.value,re),ee.units=te.units)}return new Material(fn["-"](te.value,ee.value),ee.units)}throw typeof te=="boolean"||typeof ee=="boolean"?new ModelError("Cannot convert Booleans to Numbers.",{code:7015}):te instanceof SAgent||ee instanceof SAgent?new ModelError("Cannot convert Agents to Numbers.",{code:7016}):typeof te=="string"||te instanceof String||typeof ee=="string"||ee instanceof String?new ModelError("Cannot convert Strings to Numbers.",{code:7017}):new ModelError("Invalid type - minus",{code:7018})}funcEvalMap.MULT=function(te,ee,re){return mult(toNum(evaluateNode(te.children[0],ee,re)),toNum(evaluateNode(te.children[1],ee,re)))};function mult(te,ee){if(te instanceof Vector)return te.cloneCombine(ee,mult,!1);if(ee instanceof Vector)return ee.cloneCombine(te,mult,!0);if(te instanceof Material&&ee instanceof Material){let re=fn["*"](te.value,ee.value);return te.units&&ee.units?(te.units.addBase(),ee.units.addBase(),new Material(fn["*"](fn["*"](te.units.toBase,re),ee.units.toBase),te.units.multiply(ee.units,1))):te.units?new Material(re,te.units):ee.units?new Material(re,ee.units):new Material(re)}throw typeof te=="boolean"||typeof ee=="boolean"?new ModelError("Cannot convert Booleans to Numbers.",{code:7019}):te instanceof SAgent||ee instanceof SAgent?new ModelError("Cannot convert Agents to Numbers.",{code:7020}):typeof te=="string"||te instanceof String||typeof ee=="string"||ee instanceof String?new ModelError("Cannot convert Strings to Numbers.",{code:7021}):new ModelError("Invalid type - mult",{code:7022})}funcEvalMap.DIV=function(te,ee,re){return div(toNum(evaluateNode(te.children[0],ee,re)),toNum(evaluateNode(te.children[1],ee,re)))};function div(te,ee){if(te instanceof Vector)return te.cloneCombine(ee,div,!1);if(ee instanceof Vector)return ee.cloneCombine(te,div,!0);if(te instanceof Material&&ee instanceof Material){let re=fn["/"](te.value,ee.value);return te.units&&ee.units?(te.units.addBase(),ee.units.addBase(),new Material(fn["/"](fn["*"](te.units.toBase,re),ee.units.toBase),te.units.multiply(ee.units,-1))):te.units?new Material(re,te.units):ee.units?new Material(re,ee.units.power(-1)):new Material(re)}throw typeof te=="boolean"||typeof ee=="boolean"?new ModelError("Cannot convert Booleans to Numbers.",{code:7023}):te instanceof SAgent||ee instanceof SAgent?new ModelError("Cannot convert Agents to Numbers.",{code:7024}):typeof te=="string"||te instanceof String||typeof ee=="string"||ee instanceof String?new ModelError("Cannot convert Strings to Numbers.",{code:7025}):new ModelError("Invalid type - div",{code:7026})}funcEvalMap.POWER=function(te,ee,re){if(te.children.length===1)return evaluateNode(te.children[0],ee,re);let ne=toNum(evaluateNode(te.children[te.children.length-1],ee,re));for(let ie=te.children.length-1;ie>0;ie--){let se=toNum(evaluateNode(te.children[ie-1],ee,re));if(ne instanceof Vector||!ne.units)ne=power(se,ne);else throw new ModelError("Exponents may not have units.",{code:7027})}return ne};function power(te,ee){if(te instanceof Vector)return te.cloneCombine(ee,power,!1);if(ee instanceof Vector)return ee.cloneCombine(te,power,!0);if(te instanceof Material&&ee instanceof Material){let re=te.value,ne=ee.value;if(re<0&&ne!==Math.round(ne))throw new ModelError(`Cannot take a negative number (${re}) to a fractional power (${ne}).`,{code:7028});return new Material(fn.expt(re,ne),te.units?te.units.power(ne):void 0)}throw typeof te=="boolean"||typeof ee=="boolean"?new ModelError("Cannot convert Booleans to Numbers.",{code:7029}):te instanceof SAgent||ee instanceof SAgent?new ModelError("Cannot convert Agents to Numbers.",{code:7030}):typeof te=="string"||te instanceof String||typeof ee=="string"||ee instanceof String?new ModelError("Cannot convert Strings to Numbers.",{code:7031}):new ModelError("Invalid type - power",{code:7032})}funcEvalMap.MOD=function(te,ee,re){return doMod(toNum(evaluateNode(te.children[0],ee,re)),toNum(evaluateNode(te.children[1],ee,re)))};function doMod(te,ee){if(te instanceof Vector)return te.cloneCombine(ee,doMod,!1);if(ee instanceof Vector)return ee.cloneCombine(te,doMod,!0);if(te instanceof Material&&ee instanceof Material){if(ee.units)throw new ModelError('The right hand side of "mod" may not have units.',{code:7033});return new Material(fn.mod(te.value,ee.value),te.units)}throw typeof te=="boolean"||typeof ee=="boolean"?new ModelError("Cannot convert Booleans to Numbers.",{code:7034}):te instanceof SAgent||ee instanceof SAgent?new ModelError("Cannot convert Agents to Numbers.",{code:7035}):typeof te=="string"||te instanceof String||typeof ee=="string"||ee instanceof String?new ModelError("Cannot convert Strings to Numbers.",{code:7036}):new ModelError("Invalid type - mod",{code:7037})}funcEvalMap.IDENT=function(te,ee,re){let ne=te.text;for(;!(ne in ee);)if(ee["-parent"])ee=ee["-parent"];else throw new ModelError(`The variable or function "${te.origText}" does not exist.`,{code:7038});let ie=ee[ne];return ie instanceof TreeNode&&ie.typeName==="ARRAY"&&(ie=evaluateNode(ie,ee,re)),ie.fullClone&&!(ie instanceof Vector)?ie.fullClone():ie};funcEvalMap.NEW=function(te,ee,re){let ne=evaluateNode(te.children[0],ee,re);if(ne instanceof Vector){let ie=new Vector([],re,void 0,ne),se,le;try{le=selectFromVector(ne,re,"constructor"),se=le.data}catch{}if(se)te.children.length===2?callFunction(se,te.children[1],re,ee,ie,le.parent):callFunction(se,{children:[]},re,ee,ie,le.parent);else if(te.children.length===2&&te.children[1].children.length>0)throw new ModelError(`No constructor available for '${te.children[0].text}'.`,{code:7039});return ie}else throw new ModelError("'New' can only be use to create instances of Vectors.",{code:7040})};funcEvalMap.INNER=function(te,ee,re){let ne=evaluateNode(te.children[0],ee,re);if(te.children.length===2&&te.children[1].typeName==="FUNCALL")return callFunction(ne,te.children[1],re,ee);let ie,se;ee.self&&te.children[0].text==="parent"?ie=ee.self:ne instanceof Function||ne instanceof UserFunction||(ie=ne);for(let le=1;le<te.children.length;le++)if(te.children[le].typeName==="SELECTOR")if(te.children[le].children[0].typeName==="DOTSELECTOR")for(let ue=0;ue<te.children[le].children[0].children.length;ue++){let ae=[];te.children[le].children[0].children[ue].text?ae.push(te.children[le].children[0].children[ue].text):ae.push(te.children[le].children[0].children[ue].valueOf());try{ne=selectFromMatrix(ne,re,ae)}catch(oe){if(ne instanceof SPrimitive&&!(ne instanceof SAgent))ne=toNum(ne),ue--;else throw oe}ne instanceof Function||ne instanceof UserFunction||(ie=ne,se=ne)}else{ne instanceof SPrimitive&&(ne=toNum(ne),ne instanceof Function||ne instanceof UserFunction||(ie=ne,se=ne));try{ne=selectFromMatrix(ne,re,createMatrixSelector(te.children[le],ee,0,re))}catch(ue){if(ne instanceof SPrimitive)ne=toNum(ne),le--;else throw ue}ne instanceof Function||ne instanceof UserFunction||(ie=ne,se=ne)}else ne=callFunction(ne,te.children[le],re,ee,ie,se),ne instanceof Function||ne instanceof UserFunction||(ie=ne,se=ne);return ne};let fingerprintCounter=0;function callFunction(te,ee,re,ne,ie,se){if(typeof te!="function"&&!(te instanceof UserFunction))throw new ModelError("Trying to call a non-function.",{code:7041});let le=[],ue="";if(ee instanceof Array)le=ee;else if(ee.functionFingerprint||(ee.functionFingerprint="FINGERPRINT-"+fingerprintCounter++),ue=ee.functionFingerprint,te.delayEvalParams)for(let he=0;he<ee.children.length;he++)le.push({node:ee.children[he],scope:ne});else for(let he=0;he<ee.children.length;he++){let pe=evaluateNode(ee.children[he],ne,re);pe.fullClone&&!(pe instanceof Vector)&&(pe=pe.fullClone()),le.push(pe)}let ae;te.fn?ae=te.fn:(ee.delayEvalParams=te.delayEvalParams,ae=te);let oe=re.evaluatingLine,ce=ae(le,ue,ie,se);return re.evaluatingLine=oe,ce}function createMatrixSelector(te,ee,re,ne){let ie=[];re=re||0;for(let se=re;se<te.children.length;se++)if(te.children[se].typeName==="MULT")ie.push("*");else{let ue=evaluateNode(te.children[se],ee,ne);if(typeof ue=="function"||ue instanceof UserFunction){let ae;typeof ue=="function"?ae=ue:ae=ue.fn,function(oe){ie.push(ce=>{if(!ce[0].stackApply)throw new ModelError("Can't apply function across elements of non-vector.",{code:7042});return ce[0].stackApply(he=>oe([he]))})}(ae)}else ie.push(toNum(ue))}return ie}funcEvalMap.ARRAY=function(te,ee,re){if(te.children.length===1&&te.children[0]instanceof Vector)return te.children[0].fullClone();let ne=[],ie=[],se=!1;for(let le=0;le<te.children.length;le++)ne.push(evaluateNode(te.children[le].children[0],ee,re)),te.children[le].children.length>1?(te.children[le].children[1].text?ie.push(te.children[le].children[1].origText):ie.push(te.children[le].children[1].valueOf()),se=!0):ie.push(void 0);return new Vector(ne,re,se?ie:void 0)};funcEvalMap.RANGE=function(te,ee,re){if(te.children.length===1)return evaluateNode(te.children[0],ee,re);let ne=[],ie=toNum(evaluateNode(te.children[0],ee,re)),se=toNum(evaluateNode(te.children[te.children.length-1],ee,re));if(!(ie instanceof Material)||!(se instanceof Material))throw new ModelError("Range elements must be numbers.",{code:7043});if(ne.push(ie.fullClone()),ie.units!==se.units&&convertUnits(ie.units,se.units)!==1)throw new ModelError("Units on both sides of ':' must be equal.",{code:7044});let le=te.children.length===2?new Material(1,ie.units):toNum(evaluateNode(te.children[1],ee,re));if(!(le instanceof Material))throw new ModelError("Range elements must be numbers.",{code:7045});if(!eq(ie,se)){if(lessThan(ie,se)){let ue=plus(ie,le);for(;lessThanEq(ue,se);)ne.push(ue),ue=plus(ue,le)}else if(greaterThan(ie,se)){te.children.length===2&&(le=negate(le));let ue=plus(ie,le);for(;greaterThanEq(ue,se);)ne.push(ue),ue=plus(ue,le)}}return new Vector(ne,re)};function makeFunctionCall(te,ee,re,ne,ie,se){let le=new UserFunction;le.localScope={},le.localScope.nVars=ee.length;for(let ue=0;ue<ee.length;ue++)le.localScope[ue+""]=ee[ue];return le.localScope["-parent"]=ie,le.defaults=re,le.fn=function(ue,ae,oe,ce){let he=ue.length;for(let de=0;de<ue.length;de++)ue[de].optional&&he--;if(le.localScope.nVars-le.defaults.length>ue.length||he>le.localScope.nVars){let de=[];for(let me=0;me<le.localScope.nVars;me++)le.defaults.length-(le.localScope.nVars-me)>-1?de.push(le.localScope[me+""]+"="+le.defaults[le.defaults.length-(le.localScope.nVars-me)]):de.push(le.localScope[me+""]);throw new ModelError("Wrong number of parameters for "+te+"("+de.join(", ")+").",{code:7049})}let pe={"-parent":ie};for(let de=0;de<ue.length;de++)pe[le.localScope[de+""]]=ue[de];for(let de=ue.length;de<le.localScope.nVars;de++)pe[le.localScope[de+""]]=le.defaults[le.defaults.length-(le.localScope.nVars-de)];oe&&(pe.self||(pe.self=oe)),ce&&ce.parent&&(pe.parent=ce.parent);try{return evaluateNode(ne,pe,se)}catch(de){if(de.returnVal)return de.data;throw de}},le}funcEvalMap.THROW=function(te,ee,re){throw new ModelError(evaluateNode(te.children[0],ee,re),{code:1e4})};funcEvalMap.TRYCATCH=function(te,ee,re){try{return evaluateNode(te.children[0],ee,re)}catch(ne){let ie={"-parent":ee};return ne instanceof ModelError?ie[te.children[2].text]=stringify(ne.message,re):ie[te.children[2].text]=stringify("An error has occurred.",re),evaluateNode(te.children[1],ie,re)}};funcEvalMap.WHILE=function(te,ee,re){let ne=new Material(0),ie={"-parent":ee};for(;trueValue(toNum(evaluateNode(te.children[0],ee,re)));)ne=evaluateNode(te.children[1],ie,re);return ne};funcEvalMap.IFTHENELSE=function(te,ee,re){let ne={"-parent":ee},ie;for(ie=0;ie<te.children[0].children.length;ie++)if(trueValue(toNum(evaluateNode(te.children[0].children[ie],ee,re))))return evaluateNode(te.children[1].children[ie],ne,re);return te.children[0].children.length!==te.children[1].children.length?evaluateNode(te.children[1].children[ie],ne,re):new Material(0)};funcEvalMap.FORIN=function(te,ee,re){let ne=new Material(0),ie=te.children[0].text,se={"-parent":ee},le=evaluateNode(te.children[1],ee,re);if(!(le instanceof Vector))throw new ModelError("The in argument of a For-In loop must be a vector.",{code:7050});for(let ue=0;ue<le.items.length;ue++)se[ie]=le.items[ue],ne=evaluateNode(te.children[2],se,re);return ne};funcEvalMap.FOR=function(te,ee,re){let ne=new Material(0),ie=te.children[0].text,se=toNum(evaluateNode(te.children[1].children[0],ee,re)),le=new Material(1);te.children[1].children.length===3&&(le=toNum(evaluateNode(te.children[1].children[2],ee,re)));let ue={"-parent":ee};for(ue[ie]=se;fn[le.value>=0?"<=":">="](ue[ie].value,toNum(evaluateNode(te.children[1].children[1],ee,re)));)ne=evaluateNode(te.children[2],ue,re),ue[ie]=plus(ue[ie],le);return ne};funcEvalMap.FUNCTION=function(te,ee,re){let ne=te.children[0].children[0].text;return functionGenerator(ne,te.children[0],te.children[1],te.children[2],ee,re),`"${ne}" defined`};funcEvalMap.ANONFUNCTION=function(te,ee,re){return functionGenerator(null,te.children[0],te.children[1],te.children[2],ee,re)};funcEvalMap.ASSIGN=function(te,ee,re){let ne=te.children.length-1,ie=evaluateNode(te.children[te.children.length-1],ee,re);if(ne>1&&(!(ie instanceof Vector)||ie.items.length<ne))throw new ModelError("Too few elements returned for assignment.",{code:7051});for(let se=0;se<ne;se++)if(te.children[se]instanceof PrimitiveStore)ne===1?te.children[se].primitive.setValue(ie):te.children[se].primitive.setValue(ie.items[se]);else{let le=te.children[se].children[0].text,ue;te.children[se].children.length>1&&(ue=createSelector(te.children[se].children[1],ee,re));let ae=ee;for(;ee["-parent"]!==null&&ee[le]===void 0;)ee=ee["-parent"];ee["-parent"]===null&&ee[le]===void 0&&(ee=ae);let oe;if(ne===1?oe=ie:oe=ie.items[se],te.children[se].children.length===1)ee[le]=oe;else if(ee[le]!==void 0)selectFromMatrix(ee[le],re,ue,oe);else throw new ModelError(`The variable '${te.children[se].children[0].origText}' does not exist.`,{code:7052})}return ne>1?new Vector(ie.items.slice(0,ne),re):ie};function createSelector(te,ee,re){if(te.children[0].typeName==="DOTSELECTOR"){let ne=[];for(let ie=0;ie<te.children[0].children.length;ie++)te.children[0].children[ie].text?ne.push(te.children[0].children[ie].text):ne.push(te.children[0].children[ie].valueOf());return ne}else return createMatrixSelector(te,ee,0,re)}funcEvalMap.MATERIAL=function(te,ee,re){let ne=toNum(evaluateNode(te.children[0],ee,re));if(ne.units)throw new ModelError("Cannot create material where numeric part itself has units.",{code:7053});return new Material(ne.value,te.children[1])};function functionGenerator(te,ee,re,ne,ie,se){let le=[],ue=[];for(let ae=te===null?0:1;ae<ee.children.length;ae++)le.push(ee.children[ae].text);for(let ae=0;ae<re.children.length;ae++)ue.push(re.children[ae]);if(te===null)return makeFunctionCall("Function",le,ue,ne,ie,se);ie[te]=makeFunctionCall(te,le,ue,ne,ie,se)}let unitEvalMap=Object.create(null);unitEvalMap.MULT=function(te){return evaluateUnits(te.children[0]).concat(evaluateUnits(te.children[1]))};unitEvalMap.POW=function(te){let ee=1,re=1,ne=0;te.children.length===3+ne&&(ee=ee*-1,re++);let ie=evaluateUnits(te.children[ne]),se=evaluateUnits(te.children[re])*ee;if(ie instanceof Array){for(let le=0;le<ie.length;le++)ie[le].exponent=ie[le].exponent*se;return ie}else return Math.pow(ie,se)};unitEvalMap.DIV=function(te){let ee=evaluateUnits(te.children[0]),re=evaluateUnits(te.children[1]);for(let ne=0;ne<re.length;ne++)re[ne].exponent=re[ne].exponent*-1;return ee.concat(re)};unitEvalMap.PER=unitEvalMap.DIV;unitEvalMap.UNIT=function(te){let ee="";for(let re=0;re<te.children.length;re++)ee=ee+te.children[re].text,re<te.children.length-1&&(ee=ee+" ");return[{id:ee,exponent:1}]};unitEvalMap.UNITCLUMP=function(te){let ee=evaluateUnits(te.children[0]);if(te.children.length>1){for(let re=1;re<te.children.length;re++)if(te.children[re].typeName==="NEGATE")for(let ne=0;ne<ee.length;ne++)ee[ne].exponent=ee[ne].exponent*-1;else if(te.children[re].typeName==="SQUARED")for(let ne=0;ne<ee.length;ne++)ee[ne].exponent=ee[ne].exponent*2;else if(te.children[re].typeName==="CUBED")for(let ne=0;ne<ee.length;ne++)ee[ne].exponent=ee[ne].exponent*3}return ee};unitEvalMap.INTEGER=function(te){return parseInt(te.text,10)};unitEvalMap.FLOAT=function(te){return parseFloat(te.text)};function evaluateUnits(te){return te instanceof Material?te.value:unitEvalMap[te.typeName](te)}function evaluateNode(te,ee,re){if(te instanceof TreeNode)return re.evaluatingLine=te.line||re.evaluatingLine,funcEvalMap[te.typeName](te,ee,re);if(te instanceof PrimitiveStore){if(te.type==="totalValue"){if(!te.primitive.totalContents)throw new ModelError("You can only use the double-bracket notation for total conveyor contents on Stock primitives.",{code:7054});return te.primitive.totalContents()}else if(te.type==="object")return te.primitive}else return te}let trimEvalMap=Object.create(null);trimEvalMap.POWER=function(te,ee,re){if(te.children.length===1)return trimNode(te.children[0],ee,re);{let ne=new TreeNode(te.origText,te.typeName,te.line);for(let ie=0;ie<te.children.length;ie++)ne.children.push(trimNode(te.children[ie],ee,re));return ne}};trimEvalMap.INNER=function(te,ee,re){if(te.children.length===1)return trimNode(te.children[0],ee,re);{let ne=new TreeNode(te.origText,te.typeName,te.line);for(let ie=0;ie<te.children.length;ie++)ne.children.push(trimNode(te.children[ie],ee,re));return ne}};trimEvalMap.RANGE=trimEvalMap.POWER;trimEvalMap.TRUE=function(){return!0};trimEvalMap.FALSE=function(){return!1};trimEvalMap.STRING=function(te,ee,re){let ne=te.origText.substr(1,te.origText.length-2),ie;return te.origText[0]==='"'?ie=ne.replace(/\\\\/g,"\\\\TEMPTXT\\\\").replace(/\\"/g,'"').replace(/\\'/g,"'").replace(/\\t/g,"	").replace(/\\b/g,"\b").replace(/\\f/g,"\f").replace(/\\n/g,`
`).replace(/\\r/g,"\r").replace(/\\\\TEMPTXT\\\\/g,"\\"):ie=ne.replace(/\n/,"\\n"),ie=new String(ie),ie.vector=new Vector([],re,[],re.varBank.stringbase),ie};trimEvalMap.INTEGER=function(te){return new Material(+te.text)};trimEvalMap.MATERIAL=function(te,ee,re){let ne=trimNode(te.children[1],ee,re),ie=evaluateUnits(te.children[0]),se=[],le=[];for(let ue=0;ue<ie.length;ue++){let ae=le.indexOf(ie[ue].id);ae===-1?(se.push(ie[ue].exponent),le.push(ie[ue].id)):se[ae]=se[ae]+ie[ue].exponent}if(ne instanceof Material){if(ne.units)throw new ModelError("Cannot create material where numeric part itself has units.",{code:7055});return new Material(ne.value,re.unitManager.getUnitStore(le,se,!0))}else{let ue=new TreeNode(te.origText,"MATERIAL",te.line);return ue.children=[ne,re.unitManager.getUnitStore(le,se,!0)],ue}};trimEvalMap.MULT=function(te,ee,re){if(!te.children.length)return"*";let ne=trimNode(te.children[0],ee,re),ie=trimNode(te.children[1],ee,re);if(isConst(ne)&&isConst(ie))return mult(ne,ie);{let se=new TreeNode(te.origText,te.typeName,te.line);return se.children=[ne,ie],se}};trimEvalMap.DIV=function(te,ee,re){let ne=trimNode(te.children[0],ee,re),ie=trimNode(te.children[1],ee,re);if(isConst(ne)&&isConst(ie))return div(ne,ie);{let se=new TreeNode(te.origText,te.typeName,te.line);return se.children=[ne,ie],se}};trimEvalMap.PLUS=function(te,ee,re){let ne=trimNode(te.children[0],ee,re),ie=trimNode(te.children[1],ee,re);if(isConst(ne)&&isConst(ie))return plus(ne,ie);{let se=new TreeNode(te.origText,te.typeName,te.line);return se.children=[ne,ie],se}};trimEvalMap.MINUS=function(te,ee,re){let ne=trimNode(te.children[0],ee,re),ie=trimNode(te.children[1],ee,re);if(isConst(ne)&&isConst(ie))return minus(ne,ie);{let se=new TreeNode(te.origText,te.typeName,te.line);return se.children=[ne,ie],se}};trimEvalMap.FLOAT=trimEvalMap.INTEGER;trimEvalMap.PRIMITIVE=function(te,ee){let re;if(te.text.substr(0,2)==="[["?re=new PrimitiveStore(ee[te.text.substr(2,te.text.length-4)],"totalValue"):re=new PrimitiveStore(ee[te.text.substr(1,te.text.length-2)],"object"),re.primitive===void 0)throw new ModelError(`The primitive <i>${toHTML(te.origText)}</i> could not be found.`,{code:7056});return re};trimEvalMap.NEGATE=function(te,ee,re){if(!te.children.length)return new TreeNode(te.origText,te.typeName,te.line);let ne=trimNode(te.children[0],ee,re);if(isConst(ne))return negate(ne);{let ie=new TreeNode(te.origText,te.typeName,te.line);return ie.children=[ne],ie}};trimEvalMap.ARRAY=function(te,ee,re){let ne=new TreeNode(te.origText,te.typeName,te.line),ie=[],se=[],le=!1;for(let ae=0;ae<te.children.length;ae++)ne.children.push(trimNode(te.children[ae],ee,re)),ie.push(ne.children[ae].children[0]),ne.children[ae].children.length>1?(ne.children[ae].children[1].text?se.push(ne.children[ae].children[1].origText):se.push(ne.children[ae].children[1].valueOf()),le=!0):se.push(void 0);let ue=!0;for(let ae=0;ae<ie.length;ae++)if(!isConst(ie[ae])){ue=!1;break}return ue&&(ne.children=[new Vector(ie,re,le?se:void 0)]),ne};function isConst(te){return te instanceof Material||typeof te=="string"||te instanceof String||typeof te=="boolean"||te instanceof Vector}function trimNode(te,ee,re){if(te.typeName in trimEvalMap)return re.evaluatingLine=te.line||re.evaluatingLine,trimEvalMap[te.typeName](te,ee,re);{let ne=new TreeNode(te.origText,te.typeName,te.line);for(let ie=0;ie<te.children.length;ie++)ne.children.push(trimNode(te.children[ie],ee,re));return ne}}function trueValue(te){if(typeof te=="boolean")return te;if(te instanceof Material)return neq(te.value,0);throw te instanceof Vector?new ModelError("Cannot convert a Vector to a boolean.",{code:7057}):typeof te=="string"||te instanceof String?new ModelError("Cannot convert a String to a boolean.",{code:7058}):new ModelError("Only numbers can be used in place of booleans.",{code:7059})}class Simulator{constructor(){this.resultsWindow=void 0,this.setResultsCallback=void 0,this.setStatusCallback=void 0,this.finished=void 0,this.status=void 0,this.valueChange=void 0,this.transitionPrimitives=void 0,this.timer=void 0,this.displayInformation=void 0,this.randLoc=-1,this.model=null,this.lastRandPos=-1,this.previousRandLists=[],this.valuedPrimitives=[],this.unitsToBases={},this.distanceCache={},this.distanceCacheCount=0,this.sliders={},this.ids={},this.idCount=0,this.stochastic=!1,this.allPlaceholders={},this.RKOrder=void 0,this.config=null,this.results=void 0,this.evaluatingLine=null,this.varBank=Object.create(null),this.unitManager=new UnitManager,this.random=null,this.clusters=null,this.timeUnitsString=null}setup(ee){this.simulationModel=ee,this.solversCompletedFirstPass=0,this.timeStart=this.simulationModel.timeStart,this.timeLength=this.simulationModel.timeLength,this.timePause=this.simulationModel.timePause,this.timeEnd=new Material(Big(this.timeStart.value).plus(this.timeLength.value).toNumber(),this.timeLength.units),this.timeStep=this.simulationModel.solvers.base.timeStep,this.userTimeStep=this.simulationModel.solvers.base.userTimeStep,this.timeStepCount=Math.floor(this.timeLength.value/this.userTimeStep.value),this.timeUnits=this.timeStart.units,this.timeUnits.addBase(),this.oldAggregateSeries=[],this.distanceCache={},this.tasks=new TaskQueue({start:this.timeStart,end:this.timeEnd})}getID(ee){return this.ids[ee]||(this.idCount++,this.ids[ee]=this.idCount),this.ids[ee]}time(){return this.tasks.time.fullClone()}timeProgressed(){return minus(this.time(),this.timeStart)}frame(ee,re){let ne=ee.length;for(let ie=0;ie<ne;ie++)ee[ie].storeValue();this.printStates(re)}step(ee){if(ee.completedFirstPass||(ee.completedFirstPass=!0,this.solversCompletedFirstPass++,this.solversCompletedFirstPass===Object.keys(this.simulationModel.solvers).length&&this.config.onCompletedFirstPass&&this.config.onCompletedFirstPass()),ee.displayed.length>0)for(let re=this.results.children[ee.displayed[0].id].results.length;re<this.results.times.length;re++)for(let ne of ee.displayed)this.results.children[ne.id].results.push(this.results.data[re][ne.id]);this.config.onStep&&this.config.onStep(ee)}sleep(ee){this.config&&(this.config.silent?this.config.onPause&&(this.shouldSleep=!0):(this.shouldSleep=!0,this.shouldUpdateValues=ee))}resume(){try{this.run()}catch(ee){return checkErr(ee,this.config,this)}}completed(){return this.terminated||this.tasks.completed()}terminate(){this.setStatus("TERMINATED"),this.terminated||(clearTimeout(this.timer),this.sleep(),this.terminated=!0)}setStatus(ee){this.status=ee,this.setStatusCallback&&this.setStatusCallback(ee)}run(ee){this.setStatus("RUNNING");let re=this,ne=(ie,se)=>{this.tasks.add(new Task({time:ie,expires:1,name:"Interval Pause",priority:1,action:le=>{this.sleep(!0),se&&lessThan(plus(ie,this.timePause),this.timeEnd)&&ne(plus(ie,this.timePause),se)}})),this.tasks.add(new Task({time:ie,expires:1,name:"Interval Pause",priority:1,action:le=>{if(this.valueChange){re.valuedPrimitives=[];for(let ue in this.simulationModel.solvers){let ae=this.simulationModel.solvers[ue];for(let oe=0;oe<ae.valued.length;oe++)ae.valued[oe].clearCached();for(let oe=0;oe<ae.flows.length;oe++)ae.flows[oe].predict(!0)}this.valueChange=!1}}}))};if(ee){for(let ie in this.simulationModel.solvers)this.createSolver(this.simulationModel.solvers[ie]);this.timePause&&ne(plus(this.timeStart,this.timePause),!0),this.tasks.cursor=this.tasks.tasks.minNode()}this.wakeUpTime=Date.now();try{for(;!this.completed();)if(this.tasks.step(),this.shouldSleep){for(let ie in this.simulationModel.solvers)updateDisplayed(this.simulationModel.solvers[ie],this);this.setResultsCallback&&this.setResultsCallback(formatSimResults(this.results)),this.shouldUpdateValues&&(this.setStatus("PAUSED"),this.shouldUpdateValues=!1),this.config.onPause&&setTimeout(()=>{let ie=formatSimResults(this.results),se=ie.data.length,le=ie.data[se-1];for(let ue in le)if(ue!=="time"){if(!ie.children[ue])return;ie.children[ue].results.length<se&&ie.children[ue].results.push(le[ue])}ie.resume=this.resume.bind(this),ie.setValue=(ue,ae)=>{let oe=simpleEquation(""+ae,this,{"-parent":this.varBank});this.valuedPrimitives.forEach(ce=>{ce.id===ue.id&&(oe.fullClone?(ce.dna.equation=oe.fullClone(),ce.equation=oe.fullClone()):(ce.dna.equation=oe,ce.equation=oe))}),this.valueChange=!0},this.config.onPause(ie)},10),this.shouldSleep=!1;return}}catch(ie){if(ie.simulationCommand!=="STOP")throw ie}if(this.results=formatSimResults(this.results),this.results.stochastic=this.stochastic,this.config.onSuccess&&this.config.onSuccess(this.results),this.terminate(),this.resultsWindow){this.results.window=this.resultsWindow;for(let ie in this.simulationModel.solvers)updateDisplayed(this.simulationModel.solvers[ie],this)}return this.results}progress(){return div(minus(this.time(),this.timeStart),this.timeLength).value}printStates(ee){let re=parseFloat(this.time().value.toPrecision(20));if(!this.results.times.includes(re)){let ie;for(ie=this.results.times.length;ie>0;ie--)if(this.results.times[ie-1]<re){this.results.times.splice(ie,0,re),this.results.data.splice(ie,0,{});break}ie===0&&(this.results.times.splice(0,0,re),this.results.data.splice(0,0,{}))}let ne=this.results.data[this.results.times.indexOf(re)];for(let ie=0;ie<ee.length;ie++){let se=ee[ie];if(!(se instanceof SState&&ne[se.id]!==void 0))if(se instanceof SPopulation)this.results.children[se.id].dataMode="agents",ne[se.id]={current:se.collectData()};else{let le=se.value();le instanceof Vector&&!le.names?(le.recurseApply(ue=>this.adjustNum(se,ue)),ne[se.id]=cleanData(le),this.results.children[se.id].dataMode="auto"):le instanceof Vector?(le.recurseApply(ue=>this.adjustNum(se,ue)),ne[se.id]=cleanData(le)):le instanceof SAgent?(ne[se.id]=le,this.results.children[se.id].dataMode="auto"):ne[se.id]=cleanData(this.adjustNum(se,le))}}}unitsToBase(ee,re,ne){let ie=ee.id+"-"+(re?re.id:"");if(ie in this.unitsToBases)return this.unitsToBases[ie];let se=1;ne&&(se=this.timeUnits.toBase);let le=1;return re&&(re.addBase(),le=re.toBase),this.unitsToBases[ie]=fn["/"](fn["/"](le,ee.dna.toBase),se),this.unitsToBases[ie]}adjustNum(ee,re){if(ee.dna.unitless&&re.units)throw new ModelError(`The result of the calculation has units <i>${re.units.toString()}</i>, but the primitive is unitless. Please set the units for the primitive so we can determine the proper output.`,{primitive:ee,showEditor:!0,code:8e3});return ee instanceof SFlow&&!ee.dna.flowUnitless&&(re=mult(re,new Material(1,this.timeUnits))),ee instanceof SState||!re.units&&!(ee instanceof SFlow)?typeof re=="object"&&"value"in re?+re.value:re:+fn["*"](re.value,this.unitsToBase(ee,re.units,ee instanceof SFlow))}createSolver(ee){let re=this,ne=ee.stocks,ie=ee.flows,se=ee.actions,le=ee.transitions,ue=ee.valued,ae=ee.displayed,oe=ee.id,ce=ee.timeStep,he=ee.RKOrder;ee.RKPosition=1;let pe=0,de=[],me=Math.ceil(new Big(this.timeEnd.value).minus(this.timeStart.value).div(ce.value).toNumber());for(let be=0;be<=me+2;be++)de.push(new Material(new Big(this.timeStart.value).plus(new Big(be).times(ce.value)).toNumber(),ce.units));let ge=(be,Fe,Le)=>{this.tasks.add(new Task({time:be,expires:1,priority:0,name:"RK1 Solver - "+ee.id,action:Oe=>{if(re.valuedPrimitives=[],Le){let De=ie.length;for(let Ie=0;Ie<De;Ie++)ie[Ie].clean();De=ue.length;for(let Ie=0;Ie<De;Ie++)ue[Ie].clearCached()}this.frame(ue,ae);let Se=se.length;for(let De=0;De<Se;De++)(!se[De].initialized||se[De].dna.recalculate&&!se[De].block)&&updateTrigger.call(se[De]);Se=le.length;for(let De=0;De<Se;De++)(!le[De].initialized||le[De].dna.recalculate)&&updateTrigger.call(le[De]);this.step(ee),Fe&&pe<=me&&(pe++,ge(de[pe],!0,!0))}}))},we=(be,Fe)=>{this.tasks.add(new Task({time:be,name:"RK4 Solver (Init)  - "+ee.id,priority:-10,expires:1,blocker:oe+" init",action:Le=>{let Oe=ie.length;for(let Se=0;Se<Oe;Se++)ie[Se].clean();re.valuedPrimitives=[],Oe=ue.length;for(let Se=0;Se<Oe;Se++)ue[Se].clearCached();ee.RKPosition=1,Le.unblock(oe+" start"),Le.block()}})),this.tasks.add(new Task({time:be,name:"RK4 Solver (step 1) - "+ee.id,priority:-5,expires:4,blocker:oe+" start",action:Le=>{if(ee.RKPosition>1){re.valuedPrimitives=[];let Oe=ue.length;for(let Se=0;Se<Oe;Se++)ue[Se].clearCached(),ue[Se].pastValues.pop();if(ee.RKPosition===4){Oe=ie.length;for(let Se=0;Se<Oe;Se++){let De=ie[Se].checkRate(ie[Se].RKPrimary[0].fullClone());ie[Se].doRK4Aggregation(),ie[Se].rate=De}}}if(this.frame(ue,ae),ee.RKPosition===4){let Oe=se.length;for(let Se=0;Se<Oe;Se++)(!se[Se].initialized||se[Se].dna.recalculate&&!se[Se].block)&&updateTrigger.call(se[Se]);Oe=le.length;for(let Se=0;Se<Oe;Se++)(!le[Se].initialized||le[Se].dna.recalculate)&&updateTrigger.call(le[Se]);Le.unblock(oe+" init"),Fe&&pe<=me&&(pe+=2,we(de[pe],!0)),this.step(ee)}else if(eq(re.time(),re.timeEnd))this.step(ee);else{let Oe=ne.length;for(let Se=0;Se<Oe;Se++)ne[Se].preserveLevel()}Le.block(),Le.unblock(oe+" mid")},rollback:function(){let Le=ne.length;for(let Oe=0;Oe<Le;Oe++)ne[Oe].restoreLevel()}})),this.tasks.add(new Task({time:de[pe+1],name:"RK4 Solver (step 2,3) - "+ee.id,priority:-10,expires:2,blocker:oe+" mid",action:Le=>{re.valuedPrimitives=[];let Oe=ue.length;for(let Se=0;Se<Oe;Se++)ue[Se]instanceof SState||ue[Se].clearCached();ee.RKPosition++,Oe=ie.length;for(let Se=0;Se<Oe;Se++)ie[Se].rate=null;for(let Se=0;Se<Oe;Se++)ie[Se].value();Le.unblock(oe+" start"),Le.block()},timeShift:()=>{this.tasks.moveTo(de[pe])}})),this.tasks.add(new Task({time:de[pe+2],name:"RK4 Solver (step 4) - "+ee.id,priority:-30,expires:1,action:Le=>{re.valuedPrimitives=[];let Oe=ue.length;for(let Se=0;Se<Oe;Se++)ue[Se]instanceof SState||ue[Se].clearCached();ee.RKPosition++,Oe=ie.length;for(let Se=0;Se<Oe;Se++)ie[Se].rate=null;for(let Se=0;Se<Oe;Se++)ie[Se].value();Le.unblock(oe+" start")},timeShift:()=>{this.tasks.moveTo(de[pe])}}))};function ve(be,Fe){if(be instanceof Vector){let Le=!1;return be.recurseApply(Oe=>{Le=Le||Fe(Oe)}),Le}else return Fe(be)}function _e(be){return be&&ve(toNum(be),Fe=>Fe instanceof Material&&Fe.value<0)}function Te(be){return be&&ve(toNum(be),Fe=>Fe instanceof Material&&Fe.value>0)}function ye(be,Fe){let Le=[];for(let Oe of ie)Oe.alpha&&Oe.alpha.dna.nonNegative&&Te(Oe.rate)||Oe.omega&&Oe.omega.dna.nonNegative&&_e(Oe.rate)?Le.push(Oe):Oe.apply(be,Fe);Le.sort((Oe,Se)=>{let De=re.clusters[Oe.id],Ie=re.clusters[Se.id];return De.cluster<Ie.cluster?-1:De.cluster>Ie.cluster?1:De.flow<Ie.flow?-1:De.flow>Ie.flow?1:0});for(let Oe of Le)Oe.apply(be,Fe)}if(he===1)this.tasks.addEvent((be,Fe)=>{ye(be,Fe)}),ge(this.timeStart,!0);else if(he===4)this.tasks.addEvent((be,Fe)=>{be.value>0&&ye(be,Fe)}),we(this.timeStart,!0);else throw new ModelError("Unknown solution algorithm.",{code:8001})}}class DNA{constructor(ee,re){this.primitive=ee,this.id=re||ee.id,this.name=ee.name,this.units=null,this.solver=void 0,this.frozen=void 0,this.slider=void 0,this.targetId=void 0,this.sourceId=void 0,this.value=void 0,this.trigger=void 0,this.repeat=void 0,this.delay=void 0,this.stockType=void 0,this.recalculate=void 0,this.nonNegative=void 0,this.residency=void 0,this.source=void 0,this.interpolation=void 0,this.triggerValue=void 0,this.inputs=void 0,this.outputs=void 0,this.flowUnitless=void 0,this.useMaxConstraint=void 0,this.useMinConstraint=void 0,this.minConstraint=void 0,this.maxConstraint=void 0,this.toBase=void 0,this.unitless=void 0,this.equation=void 0,this.agents=void 0,this.noOutput=!1,this.neighborProxyDNA=null,this.extraLinksPrimitives=[],this.adoptUnits=!1}}let Graph=function(){this.nodeSet={},this.nodes=[],this.edges=[],this.adjacency={},this.nextNodeId=0,this.nextEdgeId=0,this.eventListeners=[]};var Node=function(te,ee){this.id=te,this.data=typeof ee<"u"?ee:{}},Edge=function(te,ee,re,ne){this.id=te,this.source=ee,this.target=re,this.data=typeof ne<"u"?ne:{}};Graph.prototype.addNode=function(te){return typeof this.nodeSet[te.id]>"u"&&this.nodes.push(te),this.nodeSet[te.id]=te,this.notify(),te};Graph.prototype.addEdge=function(te){var ee=!1;return this.edges.forEach(function(re){te.id===re.id&&(ee=!0)}),ee||this.edges.push(te),typeof this.adjacency[te.source.id]>"u"&&(this.adjacency[te.source.id]={}),typeof this.adjacency[te.source.id][te.target.id]>"u"&&(this.adjacency[te.source.id][te.target.id]=[]),ee=!1,this.adjacency[te.source.id][te.target.id].forEach(function(re){te.id===re.id&&(ee=!0)}),ee||this.adjacency[te.source.id][te.target.id].push(te),this.notify(),te};Graph.prototype.newNode=function(te){var ee=new Node(this.nextNodeId++,te);return this.addNode(ee),ee};Graph.prototype.newEdge=function(te,ee,re){var ne=new Edge(this.nextEdgeId++,te,ee,re);return this.addEdge(ne),ne};Graph.prototype.getEdges=function(te,ee){return typeof this.adjacency[te.id]<"u"&&typeof this.adjacency[te.id][ee.id]<"u"?this.adjacency[te.id][ee.id]:[]};Graph.prototype.removeNode=function(te){typeof this.nodeSet[te.id]<"u"&&delete this.nodeSet[te.id];for(var ee=this.nodes.length-1;ee>=0;ee--)this.nodes[ee].id===te.id&&this.nodes.splice(ee,1);this.detachNode(te)};Graph.prototype.detachNode=function(te){var ee=this.edges.slice();ee.forEach(function(re){(re.source.id===te.id||re.target.id===te.id)&&this.removeEdge(re)},this),this.notify()};Graph.prototype.removeEdge=function(te){for(var ee=this.edges.length-1;ee>=0;ee--)this.edges[ee].id===te.id&&this.edges.splice(ee,1);for(var re in this.adjacency)for(var ne in this.adjacency[re])for(var ie=this.adjacency[re][ne],se=ie.length-1;se>=0;se--)this.adjacency[re][ne][se].id===te.id&&this.adjacency[re][ne].splice(se,1);this.notify()};Graph.prototype.merge=function(te){var ee=[];te.nodes.forEach(function(re){ee.push(this.addNode(new Node(re.id,re.data)))},this),te.edges.forEach(function(re){var ne=ee[re.from],ie=ee[re.to],se=re.directed?se=re.type+"-"+ne.id+"-"+ie.id:ne.id<ie.id?re.type+"-"+ne.id+"-"+ie.id:re.type+"-"+ie.id+"-"+ne.id,le=this.addEdge(new Edge(se,ne,ie,re.data));le.data.type=re.type},this)};Graph.prototype.filterNodes=function(te){var ee=this.nodes.slice();ee.forEach(function(re){te(re)||this.removeNode(re)},this)};Graph.prototype.filterEdges=function(te){var ee=this.edges.slice();ee.forEach(function(re){te(re)||this.removeEdge(re)},this)};Graph.prototype.addGraphListener=function(te){this.eventListeners.push(te)};Graph.prototype.notify=function(){this.eventListeners.forEach(function(te){te.graphChanged()})};let Layout={};Layout.ForceDirected=function(te,ee,re,ne){this.graph=te,this.stiffness=ee,this.repulsion=re,this.damping=ne,this.nodePoints={},this.edgeSprings={},this.getRandom=()=>Math.random()};Layout.ForceDirected.prototype.point=function(te){if(typeof this.nodePoints[te.id]>"u"){var ee=typeof te.data.mass<"u"?te.data.mass:1;this.nodePoints[te.id]=new Layout.ForceDirected.Point(gVector.random(this.getRandom),ee)}return this.nodePoints[te.id]};Layout.ForceDirected.prototype.spring=function(te){if(typeof this.edgeSprings[te.id]>"u"){var ee=typeof te.data.length<"u"?te.data.length:1,re=!1,ne=this.graph.getEdges(te.source,te.target);if(ne.forEach(function(ie){re===!1&&typeof this.edgeSprings[ie.id]<"u"&&(re=this.edgeSprings[ie.id])},this),re!==!1)return new Layout.ForceDirected.Spring(re.point1,re.point2,0,0);if(this.graph.getEdges(te.target,te.source),ne.forEach(function(ie){re===!1&&typeof this.edgeSprings[ie.id]<"u"&&(re=this.edgeSprings[ie.id])},this),re!==!1)return new Layout.ForceDirected.Spring(re.point2,re.point1,0,0);this.edgeSprings[te.id]=new Layout.ForceDirected.Spring(this.point(te.source),this.point(te.target),ee,this.stiffness)}return this.edgeSprings[te.id]};Layout.ForceDirected.prototype.eachNode=function(te){var ee=this;this.graph.nodes.forEach(function(re){te.call(ee,re,ee.point(re))})};Layout.ForceDirected.prototype.eachEdge=function(te){var ee=this;this.graph.edges.forEach(function(re){te.call(ee,re,ee.spring(re))})};Layout.ForceDirected.prototype.eachSpring=function(te){var ee=this;this.graph.edges.forEach(function(re){te.call(ee,ee.spring(re))})};Layout.ForceDirected.prototype.applyCoulombsLaw=function(){this.eachNode(function(te,ee){this.eachNode(function(re,ne){if(ee!==ne){var ie=ee.p.subtract(ne.p),se=ie.magnitude()+.1,le=ie.normalise();ee.applyForce(le.multiply(this.repulsion).divide(se*se*.5)),ne.applyForce(le.multiply(this.repulsion).divide(se*se*-.5))}})})};Layout.ForceDirected.prototype.applyHookesLaw=function(){this.eachSpring(function(te){var ee=te.point2.p.subtract(te.point1.p),re=te.length-ee.magnitude(),ne=ee.normalise();te.point1.applyForce(ne.multiply(te.k*re*-.5)),te.point2.applyForce(ne.multiply(te.k*re*.5))})};Layout.ForceDirected.prototype.attractToCentre=function(){this.eachNode(function(te,ee){var re=ee.p.multiply(-1);ee.applyForce(re.multiply(this.repulsion/50))})};Layout.ForceDirected.prototype.updateVelocity=function(te){this.eachNode(function(ee,re){re.v=re.v.add(re.a.multiply(te)).multiply(this.damping),re.a=new gVector(0,0)})};Layout.ForceDirected.prototype.updatePosition=function(te){this.eachNode(function(ee,re){re.p=re.p.add(re.v.multiply(te))})};Layout.ForceDirected.prototype.totalEnergy=function(te){var ee=0;return this.eachNode(function(re,ne){var ie=ne.v.magnitude();ee+=.5*ne.m*ie*ie}),ee};Layout.ForceDirected.prototype.nearest=function(te){var ee={node:null,point:null,distance:null},re=this;return this.graph.nodes.forEach(function(ne){var ie=re.point(ne),se=ie.p.subtract(te).magnitude();(ee.distance===null||se<ee.distance)&&(ee={node:ne,point:ie,distance:se})}),ee};Layout.ForceDirected.prototype.getBoundingBox=function(){var te=new gVector(-2,-2),ee=new gVector(2,2);this.eachNode(function(ne,ie){ie.p.x<te.x&&(te.x=ie.p.x),ie.p.y<te.y&&(te.y=ie.p.y),ie.p.x>ee.x&&(ee.x=ie.p.x),ie.p.y>ee.y&&(ee.y=ie.p.y)});var re=ee.subtract(te).multiply(.07);return{bottomleft:te.subtract(re),topright:ee.add(re)}};var gVector=function(te,ee){this.x=te,this.y=ee};gVector.random=function(te){return new gVector(10*(te()-.5),10*(te()-.5))};gVector.prototype.add=function(te){return new gVector(this.x+te.x,this.y+te.y)};gVector.prototype.subtract=function(te){return new gVector(this.x-te.x,this.y-te.y)};gVector.prototype.multiply=function(te){return new gVector(this.x*te,this.y*te)};gVector.prototype.divide=function(te){return new gVector(this.x/te||0,this.y/te||0)};gVector.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};gVector.prototype.normal=function(){return new gVector(-this.y,this.x)};gVector.prototype.normalise=function(){return this.divide(this.magnitude())};Layout.ForceDirected.Point=function(te,ee){this.p=te,this.m=ee,this.v=new gVector(0,0),this.a=new gVector(0,0)};Layout.ForceDirected.Point.prototype.applyForce=function(te){this.a=this.a.add(te.divide(this.m))};Layout.ForceDirected.Spring=function(te,ee,re,ne){this.point1=te,this.point2=ee,this.length=re,this.k=ne};function toposort(te){return toposort$1(uniqueNodes(te),te)}function toposort$1(te,ee){let re=te.length,ne=new Array(re),ie={},se=re,le=makeOutgoingEdges(ee),ue=makeNodesHash(te);for(ee.forEach(oe=>{if(!ue.has(oe[0])||!ue.has(oe[1]))throw new Error("Unknown node. There is an unknown node in the supplied edges.")});se--;)ie[se]||ae(te[se],se,new Set);return ne;function ae(oe,ce,he){if(he.has(oe)){let de;try{de=", node was:"+JSON.stringify(oe)}catch{de=""}throw new Error("Cyclic dependency"+de)}if(!ue.has(oe))throw new Error("Found unknown node. Make sure to provided all involved nodes. Unknown node: "+JSON.stringify(oe));if(ie[ce])return;ie[ce]=!0;let pe=le.get(oe)||new Set;if(pe=Array.from(pe),ce=pe.length){he.add(oe);do{let de=pe[--ce];ae(de,ue.get(de),he)}while(ce);he.delete(oe)}ne[--re]=oe}}function uniqueNodes(te){let ee=new Set;for(let re=0,ne=te.length;re<ne;re++){let ie=te[re];ee.add(ie[0]),ee.add(ie[1])}return Array.from(ee)}function makeOutgoingEdges(te){let ee=new Map;for(let re=0,ne=te.length;re<ne;re++){let ie=te[re];ee.has(ie[0])||ee.set(ie[0],new Set),ee.has(ie[1])||ee.set(ie[1],new Set),ee.get(ie[0]).add(ie[1])}return ee}function makeNodesHash(te){let ee=new Map;for(let re=0,ne=te.length;re<ne;re++)ee.set(te[re],re);return ee}function runSimulation(te){let ee;try{return ee=new Simulator,ee.model=te.model,innerRunSimulation(ee,te)}catch(re){return checkErr(re,te,ee)}}function checkErr(te,ee,re){re.terminate();let ne;if(te instanceof ModelError?ne={error:te.message,errorPrimitive:te.primitive?re.model.getId(te.primitive.id):null,errorCode:te.code}:(console.log(te),ee.processError&&ee.processError(te),ne={error:"An unknown simulation error occurred. Please report this issue to the Insight Maker team at <a href='mailto:support@insightmaker.com' style='color: white'>support@insightmaker.com</a>.",errorPrimitive:null,errorCode:1},te=new ModelError(ne.error,{code:1})),re.results||(re.results={}),re.results.error=te.msg,ne.error&&(ne.error=ne.error.replace(/<br\s*\/?>/g,`
`).replace(/<[^>]*>?/gm,"")),ee.onError&&ee.onError(ne),ee.handleErrorObject)ee.handleErrorObject(te,re);else return ne}function innerRunSimulation(te,ee){ee&&(te.config=ee),te.evaluatingLine=null,ee.resultsWindow&&(ee.resultsWindow.windowContext.simulate.completed()||ee.resultsWindow.windowContext.simulate.terminate(),te.resultsWindow=ee.resultsWindow,ee.resultsWindow.windowContext.simulate=te,ee.resultsWindow.data.simulation=te,ee.resultsWindow.windowContext.componentRef.rerender(),ee.resultsWindow.windowContext.notFirstRun=!0),bootCalc(te),te.allPlaceholders={};let re=te.model.timeUnits;if(!re)throw new ModelError("You must set the time units in the model settings.",{code:1072});re=re.toLowerCase(),te.timeUnitsString=re;let ne={};ne.submodels={base:{id:"base",DNAs:[],agents:[{children:[],childrenId:{}}],size:1}};let ie=te.model.customUnits;if(ie){let ae=[];for(let oe of ie)if(oe.target.trim()){let ce={sourceString:oe.name,scale:oe.scale},he=createUnitStore(oe.target,te);if(he)ce.target=he;else throw new ModelError('You cannot define a units synonym for "unitless".',{code:1001});ae.push(ce)}te.unitManager.addUnits(ae)}let se=te.unitManager.getUnitStore([re],[1]);if(ne.timeLength=new Material(te.model.timeLength,se),ne.timeStart=new Material(te.model.timeStart||0,se),ne.timeStep=new Material(te.model.timeStep,se),ne.timeStep.value<=0||isNaN(ne.timeStep.value))throw new ModelError("The model time step must be a positive number.",{code:1002});if(ne.timeLength.value<=0||isNaN(ne.timeLength.value))throw new ModelError("The model time length must be a positive number.",{code:1003});if(te.model.timePause>0&&(ne.timePause=new Material(te.model.timePause,se),ne.timePause.value<ne.timeStep.value))throw new ModelError("Time pause cannot be smaller than the time step.",{code:1004});te.timeUnits=se;let le={};le.base={timeStep:new Material(te.model.timeStep,se),algorithm:te.model.algorithm,id:"base",maxLoaded:-1},ne.solvers=le;let ue=te.model.findFolders().concat(te.model.findAgents());for(let ae=0;ae<ue.length;ae++){let oe=ue[ae].customTimeSettings;if(oe&&oe.enabled){if(le[ue[ae].id]=Object.assign({},oe,{timeStep:new Material(+oe.timeStep,se)}),le[ue[ae].id].timeStep.value<=0||isNaN(le[ue[ae].id].timeStep.value))throw new ModelError("The folder time step must be a positive number.",{primitive:ue[ae],showEditor:!1,code:1005});le[ue[ae].id].id=ue[ae].id,le[ue[ae].id].maxLoaded=-1}}for(let ae of Object.values(le))ae.userTimeStep=ae.timeStep,ae.algorithm==="RK4"?ae.RKOrder=4:ae.RKOrder=1,ae.RKOrder===4&&(ae.timeStep=div(ae.userTimeStep,new Material(2))),ae.stocks=[],ae.flows=[],ae.transitions=[],ae.actions=[],ae.states=[],ae.valued=[],ae.displayed=[];try{let ce=function(){if(!oe)if(oe=!0,te.displayInformation.populated)for(let he=0;he<te.displayInformation.origIds.length;he++){let pe=te.displayInformation.origIds[he],de=te.displayInformation.objects[he];if(de instanceof SPopulation)te.results.children[pe].states=de.stateIds,te.displayInformation.agents[pe.toString()].data=te.results.children[pe].data,te.displayInformation.agents[pe.toString()].results=te.results.children[pe].results;else if(te.results.data[0][pe]instanceof Vector&&te.results.data[0][pe].names){let me=te.results.data[0][pe].fullNames();te.results.children[pe].indexedFullNames=me.slice();for(let ge=0;ge<me.length;ge++)me[ge]=me[ge].join(", ");te.results.children[pe].indexedNames=me}}else{te.displayInformation.populated=!0,te.displayInformation.colors=[],te.displayInformation.headers=[],te.displayInformation.agents=[],te.displayInformation.displayedItems=[],te.displayInformation.renderers=[],te.displayInformation.elementIds=[],te.displayInformation.res=te.results;let he=[];te.displayInformation.origIds=te.displayInformation.ids.slice();for(let pe=0;pe<te.displayInformation.origIds.length;pe++){let de=te.displayInformation.origIds[pe],me=te.displayInformation.objects[pe],ge=me.dna;if(te.displayInformation.displayedItems.push({id:de,header:ge.name,type:ge.primitive._node.value.nodeName}),me instanceof SPopulation){let we=me.stateIds;te.results.children[de].states=we,we.forEach(ve=>{let _e=te.model.getId(ve);he.push(de),te.displayInformation.elementIds.push("e"+de+"-"+ve),te.displayInformation.headers.push(_e.name),te.displayInformation.colors.push(ee.getColor?ee.getColor(_e):"#000000"),te.results.children[de].dataMode==="float"?te.displayInformation.renderers.push(commaStr):te.results.children[de].dataMode==="agents"?te.displayInformation.renderers.push(Te=>Te):te.displayInformation.renderers.push(void 0)}),te.displayInformation.agents[de.toString()]={id:de,item:ge.primitive,data:te.results.children[de].data,results:te.results.children[de].results}}else if(te.results.data.length&&te.results.data[0][de]instanceof Vector&&te.results.data[0][de].names){let we=ee.getColor?ee.getColor(ge.primitive):"#000000",ve=te.results.data[0][de].fullNames();te.results.children[de].indexedFullNames=ve.slice();for(let _e=0;_e<ve.length;_e++)ve[_e]=ve[_e].join(", ");te.results.children[de].indexedNames=ve;for(let _e=0;_e<ve.length;_e++)he.push(de),te.displayInformation.elementIds.push("e"+de+"-"+_e),te.displayInformation.headers.push(ge.name+" ("+ve[_e]+")"),te.displayInformation.colors.push(we),te.displayInformation.renderers.push(commaStr)}else he.push(de),te.displayInformation.elementIds.push("e"+de),te.displayInformation.headers.push(ge.name),te.displayInformation.colors.push(ee.getColor?ee.getColor(ge.primitive):"#000000"),te.results.children[de].dataMode==="float"?te.displayInformation.renderers.push(commaStr):te.displayInformation.renderers.push(void 0)}te.displayInformation.store={data:[]},te.displayInformation.ids=he}};if(te.setup(ne),te.model.globals!==void 0)try{evaluateGlobals(te.model.globals,te)}catch(he){if(he.simulationCommand==="STOP")throw he;let pe=[],de="An error with the macros prevented the simulation from running.";if(he instanceof ModelError)de=de+"<br/><br/>"+he.message;else{if(he.toString&&he.match&&he.match(/line (\d+)/i)){let me=he.match(/line (\d+)/i)[1];pe.push({type:"error",row:me!==void 0?me-1:te.evaluatingLine-1,text:he})}ee.processError&&ee.processError(he)}throw ee.showMacros&&ee.showMacros(pe),new ModelError(de,{code:1e3})}let ae=te.model.find();te.clusters=makeClusters(te);for(let he of ae)if(he instanceof Population){if(he.isInAgent())throw new ModelError(`Cannot have the agent population <i>[${toHTML(he.name)}]</i> placed within an agent folder.`,{primitive:he,showEditor:!1,code:1006});let pe=he.agentBase;if(!pe||!(pe instanceof Agent))throw new ModelError(`You must select a base agent for the primitive <i>[${toHTML(he.name)}]</i>. You can create agent definitions using Folder primitives.`,{primitive:he,showEditor:!1,code:1007});let de=new SPopulation(te);de.dna=new DNA(he,pe.id),de.id=he.id,de.agentId=pe.id,de.createIds(),de.dna.solver=folderSolvers(he,le),de.dna.solver.displayed.push(de),de.geoDimUnits=he.geoUnits,de.geoDimUnitsObject=createUnitStore(he.geoUnits,te,he);try{de.geoWidth=simpleUnitsTest(simpleEquation(he.geoWidth,te),de.geoDimUnitsObject,te,he)}catch{throw new ModelError(`Invalid width for the agent population <i>[${toHTML(he.name)}]</i>.`,{primitive:he,showEditor:!1,code:1008})}try{de.geoHeight=simpleUnitsTest(simpleEquation(he.geoHeight,te),de.geoDimUnitsObject,te,he)}catch{throw new ModelError(`Invalid height for the agent population <i>[${toHTML(he.name)}]</i>.`,{primitive:he,showEditor:!1,code:1009})}if(de.halfWidth=div(de.geoWidth,new Material(2)),de.halfHeight=div(de.geoHeight,new Material(2)),de.geoWrap=he.geoWrapAround,de.placement=he.geoPlacementType,de.placementFunction=he.geoPlacementFunction,de.network=he.networkType,de.networkFunction=he.networkFunction,de.agentBase=pe.agentParent,de.agentBase&&de.agentBase.trim())try{de.agentBase=simpleEquation(de.agentBase,te,te.varBank)}catch{throw new ModelError(`Invalid Agent Parent for the primitive <i>[${toHTML(pe.name)}]</i>.`,{primitive:pe,showEditor:!1,code:1010})}let me=pe.children();de.DNAs=[];for(let ge of me)modelType(ge)&&de.DNAs.push(getDNA(ge,de,le,te)),ge instanceof State&&de.stateIds.add(ge.id);de.size=he.populationSize,de.agents=[],de.dna.agents=de,ne.submodels[he.id]=de,ne.submodels.base.DNAs.push(de.dna)}else he.isInAgent()||modelType(he)&&ne.submodels.base.DNAs.push(getDNA(he,ne.submodels.base,le,te));for(let he of Object.values(ne.submodels)){he.DNAs.sort((pe,de)=>pe.neighborProxyDNA&&!de.neighborProxyDNA?1:de.neighborProxyDNA&&!pe.neighborProxyDNA?-1:0);for(let pe=0;pe<he.size;pe++){let de;he.id==="base"?de=he.agents[0]:(de=new SAgent(te),de.container=he,de.index=pe,de.children=[],de.childrenId={},de.agentId=he.id,de.createIds(),he.agentBase&&(de.vector.parent=he.agentBase),he.agents.push(de));for(let me of he.DNAs)decodeDNA(me,de,te)}}for(let he in ne.submodels){let pe=ne.submodels[he];for(let de=0;de<pe.size;de++)for(let me=0;me<pe.DNAs.length;me++)linkPrimitive(pe.agents[de].children[me],pe.DNAs[me],te)}for(let he in ne.submodels){let pe=ne.submodels[he];for(let de=0;de<pe.size;de++)setAgentInitialValues(pe.agents[de])}for(let he in ne.submodels)if(he!=="base"){try{buildNetwork(ne.submodels[he],te)}catch(pe){let de="An error with the custom network function prevented the simulation from running.";throw pe instanceof ModelError&&(de=de+"<br/><br/>"+pe.message),new ModelError(de,{primitive:ne.submodels[he].node,showEditor:!1,code:1011})}try{buildPlacements(ne.submodels[he],te)}catch(pe){let de="An error with the agent placement function prevented the simulation from running.";throw pe instanceof ModelError&&(de=de+"<br/><br/>"+pe.message),new ModelError(de,{primitive:ne.submodels[he].node,showEditor:!1,code:1012})}}te.results={times:[],data:[],timeUnits:te.timeUnitsString},te.displayInformation={populated:!1,ids:[],times:[],objects:[],maps:[],histograms:[]},ne.submodels.base.agents[0].children.forEach(he=>{if(!(he instanceof SAction||he instanceof STransition)){he.dna.noOutput||(te.displayInformation.objects.push(he),te.displayInformation.ids.push(he.id));let pe={};he instanceof SPopulation?(pe.width=he.geoWidth,pe.height=he.geoHeight,pe.units=he.geoDimUnitsObject,pe.states=he.states()):he.dna.noOutput||he.dna.solver.displayed.push(he),te.results.children||(te.results.children={}),te.results.children[he.id]={data:pe,results:[],dataMode:"float"}}});let oe=!1;if(ee.silent)if(ee.onPause)te.run(ee);else return formatSimResults(te.run(ee));else{let he=div(ne.timeLength,ne.timeStep);for(let ge=0;ge<=he.value;ge++)te.displayInformation.times.push(plus(ne.timeStart,mult(ne.timeStep,new Material(ge))).value);let pe=ee.onSuccess;ee.onSuccess=function(ge){ce();for(let we in te.simulationModel.solvers)updateDisplayed(te.simulationModel.solvers[we],te);te.setResultsCallback&&te.setResultsCallback(formatSimResults(te.results)),pe&&pe(ge)},ee.onCompletedFirstPass=function(){ce()};let de=ee.onStep;ee.onStep=function(ge){let we=!1,ve=te.progress();if(!te.shouldSleep){let _e=Date.now()-te.wakeUpTime,Te=1;te.results.times.length>2e4?Te=4:te.results.times.length>5e3?Te=2:te.results.times.length>1e3&&(Te=1.3),(!te.resultsWindow&&_e>100*Te||_e>600*Te)&&(updateDisplayed(ge,te),we=!0,te.timer=setTimeout(()=>{te.resume()},20*Math.pow(Te,1.5)),te.sleep())}ve===1&&!we&&updateDisplayed(ge,te),de&&de(ge)};let me=ee.onError;ee.onError=function(ge){try{for(let we in te.simulationModel.solvers)updateDisplayed(te.simulationModel.solvers[we],te)}catch{}te.finished&&te.finished(),me&&me(ge)},te.run(ee)}}catch(ae){if(ae.simulationCommand!=="STOP")throw ae;if(ee.silent)return{times:[],value:()=>[],lastValue:()=>{},error:"stop() called during initialization"}}}function cleanData(te,ee=!1){if(te instanceof Vector)if(ee)if(te.names&&te.names.length){let re={};for(let ne=0;ne<te.names.length;ne++)re[te.names[ne]]=cleanData(te.items[ne]);return re}else return te.items.map(re=>cleanData(re,ee));else return new Vector(te.items.map(re=>cleanData(re,ee)),te.simulate,te.names,te.parent);else{if(typeof te=="number")return+te.toPrecision(15);if(Array.isArray(te))return te.map(re=>cleanData(re,ee))}return te}function formatSimResults(te){let ee={};return ee.times=te.times.slice(),ee.data=te.data,ee.timeUnits=te.timeUnits,ee.children=te.children,ee.error=te.error,ee.errorPrimitive=te.errorPrimitive,ee.stochastic=te.stochastic,ee.error||(ee.error=null,ee.errorPrimitive=null),ee.value=function(re){if(!re)throw new Error("Cannot get result value() of null or undefined primitive.");let ne=this.children[re.id];if(!ne)throw new Error("Cannot find primitive in value() results.");return cleanData(ne.results,!0)},ee.lastValue=function(re){if(!re)throw new Error("Cannot get result lastValue() of null or undefined primitive.");let ne=this.children[re.id];if(!ne)throw new Error("Cannot find primitive in lastValue() results.");return cleanData(ne.results[ne.results.length-1],!0)},ee.times&&(ee.periods=ee.times.length),ee}function createUnitStore(te,ee,re){if(!(!te||te.trim()===""||te.trim().toLowerCase()==="unitless"))try{return simpleEquation("{1 "+te+"}",ee,{}).units}catch{throw new ModelError(`Invalid units: "<i>${te}</i>"`,{primitive:re,showEditor:!0,code:1012})}}function simpleEquation(te,ee,re,ne,ie){return re||(re=Object.create(null)),ne||(ne=Object.create(null)),ie||(ie=trimTree(createTree(te),ne,ee)),evaluateTree(ie,re,ee)}function simpleNum(te,ee,re){if(te instanceof Vector)return new Vector(te.items.map(ne=>simpleNum(ne,ee,re)),re);if(te instanceof Material){if(!ee&&te.units)throw new ModelError(`The result of the calculation has units <i>${te.units.toString()}</i>, but no units are specified for the calculation. Please set the units for the calculation so we can determine the proper output.`,{code:1013});return te.units?(te.units.addBase(),ee.addBase(),+fn["*"](te.value,fn["/"](te.units.toBase,ee.toBase))):+te.value}}function simpleUnitsTest(te,ee,re,ne=null,ie=!1,se="Unknown simpleUnits type"){if(te instanceof Vector)return new Vector(te.items.map(le=>simpleUnitsTest(le,ee,re,ne,ie,se)),re);if(te instanceof Material){if(!te.units&&!ee)return te;if(te.units){if(te.units===ee)return te;{let le=convertUnits(te.units,ee);if(le===0)throw new ModelError(`Wrong units generated. Expected <i>${ee?ee.toString():"unitless"}</i>, and got <i>${te.units.toString()}</i>.`,{primitive:ne,showEditor:ie,code:1014});return te.value=te.value*le,te.units=ee,te}}else return te.units=ee,te}throw new ModelError(se,{code:1015})}function evaluateGlobals(te,ee){evaluateTree(trimTree(createTree(te),{},ee),ee.varBank,ee)}function getDNA(te,ee,re,ne){let ie=new DNA(te),se;if(ie.solver=folderSolvers(te,re),te){let le=te.parent;le&&(ie.frozen=le.frozen)}if((te instanceof Variable||te instanceof Flow)&&te.external&&(ie.slider=!0),(te instanceof Flow||te instanceof Transition)&&(te.end!==null&&(ie.targetId=te.end.id),te.start!==null&&(ie.sourceId=te.start.id)),te instanceof Converter)ie.value=te.values;else try{te instanceof Stock?ie.value=replaceMacros(te,ie,createTree(te.initial),ee,re,ne,!0):te instanceof Flow?ie.value=replaceMacros(te,ie,createTree(te.rate),ee,re,ne,!1):te instanceof Variable?ie.value=replaceMacros(te,ie,createTree(te.value),ee,re,ne,!1):te instanceof State?ie.value=replaceMacros(te,ie,createTree(te.startActive),ee,re,ne,!0):te instanceof Transition?ie.value=replaceMacros(te,ie,createTree(te.value),ee,re,ne,!1):te instanceof Action&&(ie.value=replaceMacros(te,ie,createTree(te.action),ee,re,ne,!1))}catch(le){let ue=`The primitive <i>[${toHTML(ie.name)}]</i> has an equation error that must be corrected before the model can be run.`;throw le instanceof ModelError?ue=ue+"<br/><br/>"+le.message:(console.error(le),ue=ue+"<br/><br/>Unknown error."),se=void 0,le.match&&le.match(/line (\d+)/i)&&(se=le.match(/line (\d+)/i)[1]),new ModelError(ue,{code:1055,primitive:te,showEditor:!0,line:se,details:le.match?le:void 0})}if(te instanceof Action){ie.trigger=te.trigger,ie.repeat=te.repeat,ie.recalculate=te.recalculate||te.trigger==="Condition";try{ie.triggerValue=createTree(te.value)}catch(le){let ue=`The trigger for <i>[${toHTML(ie.name)}]</i> has an equation error that must be corrected before the model can be run.`;throw le instanceof ModelError&&(ue=ue+"<br/><br/>"+le.message),new ModelError(ue,{code:1056,primitive:te,showEditor:!0,line:se})}}else if(te instanceof Transition)ie.trigger=te.trigger,ie.repeat=te.repeat,ie.recalculate=te.recalculate||te.trigger==="Condition";else if(te instanceof State)if(te.residency===void 0||te.residency.trim()==="")ie.residency=null;else try{ie.residency=evaluateTree(trimTree(createTree(te.residency),{},ne),{},ne),ie.residency.units||(ie.residency.units=ne.timeUnits),eq(ie.residency,new Material(0,ne.timeUnits))&&(ie.residency=null)}catch{throw new ModelError("Invalid state residency.",{primitive:te,showEditor:!1,code:1016})}else if(te instanceof Stock){if(ie.nonNegative=te.nonNegative,te.type==="Conveyor"){ie.stockType="Conveyor";try{ie.delay=evaluateTree(trimTree(createTree(te.delay),{},ne),{},ne),ie.delay.units||(ie.delay.units=ne.timeUnits)}catch{throw new ModelError("Invalid stock delay.",{primitive:te,showEditor:!1,code:1017})}if(!(ie.delay instanceof Material))throw new ModelError("Stock delay must be a number.",{primitive:te,showEditor:!1,code:1073});if(ie.delay.value<0)throw new ModelError("Stock delay cannot be less than 0.",{primitive:te,showEditor:!1,code:1074})}}else if(te instanceof Flow)ie.nonNegative=te.nonNegative;else if(te instanceof Converter){ie.interpolation=te.interpolation==="Linear"?"linear":"discrete";let le=te.values;if(!le||!le.length)throw new ModelError(`The converter <i>[${toHTML(ie.name)}]</i> does not have any data.`,{primitive:te,showEditor:!0,code:1018});let ue=[],ae=[],oe;if(te.input==="Time")oe=ne.timeUnits;else{let ce=te.input;if(ce)oe=createUnitStore(ce.units,ne,te);else throw new ModelError(`The converter <i>[${toHTML(ie.name)}]</i> does not have a source.`,{primitive:te,showEditor:!0,code:1019})}ie.source=te.input==="Time"?te.input:te.input.id;for(let ce=0;ce<le.length;ce++)ue.push(new Material(le[ce].x,oe)),ae.push(new Material(le[ce].y));ie.inputs=ue,ie.outputs=ae}if(te instanceof ValuedPrimitive){if(!(te instanceof Transition)&&!(te instanceof Action)){let ue=te.units;try{!(te instanceof Flow)||ue&&ue.trim()&&ue.trim().toLowerCase()!=="unitless"?ie.units=createUnitStore(ue,ne,te):(ie.units=ne.timeUnits.power(-1),ie.flowUnitless=!0)}catch{throw new ModelError(`Invalid units specified for primitive: "<i>${toHTML(ue)}</i>"`,{primitive:te,showEditor:!0,code:1020})}}else ie.trigger==="Timeout"&&(ie.units=ne.timeUnits);let le=te.constraints;ie.maxConstraint=le.max,ie.useMaxConstraint="max"in le,ie.minConstraint=le.min,ie.useMinConstraint="min"in le}return ie.units&&!ie.units.isUnitless()?(ie.units.addBase(),ie.toBase=ie.units.toBase):ie.toBase=1,ie.unitless=!ie.units,ie}function folderSolvers(te,ee){if(!te)return ee.base;if(te instanceof Population){let ne=te.agentBase;if(ne&&ee[ne.id])return ee[ne.id]}let re=te.parent;return re&&ee[re.id]?ee[re.id]:folderSolvers(re,ee)}function decodeDNA(te,ee,re){let ne;te.primitive instanceof Variable?ne=new SVariable(re):te.primitive instanceof State?ne=new SState(re):te.primitive instanceof Transition?ne=new STransition(re):te.primitive instanceof Action?ne=new SAction(re):te.primitive instanceof Stock?ne=new SStock(re):te.primitive instanceof Flow?ne=new SFlow(re):te.primitive instanceof Converter&&(ne=new SConverter(re)),ne?(ne.dna=te,ne.id=te.id,ne.index=ee.index,ne.agentId=ee.agentId,ne.container=ee,ne.createIds(),ne.frozen=te.frozen,ee.children.push(ne),ee.childrenId[ne.id]=ne,te.slider&&(re.sliders[te.id]?re.sliders[te.id].push(ne):re.sliders[te.id]=[ne]),ne instanceof SAction?te.solver.actions.push(ne):ne instanceof STransition?te.solver.transitions.push(ne):ne instanceof SPopulation||(te.solver.valued.push(ne),ne instanceof SFlow?te.solver.flows.push(ne):ne instanceof SStock?te.solver.stocks.push(ne):ne instanceof SState&&te.solver.states.push(ne)),te.neighborProxyDNA&&(ne.neighborProxyPrimitive=ee.children.find(ie=>ie.dna===te.neighborProxyDNA))):te.primitive instanceof Population&&(ee.children.push(te.agents),ee.childrenId[te.id]=te.agents)}function linkPrimitive(te,ee,re){if(!(te instanceof SPopulation)){let ne=getPrimitiveNeighborhood(te.neighborProxyPrimitive?te.neighborProxyPrimitive:te,te.neighborProxyPrimitive?te.dna.neighborProxyDNA:ee,re,te.dna.extraLinksPrimitives);if(te instanceof SFlow||te instanceof STransition){let ie=ne;te.neighborProxyPrimitive&&(ie=getPrimitiveNeighborhood(te,ee,re,te.dna.extraLinksPrimitives));let se=null,le=null;if(ie["[alpha"]&&(se=ie["[alpha"],ie.alpha||(ie.alpha=se)),ie["[omega"]&&(le=ie["[omega"],ie.omega||(ie.omega=le)),te instanceof STransition){if(se&&!(se instanceof SState))throw new ModelError(`The start of the primitive <i>[${ee.name}]</i> must be a state.`,{primitive:ee.primitive,showEditor:!1,code:1060});if(le&&!(le instanceof SState))throw new ModelError(`The end of the primitive <i>[${ee.name}]</i> must be a state.`,{primitive:ee.primitive,showEditor:!1,code:1061})}if(te instanceof SFlow){if(se&&!(se instanceof SStock))throw new ModelError(`The start of the primitive <i>[${ee.name}]</i> must be a stock.`,{primitive:ee.primitive,showEditor:!1,code:1062});if(le&&!(le instanceof SStock))throw new ModelError(`The end of the primitive <i>[${ee.name}]</i> must be a stock.`,{primitive:ee.primitive,showEditor:!1,code:1063})}te.setEnds(se,le)}if(te instanceof SAction){try{te.equation=trimTree(ee.triggerValue,ne,te.simulate)}catch(ie){let se=`The primitive <i>[${toHTML(ee.name)}]</i> has an equation error that must be corrected before the model can be run.`;throw ie instanceof ModelError&&(se=se+"<br/><br/>"+ie.message),new ModelError(se,{primitive:ee.primitive,showEditor:!1,code:1064})}try{te.action=trimTree(ee.value,ne,te.simulate)}catch(ie){let se=`The primitive <i>[${toHTML(ee.name)}]</i> has an equation error that must be corrected before the model can be run.`;ie instanceof ModelError&&(se=se+"<br/><br/>"+ie.message);let le;throw ie.match&&ie.match(/line (\d+)/i)&&(le=ie.match(/line (\d+)/i)[1]),new ModelError(se,{primitive:ee.primitive,showEditor:!0,code:1065,line:le,details:ie.match?ie:void 0})}}else if(te instanceof SConverter)if(ee.source==="Time")te.setSource("*time");else{let ie=ee.source,se=!1;for(let le in ne)if(ie===ne[le].id){te.setSource(ne[le]),se=!0;break}if(!se)throw new ModelError("Converter source could not be found. Please redefine it.",{primitive:ee.primitive,showEditor:!1,code:1066})}else te.setEquation(ee.value,ne)}}function setAgentInitialValues(te){for(let ee of te.children)if(ee instanceof SStock){ee.setDelay();try{ee.setInitialValue()}catch(re){throw re instanceof ModelError&&(re.primitive||(re.primitive=ee.orig())),re}}else if(ee instanceof SState)try{ee.active===null&&ee.setInitialActive(!0)}catch(re){throw re instanceof ModelError&&(re.primitive||(re.primitive=ee.orig())),re}}function buildNetwork(te,ee){if(te.network==="Custom Function"){let re=getPrimitiveNeighborhood(te,te.dna,ee,[]),ne=trimTree(createTree(te.networkFunction),re,ee);for(let ie=0;ie<te.agents.length-1;ie++)for(let se=ie+1;se<te.agents.length;se++)trueValue(simpleEquation(te.networkFunction,ee,{"-parent":ee.varBank,a:te.agents[ie],b:te.agents[se]},re,ne))&&te.agents[ie].connect(te.agents[se])}else if(te.network!=="None")throw new ModelError(`Unknown network type: ${toHTML(te.network)}.`,{primitive:te.node,showEditor:!1,code:1020})}function buildPlacements(te,ee){let re,ne,ie;if(te.placement==="Random")for(let se of te.agents)se.location=new Vector([mult(te.geoWidth,new Material(Rand(ee))),mult(te.geoHeight,new Material(Rand(ee)))],ee,["x","y"]);else if(te.placement==="Custom Function")te.agents.forEach(se=>{let le=getPrimitiveNeighborhood(te,te.dna,ee,[]);le.self=se,se.location=simpleUnitsTest(simpleEquation(te.placementFunction,ee,{"-parent":ee.varBank,self:se},le),te.geoDimUnitsObject,ee,null,null,"Agent placement functions must return a two element vector"),validateAgentLocation(se.location,te.node),se.location.names||(se.location.names=["x","y"],se.location.namesLC=["x","y"])});else if(te.placement==="Grid"){re=trimTree(createTree("{x: x*width(self), y: y*height(self)}"),{},ee);let se=te.agents.length,le=simpleNum(simpleEquation("width(self)/height(self)",ee,{"-parent":ee.varBank,self:te},{}),te.geoDimUnitsObject,ee);ie=Math.sqrt(se/le),ne=Math.floor(ie*le),ie=Math.ceil(ie),ie*ne<se&&(ne=ne+1);let ue=0;te.agents.forEach(ae=>{let oe=(ue%ne+.5)/ne,ce=(Math.floor(ue/ne)+.5)/ie;ae.location=simpleUnitsTest(simpleEquation("{x: x*width(self), y: y*height(self)}",ee,{self:ae,x:new Material(oe),y:new Material(ce),"-parent":ee.varBank},{},re),te.geoDimUnitsObject,ee),ue++})}else if(te.placement==="Ellipse"){re=trimTree(createTree("{width(self), height(self)}/2+{sin(index(self)/size*2*3.14159), cos(index(self)/size*2*3.14159)}*{width(self), height(self)}/2"),{},ee);let se=new Material(te.agents.length);te.agents.forEach(le=>{le.location=simpleUnitsTest(simpleEquation("{width(self), height(self)}/2+{sin(index(self)/size*2*3.14159), cos(index(self)/size*2*3.14159)}*{width(self), heigh(self)}/2",ee,{self:le,size:se,"-parent":ee.varBank},{},re),te.geoDimUnitsObject,ee)})}else if(te.placement==="Network"){re=trimTree(createTree("{x: x*width(self), y: y*height(self)}"),{},ee);let se=new Graph,le=te.agents.map(he=>se.newNode({data:he})),ue=function(he){for(let pe of le)if(pe.data.data===he)return pe;return null};te.agents.forEach(he=>{he.connected.forEach(pe=>{se.newEdge(ue(he),ue(pe))})});let ae=new Layout.ForceDirected(se,400,600,.5);ae.getRandom=()=>Rand(ee);for(let he=0;he<60;he++)ae.applyCoulombsLaw(),ae.applyHookesLaw(),ae.attractToCentre(),ae.updateVelocity(.03),ae.updatePosition(.03);let oe=ae.getBoundingBox();oe.width=oe.topright.x-oe.bottomleft.x,oe.height=oe.topright.y-oe.bottomleft.y;let ce=function(he){return{x:(he.x-oe.bottomleft.x)/oe.width,y:(he.y-oe.bottomleft.y)/oe.height}};ae.eachNode((he,pe)=>{let de=ce(pe.p);he.data.data.location=simpleUnitsTest(simpleEquation("{x: x*width(self), y: y*height(self)}",ee,{self:te,x:new Material(de.x),y:new Material(de.y),"-parent":ee.varBank},{},re),te.geoDimUnitsObject,ee)})}else throw new ModelError(`Unknown placement type: ${toHTML(te.placement)}.`,{primitive:te.node,showEditor:!1,code:1021})}function getPrimitiveNeighborhood(te,ee,re,ne){let ie=ee.primitive.neighbors();if(ne)for(let ue of ne)ie.push({item:ue,type:"direct"});let se=re.allPlaceholders[ee.id]?re.allPlaceholders[ee.id]:{},le={self:te};if(te instanceof SPopulation)for(let ue of te.DNAs)se[ue.name.toLowerCase()]=new Placeholder(ue,te,re);for(let ue of ie){let ae=ue.item;if(ae instanceof Population){le[te.simulate.simulationModel.submodels[ae.id].dna.name.toLowerCase()]=te.simulate.simulationModel.submodels[ae.id];for(let oe of te.simulate.simulationModel.submodels[ae.id].DNAs){let ce=oe.name.toLowerCase();ce in le||(le[ce]=new Placeholder(oe,te,re))}}else if(ue.type!=="agent"){let oe=!1,ce;if(te.container&&te.container.childrenId[ae.id]&&(ce=te.container.childrenId[ae.id].dna.name.toLowerCase(),le[ce]=te.container.childrenId[ae.id],oe=!0),oe||te.simulate.simulationModel.submodels.base.agents[0].childrenId[ae.id]&&(ce=te.simulate.simulationModel.submodels.base.agents[0].childrenId[ae.id].dna.name.toLowerCase(),le[ce]=te.simulate.simulationModel.submodels.base.agents[0].childrenId[ae.id],oe=!0),!oe&&(te instanceof SFlow||te instanceof STransition)&&ae===re.model.getId(ae.id))throw te instanceof SFlow?new ModelError("Flow primitives may not cross agent boundaries.",{primitive:ee.primitive,showEditor:!1,code:1070}):new ModelError("Transition primitives may not cross agent boundaries.",{primitive:ee.primitive,showEditor:!1,code:1071});(te instanceof SFlow||te instanceof STransition)&&le[ce]&&(ee.targetId===le[ce].id?le["[omega"]=le[ce]:ee.sourceId===le[ce].id&&(le["[alpha"]=le[ce]))}}for(let ue in se)ue in le||(le[ue]=se[ue]);return re.allPlaceholders[ee.id]=se,le}function modelType(te){return te instanceof Stock||te instanceof Flow||te instanceof State||te instanceof Transition||te instanceof Converter||te instanceof Variable||te instanceof Action||te instanceof Population}function updateDisplayed(te,ee){let re=te.displayed;if(ee.displayInformation.store){for(let ne=ee.displayInformation.store.data.length;ne<ee.results.times.length;ne++){let ie=ee.displayInformation.store.data[ne],se={};if(ie||(se.id=ne,se.Time=ee.results.times[ne]),re.length>0&&ee.results.data[ne][re[0].id]!==void 0)for(let le=0;le<re.length;le++){let ue=ee.displayInformation.ids.indexOf(re[le].id);if(ue>-1)if(ee.results.children[ee.displayInformation.ids[ue]].states){let ae=ee.results.children[ee.displayInformation.ids[ue]].states;if(ee.results.data[ne][re[le].id]){let oe=ee.results.data[ne][re[le].id].current,ce={};for(let pe of oe)if(pe.state)for(let de of pe.state)ce[de.id.toString()]=ce[de.id.toString()]+1||1;let he=0;ae.forEach(pe=>{se[ee.displayInformation.elementIds[ue+he]]=ce[pe]||0,he++})}}else if(ee.results.children[ee.displayInformation.ids[ue]].indexedNames){let ae=0;for(;ue<ee.displayInformation.ids.length&&ee.displayInformation.ids[ue]===re[le].id;){try{se[ee.displayInformation.elementIds[ue]]=selectFromMatrix(ee.results.data[ne][re[le].id].fullClone(),ee,ee.results.children[ee.displayInformation.ids[ue]].indexedFullNames[ae].slice())}catch{throw new ModelError("Cannot change vector keys during a simulation.",{primitive:re[le].dna.primitive,showEditor:!0,code:1022})}ae++,ue++}}else se[ee.displayInformation.elementIds[ue]]=ee.results.data[ne][re[le].id]}ie?Object.assign(ie,se):ee.displayInformation.store.data.push(se)}ee.resultsWindow||(ee.resultsWindow=ee.config.createResultsWindow(ee))}}function validateAgentLocation(te,ee){let re=()=>{throw new ModelError("Agent placement functions must return a two element vector",{primitive:ee,showEditor:!1,code:1023})};te instanceof Vector||re(),te.length()!==2&&re(),te.items[0]instanceof Material||re(),te.items[1]instanceof Material||re()}function makeClusters(te){let ee={},re=te.model.findFlows(),ne=0;for(;re.length;){ne++;let ie=re[0],se={availableFlows:re,edges:[],stockSet:new Set,flowSet:new Set,simulate:te};clusterAddFlow(se,ie);let le;try{le=toposort(se.edges)}catch{let oe=[...se.flowSet.entries()].map(he=>he[0]);oe.sort((he,pe)=>he.id-pe.id);let ce=0;for(let he of oe)ce++,ee[he.id]={cluster:ne,flow:ce};continue}let ue=0;for(let ae of le)ae instanceof Flow&&(ue++,ee[ae.id]={cluster:ne,flow:ue})}return ee}function clusterAddFlow(te,ee){te.flowSet.add(ee),te.availableFlows.splice(te.availableFlows.indexOf(ee),1);let re=ee.start,ne=ee.end;re&&re.nonNegative&&(te.edges.push([re,ee]),te.stockSet.has(re)||(te.stockSet.add(re),clusterAddStock(te,re))),ne&&ne.nonNegative&&(te.edges.push([ee,ne]),te.stockSet.has(ne)||(te.stockSet.add(ne),clusterAddStock(te,ne)))}function clusterAddStock(te,ee){let re=!0;for(;re;){re=!1;for(let ne of te.availableFlows){let ie=ne.start,se=ne.end;if(ie===ee||se===ee){clusterAddFlow(te,ne),re=!0;break}}}}let macroCounter=0;const MACRO_FNS={_initial:{replacement:te=>{let{input:ee,initialValue:re}=te;return re?re.cloneStructure():ee.cloneStructure()}},smooth:{replacement:(te,ee,re,ne,ie,se)=>{let{input:le,initialValue:ue,period:ae}=te;ae=new TreeNode("LINES","LINES",re.line,[new TreeNode("ASSIGN","ASSIGN",re.line,[new TreeNode("ASSIGNED","ASSIGNED",re.line,[new TreeNode("__tmp_macro_period","IDENT",re.line)]),new TreeNode("INNER","INNER",re.line,[new TreeNode("RemoveUnits","IDENT",re.line),new TreeNode("FUNCALL","FUNCALL",re.line,[ae,new TreeNode('"'+se.timeUnitsString+'"',"STRING",re.line)])])]),new TreeNode("INNER","INNER",re.line,[new TreeNode("Assert","IDENT",re.line),new TreeNode("FUNCALL","FUNCALL",re.line,[new TreeNode(">","GT",re.line,[new TreeNode("__tmp_macro_period","IDENT",re.line),new TreeNode("0","INTEGER",re.line)]),new TreeNode('"Period for Smooth() must be greater than 0."',"STRING",re.line)])]),new TreeNode("__tmp_macro_period","IDENT",re.line)]);let oe=new Model,ce="__Smooth Stock "+macroCounter++,he=oe.Stock({name:ce,initial:"(iv) || (i)"});he._node.id=""+Math.random();let pe=oe.Flow(null,he,{name:"__Smooth Inflow",rate:"((i) - [Omega]) / (p)",nonNegative:!1});pe._node.id=""+Math.random();let de=getDNA(he,ne,ie,se),me=getDNA(pe,ne,ie,se);ee.extraLinksPrimitives.push(he),me.extraLinksPrimitives.push(he),de.value=ue?ue.cloneStructure():le.cloneStructure();let ge=new TreeNode("DIV","DIV",re.line,[new TreeNode("MINUS","MINUS",re.line,[le.cloneStructure(),new TreeNode("["+ce+"]","PRIMITIVE",re.line)]),ae.cloneStructure()]);return me.value=ge,me.noOutput=!0,de.noOutput=!0,me.adoptUnits=!0,de.adoptUnits=!0,me.neighborProxyDNA=ee,de.neighborProxyDNA=ee,ne.DNAs.push(me),ne.DNAs.push(de),new TreeNode("["+ce+"]","PRIMITIVE",re.line)}},delay1:{replacement:(te,ee,re,ne,ie,se)=>{let{input:le,initialValue:ue,period:ae}=te,oe=new Model;ae=new TreeNode("LINES","LINES",re.line,[new TreeNode("ASSIGN","ASSIGN",re.line,[new TreeNode("ASSIGNED","ASSIGNED",re.line,[new TreeNode("__tmp_macro_period","IDENT",re.line)]),new TreeNode("INNER","INNER",re.line,[new TreeNode("RemoveUnits","IDENT",re.line),new TreeNode("FUNCALL","FUNCALL",re.line,[ae,new TreeNode('"'+se.timeUnitsString+'"',"STRING",re.line)])])]),new TreeNode("INNER","INNER",re.line,[new TreeNode("Assert","IDENT",re.line),new TreeNode("FUNCALL","FUNCALL",re.line,[new TreeNode(">","GT",re.line,[new TreeNode("__tmp_macro_period","IDENT",re.line),new TreeNode("0","INTEGER",re.line)]),new TreeNode('"Period for Delay1() must be greater than 0."',"STRING",re.line)])]),new TreeNode("__tmp_macro_period","IDENT",re.line)]);let ce="__Delay1 Stock "+macroCounter++,he="__Delay1 Outflow "+macroCounter++,pe=oe.Stock({name:ce,initial:"(iv) || (i)"});pe._node.id=""+Math.random();let de=oe.Flow(null,pe,{name:"__Delay1 Inflow",rate:"(i)",nonNegative:!1});de._node.id=""+Math.random();let me=oe.Flow(pe,null,{name:he,rate:"(alpha) / (p)",nonNegative:!1});me._node.id=""+Math.random();let ge=getDNA(pe,ne,ie,se),we=getDNA(de,ne,ie,se),ve=getDNA(me,ne,ie,se);return ee.extraLinksPrimitives.push(me),ve.extraLinksPrimitives.push(pe),we.value=le.cloneStructure(),ge.value=new TreeNode("MULT","MULT",re.line,[ue?ue.cloneStructure():le.cloneStructure(),ae.cloneStructure()]),ve.value=new TreeNode("DIV","DIV",re.line,[new TreeNode("["+ce+"]","PRIMITIVE",re.line),ae.cloneStructure()]),ge.noOutput=!0,we.noOutput=!0,ve.noOutput=!0,ge.adoptUnits=!0,we.adoptUnits=!0,ve.adoptUnits=!0,ge.neighborProxyDNA=ee,we.neighborProxyDNA=ee,ve.neighborProxyDNA=ee,ne.DNAs.push(ge),ne.DNAs.push(we),ne.DNAs.push(ve),new TreeNode("["+he+"]","PRIMITIVE",re.line)}},delay3:{replacement:(te,ee,re,ne,ie,se)=>{let{input:le,initialValue:ue,period:ae}=te,oe=new Model,ce="__Delay3 Outflow "+macroCounter++,he="__Delay3 Stock "+macroCounter++,pe="__Delay3 Stock "+macroCounter++,de="__Delay3 Stock "+macroCounter++,me=oe.Stock({name:he,initial:"(iv) || (i)"});me._node.id=""+Math.random();let ge=oe.Stock({name:pe,initial:"(iv) || (i)"});ge._node.id=""+Math.random();let we=oe.Stock({name:de,initial:"(iv) || (i)"});we._node.id=""+Math.random();let ve=oe.Flow(null,me,{name:"Delay3 Inflow",rate:"(i)",nonNegative:!1});ve._node.id=""+Math.random();let _e=oe.Flow(me,ge,{name:"Delay3 Flow 1",rate:"(alpha) / (p/3)",nonNegative:!1});_e._node.id=""+Math.random();let Te=oe.Flow(ge,we,{name:"Delay3 Flow 2",rate:"(alpha) / (p/3)",nonNegative:!1});Te._node.id=""+Math.random();let ye=oe.Flow(we,null,{name:ce,rate:"(alpha) / (p/3)",nonNegative:!1});ye._node.id=""+Math.random(),ae=new TreeNode("LINES","LINES",re.line,[new TreeNode("ASSIGN","ASSIGN",re.line,[new TreeNode("ASSIGNED","ASSIGNED",re.line,[new TreeNode("__tmp_macro_period","IDENT",re.line)]),new TreeNode("INNER","INNER",re.line,[new TreeNode("RemoveUnits","IDENT",re.line),new TreeNode("FUNCALL","FUNCALL",re.line,[ae,new TreeNode('"'+se.timeUnitsString+'"',"STRING",re.line)])])]),new TreeNode("INNER","INNER",re.line,[new TreeNode("Assert","IDENT",re.line),new TreeNode("FUNCALL","FUNCALL",re.line,[new TreeNode(">","GT",re.line,[new TreeNode("__tmp_macro_period","IDENT",re.line),new TreeNode("0","INTEGER",re.line)]),new TreeNode('"Period for Delay3() must be greater than 0."',"STRING",re.line)])]),new TreeNode("__tmp_macro_period","IDENT",re.line)]);let be=new TreeNode("DIV","DIV",re.line,[ae,new TreeNode("3","INTEGER",re.line)]),Fe=getDNA(me,ne,ie,se),Le=getDNA(ge,ne,ie,se),Oe=getDNA(we,ne,ie,se),Se=getDNA(ve,ne,ie,se),De=getDNA(_e,ne,ie,se),Ie=getDNA(Te,ne,ie,se),Ve=getDNA(ye,ne,ie,se);De.extraLinksPrimitives.push(me),Ie.extraLinksPrimitives.push(ge),Ve.extraLinksPrimitives.push(we),ee.extraLinksPrimitives.push(ye),Se.value=le.cloneStructure();let Ke=new TreeNode("MULT","MULT",re.line,[ue?ue.cloneStructure():le.cloneStructure(),be.cloneStructure()]);return Fe.value=Ke.cloneStructure(),Le.value=Ke.cloneStructure(),Oe.value=Ke.cloneStructure(),De.value=new TreeNode("DIV","DIV",re.line,[new TreeNode("["+he+"]","PRIMITIVE",re.line),be.cloneStructure()]),Ie.value=new TreeNode("DIV","DIV",re.line,[new TreeNode("["+pe+"]","PRIMITIVE",re.line),be.cloneStructure()]),Ve.value=new TreeNode("DIV","DIV",re.line,[new TreeNode("["+de+"]","PRIMITIVE",re.line),be.cloneStructure()]),Fe.noOutput=!0,Le.noOutput=!0,Oe.noOutput=!0,Se.noOutput=!0,De.noOutput=!0,Ie.noOutput=!0,Ve.noOutput=!0,Fe.adoptUnits=!0,Le.adoptUnits=!0,Oe.adoptUnits=!0,Se.adoptUnits=!0,De.adoptUnits=!0,Ie.adoptUnits=!0,Ve.adoptUnits=!0,Fe.neighborProxyDNA=ee,Le.neighborProxyDNA=ee,Oe.neighborProxyDNA=ee,Se.neighborProxyDNA=ee,De.neighborProxyDNA=ee,Ie.neighborProxyDNA=ee,Ve.neighborProxyDNA=ee,ne.DNAs.push(Fe),ne.DNAs.push(Le),ne.DNAs.push(Oe),ne.DNAs.push(Se),ne.DNAs.push(De),ne.DNAs.push(Ie),ne.DNAs.push(Ve),new TreeNode("["+ce+"]","PRIMITIVE",re.line)}}};function getMacroParameters(te,ee,re){if(te.length>3||te.length<2)throw new ModelError(`Wrong number of parameters for ${ee}().`,{code:10001});function ne(ie){if(ie.typeName==="IDENT"){for(let se of re)if(se.target===ie.text)return se.value.cloneStructure()}return ie.children=ie.children.map(se=>ne(se)),ie}return re.length&&(te=te.map(ie=>ne(ie))),{input:te[0],period:te[1],initialValue:te[2]}}const MACRO_FNS_NAMES=Object.keys(MACRO_FNS).filter(te=>!te.startsWith("_"));function replaceMacros(te,ee,re,ne,ie,se,le,ue=[]){let ae,oe;return re.typeName==="INNER"&&(re.children.length===2?re.children[0].typeName==="IDENT"&&MACRO_FNS_NAMES.includes(re.children[0].text)&&(ae=re.children[0].text,re.children[1].typeName==="FUNCALL"&&(oe=getMacroParameters(re.children[1].children.slice(),ae,ue))):re.children.length===3&&re.children[0].typeName==="PRIMITIVE"&&re.children[1].typeName==="SELECTOR"&&re.children[1].children[0].typeName==="DOTSELECTOR"&&MACRO_FNS_NAMES.includes(re.children[1].children[0].children[0].text)&&re.children[2].typeName==="FUNCALL"&&(ae=re.children[1].children[0].children[0].text,oe=getMacroParameters([re.children[0]].concat(re.children[2].children),ae,ue))),ae?le?MACRO_FNS._initial.replacement(oe,ee,re,ne,ie,se):MACRO_FNS[ae].replacement(oe,ee,re,ne,ie,se):(re.children=re.children.map(ce=>replaceMacros(te,ee,ce,ne,ie,se,le,ue)),re.typeName==="ASSIGN"&&re.children.length===2&&re.children[0].typeName==="ASSIGNED"&&re.children[0].children.length&&ue.push({target:re.children[0].children[0].text,value:re.children[1]}),re)}const nodeBase=Object.create(null),defaultSolver=JSON.stringify({enabled:!1,algorithm:"RK1",timeStep:1});let DI=typeof window>"u"?new DOMImplementation$1:document.implementation,doc=DI.createDocument("","",null);nodeBase.text=doc.createElement("Text");nodeBase.text.setAttribute("name","Text Area");nodeBase.text.setAttribute("LabelPosition","Middle");nodeBase.folder=doc.createElement("Folder");nodeBase.folder.setAttribute("name","New Folder");nodeBase.folder.setAttribute("Note","");nodeBase.folder.setAttribute("Type","None");nodeBase.folder.setAttribute("Solver",defaultSolver);nodeBase.folder.setAttribute("Image","None");nodeBase.folder.setAttribute("FlipHorizontal","false");nodeBase.folder.setAttribute("FlipVertical","false");nodeBase.folder.setAttribute("LabelPosition","Middle");nodeBase.folder.setAttribute("AgentBase","");nodeBase.ghost=doc.createElement("Ghost");nodeBase.ghost.setAttribute("Source","");nodeBase.picture=doc.createElement("Picture");nodeBase.picture.setAttribute("name","");nodeBase.picture.setAttribute("Note","");nodeBase.picture.setAttribute("Image","Growth");nodeBase.picture.setAttribute("FlipHorizontal","false");nodeBase.picture.setAttribute("FlipVertical","false");nodeBase.picture.setAttribute("LabelPosition","Bottom");nodeBase.display=doc.createElement("Display");nodeBase.display.setAttribute("name","Default Display");nodeBase.display.setAttribute("Note","");nodeBase.display.setAttribute("Type","Time Series");nodeBase.display.setAttribute("xAxis","Time (%u)");nodeBase.display.setAttribute("yAxis","");nodeBase.display.setAttribute("yAxis2","");nodeBase.display.setAttribute("showMarkers","false");nodeBase.display.setAttribute("showLines","true");nodeBase.display.setAttribute("showArea","false");nodeBase.display.setAttribute("Primitives","");nodeBase.display.setAttribute("Primitives2","");nodeBase.display.setAttribute("AutoAddPrimitives","false");nodeBase.display.setAttribute("ScatterplotOrder","X Primitive, Y Primitive");nodeBase.display.setAttribute("Image","Display");nodeBase.display.setAttribute("FlipHorizontal","false");nodeBase.display.setAttribute("FlipVertical","false");nodeBase.display.setAttribute("LabelPosition","Bottom");function setValuedProperties(te){te.setAttribute("Units","Unitless"),te.setAttribute("MaxConstraintUsed","false"),te.setAttribute("MinConstraintUsed","false"),te.setAttribute("MaxConstraint","100"),te.setAttribute("MinConstraint","0"),te.setAttribute("ShowSlider","false"),te.setAttribute("SliderMax",100),te.setAttribute("SliderMin",0),te.setAttribute("SliderStep","")}nodeBase.stock=doc.createElement("Stock");nodeBase.stock.setAttribute("name","New Stock");nodeBase.stock.setAttribute("Note","");nodeBase.stock.setAttribute("InitialValue","0");nodeBase.stock.setAttribute("StockMode","Store");nodeBase.stock.setAttribute("Delay","10");nodeBase.stock.setAttribute("Volume","100");nodeBase.stock.setAttribute("NonNegative","false");setValuedProperties(nodeBase.stock);nodeBase.stock.setAttribute("Image","None");nodeBase.stock.setAttribute("FlipHorizontal","false");nodeBase.stock.setAttribute("FlipVertical","false");nodeBase.stock.setAttribute("LabelPosition","Middle");nodeBase.state=doc.createElement("State");nodeBase.state.setAttribute("name","New State");nodeBase.state.setAttribute("Note","");nodeBase.state.setAttribute("Active","false");nodeBase.state.setAttribute("Residency","0");nodeBase.state.setAttribute("Image","None");nodeBase.state.setAttribute("FlipHorizontal","false");nodeBase.state.setAttribute("FlipVertical","false");nodeBase.state.setAttribute("LabelPosition","Middle");nodeBase.transition=doc.createElement("Transition");nodeBase.transition.setAttribute("name","Transition");nodeBase.transition.setAttribute("Note","");nodeBase.transition.setAttribute("Trigger","Timeout");nodeBase.transition.setAttribute("Value","1");nodeBase.transition.setAttribute("Repeat","false");nodeBase.transition.setAttribute("Recalculate","false");setValuedProperties(nodeBase.transition);nodeBase.action=doc.createElement("Action");nodeBase.action.setAttribute("name","New Action");nodeBase.action.setAttribute("Note","");nodeBase.action.setAttribute("Trigger","Probability");nodeBase.action.setAttribute("Value","0.5");nodeBase.action.setAttribute("Repeat","true");nodeBase.action.setAttribute("Recalculate","false");nodeBase.action.setAttribute("Action","Self.Move({Rand(), Rand()})");nodeBase.agents=doc.createElement("Agents");nodeBase.agents.setAttribute("name","New Agent Population");nodeBase.agents.setAttribute("Note","");nodeBase.agents.setAttribute("Size","100");nodeBase.agents.setAttribute("GeoWrap","false");nodeBase.agents.setAttribute("GeoDimUnits","Unitless");nodeBase.agents.setAttribute("GeoWidth","200");nodeBase.agents.setAttribute("GeoHeight","100");nodeBase.agents.setAttribute("Placement","Random");nodeBase.agents.setAttribute("PlacementFunction","{Rand()*Width(Self), Rand()*Height(Self)}");nodeBase.agents.setAttribute("Network","None");nodeBase.agents.setAttribute("NetworkFunction","RandBoolean(0.02)");nodeBase.agents.setAttribute("Agent","");nodeBase.agents.setAttribute("Image","None");nodeBase.agents.setAttribute("FlipHorizontal","false");nodeBase.agents.setAttribute("FlipVertical","false");nodeBase.agents.setAttribute("LabelPosition","Middle");nodeBase.agents.setAttribute("ShowSlider","false");nodeBase.agents.setAttribute("SliderMax","100");nodeBase.agents.setAttribute("SliderMin","0");nodeBase.agents.setAttribute("SliderStep","1");nodeBase.variable=doc.createElement("Variable");nodeBase.variable.setAttribute("name","New Variable");nodeBase.variable.setAttribute("Note","");nodeBase.variable.setAttribute("Equation","0");setValuedProperties(nodeBase.variable);nodeBase.variable.setAttribute("Image","None");nodeBase.variable.setAttribute("FlipHorizontal","false");nodeBase.variable.setAttribute("FlipVertical","false");nodeBase.variable.setAttribute("LabelPosition","Middle");nodeBase.button=doc.createElement("Button");nodeBase.button.setAttribute("name","New Button");nodeBase.button.setAttribute("Note","");nodeBase.button.setAttribute("Function",'showMessage("Button action triggered!\\n\\nIf you want to edit this Action, click on the button while holding down the Shift key on your keyboard.")');nodeBase.button.setAttribute("Image","None");nodeBase.button.setAttribute("FlipHorizontal","false");nodeBase.button.setAttribute("FlipVertical","false");nodeBase.button.setAttribute("LabelPosition","Middle");nodeBase.converter=doc.createElement("Converter");nodeBase.converter.setAttribute("name","New Converter");nodeBase.converter.setAttribute("Note","");nodeBase.converter.setAttribute("Source","Time");nodeBase.converter.setAttribute("Data","0,0; 1,1; 2,4; 3,9");nodeBase.converter.setAttribute("Interpolation","Linear");setValuedProperties(nodeBase.converter);nodeBase.converter.setAttribute("Image","None");nodeBase.converter.setAttribute("FlipHorizontal","false");nodeBase.converter.setAttribute("FlipVertical","false");nodeBase.converter.setAttribute("LabelPosition","Middle");nodeBase.flow=doc.createElement("Flow");nodeBase.flow.setAttribute("name","Flow");nodeBase.flow.setAttribute("Note","");nodeBase.flow.setAttribute("FlowRate","0");nodeBase.flow.setAttribute("OnlyPositive","true");nodeBase.flow.setAttribute("TimeIndependent","false");setValuedProperties(nodeBase.flow);nodeBase.link=doc.createElement("Link");nodeBase.link.setAttribute("name","Link");nodeBase.link.setAttribute("Note","");nodeBase.link.setAttribute("BiDirectional","false");nodeBase.setting=doc.createElement("Setting");nodeBase.setting.setAttribute("Note","");nodeBase.setting.setAttribute("Version","37");nodeBase.setting.setAttribute("Throttle","1");nodeBase.setting.setAttribute("TimeLength","100");nodeBase.setting.setAttribute("TimeStart","0");nodeBase.setting.setAttribute("TimeStep","1");nodeBase.setting.setAttribute("TimeUnits","Years");nodeBase.setting.setAttribute("Units","");nodeBase.setting.setAttribute("SolutionAlgorithm","RK1");nodeBase.setting.setAttribute("BackgroundColor","white");nodeBase.setting.setAttribute("Macros","");nodeBase.setting.setAttribute("SensitivityPrimitives","");nodeBase.setting.setAttribute("SensitivityRuns","50");nodeBase.setting.setAttribute("SensitivityBounds","50, 80, 95, 100");nodeBase.setting.setAttribute("SensitivityShowRuns","false");nodeBase.setting.setAttribute("StyleSheet","{}");class Results{constructor(ee,re){this._data=ee,this._nameIdMapping=re,this.timeUnits=ee.timeUnits;for(let ne=0;ne<this._data.data.length;ne++){let ie=this._data.data[ne];for(let se in ie)ie[se]=simplifyResults(ie[se])}}times(){return this._data.times.slice()}table(ee){if(ee){let re=ee.map(se=>({primitive:se,series:this.series(se)})),ne=this.times(),ie=[];for(let se=0;se<ne.length;se++){let le={_time:ne[se]};for(let ue of re)le[ue.primitive.name]=ue.series[se];ie.push(le)}return ie}else{let re=[];for(let ne=0;ne<this._data.data.length;ne++){let ie={};ie._time=this._data.times[ne];let se=this._data.data[ne];for(let le in se)ie[this._nameIdMapping[le]]=se[le];re.push(ie)}return re}}series(ee){return this._data.value(ee._node).slice()}value(ee,re=null){let ne=this.series(ee);if(re===null)return ne[ne.length-1];let ie=this.times(),se=ie.indexOf(re);if(se===-1)throw new Error("Could not find time: "+re+". Available options are: "+JSON.stringify(ie));return ne[se]}}function simplifyResults(te){if(te instanceof Vector)if(te.names){let ee={};for(let re=0;re<te.names.length;re++)ee[te.names[re]]=simplifyResults(te.items[re]);return ee}else return te.items.map(simplifyResults);return te}class SimulationError extends Error{constructor(ee,re){super(ee),Error.captureStackTrace&&Error.captureStackTrace(this,SimulationError),this.name="SimulationError",this.primitive=re.primitive,this.code=re.code,Object.defineProperty(this,"code",{enumerable:!1}),Object.defineProperty(this,"primitive",{enumerable:!1})}}class Model{constructor(ee={}){this._graph=new ModelNode,this._graph.id="1",this._graph.addChild(new ModelNode),this._graph.children[0].addChild(new ModelNode),this.settings=this._createNode("setting"),this.p=ee.primitiveFn||primitives;for(let re in excludeKeys(ee,["primitiveFn"]))if(re in this)this[re]=ee[re];else throw new Error("Unknown model property: "+re)}_createNode(ee){let re=this._graph.children[0].children[0],ne=modelNodeClone(nodeBase[ee],re);return re.addChild(ne),ne}_createConnector(ee,re,ne){let ie=this._graph.children[0].children[0];re&&(ie=re._node.parent),ne&&(ie=ne._node.parent);let se=modelNodeClone(nodeBase[ee],ie);return ie.addChild(se),re?se.source=re._node:se.source=null,ne?se.target=ne._node:se.target=null,se}simulate(){let re=runSimulation({silent:!0,model:this});if(re.error){let se={code:re.errorCode};throw re.errorPrimitive&&(se.primitive=this.get(le=>le.id===re.errorPrimitive.id)),new SimulationError(re.error,se)}let ne=this.find(),ie={};for(let se of ne)ie[se.id]=se.name;return new Results(re,ie)}Stock(ee={}){let re=this._createNode("stock").primitive(this,excludeKeys(ee,["name"]));return re.name=ee.name||"New Stock",re.model=this,re}Variable(ee={}){let re=this._createNode("variable").primitive(this,excludeKeys(ee,["name"]));return re.name=ee.name||"New Variable",re.model=this,re}Converter(ee={}){let re=this._createNode("converter").primitive(this,excludeKeys(ee,["name"]));return re.name=ee.name||"New Converter",re.model=this,re}State(ee={}){let re=this._createNode("state").primitive(this,excludeKeys(ee,["name"]));return re.name=ee.name||"New State",re.model=this,re}Action(ee={}){let re=this._createNode("action").primitive(this,excludeKeys(ee,["name"]));return re.name=ee.name||"New Action",re.model=this,re}Population(ee={}){let re=this._createNode("agents").primitive(this,excludeKeys(ee,["name"]));return re.name=ee.name||"New Population",re.model=this,re}Flow(ee,re,ne={}){let ie=this._createConnector("flow",ee||ne.start||null,re||ne.end||null).primitive(this,excludeKeys(ne,["name","start","end"]));return ie.name=ne.name||"New Flow",ie.model=this,ie}Transition(ee,re,ne={}){let ie=this._createConnector("transition",ee||ne.start||null,re||ne.end||null).primitive(this,excludeKeys(ne,["name","start","end"]));return ie.name=ne.name||"New Transition",ie.model=this,ie}Link(ee,re,ne={}){let ie=this._createConnector("link",ee||ne.start||null,re||ne.end||null).primitive(this,excludeKeys(ne,["name","start","end"]));return ie.name=ne.name||"Link",ie.model=this,ie}Agent(ee={}){let re=this._createNode("folder");re.setAttribute("Type","Agent");let ne=re.primitive(this,excludeKeys(ee,["name"]));return ne.name=ee.name||"New Agent",ne.model=this,ne}Folder(ee={}){let re=this._createNode("folder").primitive(this,excludeKeys(ee,["name"]));return re.name=ee.name||"New Folder",re.model=this,re._node.setAttribute("Type","None"),re}getId(ee){return this.get(re=>re.id===ee)}get(ee){let ne=this.p(this._graph).find(ie=>ie.primitive()&&ee(ie.primitive()));return ne?ne.primitive():null}getLink(ee){let ne=this.p(this._graph,"Link").find(ie=>ee(ie.primitive()));return ne?ne.primitive():null}getFlow(ee){let ne=this.p(this._graph,"Flow").find(ie=>ee(ie.primitive()));return ne?ne.primitive():null}getTransition(ee){let ne=this.p(this._graph,"Transition").find(ie=>ee(ie.primitive()));return ne?ne.primitive():null}getStock(ee){let ne=this.p(this._graph,"Stock").find(ie=>ee(ie.primitive()));return ne?ne.primitive():null}getVariable(ee){let ne=this.p(this._graph,"Variable").find(ie=>ee(ie.primitive()));return ne?ne.primitive():null}getConverter(ee){let ne=this.p(this._graph,"Converter").find(ie=>ee(ie.primitive()));return ne?ne.primitive():null}getState(ee){let ne=this.p(this._graph,"State").find(ie=>ee(ie.primitive()));return ne?ne.primitive():null}getAction(ee){let ne=this.p(this._graph,"Action").find(ie=>ee(ie.primitive()));return ne?ne.primitive():null}getPopulation(ee){let ne=this.p(this._graph,"Agents").find(ie=>ee(ie.primitive()));return ne?ne.primitive():null}getFolder(ee){let ne=this.p(this._graph,"Folder").filter(ie=>ie.getAttribute("Type")!=="Agent").find(ie=>ee(ie.primitive()));return ne?ne.primitive():null}getAgent(ee){let ne=this.p(this._graph,"Folder").filter(ie=>ie.getAttribute("Type")==="Agent").find(ie=>ee(ie.primitive()));return ne?ne.primitive():null}find(ee=()=>!0){return this.p(this._graph).filter(ne=>ne.primitive()&&ee(ne.primitive())).map(ne=>ne.primitive())}findLinks(ee=()=>!0){return this.p(this._graph,"Link").filter(ne=>ee(ne.primitive())).map(ne=>ne.primitive())}findFlows(ee=()=>!0){return this.p(this._graph,"Flow").filter(ne=>ee(ne.primitive())).map(ne=>ne.primitive())}findTransitions(ee=()=>!0){return this.p(this._graph,"Transition").filter(ne=>ee(ne.primitive())).map(ne=>ne.primitive())}findStocks(ee=()=>!0){return this.p(this._graph,"Stock").filter(ne=>ee(ne.primitive())).map(ne=>ne.primitive())}findVariables(ee=()=>!0){return this.p(this._graph,"Variable").filter(ne=>ee(ne.primitive())).map(ne=>ne.primitive())}findConverters(ee=()=>!0){return this.p(this._graph,"Converter").filter(ne=>ee(ne.primitive())).map(ne=>ne.primitive())}findStates(ee=()=>!0){return this.p(this._graph,"State").filter(ne=>ee(ne.primitive())).map(ne=>ne.primitive())}findActions(ee=()=>!0){return this.p(this._graph,"Action").filter(ne=>ee(ne.primitive())).map(ne=>ne.primitive())}findPopulations(ee=()=>!0){return this.p(this._graph,"Agents").filter(ne=>ee(ne.primitive())).map(ne=>ne.primitive())}findFolders(ee=()=>!0){return this.p(this._graph,"Folder").filter(ne=>ne.getAttribute("Type")!=="Agent").filter(ne=>ee(ne.primitive())).map(ne=>ne.primitive())}findAgents(ee=()=>!0){return this.p(this._graph,"Folder").filter(ne=>ne.getAttribute("Type")==="Agent").filter(ne=>ee(ne.primitive())).map(ne=>ne.primitive())}get timeStart(){return+this.settings.getAttribute("TimeStart")}set timeStart(ee){this.settings.setAttribute("TimeStart",ee)}get timeLength(){return+this.settings.getAttribute("TimeLength")}set timeLength(ee){this.settings.setAttribute("TimeLength",ee)}get timePause(){return+this.settings.getAttribute("TimePause")}set timePause(ee){this.settings.setAttribute("TimePause",ee)}get timeStep(){return+this.settings.getAttribute("TimeStep")}set timeStep(ee){this.settings.setAttribute("TimeStep",ee)}get timeUnits(){return this.settings.getAttribute("TimeUnits")}set timeUnits(ee){this.settings.setAttribute("TimeUnits",ee)}get algorithm(){let ee=this.settings.getAttribute("SolutionAlgorithm");return ee==="RK1"?"Euler":ee}set algorithm(ee){let re;ee==="Euler"?re="RK1":re=ee,this.settings.setAttribute("SolutionAlgorithm",re)}get globals(){return this.settings.getAttribute("Macros")||""}set globals(ee){this.settings.setAttribute("Macros",ee)}get customUnits(){return(this.settings.getAttribute("Units")||"").split(`
`).filter(ee=>!!ee).map(ee=>{let re=ee.split("<>");return{name:re[0],scale:+re[1],target:re[2]}})}set customUnits(ee){this.settings.setAttribute("Units",ee.map(re=>re.name+"<>"+re.scale+"<>"+re.target).join(`
`))}}function excludeKeys(te,ee){let re={};for(let ne in te)ee.includes(ne)||(re[ne]=te[ne]);return re}function formatProdErrorMessage(te){return"Minified Redux error #"+te+"; visit https://redux.js.org/Errors?code="+te+" for the full message or use the non-minified dev environment for full errors. "}var $$observable=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}(),randomString=function(){return Math.random().toString(36).substring(7).split("").join(".")},ActionTypes={INIT:"@@redux/INIT"+randomString(),REPLACE:"@@redux/REPLACE"+randomString(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+randomString()}};function isPlainObject(te){if(typeof te!="object"||te===null)return!1;for(var ee=te;Object.getPrototypeOf(ee)!==null;)ee=Object.getPrototypeOf(ee);return Object.getPrototypeOf(te)===ee}function createStore(te,ee,re){var ne;if(typeof ee=="function"&&typeof re=="function"||typeof re=="function"&&typeof arguments[3]=="function")throw new Error(formatProdErrorMessage(0));if(typeof ee=="function"&&typeof re>"u"&&(re=ee,ee=void 0),typeof re<"u"){if(typeof re!="function")throw new Error(formatProdErrorMessage(1));return re(createStore)(te,ee)}if(typeof te!="function")throw new Error(formatProdErrorMessage(2));var ie=te,se=ee,le=[],ue=le,ae=!1;function oe(){ue===le&&(ue=le.slice())}function ce(){if(ae)throw new Error(formatProdErrorMessage(3));return se}function he(ge){if(typeof ge!="function")throw new Error(formatProdErrorMessage(4));if(ae)throw new Error(formatProdErrorMessage(5));var we=!0;return oe(),ue.push(ge),function(){if(we){if(ae)throw new Error(formatProdErrorMessage(6));we=!1,oe();var _e=ue.indexOf(ge);ue.splice(_e,1),le=null}}}function pe(ge){if(!isPlainObject(ge))throw new Error(formatProdErrorMessage(7));if(typeof ge.type>"u")throw new Error(formatProdErrorMessage(8));if(ae)throw new Error(formatProdErrorMessage(9));try{ae=!0,se=ie(se,ge)}finally{ae=!1}for(var we=le=ue,ve=0;ve<we.length;ve++){var _e=we[ve];_e()}return ge}function de(ge){if(typeof ge!="function")throw new Error(formatProdErrorMessage(10));ie=ge,pe({type:ActionTypes.REPLACE})}function me(){var ge,we=he;return ge={subscribe:function(_e){if(typeof _e!="object"||_e===null)throw new Error(formatProdErrorMessage(11));function Te(){_e.next&&_e.next(ce())}Te();var ye=we(Te);return{unsubscribe:ye}}},ge[$$observable]=function(){return this},ge}return pe({type:ActionTypes.INIT}),ne={dispatch:pe,subscribe:he,getState:ce,replaceReducer:de},ne[$$observable]=me,ne}function commonjsRequire(te){throw new Error('Could not dynamically require "'+te+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var flexsearch_bundle={exports:{}};flexsearch_bundle.exports;(function(module){(function _f(self){try{module&&(self=module)}catch(te){}self._factory=_f;var t;function u(te){return typeof te<"u"?te:!0}function aa(te){const ee=Array(te);for(let re=0;re<te;re++)ee[re]=v();return ee}function v(){return Object.create(null)}function ba(te,ee){return ee.length-te.length}function x(te){return typeof te=="string"}function C(te){return typeof te=="object"}function D(te){return typeof te=="function"}function ca(te,ee){var re=da;if(te&&(ee&&(te=E(te,ee)),this.H&&(te=E(te,this.H)),this.J&&1<te.length&&(te=E(te,this.J)),re||re==="")){if(te=te.split(re),this.filter){ee=this.filter,re=te.length;const ne=[];for(let ie=0,se=0;ie<re;ie++){const le=te[ie];le&&!ee[le]&&(ne[se++]=le)}te=ne}return te}return te}const da=/[\p{Z}\p{S}\p{P}\p{C}]+/u,ea=/[\u0300-\u036f]/g;function fa(te,ee){const re=Object.keys(te),ne=re.length,ie=[];let se="",le=0;for(let ue=0,ae,oe;ue<ne;ue++)ae=re[ue],(oe=te[ae])?(ie[le++]=F(ee?"(?!\\b)"+ae+"(\\b|_)":ae),ie[le++]=oe):se+=(se?"|":"")+ae;return se&&(ie[le++]=F(ee?"(?!\\b)("+se+")(\\b|_)":"("+se+")"),ie[le]=""),ie}function E(te,ee){for(let re=0,ne=ee.length;re<ne&&(te=te.replace(ee[re],ee[re+1]),te);re+=2);return te}function F(te){return new RegExp(te,"g")}function ha(te){let ee="",re="";for(let ne=0,ie=te.length,se;ne<ie;ne++)(se=te[ne])!==re&&(ee+=re=se);return ee}var ja={encode:ia,F:!1,G:""};function ia(te){return ca.call(this,(""+te).toLowerCase(),!1)}const ka={},G={};function la(te){I(te,"add"),I(te,"append"),I(te,"search"),I(te,"update"),I(te,"remove")}function I(te,ee){te[ee+"Async"]=function(){const re=this,ne=arguments;var ie=ne[ne.length-1];let se;return D(ie)&&(se=ie,delete ne[ne.length-1]),ie=new Promise(function(le){setTimeout(function(){re.async=!0;const ue=re[ee].apply(re,ne);re.async=!1,le(ue)})}),se?(ie.then(se),this):ie}}function ma(te,ee,re,ne){const ie=te.length;let se=[],le,ue,ae=0;ne&&(ne=[]);for(let oe=ie-1;0<=oe;oe--){const ce=te[oe],he=ce.length,pe=v();let de=!le;for(let me=0;me<he;me++){const ge=ce[me],we=ge.length;if(we)for(let ve=0,_e,Te;ve<we;ve++)if(Te=ge[ve],le){if(le[Te]){if(!oe){if(re)re--;else if(se[ae++]=Te,ae===ee)return se}(oe||ne)&&(pe[Te]=1),de=!0}if(ne&&(ue[Te]=(_e=ue[Te])?++_e:_e=1,_e<ie)){const ye=ne[_e-2]||(ne[_e-2]=[]);ye[ye.length]=Te}}else pe[Te]=1}if(ne)le||(ue=pe);else if(!de)return[];le=pe}if(ne)for(let oe=ne.length-1,ce,he;0<=oe;oe--){ce=ne[oe],he=ce.length;for(let pe=0,de;pe<he;pe++)if(de=ce[pe],!le[de]){if(re)re--;else if(se[ae++]=de,ae===ee)return se;le[de]=1}}return se}function na(te,ee){const re=v(),ne=v(),ie=[];for(let se=0;se<te.length;se++)re[te[se]]=1;for(let se=0,le;se<ee.length;se++){le=ee[se];for(let ue=0,ae;ue<le.length;ue++)ae=le[ue],re[ae]&&!ne[ae]&&(ne[ae]=1,ie[ie.length]=ae)}return ie}function J(te){this.l=te!==!0&&te,this.cache=v(),this.h=[]}function oa(te,ee,re){C(te)&&(te=te.query);let ne=this.cache.get(te);return ne||(ne=this.search(te,ee,re),this.cache.set(te,ne)),ne}J.prototype.set=function(te,ee){if(!this.cache[te]){var re=this.h.length;for(re===this.l?delete this.cache[this.h[re-1]]:re++,--re;0<re;re--)this.h[re]=this.h[re-1];this.h[0]=te}this.cache[te]=ee},J.prototype.get=function(te){const ee=this.cache[te];if(this.l&&ee&&(te=this.h.indexOf(te))){const re=this.h[te-1];this.h[te-1]=this.h[te],this.h[te]=re}return ee};const qa={memory:{charset:"latin:extra",D:3,B:4,m:!1},performance:{D:3,B:3,s:!1,context:{depth:2,D:1}},match:{charset:"latin:extra",G:"reverse"},score:{charset:"latin:advanced",D:20,B:3,context:{depth:3,D:9}},default:{}};function ra(te,ee,re,ne,ie,se){setTimeout(function(){const le=te(re,JSON.stringify(se));le&&le.then?le.then(function(){ee.export(te,ee,re,ne,ie+1)}):ee.export(te,ee,re,ne,ie+1)})}function K(te,ee){if(!(this instanceof K))return new K(te);var re;if(te){x(te)?te=qa[te]:(re=te.preset)&&(te=Object.assign({},re[re],te)),re=te.charset;var ne=te.lang;x(re)&&(re.indexOf(":")===-1&&(re+=":default"),re=G[re]),x(ne)&&(ne=ka[ne])}else te={};let ie,se,le=te.context||{};if(this.encode=te.encode||re&&re.encode||ia,this.register=ee||v(),this.D=ie=te.resolution||9,this.G=ee=re&&re.G||te.tokenize||"strict",this.depth=ee==="strict"&&le.depth,this.l=u(le.bidirectional),this.s=se=u(te.optimize),this.m=u(te.fastupdate),this.B=te.minlength||1,this.C=te.boost,this.map=se?aa(ie):v(),this.A=ie=le.resolution||1,this.h=se?aa(ie):v(),this.F=re&&re.F||te.rtl,this.H=(ee=te.matcher||ne&&ne.H)&&fa(ee,!1),this.J=(ee=te.stemmer||ne&&ne.J)&&fa(ee,!0),re=ee=te.filter||ne&&ne.filter){re=ee,ne=v();for(let ue=0,ae=re.length;ue<ae;ue++)ne[re[ue]]=1;re=ne}this.filter=re,this.cache=(ee=te.cache)&&new J(ee)}t=K.prototype,t.append=function(te,ee){return this.add(te,ee,!0)},t.add=function(te,ee,re,ne){if(ee&&(te||te===0)){if(!ne&&!re&&this.register[te])return this.update(te,ee);if(ee=this.encode(ee),ne=ee.length){const oe=v(),ce=v(),he=this.depth,pe=this.D;for(let de=0;de<ne;de++){let me=ee[this.F?ne-1-de:de];var ie=me.length;if(me&&ie>=this.B&&(he||!ce[me])){var se=L(pe,ne,de),le="";switch(this.G){case"full":if(3<ie){for(se=0;se<ie;se++)for(var ue=ie;ue>se;ue--)if(ue-se>=this.B){var ae=L(pe,ne,de,ie,se);le=me.substring(se,ue),M(this,ce,le,ae,te,re)}break}case"reverse":if(2<ie){for(ue=ie-1;0<ue;ue--)le=me[ue]+le,le.length>=this.B&&M(this,ce,le,L(pe,ne,de,ie,ue),te,re);le=""}case"forward":if(1<ie){for(ue=0;ue<ie;ue++)le+=me[ue],le.length>=this.B&&M(this,ce,le,se,te,re);break}default:if(this.C&&(se=Math.min(se/this.C(ee,me,de)|0,pe-1)),M(this,ce,me,se,te,re),he&&1<ne&&de<ne-1){for(ie=v(),le=this.A,se=me,ue=Math.min(he+1,ne-de),ie[se]=1,ae=1;ae<ue;ae++)if((me=ee[this.F?ne-1-de-ae:de+ae])&&me.length>=this.B&&!ie[me]){ie[me]=1;const ge=this.l&&me>se;M(this,oe,ge?se:me,L(le+(ne/2>le?0:1),ne,de,ue-1,ae-1),te,re,ge?me:se)}}}}}this.m||(this.register[te]=1)}}return this};function L(te,ee,re,ne,ie){return re&&1<te?ee+(ne||0)<=te?re+(ie||0):(te-1)/(ee+(ne||0))*(re+(ie||0))+1|0:0}function M(te,ee,re,ne,ie,se,le){let ue=le?te.h:te.map;(!ee[re]||le&&!ee[re][le])&&(te.s&&(ue=ue[ne]),le?(ee=ee[re]||(ee[re]=v()),ee[le]=1,ue=ue[le]||(ue[le]=v())):ee[re]=1,ue=ue[re]||(ue[re]=[]),te.s||(ue=ue[ne]||(ue[ne]=[])),se&&ue.indexOf(ie)!==-1||(ue[ue.length]=ie,te.m&&(te=te.register[ie]||(te.register[ie]=[]),te[te.length]=ue)))}t.search=function(te,ee,re){re||(!ee&&C(te)?(re=te,te=re.query):C(ee)&&(re=ee));let ne=[],ie,se,le=0;if(re){ee=re.limit,le=re.offset||0;var ue=re.context;se=re.suggest}if(te&&(te=this.encode(te),ie=te.length,1<ie)){re=v();var ae=[];for(let ce=0,he=0,pe;ce<ie;ce++)if((pe=te[ce])&&pe.length>=this.B&&!re[pe])if(this.s||se||this.map[pe])ae[he++]=pe,re[pe]=1;else return ne;te=ae,ie=te.length}if(!ie)return ne;ee||(ee=100),ue=this.depth&&1<ie&&ue!==!1,re=0;let oe;ue?(oe=te[0],re=1):1<ie&&te.sort(ba);for(let ce,he;re<ie;re++){if(he=te[re],ue?(ce=sa(this,ne,se,ee,le,ie===2,he,oe),se&&ce===!1&&ne.length||(oe=he)):ce=sa(this,ne,se,ee,le,ie===1,he),ce)return ce;if(se&&re===ie-1){if(ae=ne.length,!ae){if(ue){ue=0,re=-1;continue}return ne}if(ae===1)return ta(ne[0],ee,le)}}return ma(ne,ee,le,se)};function sa(te,ee,re,ne,ie,se,le,ue){let ae=[],oe=ue?te.h:te.map;if(te.s||(oe=ua(oe,le,ue,te.l)),oe){let ce=0;const he=Math.min(oe.length,ue?te.A:te.D);for(let pe=0,de=0,me,ge;pe<he&&!((me=oe[pe])&&(te.s&&(me=ua(me,le,ue,te.l)),ie&&me&&se&&(ge=me.length,ge<=ie?(ie-=ge,me=null):(me=me.slice(ie),ie=0)),me&&(ae[ce++]=me,se&&(de+=me.length,de>=ne))));pe++);if(ce){if(se)return ta(ae,ne,0);ee[ee.length]=ae;return}}return!re&&ae}function ta(te,ee,re){return te=te.length===1?te[0]:[].concat.apply([],te),re||te.length>ee?te.slice(re,re+ee):te}function ua(te,ee,re,ne){return re?(ne=ne&&ee>re,te=(te=te[ne?ee:re])&&te[ne?re:ee]):te=te[ee],te}t.contain=function(te){return!!this.register[te]},t.update=function(te,ee){return this.remove(te).add(te,ee)},t.remove=function(te,ee){const re=this.register[te];if(re){if(this.m)for(let ne=0,ie;ne<re.length;ne++)ie=re[ne],ie.splice(ie.indexOf(te),1);else N(this.map,te,this.D,this.s),this.depth&&N(this.h,te,this.A,this.s);if(ee||delete this.register[te],this.cache){ee=this.cache;for(let ne=0,ie,se;ne<ee.h.length;ne++)se=ee.h[ne],ie=ee.cache[se],ie.indexOf(te)!==-1&&(ee.h.splice(ne--,1),delete ee.cache[se])}}return this};function N(te,ee,re,ne,ie){let se=0;if(te.constructor===Array)if(ie)ee=te.indexOf(ee),ee!==-1?1<te.length&&(te.splice(ee,1),se++):se++;else{ie=Math.min(te.length,re);for(let le=0,ue;le<ie;le++)(ue=te[le])&&(se=N(ue,ee,re,ne,ie),ne||se||delete te[le])}else for(let le in te)(se=N(te[le],ee,re,ne,ie))||delete te[le];return se}t.searchCache=oa,t.export=function(te,ee,re,ne,ie){let se,le;switch(ie||(ie=0)){case 0:if(se="reg",this.m){le=v();for(let ue in this.register)le[ue]=1}else le=this.register;break;case 1:se="cfg",le={doc:0,opt:this.s?1:0};break;case 2:se="map",le=this.map;break;case 3:se="ctx",le=this.h;break;default:return}return ra(te,ee||this,re?re+"."+se:se,ne,ie,le),!0},t.import=function(te,ee){if(ee)switch(x(ee)&&(ee=JSON.parse(ee)),te){case"cfg":this.s=!!ee.opt;break;case"reg":this.m=!1,this.register=ee;break;case"map":this.map=ee;break;case"ctx":this.h=ee}},la(K.prototype);function va(te){te=te.data;var ee=self._index;const re=te.args;var ne=te.task;switch(ne){case"init":ne=te.options||{},te=te.factory,ee=ne.encode,ne.cache=!1,ee&&ee.indexOf("function")===0&&(ne.encode=Function("return "+ee)()),te?(Function("return "+te)()(self),self._index=new self.FlexSearch.Index(ne),delete self.FlexSearch):self._index=new K(ne);break;default:te=te.id,ee=ee[ne].apply(ee,re),postMessage(ne==="search"?{id:te,msg:ee}:{id:te})}}let wa=0;function O(te){if(!(this instanceof O))return new O(te);var ee;te?D(ee=te.encode)&&(te.encode=ee.toString()):te={},(ee=(self||window)._factory)&&(ee=ee.toString());const re=self.exports,ne=this;this.o=xa(ee,re,te.worker),this.h=v(),this.o&&(re?this.o.on("message",function(ie){ne.h[ie.id](ie.msg),delete ne.h[ie.id]}):this.o.onmessage=function(ie){ie=ie.data,ne.h[ie.id](ie.msg),delete ne.h[ie.id]},this.o.postMessage({task:"init",factory:ee,options:te}))}P("add"),P("append"),P("search"),P("update"),P("remove");function P(te){O.prototype[te]=O.prototype[te+"Async"]=function(){const ee=this,re=[].slice.call(arguments);var ne=re[re.length-1];let ie;return D(ne)&&(ie=ne,re.splice(re.length-1,1)),ne=new Promise(function(se){setTimeout(function(){ee.h[++wa]=se,ee.o.postMessage({task:te,id:wa,args:re})})}),ie?(ne.then(ie),this):ne}}function xa(a,b,c){let d;try{d=b?eval('new (require("worker_threads")["Worker"])("../dist/node/node.js")'):a?new Worker(URL.createObjectURL(new Blob(["onmessage="+va.toString()],{type:"text/javascript"}))):new Worker(x(c)?c:"worker/worker.js",{type:"module"})}catch(te){}return d}function Q(te){if(!(this instanceof Q))return new Q(te);var ee=te.document||te.doc||te,re;this.K=[],this.h=[],this.A=[],this.register=v(),this.key=(re=ee.key||ee.id)&&S(re,this.A)||"id",this.m=u(te.fastupdate),this.C=(re=ee.store)&&re!==!0&&[],this.store=re&&v(),this.I=(re=ee.tag)&&S(re,this.A),this.l=re&&v(),this.cache=(re=te.cache)&&new J(re),te.cache=!1,this.o=te.worker,this.async=!1,re=v();let ne=ee.index||ee.field||ee;x(ne)&&(ne=[ne]);for(let ie=0,se,le;ie<ne.length;ie++)se=ne[ie],x(se)||(le=se,se=se.field),le=C(le)?Object.assign({},te,le):te,this.o&&(re[se]=new O(le),re[se].o||(this.o=!1)),this.o||(re[se]=new K(le,this.register)),this.K[ie]=S(se,this.A),this.h[ie]=se;if(this.C)for(te=ee.store,x(te)&&(te=[te]),ee=0;ee<te.length;ee++)this.C[ee]=S(te[ee],this.A);this.index=re}function S(te,ee){const re=te.split(":");let ne=0;for(let ie=0;ie<re.length;ie++)te=re[ie],0<=te.indexOf("[]")&&(te=te.substring(0,te.length-2))&&(ee[ne]=!0),te&&(re[ne++]=te);return ne<re.length&&(re.length=ne),1<ne?re:re[0]}function T(te,ee){if(x(ee))te=te[ee];else for(let re=0;te&&re<ee.length;re++)te=te[ee[re]];return te}function U(te,ee,re,ne,ie){if(te=te[ie],ne===re.length-1)ee[ie]=te;else if(te)if(te.constructor===Array)for(ee=ee[ie]=Array(te.length),ie=0;ie<te.length;ie++)U(te,ee,re,ne,ie);else ee=ee[ie]||(ee[ie]=v()),ie=re[++ne],U(te,ee,re,ne,ie)}function V(te,ee,re,ne,ie,se,le,ue){if(te=te[le])if(ne===ee.length-1){if(te.constructor===Array){if(re[ne]){for(ee=0;ee<te.length;ee++)ie.add(se,te[ee],!0,!0);return}te=te.join(" ")}ie.add(se,te,ue,!0)}else if(te.constructor===Array)for(le=0;le<te.length;le++)V(te,ee,re,ne,ie,se,le,ue);else le=ee[++ne],V(te,ee,re,ne,ie,se,le,ue)}t=Q.prototype,t.add=function(te,ee,re){if(C(te)&&(ee=te,te=T(ee,this.key)),ee&&(te||te===0)){if(!re&&this.register[te])return this.update(te,ee);for(let ne=0,ie,se;ne<this.h.length;ne++)se=this.h[ne],ie=this.K[ne],x(ie)&&(ie=[ie]),V(ee,ie,this.A,0,this.index[se],te,ie[0],re);if(this.I){let ne=T(ee,this.I),ie=v();x(ne)&&(ne=[ne]);for(let se=0,le,ue;se<ne.length;se++)if(le=ne[se],!ie[le]&&(ie[le]=1,ue=this.l[le]||(this.l[le]=[]),!re||ue.indexOf(te)===-1)&&(ue[ue.length]=te,this.m)){const ae=this.register[te]||(this.register[te]=[]);ae[ae.length]=ue}}if(this.store&&(!re||!this.store[te])){let ne;if(this.C){ne=v();for(let ie=0,se;ie<this.C.length;ie++)se=this.C[ie],x(se)?ne[se]=ee[se]:U(ee,ne,se,0,se[0])}this.store[te]=ne||ee}}return this},t.append=function(te,ee){return this.add(te,ee,!0)},t.update=function(te,ee){return this.remove(te).add(te,ee)},t.remove=function(te){if(C(te)&&(te=T(te,this.key)),this.register[te]){for(var ee=0;ee<this.h.length&&(this.index[this.h[ee]].remove(te,!this.o),!this.m);ee++);if(this.I&&!this.m)for(let re in this.l){ee=this.l[re];const ne=ee.indexOf(te);ne!==-1&&(1<ee.length?ee.splice(ne,1):delete this.l[re])}this.store&&delete this.store[te],delete this.register[te]}return this},t.search=function(te,ee,re,ne){re||(!ee&&C(te)?(re=te,te=re.query):C(ee)&&(re=ee,ee=0));let ie=[],se=[],le,ue,ae,oe,ce,he,pe=0;if(re)if(re.constructor===Array)ae=re,re=null;else{if(ae=(le=re.pluck)||re.index||re.field,oe=re.tag,ue=this.store&&re.enrich,ce=re.bool==="and",ee=re.limit||100,he=re.offset||0,oe&&(x(oe)&&(oe=[oe]),!te)){for(let me=0,ge;me<oe.length;me++)(ge=ya.call(this,oe[me],ee,he,ue))&&(ie[ie.length]=ge,pe++);return pe?ie:[]}x(ae)&&(ae=[ae])}ae||(ae=this.h),ce=ce&&(1<ae.length||oe&&1<oe.length);const de=!ne&&(this.o||this.async)&&[];for(let me=0,ge,we,ve;me<ae.length;me++){let _e;if(we=ae[me],x(we)||(_e=we,we=we.field),de)de[me]=this.index[we].searchAsync(te,ee,_e||re);else{if(ne?ge=ne[me]:ge=this.index[we].search(te,ee,_e||re),ve=ge&&ge.length,oe&&ve){const Te=[];let ye=0;ce&&(Te[0]=[ge]);for(let be=0,Fe,Le;be<oe.length;be++)Fe=oe[be],(ve=(Le=this.l[Fe])&&Le.length)&&(ye++,Te[Te.length]=ce?[Le]:Le);ye&&(ge=ce?ma(Te,ee||100,he||0):na(ge,Te),ve=ge.length)}if(ve)se[pe]=we,ie[pe++]=ge;else if(ce)return[]}}if(de){const me=this;return new Promise(function(ge){Promise.all(de).then(function(we){ge(me.search(te,ee,re,we))})})}if(!pe)return[];if(le&&(!ue||!this.store))return ie[0];for(let me=0,ge;me<se.length;me++){if(ge=ie[me],ge.length&&ue&&(ge=za.call(this,ge)),le)return ge;ie[me]={field:se[me],result:ge}}return ie};function ya(te,ee,re,ne){let ie=this.l[te],se=ie&&ie.length-re;if(se&&0<se)return(se>ee||re)&&(ie=ie.slice(re,re+ee)),ne&&(ie=za.call(this,ie)),{tag:te,result:ie}}function za(te){const ee=Array(te.length);for(let re=0,ne;re<te.length;re++)ne=te[re],ee[re]={id:ne,doc:this.store[ne]};return ee}t.contain=function(te){return!!this.register[te]},t.get=function(te){return this.store[te]},t.set=function(te,ee){return this.store[te]=ee,this},t.searchCache=oa,t.export=function(te,ee,re,ne,ie){if(ie||(ie=0),ne||(ne=0),ne<this.h.length){const se=this.h[ne],le=this.index[se];ee=this,setTimeout(function(){le.export(te,ee,ie?se.replace(":","-"):"",ne,ie++)||(ne++,ie=1,ee.export(te,ee,se,ne,ie))})}else{let se;switch(ie){case 1:re="tag",se=this.l;break;case 2:re="store",se=this.store;break;default:return}ra(te,this,re,ne,ie,se)}},t.import=function(te,ee){if(ee)switch(x(ee)&&(ee=JSON.parse(ee)),te){case"tag":this.l=ee;break;case"reg":this.m=!1,this.register=ee;for(let ne=0,ie;ne<this.h.length;ne++)ie=this.index[this.h[ne]],ie.register=ee,ie.m=!1;break;case"store":this.store=ee;break;default:te=te.split(".");const re=te[0];te=te[1],re&&te&&this.index[re].import(te,ee)}},la(Q.prototype);var Ba={encode:Aa,F:!1,G:""};const Ca=[F("[àáâãäå]"),"a",F("[èéêë]"),"e",F("[ìíîï]"),"i",F("[òóôõöő]"),"o",F("[ùúûüű]"),"u",F("[ýŷÿ]"),"y",F("ñ"),"n",F("[çc]"),"k",F("ß"),"s",F(" & ")," and "];function Aa(te){var ee=te;return ee.normalize&&(ee=ee.normalize("NFD").replace(ea,"")),ca.call(this,ee.toLowerCase(),!te.normalize&&Ca)}var Ea={encode:Da,F:!1,G:"strict"};const Fa=/[^a-z0-9]+/,Ga={b:"p",v:"f",w:"f",z:"s",x:"s",ß:"s",d:"t",n:"m",c:"k",g:"k",j:"k",q:"k",i:"e",y:"e",u:"o"};function Da(te){te=Aa.call(this,te).join(" ");const ee=[];if(te){const re=te.split(Fa),ne=re.length;for(let ie=0,se,le=0;ie<ne;ie++)if((te=re[ie])&&(!this.filter||!this.filter[te])){se=te[0];let ue=Ga[se]||se,ae=ue;for(let oe=1;oe<te.length;oe++){se=te[oe];const ce=Ga[se]||se;ce&&ce!==ae&&(ue+=ce,ae=ce)}ee[le++]=ue}}return ee}var Ia={encode:Ha,F:!1,G:""};const Ja=[F("ae"),"a",F("oe"),"o",F("sh"),"s",F("th"),"t",F("ph"),"f",F("pf"),"f",F("(?![aeo])h(?![aeo])"),"",F("(?!^[aeo])h(?!^[aeo])"),""];function Ha(te,ee){return te&&(te=Da.call(this,te).join(" "),2<te.length&&(te=E(te,Ja)),ee||(1<te.length&&(te=ha(te)),te&&(te=te.split(" ")))),te}var La={encode:Ka,F:!1,G:""};const Ma=F("(?!\\b)[aeo]");function Ka(te){return te&&(te=Ha.call(this,te,!0),1<te.length&&(te=te.replace(Ma,"")),1<te.length&&(te=ha(te)),te&&(te=te.split(" "))),te}G["latin:default"]=ja,G["latin:simple"]=Ba,G["latin:balance"]=Ea,G["latin:advanced"]=Ia,G["latin:extra"]=La;const W=self;let Y;const Z={Index:K,Document:Q,Worker:O,registerCharset:function(te,ee){G[te]=ee},registerLanguage:function(te,ee){ka[te]=ee}};(Y=W.define)&&Y.amd?Y([],function(){return Z}):W.exports?W.exports=Z:W.FlexSearch=Z})(commonjsGlobal)})(flexsearch_bundle);var flexsearch_bundleExports=flexsearch_bundle.exports;const FlexSearch=getDefaultExportFromCjs(flexsearch_bundleExports);var fuzzysort$1={exports:{}};(function(te){(function(ee,re){te.exports?te.exports=re():ee.fuzzysort=re()})(commonjsGlobal,function(){function re(ge){var we={single:function(ve,_e,Te){if(!ve||(pe(ve)||(ve=we.getPreparedSearch(ve)),!_e))return null;pe(_e)||(_e=we.getPrepared(_e));var ye=Te&&Te.allowTypo!==void 0?Te.allowTypo:ge&&ge.allowTypo!==void 0?ge.allowTypo:!0,be=ye?we.algorithm:we.algorithmNoTypo;return be(ve,_e,ve[0])},go:function(ve,_e,Te){if(!ve)return le;ve=we.prepareSearch(ve);var ye=ve[0],be=Te&&Te.threshold||ge&&ge.threshold||-9007199254740991,Fe=Te&&Te.limit||ge&&ge.limit||9007199254740991,Le=Te&&Te.allowTypo!==void 0?Te.allowTypo:ge&&ge.allowTypo!==void 0?ge.allowTypo:!0,Oe=Le?we.algorithm:we.algorithmNoTypo,Se=0,De=0,Ie=_e.length;if(Te&&Te.keys)for(var Ve=Te.scoreFn||ce,Ke=Te.keys,ht=Ke.length,qe=Ie-1;qe>=0;--qe){for(var ot=_e[qe],nt=new Array(ht),Xe=ht-1;Xe>=0;--Xe){var Ge=Ke[Xe],et=he(ot,Ge);if(!et){nt[Xe]=null;continue}pe(et)||(et=we.getPrepared(et)),nt[Xe]=Oe(ve,et,ye)}nt.obj=ot;var tt=Ve(nt);tt!==null&&(tt<be||(nt.score=tt,Se<Fe?(me.add(nt),++Se):(++De,tt>me.peek().score&&me.replaceTop(nt))))}else if(Te&&Te.key)for(var Ge=Te.key,qe=Ie-1;qe>=0;--qe){var ot=_e[qe],et=he(ot,Ge);if(et){pe(et)||(et=we.getPrepared(et));var je=Oe(ve,et,ye);je!==null&&(je.score<be||(je={target:je.target,_targetLowerCodes:null,_nextBeginningIndexes:null,score:je.score,indexes:je.indexes,obj:ot},Se<Fe?(me.add(je),++Se):(++De,je.score>me.peek().score&&me.replaceTop(je))))}}else for(var qe=Ie-1;qe>=0;--qe){var et=_e[qe];if(et){pe(et)||(et=we.getPrepared(et));var je=Oe(ve,et,ye);je!==null&&(je.score<be||(Se<Fe?(me.add(je),++Se):(++De,je.score>me.peek().score&&me.replaceTop(je))))}}if(Se===0)return le;for(var at=new Array(Se),qe=Se-1;qe>=0;--qe)at[qe]=me.poll();return at.total=Se+De,at},goAsync:function(ve,_e,Te){var ye=!1,be=new Promise(function(Fe,Le){if(!ve)return Fe(le);ve=we.prepareSearch(ve);var Oe=ve[0],Se=de(),De=_e.length-1,Ie=Te&&Te.threshold||ge&&ge.threshold||-9007199254740991,Ve=Te&&Te.limit||ge&&ge.limit||9007199254740991,Ke=Te&&Te.allowTypo!==void 0?Te.allowTypo:ge&&ge.allowTypo!==void 0?ge.allowTypo:!0,ht=Ke?we.algorithm:we.algorithmNoTypo,qe=0,ot=0;function nt(){if(ye)return Le("canceled");var Xe=Date.now();if(Te&&Te.keys)for(var Ge=Te.scoreFn||ce,et=Te.keys,tt=et.length;De>=0;--De){for(var je=_e[De],at=new Array(tt),Bt=tt-1;Bt>=0;--Bt){var Et=et[Bt],gt=he(je,Et);if(!gt){at[Bt]=null;continue}pe(gt)||(gt=we.getPrepared(gt)),at[Bt]=ht(ve,gt,Oe)}at.obj=je;var Xt=Ge(at);if(Xt!==null&&!(Xt<Ie)&&(at.score=Xt,qe<Ve?(Se.add(at),++qe):(++ot,Xt>Se.peek().score&&Se.replaceTop(at)),De%1e3===0&&Date.now()-Xe>=10)){ne?setImmediate(nt):setTimeout(nt);return}}else if(Te&&Te.key)for(var Et=Te.key;De>=0;--De){var je=_e[De],gt=he(je,Et);if(gt){pe(gt)||(gt=we.getPrepared(gt));var xt=ht(ve,gt,Oe);if(xt!==null&&!(xt.score<Ie)&&(xt={target:xt.target,_targetLowerCodes:null,_nextBeginningIndexes:null,score:xt.score,indexes:xt.indexes,obj:je},qe<Ve?(Se.add(xt),++qe):(++ot,xt.score>Se.peek().score&&Se.replaceTop(xt)),De%1e3===0&&Date.now()-Xe>=10)){ne?setImmediate(nt):setTimeout(nt);return}}}else for(;De>=0;--De){var gt=_e[De];if(gt){pe(gt)||(gt=we.getPrepared(gt));var xt=ht(ve,gt,Oe);if(xt!==null&&!(xt.score<Ie)&&(qe<Ve?(Se.add(xt),++qe):(++ot,xt.score>Se.peek().score&&Se.replaceTop(xt)),De%1e3===0&&Date.now()-Xe>=10)){ne?setImmediate(nt):setTimeout(nt);return}}}if(qe===0)return Fe(le);for(var Ye=new Array(qe),Rt=qe-1;Rt>=0;--Rt)Ye[Rt]=Se.poll();Ye.total=qe+ot,Fe(Ye)}ne?setImmediate(nt):nt()});return be.cancel=function(){ye=!0},be},highlight:function(ve,_e,Te){if(ve===null)return null;_e===void 0&&(_e="<b>"),Te===void 0&&(Te="</b>");for(var ye="",be=0,Fe=!1,Le=ve.target,Oe=Le.length,Se=ve.indexes,De=0;De<Oe;++De){var Ie=Le[De];if(Se[be]===De){if(++be,Fe||(Fe=!0,ye+=_e),be===Se.length){ye+=Ie+Te+Le.substr(De+1);break}}else Fe&&(Fe=!1,ye+=Te);ye+=Ie}return ye},prepare:function(ve){if(ve)return{target:ve,_targetLowerCodes:we.prepareLowerCodes(ve),_nextBeginningIndexes:null,score:null,indexes:null,obj:null}},prepareSlow:function(ve){if(ve)return{target:ve,_targetLowerCodes:we.prepareLowerCodes(ve),_nextBeginningIndexes:we.prepareNextBeginningIndexes(ve),score:null,indexes:null,obj:null}},prepareSearch:function(ve){if(ve)return we.prepareLowerCodes(ve)},getPrepared:function(ve){if(ve.length>999)return we.prepare(ve);var _e=ie.get(ve);return _e!==void 0||(_e=we.prepare(ve),ie.set(ve,_e)),_e},getPreparedSearch:function(ve){if(ve.length>999)return we.prepareSearch(ve);var _e=se.get(ve);return _e!==void 0||(_e=we.prepareSearch(ve),se.set(ve,_e)),_e},algorithm:function(ve,_e,Te){for(var ye=_e._targetLowerCodes,be=ve.length,Fe=ye.length,Ve=0,Le=0,Oe=0,Se=0;;){var De=Te===ye[Le];if(De){if(ue[Se++]=Le,++Ve,Ve===be)break;Te=ve[Oe===0?Ve:Oe===Ve?Ve+1:Oe===Ve-1?Ve-1:Ve]}if(++Le,Le>=Fe)for(;;){if(Ve<=1)return null;if(Oe===0){--Ve;var Ie=ve[Ve];if(Te===Ie)continue;Oe=Ve}else{if(Oe===1)return null;--Oe,Ve=Oe,Te=ve[Ve+1];var Ie=ve[Ve];if(Te===Ie)continue}Se=Ve,Le=ue[Se-1]+1;break}}var Ve=0,Ke=0,ht=!1,qe=0,ot=_e._nextBeginningIndexes;ot===null&&(ot=_e._nextBeginningIndexes=we.prepareNextBeginningIndexes(_e.target));var nt=Le=ue[0]===0?0:ot[ue[0]-1];if(Le!==Fe)for(;;)if(Le>=Fe){if(Ve<=0){if(++Ke,Ke>be-2)break;if(ve[Ke]===ve[Ke+1])continue;Le=nt;continue}--Ve;var Xe=ae[--qe];Le=ot[Xe]}else{var De=ve[Ke===0?Ve:Ke===Ve?Ve+1:Ke===Ve-1?Ve-1:Ve]===ye[Le];if(De){if(ae[qe++]=Le,++Ve,Ve===be){ht=!0;break}++Le}else Le=ot[Le]}{if(ht)var Ge=ae,et=qe;else var Ge=ue,et=Se;for(var tt=0,je=-1,at=0;at<be;++at){var Le=Ge[at];je!==Le-1&&(tt-=Le),je=Le}ht?Ke!==0&&(tt+=-20):(tt*=1e3,Oe!==0&&(tt+=-20)),tt-=Fe-be,_e.score=tt,_e.indexes=new Array(et);for(var at=et-1;at>=0;--at)_e.indexes[at]=Ge[at];return _e}},algorithmNoTypo:function(ve,_e,Te){for(var ye=_e._targetLowerCodes,be=ve.length,Fe=ye.length,De=0,Le=0,Oe=0;;){var Se=Te===ye[Le];if(Se){if(ue[Oe++]=Le,++De,De===be)break;Te=ve[De]}if(++Le,Le>=Fe)return null}var De=0,Ie=!1,Ve=0,Ke=_e._nextBeginningIndexes;if(Ke===null&&(Ke=_e._nextBeginningIndexes=we.prepareNextBeginningIndexes(_e.target)),Le=ue[0]===0?0:Ke[ue[0]-1],Le!==Fe)for(;;)if(Le>=Fe){if(De<=0)break;--De;var ht=ae[--Ve];Le=Ke[ht]}else{var Se=ve[De]===ye[Le];if(Se){if(ae[Ve++]=Le,++De,De===be){Ie=!0;break}++Le}else Le=Ke[Le]}{if(Ie)var qe=ae,ot=Ve;else var qe=ue,ot=Oe;for(var nt=0,Xe=-1,Ge=0;Ge<be;++Ge){var Le=qe[Ge];Xe!==Le-1&&(nt-=Le),Xe=Le}Ie||(nt*=1e3),nt-=Fe-be,_e.score=nt,_e.indexes=new Array(ot);for(var Ge=ot-1;Ge>=0;--Ge)_e.indexes[Ge]=qe[Ge];return _e}},prepareLowerCodes:function(ve){for(var _e=ve.length,Te=[],ye=ve.toLowerCase(),be=0;be<_e;++be)Te[be]=ye.charCodeAt(be);return Te},prepareBeginningIndexes:function(ve){for(var _e=ve.length,Te=[],ye=0,be=!1,Fe=!1,Le=0;Le<_e;++Le){var Oe=ve.charCodeAt(Le),Se=Oe>=65&&Oe<=90,De=Se||Oe>=97&&Oe<=122||Oe>=48&&Oe<=57,Ie=Se&&!be||!Fe||!De;be=Se,Fe=De,Ie&&(Te[ye++]=Le)}return Te},prepareNextBeginningIndexes:function(ve){for(var _e=ve.length,Te=we.prepareBeginningIndexes(ve),ye=[],be=Te[0],Fe=0,Le=0;Le<_e;++Le)be>Le?ye[Le]=be:(be=Te[++Fe],ye[Le]=be===void 0?_e:be);return ye},cleanup:oe,new:re};return we}var ne=typeof commonjsRequire<"u"&&typeof window>"u",ie=new Map,se=new Map,le=[];le.total=0;var ue=[],ae=[];function oe(){ie.clear(),se.clear(),ue=[],ae=[]}function ce(ge){for(var we=-9007199254740991,ve=ge.length-1;ve>=0;--ve){var _e=ge[ve];if(_e!==null){var Te=_e.score;Te>we&&(we=Te)}}return we===-9007199254740991?null:we}function he(ge,we){var ve=ge[we];if(ve!==void 0)return ve;var _e=we;Array.isArray(we)||(_e=we.split("."));for(var Te=_e.length,ye=-1;ge&&++ye<Te;)ge=ge[_e[ye]];return ge}function pe(ge){return typeof ge=="object"}var de=function(){var ge=[],we=0,ve={};function _e(){for(var Te=0,ye=ge[Te],be=1;be<we;){var Fe=be+1;Te=be,Fe<we&&ge[Fe].score<ge[be].score&&(Te=Fe),ge[Te-1>>1]=ge[Te],be=1+(Te<<1)}for(var Le=Te-1>>1;Te>0&&ye.score<ge[Le].score;Le=(Te=Le)-1>>1)ge[Te]=ge[Le];ge[Te]=ye}return ve.add=function(Te){var ye=we;ge[we++]=Te;for(var be=ye-1>>1;ye>0&&Te.score<ge[be].score;be=(ye=be)-1>>1)ge[ye]=ge[be];ge[ye]=Te},ve.poll=function(){if(we!==0){var Te=ge[0];return ge[0]=ge[--we],_e(),Te}},ve.peek=function(Te){if(we!==0)return ge[0]},ve.replaceTop=function(Te){ge[0]=Te,_e()},ve},me=de();return re()})})(fuzzysort$1);var fuzzysortExports=fuzzysort$1.exports;const fuzzysort=getDefaultExportFromCjs(fuzzysortExports);export{A$2 as A,createClient as B,Cn as C,D$1 as D,F$1 as F,G$1 as G,Model as M,O,Provider as P,React as R,T$1 as T,_extends$1 as _,an as a,_ as b,y$2 as c,k$5 as d,_objectWithoutPropertiesLoose as e,pn as f,getAugmentedNamespace as g,h$3 as h,_toPropertyKey as i,hoistNonReactStatics$1 as j,k$2 as k,l$4 as l,createStore as m,connect as n,commonjsGlobal as o,p$3 as p,q$4 as q,commonjsRequire as r,sn as s,getDefaultExportFromCjs as t,FlexSearch as u,fuzzysort as v,b$3 as w,x$1 as x,y$1 as y,z$1 as z};
